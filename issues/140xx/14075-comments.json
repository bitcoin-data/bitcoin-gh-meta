[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->Reviewers, this pull request conflicts with the following ones:\n\n* #14565 (Overhaul importmulti logic by sipa)\n* #14459 (More RPC help description fixes by ch4ot1c)\n* #14454 (Add SegWit support to importmulti by MeshCollider)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2018-08-26T20:30:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-416069520",
      "id" : 416069520,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxNjA2OTUyMA==",
      "updated_at" : "2018-10-30T07:11:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/416069520",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r212841823"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/212841823"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Commit \"Fetch keys from keypool when private keys are disabled\"\r\n\r\nCould move test to a different commit?",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2018-08-26T23:02:19Z",
      "diff_hunk" : "@@ -467,6 +467,67 @@ def run_test (self):\n         import_pub2 = self.nodes[0].getaddressinfo(addr2)['pubkey']\n         assert_equal(pub2, import_pub2)\n \n+        # Import some public keys to the keypool of a no privkey wallet",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r212841823",
      "id" : 212841823,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMjg0MTgyMw==",
      "original_commit_id" : "d7d9ac9654cdac69268574c94cf864c71d39f10f",
      "original_position" : 4,
      "path" : "test/functional/wallet_importmulti.py",
      "position" : 12,
      "pull_request_review_id" : 149553531,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/212841823",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r212841827"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/212841827"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Commit \"Fetch keys from keypool when private keys are disabled\"\r\n\r\nUse named argument `disable_private_keys=True`?",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2018-08-26T23:02:26Z",
      "diff_hunk" : "@@ -467,6 +467,67 @@ def run_test (self):\n         import_pub2 = self.nodes[0].getaddressinfo(addr2)['pubkey']\n         assert_equal(pub2, import_pub2)\n \n+        # Import some public keys to the keypool of a no privkey wallet\n+        self.log.info(\"Adding pubkey to keypool of disableprivkey wallet\")\n+        self.nodes[1].createwallet(\"noprivkeys\", True)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r212841827",
      "id" : 212841827,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMjg0MTgyNw==",
      "original_commit_id" : "d7d9ac9654cdac69268574c94cf864c71d39f10f",
      "original_position" : 6,
      "path" : "test/functional/wallet_importmulti.py",
      "position" : null,
      "pull_request_review_id" : 149553531,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/212841827",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r212841877"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/212841877"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Commit \"Add option to importmulti add an imported pubkey to the keypool\"\r\n\r\nDefault false.",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2018-08-26T23:04:02Z",
      "diff_hunk" : "@@ -1198,6 +1219,7 @@ UniValue importmulti(const JSONRPCRequest& mainRequest)\n             \"      \\\"internal\\\": <true>                                    , (boolean, optional, default: false) Stating whether matching outputs should be treated as not incoming payments\\n\"\n             \"      \\\"watchonly\\\": <true>                                   , (boolean, optional, default: false) Stating whether matching outputs should be considered watched even when they're not spendable, only allowed if keys are empty\\n\"\n             \"      \\\"label\\\": <label>                                      , (string, optional, default: '') Label to assign to the address (aka account name, for now), only allowed with internal=false\\n\"\n+            \"      \\\"keypool\\\": <true|false>                               , (boolean, optional, default: true) If true, adds the pubkeys to the keypool if private keys are disabled for the wallet.\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r212841877",
      "id" : 212841877,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMjg0MTg3Nw==",
      "original_commit_id" : "803a91650d055cfe4b9428e6dcb99a4776ef1ba4",
      "original_position" : 53,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 149553531,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/212841877",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r212841894"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/212841894"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Commit \"Add option to importmulti add an imported pubkey to the keypool\"\r\n\r\n... can be ...",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2018-08-26T23:04:33Z",
      "diff_hunk" : "@@ -876,6 +877,16 @@ static UniValue ProcessImport(CWallet * const pwallet, const UniValue& data, con\n             throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Invalid redeem script\");\n         }\n \n+        // Add to keypool only works with privkeys disabled\n+        if (add_keypool && !pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS)) {\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Keys can only be imported to the keypool when private keys are disabled\");\n+        }\n+\n+        // Add to keypool only works with pubkeys\n+        if (add_keypool && pubKeys.size() == 0) {\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Only pubkeys be imported to the keypool\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r212841894",
      "id" : 212841894,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMjg0MTg5NA==",
      "original_commit_id" : "803a91650d055cfe4b9428e6dcb99a4776ef1ba4",
      "original_position" : 19,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 149553531,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/212841894",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r213011946"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213011946"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This function should be renamed or called into from a new one.\r\n\r\n`WalletModel::KeypoolEmptyAndPrivkeysDisabled` or something obnoxiously explicit.",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2018-08-27T15:15:45Z",
      "diff_hunk" : "@@ -559,7 +559,7 @@ bool WalletModel::isWalletEnabled()\n \n bool WalletModel::privateKeysDisabled() const\n {\n-    return m_wallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS);\n+    return m_wallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) && m_wallet->KeypoolCountExternalKeys() == 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r213011946",
      "id" : 213011946,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMzAxMTk0Ng==",
      "original_commit_id" : "d7d9ac9654cdac69268574c94cf864c71d39f10f",
      "original_position" : 5,
      "path" : "src/qt/walletmodel.cpp",
      "position" : null,
      "pull_request_review_id" : 149756425,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213011946",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r213015525"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213015525"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Might be time to make a `TryToTopUpKeyPool` function for when we will continue regardless. We do this in a number of places in the PR and probably elsewhere.",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2018-08-27T15:26:36Z",
      "diff_hunk" : "@@ -161,11 +161,15 @@ static UniValue getnewaddress(const JSONRPCRequest& request)\n             + HelpExampleRpc(\"getnewaddress\", \"\")\n         );\n \n-    if (pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS)) {\n-        throw JSONRPCError(RPC_WALLET_ERROR, \"Error: Private keys are disabled for this wallet\");\n+    LOCK(pwallet->cs_wallet);\n+\n+    if (pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) && pwallet->KeypoolCountExternalKeys() == 0) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Error: Private keys are disabled for this wallet and no keys in the external keypool\");\n     }\n \n-    LOCK(pwallet->cs_wallet);\n+    if (!pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) && !pwallet->IsLocked()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r213015525",
      "id" : 213015525,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMzAxNTUyNQ==",
      "original_commit_id" : "d7d9ac9654cdac69268574c94cf864c71d39f10f",
      "original_position" : 13,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 149756425,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213015525",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r213017252"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213017252"
         }
      },
      "author_association" : "MEMBER",
      "body" : "assumption here being using importmulti means you want to support hdsplit?\r\n\r\nPerhaps break this into two lines:\r\n```\r\nbool fReturningInternal = fRequestedInternal;\r\nfReturningInternal &= (IsHDEnabled() && CanSupportFeature(FEATURE_HD_SPLIT)) || IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS);\r\n```",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2018-08-27T15:31:40Z",
      "diff_hunk" : "@@ -3417,7 +3423,7 @@ bool CWallet::ReserveKeyFromKeyPool(int64_t& nIndex, CKeyPool& keypool, bool fRe\n         if (!IsLocked())\n             TopUpKeyPool();\n \n-        bool fReturningInternal = IsHDEnabled() && CanSupportFeature(FEATURE_HD_SPLIT) && fRequestedInternal;\n+        bool fReturningInternal = ((IsHDEnabled() && CanSupportFeature(FEATURE_HD_SPLIT)) || IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS))  && fRequestedInternal;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r213017252",
      "id" : 213017252,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMzAxNzI1Mg==",
      "original_commit_id" : "d7d9ac9654cdac69268574c94cf864c71d39f10f",
      "original_position" : 18,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 149756425,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213017252",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r213018153"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213018153"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Belt and suspenders, we should be checking that this exists in our wallet regardless yes? Just not asking if we have the private key itself.",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2018-08-27T15:34:18Z",
      "diff_hunk" : "@@ -3434,7 +3440,7 @@ bool CWallet::ReserveKeyFromKeyPool(int64_t& nIndex, CKeyPool& keypool, bool fRe\n         if (!batch.ReadPool(nIndex, keypool)) {\n             throw std::runtime_error(std::string(__func__) + \": read failed\");\n         }\n-        if (!HaveKey(keypool.vchPubKey.GetID())) {\n+        if (!IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) && !HaveKey(keypool.vchPubKey.GetID())) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r213018153",
      "id" : 213018153,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMzAxODE1Mw==",
      "original_commit_id" : "d7d9ac9654cdac69268574c94cf864c71d39f10f",
      "original_position" : 27,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 149756425,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213018153",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r213019389"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213019389"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This should be checking the keypool corresponding to `internal`, yes?",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2018-08-27T15:37:59Z",
      "diff_hunk" : "@@ -3478,23 +3484,21 @@ void CWallet::ReturnKey(int64_t nIndex, bool fInternal, const CPubKey& pubkey)\n \n bool CWallet::GetKeyFromPool(CPubKey& result, bool internal)\n {\n-    if (IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS)) {\n+    LOCK(cs_wallet);\n+    if (IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) && KeypoolCountExternalKeys() == 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r213019389",
      "id" : 213019389,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMzAxOTM4OQ==",
      "original_commit_id" : "d7d9ac9654cdac69268574c94cf864c71d39f10f",
      "original_position" : 37,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 149756425,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213019389",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r213145236"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213145236"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`TopUpKeypool` actually already has this check in it so it won't do anything when the disable private keys flag is set. This is just an extra belt and suspenders check.",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2018-08-27T23:24:44Z",
      "diff_hunk" : "@@ -161,11 +161,15 @@ static UniValue getnewaddress(const JSONRPCRequest& request)\n             + HelpExampleRpc(\"getnewaddress\", \"\")\n         );\n \n-    if (pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS)) {\n-        throw JSONRPCError(RPC_WALLET_ERROR, \"Error: Private keys are disabled for this wallet\");\n+    LOCK(pwallet->cs_wallet);\n+\n+    if (pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) && pwallet->KeypoolCountExternalKeys() == 0) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Error: Private keys are disabled for this wallet and no keys in the external keypool\");\n     }\n \n-    LOCK(pwallet->cs_wallet);\n+    if (!pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) && !pwallet->IsLocked()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r213145236",
      "id" : 213145236,
      "in_reply_to_id" : 213015525,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMzE0NTIzNg==",
      "original_commit_id" : "d7d9ac9654cdac69268574c94cf864c71d39f10f",
      "original_position" : 13,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 149919627,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213145236",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r213150903"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213150903"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2018-08-28T00:01:50Z",
      "diff_hunk" : "@@ -467,6 +467,67 @@ def run_test (self):\n         import_pub2 = self.nodes[0].getaddressinfo(addr2)['pubkey']\n         assert_equal(pub2, import_pub2)\n \n+        # Import some public keys to the keypool of a no privkey wallet",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r213150903",
      "id" : 213150903,
      "in_reply_to_id" : 212841823,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMzE1MDkwMw==",
      "original_commit_id" : "d7d9ac9654cdac69268574c94cf864c71d39f10f",
      "original_position" : 4,
      "path" : "test/functional/wallet_importmulti.py",
      "position" : 12,
      "pull_request_review_id" : 149926428,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213150903",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r213150916"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213150916"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2018-08-28T00:01:54Z",
      "diff_hunk" : "@@ -467,6 +467,67 @@ def run_test (self):\n         import_pub2 = self.nodes[0].getaddressinfo(addr2)['pubkey']\n         assert_equal(pub2, import_pub2)\n \n+        # Import some public keys to the keypool of a no privkey wallet\n+        self.log.info(\"Adding pubkey to keypool of disableprivkey wallet\")\n+        self.nodes[1].createwallet(\"noprivkeys\", True)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r213150916",
      "id" : 213150916,
      "in_reply_to_id" : 212841827,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMzE1MDkxNg==",
      "original_commit_id" : "d7d9ac9654cdac69268574c94cf864c71d39f10f",
      "original_position" : 6,
      "path" : "test/functional/wallet_importmulti.py",
      "position" : null,
      "pull_request_review_id" : 149926440,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213150916",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r213150933"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213150933"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2018-08-28T00:02:00Z",
      "diff_hunk" : "@@ -1198,6 +1219,7 @@ UniValue importmulti(const JSONRPCRequest& mainRequest)\n             \"      \\\"internal\\\": <true>                                    , (boolean, optional, default: false) Stating whether matching outputs should be treated as not incoming payments\\n\"\n             \"      \\\"watchonly\\\": <true>                                   , (boolean, optional, default: false) Stating whether matching outputs should be considered watched even when they're not spendable, only allowed if keys are empty\\n\"\n             \"      \\\"label\\\": <label>                                      , (string, optional, default: '') Label to assign to the address (aka account name, for now), only allowed with internal=false\\n\"\n+            \"      \\\"keypool\\\": <true|false>                               , (boolean, optional, default: true) If true, adds the pubkeys to the keypool if private keys are disabled for the wallet.\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r213150933",
      "id" : 213150933,
      "in_reply_to_id" : 212841877,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMzE1MDkzMw==",
      "original_commit_id" : "803a91650d055cfe4b9428e6dcb99a4776ef1ba4",
      "original_position" : 53,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 149926456,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213150933",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r213150943"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213150943"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2018-08-28T00:02:04Z",
      "diff_hunk" : "@@ -876,6 +877,16 @@ static UniValue ProcessImport(CWallet * const pwallet, const UniValue& data, con\n             throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Invalid redeem script\");\n         }\n \n+        // Add to keypool only works with privkeys disabled\n+        if (add_keypool && !pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS)) {\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Keys can only be imported to the keypool when private keys are disabled\");\n+        }\n+\n+        // Add to keypool only works with pubkeys\n+        if (add_keypool && pubKeys.size() == 0) {\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Only pubkeys be imported to the keypool\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r213150943",
      "id" : 213150943,
      "in_reply_to_id" : 212841894,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMzE1MDk0Mw==",
      "original_commit_id" : "803a91650d055cfe4b9428e6dcb99a4776ef1ba4",
      "original_position" : 19,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 149926469,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213150943",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r213150957"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213150957"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2018-08-28T00:02:10Z",
      "diff_hunk" : "@@ -559,7 +559,7 @@ bool WalletModel::isWalletEnabled()\n \n bool WalletModel::privateKeysDisabled() const\n {\n-    return m_wallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS);\n+    return m_wallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) && m_wallet->KeypoolCountExternalKeys() == 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r213150957",
      "id" : 213150957,
      "in_reply_to_id" : 213011946,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMzE1MDk1Nw==",
      "original_commit_id" : "d7d9ac9654cdac69268574c94cf864c71d39f10f",
      "original_position" : 5,
      "path" : "src/qt/walletmodel.cpp",
      "position" : null,
      "pull_request_review_id" : 149926487,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213150957",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r213150976"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213150976"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2018-08-28T00:02:15Z",
      "diff_hunk" : "@@ -3417,7 +3423,7 @@ bool CWallet::ReserveKeyFromKeyPool(int64_t& nIndex, CKeyPool& keypool, bool fRe\n         if (!IsLocked())\n             TopUpKeyPool();\n \n-        bool fReturningInternal = IsHDEnabled() && CanSupportFeature(FEATURE_HD_SPLIT) && fRequestedInternal;\n+        bool fReturningInternal = ((IsHDEnabled() && CanSupportFeature(FEATURE_HD_SPLIT)) || IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS))  && fRequestedInternal;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r213150976",
      "id" : 213150976,
      "in_reply_to_id" : 213017252,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMzE1MDk3Ng==",
      "original_commit_id" : "d7d9ac9654cdac69268574c94cf864c71d39f10f",
      "original_position" : 18,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 149926511,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213150976",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r213151030"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213151030"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I changed this line to check for the pubkey in the wallet instead of the privkey.",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2018-08-28T00:02:39Z",
      "diff_hunk" : "@@ -3434,7 +3440,7 @@ bool CWallet::ReserveKeyFromKeyPool(int64_t& nIndex, CKeyPool& keypool, bool fRe\n         if (!batch.ReadPool(nIndex, keypool)) {\n             throw std::runtime_error(std::string(__func__) + \": read failed\");\n         }\n-        if (!HaveKey(keypool.vchPubKey.GetID())) {\n+        if (!IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) && !HaveKey(keypool.vchPubKey.GetID())) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r213151030",
      "id" : 213151030,
      "in_reply_to_id" : 213018153,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMzE1MTAzMA==",
      "original_commit_id" : "d7d9ac9654cdac69268574c94cf864c71d39f10f",
      "original_position" : 27,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 149926567,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213151030",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r213151039"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213151039"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2018-08-28T00:02:45Z",
      "diff_hunk" : "@@ -3478,23 +3484,21 @@ void CWallet::ReturnKey(int64_t nIndex, bool fInternal, const CPubKey& pubkey)\n \n bool CWallet::GetKeyFromPool(CPubKey& result, bool internal)\n {\n-    if (IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS)) {\n+    LOCK(cs_wallet);\n+    if (IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) && KeypoolCountExternalKeys() == 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r213151039",
      "id" : 213151039,
      "in_reply_to_id" : 213019389,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMzE1MTAzOQ==",
      "original_commit_id" : "d7d9ac9654cdac69268574c94cf864c71d39f10f",
      "original_position" : 37,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 149926578,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213151039",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased. The first commit is still from #14019 ",
      "created_at" : "2018-08-28T00:03:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-416407367",
      "id" : 416407367,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxNjQwNzM2Nw==",
      "updated_at" : "2018-08-28T00:03:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/416407367",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r213675322"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213675322"
         }
      },
      "author_association" : "MEMBER",
      "body" : "generalize comment",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2018-08-29T13:27:37Z",
      "diff_hunk" : "@@ -272,6 +272,9 @@ class Wallet\n     //! Register handler for watchonly changed messages.\n     using WatchOnlyChangedFn = std::function<void(bool have_watch_only)>;\n     virtual std::unique_ptr<Handler> handleWatchOnlyChanged(WatchOnlyChangedFn fn) = 0;\n+\n+    // Get the number of external keypool keys",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r213675322",
      "id" : 213675322,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMzY3NTMyMg==",
      "original_commit_id" : "85b6075ec7e8d275bc21574e6b16e0f5993d1b4d",
      "original_position" : 5,
      "path" : "src/interfaces/wallet.h",
      "position" : null,
      "pull_request_review_id" : 150559368,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213675322",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r213675937"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213675937"
         }
      },
      "author_association" : "MEMBER",
      "body" : "mu-nit: add commit for KeypoolCountInternalKeys",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2018-08-29T13:29:15Z",
      "diff_hunk" : "@@ -3311,6 +3311,22 @@ size_t CWallet::KeypoolCountExternalKeys()\n     return setExternalKeyPool.size() + set_pre_split_keypool.size();\n }\n \n+bool CWallet::NoPrivkeysAndKeypoolEmpty(bool internal)\n+{\n+    if (!IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS)) {\n+        return false;\n+    }\n+\n+    {\n+        LOCK(cs_wallet);\n+        if (internal) {\n+            return setInternalKeyPool.size() == 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r213675937",
      "id" : 213675937,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMzY3NTkzNw==",
      "original_commit_id" : "85b6075ec7e8d275bc21574e6b16e0f5993d1b4d",
      "original_position" : 13,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 150559368,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213675937",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "`CWallet::CreateTransaction` needs to check for keys in change keypool even if `WALLET_FLAG_DISABLE_PRIVATE_KEYS` is set.",
      "created_at" : "2018-08-29T14:28:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-416974371",
      "id" : 416974371,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxNjk3NDM3MQ==",
      "updated_at" : "2018-08-29T14:28:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/416974371",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r213831230"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213831230"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think that's unnecssary.",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2018-08-29T20:55:41Z",
      "diff_hunk" : "@@ -3311,6 +3311,22 @@ size_t CWallet::KeypoolCountExternalKeys()\n     return setExternalKeyPool.size() + set_pre_split_keypool.size();\n }\n \n+bool CWallet::NoPrivkeysAndKeypoolEmpty(bool internal)\n+{\n+    if (!IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS)) {\n+        return false;\n+    }\n+\n+    {\n+        LOCK(cs_wallet);\n+        if (internal) {\n+            return setInternalKeyPool.size() == 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r213831230",
      "id" : 213831230,
      "in_reply_to_id" : 213675937,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMzgzMTIzMA==",
      "original_commit_id" : "85b6075ec7e8d275bc21574e6b16e0f5993d1b4d",
      "original_position" : 13,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 150750967,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213831230",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r213832373"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213832373"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2018-08-29T20:59:35Z",
      "diff_hunk" : "@@ -272,6 +272,9 @@ class Wallet\n     //! Register handler for watchonly changed messages.\n     using WatchOnlyChangedFn = std::function<void(bool have_watch_only)>;\n     virtual std::unique_ptr<Handler> handleWatchOnlyChanged(WatchOnlyChangedFn fn) = 0;\n+\n+    // Get the number of external keypool keys",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r213832373",
      "id" : 213832373,
      "in_reply_to_id" : 213675322,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMzgzMjM3Mw==",
      "original_commit_id" : "85b6075ec7e8d275bc21574e6b16e0f5993d1b4d",
      "original_position" : 5,
      "path" : "src/interfaces/wallet.h",
      "position" : null,
      "pull_request_review_id" : 150752385,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213832373",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r216212468"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/216212468"
         }
      },
      "author_association" : "MEMBER",
      "body" : "FWIW, PEP-8 whitespace nits:\r\n\r\n```\r\n./test/functional/wallet_importmulti.py:458:31: E203 whitespace before ':'\r\n./test/functional/wallet_importmulti.py:458:35: E201 whitespace after '{'\r\n./test/functional/wallet_importmulti.py:458:45: E203 whitespace before ':'\r\n./test/functional/wallet_importmulti.py:459:31: E203 whitespace before ':'\r\n./test/functional/wallet_importmulti.py:460:26: E203 whitespace before ':'\r\n./test/functional/wallet_importmulti.py:482:31: E203 whitespace before ':'\r\n./test/functional/wallet_importmulti.py:482:35: E201 whitespace after '{'\r\n./test/functional/wallet_importmulti.py:482:45: E203 whitespace before ':'\r\n./test/functional/wallet_importmulti.py:483:31: E203 whitespace before ':'\r\n./test/functional/wallet_importmulti.py:484:26: E203 whitespace before ':'\r\n./test/functional/wallet_importmulti.py:485:26: E203 whitespace before ':'\r\n./test/functional/wallet_importmulti.py:504:31: E203 whitespace before ':'\r\n./test/functional/wallet_importmulti.py:504:35: E201 whitespace after '{'\r\n./test/functional/wallet_importmulti.py:504:45: E203 whitespace before ':'\r\n./test/functional/wallet_importmulti.py:505:31: E203 whitespace before ':'\r\n./test/functional/wallet_importmulti.py:506:26: E203 whitespace before ':'\r\n./test/functional/wallet_importmulti.py:507:26: E203 whitespace before ':'\r\n./test/functional/wallet_importmulti.py:508:27: E203 whitespace before ':'\r\n./test/functional/wallet_importmulti.py:523:27: E203 whitespace before ':'\r\n./test/functional/wallet_importmulti.py:523:31: E201 whitespace after '{'\r\n./test/functional/wallet_importmulti.py:523:41: E203 whitespace before ':'\r\n./test/functional/wallet_importmulti.py:524:27: E203 whitespace before ':'\r\n./test/functional/wallet_importmulti.py:525:22: E203 whitespace before ':'\r\n./test/functional/wallet_importmulti.py:526:22: E203 whitespace before ':'\r\n```",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2018-09-10T06:44:10Z",
      "diff_hunk" : "@@ -446,6 +446,88 @@ def run_test (self):\n                 \"timestamp\": \"\",\n             }])\n \n+        # Importing multiple public keys with 2-of-2 p2sh multisig\n+        self.log.info(\"Pubkeys should be available after importing 2-of-2 p2sh multisig with pubkeys\")\n+        addr1 = self.nodes[1].getnewaddress()\n+        addr2 = self.nodes[1].getnewaddress()\n+        pub1 = self.nodes[1].getaddressinfo(addr1)['pubkey']\n+        pub2 = self.nodes[1].getaddressinfo(addr2)['pubkey']\n+        ms = self.nodes[1].createmultisig(2, [pub1, pub2])\n+        result = self.nodes[0].importmulti(\n+            [{\n+                'scriptPubKey' : { 'address' : ms['address']},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r216212468",
      "id" : 216212468,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNjIxMjQ2OA==",
      "original_commit_id" : "acb05a18202c86ab0635d850c63d4461258bbfd0",
      "original_position" : 13,
      "path" : "test/functional/wallet_importmulti.py",
      "position" : null,
      "pull_request_review_id" : 153640991,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/216212468",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. Lightly tested via your combined branch 3fa968ea343: I was able to import a bunch of receive and change keys. I was also able to receive coins on a `bech32` address and send from it.\r\n\r\nFor some reason when I composed the transaction it picked change address with index 1 instead of with index 0. Is that an existing rule?\r\n\r\nWhat I also found confusing, though I don't know if that's this PR, or the other two or just existing weirdness, is how `dumpwallet` shows `p2sh-p2wpkh` addresses under `# addr`, even though I launched bitcoind with `-addresstype=bech32`.\r\n",
      "created_at" : "2018-09-13T17:57:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-421096615",
      "id" : 421096615,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyMTA5NjYxNQ==",
      "updated_at" : "2018-09-13T17:57:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/421096615",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> For some reason when I composed the transaction it picked change address with index 1 instead of with index 0. Is that an existing rule?\r\n\r\nMaybe your import command was weird? It should be adding them in the order of the import command so you should be getting them in that order too.",
      "created_at" : "2018-09-13T23:32:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-421184428",
      "id" : 421184428,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyMTE4NDQyOA==",
      "updated_at" : "2018-09-13T23:32:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/421184428",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r217565129"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217565129"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2018-09-13T23:36:09Z",
      "diff_hunk" : "@@ -446,6 +446,88 @@ def run_test (self):\n                 \"timestamp\": \"\",\n             }])\n \n+        # Importing multiple public keys with 2-of-2 p2sh multisig\n+        self.log.info(\"Pubkeys should be available after importing 2-of-2 p2sh multisig with pubkeys\")\n+        addr1 = self.nodes[1].getnewaddress()\n+        addr2 = self.nodes[1].getnewaddress()\n+        pub1 = self.nodes[1].getaddressinfo(addr1)['pubkey']\n+        pub2 = self.nodes[1].getaddressinfo(addr2)['pubkey']\n+        ms = self.nodes[1].createmultisig(2, [pub1, pub2])\n+        result = self.nodes[0].importmulti(\n+            [{\n+                'scriptPubKey' : { 'address' : ms['address']},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r217565129",
      "id" : 217565129,
      "in_reply_to_id" : 216212468,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNzU2NTEyOQ==",
      "original_commit_id" : "acb05a18202c86ab0635d850c63d4461258bbfd0",
      "original_position" : 13,
      "path" : "test/functional/wallet_importmulti.py",
      "position" : null,
      "pull_request_review_id" : 155310230,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217565129",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r221463595"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/221463595"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This `vData` shadows another local variable `vData` :-)",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2018-09-30T15:45:10Z",
      "diff_hunk" : "@@ -917,6 +928,58 @@ static UniValue ProcessImport(CWallet * const pwallet, const UniValue& data, con\n                 pwallet->SetAddressBook(dest, label, \"receive\");\n             }\n \n+            // Import public keys\n+            for (size_t i = 0; i < pubKeys.size(); ++i) {\n+                const std::string& pubkey = pubKeys[i].get_str();\n+\n+                if (!IsHex(pubkey)) {\n+                    throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Pubkey must be a hex string\");\n+                }\n+\n+                std::vector<unsigned char> vData(ParseHex(pubkey));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r221463595",
      "id" : 221463595,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMTQ2MzU5NQ==",
      "original_commit_id" : "5022a35a6b82aed509d1eccc87bcbeb3a0564e02",
      "original_position" : 37,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 160118937,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/221463595",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "What's a good way to inspect the wallet / keypool?",
      "created_at" : "2018-10-04T03:31:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-426873840",
      "id" : 426873840,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyNjg3Mzg0MA==",
      "updated_at" : "2018-10-04T03:31:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/426873840",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@Sjors You can use dumpwallet",
      "created_at" : "2018-10-04T12:16:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-426996508",
      "id" : 426996508,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyNjk5NjUwOA==",
      "updated_at" : "2018-10-04T12:16:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/426996508",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@achow101 `dumpwallet` doesn't contain the bip32 derivation paths though.\r\n\r\nI'll try with `getaddressinfo`.",
      "created_at" : "2018-10-05T03:50:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-427238139",
      "id" : 427238139,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyNzIzODEzOQ==",
      "updated_at" : "2018-10-17T08:34:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/427238139",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I will rework this to not require #14019 as soon as I have time (in a few days)",
      "created_at" : "2018-10-15T21:07:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-430013430",
      "id" : 430013430,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMDAxMzQzMA==",
      "updated_at" : "2018-10-15T21:07:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/430013430",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2018-10-31T17:02:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-434767720",
      "id" : 434767720,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNDc2NzcyMA==",
      "updated_at" : "2018-10-31T17:02:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/434767720",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Probably best rebased on #14491 or its predecessor.\r\n\r\nHere's my attempt at it: https://github.com/Sjors/bitcoin/tree/2018/11/watch-only-keypool\r\n* start with #14021 \r\n* cherry-pick 0abb0b28e76224fb5b163b29937b7a08ed60d20a, bcb8b4834ada2fcdbdcdeeed7cbc95ee0b81f9b0\r\n* manually cherry-pick bcb8b4834ada2fcdbdcdeeed7cbc95ee0b81f9b0\r\n\r\nIt seems to work for a simple case, but haven't thoroughly tested it.\r\n",
      "created_at" : "2018-11-05T12:18:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-435854838",
      "id" : 435854838,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNTg1NDgzOA==",
      "updated_at" : "2018-11-06T09:28:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/435854838",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased onto #14491",
      "created_at" : "2018-11-06T15:04:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-436284225",
      "id" : 436284225,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNjI4NDIyNQ==",
      "updated_at" : "2018-11-06T15:04:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/436284225",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've added two commits contributed by @instagibbs. The first one makes it so that things are imported in the order they are listed in the import command or in the order expanded for ranged descriptors. The second commit has watch keys imported to the keypool be marked as used when transactions are seen using them.",
      "created_at" : "2018-11-08T19:08:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-437119112",
      "id" : 437119112,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNzExOTExMg==",
      "updated_at" : "2018-11-08T19:08:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/437119112",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#14679](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14679.html) (importmulti: Don't add internal addresses to address book by instagibbs)\n* [#14565](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14565.html) (Overhaul importmulti logic by sipa)\n* [#14530](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14530.html) (Use RPCHelpMan to generate RPC doc strings by MarcoFalke)\n* [#14459](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14459.html) (More RPC help description fixes by ch4ot1c)\n* [#14411](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14411.html) ([wallet] Restore ability to list incoming transactions by label by ryanofsky)\n* [#14021](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14021.html) (Import key origin data through descriptors in importmulti by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2018-11-08T21:56:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-437170398",
      "id" : 437170398,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNzE3MDM5OA==",
      "updated_at" : "2018-11-08T21:56:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/437170398",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#14679](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14679.html) (importmulti: Don't add internal addresses to address book by instagibbs)\n* [#14565](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14565.html) (Overhaul importmulti logic by sipa)\n* [#14530](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14530.html) (Use RPCHelpMan to generate RPC doc strings by MarcoFalke)\n* [#14459](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14459.html) (More RPC help description fixes by ch4ot1c)\n* [#14411](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14411.html) ([wallet] Restore ability to list incoming transactions by label by ryanofsky)\n* [#14021](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14021.html) (Import key origin data through descriptors in importmulti by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2018-11-09T02:43:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-437231057",
      "id" : 437231057,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNzIzMTA1Nw==",
      "updated_at" : "2018-11-09T02:43:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/437231057",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#14679](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14679.html) (importmulti: Don't add internal addresses to address book by instagibbs)\n* [#14565](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14565.html) (Overhaul importmulti logic by sipa)\n* [#14530](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14530.html) (Use RPCHelpMan to generate RPC doc strings by MarcoFalke)\n* [#14459](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14459.html) (More RPC help description fixes by ch4ot1c)\n* [#14411](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14411.html) ([wallet] Restore ability to list incoming transactions by label by ryanofsky)\n* [#14021](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14021.html) (Import key origin data through descriptors in importmulti by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2018-11-09T06:04:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-437259799",
      "id" : 437259799,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNzI1OTc5OQ==",
      "updated_at" : "2018-11-09T06:04:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/437259799",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r232173938"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/232173938"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Could use `std::any_of`? :-)",
      "commit_id" : "7825ab29eed672cdbddf8479c880322e4d5e311f",
      "created_at" : "2018-11-09T08:33:57Z",
      "diff_hunk" : "@@ -804,233 +805,368 @@ UniValue dumpwallet(const JSONRPCRequest& request)\n     return reply;\n }\n \n-\n-static UniValue ProcessImport(CWallet * const pwallet, const UniValue& data, const int64_t timestamp) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+struct ImportData\n {\n-    try {\n-        // First ensure scriptPubKey has either a script or JSON with \"address\" string\n-        const UniValue& scriptPubKey = data[\"scriptPubKey\"];\n-        bool isScript = scriptPubKey.getType() == UniValue::VSTR;\n-        if (!isScript && !(scriptPubKey.getType() == UniValue::VOBJ && scriptPubKey.exists(\"address\"))) {\n-            throw JSONRPCError(RPC_INVALID_PARAMETER, \"scriptPubKey must be string with script or JSON with address string\");\n+    // Input data\n+    std::unique_ptr<CScript> redeemscript; //! Provided redeemScript; will be mvoed to `import_scripts` if relevant.\n+    std::unique_ptr<CScript> witnessscript; //! Provided witnessScript; will be moved to `import_scripts` if relevant.\n+    std::map<CKeyID, CPubKey> pubkeys;\n+    std::vector<CPubKey> ordered_pubkeys; //! Used to track ordering of insertion of pubkeys\n+    std::map<CKeyID, CKey> privkeys;\n+\n+    // Output data\n+    std::vector<CScript> script_pub_keys;\n+    std::vector<CScript> import_scripts;\n+    std::set<CKeyID> used_keys; // Import these private keys if available\n+    std::set<CKeyID> require_keys; // Fail if these public keys are not available\n+};\n+\n+enum class ScriptContext\n+{\n+    TOP, //! Top-level scriptPubKey\n+    P2SH, //! P2SH redeemScript\n+    WITNESS_V0, //! P2WSH witnessScript\n+};\n+\n+// Analyse the provided script, process the import data accordinging, and recurse into subscripts if necessary.\n+// Returns an error string, or the empty string for success.\n+static std::string RecurseImportData(const CScript& script, ImportData& data, ScriptContext ctx)\n+{\n+    // Use Solver to obtain script type and parsed pubkeys or hashes:\n+    std::vector<std::vector<unsigned char>> solverdata;\n+    txnouttype script_type = Solver(script, solverdata);\n+\n+    switch (script_type) {\n+    case TX_PUBKEY: {\n+        CPubKey pubkey(solverdata[0].begin(), solverdata[0].end());\n+        data.used_keys.emplace(pubkey.GetID());\n+        break;\n+    }\n+    case TX_PUBKEYHASH: {\n+        CKeyID id = CKeyID(uint160(solverdata[0]));\n+        data.require_keys.emplace(id);\n+        data.used_keys.emplace(id);\n+        break;\n+    }\n+    case TX_SCRIPTHASH: {\n+        if (ctx == ScriptContext::P2SH) throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Trying to nest P2SH inside another P2SH\");\n+        if (ctx == ScriptContext::WITNESS_V0) throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Trying to nest P2SH inside a P2WSH\");\n+        CScriptID id = CScriptID(uint160(solverdata[0]));\n+        auto subscript = std::move(data.redeemscript);\n+        if (!subscript) return \"missing redeemscript\";\n+        if (CScriptID(*subscript) != id) return \"redeemScript does not match the scriptPubKey\";\n+        data.import_scripts.emplace_back(*subscript);\n+        RecurseImportData(*subscript, data, ScriptContext::P2SH);\n+        break;\n+    }\n+    case TX_MULTISIG: {\n+        for (size_t i = 1; i + 1< solverdata.size(); ++i) {\n+            CPubKey pubkey(solverdata[i].begin(), solverdata[i].end());\n+            data.used_keys.emplace(pubkey.GetID());\n         }\n-        const std::string& output = isScript ? scriptPubKey.get_str() : scriptPubKey[\"address\"].get_str();\n-\n-        // Optional fields.\n-        const std::string& strRedeemScript = data.exists(\"redeemscript\") ? data[\"redeemscript\"].get_str() : \"\";\n-        const std::string& witness_script_hex = data.exists(\"witnessscript\") ? data[\"witnessscript\"].get_str() : \"\";\n-        const UniValue& pubKeys = data.exists(\"pubkeys\") ? data[\"pubkeys\"].get_array() : UniValue();\n-        const UniValue& keys = data.exists(\"keys\") ? data[\"keys\"].get_array() : UniValue();\n-        const bool internal = data.exists(\"internal\") ? data[\"internal\"].get_bool() : false;\n-        const bool watchOnly = data.exists(\"watchonly\") ? data[\"watchonly\"].get_bool() : false;\n-        const std::string& label = data.exists(\"label\") ? data[\"label\"].get_str() : \"\";\n-\n-        // Generate the script and destination for the scriptPubKey provided\n-        CScript script;\n-        CTxDestination dest;\n-\n-        if (!isScript) {\n-            dest = DecodeDestination(output);\n-            if (!IsValidDestination(dest)) {\n-                throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Invalid address\");\n-            }\n-            script = GetScriptForDestination(dest);\n-        } else {\n-            if (!IsHex(output)) {\n-                throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Invalid scriptPubKey\");\n-            }\n+        break;\n+    }\n+    case TX_WITNESS_V0_SCRIPTHASH: {\n+        if (ctx == ScriptContext::WITNESS_V0) throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Trying to nest P2WSH inside another P2WSH\");\n+        uint256 fullid(solverdata[0]);\n+        CScriptID id;\n+        CRIPEMD160().Write(fullid.begin(), fullid.size()).Finalize(id.begin());\n+        auto subscript = std::move(data.witnessscript);\n+        if (!subscript) return \"missing witnessscript\";\n+        if (CScriptID(*subscript) != id) return \"witnessScript does not match the scriptPubKey or redeemScript\";\n+        data.import_scripts.emplace_back(script); // Special rule for IsMine: native P2WSH requires the full script imported\n+        data.import_scripts.emplace_back(*subscript);\n+        RecurseImportData(*subscript, data, ScriptContext::WITNESS_V0);\n+        break;\n+    }\n+    case TX_WITNESS_V0_KEYHASH: {\n+        if (ctx == ScriptContext::WITNESS_V0) throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Trying to nest P2WPKH inside P2WSH\");\n+        CKeyID id = CKeyID(uint160(solverdata[0]));\n+        data.require_keys.emplace(id);\n+        data.used_keys.emplace(id);\n+        data.import_scripts.emplace_back(script); // Special rule for IsMine: native P2WPKH requires the full script imported\n+        break;\n+    }\n+    default:\n+        return \"nonstandard script\";\n+    }\n+    return \"\";\n+}\n \n-            std::vector<unsigned char> vData(ParseHex(output));\n-            script = CScript(vData.begin(), vData.end());\n-            if (!ExtractDestination(script, dest) && !internal) {\n-                throw JSONRPCError(RPC_INVALID_PARAMETER, \"Internal must be set to true for nonstandard scriptPubKey imports.\");\n-            }\n+static UniValue ProcessImportLegacy(ImportData& import_data, const UniValue& data, bool& watch_only)\n+{\n+    // First ensure scriptPubKey has either a script or JSON with \"address\" string\n+    const UniValue& scriptPubKey = data[\"scriptPubKey\"];\n+    bool isScript = scriptPubKey.getType() == UniValue::VSTR;\n+    if (!isScript && !(scriptPubKey.getType() == UniValue::VOBJ && scriptPubKey.exists(\"address\"))) {\n+        throw JSONRPCError(RPC_INVALID_PARAMETER, \"scriptPubKey must be string with script or JSON with address string\");\n+    }\n+    const std::string& output = isScript ? scriptPubKey.get_str() : scriptPubKey[\"address\"].get_str();\n+\n+    // Optional fields.\n+    const std::string& strRedeemScript = data.exists(\"redeemscript\") ? data[\"redeemscript\"].get_str() : \"\";\n+    const std::string& witness_script_hex = data.exists(\"witnessscript\") ? data[\"witnessscript\"].get_str() : \"\";\n+    const UniValue& pubKeys = data.exists(\"pubkeys\") ? data[\"pubkeys\"].get_array() : UniValue();\n+    const UniValue& keys = data.exists(\"keys\") ? data[\"keys\"].get_array() : UniValue();\n+    const bool internal = data.exists(\"internal\") ? data[\"internal\"].get_bool() : false;\n+\n+    // Generate the script and destination for the scriptPubKey provided\n+    CScript script;\n+    CTxDestination dest;\n+    if (!isScript) {\n+        dest = DecodeDestination(output);\n+        if (!IsValidDestination(dest)) {\n+            throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Invalid address\");\n         }\n-\n-        // Watchonly and private keys\n-        if (watchOnly && keys.size()) {\n-            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Watch-only addresses should not include private keys\");\n+        script = GetScriptForDestination(dest);\n+    } else {\n+        if (!IsHex(output)) {\n+            throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Invalid scriptPubKey\");\n         }\n-\n-        // Internal addresses should not have a label\n-        if (internal && data.exists(\"label\")) {\n-            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Internal addresses should not have a label\");\n+        std::vector<unsigned char> vData(ParseHex(output));\n+        script = CScript(vData.begin(), vData.end());\n+        if (!ExtractDestination(script, dest) && !internal) {\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Internal must be set to true for nonstandard scriptPubKey imports.\");\n         }\n+    }\n+    import_data.script_pub_keys.emplace_back(script);\n \n-        // Force users to provide the witness script in its field rather than redeemscript\n-        if (!strRedeemScript.empty() && script.IsPayToWitnessScriptHash()) {\n-            throw JSONRPCError(RPC_INVALID_PARAMETER, \"P2WSH addresses have an empty redeemscript. Please provide the witnessscript instead.\");\n+    // Parse all arguments\n+    if (strRedeemScript.size()) {\n+        if (!IsHex(strRedeemScript)) {\n+            throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Invalid redeem script: must be hex string\");\n         }\n-\n-        CScript scriptpubkey_script = script;\n-        CTxDestination scriptpubkey_dest = dest;\n-        bool allow_p2wpkh = true;\n-\n-        // P2SH\n-        if (!strRedeemScript.empty() && script.IsPayToScriptHash()) {\n-            // Check the redeemScript is valid\n-            if (!IsHex(strRedeemScript)) {\n-                throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Invalid redeem script: must be hex string\");\n-            }\n-\n-            // Import redeem script.\n-            std::vector<unsigned char> vData(ParseHex(strRedeemScript));\n-            CScript redeemScript = CScript(vData.begin(), vData.end());\n-            CScriptID redeem_id(redeemScript);\n-\n-            // Check that the redeemScript and scriptPubKey match\n-            if (GetScriptForDestination(redeem_id) != script) {\n-                throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"The redeemScript does not match the scriptPubKey\");\n-            }\n-\n-            pwallet->MarkDirty();\n-\n-            if (!pwallet->AddWatchOnly(redeemScript, timestamp)) {\n-                throw JSONRPCError(RPC_WALLET_ERROR, \"Error adding address to wallet\");\n-            }\n-\n-            if (!pwallet->HaveCScript(redeem_id) && !pwallet->AddCScript(redeemScript)) {\n-                throw JSONRPCError(RPC_WALLET_ERROR, \"Error adding p2sh redeemScript to wallet\");\n-            }\n-\n-            // Now set script to the redeemScript so we parse the inner script as P2WSH or P2WPKH below\n-            script = redeemScript;\n-            ExtractDestination(script, dest);\n+        auto parsed_redeemscript = ParseHex(strRedeemScript);\n+        import_data.redeemscript = MakeUnique<CScript>(parsed_redeemscript.begin(), parsed_redeemscript.end());\n+    }\n+    if (witness_script_hex.size()) {\n+        if (!IsHex(witness_script_hex)) {\n+            throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Invalid witness script: must be hex string\");\n         }\n+        auto parsed_witnessscript = ParseHex(witness_script_hex);\n+        import_data.witnessscript = MakeUnique<CScript>(parsed_witnessscript.begin(), parsed_witnessscript.end());\n+    }\n+    for (size_t i = 0; i < pubKeys.size(); ++i) {\n+        const auto& str = pubKeys[i].get_str();\n+        if (!IsHex(str)) {\n+            throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Pubkey must be a hex string\");\n+        }\n+        auto parsed_pubkey = ParseHex(str);\n+        CPubKey pubkey(parsed_pubkey.begin(), parsed_pubkey.end());\n+        if (!pubkey.IsFullyValid()) {\n+            throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Pubkey is not a valid public key\");\n+        }\n+        import_data.pubkeys.emplace(pubkey.GetID(), pubkey);\n+        import_data.ordered_pubkeys.emplace_back(pubkey);\n+    }\n+    for (size_t i = 0; i < keys.size(); ++i) {\n+        const auto& str = keys[i].get_str();\n+        CKey key = DecodeSecret(str);\n+        if (!key.IsValid()) {\n+            throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Invalid private key encoding\");\n+        }\n+        CPubKey pubkey = key.GetPubKey();\n+        CKeyID id = pubkey.GetID();\n+        if (import_data.pubkeys.count(id)) {\n+            throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Both public and private key specified for \" + HexStr(pubkey.begin(), pubkey.end()));\n+        }\n+        import_data.privkeys.emplace(id, key);\n+    }\n \n-        // (P2SH-)P2WSH\n-        if (!witness_script_hex.empty() && script.IsPayToWitnessScriptHash()) {\n-            if (!IsHex(witness_script_hex)) {\n-                throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Invalid witness script: must be hex string\");\n-            }\n-\n-            // Generate the scripts\n-            std::vector<unsigned char> witness_script_parsed(ParseHex(witness_script_hex));\n-            CScript witness_script = CScript(witness_script_parsed.begin(), witness_script_parsed.end());\n-            CScriptID witness_id(witness_script);\n+    // Warn about inconsistencies between watch_only and provided keys/scripts\n+    UniValue warnings(UniValue::VARR);\n+    bool have_solving_data = import_data.redeemscript || import_data.witnessscript || import_data.pubkeys.size() || import_data.privkeys.size();\n+    if (watch_only && have_solving_data) {\n+        warnings.push_back(\"redeemscript, witnessscript, keys, and pubkeys are ignored when watchonly is set.\");\n+    }\n+    if (!watch_only && !have_solving_data) {\n+        warnings.push_back(\"Assuming watchonly as no redeemscript, witnessscript, keys, or pubkeys are provided.\");\n+        watch_only = true;\n+    }\n \n-            // Check that the witnessScript and scriptPubKey match\n-            if (GetScriptForDestination(WitnessV0ScriptHash(witness_script)) != script) {\n-                throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"The witnessScript does not match the scriptPubKey or redeemScript\");\n-            }\n+    // Force users to provide the witness script in its field rather than redeemscript\n+    if (!strRedeemScript.empty() && script.IsPayToWitnessScriptHash()) {\n+        throw JSONRPCError(RPC_INVALID_PARAMETER, \"P2WSH addresses have an empty redeemscript. Please provide the witnessscript instead.\");\n+    }\n \n-            // Add the witness script as watch only only if it is not for P2SH-P2WSH\n-            if (!scriptpubkey_script.IsPayToScriptHash() && !pwallet->AddWatchOnly(witness_script, timestamp)) {\n-                throw JSONRPCError(RPC_WALLET_ERROR, \"Error adding address to wallet\");\n-            }\n+    // Verify and process input data\n+    if (!watch_only) {\n+        // Match up data in import_data with the scriptPubKey in script.\n+        auto error = RecurseImportData(script, import_data, ScriptContext::TOP);\n \n-            if (!pwallet->HaveCScript(witness_id) && !pwallet->AddCScript(witness_script)) {\n-                throw JSONRPCError(RPC_WALLET_ERROR, \"Error adding p2wsh witnessScript to wallet\");\n+        // Check that all required keys for solvability are provided.\n+        if (error.empty()) {\n+            for (const auto& require_key : import_data.require_keys) {\n+                if (import_data.pubkeys.count(require_key) == 0 && import_data.privkeys.count(require_key) == 0) {\n+                    throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Key does not match address destination\");\n+                }\n             }\n-\n-            // Now set script to the witnessScript so we parse the inner script as P2PK or P2PKH below\n-            script = witness_script;\n-            ExtractDestination(script, dest);\n-            allow_p2wpkh = false; // P2WPKH cannot be embedded in P2WSH\n         }\n \n-        // (P2SH-)P2PK/P2PKH/P2WPKH\n-        if (dest.type() == typeid(CKeyID) || dest.type() == typeid(WitnessV0KeyHash)) {\n-            if (!allow_p2wpkh && dest.type() == typeid(WitnessV0KeyHash)) {\n-                throw JSONRPCError(RPC_INVALID_PARAMETER, \"P2WPKH cannot be embedded in P2WSH\");\n-            }\n-            if (keys.size() > 1 || pubKeys.size() > 1) {\n-                throw JSONRPCError(RPC_INVALID_PARAMETER, \"More than one key given for one single-key address\");\n-            }\n-            CPubKey pubkey;\n-            if (keys.size()) {\n-                pubkey = DecodeSecret(keys[0].get_str()).GetPubKey();\n-            }\n-            if (pubKeys.size()) {\n-                const std::string& strPubKey = pubKeys[0].get_str();\n-                if (!IsHex(strPubKey)) {\n-                    throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Pubkey must be a hex string\");\n-                }\n-                std::vector<unsigned char> vData(ParseHex(pubKeys[0].get_str()));\n-                CPubKey pubkey_temp(vData.begin(), vData.end());\n-                if (pubkey.size() && pubkey_temp != pubkey) {\n-                    throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Private key does not match public key for address\");\n+        if (!error.empty()) {\n+            warnings.push_back(\"Ignoring information in keys, pubkeys, redeemscript, and witnessscript:: \" + error);\n+            import_data = ImportData();\n+        } else {\n+            // RecurseImportData() removes any relevant redeemscript/witnessscript from import_data, so we can use that to discover if a superfluous one was provided.\n+            if (import_data.redeemscript) warnings.push_back(\"Ignoring redeemscript \" + strRedeemScript + \" as this is not a P2SH script.\");\n+            if (import_data.witnessscript) warnings.push_back(\"Ignoring witnessscript \" + witness_script_hex + \" as this is not a P2WSH script.\");\n+            for (const auto& privkey : import_data.privkeys) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r232173938",
      "id" : 232173938,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMjE3MzkzOA==",
      "original_commit_id" : "7825ab29eed672cdbddf8479c880322e4d5e311f",
      "original_position" : 347,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 347,
      "pull_request_review_id" : 173312988,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2018-11-09T08:33:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/232173938",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#14021](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14021.html) (Import key origin data through descriptors in importmulti by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2018-11-09T09:30:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-437302117",
      "id" : 437302117,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNzMwMjExNw==",
      "updated_at" : "2019-02-10T23:39:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/437302117",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2018-11-13T17:41:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-438366740",
      "id" : 438366740,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzODM2Njc0MA==",
      "updated_at" : "2018-11-13T17:41:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/438366740",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Light utACK https://github.com/bitcoin/bitcoin/pull/14075/commits/8e6b7bd5e9aeb8efe85068de8fc38cf0b22f1185\r\n\r\nWill review more in-depth after the dependent PRs are merged and this is rebased",
      "created_at" : "2018-11-16T10:29:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-439351070",
      "id" : 439351070,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzOTM1MTA3MA==",
      "updated_at" : "2018-11-16T10:29:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/439351070",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think we should make `keypoolrefill` and `TopUpKeyPool` work with just public keys.\r\n\r\nWhen `WALLET_FLAG_DISABLE_PRIVATE_KEYS` is set we can skip the `EnsureWalletIsUnlocked(pwallet)` check.\r\n\r\n`TopUpKeyPool` currently only creates random fresh keys (for legacy wallets) or derives new keys from the wallet HD seed. We could change it to first walk through `solvable` keys in the wallet.\r\n\r\nFor safety we could prevent it from putting keys without private keys into the keypool for wallets without `WALLET_FLAG_DISABLE_PRIVATE_KEYS`.\r\n\r\nIn that case we don't need the `keypool` option in `importmulti`.\r\n\r\nThis might make it easier to refactor towards a descriptor based wallet without a _global_ keypool (cc @sipa), because we avoid adding another code path where stuff can be added to the keypool. In such a refactor a RPC method like `getnewaddress` will have to reference a descriptor. That would be the wallet receive descriptor by default. `importmulti` would then be able to set the wallet receive descriptor (in case the wallet is empty). It doesn't do keypool management stuff.\r\n\r\nThis would also let you create a new wallet without keys and then import private keys yourself via importmulti, something that currently doesn't work (at least not with `getnewaddress` and the GUI equivalent).",
      "created_at" : "2018-12-12T11:01:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-446547958",
      "id" : 446547958,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NjU0Nzk1OA==",
      "updated_at" : "2018-12-12T11:17:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/446547958",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased.\r\n\r\nI dropped the last commit as #14821 should handle that.",
      "created_at" : "2018-12-16T19:36:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-447669564",
      "id" : 447669564,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NzY2OTU2NA==",
      "updated_at" : "2018-12-16T19:36:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/447669564",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2018-12-24T12:22:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-449727701",
      "id" : 449727701,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0OTcyNzcwMQ==",
      "updated_at" : "2018-12-24T12:22:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/449727701",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased",
      "created_at" : "2018-12-24T15:29:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-449746795",
      "id" : 449746795,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0OTc0Njc5NQ==",
      "updated_at" : "2018-12-24T15:29:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/449746795",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've added a commit which fixed an issue where the `Request payment` button was not being enabled once keys were imported to the keypool. That commit sends a signal to the GUI every time the keypool changes so that the button will be enabled and disabled as there keys are added and removed from the keypool.",
      "created_at" : "2019-01-18T22:10:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-455704126",
      "id" : 455704126,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NTcwNDEyNg==",
      "updated_at" : "2019-01-18T22:10:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/455704126",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I split out 28c89d1 into it's own PR: #15225",
      "created_at" : "2019-01-22T00:01:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-456228317",
      "id" : 456228317,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NjIyODMxNw==",
      "updated_at" : "2019-01-22T00:01:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/456228317",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "In light of #15226 (specifically the test comment \"Imported private keys are currently ignored by the keypool\") I'd like to revisit my [earlier remark](\r\nhttps://github.com/bitcoin/bitcoin/pull/14075#issuecomment-446547958):\r\n\r\nI'd like to avoid messing with the keypool inside of `importmulti`. Instead I would prefer if `TopUpKeyPool` can deal with imported keys.\r\n\r\n> `TopUpKeyPool` currently only creates random fresh keys (for legacy wallets) or derives new keys from the wallet HD seed. We could change it to first walk through solvable keys in the wallet.\r\n\r\n> In that case we don't need the `keypool` option in `importmulti`.",
      "created_at" : "2019-01-22T17:54:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-456497278",
      "id" : 456497278,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NjQ5NzI3OA==",
      "updated_at" : "2019-01-22T17:58:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/456497278",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK\r\n\r\nIdeally Ã¢ÂÂ but orthogonal to this PR Ã¢ÂÂ would be if someone could provide a xpub or range based descriptor during sethdseed (or new command) that would make the keypool act similar to the default HD keypool but derive watch only pub keys.",
      "created_at" : "2019-01-29T20:19:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-458691861",
      "id" : 458691861,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1ODY5MTg2MQ==",
      "updated_at" : "2019-01-29T20:19:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/458691861",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Tested a4bd25d, import works and GUI new address button updates as expected.",
      "created_at" : "2019-01-31T20:24:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-459492568",
      "id" : 459492568,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1OTQ5MjU2OA==",
      "updated_at" : "2019-01-31T20:24:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/459492568",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : ">  if someone could provide a xpub or range based descriptor during sethdseed (or new command) that would make the keypool act similar to the default HD keypool but derive watch only pub keys.\r\n\r\nI would prefer to hold off on that until we have a descriptor based wallet, which would make that trivial.\r\n\r\nIn the mean time you can set the import range argument for the descriptor extremely long for a (probably) good enough result.",
      "created_at" : "2019-01-31T20:27:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-459493527",
      "id" : 459493527,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1OTQ5MzUyNw==",
      "updated_at" : "2019-01-31T20:27:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/459493527",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I had some difficulty combining this with #15226 (blank wallet) and made a commit that does that, poorly: https://github.com/Sjors/bitcoin/commit/8988a96e2eff8bd6344f9e93032e86742e7dc3f8\r\nHowever, the blank wallet PR has since changed again, so my commit is merely useful for inspiration and some extra tests. Don't let it hold back merging here.\r\n\r\nI had to choose between the two PR's, I prefer this one, because it's needed for [HWI](https://github.com/bitcoin-core/HWI).",
      "created_at" : "2019-02-09T11:45:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-462037542",
      "id" : 462037542,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MjAzNzU0Mg==",
      "updated_at" : "2019-02-09T12:00:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/462037542",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I don't think we can get both this and #14021 in to 0.18 so I'll remove this from the milestone",
      "created_at" : "2019-02-09T15:58:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-462055828",
      "id" : 462055828,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MjA1NTgyOA==",
      "updated_at" : "2019-02-09T15:58:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/462055828",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've actually decided to base this on #15226. In the version of #15226, I introduced `CanGetAddresses` and `CanGenerateKeys` which I am using here for determining whether there are things in the keypool to fetch keys instead of `NoPrivkeysAndKeypoolEmpty` (which did a similar thing but was less robust). Because of this, I have also replaced `WalletModel::privateKeysDisabled` with `canGetaddresses`.",
      "created_at" : "2019-02-09T19:51:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-462074050",
      "id" : 462074050,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MjA3NDA1MA==",
      "updated_at" : "2019-02-09T19:51:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/462074050",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r255345358"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255345358"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: `assert_equal(wrpc.getwalletinfo()[\"keypoolsize\"],2)`",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2019-02-10T16:52:48Z",
      "diff_hunk" : "@@ -625,6 +625,74 @@ def run_test(self):\n                      ismine=False,\n                      iswatchonly=False)\n \n+        # Import some public keys to the keypool of a no privkey wallet\n+        self.log.info(\"Adding pubkey to keypool of disableprivkey wallet\")\n+        self.nodes[1].createwallet(wallet_name=\"noprivkeys\", disable_private_keys=True)\n+        wrpc = self.nodes[1].get_wallet_rpc(\"noprivkeys\")\n+\n+        addr1 = self.nodes[0].getnewaddress()\n+        addr2 = self.nodes[0].getnewaddress()\n+        pub1 = self.nodes[0].getaddressinfo(addr1)['pubkey']\n+        pub2 = self.nodes[0].getaddressinfo(addr2)['pubkey']\n+        result = wrpc.importmulti(\n+            [{\n+                'desc': 'wpkh(' + pub1 + ')',\n+                'keypool': True,\n+                \"timestamp\": \"now\",\n+            },\n+            {\n+                'desc': 'wpkh(' + pub2 + ')',\n+                'keypool': True,\n+                \"timestamp\": \"now\",\n+            }]\n+        )\n+        assert result[0]['success']\n+        assert result[1]['success']\n+        newaddr1 = wrpc.getnewaddress()\n+        assert_equal(addr1, newaddr1)\n+        newaddr2 = wrpc.getnewaddress()\n+        assert_equal(addr2, newaddr2)\n+\n+        # Import some public keys to the internal keypool of a no privkey wallet\n+        self.log.info(\"Adding pubkey to internal keypool of disableprivkey wallet\")\n+        addr1 = self.nodes[0].getnewaddress()\n+        addr2 = self.nodes[0].getnewaddress()\n+        pub1 = self.nodes[0].getaddressinfo(addr1)['pubkey']\n+        pub2 = self.nodes[0].getaddressinfo(addr2)['pubkey']\n+        result = wrpc.importmulti(\n+            [{\n+                'desc': 'wpkh(' + pub1 + ')',\n+                'keypool': True,\n+                'internal': True,\n+                \"timestamp\": \"now\",\n+            },\n+            {\n+                'desc': 'wpkh(' + pub2 + ')',\n+                'keypool': True,\n+                'internal': True,\n+                \"timestamp\": \"now\",\n+            }]\n+        )\n+        assert result[0]['success']\n+        assert result[1]['success']",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r255345358",
      "id" : 255345358,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTM0NTM1OA==",
      "original_commit_id" : "7369e1a459bd0a033ad0e83f340bb0e05ca49566",
      "original_position" : 53,
      "path" : "test/functional/wallet_importmulti.py",
      "position" : 62,
      "pull_request_review_id" : 201911575,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255345358",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r255346203"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255346203"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: update documentation and argument name for `setHDStatus`.",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2019-02-10T17:15:34Z",
      "diff_hunk" : "@@ -1202,7 +1202,7 @@ void BitcoinGUI::updateWalletStatus()\n     }\n     WalletModel * const walletModel = walletView->getWalletModel();\n     setEncryptionStatus(walletModel->getEncryptionStatus());\n-    setHDStatus(walletModel->privateKeysDisabled(), walletModel->wallet().hdEnabled());\n+    setHDStatus(!walletModel->canGetAddresses(), walletModel->wallet().hdEnabled());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r255346203",
      "id" : 255346203,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTM0NjIwMw==",
      "original_commit_id" : "5c73073d18df77226cf49ea2de8efc946ed4476d",
      "original_position" : 5,
      "path" : "src/qt/bitcoingui.cpp",
      "position" : null,
      "pull_request_review_id" : 201911575,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255346203",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r255347804"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255347804"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is weird; whether we treat watch-only balances as ours shouldn't depend on if the keypool is empty. The original `privateKeysDisabled()` is more appropriate, because it's the only wallet type where we can be certain no private keys will be added at any time (saving us from having to deal with a bunch of UI glitches described below). \r\n\r\nFortunately you need to do something fairly contrived to make it misbehave:\r\n\r\nUsing my patch that allows adding private keys to the keypool, create a blank wallet with private keys enabled and import:\r\n\r\n```\r\n importmulti '[{\"desc\": \"sh(wpkh(tprv8ZgxMBicQKsPeuVhWwi6wuMQGfPKi9Li5GtX35jVNknACgqe3CY4g5xgkfDDJcmtF7o1QnxWDRYw4H5P26PXq7sbcUkEqeR4fg3Kxp2tigg/0h/0h/*))\", \"range\": {\"end\": 2},  \"keys\": [\"cSWSqykYtfkrWQ5FX6rCQPEME9iBaJcpqAgsCBeJDGQdrdS8V6G4\", \"cUHbt88Mu51u2Wz4xfuEPYCiAiNFRzuNZqDEDVGfGSz12DvPMRJu\", \"cPR5WCsjJr5vM3BTcwUji7u9fCW5pQPMsywS1fCxPbe4bf2XJEKG\"], \"timestamp\": \"now\", \"keypool\": true}]'\r\n```\r\n\r\nI sent testnet coins to the first two of those keys. This means the keypool should be 1.\r\n\r\nNow add a watch-only address:\r\n\r\n```\r\nimportmulti '[{\"desc\": \"sh(wpkh(tpubD6NzVbkrYhZ4YNXVQbNhMK1WqguFsUXceaVJKbmno2aZ3B6QfbMeraaYvnBSGpV3vxLyTTK9DYT1yoEck4XUScMzXoQ2U2oSmE2JyMedq3H/0h/0h/*))\", \"range\": {\"start\": 3, \"end\": 3}, \"timestamp\": \"now\", \"keypool\": true, \"watchonly\": true}]'\r\n```\r\n\r\nRestart QT and notice there's a watch-only column. Generate addresses to deplete the keypool and restart QT, notice the watch-only column goes away and your balance now shows zero.\r\n\r\nThere's a few other QT glitches too, but not necessarily new:\r\n* balances don't update after `importmulti`, you have to restart QT\r\n* HD indicated doesn't update",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2019-02-10T17:55:34Z",
      "diff_hunk" : "@@ -161,7 +161,7 @@ void OverviewPage::setBalance(const interfaces::WalletBalances& balances)\n {\n     int unit = walletModel->getOptionsModel()->getDisplayUnit();\n     m_balances = balances;\n-    if (walletModel->privateKeysDisabled()) {\n+    if (!walletModel->canGetAddresses()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r255347804",
      "id" : 255347804,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTM0NzgwNA==",
      "original_commit_id" : "5c73073d18df77226cf49ea2de8efc946ed4476d",
      "original_position" : 5,
      "path" : "src/qt/overviewpage.cpp",
      "position" : null,
      "pull_request_review_id" : 201911575,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255347804",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r255348169"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255348169"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same as above, but even more rare.",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2019-02-10T18:06:26Z",
      "diff_hunk" : "@@ -184,7 +184,7 @@ void OverviewPage::setBalance(const interfaces::WalletBalances& balances)\n     // for symmetry reasons also show immature label when the watch-only one is shown\n     ui->labelImmature->setVisible(showImmature || showWatchOnlyImmature);\n     ui->labelImmatureText->setVisible(showImmature || showWatchOnlyImmature);\n-    ui->labelWatchImmature->setVisible(!walletModel->privateKeysDisabled() && showWatchOnlyImmature); // show watch-only immature balance\n+    ui->labelWatchImmature->setVisible(walletModel->canGetAddresses() && showWatchOnlyImmature); // show watch-only immature balance",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r255348169",
      "id" : 255348169,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTM0ODE2OQ==",
      "original_commit_id" : "5c73073d18df77226cf49ea2de8efc946ed4476d",
      "original_position" : 14,
      "path" : "src/qt/overviewpage.cpp",
      "position" : null,
      "pull_request_review_id" : 201911575,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255348169",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r255348210"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255348210"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: drop / tweak \"Private keys are disabled for this wallet.\"",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2019-02-10T18:07:36Z",
      "diff_hunk" : "@@ -2756,7 +2756,7 @@ bool CWallet::CreateTransaction(interfaces::Chain::Lock& locked_chain, const std\n                 //  post-backup change.\n \n                 // Reserve a new key pair from key pool\n-                if (IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS)) {\n+                if (!CanGetAddresses(true)) {\n                     strFailReason = _(\"Can't generate a change-address key. Private keys are disabled for this wallet.\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r255348210",
      "id" : 255348210,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTM0ODIxMA==",
      "original_commit_id" : "5c73073d18df77226cf49ea2de8efc946ed4476d",
      "original_position" : 6,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 201911575,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255348210",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r255348392"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255348392"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit, add `HasHDSeed()` to complement `IsHDEnabled()`, and make it more clear what you're checking:\r\n```cpp\r\n// All WALLET_FLAG_DISABLE_PRIVATE_KEYS wallets were created after HD_SPLIT was added.\r\nconst bool fSupportsInternal = (HasHDSeed() && IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS)) || CanSupportFeature(FEATURE_HD_SPLIT)\r\nbool fReturningInternal = fRequestedInternal & fSupportsInternal;\r\n```",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2019-02-10T18:12:29Z",
      "diff_hunk" : "@@ -3417,7 +3417,8 @@ bool CWallet::ReserveKeyFromKeyPool(int64_t& nIndex, CKeyPool& keypool, bool fRe\n         if (!IsLocked())\n             TopUpKeyPool();\n \n-        bool fReturningInternal = IsHDEnabled() && CanSupportFeature(FEATURE_HD_SPLIT) && fRequestedInternal;\n+        bool fReturningInternal = fRequestedInternal;\n+        fReturningInternal &= (IsHDEnabled() && CanSupportFeature(FEATURE_HD_SPLIT)) || IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r255348392",
      "id" : 255348392,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTM0ODM5Mg==",
      "original_commit_id" : "5c73073d18df77226cf49ea2de8efc946ed4476d",
      "original_position" : 15,
      "path" : "src/wallet/wallet.cpp",
      "position" : 69,
      "pull_request_review_id" : 201911575,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255348392",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r255349233"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255349233"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: call this new function from `TopUpKeyPool`, so it's more clear this function reuses existing code. It could take a `error_message` and an optional `WalletBatch` argument. If `WalletBatch` is set it should skip `NotifyCanGetAddressesChanged()`, though that gets a bit ugly.",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2019-02-10T18:34:15Z",
      "diff_hunk" : "@@ -993,6 +993,7 @@ class CWallet final : public CCryptoKeyStore, public CValidationInterface\n     bool NewKeyPool();\n     size_t KeypoolCountExternalKeys() EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n     bool TopUpKeyPool(unsigned int kpSize = 0);\n+    void AddKeypoolPubkey(const CPubKey& pubkey, const bool internal);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r255349233",
      "id" : 255349233,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTM0OTIzMw==",
      "original_commit_id" : "dffff150e98fc96c98e9e8caf40cec7391bbebfb",
      "original_position" : 4,
      "path" : "src/wallet/wallet.h",
      "position" : 4,
      "pull_request_review_id" : 201911575,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255349233",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r255354746"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255354746"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2019-02-10T20:43:41Z",
      "diff_hunk" : "@@ -625,6 +625,74 @@ def run_test(self):\n                      ismine=False,\n                      iswatchonly=False)\n \n+        # Import some public keys to the keypool of a no privkey wallet\n+        self.log.info(\"Adding pubkey to keypool of disableprivkey wallet\")\n+        self.nodes[1].createwallet(wallet_name=\"noprivkeys\", disable_private_keys=True)\n+        wrpc = self.nodes[1].get_wallet_rpc(\"noprivkeys\")\n+\n+        addr1 = self.nodes[0].getnewaddress()\n+        addr2 = self.nodes[0].getnewaddress()\n+        pub1 = self.nodes[0].getaddressinfo(addr1)['pubkey']\n+        pub2 = self.nodes[0].getaddressinfo(addr2)['pubkey']\n+        result = wrpc.importmulti(\n+            [{\n+                'desc': 'wpkh(' + pub1 + ')',\n+                'keypool': True,\n+                \"timestamp\": \"now\",\n+            },\n+            {\n+                'desc': 'wpkh(' + pub2 + ')',\n+                'keypool': True,\n+                \"timestamp\": \"now\",\n+            }]\n+        )\n+        assert result[0]['success']\n+        assert result[1]['success']\n+        newaddr1 = wrpc.getnewaddress()\n+        assert_equal(addr1, newaddr1)\n+        newaddr2 = wrpc.getnewaddress()\n+        assert_equal(addr2, newaddr2)\n+\n+        # Import some public keys to the internal keypool of a no privkey wallet\n+        self.log.info(\"Adding pubkey to internal keypool of disableprivkey wallet\")\n+        addr1 = self.nodes[0].getnewaddress()\n+        addr2 = self.nodes[0].getnewaddress()\n+        pub1 = self.nodes[0].getaddressinfo(addr1)['pubkey']\n+        pub2 = self.nodes[0].getaddressinfo(addr2)['pubkey']\n+        result = wrpc.importmulti(\n+            [{\n+                'desc': 'wpkh(' + pub1 + ')',\n+                'keypool': True,\n+                'internal': True,\n+                \"timestamp\": \"now\",\n+            },\n+            {\n+                'desc': 'wpkh(' + pub2 + ')',\n+                'keypool': True,\n+                'internal': True,\n+                \"timestamp\": \"now\",\n+            }]\n+        )\n+        assert result[0]['success']\n+        assert result[1]['success']",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r255354746",
      "id" : 255354746,
      "in_reply_to_id" : 255345358,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTM1NDc0Ng==",
      "original_commit_id" : "7369e1a459bd0a033ad0e83f340bb0e05ca49566",
      "original_position" : 53,
      "path" : "test/functional/wallet_importmulti.py",
      "position" : 62,
      "pull_request_review_id" : 201920841,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255354746",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r255354763"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255354763"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've reverted this change.",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2019-02-10T20:43:55Z",
      "diff_hunk" : "@@ -1202,7 +1202,7 @@ void BitcoinGUI::updateWalletStatus()\n     }\n     WalletModel * const walletModel = walletView->getWalletModel();\n     setEncryptionStatus(walletModel->getEncryptionStatus());\n-    setHDStatus(walletModel->privateKeysDisabled(), walletModel->wallet().hdEnabled());\n+    setHDStatus(!walletModel->canGetAddresses(), walletModel->wallet().hdEnabled());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r255354763",
      "id" : 255354763,
      "in_reply_to_id" : 255346203,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTM1NDc2Mw==",
      "original_commit_id" : "5c73073d18df77226cf49ea2de8efc946ed4476d",
      "original_position" : 5,
      "path" : "src/qt/bitcoingui.cpp",
      "position" : null,
      "pull_request_review_id" : 201920854,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255354763",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r255354773"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255354773"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I reverted that change",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2019-02-10T20:44:05Z",
      "diff_hunk" : "@@ -161,7 +161,7 @@ void OverviewPage::setBalance(const interfaces::WalletBalances& balances)\n {\n     int unit = walletModel->getOptionsModel()->getDisplayUnit();\n     m_balances = balances;\n-    if (walletModel->privateKeysDisabled()) {\n+    if (!walletModel->canGetAddresses()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r255354773",
      "id" : 255354773,
      "in_reply_to_id" : 255347804,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTM1NDc3Mw==",
      "original_commit_id" : "5c73073d18df77226cf49ea2de8efc946ed4476d",
      "original_position" : 5,
      "path" : "src/qt/overviewpage.cpp",
      "position" : null,
      "pull_request_review_id" : 201920867,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255354773",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r255354781"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255354781"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Reverted",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2019-02-10T20:44:24Z",
      "diff_hunk" : "@@ -184,7 +184,7 @@ void OverviewPage::setBalance(const interfaces::WalletBalances& balances)\n     // for symmetry reasons also show immature label when the watch-only one is shown\n     ui->labelImmature->setVisible(showImmature || showWatchOnlyImmature);\n     ui->labelImmatureText->setVisible(showImmature || showWatchOnlyImmature);\n-    ui->labelWatchImmature->setVisible(!walletModel->privateKeysDisabled() && showWatchOnlyImmature); // show watch-only immature balance\n+    ui->labelWatchImmature->setVisible(walletModel->canGetAddresses() && showWatchOnlyImmature); // show watch-only immature balance",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r255354781",
      "id" : 255354781,
      "in_reply_to_id" : 255348169,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTM1NDc4MQ==",
      "original_commit_id" : "5c73073d18df77226cf49ea2de8efc946ed4476d",
      "original_position" : 14,
      "path" : "src/qt/overviewpage.cpp",
      "position" : null,
      "pull_request_review_id" : 201920876,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255354781",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r255354839"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255354839"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I added a function `AddKeypoolPubkeyWithDB` which `TopUpKeypool` calls. `AddKeypoolPubkey` will make the `WalletBatch`, call `AddKeypoolPubkeyWithDB` and then ``NotifyCanGetAddressesChanged``.",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2019-02-10T20:45:55Z",
      "diff_hunk" : "@@ -993,6 +993,7 @@ class CWallet final : public CCryptoKeyStore, public CValidationInterface\n     bool NewKeyPool();\n     size_t KeypoolCountExternalKeys() EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n     bool TopUpKeyPool(unsigned int kpSize = 0);\n+    void AddKeypoolPubkey(const CPubKey& pubkey, const bool internal);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r255354839",
      "id" : 255354839,
      "in_reply_to_id" : 255349233,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTM1NDgzOQ==",
      "original_commit_id" : "dffff150e98fc96c98e9e8caf40cec7391bbebfb",
      "original_position" : 4,
      "path" : "src/wallet/wallet.h",
      "position" : 4,
      "pull_request_review_id" : 201920939,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255354839",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r255354927"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255354927"
         }
      },
      "author_association" : "MEMBER",
      "body" : "We can do that later.",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2019-02-10T20:48:17Z",
      "diff_hunk" : "@@ -3417,7 +3417,8 @@ bool CWallet::ReserveKeyFromKeyPool(int64_t& nIndex, CKeyPool& keypool, bool fRe\n         if (!IsLocked())\n             TopUpKeyPool();\n \n-        bool fReturningInternal = IsHDEnabled() && CanSupportFeature(FEATURE_HD_SPLIT) && fRequestedInternal;\n+        bool fReturningInternal = fRequestedInternal;\n+        fReturningInternal &= (IsHDEnabled() && CanSupportFeature(FEATURE_HD_SPLIT)) || IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r255354927",
      "id" : 255354927,
      "in_reply_to_id" : 255348392,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTM1NDkyNw==",
      "original_commit_id" : "5c73073d18df77226cf49ea2de8efc946ed4476d",
      "original_position" : 15,
      "path" : "src/wallet/wallet.cpp",
      "position" : 69,
      "pull_request_review_id" : 201921039,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255354927",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r255355290"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255355290"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Changed.",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2019-02-10T20:54:42Z",
      "diff_hunk" : "@@ -2756,7 +2756,7 @@ bool CWallet::CreateTransaction(interfaces::Chain::Lock& locked_chain, const std\n                 //  post-backup change.\n \n                 // Reserve a new key pair from key pool\n-                if (IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS)) {\n+                if (!CanGetAddresses(true)) {\n                     strFailReason = _(\"Can't generate a change-address key. Private keys are disabled for this wallet.\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r255355290",
      "id" : 255355290,
      "in_reply_to_id" : 255348210,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTM1NTI5MA==",
      "original_commit_id" : "5c73073d18df77226cf49ea2de8efc946ed4476d",
      "original_position" : 6,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 201921308,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255355290",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r255377738"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255377738"
         }
      },
      "author_association" : "MEMBER",
      "body" : "A test showing that importing some non-single-pubkey addresses using descriptors doesn't cause the keypool to grow seems apt.",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2019-02-11T04:01:57Z",
      "diff_hunk" : "@@ -625,6 +625,76 @@ def run_test(self):\n                      ismine=False,\n                      iswatchonly=False)\n \n+        # Import some public keys to the keypool of a no privkey wallet",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r255377738",
      "id" : 255377738,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTM3NzczOA==",
      "original_commit_id" : "70ec7598a31a12383ec31ba8ff6f2fca33834bd9",
      "original_position" : 4,
      "path" : "test/functional/wallet_importmulti.py",
      "position" : 12,
      "pull_request_review_id" : 201947153,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255377738",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r255380700"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255380700"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2019-02-11T04:45:50Z",
      "diff_hunk" : "@@ -625,6 +625,76 @@ def run_test(self):\n                      ismine=False,\n                      iswatchonly=False)\n \n+        # Import some public keys to the keypool of a no privkey wallet",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r255380700",
      "id" : 255380700,
      "in_reply_to_id" : 255377738,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTM4MDcwMA==",
      "original_commit_id" : "70ec7598a31a12383ec31ba8ff6f2fca33834bd9",
      "original_position" : 4,
      "path" : "test/functional/wallet_importmulti.py",
      "position" : 12,
      "pull_request_review_id" : 201950679,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255380700",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I used a rather unpractical descriptor in my example above, with hardened derivation after the xpub. Let's try that again...\r\n\r\nIt works fine, so tACK a6e2c33, but I'm still confused why it works :-)\r\n\r\nHere's a wallet where one address has received funds:\r\n\r\n```sh\r\nbitcoin-cli createwallet keypool true\r\nbitcoin-cli -rpcwallet=keypool importmulti '[{\"desc\": \"wpkh(tpubD6NzVbkrYhZ4YNXVQbNhMK1WqguFsUXceaVJKbmno2aZ3B6QfbMeraaYvnBSGpV3vxLyTTK9DYT1yoEck4XUScMzXoQ2U2oSmE2JyMedq3H/0/*)\", \"range\": {\"end\": 2}, \"timestamp\": 1548979200, \"watchonly\": true, \"keypool\": true}]'\r\n```\r\n\r\nThe transaction immediately appears in QT, although the balance is incorrect until the next restart.\r\n\r\n```sh\r\nbitcoin-cli -rpcwallet=keypool getaddressinfo tb1qsh65n95t9myg5xn44h9gmlmh2kej0l0yppqkqx\r\n```\r\n```json\r\n{\r\n  \"address\": \"tb1qsh65n95t9myg5xn44h9gmlmh2kej0l0yppqkqx\",\r\n  \"scriptPubKey\": \"001485f549968b2ec88a1a75adca8dff7755b327fde4\",\r\n  \"ismine\": false,\r\n  \"solvable\": true,\r\n  \"desc\": \"wpkh([85f54996]0245fa928afe25e7b1c38d3bc16aafd933dda8ea8c653396cfc1d87859ef14331d)\",\r\n  \"iswatchonly\": true,\r\n  \"isscript\": false,\r\n  \"iswitness\": true,\r\n  \"witness_version\": 0,\r\n  \"witness_program\": \"85f549968b2ec88a1a75adca8dff7755b327fde4\",\r\n  \"pubkey\": \"0245fa928afe25e7b1c38d3bc16aafd933dda8ea8c653396cfc1d87859ef14331d\",\r\n  \"label\": \"\",\r\n  \"ischange\": false,\r\n  \"timestamp\": 1548979200,\r\n  \"labels\": [\r\n    {\r\n      \"name\": \"\",\r\n      \"purpose\": \"receive\"\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\nRemember when @instagibbs added:\r\n\r\n> The second commit has watch keys imported to the keypool be marked as used when transactions are seen using them.\r\n\r\nYou then dropped that commit, because it was superseded by #14821.\r\n\r\nThe problem is that `AddToWalletIfInvolvingMe` only considers `IsMine` https://github.com/bitcoin/bitcoin/blame/master/src/wallet/wallet.cpp#L972.\r\n\r\nBut these imported public keys are merely `Solvable` so why aren't they skipped? Is the keypool somehow treated as `IsMine` even though `getaddressinfo` disagrees?",
      "created_at" : "2019-02-11T10:14:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-462275673",
      "id" : 462275673,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MjI3NTY3Mw==",
      "updated_at" : "2019-02-11T11:27:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/462275673",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> But these imported public keys are merely `Solvable` so why aren't they skipped?\r\n\r\n`IsMine()` returns true for things that are watch only, solvable, or spendable.",
      "created_at" : "2019-02-11T15:28:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-462369203",
      "id" : 462369203,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MjM2OTIwMw==",
      "updated_at" : "2019-02-11T15:28:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/462369203",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "More concretely, `IsMine` does a last-minute check if the exact scriptPubKey exists in the watchonly store if it fails at everything else.",
      "created_at" : "2019-02-11T15:35:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-462372141",
      "id" : 462372141,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MjM3MjE0MQ==",
      "updated_at" : "2019-02-11T15:35:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/462372141",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Feel free to remove \"built on\" comment in OP so I don't keep checking if it's time to review in earnest :) ",
      "created_at" : "2019-02-14T18:01:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-463727777",
      "id" : 463727777,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MzcyNzc3Nw==",
      "updated_at" : "2019-02-14T18:01:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/463727777",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "There is no test for keys being imported in order, and it appears to not actually be implemented for descriptors with ranges? You're iterating over a map's keys, which will be sorted in `CKeyID` order.",
      "created_at" : "2019-02-14T18:14:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-463732686",
      "id" : 463732686,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MzczMjY4Ng==",
      "updated_at" : "2019-02-14T18:14:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/463732686",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Good news: I'm wrong, and I'm the one who wrote the logic originally :( \r\n\r\nTest and I'm happy.\r\n",
      "created_at" : "2019-02-14T19:19:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-463756158",
      "id" : 463756158,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2Mzc1NjE1OA==",
      "updated_at" : "2019-02-14T19:19:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/463756158",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r256977707"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256977707"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```\r\n./test/functional/wallet_importmulti.py:730:35: F821 undefined name 'xpub'\r\n```",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2019-02-14T19:26:41Z",
      "diff_hunk" : "@@ -625,6 +625,119 @@ def run_test(self):\n                      ismine=False,\n                      iswatchonly=False)\n \n+        # Import some public keys to the keypool of a no privkey wallet\n+        self.log.info(\"Adding pubkey to keypool of disableprivkey wallet\")\n+        self.nodes[1].createwallet(wallet_name=\"noprivkeys\", disable_private_keys=True)\n+        wrpc = self.nodes[1].get_wallet_rpc(\"noprivkeys\")\n+\n+        addr1 = self.nodes[0].getnewaddress()\n+        addr2 = self.nodes[0].getnewaddress()\n+        pub1 = self.nodes[0].getaddressinfo(addr1)['pubkey']\n+        pub2 = self.nodes[0].getaddressinfo(addr2)['pubkey']\n+        result = wrpc.importmulti(\n+            [{\n+                'desc': 'wpkh(' + pub1 + ')',\n+                'keypool': True,\n+                \"timestamp\": \"now\",\n+            },\n+            {\n+                'desc': 'wpkh(' + pub2 + ')',\n+                'keypool': True,\n+                \"timestamp\": \"now\",\n+            }]\n+        )\n+        assert result[0]['success']\n+        assert result[1]['success']\n+        assert_equal(wrpc.getwalletinfo()[\"keypoolsize\"], 2)\n+        newaddr1 = wrpc.getnewaddress()\n+        assert_equal(addr1, newaddr1)\n+        newaddr2 = wrpc.getnewaddress()\n+        assert_equal(addr2, newaddr2)\n+\n+        # Import some public keys to the internal keypool of a no privkey wallet\n+        self.log.info(\"Adding pubkey to internal keypool of disableprivkey wallet\")\n+        addr1 = self.nodes[0].getnewaddress()\n+        addr2 = self.nodes[0].getnewaddress()\n+        pub1 = self.nodes[0].getaddressinfo(addr1)['pubkey']\n+        pub2 = self.nodes[0].getaddressinfo(addr2)['pubkey']\n+        result = wrpc.importmulti(\n+            [{\n+                'desc': 'wpkh(' + pub1 + ')',\n+                'keypool': True,\n+                'internal': True,\n+                \"timestamp\": \"now\",\n+            },\n+            {\n+                'desc': 'wpkh(' + pub2 + ')',\n+                'keypool': True,\n+                'internal': True,\n+                \"timestamp\": \"now\",\n+            }]\n+        )\n+        assert result[0]['success']\n+        assert result[1]['success']\n+        assert_equal(wrpc.getwalletinfo()[\"keypoolsize_hd_internal\"], 2)\n+        newaddr1 = wrpc.getrawchangeaddress()\n+        assert_equal(addr1, newaddr1)\n+        newaddr2 = wrpc.getrawchangeaddress()\n+        assert_equal(addr2, newaddr2)\n+\n+        # Import a multisig and make sure the keys don't go into the keypool\n+        self.log.info('Imported scripts with pubkeys shoud not have their pubkeys go into the keypool')\n+        addr1 = self.nodes[0].getnewaddress()\n+        addr2 = self.nodes[0].getnewaddress()\n+        pub1 = self.nodes[0].getaddressinfo(addr1)['pubkey']\n+        pub2 = self.nodes[0].getaddressinfo(addr2)['pubkey']\n+        result = wrpc.importmulti(\n+            [{\n+                'desc': 'wsh(multi(2,' + pub1 + ',' + pub2 + '))',\n+                'keypool': True,\n+                \"timestamp\": \"now\",\n+            }]\n+        )\n+        assert result[0]['success']\n+        assert_equal(wrpc.getwalletinfo()[\"keypoolsize\"], 0)\n+\n+        # Cannot import those pubkeys to keypool of wallet with privkeys\n+        self.log.info(\"Pubkeys cannot be added to the keypool of a wallet with private keys\")\n+        wrpc = self.nodes[1].get_wallet_rpc(\"\")\n+        assert wrpc.getwalletinfo()['private_keys_enabled']\n+        result = wrpc.importmulti(\n+            [{\n+                'desc': 'wpkh(' + pub1 + ')',\n+                'keypool': True,\n+                \"timestamp\": \"now\",\n+            }]\n+        )\n+        assert_equal(result[0]['error']['code'], -8)\n+        assert_equal(result[0]['error']['message'], \"Keys can only be imported to the keypool when private keys are disabled\")\n+\n+        # Make sure ranged imports import keys in order\n+        self.log.info('Key ranges should be imported in order')\n+        wrpc = self.nodes[1].get_wallet_rpc(\"noprivkeys\")\n+        assert_equal(wrpc.getwalletinfo()[\"keypoolsize\"], 0)\n+        assert_equal(wrpc.getwalletinfo()[\"private_keys_enabled\"], False)\n+        xpriv = \"tpubD6NzVbkrYhZ4YNXVQbNhMK1WqguFsUXceaVJKbmno2aZ3B6QfbMeraaYvnBSGpV3vxLyTTK9DYT1yoEck4XUScMzXoQ2U2oSmE2JyMedq3H\"\n+        addresses = [\n+            'bcrt1qtmp74ayg7p24uslctssvjm06q5phz4yrxucgnv', # m/0'/0'/0\n+            'bcrt1q8vprchan07gzagd5e6v9wd7azyucksq2xc76k8', # m/0'/0'/1\n+            'bcrt1qtuqdtha7zmqgcrr26n2rqxztv5y8rafjp9lulu', # m/0'/0'/2\n+            'bcrt1qau64272ymawq26t90md6an0ps99qkrse58m640', # m/0'/0'/3\n+            'bcrt1qsg97266hrh6cpmutqen8s4s962aryy77jp0fg0', # m/0'/0'/4\n+        ]\n+        result = wrpc.importmulti(\n+            [{\n+                'desc': 'wpkh(' + xpub + '/0h/0h/*' + ')',",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r256977707",
      "id" : 256977707,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1Njk3NzcwNw==",
      "original_commit_id" : "0f9f035449e34a9c6e8ed32d3e56afe7a665f538",
      "original_position" : 106,
      "path" : "test/functional/wallet_importmulti.py",
      "position" : null,
      "pull_request_review_id" : 203927499,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256977707",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@instagibbs keys from a ranged descriptor are imported in order. Feel free to replace this test:\r\n\r\n```py\r\n        # Test importing of a ranged descriptor without keys, check order\r\n        self.log.info(\"Should import the ranged descriptor with specified range as solvable\")\r\n        self.test_importmulti({\"desc\": desc,\r\n                               \"timestamp\": \"now\",\r\n                               \"range\": {\"end\": 9}},\r\n                              success=True,\r\n                              warnings=[\"Some private keys are missing, outputs will be considered watchonly. If this is intentional, specify the watchonly flag.\"])\r\n        # Check the first two addresses:\r\n        for address in addresses:\r\n            test_address(self.nodes[1],\r\n                         key.p2sh_p2wpkh_addr,\r\n                         solvable=True)\r\n\r\n        # Check keys were imported in the correct order:\r\n        for i in range(10):\r\n            address = self.nodes[1].getnewaddress()\r\n            assert_equal(self.nodes[1].getaddressinfo(address)[\"hdkeypath\"], \"m/0'/0'/%s'\" % i)\r\n```",
      "created_at" : "2019-02-14T19:28:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-463759396",
      "id" : 463759396,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2Mzc1OTM5Ng==",
      "updated_at" : "2019-02-14T19:28:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/463759396",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r256978847"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256978847"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Whoops",
      "commit_id" : "f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2019-02-14T19:29:51Z",
      "diff_hunk" : "@@ -625,6 +625,119 @@ def run_test(self):\n                      ismine=False,\n                      iswatchonly=False)\n \n+        # Import some public keys to the keypool of a no privkey wallet\n+        self.log.info(\"Adding pubkey to keypool of disableprivkey wallet\")\n+        self.nodes[1].createwallet(wallet_name=\"noprivkeys\", disable_private_keys=True)\n+        wrpc = self.nodes[1].get_wallet_rpc(\"noprivkeys\")\n+\n+        addr1 = self.nodes[0].getnewaddress()\n+        addr2 = self.nodes[0].getnewaddress()\n+        pub1 = self.nodes[0].getaddressinfo(addr1)['pubkey']\n+        pub2 = self.nodes[0].getaddressinfo(addr2)['pubkey']\n+        result = wrpc.importmulti(\n+            [{\n+                'desc': 'wpkh(' + pub1 + ')',\n+                'keypool': True,\n+                \"timestamp\": \"now\",\n+            },\n+            {\n+                'desc': 'wpkh(' + pub2 + ')',\n+                'keypool': True,\n+                \"timestamp\": \"now\",\n+            }]\n+        )\n+        assert result[0]['success']\n+        assert result[1]['success']\n+        assert_equal(wrpc.getwalletinfo()[\"keypoolsize\"], 2)\n+        newaddr1 = wrpc.getnewaddress()\n+        assert_equal(addr1, newaddr1)\n+        newaddr2 = wrpc.getnewaddress()\n+        assert_equal(addr2, newaddr2)\n+\n+        # Import some public keys to the internal keypool of a no privkey wallet\n+        self.log.info(\"Adding pubkey to internal keypool of disableprivkey wallet\")\n+        addr1 = self.nodes[0].getnewaddress()\n+        addr2 = self.nodes[0].getnewaddress()\n+        pub1 = self.nodes[0].getaddressinfo(addr1)['pubkey']\n+        pub2 = self.nodes[0].getaddressinfo(addr2)['pubkey']\n+        result = wrpc.importmulti(\n+            [{\n+                'desc': 'wpkh(' + pub1 + ')',\n+                'keypool': True,\n+                'internal': True,\n+                \"timestamp\": \"now\",\n+            },\n+            {\n+                'desc': 'wpkh(' + pub2 + ')',\n+                'keypool': True,\n+                'internal': True,\n+                \"timestamp\": \"now\",\n+            }]\n+        )\n+        assert result[0]['success']\n+        assert result[1]['success']\n+        assert_equal(wrpc.getwalletinfo()[\"keypoolsize_hd_internal\"], 2)\n+        newaddr1 = wrpc.getrawchangeaddress()\n+        assert_equal(addr1, newaddr1)\n+        newaddr2 = wrpc.getrawchangeaddress()\n+        assert_equal(addr2, newaddr2)\n+\n+        # Import a multisig and make sure the keys don't go into the keypool\n+        self.log.info('Imported scripts with pubkeys shoud not have their pubkeys go into the keypool')\n+        addr1 = self.nodes[0].getnewaddress()\n+        addr2 = self.nodes[0].getnewaddress()\n+        pub1 = self.nodes[0].getaddressinfo(addr1)['pubkey']\n+        pub2 = self.nodes[0].getaddressinfo(addr2)['pubkey']\n+        result = wrpc.importmulti(\n+            [{\n+                'desc': 'wsh(multi(2,' + pub1 + ',' + pub2 + '))',\n+                'keypool': True,\n+                \"timestamp\": \"now\",\n+            }]\n+        )\n+        assert result[0]['success']\n+        assert_equal(wrpc.getwalletinfo()[\"keypoolsize\"], 0)\n+\n+        # Cannot import those pubkeys to keypool of wallet with privkeys\n+        self.log.info(\"Pubkeys cannot be added to the keypool of a wallet with private keys\")\n+        wrpc = self.nodes[1].get_wallet_rpc(\"\")\n+        assert wrpc.getwalletinfo()['private_keys_enabled']\n+        result = wrpc.importmulti(\n+            [{\n+                'desc': 'wpkh(' + pub1 + ')',\n+                'keypool': True,\n+                \"timestamp\": \"now\",\n+            }]\n+        )\n+        assert_equal(result[0]['error']['code'], -8)\n+        assert_equal(result[0]['error']['message'], \"Keys can only be imported to the keypool when private keys are disabled\")\n+\n+        # Make sure ranged imports import keys in order\n+        self.log.info('Key ranges should be imported in order')\n+        wrpc = self.nodes[1].get_wallet_rpc(\"noprivkeys\")\n+        assert_equal(wrpc.getwalletinfo()[\"keypoolsize\"], 0)\n+        assert_equal(wrpc.getwalletinfo()[\"private_keys_enabled\"], False)\n+        xpriv = \"tpubD6NzVbkrYhZ4YNXVQbNhMK1WqguFsUXceaVJKbmno2aZ3B6QfbMeraaYvnBSGpV3vxLyTTK9DYT1yoEck4XUScMzXoQ2U2oSmE2JyMedq3H\"\n+        addresses = [\n+            'bcrt1qtmp74ayg7p24uslctssvjm06q5phz4yrxucgnv', # m/0'/0'/0\n+            'bcrt1q8vprchan07gzagd5e6v9wd7azyucksq2xc76k8', # m/0'/0'/1\n+            'bcrt1qtuqdtha7zmqgcrr26n2rqxztv5y8rafjp9lulu', # m/0'/0'/2\n+            'bcrt1qau64272ymawq26t90md6an0ps99qkrse58m640', # m/0'/0'/3\n+            'bcrt1qsg97266hrh6cpmutqen8s4s962aryy77jp0fg0', # m/0'/0'/4\n+        ]\n+        result = wrpc.importmulti(\n+            [{\n+                'desc': 'wpkh(' + xpub + '/0h/0h/*' + ')',",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#discussion_r256978847",
      "id" : 256978847,
      "in_reply_to_id" : 256977707,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1Njk3ODg0Nw==",
      "original_commit_id" : "0f9f035449e34a9c6e8ed32d3e56afe7a665f538",
      "original_position" : 106,
      "path" : "test/functional/wallet_importmulti.py",
      "position" : null,
      "pull_request_review_id" : 203928903,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14075",
      "updated_at" : "2019-02-14T23:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256978847",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Test fix only change.\r\n\r\nreACK https://github.com/bitcoin/bitcoin/pull/14075/commits/32fd3bb627fbd3c44b4f45434ead56f207dffa06",
      "created_at" : "2019-02-14T19:33:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-463761195",
      "id" : 463761195,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2Mzc2MTE5NQ==",
      "updated_at" : "2019-02-14T19:33:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/463761195",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-ACK https://github.com/bitcoin/bitcoin/pull/14075/commits/38fbc101d1342222565b8670b7cd9c2485a57c74\r\n\r\nOrdering test fixed, at least locally.",
      "created_at" : "2019-02-14T19:43:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-463765056",
      "id" : 463765056,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2Mzc2NTA1Ng==",
      "updated_at" : "2019-02-14T19:43:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/463765056",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK a6e2c3331023d11112f8e9d176aa823d84b3f5ce (only adds a test since my last ACK)",
      "created_at" : "2019-02-14T19:56:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-463770072",
      "id" : 463770072,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2Mzc3MDA3Mg==",
      "updated_at" : "2019-02-14T19:56:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/463770072",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK https://github.com/bitcoin/bitcoin/pull/14075/commits/38fbc101d1342222565b8670b7cd9c2485a57c74",
      "created_at" : "2019-02-14T22:32:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-463829201",
      "id" : 463829201,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MzgyOTIwMQ==",
      "updated_at" : "2019-02-14T22:32:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/463829201",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "LGTM https://github.com/bitcoin/bitcoin/pull/14075/commits/f4b00b70e811d3772589ab3c64d7658f4dbdab69",
      "created_at" : "2019-02-14T23:51:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-463850235",
      "id" : 463850235,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2Mzg1MDIzNQ==",
      "updated_at" : "2019-02-14T23:51:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/463850235",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Post merge utACK f4b00b7",
      "created_at" : "2019-02-15T07:41:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14075#issuecomment-463939400",
      "id" : 463939400,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14075",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MzkzOTQwMA==",
      "updated_at" : "2019-02-15T07:41:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/463939400",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   }
]
