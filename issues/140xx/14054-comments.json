[
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK!\r\n\r\nThe changes to the test framework remove all testing of the p2p REJECT message. Shouldn't we maintain at least some minor testing of REJECT, unless(/until) REJECT is removed entirely?",
      "created_at" : "2018-08-24T20:41:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14054#issuecomment-415876820",
      "id" : 415876820,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14054",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxNTg3NjgyMA==",
      "updated_at" : "2018-08-24T20:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/415876820",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK.",
      "created_at" : "2018-08-24T22:19:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14054#issuecomment-415897051",
      "id" : 415897051,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14054",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxNTg5NzA1MQ==",
      "updated_at" : "2018-08-24T22:19:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/415897051",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jnewbery Added back one test case for `-enablebip61`",
      "created_at" : "2018-08-24T22:37:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14054#issuecomment-415900363",
      "id" : 415900363,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14054",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxNTkwMDM2Mw==",
      "updated_at" : "2018-08-24T22:37:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/415900363",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK\r\n\r\nI'm not convinced about removing REJECT completely, I think it is useful for testing and development (and have used it for that purpose a few times, for example during development of [bitcoin-submittx](https://github.com/laanwj/bitcoin-submittx)).\r\n\r\nHowever I fully agree on the reasoning behind disabling it by default.",
      "created_at" : "2018-08-27T09:16:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14054#issuecomment-416166729",
      "id" : 416166729,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14054",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxNjE2NjcyOQ==",
      "updated_at" : "2018-08-27T09:16:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/416166729",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14054#discussion_r213004604"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14054"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213004604"
         }
      },
      "author_association" : "MEMBER",
      "body" : "s/reject_code and reject_reason are/reject_reason is",
      "commit_id" : "faea5bfc5a975874acf763082852ed532ed81a95",
      "created_at" : "2018-08-27T14:53:45Z",
      "diff_hunk" : "@@ -492,66 +485,59 @@ def send_blocks_and_test(self, blocks, rpc, success=True, request_block=True, re\n            ensure that any getdata messages are responded to\n          - if success is True: assert that the node's tip advances to the most recent block\n          - if success is False: assert that the node's tip doesn't advance\n-         - if reject_code and reject_reason are set: assert that the correct reject message is received\"\"\"\n+         - if reject_code and reject_reason are set: assert that the correct reject message is logged\"\"\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14054#discussion_r213004604",
      "id" : 213004604,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMzAwNDYwNA==",
      "original_commit_id" : "fa17b5ac94f5686615c9da9fa9a56b9a1e02685c",
      "original_position" : 28,
      "path" : "test/functional/test_framework/mininode.py",
      "position" : null,
      "pull_request_review_id" : 149747152,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14054",
      "updated_at" : "2018-09-09T17:54:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213004604",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14054#discussion_r213005579"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14054"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213005579"
         }
      },
      "author_association" : "MEMBER",
      "body" : "s/reject_code and reject_reason are/reject_reason is",
      "commit_id" : "faea5bfc5a975874acf763082852ed532ed81a95",
      "created_at" : "2018-08-27T14:56:28Z",
      "diff_hunk" : "@@ -492,66 +485,59 @@ def send_blocks_and_test(self, blocks, rpc, success=True, request_block=True, re\n            ensure that any getdata messages are responded to\n          - if success is True: assert that the node's tip advances to the most recent block\n          - if success is False: assert that the node's tip doesn't advance\n-         - if reject_code and reject_reason are set: assert that the correct reject message is received\"\"\"\n+         - if reject_code and reject_reason are set: assert that the correct reject message is logged\"\"\"\n \n         with mininode_lock:\n-            self.reject_code_received = None\n-            self.reject_reason_received = None\n-\n             for block in blocks:\n                 self.block_store[block.sha256] = block\n                 self.last_block_hash = block.sha256\n \n-        self.send_message(msg_headers([CBlockHeader(blocks[-1])]))\n+        reject_reason = [reject_reason] if reject_reason else []\n+        with node.assert_debug_log(expected_msgs=reject_reason):\n+            self.send_message(msg_headers([CBlockHeader(blocks[-1])]))\n \n-        if request_block:\n-            wait_until(lambda: blocks[-1].sha256 in self.getdata_requests, timeout=timeout, lock=mininode_lock)\n+            if request_block:\n+                wait_until(lambda: blocks[-1].sha256 in self.getdata_requests, timeout=timeout, lock=mininode_lock)\n \n-        if success:\n-            wait_until(lambda: rpc.getbestblockhash() == blocks[-1].hash, timeout=timeout)\n-        else:\n-            assert rpc.getbestblockhash() != blocks[-1].hash\n+            if expect_disconnect:\n+                self.wait_for_disconnect()\n+            else:\n+                self.sync_with_ping()\n \n-        if reject_code is not None:\n-            wait_until(lambda: self.reject_code_received == reject_code, lock=mininode_lock)\n-        if reject_reason is not None:\n-            wait_until(lambda: self.reject_reason_received == reject_reason, lock=mininode_lock)\n+            if success:\n+                wait_until(lambda: node.getbestblockhash() == blocks[-1].hash, timeout=timeout)\n+            else:\n+                assert node.getbestblockhash() != blocks[-1].hash\n \n-    def send_txs_and_test(self, txs, rpc, success=True, expect_disconnect=False, reject_code=None, reject_reason=None):\n+    def send_txs_and_test(self, txs, node, *, success=True, expect_disconnect=False, reject_reason=None):\n         \"\"\"Send txs to test node and test whether they're accepted to the mempool.\n \n          - add all txs to our tx_store\n          - send tx messages for all txs\n          - if success is True/False: assert that the txs are/are not accepted to the mempool\n          - if expect_disconnect is True: Skip the sync with ping\n-         - if reject_code and reject_reason are set: assert that the correct reject message is received.\"\"\"\n+         - if reject_code and reject_reason are set: assert that the correct reject message is logged.\"\"\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14054#discussion_r213005579",
      "id" : 213005579,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMzAwNTU3OQ==",
      "original_commit_id" : "fa17b5ac94f5686615c9da9fa9a56b9a1e02685c",
      "original_position" : 75,
      "path" : "test/functional/test_framework/mininode.py",
      "position" : null,
      "pull_request_review_id" : 149747152,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14054",
      "updated_at" : "2018-09-09T17:54:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213005579",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14054#discussion_r213011063"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14054"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213011063"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This whole sub-test can be removed (everything from `# restart node with sending BIP61 messages disabled, check that it disconnects without sending the reject message` onward)\r\n\r\nYou could also update L71 higher up to test the reject reason:\r\n\r\n```\r\n+++ b/test/functional/p2p_invalid_tx.py\r\n@@ -68,7 +68,8 @@ class InvalidTxRequestTest(BitcoinTestFramework):\r\n         # and we get disconnected immediately\r\n         self.log.info('Test a transaction that is rejected')\r\n         tx1 = create_tx_with_script(block1.vtx[0], 0, script_sig=b'\\x64' * 35, amount=50 * COIN - 12000)\r\n-        node.p2p.send_txs_and_test([tx1], node, success=False, expect_disconnect=True)\r\n+        node.p2p.send_txs_and_test([tx1], node, success=False, expect_disconnect=True, \r\n+                                   reject_reason=\"{} from peer=0 was not accepted: mandatory-script-verify-flag-failed (Invalid OP_IF construction) (code 16)\".format(tx1.hash))\r\n```",
      "commit_id" : "faea5bfc5a975874acf763082852ed532ed81a95",
      "created_at" : "2018-08-27T15:13:01Z",
      "diff_hunk" : "@@ -143,9 +143,6 @@ def run_test(self):\n                 \"disconnecting peer=0\",\n         ]):\n             node.p2p.send_txs_and_test([tx1], node, success=False, expect_disconnect=True)\n-        # send_txs_and_test will have waited for disconnect, so we can safely check that no reject has been received",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14054#discussion_r213011063",
      "id" : 213011063,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMzAxMTA2Mw==",
      "original_commit_id" : "fa17b5ac94f5686615c9da9fa9a56b9a1e02685c",
      "original_position" : 4,
      "path" : "test/functional/p2p_invalid_tx.py",
      "position" : null,
      "pull_request_review_id" : 149747152,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14054",
      "updated_at" : "2018-09-09T17:54:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213011063",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14054#discussion_r213011618"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14054"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213011618"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I have a mild preference to test reject messages in their own test case (`p2p_reject.py`), but not strongly enough to block this PR.",
      "commit_id" : "faea5bfc5a975874acf763082852ed532ed81a95",
      "created_at" : "2018-08-27T15:14:41Z",
      "diff_hunk" : "@@ -109,23 +109,16 @@ def run_test(self):\n         block.rehash()\n         block.solve()\n \n-        self.nodes[0].p2p.send_and_ping(msg_block(block))\n-        assert_equal(int(self.nodes[0].getbestblockhash(), 16), tip)\n+        with self.nodes[0].assert_debug_log(expected_msgs=['CheckInputs on {} failed with non-mandatory-script-verify-flag (Non-canonical DER signature)'.format(block.vtx[-1].hash)]):\n+            self.nodes[0].p2p.send_and_ping(msg_block(block))\n+            assert_equal(int(self.nodes[0].getbestblockhash(), 16), tip)\n+            self.nodes[0].p2p.sync_with_ping()\n \n         wait_until(lambda: \"reject\" in self.nodes[0].p2p.last_message.keys(), lock=mininode_lock)\n         with mininode_lock:\n-            # We can receive different reject messages depending on whether\n-            # bitcoind is running with multiple script check threads. If script\n-            # check threads are not in use, then transaction script validation\n-            # happens sequentially, and bitcoind produces more specific reject\n-            # reasons.\n             assert self.nodes[0].p2p.last_message[\"reject\"].code in [REJECT_INVALID, REJECT_NONSTANDARD]\n             assert_equal(self.nodes[0].p2p.last_message[\"reject\"].data, block.sha256)\n-            if self.nodes[0].p2p.last_message[\"reject\"].code == REJECT_INVALID:\n-                # Generic rejection when a block is invalid\n-                assert_equal(self.nodes[0].p2p.last_message[\"reject\"].reason, b'block-validation-failed')\n-            else:\n-                assert b'Non-canonical DER signature' in self.nodes[0].p2p.last_message[\"reject\"].reason\n+            assert b'Non-canonical DER signature' in self.nodes[0].p2p.last_message[\"reject\"].reason",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14054#discussion_r213011618",
      "id" : 213011618,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMzAxMTYxOA==",
      "original_commit_id" : "fa17b5ac94f5686615c9da9fa9a56b9a1e02685c",
      "original_position" : 67,
      "path" : "test/functional/feature_dersig.py",
      "position" : null,
      "pull_request_review_id" : 149747152,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14054",
      "updated_at" : "2018-09-09T17:54:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213011618",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14054#discussion_r213012722"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14054"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213012722"
         }
      },
      "author_association" : "MEMBER",
      "body" : "None of the calls to this function actually use the optional parameters, so this can be simplified to:\r\n\r\n```\r\n+++ b/test/functional/feature_csv_activation.py\r\n@@ -165,11 +165,11 @@ class BIP68_112_113Test(BitcoinTestFramework):\r\n         block.solve()\r\n         return block\r\n \r\n-    def sync_blocks(self, blocks, success=True, *, reject_reason=None, request_block=True):\r\n+    def sync_blocks(self, blocks, success=True):\r\n         \"\"\"Sends blocks to test node. Syncs and verifies that tip has advanced to most recent block.\r\n \r\n         Call with success = False if the tip shouldn't advance to the most recent block.\"\"\"\r\n-        self.nodes[0].p2p.send_blocks_and_test(blocks, self.nodes[0], success=success, reject_reason=reject_reason, request_block=request_block, expect_disconnect=False, timeout=60)\r\n+        self.nodes[0].p2p.send_blocks_and_test(blocks, self.nodes[0], success=success)\r\n```",
      "commit_id" : "faea5bfc5a975874acf763082852ed532ed81a95",
      "created_at" : "2018-08-27T15:18:11Z",
      "diff_hunk" : "@@ -165,11 +165,11 @@ def create_test_block(self, txs, version=536870912):\n         block.solve()\n         return block\n \n-    def sync_blocks(self, blocks, success=True, reject_code=None, reject_reason=None, request_block=True):\n+    def sync_blocks(self, blocks, success=True, *, reject_reason=None, request_block=True):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14054#discussion_r213012722",
      "id" : 213012722,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMzAxMjcyMg==",
      "original_commit_id" : "fa17b5ac94f5686615c9da9fa9a56b9a1e02685c",
      "original_position" : 5,
      "path" : "test/functional/feature_csv_activation.py",
      "position" : null,
      "pull_request_review_id" : 149747152,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14054",
      "updated_at" : "2018-09-09T17:54:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213012722",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14054#discussion_r213014998"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14054"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213014998"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Please add a comment to explain why `par=1` is needed.",
      "commit_id" : "faea5bfc5a975874acf763082852ed532ed81a95",
      "created_at" : "2018-08-27T15:25:16Z",
      "diff_hunk" : "@@ -51,10 +55,11 @@ def cltv_validate(node, tx, height):\n                                   list(CScript(new_tx.vin[0].scriptSig)))\n     return new_tx\n \n+\n class BIP65Test(BitcoinTestFramework):\n     def set_test_params(self):\n         self.num_nodes = 1\n-        self.extra_args = [['-whitelist=127.0.0.1']]\n+        self.extra_args = [['-whitelist=127.0.0.1', '-par=1']]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14054#discussion_r213014998",
      "id" : 213014998,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMzAxNDk5OA==",
      "original_commit_id" : "fa17b5ac94f5686615c9da9fa9a56b9a1e02685c",
      "original_position" : 26,
      "path" : "test/functional/feature_cltv.py",
      "position" : null,
      "pull_request_review_id" : 149747152,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14054",
      "updated_at" : "2018-09-09T17:54:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213014998",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14054#discussion_r213016909"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14054"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213016909"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Would be nice if all calls to `sync_blocks` used named argument for `reject_reason`, but that change should be in a future PR.",
      "commit_id" : "faea5bfc5a975874acf763082852ed532ed81a95",
      "created_at" : "2018-08-27T15:30:37Z",
      "diff_hunk" : "@@ -169,7 +169,7 @@ def run_test(self):\n         self.log.info(\"Reject a block where the miner creates too much coinbase reward\")\n         self.move_tip(6)\n         b9 = self.next_block(9, spend=out[4], additional_coinbase_value=1)\n-        self.sync_blocks([b9], False, 16, b'bad-cb-amount', reconnect=True)\n+        self.sync_blocks([b9], False, 'coinbase pays too much (actual=10000000000 vs limit=9999999999)', reconnect=True)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14054#discussion_r213016909",
      "id" : 213016909,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMzAxNjkwOQ==",
      "original_commit_id" : "fa17b5ac94f5686615c9da9fa9a56b9a1e02685c",
      "original_position" : 5,
      "path" : "test/functional/feature_block.py",
      "position" : null,
      "pull_request_review_id" : 149747152,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14054",
      "updated_at" : "2018-09-09T17:54:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213016909",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->No more conflicts as of last run.",
      "created_at" : "2018-08-29T17:32:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14054#issuecomment-417038684",
      "id" : 417038684,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14054",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxNzAzODY4NA==",
      "updated_at" : "2018-09-07T16:27:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/417038684",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Reject may be useful (necessary) for tracking the best-block of peers and making sure our \"essential\" peers are using the same consensus rules as we are. Until we have reliable peer best-block tracking implemented, I suggest we leave reject alone.",
      "created_at" : "2018-08-30T12:48:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14054#issuecomment-417307107",
      "id" : 417307107,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14054",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxNzMwNzEwNw==",
      "updated_at" : "2018-08-30T12:48:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/417307107",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Reject may be useful (necessary) for tracking the best-block of peers and making sure our \"essential\" peers are using the same consensus rules as we are.\r\n\r\nbitcoind does not track peers' best blocks or consensus rules using REJECT messages. In fact, all it does with REJECT messages is log (if NET logging is enabled) and drop.\r\n\r\nI don't think it makes sense to continue sending REJECT messages on the basis that they 'may' be used for something in future.\r\n\r\nThis breaks on master in feature_block.py. You need this change:\r\n\r\n```\r\n@@ -824,7 +824,7 @@ class FullBlockTest(BitcoinTestFramework):\r\n         tx.vin.append(CTxIn(COutPoint(b64a.vtx[1].sha256, 0)))\r\n         b64a = self.update_block(\"64a\", [tx])\r\n         assert_equal(len(b64a.serialize()), MAX_BLOCK_BASE_SIZE + 8)\r\n-        self.sync_blocks([b64a], success=False, reject_code=1, reject_reason=b'error parsing message')\r\n+        self.sync_blocks([b64a], success=False, reject_reason='non-canonical ReadCompactSize(): iostream error')\r\n```",
      "created_at" : "2018-09-06T20:51:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14054#issuecomment-419237029",
      "id" : 419237029,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14054",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxOTIzNzAyOQ==",
      "updated_at" : "2018-09-06T20:51:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/419237029",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jnewbery I will rebase this on \r\n*    #14119 (qa: Read reject reasons from debug log, not p2p messages by MarcoFalke)\r\n\r\nto get rid of all test changes and leave this a one-line change. Please help review that first.\r\n",
      "created_at" : "2018-09-06T21:40:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14054#issuecomment-419250343",
      "id" : 419250343,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14054",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxOTI1MDM0Mw==",
      "updated_at" : "2018-09-06T21:40:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/419250343",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Please help review that first.\r\n\r\nYes, fine (although a note to say that this PR isn't seeking review would have been helpful!)",
      "created_at" : "2018-09-07T11:42:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14054#issuecomment-419414033",
      "id" : 419414033,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14054",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxOTQxNDAzMw==",
      "updated_at" : "2018-09-07T11:42:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/419414033",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK faea5bf",
      "created_at" : "2018-09-10T02:15:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14054#issuecomment-419768071",
      "id" : 419768071,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14054",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxOTc2ODA3MQ==",
      "updated_at" : "2018-09-10T02:15:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/419768071",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/11154118?v=4",
         "events_url" : "https://api.github.com/users/ken2812221/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ken2812221/followers",
         "following_url" : "https://api.github.com/users/ken2812221/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ken2812221/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ken2812221",
         "id" : 11154118,
         "login" : "ken2812221",
         "node_id" : "MDQ6VXNlcjExMTU0MTE4",
         "organizations_url" : "https://api.github.com/users/ken2812221/orgs",
         "received_events_url" : "https://api.github.com/users/ken2812221/received_events",
         "repos_url" : "https://api.github.com/users/ken2812221/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ken2812221/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ken2812221"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "tested ACK faea5bfc5a975874acf763082852ed532ed81a95",
      "created_at" : "2018-09-10T14:26:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14054#issuecomment-419932417",
      "id" : 419932417,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14054",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxOTkzMjQxNw==",
      "updated_at" : "2018-09-10T14:26:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/419932417",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   }
]
