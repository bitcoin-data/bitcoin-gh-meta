[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->Reviewers, this pull request conflicts with the following ones:\n\n* #14565 (Overhaul importmulti logic by sipa)\n* #14558 (rpc: Require solvability in importmulti if importing more than the scriptPubKey by achow101)\n* #14459 (More RPC help description fixes by ch4ot1c)\n* #14454 (Add SegWit support to importmulti by MeshCollider)\n* #14075 (Import watch only pubkeys to the keypool if private keys are disabled by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2018-08-22T05:45:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-414918503",
      "id" : 414918503,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxNDkxODUwMw==",
      "updated_at" : "2018-10-25T06:08:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/414918503",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Nice! strong concept ACK",
      "created_at" : "2018-08-22T13:19:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-415028681",
      "id" : 415028681,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxNTAyODY4MQ==",
      "updated_at" : "2018-08-22T13:19:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/415028681",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Fixed a bug where the keymetadata wasn't being written to the wallet file. Also added a test for that case.",
      "created_at" : "2018-08-25T15:56:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-415978714",
      "id" : 415978714,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxNTk3ODcxNA==",
      "updated_at" : "2018-08-25T15:56:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/415978714",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased and also changed the keymeta stuff to add the hd master key id at key generation and when the wallet is first loaded.",
      "created_at" : "2018-08-28T21:48:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-416752152",
      "id" : 416752152,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxNjc1MjE1Mg==",
      "updated_at" : "2018-08-28T21:48:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/416752152",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r213773700"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213773700"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why?",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2018-08-29T17:48:14Z",
      "diff_hunk" : "@@ -560,6 +560,14 @@ bool ParseHDKeypath(const std::string& keypath_str, std::vector<uint32_t>& keypa\n         // Finds whether it is hardened\n         uint32_t path = 0;\n         size_t pos = item.find(\"'\");\n+        if (pos == std::string::npos) {\n+            // Look for h",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r213773700",
      "id" : 213773700,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMzc3MzcwMA==",
      "original_commit_id" : "8065a31ad807adf7f03e50034ef28c8bc4f1f396",
      "original_position" : 5,
      "path" : "src/utilstrencodings.cpp",
      "position" : null,
      "pull_request_review_id" : 150679873,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213773700",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r213784592"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213784592"
         }
      },
      "author_association" : "MEMBER",
      "body" : "why not? This is quite standard.",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2018-08-29T18:20:46Z",
      "diff_hunk" : "@@ -560,6 +560,14 @@ bool ParseHDKeypath(const std::string& keypath_str, std::vector<uint32_t>& keypa\n         // Finds whether it is hardened\n         uint32_t path = 0;\n         size_t pos = item.find(\"'\");\n+        if (pos == std::string::npos) {\n+            // Look for h",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r213784592",
      "id" : 213784592,
      "in_reply_to_id" : 213773700,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMzc4NDU5Mg==",
      "original_commit_id" : "8065a31ad807adf7f03e50034ef28c8bc4f1f396",
      "original_position" : 5,
      "path" : "src/utilstrencodings.cpp",
      "position" : null,
      "pull_request_review_id" : 150693201,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213784592",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r213824850"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213824850"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's fairly standard to use `h` or `H` as the indicator, not just `'`. In fact, the BIP uses `H`, but as a subscript. `'` is not actually used as the indicator for hardened in the BIP even though that is what everyone uses.\r\n\r\nThe main reason for allowing this is so that you don't have to do any annoying escaping stuff for the `'` when entering the keypaths on the command line.",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2018-08-29T20:34:54Z",
      "diff_hunk" : "@@ -560,6 +560,14 @@ bool ParseHDKeypath(const std::string& keypath_str, std::vector<uint32_t>& keypa\n         // Finds whether it is hardened\n         uint32_t path = 0;\n         size_t pos = item.find(\"'\");\n+        if (pos == std::string::npos) {\n+            // Look for h",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r213824850",
      "id" : 213824850,
      "in_reply_to_id" : 213773700,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMzgyNDg1MA==",
      "original_commit_id" : "8065a31ad807adf7f03e50034ef28c8bc4f1f396",
      "original_position" : 5,
      "path" : "src/utilstrencodings.cpp",
      "position" : null,
      "pull_request_review_id" : 150743360,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213824850",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased",
      "created_at" : "2018-09-04T13:08:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-418360569",
      "id" : 418360569,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxODM2MDU2OQ==",
      "updated_at" : "2018-09-04T13:08:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/418360569",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, thanks for working on this",
      "created_at" : "2018-09-13T14:54:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-421036433",
      "id" : 421036433,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyMTAzNjQzMw==",
      "updated_at" : "2018-09-13T14:54:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/421036433",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I will rework this to not require #14019 as soon as I have time (in a few days)",
      "created_at" : "2018-10-15T21:07:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-430013400",
      "id" : 430013400,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMDAxMzQwMA==",
      "updated_at" : "2018-10-15T21:07:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/430013400",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Closing for now due to the big changes to importmulti from #14454 and #14565. Perhaps it would be better to put more effort into supporting this through output descriptors rather than adding more data to importmulti.",
      "created_at" : "2018-10-30T04:27:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-434167968",
      "id" : 434167968,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNDE2Nzk2OA==",
      "updated_at" : "2018-10-30T04:27:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/434167968",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "+1 for only supporting this with descriptors. Suggest rebasing on #14491, as that currently doesn't save origin info into the wallet.",
      "created_at" : "2018-11-05T18:40:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-435986356",
      "id" : 435986356,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNTk4NjM1Ng==",
      "updated_at" : "2018-11-05T18:40:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/435986356",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased onto #14491 ",
      "created_at" : "2018-11-06T05:51:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-436138880",
      "id" : 436138880,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNjEzODg4MA==",
      "updated_at" : "2018-11-06T05:51:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/436138880",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@achow101 can you do a `git commit -a --amend --date \"$(date)\"` on your own commits so that they appear _after_ the unmerged upstream stuff? It's a bit hard to tell now which commits to review.",
      "created_at" : "2018-11-06T08:45:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-436174156",
      "id" : 436174156,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNjE3NDE1Ng==",
      "updated_at" : "2018-11-06T08:45:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/436174156",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Seeing some warnings (might be upstream):\r\n<img width=\"1155\" alt=\"schermafbeelding 2018-11-06 om 10 33 51\" src=\"https://user-images.githubusercontent.com/10217/48055268-7b5cb600-e1af-11e8-85f3-90d2c15bce87.png\">\r\n\r\nKey origin info from `importmulti` now nicely shows up now in `getaddressinfo`. However, like the upstream PR, it generate invalid psbt's. I tried with a watch-only wallet, manually providing a change address (which isn't used): \r\n\r\n```\r\nsrc/bitcoin-cli -rpcwallet=... walletcreatefundedpsbt '[{\"txid\": \"...\", \"vout\": 0}]' '[{\"...\": 0.1}]' 0 '{\"includeWatching\":  true, \"subtractFeeFromOutputs\": [0], \"changeAddress\": \"...\"}' true\r\n\r\n{\r\n  \"psbt\": \"...\",\r\n  \"fee\": 0.00002200,\r\n  \"changepos\": -1\r\n}\r\n\r\nsrc/bitcoin-cli -rpcwallet=... decodepsbt \"...\"\r\nerror code: -22\r\nerror message:\r\nTX decode failed Size of key was not the expected size for the type BIP32 keypath: unspecified iostream_category error\r\n```",
      "created_at" : "2018-11-06T09:51:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-436193667",
      "id" : 436193667,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNjE5MzY2Nw==",
      "updated_at" : "2018-11-06T09:51:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/436193667",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "If we narrow this PR to `WALLET_FLAG_DISABLE_PRIVATE_KEYS` wallets, would that allow you to just reuse `hdseedid` rather than undeprecating and repurposing `hdmasterkeyid `?\r\n\r\nAnd/or if we set `hdseedid` during `importmulti`, would that save you from having to upgrade the wallet version? I.e. get rid of  b0c7bbd4c460fdeb5a91d34f75e96eb115e37598?",
      "created_at" : "2018-11-06T10:04:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-436197671",
      "id" : 436197671,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNjE5NzY3MQ==",
      "updated_at" : "2018-11-06T10:04:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/436197671",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> If we narrow this PR to WALLET_FLAG_DISABLE_PRIVATE_KEYS wallets, would that allow you to just reuse hdseedid rather than undeprecating and repurposing hdmasterkeyid ?\r\n\r\nYes, but I don't really like that. It would mean that hdseedid has two meanings, depending on whether private keys are disabled. It's definition would not be consistent.",
      "created_at" : "2018-11-06T14:21:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-436268852",
      "id" : 436268852,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNjI2ODg1Mg==",
      "updated_at" : "2018-11-06T14:21:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/436268852",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@Sjors I've updated the dates on my commits and fixed the lock issue I believe. I am unable to replicate the creation of invalid PSBTs though. The PSBTs I have created for testing are correct.",
      "created_at" : "2018-11-06T14:41:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-436275588",
      "id" : 436275588,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNjI3NTU4OA==",
      "updated_at" : "2018-11-06T14:41:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/436275588",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Isn't the only difference between `hdseedid` and `hdmasterkeyid` that the key with `hdseedid` MAY be present in the wallet (for `!WALLET_FLAG_DISABLE_PRIVATE_KEYS`)? It MAY also be absent for keys generated before `encryptwallet` (which replaces the wallet seed). They both refer to a master key that generated a set of keys in the wallet.\r\n\r\nIf we migrate to a descriptor based wallet, there would be no difference in treatment between keys with `hdseedid` and keys `hdmasterkeyid` . Or am I missing something? cc @sipa",
      "created_at" : "2018-11-06T15:47:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-436300283",
      "id" : 436300283,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNjMwMDI4Mw==",
      "updated_at" : "2018-11-06T15:47:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/436300283",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "`hdseedid` is the ID of the seed. To get the master key id, the seed needs to be used to generate the master private key, and then the `masterkeyid` generated from that. There's one extra step of abstraction. The hd seed is not the same as the master private key.",
      "created_at" : "2018-11-06T16:01:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-436306115",
      "id" : 436306115,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNjMwNjExNQ==",
      "updated_at" : "2018-11-06T16:01:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/436306115",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@achow101 ah, I didn't know about the extra step from seed to master key. That makes sense then.",
      "created_at" : "2018-11-07T10:28:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-436578136",
      "id" : 436578136,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNjU3ODEzNg==",
      "updated_at" : "2018-11-07T10:28:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/436578136",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#14679](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14679.html) (importmulti: Don't add internal addresses to address book by instagibbs)\n* [#14565](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14565.html) (Overhaul importmulti logic by sipa)\n* [#14530](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14530.html) (Use RPCHelpMan to generate RPC doc strings by MarcoFalke)\n* [#14491](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14491.html) (Allow descriptor imports with importmulti by MeshCollider)\n* [#14459](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14459.html) (More RPC help description fixes by ch4ot1c)\n* [#14411](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14411.html) ([wallet] Restore ability to list incoming transactions by label by ryanofsky)\n* [#14075](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14075.html) (Import watch only pubkeys to the keypool if private keys are disabled by achow101)\n* [#10973](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/10973.html) (Refactor: separate wallet from node by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2018-11-08T21:59:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-437171488",
      "id" : 437171488,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNzE3MTQ4OA==",
      "updated_at" : "2018-11-08T21:59:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/437171488",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#14679](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14679.html) (importmulti: Don't add internal addresses to address book by instagibbs)\n* [#14565](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14565.html) (Overhaul importmulti logic by sipa)\n* [#14530](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14530.html) (Use RPCHelpMan to generate RPC doc strings by MarcoFalke)\n* [#14491](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14491.html) (Allow descriptor imports with importmulti by MeshCollider)\n* [#14459](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14459.html) (More RPC help description fixes by ch4ot1c)\n* [#14411](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14411.html) ([wallet] Restore ability to list incoming transactions by label by ryanofsky)\n* [#14075](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14075.html) (Import watch only pubkeys to the keypool if private keys are disabled by achow101)\n* [#10973](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/10973.html) (Refactor: separate wallet from node by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2018-11-09T02:50:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-437232361",
      "id" : 437232361,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNzIzMjM2MQ==",
      "updated_at" : "2018-11-09T02:50:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/437232361",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#14075](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14075.html) (Import watch only pubkeys to the keypool if private keys are disabled by achow101)\n* [#13756](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/13756.html) (wallet: \"avoid_reuse\" wallet flag for improved privacy by kallewoof)\n* [#13751](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/13751.html) (Utils and libraries: Drops the boost/algorithm/string/split.hpp dependency by 251Labs)\n* [#13541](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/13541.html) (wallet/rpc: sendrawtransaction maxfeerate by kallewoof)\n* [#11803](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/11803.html) (Bugfix: RPC/Wallet: Include HD key metadata in dumpwallet by luke-jr)\n* [#10973](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/10973.html) (Refactor: separate wallet from node by ryanofsky)\n* [#10102](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/10102.html) ([experimental] Multiprocess bitcoin by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2018-11-09T06:09:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-437260776",
      "id" : 437260776,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNzI2MDc3Ng==",
      "updated_at" : "2019-02-15T00:08:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/437260776",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r232174140"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/232174140"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should be const reference?",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2018-11-09T08:34:53Z",
      "diff_hunk" : "@@ -202,6 +202,10 @@ bool ConvertBits(const O& outfn, I it, I end) {\n /** Parse an HD keypaths like \"m/7/0'/2000\". */\n bool ParseHDKeypath(const std::string& keypath_str, std::vector<uint32_t>& keypath);\n \n+/** Write HD keypaths as strings */\n+std::string WriteHdKeypath(const std::vector<uint32_t> keypath);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r232174140",
      "id" : 232174140,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMjE3NDE0MA==",
      "original_commit_id" : "09995963827b7be1163a50d894490daf182b7a78",
      "original_position" : 5,
      "path" : "src/util/strencodings.h",
      "position" : null,
      "pull_request_review_id" : 173313233,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/232174140",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r232174240"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/232174240"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should be const reference?",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2018-11-09T08:35:20Z",
      "diff_hunk" : "@@ -587,6 +587,21 @@ bool ParseHDKeypath(const std::string& keypath_str, std::vector<uint32_t>& keypa\n     return true;\n }\n \n+std::string FormatKeyPath(const std::vector<uint32_t>& path)\n+{\n+    std::string ret;\n+    for (auto i : path) {\n+        ret += strprintf(\"/%i\", (i << 1) >> 1);\n+        if (i >> 31) ret += '\\'';\n+    }\n+    return ret;\n+}\n+\n+std::string WriteHdKeypath(const std::vector<uint32_t> keypath)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r232174240",
      "id" : 232174240,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMjE3NDI0MA==",
      "original_commit_id" : "09995963827b7be1163a50d894490daf182b7a78",
      "original_position" : 14,
      "path" : "src/util/strencodings.cpp",
      "position" : null,
      "pull_request_review_id" : 173313362,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/232174240",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r232174409"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/232174409"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Could use `std::any_of`? :-)",
      "commit_id" : "09995963827b7be1163a50d894490daf182b7a78",
      "created_at" : "2018-11-09T08:36:04Z",
      "diff_hunk" : "@@ -804,233 +805,354 @@ UniValue dumpwallet(const JSONRPCRequest& request)\n     return reply;\n }\n \n-\n-static UniValue ProcessImport(CWallet * const pwallet, const UniValue& data, const int64_t timestamp) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+struct ImportData\n {\n-    try {\n-        // First ensure scriptPubKey has either a script or JSON with \"address\" string\n-        const UniValue& scriptPubKey = data[\"scriptPubKey\"];\n-        bool isScript = scriptPubKey.getType() == UniValue::VSTR;\n-        if (!isScript && !(scriptPubKey.getType() == UniValue::VOBJ && scriptPubKey.exists(\"address\"))) {\n-            throw JSONRPCError(RPC_INVALID_PARAMETER, \"scriptPubKey must be string with script or JSON with address string\");\n+    // Input data\n+    std::unique_ptr<CScript> redeemscript; //! Provided redeemScript; will be mvoed to `import_scripts` if relevant.\n+    std::unique_ptr<CScript> witnessscript; //! Provided witnessScript; will be moved to `import_scripts` if relevant.\n+    std::map<CKeyID, CPubKey> pubkeys;\n+    std::map<CKeyID, CKey> privkeys;\n+\n+    // Output data\n+    std::set<CScript> script_pub_keys;\n+    std::set<CScript> import_scripts;\n+    std::set<CKeyID> used_keys; // Import these private keys if available\n+    std::set<CKeyID> require_keys; // Fail if these public keys are not available\n+    std::map<CKeyID, KeyOriginInfo> key_origins;\n+};\n+\n+enum class ScriptContext\n+{\n+    TOP, //! Top-level scriptPubKey\n+    P2SH, //! P2SH redeemScript\n+    WITNESS_V0, //! P2WSH witnessScript\n+};\n+\n+// Analyse the provided script, process the import data accordinging, and recurse into subscripts if necessary.\n+// Returns an error string, or the empty string for success.\n+static std::string RecurseImportData(const CScript& script, ImportData& data, ScriptContext ctx)\n+{\n+    // Use Solver to obtain script type and parsed pubkeys or hashes:\n+    std::vector<std::vector<unsigned char>> solverdata;\n+    txnouttype script_type = Solver(script, solverdata);\n+\n+    switch (script_type) {\n+    case TX_PUBKEY: {\n+        CPubKey pubkey(solverdata[0].begin(), solverdata[0].end());\n+        data.used_keys.emplace(pubkey.GetID());\n+        break;\n+    }\n+    case TX_PUBKEYHASH: {\n+        CKeyID id = CKeyID(uint160(solverdata[0]));\n+        data.require_keys.emplace(id);\n+        data.used_keys.emplace(id);\n+        break;\n+    }\n+    case TX_SCRIPTHASH: {\n+        if (ctx == ScriptContext::P2SH) throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Trying to nest P2SH inside another P2SH\");\n+        if (ctx == ScriptContext::WITNESS_V0) throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Trying to nest P2SH inside a P2WSH\");\n+        CScriptID id = CScriptID(uint160(solverdata[0]));\n+        auto subscript = std::move(data.redeemscript);\n+        if (!subscript) return \"missing redeemscript\";\n+        if (CScriptID(*subscript) != id) return \"redeemScript does not match the scriptPubKey\";\n+        data.import_scripts.emplace(*subscript);\n+        RecurseImportData(*subscript, data, ScriptContext::P2SH);\n+        break;\n+    }\n+    case TX_MULTISIG: {\n+        for (size_t i = 1; i + 1< solverdata.size(); ++i) {\n+            CPubKey pubkey(solverdata[i].begin(), solverdata[i].end());\n+            data.used_keys.emplace(pubkey.GetID());\n         }\n-        const std::string& output = isScript ? scriptPubKey.get_str() : scriptPubKey[\"address\"].get_str();\n-\n-        // Optional fields.\n-        const std::string& strRedeemScript = data.exists(\"redeemscript\") ? data[\"redeemscript\"].get_str() : \"\";\n-        const std::string& witness_script_hex = data.exists(\"witnessscript\") ? data[\"witnessscript\"].get_str() : \"\";\n-        const UniValue& pubKeys = data.exists(\"pubkeys\") ? data[\"pubkeys\"].get_array() : UniValue();\n-        const UniValue& keys = data.exists(\"keys\") ? data[\"keys\"].get_array() : UniValue();\n-        const bool internal = data.exists(\"internal\") ? data[\"internal\"].get_bool() : false;\n-        const bool watchOnly = data.exists(\"watchonly\") ? data[\"watchonly\"].get_bool() : false;\n-        const std::string& label = data.exists(\"label\") ? data[\"label\"].get_str() : \"\";\n-\n-        // Generate the script and destination for the scriptPubKey provided\n-        CScript script;\n-        CTxDestination dest;\n-\n-        if (!isScript) {\n-            dest = DecodeDestination(output);\n-            if (!IsValidDestination(dest)) {\n-                throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Invalid address\");\n-            }\n-            script = GetScriptForDestination(dest);\n-        } else {\n-            if (!IsHex(output)) {\n-                throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Invalid scriptPubKey\");\n-            }\n+        break;\n+    }\n+    case TX_WITNESS_V0_SCRIPTHASH: {\n+        if (ctx == ScriptContext::WITNESS_V0) throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Trying to nest P2WSH inside another P2WSH\");\n+        uint256 fullid(solverdata[0]);\n+        CScriptID id;\n+        CRIPEMD160().Write(fullid.begin(), fullid.size()).Finalize(id.begin());\n+        auto subscript = std::move(data.witnessscript);\n+        if (!subscript) return \"missing witnessscript\";\n+        if (CScriptID(*subscript) != id) return \"witnessScript does not match the scriptPubKey or redeemScript\";\n+        data.import_scripts.emplace(script); // Special rule for IsMine: native P2WSH requires the full script imported\n+        data.import_scripts.emplace(*subscript);\n+        RecurseImportData(*subscript, data, ScriptContext::WITNESS_V0);\n+        break;\n+    }\n+    case TX_WITNESS_V0_KEYHASH: {\n+        if (ctx == ScriptContext::WITNESS_V0) throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Trying to nest P2WPKH inside P2WSH\");\n+        CKeyID id = CKeyID(uint160(solverdata[0]));\n+        data.require_keys.emplace(id);\n+        data.used_keys.emplace(id);\n+        data.import_scripts.emplace(script); // Special rule for IsMine: native P2WPKH requires the full script imported\n+        break;\n+    }\n+    default:\n+        return \"nonstandard script\";\n+    }\n+    return \"\";\n+}\n \n-            std::vector<unsigned char> vData(ParseHex(output));\n-            script = CScript(vData.begin(), vData.end());\n-            if (!ExtractDestination(script, dest) && !internal) {\n-                throw JSONRPCError(RPC_INVALID_PARAMETER, \"Internal must be set to true for nonstandard scriptPubKey imports.\");\n-            }\n+static UniValue ProcessImportLegacy(ImportData& import_data, const UniValue& data, bool& watch_only)\n+{\n+    // First ensure scriptPubKey has either a script or JSON with \"address\" string\n+    const UniValue& scriptPubKey = data[\"scriptPubKey\"];\n+    bool isScript = scriptPubKey.getType() == UniValue::VSTR;\n+    if (!isScript && !(scriptPubKey.getType() == UniValue::VOBJ && scriptPubKey.exists(\"address\"))) {\n+        throw JSONRPCError(RPC_INVALID_PARAMETER, \"scriptPubKey must be string with script or JSON with address string\");\n+    }\n+    const std::string& output = isScript ? scriptPubKey.get_str() : scriptPubKey[\"address\"].get_str();\n+\n+    // Optional fields.\n+    const std::string& strRedeemScript = data.exists(\"redeemscript\") ? data[\"redeemscript\"].get_str() : \"\";\n+    const std::string& witness_script_hex = data.exists(\"witnessscript\") ? data[\"witnessscript\"].get_str() : \"\";\n+    const UniValue& pubKeys = data.exists(\"pubkeys\") ? data[\"pubkeys\"].get_array() : UniValue();\n+    const UniValue& keys = data.exists(\"keys\") ? data[\"keys\"].get_array() : UniValue();\n+    const bool internal = data.exists(\"internal\") ? data[\"internal\"].get_bool() : false;\n+\n+    // Generate the script and destination for the scriptPubKey provided\n+    CScript script;\n+    CTxDestination dest;\n+    if (!isScript) {\n+        dest = DecodeDestination(output);\n+        if (!IsValidDestination(dest)) {\n+            throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Invalid address\");\n         }\n-\n-        // Watchonly and private keys\n-        if (watchOnly && keys.size()) {\n-            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Watch-only addresses should not include private keys\");\n+        script = GetScriptForDestination(dest);\n+    } else {\n+        if (!IsHex(output)) {\n+            throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Invalid scriptPubKey\");\n         }\n-\n-        // Internal addresses should not have a label\n-        if (internal && data.exists(\"label\")) {\n-            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Internal addresses should not have a label\");\n+        std::vector<unsigned char> vData(ParseHex(output));\n+        script = CScript(vData.begin(), vData.end());\n+        if (!ExtractDestination(script, dest) && !internal) {\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Internal must be set to true for nonstandard scriptPubKey imports.\");\n         }\n+    }\n+    import_data.script_pub_keys.emplace(script);\n \n-        // Force users to provide the witness script in its field rather than redeemscript\n-        if (!strRedeemScript.empty() && script.IsPayToWitnessScriptHash()) {\n-            throw JSONRPCError(RPC_INVALID_PARAMETER, \"P2WSH addresses have an empty redeemscript. Please provide the witnessscript instead.\");\n+    // Parse all arguments\n+    if (strRedeemScript.size()) {\n+        if (!IsHex(strRedeemScript)) {\n+            throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Invalid redeem script: must be hex string\");\n         }\n-\n-        CScript scriptpubkey_script = script;\n-        CTxDestination scriptpubkey_dest = dest;\n-        bool allow_p2wpkh = true;\n-\n-        // P2SH\n-        if (!strRedeemScript.empty() && script.IsPayToScriptHash()) {\n-            // Check the redeemScript is valid\n-            if (!IsHex(strRedeemScript)) {\n-                throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Invalid redeem script: must be hex string\");\n-            }\n-\n-            // Import redeem script.\n-            std::vector<unsigned char> vData(ParseHex(strRedeemScript));\n-            CScript redeemScript = CScript(vData.begin(), vData.end());\n-            CScriptID redeem_id(redeemScript);\n-\n-            // Check that the redeemScript and scriptPubKey match\n-            if (GetScriptForDestination(redeem_id) != script) {\n-                throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"The redeemScript does not match the scriptPubKey\");\n-            }\n-\n-            pwallet->MarkDirty();\n-\n-            if (!pwallet->AddWatchOnly(redeemScript, timestamp)) {\n-                throw JSONRPCError(RPC_WALLET_ERROR, \"Error adding address to wallet\");\n-            }\n-\n-            if (!pwallet->HaveCScript(redeem_id) && !pwallet->AddCScript(redeemScript)) {\n-                throw JSONRPCError(RPC_WALLET_ERROR, \"Error adding p2sh redeemScript to wallet\");\n-            }\n-\n-            // Now set script to the redeemScript so we parse the inner script as P2WSH or P2WPKH below\n-            script = redeemScript;\n-            ExtractDestination(script, dest);\n+        auto parsed_redeemscript = ParseHex(strRedeemScript);\n+        import_data.redeemscript = MakeUnique<CScript>(parsed_redeemscript.begin(), parsed_redeemscript.end());\n+    }\n+    if (witness_script_hex.size()) {\n+        if (!IsHex(witness_script_hex)) {\n+            throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Invalid witness script: must be hex string\");\n         }\n+        auto parsed_witnessscript = ParseHex(witness_script_hex);\n+        import_data.witnessscript = MakeUnique<CScript>(parsed_witnessscript.begin(), parsed_witnessscript.end());\n+    }\n+    for (size_t i = 0; i < pubKeys.size(); ++i) {\n+        const auto& str = pubKeys[i].get_str();\n+        if (!IsHex(str)) {\n+            throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Pubkey must be a hex string\");\n+        }\n+        auto parsed_pubkey = ParseHex(str);\n+        CPubKey pubkey(parsed_pubkey.begin(), parsed_pubkey.end());\n+        if (!pubkey.IsFullyValid()) {\n+            throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Pubkey is not a valid public key\");\n+        }\n+        import_data.pubkeys.emplace(pubkey.GetID(), pubkey);\n+    }\n+    for (size_t i = 0; i < keys.size(); ++i) {\n+        const auto& str = keys[i].get_str();\n+        CKey key = DecodeSecret(str);\n+        if (!key.IsValid()) {\n+            throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Invalid private key encoding\");\n+        }\n+        CPubKey pubkey = key.GetPubKey();\n+        CKeyID id = pubkey.GetID();\n+        if (import_data.pubkeys.count(id)) {\n+            throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Both public and private key specified for \" + HexStr(pubkey.begin(), pubkey.end()));\n+        }\n+        import_data.privkeys.emplace(id, key);\n+    }\n \n-        // (P2SH-)P2WSH\n-        if (!witness_script_hex.empty() && script.IsPayToWitnessScriptHash()) {\n-            if (!IsHex(witness_script_hex)) {\n-                throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Invalid witness script: must be hex string\");\n-            }\n-\n-            // Generate the scripts\n-            std::vector<unsigned char> witness_script_parsed(ParseHex(witness_script_hex));\n-            CScript witness_script = CScript(witness_script_parsed.begin(), witness_script_parsed.end());\n-            CScriptID witness_id(witness_script);\n+    // Warn about inconsistencies between watch_only and provided keys/scripts\n+    UniValue warnings(UniValue::VARR);\n+    bool have_solving_data = import_data.redeemscript || import_data.witnessscript || import_data.pubkeys.size() || import_data.privkeys.size();\n+    if (watch_only && have_solving_data) {\n+        warnings.push_back(\"redeemscript, witnessscript, keys, and pubkeys are ignored when watchonly is set.\");\n+    }\n+    if (!watch_only && !have_solving_data) {\n+        warnings.push_back(\"Assuming watchonly as no redeemscript, witnessscript, keys, or pubkeys are provided.\");\n+        watch_only = true;\n+    }\n \n-            // Check that the witnessScript and scriptPubKey match\n-            if (GetScriptForDestination(WitnessV0ScriptHash(witness_script)) != script) {\n-                throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"The witnessScript does not match the scriptPubKey or redeemScript\");\n-            }\n+    // Force users to provide the witness script in its field rather than redeemscript\n+    if (!strRedeemScript.empty() && script.IsPayToWitnessScriptHash()) {\n+        throw JSONRPCError(RPC_INVALID_PARAMETER, \"P2WSH addresses have an empty redeemscript. Please provide the witnessscript instead.\");\n+    }\n \n-            // Add the witness script as watch only only if it is not for P2SH-P2WSH\n-            if (!scriptpubkey_script.IsPayToScriptHash() && !pwallet->AddWatchOnly(witness_script, timestamp)) {\n-                throw JSONRPCError(RPC_WALLET_ERROR, \"Error adding address to wallet\");\n-            }\n+    // Verify and process input data\n+    if (!watch_only) {\n+        // Match up data in import_data with the scriptPubKey in script.\n+        auto error = RecurseImportData(script, import_data, ScriptContext::TOP);\n \n-            if (!pwallet->HaveCScript(witness_id) && !pwallet->AddCScript(witness_script)) {\n-                throw JSONRPCError(RPC_WALLET_ERROR, \"Error adding p2wsh witnessScript to wallet\");\n+        // Check that all required keys for solvability are provided.\n+        if (error.empty()) {\n+            for (const auto& require_key : import_data.require_keys) {\n+                if (import_data.pubkeys.count(require_key) == 0 && import_data.privkeys.count(require_key) == 0) {\n+                    throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Key does not match address destination\");\n+                }\n             }\n-\n-            // Now set script to the witnessScript so we parse the inner script as P2PK or P2PKH below\n-            script = witness_script;\n-            ExtractDestination(script, dest);\n-            allow_p2wpkh = false; // P2WPKH cannot be embedded in P2WSH\n         }\n \n-        // (P2SH-)P2PK/P2PKH/P2WPKH\n-        if (dest.type() == typeid(CKeyID) || dest.type() == typeid(WitnessV0KeyHash)) {\n-            if (!allow_p2wpkh && dest.type() == typeid(WitnessV0KeyHash)) {\n-                throw JSONRPCError(RPC_INVALID_PARAMETER, \"P2WPKH cannot be embedded in P2WSH\");\n-            }\n-            if (keys.size() > 1 || pubKeys.size() > 1) {\n-                throw JSONRPCError(RPC_INVALID_PARAMETER, \"More than one key given for one single-key address\");\n-            }\n-            CPubKey pubkey;\n-            if (keys.size()) {\n-                pubkey = DecodeSecret(keys[0].get_str()).GetPubKey();\n-            }\n-            if (pubKeys.size()) {\n-                const std::string& strPubKey = pubKeys[0].get_str();\n-                if (!IsHex(strPubKey)) {\n-                    throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Pubkey must be a hex string\");\n-                }\n-                std::vector<unsigned char> vData(ParseHex(pubKeys[0].get_str()));\n-                CPubKey pubkey_temp(vData.begin(), vData.end());\n-                if (pubkey.size() && pubkey_temp != pubkey) {\n-                    throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Private key does not match public key for address\");\n+        if (!error.empty()) {\n+            warnings.push_back(\"Ignoring information in keys, pubkeys, redeemscript, and witnessscript:: \" + error);\n+            import_data = ImportData();\n+        } else {\n+            // RecurseImportData() removes any relevant redeemscript/witnessscript from import_data, so we can use that to discover if a superfluous one was provided.\n+            if (import_data.redeemscript) warnings.push_back(\"Ignoring redeemscript \" + strRedeemScript + \" as this is not a P2SH script.\");\n+            if (import_data.witnessscript) warnings.push_back(\"Ignoring witnessscript \" + witness_script_hex + \" as this is not a P2WSH script.\");\n+            for (const auto& privkey : import_data.privkeys) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r232174409",
      "id" : 232174409,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMjE3NDQwOQ==",
      "original_commit_id" : "09995963827b7be1163a50d894490daf182b7a78",
      "original_position" : 346,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 346,
      "pull_request_review_id" : 173313573,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2018-11-09T08:36:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/232174409",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#14679](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14679.html) (importmulti: Don't add internal addresses to address book by instagibbs)\n* [#14565](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14565.html) (Overhaul importmulti logic by sipa)\n* [#14530](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14530.html) (Use RPCHelpMan to generate RPC doc strings by MarcoFalke)\n* [#14491](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14491.html) (Allow descriptor imports with importmulti by MeshCollider)\n* [#14459](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14459.html) (More RPC help description fixes by ch4ot1c)\n* [#14411](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14411.html) ([wallet] Restore ability to list incoming transactions by label by ryanofsky)\n* [#14075](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14075.html) (Import watch only pubkeys to the keypool if private keys are disabled by achow101)\n* [#10973](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/10973.html) (Refactor: separate wallet from node by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2018-11-09T09:36:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-437303767",
      "id" : 437303767,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNzMwMzc2Nw==",
      "updated_at" : "2018-11-09T09:36:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/437303767",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2018-11-13T17:41:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-438366762",
      "id" : 438366762,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzODM2Njc2Mg==",
      "updated_at" : "2018-11-13T17:41:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/438366762",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r234431398"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/234431398"
         }
      },
      "author_association" : "MEMBER",
      "body" : "IMO this function name is misleading, it is not \"writing\" anywhere, it is a formatting function",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2018-11-18T07:11:05Z",
      "diff_hunk" : "@@ -587,6 +587,21 @@ bool ParseHDKeypath(const std::string& keypath_str, std::vector<uint32_t>& keypa\n     return true;\n }\n \n+std::string FormatKeyPath(const std::vector<uint32_t>& path)\n+{\n+    std::string ret;\n+    for (auto i : path) {\n+        ret += strprintf(\"/%i\", (i << 1) >> 1);\n+        if (i >> 31) ret += '\\'';\n+    }\n+    return ret;\n+}\n+\n+std::string WriteHdKeypath(const std::vector<uint32_t> keypath)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r234431398",
      "id" : 234431398,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzNDQzMTM5OA==",
      "original_commit_id" : "f78e8bce75861d3836c337f8b5d6ebd158cc6c11",
      "original_position" : 14,
      "path" : "src/util/strencodings.cpp",
      "position" : null,
      "pull_request_review_id" : 176078110,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/234431398",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r234431839"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/234431839"
         }
      },
      "author_association" : "MEMBER",
      "body" : "why not `std::copy()`?",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2018-11-18T07:29:06Z",
      "diff_hunk" : "@@ -4383,3 +4383,18 @@ bool CWallet::GetKeyOrigin(const CKeyID& keyID, KeyOriginInfo& info) const\n     }\n     return true;\n }\n+\n+bool CWallet::AddKeyOrigin(const CPubKey& pubkey, const KeyOriginInfo& info)\n+{\n+    LOCK(cs_wallet);\n+    std::vector<unsigned char> fingerprint_data(20, 0);\n+    fingerprint_data[0] = info.fingerprint[0];\n+    fingerprint_data[1] = info.fingerprint[1];\n+    fingerprint_data[2] = info.fingerprint[2];\n+    fingerprint_data[3] = info.fingerprint[3];",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r234431839",
      "id" : 234431839,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzNDQzMTgzOQ==",
      "original_commit_id" : "1e60b5eb28163178fac2aeeff01f804edf53f0ee",
      "original_position" : 12,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 176078110,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/234431839",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r234434357"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/234434357"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`master_key_id` will often be only filled with the fingerprint rather than the entire ID, perhaps make a note in the help text above or only output the first 4 bytes in that case rather than a lot of zeroes too?\r\n\r\nAn alternative is to just always store the fingerprint in metadata, never the whole key, because I don't think it's used anywhere else.",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2018-11-18T09:04:15Z",
      "diff_hunk" : "@@ -3536,7 +3536,9 @@ UniValue getaddressinfo(const JSONRPCRequest& request)\n         if (!meta->hdKeypath.empty()) {\n             ret.pushKV(\"hdkeypath\", meta->hdKeypath);\n             ret.pushKV(\"hdseedid\", meta->hd_seed_id.GetHex());\n-            ret.pushKV(\"hdmasterkeyid\", meta->hd_seed_id.GetHex());\n+            if (!meta->master_key_id.IsNull()) {\n+                ret.pushKV(\"hdmasterkeyid\", meta->master_key_id.GetHex());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r234434357",
      "id" : 234434357,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzNDQzNDM1Nw==",
      "original_commit_id" : "f1c55f7b3ccb036364a46de4648423b25543f868",
      "original_position" : 15,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 176078110,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/234434357",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r234434577"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/234434577"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why call twice? Is it just to have a non-zero keypath index? Perhaps add comment if deliberate",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2018-11-18T09:11:38Z",
      "diff_hunk" : "@@ -632,5 +639,52 @@ def run_test (self):\n         result = self.nodes[1].getaddressinfo(address[\"address\"])\n         assert_equal(result['ismine'], True)\n \n+        # Import pubkeys with key origin info\n+        self.log.info(\"Addresses should have hd keypath and master key id after import with key origin\")\n+        pub_addr = self.nodes[1].getnewaddress()\n+        pub_addr = self.nodes[1].getnewaddress()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r234434577",
      "id" : 234434577,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzNDQzNDU3Nw==",
      "original_commit_id" : "09995963827b7be1163a50d894490daf182b7a78",
      "original_position" : 21,
      "path" : "test/functional/wallet_importmulti.py",
      "position" : 7,
      "pull_request_review_id" : 176078110,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/234434577",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Without meaning to expand the number of PR's we need to keep track of, but if this is merged then the `dumpwallet` improvement in #11803 should be updated to look for `master_key_id`. Currently it won't print `master_key_id` and skips origin info.",
      "created_at" : "2018-11-20T17:19:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-440356170",
      "id" : 440356170,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0MDM1NjE3MA==",
      "updated_at" : "2018-11-20T17:29:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/440356170",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased",
      "created_at" : "2018-12-16T07:13:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-447622669",
      "id" : 447622669,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NzYyMjY2OQ==",
      "updated_at" : "2018-12-16T07:13:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/447622669",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2018-12-24T12:22:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-449727717",
      "id" : 449727717,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0OTcyNzcxNw==",
      "updated_at" : "2018-12-24T12:22:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/449727717",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased",
      "created_at" : "2018-12-24T15:27:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-449746584",
      "id" : 449746584,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0OTc0NjU4NA==",
      "updated_at" : "2018-12-24T15:27:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/449746584",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r243854205"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/243854205"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've changed this to use the fingerprint by adding `KeyOriginInfo` to `CKeyMetadata`.",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2018-12-24T19:20:56Z",
      "diff_hunk" : "@@ -3536,7 +3536,9 @@ UniValue getaddressinfo(const JSONRPCRequest& request)\n         if (!meta->hdKeypath.empty()) {\n             ret.pushKV(\"hdkeypath\", meta->hdKeypath);\n             ret.pushKV(\"hdseedid\", meta->hd_seed_id.GetHex());\n-            ret.pushKV(\"hdmasterkeyid\", meta->hd_seed_id.GetHex());\n+            if (!meta->master_key_id.IsNull()) {\n+                ret.pushKV(\"hdmasterkeyid\", meta->master_key_id.GetHex());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r243854205",
      "id" : 243854205,
      "in_reply_to_id" : 234434357,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0Mzg1NDIwNQ==",
      "original_commit_id" : "f1c55f7b3ccb036364a46de4648423b25543f868",
      "original_position" : 15,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 187726762,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/243854205",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r243854211"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/243854211"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added a comment.",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2018-12-24T19:21:04Z",
      "diff_hunk" : "@@ -632,5 +639,52 @@ def run_test (self):\n         result = self.nodes[1].getaddressinfo(address[\"address\"])\n         assert_equal(result['ismine'], True)\n \n+        # Import pubkeys with key origin info\n+        self.log.info(\"Addresses should have hd keypath and master key id after import with key origin\")\n+        pub_addr = self.nodes[1].getnewaddress()\n+        pub_addr = self.nodes[1].getnewaddress()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r243854211",
      "id" : 243854211,
      "in_reply_to_id" : 234434577,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0Mzg1NDIxMQ==",
      "original_commit_id" : "09995963827b7be1163a50d894490daf182b7a78",
      "original_position" : 21,
      "path" : "test/functional/wallet_importmulti.py",
      "position" : 7,
      "pull_request_review_id" : 187726768,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/243854211",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255297110"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255297110"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: add documentation",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-09T12:19:11Z",
      "diff_hunk" : "@@ -177,6 +177,7 @@ class WalletBatch\n     bool WriteTx(const CWalletTx& wtx);\n     bool EraseTx(uint256 hash);\n \n+    bool WriteKeyMetadata(const CKeyMetadata& meta, const CPubKey& pubkey, const bool overwrite);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255297110",
      "id" : 255297110,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTI5NzExMA==",
      "original_commit_id" : "b1b35b88a2e64ee07e74cc90b346ce2fc417bb7b",
      "original_position" : 4,
      "path" : "src/wallet/walletdb.h",
      "position" : 50,
      "pull_request_review_id" : 201861254,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255297110",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255297257"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255297257"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: `ALso`\r\n\r\nSee above comment, I prefer adding a `bool` to explicitly track if a key is a seed. ",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-09T12:25:57Z",
      "diff_hunk" : "@@ -93,11 +94,13 @@ class CKeyMetadata\n public:\n     static const int VERSION_BASIC=1;\n     static const int VERSION_WITH_HDDATA=10;\n-    static const int CURRENT_VERSION=VERSION_WITH_HDDATA;\n+    static const int VERSION_WITH_KEY_ORIGIN = 12;\n+    static const int CURRENT_VERSION=VERSION_WITH_KEY_ORIGIN;\n     int nVersion;\n     int64_t nCreateTime; // 0 means unknown\n-    std::string hdKeypath; //optional HD/bip32 keypath\n+    std::string hdKeypath; //optional HD/bip32 keypath. Still used to determine whether a key is a seed. ALso kept for backwards compatibility",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255297257",
      "id" : 255297257,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTI5NzI1Nw==",
      "original_commit_id" : "066762f02178b2f39581f903841e75694853d8b7",
      "original_position" : 18,
      "path" : "src/wallet/walletdb.h",
      "position" : null,
      "pull_request_review_id" : 201861254,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255297257",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255297318"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255297318"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Note for other reviewers: we process `hdKeyPath` and add `key_origin` equivalents in `CWallet::UpgradeKeyMetadata()`. So there's no case where `key_origin.IsNull()` without also `meta->hdKeypath.empty()` ",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-09T12:29:03Z",
      "diff_hunk" : "@@ -3715,10 +3715,10 @@ UniValue getaddressinfo(const JSONRPCRequest& request)\n     }\n     if (meta) {\n         ret.pushKV(\"timestamp\", meta->nCreateTime);\n-        if (!meta->hdKeypath.empty()) {\n-            ret.pushKV(\"hdkeypath\", meta->hdKeypath);\n+        if (!meta->key_origin.IsNull()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255297318",
      "id" : 255297318,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTI5NzMxOA==",
      "original_commit_id" : "066762f02178b2f39581f903841e75694853d8b7",
      "original_position" : 15,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 201861254,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255297318",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255297333"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255297333"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: `key_origin` should have a `ToString()` method (you're adding something like this in a later commit, though that's for the whole origin)",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-09T12:29:37Z",
      "diff_hunk" : "@@ -3715,10 +3715,10 @@ UniValue getaddressinfo(const JSONRPCRequest& request)\n     }\n     if (meta) {\n         ret.pushKV(\"timestamp\", meta->nCreateTime);\n-        if (!meta->hdKeypath.empty()) {\n-            ret.pushKV(\"hdkeypath\", meta->hdKeypath);\n+        if (!meta->key_origin.IsNull()) {\n+            ret.pushKV(\"hdkeypath\", WriteHdKeypath(meta->key_origin.path));\n             ret.pushKV(\"hdseedid\", meta->hd_seed_id.GetHex());\n-            ret.pushKV(\"hdmasterkeyid\", meta->hd_seed_id.GetHex());\n+            ret.pushKV(\"hdmasterfingerprint\", HexStr(meta->key_origin.fingerprint, meta->key_origin.fingerprint + 4));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255297333",
      "id" : 255297333,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTI5NzMzMw==",
      "original_commit_id" : "066762f02178b2f39581f903841e75694853d8b7",
      "original_position" : 19,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 43,
      "pull_request_review_id" : 201861254,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255297333",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255297793"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255297793"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: why not make `fingerprint` a ~ `std::vector<unsigned char>` and use `clear()` on it too?",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-09T12:49:23Z",
      "diff_hunk" : "@@ -29,6 +29,25 @@ struct KeyOriginInfo\n     {\n         return std::equal(std::begin(a.fingerprint), std::end(a.fingerprint), std::begin(b.fingerprint)) && a.path == b.path;\n     }\n+\n+    ADD_SERIALIZE_METHODS;\n+    template <typename Stream, typename Operation>\n+    inline void SerializationOp(Stream& s, Operation ser_action)\n+    {\n+        READWRITE(fingerprint);\n+        READWRITE(path);\n+    }\n+\n+    void SetNull()\n+    {\n+        memset(fingerprint, 0, 4);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255297793",
      "id" : 255297793,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTI5Nzc5Mw==",
      "original_commit_id" : "066762f02178b2f39581f903841e75694853d8b7",
      "original_position" : 15,
      "path" : "src/script/sign.h",
      "position" : 23,
      "pull_request_review_id" : 201861254,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255297793",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255298564"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255298564"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: add comment to explain what `hdKeypath != \"s\"` means.",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-09T13:19:09Z",
      "diff_hunk" : "@@ -329,6 +337,36 @@ bool CWallet::WriteKeyMetadata(const CKeyMetadata& meta, const CPubKey& pubkey,\n     return WalletBatch(*database).WriteKeyMetadata(meta, pubkey, overwrite);\n }\n \n+void CWallet::UpgradeKeyMetadata()\n+{\n+    AssertLockHeld(cs_wallet); // mapKeyMetadata\n+\n+    for (auto& meta_pair : mapKeyMetadata) {\n+        CKeyMetadata& meta = meta_pair.second;\n+        if (!meta.hd_seed_id.IsNull() && meta.key_origin.IsNull() && meta.hdKeypath != \"s\") {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255298564",
      "id" : 255298564,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTI5ODU2NA==",
      "original_commit_id" : "066762f02178b2f39581f903841e75694853d8b7",
      "original_position" : 35,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 201861254,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255298564",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255298753"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255298753"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: suggest adding a comment to `unsigned char fingerprint[4];` above:\r\n```\r\n// BIP32 defines the key identifier as the RIPEMD160 after SHA256 of\r\n// the serialized ECDSA public key K, ignoring the chain code. The first 32 bits\r\n// of this is the key fingerprint.\r\n```",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-09T13:26:39Z",
      "diff_hunk" : "@@ -29,6 +29,25 @@ struct KeyOriginInfo\n     {\n         return std::equal(std::begin(a.fingerprint), std::end(a.fingerprint), std::begin(b.fingerprint)) && a.path == b.path;\n     }\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255298753",
      "id" : 255298753,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTI5ODc1Mw==",
      "original_commit_id" : "066762f02178b2f39581f903841e75694853d8b7",
      "original_position" : 4,
      "path" : "src/script/sign.h",
      "position" : 12,
      "pull_request_review_id" : 201861254,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255298753",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255298989"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255298989"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: add ` This wallet can't be safely upgraded and can't be opened by this version of Bitcoin Core.`\r\n\r\nIs this entire upgrade atomic, or is it atomic per `WriteKeyMetadata`? Otherwise you might end up with some upgraded keys and then an error. Then the previous version of the wallet can't open it anymore (if only for the user to call `dumpwallet`). In that case it's safer to call `ParseHDKeypath` on all keys before saving any.",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-09T13:36:27Z",
      "diff_hunk" : "@@ -329,6 +337,36 @@ bool CWallet::WriteKeyMetadata(const CKeyMetadata& meta, const CPubKey& pubkey,\n     return WalletBatch(*database).WriteKeyMetadata(meta, pubkey, overwrite);\n }\n \n+void CWallet::UpgradeKeyMetadata()\n+{\n+    AssertLockHeld(cs_wallet); // mapKeyMetadata\n+\n+    for (auto& meta_pair : mapKeyMetadata) {\n+        CKeyMetadata& meta = meta_pair.second;\n+        if (!meta.hd_seed_id.IsNull() && meta.key_origin.IsNull() && meta.hdKeypath != \"s\") {\n+            CKey key;\n+            GetKey(meta.hd_seed_id, key);\n+            CExtKey masterKey;\n+            masterKey.SetSeed(key.begin(), key.size());\n+            // Add to map\n+            CKeyID master_id = masterKey.key.GetPubKey().GetID();\n+            std::copy(master_id.begin(), master_id.begin() + 4, meta.key_origin.fingerprint);\n+            if (!ParseHDKeypath(meta.hdKeypath, meta.key_origin.path)) {\n+                throw std::runtime_error(\"Invalid stored hdKeypath\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255298989",
      "id" : 255298989,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTI5ODk4OQ==",
      "original_commit_id" : "066762f02178b2f39581f903841e75694853d8b7",
      "original_position" : 44,
      "path" : "src/wallet/wallet.cpp",
      "position" : 62,
      "pull_request_review_id" : 201861254,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255298989",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255299218"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255299218"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit-ish: let's just add a boolean `IsSeed` to `metadata`, so we don't have to keep `hdKeypath` around forever (can be done later, but would require another upgrade function).",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-09T13:44:39Z",
      "diff_hunk" : "@@ -1380,6 +1418,7 @@ CPubKey CWallet::DeriveNewSeed(const CKey& key)\n \n     // set the hd keypath to \"s\" -> Seed, refers the seed to itself\n     metadata.hdKeypath     = \"s\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255299218",
      "id" : 255299218,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTI5OTIxOA==",
      "original_commit_id" : "066762f02178b2f39581f903841e75694853d8b7",
      "original_position" : 65,
      "path" : "src/wallet/wallet.cpp",
      "position" : 98,
      "pull_request_review_id" : 201861254,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255299218",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255299383"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255299383"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Didn't the imported keys already have a metadata entry? If so, then shouldn't you only replace the timestamp if absent? ",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-09T13:53:52Z",
      "diff_hunk" : "@@ -1260,6 +1261,8 @@ static UniValue ProcessImport(CWallet * const pwallet, const UniValue& data, con\n             if (!pwallet->GetPubKey(id, temp) && !pwallet->AddWatchOnly(GetScriptForRawPubKey(pubkey), timestamp)) {\n                 throw JSONRPCError(RPC_WALLET_ERROR, \"Error adding address to wallet\");\n             }\n+            pwallet->AddKeyOrigin(pubkey, import_data.key_origins[id]);\n+            pwallet->mapKeyMetadata[id].nCreateTime = timestamp;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255299383",
      "id" : 255299383,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTI5OTM4Mw==",
      "original_commit_id" : "7e3eaebd0c490d163f89bef0dbc373c578331606",
      "original_position" : 22,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 42,
      "pull_request_review_id" : 201861254,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255299383",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Why are you hardcoding a maximum derivation depth of 4?\r\n\r\nI'm not. Where do you see that it does?",
      "created_at" : "2019-02-11T01:58:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-462203035",
      "id" : 462203035,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MjIwMzAzNQ==",
      "updated_at" : "2019-02-11T01:58:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/462203035",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255369781"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255369781"
         }
      },
      "author_association" : "MEMBER",
      "body" : "A `key_origin` `ToString()` method would print both the fingerprint and path. This only needs the fingerprint.",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-11T02:03:57Z",
      "diff_hunk" : "@@ -3715,10 +3715,10 @@ UniValue getaddressinfo(const JSONRPCRequest& request)\n     }\n     if (meta) {\n         ret.pushKV(\"timestamp\", meta->nCreateTime);\n-        if (!meta->hdKeypath.empty()) {\n-            ret.pushKV(\"hdkeypath\", meta->hdKeypath);\n+        if (!meta->key_origin.IsNull()) {\n+            ret.pushKV(\"hdkeypath\", WriteHdKeypath(meta->key_origin.path));\n             ret.pushKV(\"hdseedid\", meta->hd_seed_id.GetHex());\n-            ret.pushKV(\"hdmasterkeyid\", meta->hd_seed_id.GetHex());\n+            ret.pushKV(\"hdmasterfingerprint\", HexStr(meta->key_origin.fingerprint, meta->key_origin.fingerprint + 4));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255369781",
      "id" : 255369781,
      "in_reply_to_id" : 255297333,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTM2OTc4MQ==",
      "original_commit_id" : "066762f02178b2f39581f903841e75694853d8b7",
      "original_position" : 19,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 43,
      "pull_request_review_id" : 201937502,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255369781",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255369801"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255369801"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Arrays use less space. This field doesn't need to be dynamic.",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-11T02:04:21Z",
      "diff_hunk" : "@@ -29,6 +29,25 @@ struct KeyOriginInfo\n     {\n         return std::equal(std::begin(a.fingerprint), std::end(a.fingerprint), std::begin(b.fingerprint)) && a.path == b.path;\n     }\n+\n+    ADD_SERIALIZE_METHODS;\n+    template <typename Stream, typename Operation>\n+    inline void SerializationOp(Stream& s, Operation ser_action)\n+    {\n+        READWRITE(fingerprint);\n+        READWRITE(path);\n+    }\n+\n+    void SetNull()\n+    {\n+        memset(fingerprint, 0, 4);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255369801",
      "id" : 255369801,
      "in_reply_to_id" : 255297793,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTM2OTgwMQ==",
      "original_commit_id" : "066762f02178b2f39581f903841e75694853d8b7",
      "original_position" : 15,
      "path" : "src/script/sign.h",
      "position" : 23,
      "pull_request_review_id" : 201937531,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255369801",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255370086"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255370086"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It is atomic per `WriteKeyMetadata`. However I believe that the changes to `CKeyMetadata` are backwards compatible. My understanding of the serialization code is that data at the end of the stream is ignored. So upgraded `CKeyMetadata` should still be open-able in older software.",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-11T02:09:51Z",
      "diff_hunk" : "@@ -329,6 +337,36 @@ bool CWallet::WriteKeyMetadata(const CKeyMetadata& meta, const CPubKey& pubkey,\n     return WalletBatch(*database).WriteKeyMetadata(meta, pubkey, overwrite);\n }\n \n+void CWallet::UpgradeKeyMetadata()\n+{\n+    AssertLockHeld(cs_wallet); // mapKeyMetadata\n+\n+    for (auto& meta_pair : mapKeyMetadata) {\n+        CKeyMetadata& meta = meta_pair.second;\n+        if (!meta.hd_seed_id.IsNull() && meta.key_origin.IsNull() && meta.hdKeypath != \"s\") {\n+            CKey key;\n+            GetKey(meta.hd_seed_id, key);\n+            CExtKey masterKey;\n+            masterKey.SetSeed(key.begin(), key.size());\n+            // Add to map\n+            CKeyID master_id = masterKey.key.GetPubKey().GetID();\n+            std::copy(master_id.begin(), master_id.begin() + 4, meta.key_origin.fingerprint);\n+            if (!ParseHDKeypath(meta.hdKeypath, meta.key_origin.path)) {\n+                throw std::runtime_error(\"Invalid stored hdKeypath\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255370086",
      "id" : 255370086,
      "in_reply_to_id" : 255298989,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTM3MDA4Ng==",
      "original_commit_id" : "066762f02178b2f39581f903841e75694853d8b7",
      "original_position" : 44,
      "path" : "src/wallet/wallet.cpp",
      "position" : 62,
      "pull_request_review_id" : 201937868,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255370086",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255370121"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255370121"
         }
      },
      "author_association" : "MEMBER",
      "body" : "We need to keep `hdKeypath` forever as `CKeyMetadata` is backwards compatible. Might as well use it.",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-11T02:10:18Z",
      "diff_hunk" : "@@ -1380,6 +1418,7 @@ CPubKey CWallet::DeriveNewSeed(const CKey& key)\n \n     // set the hd keypath to \"s\" -> Seed, refers the seed to itself\n     metadata.hdKeypath     = \"s\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255370121",
      "id" : 255370121,
      "in_reply_to_id" : 255299218,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTM3MDEyMQ==",
      "original_commit_id" : "066762f02178b2f39581f903841e75694853d8b7",
      "original_position" : 65,
      "path" : "src/wallet/wallet.cpp",
      "position" : 98,
      "pull_request_review_id" : 201937905,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255370121",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255370262"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255370262"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Only new things can be imported, so there shouldn't already be an existing metadata entry.",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-11T02:12:20Z",
      "diff_hunk" : "@@ -1260,6 +1261,8 @@ static UniValue ProcessImport(CWallet * const pwallet, const UniValue& data, con\n             if (!pwallet->GetPubKey(id, temp) && !pwallet->AddWatchOnly(GetScriptForRawPubKey(pubkey), timestamp)) {\n                 throw JSONRPCError(RPC_WALLET_ERROR, \"Error adding address to wallet\");\n             }\n+            pwallet->AddKeyOrigin(pubkey, import_data.key_origins[id]);\n+            pwallet->mapKeyMetadata[id].nCreateTime = timestamp;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255370262",
      "id" : 255370262,
      "in_reply_to_id" : 255299383,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTM3MDI2Mg==",
      "original_commit_id" : "7e3eaebd0c490d163f89bef0dbc373c578331606",
      "original_position" : 22,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 42,
      "pull_request_review_id" : 201938047,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255370262",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255370532"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255370532"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added a comment",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-11T02:17:03Z",
      "diff_hunk" : "@@ -177,6 +177,7 @@ class WalletBatch\n     bool WriteTx(const CWalletTx& wtx);\n     bool EraseTx(uint256 hash);\n \n+    bool WriteKeyMetadata(const CKeyMetadata& meta, const CPubKey& pubkey, const bool overwrite);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255370532",
      "id" : 255370532,
      "in_reply_to_id" : 255297110,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTM3MDUzMg==",
      "original_commit_id" : "b1b35b88a2e64ee07e74cc90b346ce2fc417bb7b",
      "original_position" : 4,
      "path" : "src/wallet/walletdb.h",
      "position" : 50,
      "pull_request_review_id" : 201938372,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255370532",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255370544"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255370544"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed typo",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-11T02:17:12Z",
      "diff_hunk" : "@@ -93,11 +94,13 @@ class CKeyMetadata\n public:\n     static const int VERSION_BASIC=1;\n     static const int VERSION_WITH_HDDATA=10;\n-    static const int CURRENT_VERSION=VERSION_WITH_HDDATA;\n+    static const int VERSION_WITH_KEY_ORIGIN = 12;\n+    static const int CURRENT_VERSION=VERSION_WITH_KEY_ORIGIN;\n     int nVersion;\n     int64_t nCreateTime; // 0 means unknown\n-    std::string hdKeypath; //optional HD/bip32 keypath\n+    std::string hdKeypath; //optional HD/bip32 keypath. Still used to determine whether a key is a seed. ALso kept for backwards compatibility",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255370544",
      "id" : 255370544,
      "in_reply_to_id" : 255297257,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTM3MDU0NA==",
      "original_commit_id" : "066762f02178b2f39581f903841e75694853d8b7",
      "original_position" : 18,
      "path" : "src/wallet/walletdb.h",
      "position" : null,
      "pull_request_review_id" : 201938384,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255370544",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255370557"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255370557"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-11T02:17:20Z",
      "diff_hunk" : "@@ -329,6 +337,36 @@ bool CWallet::WriteKeyMetadata(const CKeyMetadata& meta, const CPubKey& pubkey,\n     return WalletBatch(*database).WriteKeyMetadata(meta, pubkey, overwrite);\n }\n \n+void CWallet::UpgradeKeyMetadata()\n+{\n+    AssertLockHeld(cs_wallet); // mapKeyMetadata\n+\n+    for (auto& meta_pair : mapKeyMetadata) {\n+        CKeyMetadata& meta = meta_pair.second;\n+        if (!meta.hd_seed_id.IsNull() && meta.key_origin.IsNull() && meta.hdKeypath != \"s\") {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255370557",
      "id" : 255370557,
      "in_reply_to_id" : 255298564,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTM3MDU1Nw==",
      "original_commit_id" : "066762f02178b2f39581f903841e75694853d8b7",
      "original_position" : 35,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 201938395,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255370557",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255370567"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255370567"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added a comment",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-11T02:17:27Z",
      "diff_hunk" : "@@ -29,6 +29,25 @@ struct KeyOriginInfo\n     {\n         return std::equal(std::begin(a.fingerprint), std::end(a.fingerprint), std::begin(b.fingerprint)) && a.path == b.path;\n     }\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255370567",
      "id" : 255370567,
      "in_reply_to_id" : 255298753,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTM3MDU2Nw==",
      "original_commit_id" : "066762f02178b2f39581f903841e75694853d8b7",
      "original_position" : 4,
      "path" : "src/script/sign.h",
      "position" : 12,
      "pull_request_review_id" : 201938408,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255370567",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255373437"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255373437"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think the space savings is worth dealing with IsNull verbosity and the magic number(4).",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-11T03:02:40Z",
      "diff_hunk" : "@@ -29,6 +29,25 @@ struct KeyOriginInfo\n     {\n         return std::equal(std::begin(a.fingerprint), std::end(a.fingerprint), std::begin(b.fingerprint)) && a.path == b.path;\n     }\n+\n+    ADD_SERIALIZE_METHODS;\n+    template <typename Stream, typename Operation>\n+    inline void SerializationOp(Stream& s, Operation ser_action)\n+    {\n+        READWRITE(fingerprint);\n+        READWRITE(path);\n+    }\n+\n+    void SetNull()\n+    {\n+        memset(fingerprint, 0, 4);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255373437",
      "id" : 255373437,
      "in_reply_to_id" : 255297793,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTM3MzQzNw==",
      "original_commit_id" : "066762f02178b2f39581f903841e75694853d8b7",
      "original_position" : 15,
      "path" : "src/script/sign.h",
      "position" : 23,
      "pull_request_review_id" : 201941925,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255373437",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255374083"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255374083"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This needs a description of what it's doing.",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-11T03:12:41Z",
      "diff_hunk" : "@@ -855,6 +855,7 @@ class CWallet final : public CCryptoKeyStore, public CValidationInterface\n     //! Load metadata (used by LoadWallet)\n     void LoadKeyMetadata(const CKeyID& keyID, const CKeyMetadata &metadata) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n     void LoadScriptMetadata(const CScriptID& script_id, const CKeyMetadata &metadata) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n+    void UpgradeKeyMetadata();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255374083",
      "id" : 255374083,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTM3NDA4Mw==",
      "original_commit_id" : "82396ec29d730029532374e18727496cbf4066e6",
      "original_position" : 4,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 201941925,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255374083",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255374325"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255374325"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Since this is called on load, does the user need to unlock an encrypted wallet?",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-11T03:15:34Z",
      "diff_hunk" : "@@ -330,6 +338,36 @@ bool CWallet::WriteKeyMetadata(const CKeyMetadata& meta, const CPubKey& pubkey,\n     return WalletBatch(*database).WriteKeyMetadata(meta, pubkey, overwrite);\n }\n \n+void CWallet::UpgradeKeyMetadata()\n+{\n+    AssertLockHeld(cs_wallet); // mapKeyMetadata\n+\n+    for (auto& meta_pair : mapKeyMetadata) {\n+        CKeyMetadata& meta = meta_pair.second;\n+        if (!meta.hd_seed_id.IsNull() && meta.key_origin.IsNull() && meta.hdKeypath != \"s\") { // If the hdKeypath is \"s\", that's the seed and it doesn't have a key origin\n+            CKey key;\n+            GetKey(meta.hd_seed_id, key);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255374325",
      "id" : 255374325,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTM3NDMyNQ==",
      "original_commit_id" : "82396ec29d730029532374e18727496cbf4066e6",
      "original_position" : 37,
      "path" : "src/wallet/wallet.cpp",
      "position" : 55,
      "pull_request_review_id" : 201941925,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255374325",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255374743"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255374743"
         }
      },
      "author_association" : "MEMBER",
      "body" : "why no 11 :(",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-11T03:20:56Z",
      "diff_hunk" : "@@ -93,11 +94,13 @@ class CKeyMetadata\n public:\n     static const int VERSION_BASIC=1;\n     static const int VERSION_WITH_HDDATA=10;\n-    static const int CURRENT_VERSION=VERSION_WITH_HDDATA;\n+    static const int VERSION_WITH_KEY_ORIGIN = 12;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255374743",
      "id" : 255374743,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTM3NDc0Mw==",
      "original_commit_id" : "82396ec29d730029532374e18727496cbf4066e6",
      "original_position" : 13,
      "path" : "src/wallet/walletdb.h",
      "position" : 13,
      "pull_request_review_id" : 201941925,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255374743",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255378656"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255378656"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This was something that was already here and I don't think it is necessary to change it.",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-11T04:15:47Z",
      "diff_hunk" : "@@ -29,6 +29,25 @@ struct KeyOriginInfo\n     {\n         return std::equal(std::begin(a.fingerprint), std::end(a.fingerprint), std::begin(b.fingerprint)) && a.path == b.path;\n     }\n+\n+    ADD_SERIALIZE_METHODS;\n+    template <typename Stream, typename Operation>\n+    inline void SerializationOp(Stream& s, Operation ser_action)\n+    {\n+        READWRITE(fingerprint);\n+        READWRITE(path);\n+    }\n+\n+    void SetNull()\n+    {\n+        memset(fingerprint, 0, 4);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255378656",
      "id" : 255378656,
      "in_reply_to_id" : 255297793,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTM3ODY1Ng==",
      "original_commit_id" : "066762f02178b2f39581f903841e75694853d8b7",
      "original_position" : 15,
      "path" : "src/script/sign.h",
      "position" : 23,
      "pull_request_review_id" : 201948284,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255378656",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255378943"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255378943"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Hmm. I think it will. There is currently no way to get the master key fingerprint without generating it from the hd seed.",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-11T04:19:41Z",
      "diff_hunk" : "@@ -330,6 +338,36 @@ bool CWallet::WriteKeyMetadata(const CKeyMetadata& meta, const CPubKey& pubkey,\n     return WalletBatch(*database).WriteKeyMetadata(meta, pubkey, overwrite);\n }\n \n+void CWallet::UpgradeKeyMetadata()\n+{\n+    AssertLockHeld(cs_wallet); // mapKeyMetadata\n+\n+    for (auto& meta_pair : mapKeyMetadata) {\n+        CKeyMetadata& meta = meta_pair.second;\n+        if (!meta.hd_seed_id.IsNull() && meta.key_origin.IsNull() && meta.hdKeypath != \"s\") { // If the hdKeypath is \"s\", that's the seed and it doesn't have a key origin\n+            CKey key;\n+            GetKey(meta.hd_seed_id, key);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255378943",
      "id" : 255378943,
      "in_reply_to_id" : 255374325,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTM3ODk0Mw==",
      "original_commit_id" : "82396ec29d730029532374e18727496cbf4066e6",
      "original_position" : 37,
      "path" : "src/wallet/wallet.cpp",
      "position" : 55,
      "pull_request_review_id" : 201948613,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255378943",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255379004"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255379004"
         }
      },
      "author_association" : "MEMBER",
      "body" : "A previous version of this pr used version 11 and I did not want to cause wallets that had tested that pr to become unusable.",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-11T04:20:27Z",
      "diff_hunk" : "@@ -93,11 +94,13 @@ class CKeyMetadata\n public:\n     static const int VERSION_BASIC=1;\n     static const int VERSION_WITH_HDDATA=10;\n-    static const int CURRENT_VERSION=VERSION_WITH_HDDATA;\n+    static const int VERSION_WITH_KEY_ORIGIN = 12;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255379004",
      "id" : 255379004,
      "in_reply_to_id" : 255374743,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTM3OTAwNA==",
      "original_commit_id" : "82396ec29d730029532374e18727496cbf4066e6",
      "original_position" : 13,
      "path" : "src/wallet/walletdb.h",
      "position" : 13,
      "pull_request_review_id" : 201948678,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255379004",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255379287"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255379287"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-11T04:24:38Z",
      "diff_hunk" : "@@ -855,6 +855,7 @@ class CWallet final : public CCryptoKeyStore, public CValidationInterface\n     //! Load metadata (used by LoadWallet)\n     void LoadKeyMetadata(const CKeyID& keyID, const CKeyMetadata &metadata) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n     void LoadScriptMetadata(const CScriptID& script_id, const CKeyMetadata &metadata) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n+    void UpgradeKeyMetadata();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255379287",
      "id" : 255379287,
      "in_reply_to_id" : 255374083,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTM3OTI4Nw==",
      "original_commit_id" : "82396ec29d730029532374e18727496cbf4066e6",
      "original_position" : 4,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 201949004,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255379287",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255408499"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255408499"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, I also noticed I was able to open (non-blank) 0.18 wallets in 0.17.",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-11T08:29:07Z",
      "diff_hunk" : "@@ -329,6 +337,36 @@ bool CWallet::WriteKeyMetadata(const CKeyMetadata& meta, const CPubKey& pubkey,\n     return WalletBatch(*database).WriteKeyMetadata(meta, pubkey, overwrite);\n }\n \n+void CWallet::UpgradeKeyMetadata()\n+{\n+    AssertLockHeld(cs_wallet); // mapKeyMetadata\n+\n+    for (auto& meta_pair : mapKeyMetadata) {\n+        CKeyMetadata& meta = meta_pair.second;\n+        if (!meta.hd_seed_id.IsNull() && meta.key_origin.IsNull() && meta.hdKeypath != \"s\") {\n+            CKey key;\n+            GetKey(meta.hd_seed_id, key);\n+            CExtKey masterKey;\n+            masterKey.SetSeed(key.begin(), key.size());\n+            // Add to map\n+            CKeyID master_id = masterKey.key.GetPubKey().GetID();\n+            std::copy(master_id.begin(), master_id.begin() + 4, meta.key_origin.fingerprint);\n+            if (!ParseHDKeypath(meta.hdKeypath, meta.key_origin.path)) {\n+                throw std::runtime_error(\"Invalid stored hdKeypath\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255408499",
      "id" : 255408499,
      "in_reply_to_id" : 255298989,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTQwODQ5OQ==",
      "original_commit_id" : "066762f02178b2f39581f903841e75694853d8b7",
      "original_position" : 44,
      "path" : "src/wallet/wallet.cpp",
      "position" : 62,
      "pull_request_review_id" : 201984474,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255408499",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255409004"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255409004"
         }
      },
      "author_association" : "MEMBER",
      "body" : "From my experience older hww branch wallets are already unusable so I wouldn't worry too much about that :-)",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-11T08:31:11Z",
      "diff_hunk" : "@@ -93,11 +94,13 @@ class CKeyMetadata\n public:\n     static const int VERSION_BASIC=1;\n     static const int VERSION_WITH_HDDATA=10;\n-    static const int CURRENT_VERSION=VERSION_WITH_HDDATA;\n+    static const int VERSION_WITH_KEY_ORIGIN = 12;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255409004",
      "id" : 255409004,
      "in_reply_to_id" : 255374743,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTQwOTAwNA==",
      "original_commit_id" : "82396ec29d730029532374e18727496cbf4066e6",
      "original_position" : 13,
      "path" : "src/wallet/walletdb.h",
      "position" : 13,
      "pull_request_review_id" : 201985105,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255409004",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@achow101 oops, I was confusing the fingerprint (fixed size 4) with path (already a vector). All good then!\r\n\r\nutACK 7f84a25, changes since last tACK:\r\n* more comments\r\n* using insert:\r\n<img width=\"639\" alt=\"schermafbeelding 2019-02-11 om 09 37 44\" src=\"https://user-images.githubusercontent.com/10217/52552515-d1f61380-2de0-11e9-99e4-1e10040becf6.png\">\r\n",
      "created_at" : "2019-02-11T08:39:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-462251161",
      "id" : 462251161,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MjI1MTE2MQ==",
      "updated_at" : "2019-02-11T08:39:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/462251161",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255566362"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255566362"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'd like to know what's going to happen here, but we should at least be checking the result here to not calculate bogus data, yes?",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-11T15:49:44Z",
      "diff_hunk" : "@@ -330,6 +338,36 @@ bool CWallet::WriteKeyMetadata(const CKeyMetadata& meta, const CPubKey& pubkey,\n     return WalletBatch(*database).WriteKeyMetadata(meta, pubkey, overwrite);\n }\n \n+void CWallet::UpgradeKeyMetadata()\n+{\n+    AssertLockHeld(cs_wallet); // mapKeyMetadata\n+\n+    for (auto& meta_pair : mapKeyMetadata) {\n+        CKeyMetadata& meta = meta_pair.second;\n+        if (!meta.hd_seed_id.IsNull() && meta.key_origin.IsNull() && meta.hdKeypath != \"s\") { // If the hdKeypath is \"s\", that's the seed and it doesn't have a key origin\n+            CKey key;\n+            GetKey(meta.hd_seed_id, key);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255566362",
      "id" : 255566362,
      "in_reply_to_id" : 255374325,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTU2NjM2Mg==",
      "original_commit_id" : "82396ec29d730029532374e18727496cbf4066e6",
      "original_position" : 37,
      "path" : "src/wallet/wallet.cpp",
      "position" : 55,
      "pull_request_review_id" : 202180122,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255566362",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255628568"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255628568"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think it will write bogus data.\r\n\r\nThere are a few options to solve this. We could not upgrade the key metadata if we can't calculate the master key id. Or we could use the hd seed id instead if the correct master key id can't be calculated.\r\n\r\nI am tending to go towards the second solution. While it technically is not the master key id, this information is really only used for/needed for descriptors and PSBT. Any wallet that already exists does not need this information. If this ends up in PSBT, that's fine since the BIP 32 derivation paths are just information for the signer. In this case, the signer is Bitcoin Core, and it doesn't use the derivation paths. We just need to put something there that won't cause problems for other signers.",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-11T18:09:06Z",
      "diff_hunk" : "@@ -330,6 +338,36 @@ bool CWallet::WriteKeyMetadata(const CKeyMetadata& meta, const CPubKey& pubkey,\n     return WalletBatch(*database).WriteKeyMetadata(meta, pubkey, overwrite);\n }\n \n+void CWallet::UpgradeKeyMetadata()\n+{\n+    AssertLockHeld(cs_wallet); // mapKeyMetadata\n+\n+    for (auto& meta_pair : mapKeyMetadata) {\n+        CKeyMetadata& meta = meta_pair.second;\n+        if (!meta.hd_seed_id.IsNull() && meta.key_origin.IsNull() && meta.hdKeypath != \"s\") { // If the hdKeypath is \"s\", that's the seed and it doesn't have a key origin\n+            CKey key;\n+            GetKey(meta.hd_seed_id, key);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255628568",
      "id" : 255628568,
      "in_reply_to_id" : 255374325,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTYyODU2OA==",
      "original_commit_id" : "82396ec29d730029532374e18727496cbf4066e6",
      "original_position" : 37,
      "path" : "src/wallet/wallet.cpp",
      "position" : 55,
      "pull_request_review_id" : 202257150,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255628568",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255749209"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255749209"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This PR removes some but not all of the hdmasterkeyid fields, suggest having a separate commit that removes all of them at once.",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-12T00:09:06Z",
      "diff_hunk" : "@@ -3652,7 +3652,7 @@ UniValue getaddressinfo(const JSONRPCRequest& request)\n             \"  \\\"timestamp\\\" : timestamp,      (number, optional) The creation time of the key if available in seconds since epoch (Jan 1 1970 GMT)\\n\"\n             \"  \\\"hdkeypath\\\" : \\\"keypath\\\"       (string, optional) The HD keypath if the key is HD and available\\n\"\n             \"  \\\"hdseedid\\\" : \\\"<hash160>\\\"      (string, optional) The Hash160 of the HD seed\\n\"\n-            \"  \\\"hdmasterkeyid\\\" : \\\"<hash160>\\\" (string, optional) alias for hdseedid maintained for backwards compatibility. Will be removed in V0.18.\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255749209",
      "id" : 255749209,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTc0OTIwOQ==",
      "original_commit_id" : "0cf1c4ca12982533a8d38f2e09aa17f3839c538b",
      "original_position" : 4,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 28,
      "pull_request_review_id" : 202410360,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255749209",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255759286"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255759286"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This is a bit confusing. `fingerprint` has a 1 in 4 billion chance of legitimately being [0,0,0,0] from what I can see, and there's a code path that sets `fingerprint` but clears `path` (script/descriptor.cpp:ConstPubkeyProvider::GetPubKey). So I think this function has a small chance of returning inconsistent results.",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-12T00:52:44Z",
      "diff_hunk" : "@@ -22,13 +22,32 @@ struct CMutableTransaction;\n \n struct KeyOriginInfo\n {\n-    unsigned char fingerprint[4];\n+    unsigned char fingerprint[4]; // First 32 bits of the Hash160 of the public key at the root of the path\n     std::vector<uint32_t> path;\n \n     friend bool operator==(const KeyOriginInfo& a, const KeyOriginInfo& b)\n     {\n         return std::equal(std::begin(a.fingerprint), std::end(a.fingerprint), std::begin(b.fingerprint)) && a.path == b.path;\n     }\n+\n+    ADD_SERIALIZE_METHODS;\n+    template <typename Stream, typename Operation>\n+    inline void SerializationOp(Stream& s, Operation ser_action)\n+    {\n+        READWRITE(fingerprint);\n+        READWRITE(path);\n+    }\n+\n+    void SetNull()\n+    {\n+        memset(fingerprint, 0, 4);\n+        path.clear();\n+    }\n+\n+    bool IsNull() const\n+    {\n+        return path.empty() && fingerprint[0] == 0 && fingerprint[1] == 0 && fingerprint[2] == 0 && fingerprint[3] == 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255759286",
      "id" : 255759286,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTc1OTI4Ng==",
      "original_commit_id" : "0cf1c4ca12982533a8d38f2e09aa17f3839c538b",
      "original_position" : 29,
      "path" : "src/script/sign.h",
      "position" : null,
      "pull_request_review_id" : 202410360,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255759286",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255760040"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255760040"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Add `EXCLUSIVE_LOCKS_REQUIRED(cs_wallet)` annotation?",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-12T00:56:33Z",
      "diff_hunk" : "@@ -855,6 +855,8 @@ class CWallet final : public CCryptoKeyStore, public CValidationInterface\n     //! Load metadata (used by LoadWallet)\n     void LoadKeyMetadata(const CKeyID& keyID, const CKeyMetadata &metadata) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n     void LoadScriptMetadata(const CScriptID& script_id, const CKeyMetadata &metadata) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n+    //! Upgrade stored CKeyMetadata objects to store key origin info as KeyOriginInfo\n+    void UpgradeKeyMetadata();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255760040",
      "id" : 255760040,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTc2MDA0MA==",
      "original_commit_id" : "0cf1c4ca12982533a8d38f2e09aa17f3839c538b",
      "original_position" : 5,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 202410360,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255760040",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255762003"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255762003"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This throws `std::runtime_error` on an invalid hdKeypath, should that be caught here and translated into `DBErrors::CORRUPT` ? Also, should this be done before any writing so that if the wallet can't be loaded, it isn't changed first making it harder to debug?",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-12T01:06:19Z",
      "diff_hunk" : "@@ -534,6 +534,9 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n     if (wss.fAnyUnordered)\n         result = pwallet->ReorderTransactions();\n \n+    // Upgrade all of the wallet keymetadata to have the hd master key id\n+    pwallet->UpgradeKeyMetadata();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255762003",
      "id" : 255762003,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTc2MjAwMw==",
      "original_commit_id" : "0cf1c4ca12982533a8d38f2e09aa17f3839c538b",
      "original_position" : 5,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 202410360,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255762003",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255769750"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255769750"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Naming it `FormatHDKeypath` and `const& keypath` would seem more consistent with `ParseHDKeypath`",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-12T01:39:14Z",
      "diff_hunk" : "@@ -587,6 +587,21 @@ bool ParseHDKeypath(const std::string& keypath_str, std::vector<uint32_t>& keypa\n     return true;\n }\n \n+std::string FormatKeyPath(const std::vector<uint32_t>& path)\n+{\n+    std::string ret;\n+    for (auto i : path) {\n+        ret += strprintf(\"/%i\", (i << 1) >> 1);\n+        if (i >> 31) ret += '\\'';\n+    }\n+    return ret;\n+}\n+\n+std::string WriteHdKeypath(const std::vector<uint32_t> keypath)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255769750",
      "id" : 255769750,
      "in_reply_to_id" : 232174240,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTc2OTc1MA==",
      "original_commit_id" : "09995963827b7be1163a50d894490daf182b7a78",
      "original_position" : 14,
      "path" : "src/util/strencodings.cpp",
      "position" : null,
      "pull_request_review_id" : 202410360,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255769750",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255775399"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255775399"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "If hdKeypath is being kept forever, does it actually make sense to have the key_origin added to CKeyMetadata? You can calculate key_origin from hdKeypath using ParseHDKeypath() if needed, but everywhere that uses key_origin is converting it back to a string via WriteHdKeypath already as far as I can see? AddKeyOrigin is already filling out hdKeyPath so it would still achieve the point of the PR by the looks?",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-12T02:09:11Z",
      "diff_hunk" : "@@ -1380,6 +1418,7 @@ CPubKey CWallet::DeriveNewSeed(const CKey& key)\n \n     // set the hd keypath to \"s\" -> Seed, refers the seed to itself\n     metadata.hdKeypath     = \"s\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255775399",
      "id" : 255775399,
      "in_reply_to_id" : 255299218,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTc3NTM5OQ==",
      "original_commit_id" : "066762f02178b2f39581f903841e75694853d8b7",
      "original_position" : 65,
      "path" : "src/wallet/wallet.cpp",
      "position" : 98,
      "pull_request_review_id" : 202410360,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255775399",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255858577"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255858577"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`//!<` please so that it shows up in doxygen",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-12T09:06:07Z",
      "diff_hunk" : "@@ -22,13 +22,32 @@ struct CMutableTransaction;\n \n struct KeyOriginInfo\n {\n-    unsigned char fingerprint[4];\n+    unsigned char fingerprint[4]; // First 32 bits of the Hash160 of the public key at the root of the path",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255858577",
      "id" : 255858577,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTg1ODU3Nw==",
      "original_commit_id" : "ce437d68666f367c441ceb8fcb6a6672cebe6514",
      "original_position" : 5,
      "path" : "src/script/sign.h",
      "position" : null,
      "pull_request_review_id" : 202549333,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255858577",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255859863"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255859863"
         }
      },
      "author_association" : "MEMBER",
      "body" : ":+1: Don't special-case values that can actually occur",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-12T09:08:41Z",
      "diff_hunk" : "@@ -22,13 +22,32 @@ struct CMutableTransaction;\n \n struct KeyOriginInfo\n {\n-    unsigned char fingerprint[4];\n+    unsigned char fingerprint[4]; // First 32 bits of the Hash160 of the public key at the root of the path\n     std::vector<uint32_t> path;\n \n     friend bool operator==(const KeyOriginInfo& a, const KeyOriginInfo& b)\n     {\n         return std::equal(std::begin(a.fingerprint), std::end(a.fingerprint), std::begin(b.fingerprint)) && a.path == b.path;\n     }\n+\n+    ADD_SERIALIZE_METHODS;\n+    template <typename Stream, typename Operation>\n+    inline void SerializationOp(Stream& s, Operation ser_action)\n+    {\n+        READWRITE(fingerprint);\n+        READWRITE(path);\n+    }\n+\n+    void SetNull()\n+    {\n+        memset(fingerprint, 0, 4);\n+        path.clear();\n+    }\n+\n+    bool IsNull() const\n+    {\n+        return path.empty() && fingerprint[0] == 0 && fingerprint[1] == 0 && fingerprint[2] == 0 && fingerprint[3] == 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255859863",
      "id" : 255859863,
      "in_reply_to_id" : 255759286,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTg1OTg2Mw==",
      "original_commit_id" : "0cf1c4ca12982533a8d38f2e09aa17f3839c538b",
      "original_position" : 29,
      "path" : "src/script/sign.h",
      "position" : null,
      "pull_request_review_id" : 202550835,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255859863",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255860751"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255860751"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It was never the intent for `strencodings.cpp` to gain so many bitcoin-application-specific utilities, and this application is very narrow. Maybe make a new header with bip32/key specific utils?",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-12T09:10:46Z",
      "diff_hunk" : "@@ -587,6 +587,21 @@ bool ParseHDKeypath(const std::string& keypath_str, std::vector<uint32_t>& keypa\n     return true;\n }\n \n+std::string FormatKeyPath(const std::vector<uint32_t>& path)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255860751",
      "id" : 255860751,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTg2MDc1MQ==",
      "original_commit_id" : "ce437d68666f367c441ceb8fcb6a6672cebe6514",
      "original_position" : 4,
      "path" : "src/util/strencodings.cpp",
      "position" : null,
      "pull_request_review_id" : 202551878,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255860751",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> In order to make this easier to use, the `hdmasterkeyid` field in `getaddressinfo` has been changed to actually give the HD master key id instead of the seed id\r\n\r\nThis is no longer true with the code change, please update the post (as it will be included in git).",
      "created_at" : "2019-02-12T09:12:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-462678416",
      "id" : 462678416,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MjY3ODQxNg==",
      "updated_at" : "2019-02-12T09:12:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/462678416",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255886794"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255886794"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can we mandate that `KeyOriginInfo` must always contain a `fingerprint`? So in that case justing checking `path.empty()` is enough. Otherwise we need another boolean that's also serialised.",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-12T10:17:39Z",
      "diff_hunk" : "@@ -22,13 +22,32 @@ struct CMutableTransaction;\n \n struct KeyOriginInfo\n {\n-    unsigned char fingerprint[4];\n+    unsigned char fingerprint[4]; // First 32 bits of the Hash160 of the public key at the root of the path\n     std::vector<uint32_t> path;\n \n     friend bool operator==(const KeyOriginInfo& a, const KeyOriginInfo& b)\n     {\n         return std::equal(std::begin(a.fingerprint), std::end(a.fingerprint), std::begin(b.fingerprint)) && a.path == b.path;\n     }\n+\n+    ADD_SERIALIZE_METHODS;\n+    template <typename Stream, typename Operation>\n+    inline void SerializationOp(Stream& s, Operation ser_action)\n+    {\n+        READWRITE(fingerprint);\n+        READWRITE(path);\n+    }\n+\n+    void SetNull()\n+    {\n+        memset(fingerprint, 0, 4);\n+        path.clear();\n+    }\n+\n+    bool IsNull() const\n+    {\n+        return path.empty() && fingerprint[0] == 0 && fingerprint[1] == 0 && fingerprint[2] == 0 && fingerprint[3] == 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255886794",
      "id" : 255886794,
      "in_reply_to_id" : 255759286,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTg4Njc5NA==",
      "original_commit_id" : "0cf1c4ca12982533a8d38f2e09aa17f3839c538b",
      "original_position" : 29,
      "path" : "src/script/sign.h",
      "position" : null,
      "pull_request_review_id" : 202583935,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255886794",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255888246"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255888246"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@ajtowns the new metadata is still readable by older wallets: \r\nhttps://github.com/bitcoin/bitcoin/pull/14021#discussion_r255298989\r\n\r\nThat said, I also have a preference for atomically updating as a general pattern.",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-12T10:21:27Z",
      "diff_hunk" : "@@ -534,6 +534,9 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n     if (wss.fAnyUnordered)\n         result = pwallet->ReorderTransactions();\n \n+    // Upgrade all of the wallet keymetadata to have the hd master key id\n+    pwallet->UpgradeKeyMetadata();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r255888246",
      "id" : 255888246,
      "in_reply_to_id" : 255762003,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTg4ODI0Ng==",
      "original_commit_id" : "0cf1c4ca12982533a8d38f2e09aa17f3839c538b",
      "original_position" : 5,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 202585667,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255888246",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256008462"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256008462"
         }
      },
      "author_association" : "MEMBER",
      "body" : "How else then would we determine that a KeyOriginInfo is null?\r\n\r\n> Can we mandate that `KeyOriginInfo` must always contain a `fingerprint`? So in that case justing checking `path.empty()` is enough.\r\n\r\nI don't think so. It is perfectly valid to have a fingerprint and no path. This indicates that the path is just `m`.",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-12T15:34:16Z",
      "diff_hunk" : "@@ -22,13 +22,32 @@ struct CMutableTransaction;\n \n struct KeyOriginInfo\n {\n-    unsigned char fingerprint[4];\n+    unsigned char fingerprint[4]; // First 32 bits of the Hash160 of the public key at the root of the path\n     std::vector<uint32_t> path;\n \n     friend bool operator==(const KeyOriginInfo& a, const KeyOriginInfo& b)\n     {\n         return std::equal(std::begin(a.fingerprint), std::end(a.fingerprint), std::begin(b.fingerprint)) && a.path == b.path;\n     }\n+\n+    ADD_SERIALIZE_METHODS;\n+    template <typename Stream, typename Operation>\n+    inline void SerializationOp(Stream& s, Operation ser_action)\n+    {\n+        READWRITE(fingerprint);\n+        READWRITE(path);\n+    }\n+\n+    void SetNull()\n+    {\n+        memset(fingerprint, 0, 4);\n+        path.clear();\n+    }\n+\n+    bool IsNull() const\n+    {\n+        return path.empty() && fingerprint[0] == 0 && fingerprint[1] == 0 && fingerprint[2] == 0 && fingerprint[3] == 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256008462",
      "id" : 256008462,
      "in_reply_to_id" : 255759286,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NjAwODQ2Mg==",
      "original_commit_id" : "0cf1c4ca12982533a8d38f2e09aa17f3839c538b",
      "original_position" : 29,
      "path" : "src/script/sign.h",
      "position" : null,
      "pull_request_review_id" : 202735752,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256008462",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256053193"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256053193"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-12T17:04:39Z",
      "diff_hunk" : "@@ -3652,7 +3652,7 @@ UniValue getaddressinfo(const JSONRPCRequest& request)\n             \"  \\\"timestamp\\\" : timestamp,      (number, optional) The creation time of the key if available in seconds since epoch (Jan 1 1970 GMT)\\n\"\n             \"  \\\"hdkeypath\\\" : \\\"keypath\\\"       (string, optional) The HD keypath if the key is HD and available\\n\"\n             \"  \\\"hdseedid\\\" : \\\"<hash160>\\\"      (string, optional) The Hash160 of the HD seed\\n\"\n-            \"  \\\"hdmasterkeyid\\\" : \\\"<hash160>\\\" (string, optional) alias for hdseedid maintained for backwards compatibility. Will be removed in V0.18.\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256053193",
      "id" : 256053193,
      "in_reply_to_id" : 255749209,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NjA1MzE5Mw==",
      "original_commit_id" : "0cf1c4ca12982533a8d38f2e09aa17f3839c538b",
      "original_position" : 4,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 28,
      "pull_request_review_id" : 202791881,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256053193",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256053238"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256053238"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-12T17:04:45Z",
      "diff_hunk" : "@@ -855,6 +855,8 @@ class CWallet final : public CCryptoKeyStore, public CValidationInterface\n     //! Load metadata (used by LoadWallet)\n     void LoadKeyMetadata(const CKeyID& keyID, const CKeyMetadata &metadata) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n     void LoadScriptMetadata(const CScriptID& script_id, const CKeyMetadata &metadata) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n+    //! Upgrade stored CKeyMetadata objects to store key origin info as KeyOriginInfo\n+    void UpgradeKeyMetadata();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256053238",
      "id" : 256053238,
      "in_reply_to_id" : 255760040,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NjA1MzIzOA==",
      "original_commit_id" : "0cf1c4ca12982533a8d38f2e09aa17f3839c538b",
      "original_position" : 5,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 202791949,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256053238",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256053416"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256053416"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've added a catch for the `std::runtime_error`",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-12T17:05:08Z",
      "diff_hunk" : "@@ -534,6 +534,9 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n     if (wss.fAnyUnordered)\n         result = pwallet->ReorderTransactions();\n \n+    // Upgrade all of the wallet keymetadata to have the hd master key id\n+    pwallet->UpgradeKeyMetadata();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256053416",
      "id" : 256053416,
      "in_reply_to_id" : 255762003,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NjA1MzQxNg==",
      "original_commit_id" : "0cf1c4ca12982533a8d38f2e09aa17f3839c538b",
      "original_position" : 5,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 202792157,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256053416",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256053508"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256053508"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-12T17:05:22Z",
      "diff_hunk" : "@@ -22,13 +22,32 @@ struct CMutableTransaction;\n \n struct KeyOriginInfo\n {\n-    unsigned char fingerprint[4];\n+    unsigned char fingerprint[4]; // First 32 bits of the Hash160 of the public key at the root of the path",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256053508",
      "id" : 256053508,
      "in_reply_to_id" : 255858577,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NjA1MzUwOA==",
      "original_commit_id" : "ce437d68666f367c441ceb8fcb6a6672cebe6514",
      "original_position" : 5,
      "path" : "src/script/sign.h",
      "position" : null,
      "pull_request_review_id" : 202792276,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256053508",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256053597"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256053597"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Moved to `bip32.{h,cpp}`",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-12T17:05:35Z",
      "diff_hunk" : "@@ -587,6 +587,21 @@ bool ParseHDKeypath(const std::string& keypath_str, std::vector<uint32_t>& keypa\n     return true;\n }\n \n+std::string FormatKeyPath(const std::vector<uint32_t>& path)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256053597",
      "id" : 256053597,
      "in_reply_to_id" : 255860751,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NjA1MzU5Nw==",
      "original_commit_id" : "ce437d68666f367c441ceb8fcb6a6672cebe6514",
      "original_position" : 4,
      "path" : "src/util/strencodings.cpp",
      "position" : null,
      "pull_request_review_id" : 202792391,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256053597",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Addressed comments and updated OP",
      "created_at" : "2019-02-12T17:06:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-462845331",
      "id" : 462845331,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2Mjg0NTMzMQ==",
      "updated_at" : "2019-02-12T17:06:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/462845331",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256055595"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256055595"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`CWallet::GetKeyOrigin` uses the `key_origin` in `CKeyMetadata`. I strongly prefer storing key origin info in this form instead of having to parse strings every time key origin info is needed to build a PSBT.",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-12T17:10:16Z",
      "diff_hunk" : "@@ -1380,6 +1418,7 @@ CPubKey CWallet::DeriveNewSeed(const CKey& key)\n \n     // set the hd keypath to \"s\" -> Seed, refers the seed to itself\n     metadata.hdKeypath     = \"s\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256055595",
      "id" : 256055595,
      "in_reply_to_id" : 255299218,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NjA1NTU5NQ==",
      "original_commit_id" : "066762f02178b2f39581f903841e75694853d8b7",
      "original_position" : 65,
      "path" : "src/wallet/wallet.cpp",
      "position" : 98,
      "pull_request_review_id" : 202794903,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256055595",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256074011"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256074011"
         }
      },
      "author_association" : "MEMBER",
      "body" : "So then it seems we need an explicit \"null\" for the fingerprint to indicate it's not set.",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-12T17:55:17Z",
      "diff_hunk" : "@@ -22,13 +22,32 @@ struct CMutableTransaction;\n \n struct KeyOriginInfo\n {\n-    unsigned char fingerprint[4];\n+    unsigned char fingerprint[4]; // First 32 bits of the Hash160 of the public key at the root of the path\n     std::vector<uint32_t> path;\n \n     friend bool operator==(const KeyOriginInfo& a, const KeyOriginInfo& b)\n     {\n         return std::equal(std::begin(a.fingerprint), std::end(a.fingerprint), std::begin(b.fingerprint)) && a.path == b.path;\n     }\n+\n+    ADD_SERIALIZE_METHODS;\n+    template <typename Stream, typename Operation>\n+    inline void SerializationOp(Stream& s, Operation ser_action)\n+    {\n+        READWRITE(fingerprint);\n+        READWRITE(path);\n+    }\n+\n+    void SetNull()\n+    {\n+        memset(fingerprint, 0, 4);\n+        path.clear();\n+    }\n+\n+    bool IsNull() const\n+    {\n+        return path.empty() && fingerprint[0] == 0 && fingerprint[1] == 0 && fingerprint[2] == 0 && fingerprint[3] == 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256074011",
      "id" : 256074011,
      "in_reply_to_id" : 255759286,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NjA3NDAxMQ==",
      "original_commit_id" : "0cf1c4ca12982533a8d38f2e09aa17f3839c538b",
      "original_position" : 29,
      "path" : "src/script/sign.h",
      "position" : null,
      "pull_request_review_id" : 202817521,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256074011",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256077622"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256077622"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: add comment that this is not atomic, but that individually updated keymetadata entries don't prevent older wallets from loading.",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-12T18:04:15Z",
      "diff_hunk" : "@@ -529,6 +534,13 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n     if (wss.fAnyUnordered)\n         result = pwallet->ReorderTransactions();\n \n+    // Upgrade all of the wallet keymetadata to have the hd master key id\n+    try {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256077622",
      "id" : 256077622,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NjA3NzYyMg==",
      "original_commit_id" : "fa1014c2a1150166a698c0cc7ce9291f2963135d",
      "original_position" : 30,
      "path" : "src/wallet/walletdb.cpp",
      "position" : 31,
      "pull_request_review_id" : 202821873,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256077622",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256199347"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256199347"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Adding a `null` field would cause a lot of code churn. Instead I've changed `CKeyMetadata` to have a boolean that indicates whether the `key_origin` is valid. Let me know what you think of that; if it's good, I'll squash the commit down.",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-13T00:04:19Z",
      "diff_hunk" : "@@ -22,13 +22,32 @@ struct CMutableTransaction;\n \n struct KeyOriginInfo\n {\n-    unsigned char fingerprint[4];\n+    unsigned char fingerprint[4]; // First 32 bits of the Hash160 of the public key at the root of the path\n     std::vector<uint32_t> path;\n \n     friend bool operator==(const KeyOriginInfo& a, const KeyOriginInfo& b)\n     {\n         return std::equal(std::begin(a.fingerprint), std::end(a.fingerprint), std::begin(b.fingerprint)) && a.path == b.path;\n     }\n+\n+    ADD_SERIALIZE_METHODS;\n+    template <typename Stream, typename Operation>\n+    inline void SerializationOp(Stream& s, Operation ser_action)\n+    {\n+        READWRITE(fingerprint);\n+        READWRITE(path);\n+    }\n+\n+    void SetNull()\n+    {\n+        memset(fingerprint, 0, 4);\n+        path.clear();\n+    }\n+\n+    bool IsNull() const\n+    {\n+        return path.empty() && fingerprint[0] == 0 && fingerprint[1] == 0 && fingerprint[2] == 0 && fingerprint[3] == 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256199347",
      "id" : 256199347,
      "in_reply_to_id" : 255759286,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NjE5OTM0Nw==",
      "original_commit_id" : "0cf1c4ca12982533a8d38f2e09aa17f3839c538b",
      "original_position" : 29,
      "path" : "src/script/sign.h",
      "position" : null,
      "pull_request_review_id" : 202972411,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256199347",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256245833"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256245833"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "You could use sizeof(fingerprint) to get rid of the magic number 4? But seems fine as is to me.",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-13T04:43:20Z",
      "diff_hunk" : "@@ -29,6 +29,25 @@ struct KeyOriginInfo\n     {\n         return std::equal(std::begin(a.fingerprint), std::end(a.fingerprint), std::begin(b.fingerprint)) && a.path == b.path;\n     }\n+\n+    ADD_SERIALIZE_METHODS;\n+    template <typename Stream, typename Operation>\n+    inline void SerializationOp(Stream& s, Operation ser_action)\n+    {\n+        READWRITE(fingerprint);\n+        READWRITE(path);\n+    }\n+\n+    void SetNull()\n+    {\n+        memset(fingerprint, 0, 4);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256245833",
      "id" : 256245833,
      "in_reply_to_id" : 255297793,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NjI0NTgzMw==",
      "original_commit_id" : "066762f02178b2f39581f903841e75694853d8b7",
      "original_position" : 15,
      "path" : "src/script/sign.h",
      "position" : 23,
      "pull_request_review_id" : 203027247,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256245833",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256246301"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256246301"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Looks better to me",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-13T04:47:24Z",
      "diff_hunk" : "@@ -22,13 +22,32 @@ struct CMutableTransaction;\n \n struct KeyOriginInfo\n {\n-    unsigned char fingerprint[4];\n+    unsigned char fingerprint[4]; // First 32 bits of the Hash160 of the public key at the root of the path\n     std::vector<uint32_t> path;\n \n     friend bool operator==(const KeyOriginInfo& a, const KeyOriginInfo& b)\n     {\n         return std::equal(std::begin(a.fingerprint), std::end(a.fingerprint), std::begin(b.fingerprint)) && a.path == b.path;\n     }\n+\n+    ADD_SERIALIZE_METHODS;\n+    template <typename Stream, typename Operation>\n+    inline void SerializationOp(Stream& s, Operation ser_action)\n+    {\n+        READWRITE(fingerprint);\n+        READWRITE(path);\n+    }\n+\n+    void SetNull()\n+    {\n+        memset(fingerprint, 0, 4);\n+        path.clear();\n+    }\n+\n+    bool IsNull() const\n+    {\n+        return path.empty() && fingerprint[0] == 0 && fingerprint[1] == 0 && fingerprint[2] == 0 && fingerprint[3] == 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256246301",
      "id" : 256246301,
      "in_reply_to_id" : 255759286,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NjI0NjMwMQ==",
      "original_commit_id" : "0cf1c4ca12982533a8d38f2e09aa17f3839c538b",
      "original_position" : 29,
      "path" : "src/script/sign.h",
      "position" : null,
      "pull_request_review_id" : 203027809,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256246301",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@achow101 wrote inline:\r\n> Adding a `null` field would cause a lot of code churn. Instead I've changed `CKeyMetadata` to have a boolean that indicates whether the `key_origin` is valid. Let me know what you think of that; if it's good, I'll squash the commit down.\r\n\r\n@ajtowns wrote:\r\n> Looks better to me\r\n\r\nAgreed, utACK 4908b37 (modulo squash)\r\n",
      "created_at" : "2019-02-13T09:01:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-463115589",
      "id" : 463115589,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MzExNTU4OQ==",
      "updated_at" : "2019-02-13T09:01:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/463115589",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256450134"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256450134"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-13T15:35:53Z",
      "diff_hunk" : "@@ -529,6 +534,13 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n     if (wss.fAnyUnordered)\n         result = pwallet->ReorderTransactions();\n \n+    // Upgrade all of the wallet keymetadata to have the hd master key id\n+    try {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256450134",
      "id" : 256450134,
      "in_reply_to_id" : 256077622,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NjQ1MDEzNA==",
      "original_commit_id" : "fa1014c2a1150166a698c0cc7ce9291f2963135d",
      "original_position" : 30,
      "path" : "src/wallet/walletdb.cpp",
      "position" : 31,
      "pull_request_review_id" : 203278639,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256450134",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Squashed",
      "created_at" : "2019-02-13T15:35:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-463245398",
      "id" : 463245398,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MzI0NTM5OA==",
      "updated_at" : "2019-02-13T15:35:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/463245398",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256453705"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256453705"
         }
      },
      "author_association" : "MEMBER",
      "body" : "all instances(aside from notes) indeed appear to be deleted",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-13T15:42:54Z",
      "diff_hunk" : "@@ -2406,7 +2406,6 @@ static UniValue getwalletinfo(const JSONRPCRequest& request)\n             \"  \\\"unlocked_until\\\": ttt,             (numeric) the timestamp in seconds since epoch (midnight Jan 1 1970 GMT) that the wallet is unlocked for transfers, or 0 if the wallet is locked\\n\"\n             \"  \\\"paytxfee\\\": x.xxxx,                (numeric) the transaction fee configuration, set in \" + CURRENCY_UNIT + \"/kB\\n\"\n             \"  \\\"hdseedid\\\": \\\"<hash160>\\\"            (string, optional) the Hash160 of the HD seed (only present when HD is enabled)\\n\"\n-            \"  \\\"hdmasterkeyid\\\": \\\"<hash160>\\\"       (string, optional) alias for hdseedid retained for backwards-compatibility. Will be removed in V0.18.\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256453705",
      "id" : 256453705,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NjQ1MzcwNQ==",
      "original_commit_id" : "1d23f6bf0c06d21da8612631d0a512a7c32747d2",
      "original_position" : 4,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 12,
      "pull_request_review_id" : 203283118,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256453705",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Explicit null key_origin is welcomed change.\r\n\r\nI don't think you have addressed the encrypted wallet migration issue with your preferred fix?",
      "created_at" : "2019-02-13T16:05:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-463257287",
      "id" : 463257287,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MzI1NzI4Nw==",
      "updated_at" : "2019-02-13T16:05:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/463257287",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I don't think you have addressed the encrypted wallet migration issue with your preferred fix?\r\n\r\nHmm. I thought I pushed that. It must've gotten lost in a rebase somewhere. Pushed it now.",
      "created_at" : "2019-02-13T18:30:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-463312820",
      "id" : 463312820,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MzMxMjgyMA==",
      "updated_at" : "2019-02-13T18:30:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/463312820",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK https://github.com/bitcoin/bitcoin/pull/14021/commits/4486b36762a7ab395d1f01b941d83243af6450d4",
      "created_at" : "2019-02-13T18:35:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-463314468",
      "id" : 463314468,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MzMxNDQ2OA==",
      "updated_at" : "2019-02-13T18:35:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/463314468",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@instagibbs wrote inline:\r\n\r\n> Since this is called on load, does the user need to unlock an encrypted wallet?\r\n\r\n@achow101 wrote:\r\n> There are a few options to solve this. We could not upgrade the key metadata if we can't calculate the master key id. Or we could use the hd seed id instead if the correct master key id can't be calculated.\r\n\r\n> I am tending to go towards the second solution. While it technically is not the master key id, this information is really only used for/needed for descriptors and PSBT. Any wallet that already exists does not need this information. If this ends up in PSBT, that's fine since the BIP 32 derivation paths are just information for the signer. In this case, the signer is Bitcoin Core, and it doesn't use the derivation paths. We just need to put something there that won't cause problems for other signers.\r\n\r\nI don't like this approach; more assumptions than necessary. It seems safer to also run this from `CWallet::Unlock`.\r\n\r\nThe rest of 4486b36 looks good to me.\r\n",
      "created_at" : "2019-02-13T19:35:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-463337032",
      "id" : 463337032,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MzMzNzAzMg==",
      "updated_at" : "2019-02-13T19:35:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/463337032",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@Sjors would it make the first unlock surprisingly long?",
      "created_at" : "2019-02-13T19:40:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-463338878",
      "id" : 463338878,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MzMzODg3OA==",
      "updated_at" : "2019-02-13T19:40:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/463338878",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I'm assuming updating metadata entries is extremely fast, but haven't tested that. You could potentially spit out a warning on first unlock (although that might stress out applications that consume std::out).",
      "created_at" : "2019-02-13T19:53:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-463343546",
      "id" : 463343546,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MzM0MzU0Ng==",
      "updated_at" : "2019-02-13T19:53:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/463343546",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I don't like this approach; more assumptions than necessary. It seems safer to also run this from `CWallet::Unlock`.\r\n\r\nThere's a bit of a problem with doing that. If the wallet is not unlocked but a user decides to use `walletprocesspsbt` with `bip32derivs` set to `true`, then the resulting psbt will have a bogus master key fingerprint. It's writing uninitialized memory to the psbt. This is both a problem in this PR (without the change I just pushed) and in master.\r\n\r\n> I'm assuming updating metadata entries is extremely fast\r\n\r\nit takes several seconds.",
      "created_at" : "2019-02-13T20:08:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-463348875",
      "id" : 463348875,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MzM0ODg3NQ==",
      "updated_at" : "2019-02-13T20:08:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/463348875",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've reverted that change. In the new push, the key metadata will be upgraded on unlocking the wallet or on loading if the wallet is unencrypted. However, due to the issue I mentioned earlier, I've changed `GetKeyOrigin` to return the `KeyOriginInfo` for keys whose metadata has not been upgraded to just be as if it were an independent key.\r\n\r\nI also added release notes which mention this change.",
      "created_at" : "2019-02-13T21:16:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-463374961",
      "id" : 463374961,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MzM3NDk2MQ==",
      "updated_at" : "2019-02-13T21:18:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/463374961",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "tACK b384060ff modulo squash.\r\n\r\nAppVeyor failure is same as on master.",
      "created_at" : "2019-02-14T09:47:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-463562487",
      "id" : 463562487,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MzU2MjQ4Nw==",
      "updated_at" : "2019-02-14T09:47:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/463562487",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Squashed",
      "created_at" : "2019-02-14T15:21:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-463666656",
      "id" : 463666656,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MzY2NjY1Ng==",
      "updated_at" : "2019-02-14T15:21:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/463666656",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK a8a7103",
      "created_at" : "2019-02-14T15:47:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-463677315",
      "id" : 463677315,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MzY3NzMxNQ==",
      "updated_at" : "2019-02-14T15:47:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/463677315",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256943332"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256943332"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This means wallets will iterate through all key metadata every unlock?",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-14T17:55:21Z",
      "diff_hunk" : "@@ -422,6 +465,8 @@ bool CWallet::Unlock(const SecureString& strWalletPassphrase, bool accept_no_key\n             if (!crypter.Decrypt(pMasterKey.second.vchCryptedKey, _vMasterKey))\n                 continue; // try another master key\n             if (CCryptoKeyStore::Unlock(_vMasterKey, accept_no_keys))\n+                // Now that we've unlocked, upgrade the key metadata\n+                UpgradeKeyMetadata();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256943332",
      "id" : 256943332,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1Njk0MzMzMg==",
      "original_commit_id" : "d24c52d0e3fbe6c08fa90d9499a49e1f1289e807",
      "original_position" : 72,
      "path" : "src/wallet/wallet.cpp",
      "position" : 89,
      "pull_request_review_id" : 203885255,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256943332",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256947738"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256947738"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Perhaps a more efficient approach is to set a wallet flag once all metadata is upgraded?",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-14T18:07:44Z",
      "diff_hunk" : "@@ -422,6 +465,8 @@ bool CWallet::Unlock(const SecureString& strWalletPassphrase, bool accept_no_key\n             if (!crypter.Decrypt(pMasterKey.second.vchCryptedKey, _vMasterKey))\n                 continue; // try another master key\n             if (CCryptoKeyStore::Unlock(_vMasterKey, accept_no_keys))\n+                // Now that we've unlocked, upgrade the key metadata\n+                UpgradeKeyMetadata();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256947738",
      "id" : 256947738,
      "in_reply_to_id" : 256943332,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1Njk0NzczOA==",
      "original_commit_id" : "d24c52d0e3fbe6c08fa90d9499a49e1f1289e807",
      "original_position" : 72,
      "path" : "src/wallet/wallet.cpp",
      "position" : 89,
      "pull_request_review_id" : 203890681,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256947738",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256959443"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256959443"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is a point in favor of atomicity, then marking as complete.",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-14T18:37:27Z",
      "diff_hunk" : "@@ -422,6 +465,8 @@ bool CWallet::Unlock(const SecureString& strWalletPassphrase, bool accept_no_key\n             if (!crypter.Decrypt(pMasterKey.second.vchCryptedKey, _vMasterKey))\n                 continue; // try another master key\n             if (CCryptoKeyStore::Unlock(_vMasterKey, accept_no_keys))\n+                // Now that we've unlocked, upgrade the key metadata\n+                UpgradeKeyMetadata();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256959443",
      "id" : 256959443,
      "in_reply_to_id" : 256943332,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1Njk1OTQ0Mw==",
      "original_commit_id" : "d24c52d0e3fbe6c08fa90d9499a49e1f1289e807",
      "original_position" : 72,
      "path" : "src/wallet/wallet.cpp",
      "position" : 89,
      "pull_request_review_id" : 203904332,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256959443",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256967413"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256967413"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've added a non-mandatory wallet flag which is set upon the upgrade's completion. This will make sure that the upgrade happens only once.",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-14T18:59:06Z",
      "diff_hunk" : "@@ -422,6 +465,8 @@ bool CWallet::Unlock(const SecureString& strWalletPassphrase, bool accept_no_key\n             if (!crypter.Decrypt(pMasterKey.second.vchCryptedKey, _vMasterKey))\n                 continue; // try another master key\n             if (CCryptoKeyStore::Unlock(_vMasterKey, accept_no_keys))\n+                // Now that we've unlocked, upgrade the key metadata\n+                UpgradeKeyMetadata();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256967413",
      "id" : 256967413,
      "in_reply_to_id" : 256943332,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1Njk2NzQxMw==",
      "original_commit_id" : "d24c52d0e3fbe6c08fa90d9499a49e1f1289e807",
      "original_position" : 72,
      "path" : "src/wallet/wallet.cpp",
      "position" : 89,
      "pull_request_review_id" : 203914540,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256967413",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK https://github.com/bitcoin/bitcoin/pull/14021/commits/8fff73cb092e609505f6a0a14c2fe4d8d80479dd",
      "created_at" : "2019-02-14T19:05:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-463751352",
      "id" : 463751352,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2Mzc1MTM1Mg==",
      "updated_at" : "2019-02-14T19:05:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/463751352",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256982599"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256982599"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should this say `upper section (> 0 << 31)` ?",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-14T19:39:34Z",
      "diff_hunk" : "@@ -135,6 +135,9 @@ enum WalletFlags : uint64_t {\n     // wallet flags in the upper section (> 1 << 31) will lead to not opening the wallet if flag is unknown",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256982599",
      "id" : 256982599,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1Njk4MjU5OQ==",
      "original_commit_id" : "8fff73cb092e609505f6a0a14c2fe4d8d80479dd",
      "original_position" : 1,
      "path" : "src/wallet/wallet.h",
      "position" : 1,
      "pull_request_review_id" : 203933416,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256982599",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256983753"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256983753"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe use `1`? https://github.com/bitcoin/bitcoin/pull/13756/files#diff-12635a58447c65585f51d32b7e04075bR140",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-14T19:42:47Z",
      "diff_hunk" : "@@ -135,6 +135,9 @@ enum WalletFlags : uint64_t {\n     // wallet flags in the upper section (> 1 << 31) will lead to not opening the wallet if flag is unknown\n     // unknown wallet flags in the lower section <= (1 << 31) will be tolerated\n \n+    // Indicates that the metadata has already been upgraded to contain key origins\n+    WALLET_FLAG_KEY_ORIGIN_METADATA = (1ULL << 0),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256983753",
      "id" : 256983753,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1Njk4Mzc1Mw==",
      "original_commit_id" : "8fff73cb092e609505f6a0a14c2fe4d8d80479dd",
      "original_position" : 5,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 203933416,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256983753",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256984744"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256984744"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Not my problem :p\r\n\r\nAlso, no, it shouldn't. Shifting 0 is still 0.",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-14T19:45:21Z",
      "diff_hunk" : "@@ -135,6 +135,9 @@ enum WalletFlags : uint64_t {\n     // wallet flags in the upper section (> 1 << 31) will lead to not opening the wallet if flag is unknown",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256984744",
      "id" : 256984744,
      "in_reply_to_id" : 256982599,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1Njk4NDc0NA==",
      "original_commit_id" : "8fff73cb092e609505f6a0a14c2fe4d8d80479dd",
      "original_position" : 1,
      "path" : "src/wallet/wallet.h",
      "position" : 1,
      "pull_request_review_id" : 203936050,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256984744",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256986042"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256986042"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-14T19:48:47Z",
      "diff_hunk" : "@@ -135,6 +135,9 @@ enum WalletFlags : uint64_t {\n     // wallet flags in the upper section (> 1 << 31) will lead to not opening the wallet if flag is unknown\n     // unknown wallet flags in the lower section <= (1 << 31) will be tolerated\n \n+    // Indicates that the metadata has already been upgraded to contain key origins\n+    WALLET_FLAG_KEY_ORIGIN_METADATA = (1ULL << 0),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r256986042",
      "id" : 256986042,
      "in_reply_to_id" : 256983753,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1Njk4NjA0Mg==",
      "original_commit_id" : "8fff73cb092e609505f6a0a14c2fe4d8d80479dd",
      "original_position" : 5,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 203937779,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/256986042",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "only change is WALLET_FLAG_KEY_ORIGIN_METADATA flag from 0 to 1.\r\n\r\nre-utACK https://github.com/bitcoin/bitcoin/pull/14021/commits/1b1c6aa276f24ff85392915c3b557e2343c88252",
      "created_at" : "2019-02-14T19:52:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-463768524",
      "id" : 463768524,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2Mzc2ODUyNA==",
      "updated_at" : "2019-02-14T19:52:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/463768524",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 1b1c6aa",
      "created_at" : "2019-02-14T19:52:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-463768588",
      "id" : 463768588,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2Mzc2ODU4OA==",
      "updated_at" : "2019-02-14T19:52:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/463768588",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "utACK 1b1c6aa276f24ff85392915c3b557e2343c88252",
      "created_at" : "2019-02-14T22:06:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-463819661",
      "id" : 463819661,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MzgxOTY2MQ==",
      "updated_at" : "2019-02-14T22:06:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/463819661",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r257035083"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/257035083"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That's correct. If you don't deserialize things at the end of a stream, they just get ignored.",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-14T22:15:43Z",
      "diff_hunk" : "@@ -329,6 +337,36 @@ bool CWallet::WriteKeyMetadata(const CKeyMetadata& meta, const CPubKey& pubkey,\n     return WalletBatch(*database).WriteKeyMetadata(meta, pubkey, overwrite);\n }\n \n+void CWallet::UpgradeKeyMetadata()\n+{\n+    AssertLockHeld(cs_wallet); // mapKeyMetadata\n+\n+    for (auto& meta_pair : mapKeyMetadata) {\n+        CKeyMetadata& meta = meta_pair.second;\n+        if (!meta.hd_seed_id.IsNull() && meta.key_origin.IsNull() && meta.hdKeypath != \"s\") {\n+            CKey key;\n+            GetKey(meta.hd_seed_id, key);\n+            CExtKey masterKey;\n+            masterKey.SetSeed(key.begin(), key.size());\n+            // Add to map\n+            CKeyID master_id = masterKey.key.GetPubKey().GetID();\n+            std::copy(master_id.begin(), master_id.begin() + 4, meta.key_origin.fingerprint);\n+            if (!ParseHDKeypath(meta.hdKeypath, meta.key_origin.path)) {\n+                throw std::runtime_error(\"Invalid stored hdKeypath\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r257035083",
      "id" : 257035083,
      "in_reply_to_id" : 255298989,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NzAzNTA4Mw==",
      "original_commit_id" : "066762f02178b2f39581f903841e75694853d8b7",
      "original_position" : 44,
      "path" : "src/wallet/wallet.cpp",
      "position" : 62,
      "pull_request_review_id" : 203999387,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/257035083",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r257035420"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/257035420"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It seems there is an `IsLocked()` at the top now, so you've picked the first solution (not upgrading when locked)? If so, I prefer that.",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-14T22:16:54Z",
      "diff_hunk" : "@@ -330,6 +338,36 @@ bool CWallet::WriteKeyMetadata(const CKeyMetadata& meta, const CPubKey& pubkey,\n     return WalletBatch(*database).WriteKeyMetadata(meta, pubkey, overwrite);\n }\n \n+void CWallet::UpgradeKeyMetadata()\n+{\n+    AssertLockHeld(cs_wallet); // mapKeyMetadata\n+\n+    for (auto& meta_pair : mapKeyMetadata) {\n+        CKeyMetadata& meta = meta_pair.second;\n+        if (!meta.hd_seed_id.IsNull() && meta.key_origin.IsNull() && meta.hdKeypath != \"s\") { // If the hdKeypath is \"s\", that's the seed and it doesn't have a key origin\n+            CKey key;\n+            GetKey(meta.hd_seed_id, key);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r257035420",
      "id" : 257035420,
      "in_reply_to_id" : 255374325,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NzAzNTQyMA==",
      "original_commit_id" : "82396ec29d730029532374e18727496cbf4066e6",
      "original_position" : 37,
      "path" : "src/wallet/wallet.cpp",
      "position" : 55,
      "pull_request_review_id" : 203999387,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/257035420",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r257037367"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/257037367"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should this be called when `id` is not a member of `import_data.key_origins`? The non-descriptor imports won't have this map entries created.",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-14T22:23:06Z",
      "diff_hunk" : "@@ -1261,6 +1262,8 @@ static UniValue ProcessImport(CWallet * const pwallet, const UniValue& data, con\n             if (!pwallet->GetPubKey(id, temp) && !pwallet->AddWatchOnly(GetScriptForRawPubKey(pubkey), timestamp)) {\n                 throw JSONRPCError(RPC_WALLET_ERROR, \"Error adding address to wallet\");\n             }\n+            pwallet->AddKeyOrigin(pubkey, import_data.key_origins[id]);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r257037367",
      "id" : 257037367,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NzAzNzM2Nw==",
      "original_commit_id" : "35d6bc5793abc901d2b4da81f8dad48724b2607c",
      "original_position" : 21,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 203999387,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/257037367",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r257037603"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/257037603"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Typo: `it's` -> `its`",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-14T22:23:57Z",
      "diff_hunk" : "@@ -0,0 +1,11 @@\n+Miscellaneous RPC Changes\n+-------------------------\n+- Descriptors with key origin information imported through `importmulti` will have their key origin information stored in the wallet for use with creating PSBTs.\n+- If `bip32derivs` of both `walletprocesspsbt` and `walletcreatefundedpsbt` is set to true but the key metadata for a public key has not been updated yet, then that key will have a derivation path as if it were just an independent key (i.e. no derivation path and it's master fingerprint is itself)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r257037603",
      "id" : 257037603,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NzAzNzYwMw==",
      "original_commit_id" : "1b1c6aa276f24ff85392915c3b557e2343c88252",
      "original_position" : 4,
      "path" : "doc/release-notes-14021.md",
      "position" : null,
      "pull_request_review_id" : 203999387,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/257037603",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r257045244"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/257045244"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It should check that. I've added the check and a test for this.",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-14T22:49:52Z",
      "diff_hunk" : "@@ -1261,6 +1262,8 @@ static UniValue ProcessImport(CWallet * const pwallet, const UniValue& data, con\n             if (!pwallet->GetPubKey(id, temp) && !pwallet->AddWatchOnly(GetScriptForRawPubKey(pubkey), timestamp)) {\n                 throw JSONRPCError(RPC_WALLET_ERROR, \"Error adding address to wallet\");\n             }\n+            pwallet->AddKeyOrigin(pubkey, import_data.key_origins[id]);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r257045244",
      "id" : 257045244,
      "in_reply_to_id" : 257037367,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NzA0NTI0NA==",
      "original_commit_id" : "35d6bc5793abc901d2b4da81f8dad48724b2607c",
      "original_position" : 21,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 204011721,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/257045244",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r257045258"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/257045258"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "cb3511b9d5f3d8a86e090ebed5a4aeaf758430b8",
      "created_at" : "2019-02-14T22:49:57Z",
      "diff_hunk" : "@@ -0,0 +1,11 @@\n+Miscellaneous RPC Changes\n+-------------------------\n+- Descriptors with key origin information imported through `importmulti` will have their key origin information stored in the wallet for use with creating PSBTs.\n+- If `bip32derivs` of both `walletprocesspsbt` and `walletcreatefundedpsbt` is set to true but the key metadata for a public key has not been updated yet, then that key will have a derivation path as if it were just an independent key (i.e. no derivation path and it's master fingerprint is itself)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#discussion_r257045258",
      "id" : 257045258,
      "in_reply_to_id" : 257037603,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NzA0NTI1OA==",
      "original_commit_id" : "1b1c6aa276f24ff85392915c3b557e2343c88252",
      "original_position" : 4,
      "path" : "doc/release-notes-14021.md",
      "position" : null,
      "pull_request_review_id" : 204011735,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14021",
      "updated_at" : "2019-02-14T23:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/257045258",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "oops, screwed up that most recent push, don't merge yet",
      "created_at" : "2019-02-14T22:52:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-463835198",
      "id" : 463835198,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MzgzNTE5OA==",
      "updated_at" : "2019-02-14T22:52:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/463835198",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Changes since @sipa's are just nit-fixes, a new test, and a missing brace bugfix :+1:",
      "created_at" : "2019-02-14T23:10:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14021#issuecomment-463840215",
      "id" : 463840215,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14021",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2Mzg0MDIxNQ==",
      "updated_at" : "2019-02-14T23:10:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/463840215",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   }
]
