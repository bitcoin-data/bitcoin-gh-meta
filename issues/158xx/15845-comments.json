[
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2019-04-18T18:44:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#issuecomment-484636149",
      "id" : 484636149,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15845",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4NDYzNjE0OQ==",
      "updated_at" : "2019-04-18T18:44:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/484636149",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r276791064"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/276791064"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This will miss P2PKH outputs I think.",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-04-18T18:53:17Z",
      "diff_hunk" : "@@ -1748,6 +1748,21 @@ int64_t CWallet::RescanFromTime(int64_t startTime, const WalletRescanReserver& r\n     return startTime;\n }\n \n+GCSFilter::ElementSet CWallet::GetScriptPubKeysForBlockFilter()\n+{\n+    GCSFilter::ElementSet ret;\n+    for (const auto& i : CBasicKeyStore::GetAllWatchedScriptPubKeys()) {\n+        ret.emplace(i.begin(), i.end());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r276791064",
      "id" : 276791064,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3Njc5MTA2NA==",
      "original_commit_id" : "ffff46a547fc03dec3157e56a5953f4b3a8e9937",
      "original_position" : 8,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 228451408,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-05T13:40:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/276791064",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2019-04-18T18:53:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#issuecomment-484640077",
      "id" : 484640077,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15845",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4NDY0MDA3Nw==",
      "updated_at" : "2019-04-18T18:53:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/484640077",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r276791373"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/276791373"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Just because we know about a script does not imply we're watching it I believe.",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-04-18T18:54:04Z",
      "diff_hunk" : "@@ -1748,6 +1748,21 @@ int64_t CWallet::RescanFromTime(int64_t startTime, const WalletRescanReserver& r\n     return startTime;\n }\n \n+GCSFilter::ElementSet CWallet::GetScriptPubKeysForBlockFilter()\n+{\n+    GCSFilter::ElementSet ret;\n+    for (const auto& i : CBasicKeyStore::GetAllWatchedScriptPubKeys()) {\n+        ret.emplace(i.begin(), i.end());\n+    }\n+    for (const auto& bs : CBasicKeyStore::GetAllBareScripts()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r276791373",
      "id" : 276791373,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3Njc5MTM3Mw==",
      "original_commit_id" : "ffff46a547fc03dec3157e56a5953f4b3a8e9937",
      "original_position" : 10,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 228451798,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-05T13:40:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/276791373",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r276792123"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/276792123"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sure, but I'd rather err on the safe side of scanning a block too much than missing a block (and thus lose coins)",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-04-18T18:56:01Z",
      "diff_hunk" : "@@ -1748,6 +1748,21 @@ int64_t CWallet::RescanFromTime(int64_t startTime, const WalletRescanReserver& r\n     return startTime;\n }\n \n+GCSFilter::ElementSet CWallet::GetScriptPubKeysForBlockFilter()\n+{\n+    GCSFilter::ElementSet ret;\n+    for (const auto& i : CBasicKeyStore::GetAllWatchedScriptPubKeys()) {\n+        ret.emplace(i.begin(), i.end());\n+    }\n+    for (const auto& bs : CBasicKeyStore::GetAllBareScripts()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r276792123",
      "id" : 276792123,
      "in_reply_to_id" : 276791373,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3Njc5MjEyMw==",
      "original_commit_id" : "ffff46a547fc03dec3157e56a5953f4b3a8e9937",
      "original_position" : 10,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 228452738,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-05T13:40:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/276792123",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Nice! That was quick.\r\nConcept ACK",
      "created_at" : "2019-04-18T18:58:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#issuecomment-484642339",
      "id" : 484642339,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15845",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4NDY0MjMzOQ==",
      "updated_at" : "2019-04-18T18:58:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/484642339",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r276793224"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/276793224"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Could you please elaborate in which code path we import a P2PKH address or a public key without adding it to `setWatchOnly`?",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-04-18T18:58:56Z",
      "diff_hunk" : "@@ -1748,6 +1748,21 @@ int64_t CWallet::RescanFromTime(int64_t startTime, const WalletRescanReserver& r\n     return startTime;\n }\n \n+GCSFilter::ElementSet CWallet::GetScriptPubKeysForBlockFilter()\n+{\n+    GCSFilter::ElementSet ret;\n+    for (const auto& i : CBasicKeyStore::GetAllWatchedScriptPubKeys()) {\n+        ret.emplace(i.begin(), i.end());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r276793224",
      "id" : 276793224,
      "in_reply_to_id" : 276791064,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3Njc5MzIyNA==",
      "original_commit_id" : "ffff46a547fc03dec3157e56a5953f4b3a8e9937",
      "original_position" : 8,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 228454101,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-05T13:40:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/276793224",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Some rough benchmarks\r\n\r\n{\r\n  \"start_height\": 0,\r\n  \"stop_height\": 572152\r\n}\r\n\r\nreal\t4m23.596s\r\n\r\n\r\nA simple wallet,... filtered out roughly 2900 blocks and scanned them.",
      "created_at" : "2019-04-18T20:14:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#issuecomment-484672833",
      "id" : 484672833,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15845",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4NDY3MjgzMw==",
      "updated_at" : "2019-04-18T20:14:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/484672833",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#17384](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/17384.html) (test: Create new test library by MarcoFalke)\n* [#16528](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16528.html) ([WIP] Native Descriptor Wallets (take 2) by achow101)\n* [#16442](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16442.html) (Serve BIP 157 compact filters by jimpo)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.<!--2502f1a698b3751726fa55edcda76cd3-->\n\n### Coverage\n\n| Coverage  | Change ([pull 15845](https://drahtbot.github.io/reports/coverage/bitcoin/bitcoin/15845/total.coverage/index.html), 77e593bc79216175fa4c2fd05278bf1b7e4c7146) | Reference ([master](https://drahtbot.github.io/reports/coverage/bitcoin/bitcoin/master/total.coverage/index.html), 56376f336548b53cf31e98a58dfb4db22cede6e5)   |\n|-----------|-------------------------|--------------------|\n| Lines     | +0.0064 %            | 87.5552 %        |\n| Functions | -0.0143 %            | 84.6451 %        |\n| Branches  | +0.0017 %            | 51.5534 %        |\n\n<sup>Updated at: 2019-04-19T22:20:19.826705.</sup>\n",
      "created_at" : "2019-04-19T22:20:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#issuecomment-485027756",
      "id" : 485027756,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15845",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4NTAyNzc1Ng==",
      "updated_at" : "2019-11-07T04:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/485027756",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277109313"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277109313"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`result.last_scanned_block` and `result.last_scanned_height` should both be updated even if the filter doesn't match.",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-04-19T23:03:45Z",
      "diff_hunk" : "@@ -1806,6 +1820,8 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n                 WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", *block_height, progress_current);\n             }\n \n+            if (chain().filterMatchesAny(block_hash, filter_set)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277109313",
      "id" : 277109313,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NzEwOTMxMw==",
      "original_commit_id" : "2a884d347eec442e81ce0b9fde7b728caed9d6da",
      "original_position" : 43,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 228848610,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-05T13:40:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277109313",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277110073"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277110073"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "You don't need the lock for the filter lookup, just the block index lookup.",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-04-19T23:10:14Z",
      "diff_hunk" : "@@ -268,10 +268,13 @@ class ChainImpl : public Chain\n     {\n         const BlockFilterIndex* block_filter_index = GetBlockFilterIndex(BlockFilterType::BASIC);\n         if (!block_filter_index) return true;\n-        const CBlockIndex* index = LookupBlockIndex(hash);\n-        if (!index) return true;\n         BlockFilter filter;\n-        if (!block_filter_index->LookupFilter(index, filter)) return true;\n+        {\n+            LOCK(cs_main);\n+            const CBlockIndex* index = LookupBlockIndex(hash);\n+            if (!index) return true;\n+            if (!block_filter_index->LookupFilter(index, filter)) return true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277110073",
      "id" : 277110073,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NzExMDA3Mw==",
      "original_commit_id" : "106e7c9ab68301c80870a5166d4f5cfb27287679",
      "original_position" : 12,
      "path" : "src/interfaces/chain.cpp",
      "position" : null,
      "pull_request_review_id" : 228848610,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-05T13:40:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277110073",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277110229"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277110229"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe make the BlockFilterType a parameter here?",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-04-19T23:11:46Z",
      "diff_hunk" : "@@ -263,6 +264,19 @@ class ChainImpl : public Chain\n         return std::move(result);\n     }\n     std::unique_ptr<Chain::Lock> assumeLocked() override { return MakeUnique<LockImpl>(); }\n+    bool filterMatchesAny(const uint256& hash, const GCSFilter::ElementSet& filter_set) override",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277110229",
      "id" : 277110229,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NzExMDIyOQ==",
      "original_commit_id" : "106e7c9ab68301c80870a5166d4f5cfb27287679",
      "original_position" : 12,
      "path" : "src/interfaces/chain.cpp",
      "position" : null,
      "pull_request_review_id" : 228848610,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-05T13:40:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277110229",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277110327"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277110327"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'd note in the comment that it's a basic (type) block filter (in cases an other types are added).",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-04-19T23:12:47Z",
      "diff_hunk" : "@@ -677,6 +678,9 @@ class CWallet final : public CCryptoKeyStore, private interfaces::Chain::Notific\n      * Should be called with non-zero block_hash and posInBlock if this is for a transaction that is included in a block. */\n     void SyncTransaction(const CTransactionRef& tx, const uint256& block_hash, int posInBlock = 0, bool update_tx = true) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n \n+    /** Return all scriptPubKeys to be used in a BIP 157 block filter */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277110327",
      "id" : 277110327,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NzExMDMyNw==",
      "original_commit_id" : "106e7c9ab68301c80870a5166d4f5cfb27287679",
      "original_position" : 12,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 228848610,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-05T13:40:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277110327",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277111477"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277111477"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This is problematic for a few reasons.\r\n\r\n1) You can turn on the filter index and it will build in the background using the blocks on disk. This wouldn't work in pruned mode. It might be safe though to allow pruning if the block filter index tip is already within chain tip height - MIN_BLOCKS_TO_KEEP. But then we couldn't prune until the block filter index is in sync (it has its own sort of initial sync logic). Not prohibitively difficult though.\r\n2) There still needs to be logic to fetch blocks from the network if the filters match, which I don't see here. Doing that in a blocking way would probably still be quite slow, especially with the default keypool size as large as it is.",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-04-19T23:24:23Z",
      "diff_hunk" : "@@ -986,9 +986,6 @@ bool AppInitParameterInteraction()\n     if (gArgs.GetArg(\"-prune\", 0)) {\n         if (gArgs.GetBoolArg(\"-txindex\", DEFAULT_TXINDEX))\n             return InitError(_(\"Prune mode is incompatible with -txindex.\"));\n-        if (!g_enabled_filter_types.empty()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277111477",
      "id" : 277111477,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NzExMTQ3Nw==",
      "original_commit_id" : "106e7c9ab68301c80870a5166d4f5cfb27287679",
      "original_position" : 4,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 228848610,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-05T13:40:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277111477",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277112226"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277112226"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Oh, there's another optimization possible, which is to not call `filterMatchesAny` if the filter index doesn't exist or doesn't contain any entry for any of the previously queried block hashes. If `filterMatchesAny` indicates whether the filter was found in addition to whether it matches, it would be pretty easy to check this.",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-04-19T23:31:28Z",
      "diff_hunk" : "@@ -1806,6 +1820,8 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n                 WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", *block_height, progress_current);\n             }\n \n+            if (chain().filterMatchesAny(block_hash, filter_set)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277112226",
      "id" : 277112226,
      "in_reply_to_id" : 277109313,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NzExMjIyNg==",
      "original_commit_id" : "2a884d347eec442e81ce0b9fde7b728caed9d6da",
      "original_position" : 43,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 228852099,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-05T13:40:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277112226",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jimpo  \r\n\r\n> Why is the default keypool size so large?\r\n\r\nIIRC this makes it much less likely typical usage will hit a case when an encrypted wallet runs out of viable keys and starts to miss funds during a sync(since it currently doesn't pause a sync and ask the user for password).",
      "created_at" : "2019-04-20T19:06:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#issuecomment-485151790",
      "id" : 485151790,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15845",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4NTE1MTc5MA==",
      "updated_at" : "2019-04-20T19:06:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/485151790",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "and the obligatory concept ACK!",
      "created_at" : "2019-04-20T19:07:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#issuecomment-485151846",
      "id" : 485151846,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15845",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4NTE1MTg0Ng==",
      "updated_at" : "2019-04-20T19:07:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/485151846",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Why is the default keypool size so large?\r\n\r\nIt isn't. It's small... the whole concept of 'gap' scanning is fairly broken and easily results in funds loss... e.g. when a user hands out multiple addresses to people who haven't used them yet.  The brokenness can be largely addressed by setting the lookahead pretty far.\r\n\r\nIn some prelim testing this appears to be slower than just rescanning the block files directly with a specialized parser. :(",
      "created_at" : "2019-04-20T20:00:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#issuecomment-485160938",
      "id" : 485160938,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15845",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4NTE2MDkzOA==",
      "updated_at" : "2019-04-20T20:00:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/485160938",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@gmaxwell What specialized parser are you comparing to? Does it include the time to match all outputs/inputs to a set of 6000 sPKs?",
      "created_at" : "2019-04-20T20:36:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#issuecomment-485166805",
      "id" : 485166805,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15845",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4NTE2NjgwNQ==",
      "updated_at" : "2019-04-20T20:36:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/485166805",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jimpo 2 keypools (external and change), each 1000 keys, each key 3 sPKs (p2pkh, p2sh-p2wpkh, native p2wpkh), so I expect 6000 entries to match against.",
      "created_at" : "2019-04-20T20:42:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#issuecomment-485167872",
      "id" : 485167872,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15845",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4NTE2Nzg3Mg==",
      "updated_at" : "2019-04-20T20:42:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/485167872",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277298317"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277298317"
         }
      },
      "author_association" : "MEMBER",
      "body" : "CBlockIndex::nDataPos is protected by cs_main, but we never read that in LookupFilter, so yeah, don't need the lock",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-04-22T14:00:01Z",
      "diff_hunk" : "@@ -268,10 +268,13 @@ class ChainImpl : public Chain\n     {\n         const BlockFilterIndex* block_filter_index = GetBlockFilterIndex(BlockFilterType::BASIC);\n         if (!block_filter_index) return true;\n-        const CBlockIndex* index = LookupBlockIndex(hash);\n-        if (!index) return true;\n         BlockFilter filter;\n-        if (!block_filter_index->LookupFilter(index, filter)) return true;\n+        {\n+            LOCK(cs_main);\n+            const CBlockIndex* index = LookupBlockIndex(hash);\n+            if (!index) return true;\n+            if (!block_filter_index->LookupFilter(index, filter)) return true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277298317",
      "id" : 277298317,
      "in_reply_to_id" : 277110073,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NzI5ODMxNw==",
      "original_commit_id" : "106e7c9ab68301c80870a5166d4f5cfb27287679",
      "original_position" : 12,
      "path" : "src/interfaces/chain.cpp",
      "position" : null,
      "pull_request_review_id" : 229072200,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-05T13:40:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277298317",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277298459"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277298459"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Indeed, last_scanned_height is reported by rpc as the stop_height, so should be updated.",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-04-22T14:00:31Z",
      "diff_hunk" : "@@ -1806,6 +1820,8 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n                 WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", *block_height, progress_current);\n             }\n \n+            if (chain().filterMatchesAny(block_hash, filter_set)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277298459",
      "id" : 277298459,
      "in_reply_to_id" : 277109313,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NzI5ODQ1OQ==",
      "original_commit_id" : "2a884d347eec442e81ce0b9fde7b728caed9d6da",
      "original_position" : 43,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 229072386,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-05T13:40:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277298459",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277298780"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277298780"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Will there ever be a filter different from the basic filter?",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-04-22T14:01:27Z",
      "diff_hunk" : "@@ -263,6 +264,19 @@ class ChainImpl : public Chain\n         return std::move(result);\n     }\n     std::unique_ptr<Chain::Lock> assumeLocked() override { return MakeUnique<LockImpl>(); }\n+    bool filterMatchesAny(const uint256& hash, const GCSFilter::ElementSet& filter_set) override",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277298780",
      "id" : 277298780,
      "in_reply_to_id" : 277110229,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NzI5ODc4MA==",
      "original_commit_id" : "106e7c9ab68301c80870a5166d4f5cfb27287679",
      "original_position" : 12,
      "path" : "src/interfaces/chain.cpp",
      "position" : null,
      "pull_request_review_id" : 229072727,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-05T13:40:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277298780",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277299161"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277299161"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Mentioned \"basic\"",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-04-22T14:02:47Z",
      "diff_hunk" : "@@ -677,6 +678,9 @@ class CWallet final : public CCryptoKeyStore, private interfaces::Chain::Notific\n      * Should be called with non-zero block_hash and posInBlock if this is for a transaction that is included in a block. */\n     void SyncTransaction(const CTransactionRef& tx, const uint256& block_hash, int posInBlock = 0, bool update_tx = true) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n \n+    /** Return all scriptPubKeys to be used in a BIP 157 block filter */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277299161",
      "id" : 277299161,
      "in_reply_to_id" : 277110327,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NzI5OTE2MQ==",
      "original_commit_id" : "106e7c9ab68301c80870a5166d4f5cfb27287679",
      "original_position" : 12,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 229073229,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-05T13:40:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277299161",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277299318"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277299318"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Hmm, right",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-04-22T14:03:13Z",
      "diff_hunk" : "@@ -986,9 +986,6 @@ bool AppInitParameterInteraction()\n     if (gArgs.GetArg(\"-prune\", 0)) {\n         if (gArgs.GetBoolArg(\"-txindex\", DEFAULT_TXINDEX))\n             return InitError(_(\"Prune mode is incompatible with -txindex.\"));\n-        if (!g_enabled_filter_types.empty()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277299318",
      "id" : 277299318,
      "in_reply_to_id" : 277111477,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NzI5OTMxOA==",
      "original_commit_id" : "106e7c9ab68301c80870a5166d4f5cfb27287679",
      "original_position" : 4,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 229073407,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-05T13:40:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277299318",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Please review the pulls this is currently based on first:\r\n\r\n*  wallet: Only fail rescan when blocks have actually been pruned #15870 ",
      "created_at" : "2019-04-26T22:28:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#issuecomment-487220362",
      "id" : 487220362,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15845",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4NzIyMDM2Mg==",
      "updated_at" : "2019-04-26T22:28:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/487220362",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-04-27T13:35:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#issuecomment-487286719",
      "id" : 487286719,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15845",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4NzI4NjcxOQ==",
      "updated_at" : "2019-04-27T13:35:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/487286719",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@gmaxwell  modified copy of the old scanner from bitcoin talk, doesn't check the inputs.   I think the main issue is that rehashing all addresses for each block sequentially is pegging a single core and limiting the speed.",
      "created_at" : "2019-05-11T19:56:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#issuecomment-491539541",
      "id" : 491539541,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15845",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5MTUzOTU0MQ==",
      "updated_at" : "2019-05-11T19:56:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/491539541",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. @achow101 how much does this get in the way of #16341?\r\n\r\n`scantxoutset` could be a more light-touch place to try this. ",
      "created_at" : "2019-07-13T15:31:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#issuecomment-511130840",
      "id" : 511130840,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15845",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxMTEzMDg0MA==",
      "updated_at" : "2019-07-13T15:31:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/511130840",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Concept ACK. @achow101 how much does this get in the way of #16341?\r\n\r\nI don't think it really will. The only wallet change looks to be easily portable to the SPKManager model.",
      "created_at" : "2019-07-13T16:39:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#issuecomment-511136177",
      "id" : 511136177,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15845",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxMTEzNjE3Nw==",
      "updated_at" : "2019-07-13T16:39:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/511136177",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I'm unable to compile on macOS:\r\n\r\n```\r\ninterfaces/chain.cpp:258:48: error: constexpr variable 'NO_FILTER' must be initialized by a constant expression\r\n        constexpr static std::pair<bool, bool> NO_FILTER{/* exists */ false, /* matches */ true};\r\n                                               ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\ninterfaces/chain.cpp:258:48: note: non-constexpr constructor 'pair<bool, bool, false>' cannot be used in a constant expression\r\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/include/c++/v1/utility:446:5: note: declared here\r\n    pair(_U1&& __u1, _U2&& __u2)\r\n    ^\r\n1 error generated.\r\nmake[2]: *** [interfaces/libbitcoin_server_a-chain.o] Error 1\r\n```",
      "created_at" : "2019-08-06T14:46:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#issuecomment-518701691",
      "id" : 518701691,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15845",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxODcwMTY5MQ==",
      "updated_at" : "2019-08-06T14:46:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/518701691",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I have pulled out the test changes to #16465, so you might want to review that first.",
      "created_at" : "2019-08-06T17:27:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#issuecomment-518766547",
      "id" : 518766547,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15845",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxODc2NjU0Nw==",
      "updated_at" : "2019-08-06T17:27:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/518766547",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-08-15T15:07:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#issuecomment-521675543",
      "id" : 521675543,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15845",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMTY3NTU0Mw==",
      "updated_at" : "2019-08-15T15:07:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/521675543",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I wrote some more dev doc and unit tests, but they require #16956, so please review that first.",
      "created_at" : "2019-09-24T15:41:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#issuecomment-534618388",
      "id" : 534618388,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15845",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzNDYxODM4OA==",
      "updated_at" : "2019-09-24T15:41:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/534618388",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r328105296"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/328105296"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I was wrong. Fixed.",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-09-25T12:56:59Z",
      "diff_hunk" : "@@ -1748,6 +1748,21 @@ int64_t CWallet::RescanFromTime(int64_t startTime, const WalletRescanReserver& r\n     return startTime;\n }\n \n+GCSFilter::ElementSet CWallet::GetScriptPubKeysForBlockFilter()\n+{\n+    GCSFilter::ElementSet ret;\n+    for (const auto& i : CBasicKeyStore::GetAllWatchedScriptPubKeys()) {\n+        ret.emplace(i.begin(), i.end());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r328105296",
      "id" : 328105296,
      "in_reply_to_id" : 276791064,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyODEwNTI5Ng==",
      "original_commit_id" : "ffff46a547fc03dec3157e56a5953f4b3a8e9937",
      "original_position" : 8,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 293054033,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-05T13:40:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/328105296",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I'm unable to compile on macOS\r\n\r\nI accidentally used C++14, should be fixed now.",
      "created_at" : "2019-09-26T12:21:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#issuecomment-535477260",
      "id" : 535477260,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15845",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzNTQ3NzI2MA==",
      "updated_at" : "2019-09-26T12:21:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/535477260",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Can you make the log mention that it's using the filters? I rescanned a mainnet wallet from genesis. On a 2019 MacBook Pro running macOS 10.14.6, configured without debug, using QT:\r\n* before: 38 minutes\r\n* after: 8 minutes 20 seconds\r\n\r\nIn case you want to tweak the progress bar, it seems a bit pessimistic in the beginning:\r\n```\r\n2019-09-27T19:36:19Z [TestRescan] Rescan started from block 000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f...\r\n2019-09-27T19:37:19Z [TestRescan] Still rescanning. At block 103799. Progress=0.000526\r\n2019-09-27T19:38:19Z [TestRescan] Still rescanning. At block 186382. Progress=0.009899\r\n2019-09-27T19:39:19Z [TestRescan] Still rescanning. At block 276838. Progress=0.065700\r\n2019-09-27T19:40:19Z [TestRescan] Still rescanning. At block 356644. Progress=0.151432\r\n2019-09-27T19:41:19Z [TestRescan] Still rescanning. At block 421003. Progress=0.314152\r\n2019-09-27T19:42:19Z [TestRescan] Still rescanning. At block 476729. Progress=0.529299\r\n2019-09-27T19:43:19Z [TestRescan] Still rescanning. At block 529573. Progress=0.714625\r\n2019-09-27T19:44:19Z [TestRescan] Still rescanning. At block 579080. Progress=0.919178\r\n2019-09-27T19:44:40Z [TestRescan] Rescan completed in          500403ms\r\n```",
      "created_at" : "2019-09-27T20:27:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#issuecomment-536085544",
      "id" : 536085544,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15845",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzNjA4NTU0NA==",
      "updated_at" : "2019-09-27T21:02:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/536085544",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks, force pushed to add logging",
      "created_at" : "2019-10-11T20:24:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#issuecomment-541211630",
      "id" : 541211630,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15845",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0MTIxMTYzMA==",
      "updated_at" : "2019-10-11T20:24:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/541211630",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-10-23T13:42:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#issuecomment-545450049",
      "id" : 545450049,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15845",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NTQ1MDA0OQ==",
      "updated_at" : "2019-10-23T13:42:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/545450049",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r341883162"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/341883162"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This gives me a \"redundant redeclaration\" compiler warning.",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-11-04T00:29:32Z",
      "diff_hunk" : "@@ -55,6 +55,23 @@ CTxIn generatetoaddress(const std::string& address)\n CTxIn MineBlock(const CScript& coinbase_scriptPubKey)\n {\n     auto block = PrepareBlock(coinbase_scriptPubKey);\n+    return *MineBlock(block);\n+}\n+\n+int GetWitnessCommitmentIndex(const CBlock& block);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r341883162",
      "id" : 341883162,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MTg4MzE2Mg==",
      "original_commit_id" : "faff768d67d98183ac3cc3f54826486a99947295",
      "original_position" : 7,
      "path" : "src/test/util.cpp",
      "position" : null,
      "pull_request_review_id" : 310852164,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-05T13:40:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/341883162",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r341883239"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/341883239"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "just a reminder to remove at some point",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-11-04T00:30:53Z",
      "diff_hunk" : "@@ -0,0 +1,214 @@\n+// Copyright (c) 2019 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <rpc/rawtransaction_util.h>\n+#include <test/lib/blockfilter.h>\n+#include <test/setup_common.h>\n+#include <test/util.h>\n+#include <univalue.h>\n+#include <validation.h>\n+#include <wallet/wallet.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+\n+void SignTx(const CWallet& keystore, CMutableTransaction& mtx)\n+{\n+    // Fetch previous transactions (inputs):\n+    std::map<COutPoint, Coin> coins;\n+    for (const CTxIn& txin : mtx.vin) {\n+        coins[txin.prevout]; // Create empty map entry keyed by prevout.\n+    }\n+    keystore.chain().findCoins(coins);\n+\n+    // sign tx\n+    SignTransaction(mtx, /**/ &keystore, coins, UniValue{});\n+}\n+\n+BOOST_FIXTURE_TEST_SUITE(wallet_blockfilter_tests, RegTestingSetup)\n+\n+BOOST_AUTO_TEST_CASE(element_set_matches)\n+{\n+    LogInstance().m_print_to_console = 1; // DEBUG TODO",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r341883239",
      "id" : 341883239,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MTg4MzIzOQ==",
      "original_commit_id" : "faff768d67d98183ac3cc3f54826486a99947295",
      "original_position" : 33,
      "path" : "src/wallet/test/wallet_blockfilter_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 310852164,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-05T13:40:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/341883239",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r342038112"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342038112"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`Optional<bool>` might make more sense?",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-11-04T13:04:42Z",
      "diff_hunk" : "@@ -129,6 +130,12 @@ class Chain\n     //! unlocked when the returned interface is freed.\n     virtual std::unique_ptr<Lock> lock(bool try_lock = false) = 0;\n \n+    //! Returns a pair:\n+    //!  * first : whether the block filter for this block could be found.\n+    //!  * second: whether any of the elements match the block via a BIP 157\n+    //!            block filter.\n+    virtual std::pair<bool, bool> filterMatchesAny(const uint256& hash, const GCSFilter::ElementSet& filter_set) = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r342038112",
      "id" : 342038112,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjAzODExMg==",
      "original_commit_id" : "faff768d67d98183ac3cc3f54826486a99947295",
      "original_position" : 16,
      "path" : "src/interfaces/chain.h",
      "position" : null,
      "pull_request_review_id" : 311053726,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-05T13:40:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342038112",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r342039361"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342039361"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This doesn't check `filter_result.first`",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-11-04T13:07:55Z",
      "diff_hunk" : "@@ -2054,11 +2079,22 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n         }\n         if (GetTime() >= nNow + 60) {\n             nNow = GetTime();\n-            WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", *block_height, progress_current);\n+            const std::string using_blockfilters{filter_result.first /* exists */ ? \" via blockfilters\" : \"\"};\n+            WalletLogPrintf(\"Still rescanning%s. At block %d. Progress=%f\\n\",\n+                using_blockfilters, *block_height, progress_current);\n         }\n \n+        // Only query the filter index if it exists\n+        if (filter_result.first /* exists */) filter_result = chain().filterMatchesAny(block_hash, filter_set);\n+\n         CBlock block;\n-        if (chain().findBlock(block_hash, &block) && !block.IsNull()) {\n+        if (!filter_result.second /* matches */) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r342039361",
      "id" : 342039361,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjAzOTM2MQ==",
      "original_commit_id" : "faff768d67d98183ac3cc3f54826486a99947295",
      "original_position" : 65,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 311055349,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-05T13:40:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342039361",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r342328744"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342328744"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Is `Optional` needed? This function always returns a block.",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-11-04T23:59:24Z",
      "diff_hunk" : "@@ -57,6 +57,23 @@ CTxIn generatetoaddress(const std::string& address)\n CTxIn MineBlock(const CScript& coinbase_scriptPubKey)\n {\n     auto block = PrepareBlock(coinbase_scriptPubKey);\n+    return *MineBlock(block);\n+}\n+\n+int GetWitnessCommitmentIndex(const CBlock& block);\n+\n+Optional<CTxIn> MineBlock(std::shared_ptr<CBlock>& block)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r342328744",
      "id" : 342328744,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjMyODc0NA==",
      "original_commit_id" : "04e729eef2a0e8be6816181a0255d4f89b957ce0",
      "original_position" : 9,
      "path" : "src/test/util.cpp",
      "position" : 7,
      "pull_request_review_id" : 311434350,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-05T13:40:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342328744",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r342328887"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342328887"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Could you clarify this comment a bit. In case what?",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-11-04T23:59:56Z",
      "diff_hunk" : "@@ -57,6 +57,23 @@ CTxIn generatetoaddress(const std::string& address)\n CTxIn MineBlock(const CScript& coinbase_scriptPubKey)\n {\n     auto block = PrepareBlock(coinbase_scriptPubKey);\n+    return *MineBlock(block);\n+}\n+\n+int GetWitnessCommitmentIndex(const CBlock& block);\n+\n+Optional<CTxIn> MineBlock(std::shared_ptr<CBlock>& block)\n+{\n+    const auto idx = GetWitnessCommitmentIndex(*block);\n+    if (idx != -1) {\n+        // Refresh, just in case",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r342328887",
      "id" : 342328887,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjMyODg4Nw==",
      "original_commit_id" : "04e729eef2a0e8be6816181a0255d4f89b957ce0",
      "original_position" : 13,
      "path" : "src/test/util.cpp",
      "position" : null,
      "pull_request_review_id" : 311434350,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-05T13:40:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342328887",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r342329664"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342329664"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Could you update the commit message to explain this change?",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-11-05T00:03:10Z",
      "diff_hunk" : "@@ -57,6 +57,23 @@ CTxIn generatetoaddress(const std::string& address)\n CTxIn MineBlock(const CScript& coinbase_scriptPubKey)\n {\n     auto block = PrepareBlock(coinbase_scriptPubKey);\n+    return *MineBlock(block);\n+}\n+\n+int GetWitnessCommitmentIndex(const CBlock& block);\n+\n+Optional<CTxIn> MineBlock(std::shared_ptr<CBlock>& block)\n+{\n+    const auto idx = GetWitnessCommitmentIndex(*block);\n+    if (idx != -1) {\n+        // Refresh, just in case\n+        CMutableTransaction tx_cb{*block->vtx[0]};\n+        tx_cb.vout.erase(tx_cb.vout.begin() + idx);\n+        block->vtx[0] = MakeTransactionRef(std::move(tx_cb));\n+        LOCK(cs_main);\n+        GenerateCoinbaseCommitment(*block, ChainActive().Tip()->pprev, Params().GetConsensus());\n+    }\n+    block->hashMerkleRoot = BlockMerkleRoot(*block);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r342329664",
      "id" : 342329664,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjMyOTY2NA==",
      "original_commit_id" : "04e729eef2a0e8be6816181a0255d4f89b957ce0",
      "original_position" : 20,
      "path" : "src/test/util.cpp",
      "position" : null,
      "pull_request_review_id" : 311434350,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-05T13:40:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342329664",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r342330912"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342330912"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "grammar nit: s/or a more efficient/or for a more efficient",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-11-05T00:08:27Z",
      "diff_hunk" : "@@ -15,7 +15,7 @@\n  * blocks by height. An index is constructed for each supported filter type with its own database\n  * (ie. filter data for different types are stored in separate databases).\n  *\n- * This index is used to serve BIP 157 net requests.\n+ * This index can be used to serve BIP 157 net requests or a more efficient wallet rescan.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r342330912",
      "id" : 342330912,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjMzMDkxMg==",
      "original_commit_id" : "2499fd09a5a23e42bc3f2593b0d1c003fa7a6372",
      "original_position" : 5,
      "path" : "src/index/blockfilterindex.h",
      "position" : null,
      "pull_request_review_id" : 311434350,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-05T13:40:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342330912",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r342355120"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342355120"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This is quite a complicated interface which asks a lot from the caller. This is an indication that the calling code should be refactored to use better abstractions.\r\n\r\nFor instance, a `BlockScanner` abstraction could be used to return blocks and whose implementation may vary depending on whether block filters exist. The logic around filters could be encapsulated there rather than having the details exposed in the wallet. I think this would benefit long-term code health.",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-11-05T02:05:06Z",
      "diff_hunk" : "@@ -129,6 +130,12 @@ class Chain\n     //! unlocked when the returned interface is freed.\n     virtual std::unique_ptr<Lock> lock(bool try_lock = false) = 0;\n \n+    //! Returns a pair:\n+    //!  * first : whether the block filter for this block could be found.\n+    //!  * second: whether any of the elements match the block via a BIP 157\n+    //!            block filter.\n+    virtual std::pair<bool, bool> filterMatchesAny(const uint256& hash, const GCSFilter::ElementSet& filter_set) = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r342355120",
      "id" : 342355120,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjM1NTEyMA==",
      "original_commit_id" : "8edf3c6e2155e37740a7c2ec36e40600d8c4d19c",
      "original_position" : 16,
      "path" : "src/interfaces/chain.h",
      "position" : null,
      "pull_request_review_id" : 311434350,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-05T13:40:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342355120",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r342552448"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342552448"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks. Not sure how that got there. Removed",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-11-05T13:08:51Z",
      "diff_hunk" : "@@ -55,6 +55,23 @@ CTxIn generatetoaddress(const std::string& address)\n CTxIn MineBlock(const CScript& coinbase_scriptPubKey)\n {\n     auto block = PrepareBlock(coinbase_scriptPubKey);\n+    return *MineBlock(block);\n+}\n+\n+int GetWitnessCommitmentIndex(const CBlock& block);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r342552448",
      "id" : 342552448,
      "in_reply_to_id" : 341883162,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjU1MjQ0OA==",
      "original_commit_id" : "faff768d67d98183ac3cc3f54826486a99947295",
      "original_position" : 7,
      "path" : "src/test/util.cpp",
      "position" : null,
      "pull_request_review_id" : 311719166,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-05T13:40:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342552448",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r342552519"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342552519"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Removed",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-11-05T13:09:03Z",
      "diff_hunk" : "@@ -0,0 +1,214 @@\n+// Copyright (c) 2019 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <rpc/rawtransaction_util.h>\n+#include <test/lib/blockfilter.h>\n+#include <test/setup_common.h>\n+#include <test/util.h>\n+#include <univalue.h>\n+#include <validation.h>\n+#include <wallet/wallet.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+\n+void SignTx(const CWallet& keystore, CMutableTransaction& mtx)\n+{\n+    // Fetch previous transactions (inputs):\n+    std::map<COutPoint, Coin> coins;\n+    for (const CTxIn& txin : mtx.vin) {\n+        coins[txin.prevout]; // Create empty map entry keyed by prevout.\n+    }\n+    keystore.chain().findCoins(coins);\n+\n+    // sign tx\n+    SignTransaction(mtx, /**/ &keystore, coins, UniValue{});\n+}\n+\n+BOOST_FIXTURE_TEST_SUITE(wallet_blockfilter_tests, RegTestingSetup)\n+\n+BOOST_AUTO_TEST_CASE(element_set_matches)\n+{\n+    LogInstance().m_print_to_console = 1; // DEBUG TODO",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r342552519",
      "id" : 342552519,
      "in_reply_to_id" : 341883239,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjU1MjUxOQ==",
      "original_commit_id" : "faff768d67d98183ac3cc3f54826486a99947295",
      "original_position" : 33,
      "path" : "src/wallet/test/wallet_blockfilter_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 311719263,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-05T13:40:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342552519",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r342557326"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342557326"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added docs",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-11-05T13:19:28Z",
      "diff_hunk" : "@@ -57,6 +57,23 @@ CTxIn generatetoaddress(const std::string& address)\n CTxIn MineBlock(const CScript& coinbase_scriptPubKey)\n {\n     auto block = PrepareBlock(coinbase_scriptPubKey);\n+    return *MineBlock(block);\n+}\n+\n+int GetWitnessCommitmentIndex(const CBlock& block);\n+\n+Optional<CTxIn> MineBlock(std::shared_ptr<CBlock>& block)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r342557326",
      "id" : 342557326,
      "in_reply_to_id" : 342328744,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjU1NzMyNg==",
      "original_commit_id" : "04e729eef2a0e8be6816181a0255d4f89b957ce0",
      "original_position" : 9,
      "path" : "src/test/util.cpp",
      "position" : 7,
      "pull_request_review_id" : 311725321,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-05T13:40:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342557326",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r342557421"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342557421"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added docs. Thx",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-11-05T13:19:41Z",
      "diff_hunk" : "@@ -57,6 +57,23 @@ CTxIn generatetoaddress(const std::string& address)\n CTxIn MineBlock(const CScript& coinbase_scriptPubKey)\n {\n     auto block = PrepareBlock(coinbase_scriptPubKey);\n+    return *MineBlock(block);\n+}\n+\n+int GetWitnessCommitmentIndex(const CBlock& block);\n+\n+Optional<CTxIn> MineBlock(std::shared_ptr<CBlock>& block)\n+{\n+    const auto idx = GetWitnessCommitmentIndex(*block);\n+    if (idx != -1) {\n+        // Refresh, just in case",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r342557421",
      "id" : 342557421,
      "in_reply_to_id" : 342328887,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjU1NzQyMQ==",
      "original_commit_id" : "04e729eef2a0e8be6816181a0255d4f89b957ce0",
      "original_position" : 13,
      "path" : "src/test/util.cpp",
      "position" : null,
      "pull_request_review_id" : 311725437,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-05T13:40:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342557421",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r342557498"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342557498"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added docs",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-11-05T13:19:51Z",
      "diff_hunk" : "@@ -57,6 +57,23 @@ CTxIn generatetoaddress(const std::string& address)\n CTxIn MineBlock(const CScript& coinbase_scriptPubKey)\n {\n     auto block = PrepareBlock(coinbase_scriptPubKey);\n+    return *MineBlock(block);\n+}\n+\n+int GetWitnessCommitmentIndex(const CBlock& block);\n+\n+Optional<CTxIn> MineBlock(std::shared_ptr<CBlock>& block)\n+{\n+    const auto idx = GetWitnessCommitmentIndex(*block);\n+    if (idx != -1) {\n+        // Refresh, just in case\n+        CMutableTransaction tx_cb{*block->vtx[0]};\n+        tx_cb.vout.erase(tx_cb.vout.begin() + idx);\n+        block->vtx[0] = MakeTransactionRef(std::move(tx_cb));\n+        LOCK(cs_main);\n+        GenerateCoinbaseCommitment(*block, ChainActive().Tip()->pprev, Params().GetConsensus());\n+    }\n+    block->hashMerkleRoot = BlockMerkleRoot(*block);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r342557498",
      "id" : 342557498,
      "in_reply_to_id" : 342329664,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjU1NzQ5OA==",
      "original_commit_id" : "04e729eef2a0e8be6816181a0255d4f89b957ce0",
      "original_position" : 20,
      "path" : "src/test/util.cpp",
      "position" : null,
      "pull_request_review_id" : 311725531,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-05T13:40:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342557498",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r342567525"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342567525"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Reworded",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-11-05T13:41:10Z",
      "diff_hunk" : "@@ -15,7 +15,7 @@\n  * blocks by height. An index is constructed for each supported filter type with its own database\n  * (ie. filter data for different types are stored in separate databases).\n  *\n- * This index is used to serve BIP 157 net requests.\n+ * This index can be used to serve BIP 157 net requests or a more efficient wallet rescan.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r342567525",
      "id" : 342567525,
      "in_reply_to_id" : 342330912,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjU2NzUyNQ==",
      "original_commit_id" : "2499fd09a5a23e42bc3f2593b0d1c003fa7a6372",
      "original_position" : 5,
      "path" : "src/index/blockfilterindex.h",
      "position" : null,
      "pull_request_review_id" : 311738852,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-05T13:41:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342567525",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r342567768"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342567768"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, switched to `Optional<>`",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-11-05T13:41:39Z",
      "diff_hunk" : "@@ -129,6 +130,12 @@ class Chain\n     //! unlocked when the returned interface is freed.\n     virtual std::unique_ptr<Lock> lock(bool try_lock = false) = 0;\n \n+    //! Returns a pair:\n+    //!  * first : whether the block filter for this block could be found.\n+    //!  * second: whether any of the elements match the block via a BIP 157\n+    //!            block filter.\n+    virtual std::pair<bool, bool> filterMatchesAny(const uint256& hash, const GCSFilter::ElementSet& filter_set) = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r342567768",
      "id" : 342567768,
      "in_reply_to_id" : 342038112,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjU2Nzc2OA==",
      "original_commit_id" : "faff768d67d98183ac3cc3f54826486a99947295",
      "original_position" : 16,
      "path" : "src/interfaces/chain.h",
      "position" : null,
      "pull_request_review_id" : 311739170,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-05T13:41:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342567768",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r342567849"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342567849"
         }
      },
      "author_association" : "MEMBER",
      "body" : "fixed",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-11-05T13:41:49Z",
      "diff_hunk" : "@@ -2054,11 +2079,22 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n         }\n         if (GetTime() >= nNow + 60) {\n             nNow = GetTime();\n-            WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", *block_height, progress_current);\n+            const std::string using_blockfilters{filter_result.first /* exists */ ? \" via blockfilters\" : \"\"};\n+            WalletLogPrintf(\"Still rescanning%s. At block %d. Progress=%f\\n\",\n+                using_blockfilters, *block_height, progress_current);\n         }\n \n+        // Only query the filter index if it exists\n+        if (filter_result.first /* exists */) filter_result = chain().filterMatchesAny(block_hash, filter_set);\n+\n         CBlock block;\n-        if (chain().findBlock(block_hash, &block) && !block.IsNull()) {\n+        if (!filter_result.second /* matches */) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r342567849",
      "id" : 342567849,
      "in_reply_to_id" : 342039361,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjU2Nzg0OQ==",
      "original_commit_id" : "faff768d67d98183ac3cc3f54826486a99947295",
      "original_position" : 65,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 311739286,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-05T13:41:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342567849",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r342568179"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342568179"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this can be done as a follow-up",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-11-05T13:42:31Z",
      "diff_hunk" : "@@ -129,6 +130,12 @@ class Chain\n     //! unlocked when the returned interface is freed.\n     virtual std::unique_ptr<Lock> lock(bool try_lock = false) = 0;\n \n+    //! Returns a pair:\n+    //!  * first : whether the block filter for this block could be found.\n+    //!  * second: whether any of the elements match the block via a BIP 157\n+    //!            block filter.\n+    virtual std::pair<bool, bool> filterMatchesAny(const uint256& hash, const GCSFilter::ElementSet& filter_set) = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r342568179",
      "id" : 342568179,
      "in_reply_to_id" : 342355120,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjU2ODE3OQ==",
      "original_commit_id" : "8edf3c6e2155e37740a7c2ec36e40600d8c4d19c",
      "original_position" : 16,
      "path" : "src/interfaces/chain.h",
      "position" : null,
      "pull_request_review_id" : 311739759,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-05T13:42:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342568179",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the review @mzumsande , @luke-jr , @jkczyz . Addressed all your feedback in the latest push",
      "created_at" : "2019-11-05T13:43:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#issuecomment-549827788",
      "id" : 549827788,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15845",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0OTgyNzc4OA==",
      "updated_at" : "2019-11-05T13:43:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/549827788",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r343201200"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343201200"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Which docs? I still don't understand why you're using an optional here. The TODO implies that you plan to implement something in a later PR. Can you just return a `CTxIn` until then?",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-11-06T16:37:14Z",
      "diff_hunk" : "@@ -57,6 +57,23 @@ CTxIn generatetoaddress(const std::string& address)\n CTxIn MineBlock(const CScript& coinbase_scriptPubKey)\n {\n     auto block = PrepareBlock(coinbase_scriptPubKey);\n+    return *MineBlock(block);\n+}\n+\n+int GetWitnessCommitmentIndex(const CBlock& block);\n+\n+Optional<CTxIn> MineBlock(std::shared_ptr<CBlock>& block)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r343201200",
      "id" : 343201200,
      "in_reply_to_id" : 342328744,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MzIwMTIwMA==",
      "original_commit_id" : "04e729eef2a0e8be6816181a0255d4f89b957ce0",
      "original_position" : 9,
      "path" : "src/test/util.cpp",
      "position" : 7,
      "pull_request_review_id" : 312576716,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-06T18:51:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343201200",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r343201892"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343201892"
         }
      },
      "author_association" : "MEMBER",
      "body" : "s/coins/coin/\r\n\r\nI also don't like the (mis)use of the word coin here, which is generally understood to mean a utxo. These functions return a CTxIn that points to the first coinbase output.",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-11-06T16:38:22Z",
      "diff_hunk" : "@@ -19,8 +21,10 @@ extern const std::string ADDRESS_BCRT1_UNSPENDABLE;\n \n // Lower-level utils //\n \n-/** Returns the generated coin */\n+/** Returns the generated coin (output at index 0 in the coinbase tx) */\n CTxIn MineBlock(const CScript& coinbase_scriptPubKey);\n+/** Returns the generated coins (output at index 0 in the coinbase tx), or nothing if the block was invalid */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r343201892",
      "id" : 343201892,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MzIwMTg5Mg==",
      "original_commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "original_position" : 16,
      "path" : "src/test/util.h",
      "position" : 16,
      "pull_request_review_id" : 312576716,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-06T18:51:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343201892",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r343230189"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343230189"
         }
      },
      "author_association" : "NONE",
      "body" : "This could lock even smaller block of code:\r\n```\r\n        {\r\n            LOCK(cs_main);\r\n            index = LookupBlockIndex(hash);\r\n        }\r\n        if (!index) return {};\r\n```\r\n\r\nOr maybe you would care to use `ES.28: Use lambdas for complex initialization, especially of const variables` guideline (note `const` for `index` pointer itself):\r\n```\r\nconst CBlockIndex* const index = [&]{ \r\n    LOCK(cs_main);\r\n    return LookupBlockIndex(hash);\r\n}();\r\nif (!index) return {};\r\n```\r\n```",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-11-06T17:32:41Z",
      "diff_hunk" : "@@ -248,6 +249,20 @@ class ChainImpl : public Chain\n         // LockImpl to Lock pointer\n         return std::move(result);\n     }\n+    Optional<bool> filterMatchesAny(const uint256& hash, const GCSFilter::ElementSet& filter_set) override\n+    {\n+        const BlockFilterIndex* block_filter_index = GetBlockFilterIndex(BlockFilterType::BASIC);\n+        if (!block_filter_index) return {};\n+        BlockFilter filter;\n+        const CBlockIndex* index;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r343230189",
      "id" : 343230189,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MzIzMDE4OQ==",
      "original_commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "original_position" : 17,
      "path" : "src/interfaces/chain.cpp",
      "position" : 17,
      "pull_request_review_id" : 312615430,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-06T17:40:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343230189",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/292191?v=4",
         "events_url" : "https://api.github.com/users/Talkless/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Talkless/followers",
         "following_url" : "https://api.github.com/users/Talkless/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Talkless/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Talkless",
         "id" : 292191,
         "login" : "Talkless",
         "node_id" : "MDQ6VXNlcjI5MjE5MQ==",
         "organizations_url" : "https://api.github.com/users/Talkless/orgs",
         "received_events_url" : "https://api.github.com/users/Talkless/received_events",
         "repos_url" : "https://api.github.com/users/Talkless/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Talkless/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Talkless/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Talkless"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r343230849"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343230849"
         }
      },
      "author_association" : "NONE",
      "body" : "Looks like the pointer itself could be even const too: \r\nconst BlockFilterIndex* **const** block_filter_index = ...",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-11-06T17:34:05Z",
      "diff_hunk" : "@@ -248,6 +249,20 @@ class ChainImpl : public Chain\n         // LockImpl to Lock pointer\n         return std::move(result);\n     }\n+    Optional<bool> filterMatchesAny(const uint256& hash, const GCSFilter::ElementSet& filter_set) override\n+    {\n+        const BlockFilterIndex* block_filter_index = GetBlockFilterIndex(BlockFilterType::BASIC);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r343230849",
      "id" : 343230849,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MzIzMDg0OQ==",
      "original_commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "original_position" : 14,
      "path" : "src/interfaces/chain.cpp",
      "position" : 14,
      "pull_request_review_id" : 312615430,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-06T17:40:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343230849",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/292191?v=4",
         "events_url" : "https://api.github.com/users/Talkless/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Talkless/followers",
         "following_url" : "https://api.github.com/users/Talkless/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Talkless/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Talkless",
         "id" : 292191,
         "login" : "Talkless",
         "node_id" : "MDQ6VXNlcjI5MjE5MQ==",
         "organizations_url" : "https://api.github.com/users/Talkless/orgs",
         "received_events_url" : "https://api.github.com/users/Talkless/received_events",
         "repos_url" : "https://api.github.com/users/Talkless/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Talkless/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Talkless/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Talkless"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r343265997"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343265997"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Setting the filter_set outside the rescan loop means that this doesn't get updated when the keypool is topped up. That means that any payments to an address beyond the first 1000 will be missed on rescan.",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-11-06T18:50:06Z",
      "diff_hunk" : "@@ -1574,14 +1574,14 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n {\n     int64_t nNow = GetTime();\n     int64_t start_time = GetTimeMillis();\n-\n     assert(reserver.isReserved());\n-\n-    uint256 block_hash = start_block;\n     ScanResult result;\n \n     WalletLogPrintf(\"Rescan started from block %s...\\n\", start_block.ToString());\n \n+    uint256 block_hash = start_block;\n+    const auto filter_set = GetLegacyScriptPubKeyMan()->GetAllRelevantScriptPubKeys();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r343265997",
      "id" : 343265997,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MzI2NTk5Nw==",
      "original_commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "original_position" : 13,
      "path" : "src/wallet/wallet.cpp",
      "position" : 13,
      "pull_request_review_id" : 312576716,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-06T18:51:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343265997",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think as well as fixing the bug here: https://github.com/bitcoin/bitcoin/pull/15845#discussion_r343265997, it'd be useful to add a test that would catch cases like this, where a rescan exhausts the keypool.",
      "created_at" : "2019-11-06T18:53:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#issuecomment-550450154",
      "id" : 550450154,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15845",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1MDQ1MDE1NA==",
      "updated_at" : "2019-11-06T18:53:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/550450154",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-11-07T14:28:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#issuecomment-551102346",
      "id" : 551102346,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15845",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1MTEwMjM0Ng==",
      "updated_at" : "2019-11-07T14:28:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/551102346",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r344788060"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/344788060"
         }
      },
      "author_association" : "MEMBER",
      "body" : "What about `mapCryptedKeys`? I don't think `mapKeys` is used on encrypted wallets?",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-11-11T16:13:45Z",
      "diff_hunk" : "@@ -820,6 +820,31 @@ bool LegacyScriptPubKeyMan::GetPubKey(const CKeyID &address, CPubKey& vchPubKeyO\n     return GetWatchPubKey(address, vchPubKeyOut);\n }\n \n+GCSFilter::ElementSet LegacyScriptPubKeyMan::GetAllRelevantScriptPubKeys() const\n+{\n+    LOCK(cs_KeyStore);\n+    GCSFilter::ElementSet ret;\n+    for (const auto& k : mapKeys) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r344788060",
      "id" : 344788060,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NDc4ODA2MA==",
      "original_commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "original_position" : 8,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 8,
      "pull_request_review_id" : 315000340,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-11T16:13:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/344788060",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r344843159"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/344843159"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> What about `mapCryptedKeys`? I don't think `mapKeys` is used on encrypted wallets?\r\n\r\nYes, this should just loop over `mapCryptedKeys` as well. `mapKeys` should be empty in encryped wallets.",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-11-11T18:18:05Z",
      "diff_hunk" : "@@ -820,6 +820,31 @@ bool LegacyScriptPubKeyMan::GetPubKey(const CKeyID &address, CPubKey& vchPubKeyO\n     return GetWatchPubKey(address, vchPubKeyOut);\n }\n \n+GCSFilter::ElementSet LegacyScriptPubKeyMan::GetAllRelevantScriptPubKeys() const\n+{\n+    LOCK(cs_KeyStore);\n+    GCSFilter::ElementSet ret;\n+    for (const auto& k : mapKeys) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r344843159",
      "id" : 344843159,
      "in_reply_to_id" : 344788060,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NDg0MzE1OQ==",
      "original_commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "original_position" : 8,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 8,
      "pull_request_review_id" : 315070888,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-11T18:18:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/344843159",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r344994878"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/344994878"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This function in general does not match everything that `IsMine` would match.In particular it doesn't enumerate all possible combinations of multisig policies with all combinations of pubkeys or all of the weird nested scripts that are possible. There probably needs to be a release note that if you have some weird and non-standard script stuff, the fast rescan won't see those things.",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-11-12T02:38:56Z",
      "diff_hunk" : "@@ -820,6 +820,31 @@ bool LegacyScriptPubKeyMan::GetPubKey(const CKeyID &address, CPubKey& vchPubKeyO\n     return GetWatchPubKey(address, vchPubKeyOut);\n }\n \n+GCSFilter::ElementSet LegacyScriptPubKeyMan::GetAllRelevantScriptPubKeys() const\n+{\n+    LOCK(cs_KeyStore);\n+    GCSFilter::ElementSet ret;\n+    for (const auto& k : mapKeys) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r344994878",
      "id" : 344994878,
      "in_reply_to_id" : 344788060,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NDk5NDg3OA==",
      "original_commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "original_position" : 8,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 8,
      "pull_request_review_id" : 315265859,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-12T02:38:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/344994878",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r346270124"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346270124"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Such a warning makes sense; people with such wallets will presumably understand. And descriptor wallets won't have this problem.",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-11-14T11:52:14Z",
      "diff_hunk" : "@@ -820,6 +820,31 @@ bool LegacyScriptPubKeyMan::GetPubKey(const CKeyID &address, CPubKey& vchPubKeyO\n     return GetWatchPubKey(address, vchPubKeyOut);\n }\n \n+GCSFilter::ElementSet LegacyScriptPubKeyMan::GetAllRelevantScriptPubKeys() const\n+{\n+    LOCK(cs_KeyStore);\n+    GCSFilter::ElementSet ret;\n+    for (const auto& k : mapKeys) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r346270124",
      "id" : 346270124,
      "in_reply_to_id" : 344788060,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NjI3MDEyNA==",
      "original_commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "original_position" : 8,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 8,
      "pull_request_review_id" : 316897708,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-14T11:52:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346270124",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r346321905"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346321905"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`IsMine` itself won't test weird combinations. I don't see why fast rescan shouldn't be able to check for everything `IsMine` does... users shouldn't be exposed to internal implementation details like this.",
      "commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "created_at" : "2019-11-14T13:52:28Z",
      "diff_hunk" : "@@ -820,6 +820,31 @@ bool LegacyScriptPubKeyMan::GetPubKey(const CKeyID &address, CPubKey& vchPubKeyO\n     return GetWatchPubKey(address, vchPubKeyOut);\n }\n \n+GCSFilter::ElementSet LegacyScriptPubKeyMan::GetAllRelevantScriptPubKeys() const\n+{\n+    LOCK(cs_KeyStore);\n+    GCSFilter::ElementSet ret;\n+    for (const auto& k : mapKeys) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r346321905",
      "id" : 346321905,
      "in_reply_to_id" : 344788060,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NjMyMTkwNQ==",
      "original_commit_id" : "faee7b6581ff5e9fa775e1e9cbe7491b60f0e73b",
      "original_position" : 8,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 8,
      "pull_request_review_id" : 316966197,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-11-14T13:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346321905",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   }
]
