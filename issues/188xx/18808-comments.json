[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #17303 (p2p: Stop relaying non-mempool txs, improve tx privacy slightly by MarcoFalke)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-04-29T02:40:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18808#issuecomment-620960726",
      "id" : 620960726,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18808",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMDk2MDcyNg==",
      "updated_at" : "2020-04-29T10:58:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/620960726",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18808#discussion_r417307258"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18808"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417307258"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why is it ok to remove the nullptr check? This line crashes the node.",
      "commit_id" : "9847e205bf7edcac4c30ce4b6d62f482aa7bc1b7",
      "created_at" : "2020-04-29T13:19:46Z",
      "diff_hunk" : "@@ -1595,26 +1595,30 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n     std::vector<CInv> vNotFound;\n     const CNetMsgMaker msgMaker(pfrom->GetSendVersion());\n \n-    // Note that if we receive a getdata for a MSG_TX or MSG_WITNESS_TX from a\n-    // block-relay-only outbound peer, we will stop processing further getdata\n-    // messages from this peer (likely resulting in our peer eventually\n-    // disconnecting us).\n-    if (pfrom->m_tx_relay != nullptr) {\n-        // mempool entries added before this time have likely expired from mapRelay\n-        const std::chrono::seconds longlived_mempool_time = GetTime<std::chrono::seconds>() - RELAY_TX_CACHE_TIME;\n-        const std::chrono::seconds mempool_req = pfrom->m_tx_relay->m_last_mempool_req.load();\n+    // mempool entries added before this time have likely expired from mapRelay\n+    const std::chrono::seconds longlived_mempool_time = GetTime<std::chrono::seconds>() - RELAY_TX_CACHE_TIME;\n+    const std::chrono::seconds mempool_req = pfrom->m_tx_relay->m_last_mempool_req.load();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18808#discussion_r417307258",
      "id" : 417307258,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzMwNzI1OA==",
      "original_commit_id" : "c71754bd93d4801be4a0e73a4181f167d4de41ef",
      "original_line" : 1600,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 402656648,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18808",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T23:34:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417307258",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2020-04-29T13:20:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18808#issuecomment-621200305",
      "id" : 621200305,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18808",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMTIwMDMwNQ==",
      "updated_at" : "2020-04-29T13:20:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/621200305",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18808#discussion_r417382259"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18808"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417382259"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks. Fixed.",
      "commit_id" : "9847e205bf7edcac4c30ce4b6d62f482aa7bc1b7",
      "created_at" : "2020-04-29T14:57:01Z",
      "diff_hunk" : "@@ -1595,26 +1595,30 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n     std::vector<CInv> vNotFound;\n     const CNetMsgMaker msgMaker(pfrom->GetSendVersion());\n \n-    // Note that if we receive a getdata for a MSG_TX or MSG_WITNESS_TX from a\n-    // block-relay-only outbound peer, we will stop processing further getdata\n-    // messages from this peer (likely resulting in our peer eventually\n-    // disconnecting us).\n-    if (pfrom->m_tx_relay != nullptr) {\n-        // mempool entries added before this time have likely expired from mapRelay\n-        const std::chrono::seconds longlived_mempool_time = GetTime<std::chrono::seconds>() - RELAY_TX_CACHE_TIME;\n-        const std::chrono::seconds mempool_req = pfrom->m_tx_relay->m_last_mempool_req.load();\n+    // mempool entries added before this time have likely expired from mapRelay\n+    const std::chrono::seconds longlived_mempool_time = GetTime<std::chrono::seconds>() - RELAY_TX_CACHE_TIME;\n+    const std::chrono::seconds mempool_req = pfrom->m_tx_relay->m_last_mempool_req.load();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18808#discussion_r417382259",
      "id" : 417382259,
      "in_reply_to_id" : 417307258,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzM4MjI1OQ==",
      "original_commit_id" : "c71754bd93d4801be4a0e73a4181f167d4de41ef",
      "original_line" : 1600,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 402752463,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18808",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T23:34:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417382259",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK, light code review ack",
      "created_at" : "2020-04-29T16:33:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18808#issuecomment-621324519",
      "id" : 621324519,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18808",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMTMyNDUxOQ==",
      "updated_at" : "2020-04-29T16:33:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/621324519",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18808#discussion_r417455006"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18808"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417455006"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "What's the worst local processing delay we may expect if 2 blocks are generated within 5 seconds (and got queued together), but we process them separately?\r\nThe probability of this is definitely non-zero.\r\n",
      "commit_id" : "9847e205bf7edcac4c30ce4b6d62f482aa7bc1b7",
      "created_at" : "2020-04-29T16:38:13Z",
      "diff_hunk" : "@@ -1642,19 +1648,17 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n         }\n     } // release cs_main\n \n+    // Only process one BLOCK item per call, since they're uncommon and can be",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18808#discussion_r417455006",
      "id" : 417455006,
      "line" : 1651,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQ1NTAwNg==",
      "original_commit_id" : "4ecd5585cf9a9888253eb9ade6a00df48f694fef",
      "original_line" : 1651,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 48,
      "pull_request_review_id" : 402844604,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18808",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T23:34:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417455006",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18808#discussion_r417595662"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18808"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417595662"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Usually milliseconds. However long it takes to do one round of the messagehandler thread. We won't pause processing for 100ms because there's more work to do for this peer.",
      "commit_id" : "9847e205bf7edcac4c30ce4b6d62f482aa7bc1b7",
      "created_at" : "2020-04-29T20:36:44Z",
      "diff_hunk" : "@@ -1642,19 +1648,17 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n         }\n     } // release cs_main\n \n+    // Only process one BLOCK item per call, since they're uncommon and can be",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18808#discussion_r417595662",
      "id" : 417595662,
      "in_reply_to_id" : 417455006,
      "line" : 1651,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzU5NTY2Mg==",
      "original_commit_id" : "4ecd5585cf9a9888253eb9ade6a00df48f694fef",
      "original_line" : 1651,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 48,
      "pull_request_review_id" : 403019073,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18808",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T23:34:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417595662",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18808#discussion_r417643531"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18808"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417643531"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "What's the purpose of this override? (No invs seem to be sent in the test)",
      "commit_id" : "9847e205bf7edcac4c30ce4b6d62f482aa7bc1b7",
      "created_at" : "2020-04-29T22:12:20Z",
      "diff_hunk" : "@@ -0,0 +1,55 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test GETDATA processing behavior\"\"\"\n+from collections import defaultdict\n+\n+from test_framework.messages import (\n+    CInv,\n+    msg_getdata,\n+)\n+from test_framework.mininode import (\n+    mininode_lock,\n+    P2PInterface,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+class P2PStoreBlock(P2PInterface):\n+\n+    def __init__(self):\n+        super().__init__()\n+        self.blocks = defaultdict(int)\n+\n+    def on_inv(self, message):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18808#discussion_r417643531",
      "id" : 417643531,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzY0MzUzMQ==",
      "original_commit_id" : "a458f713d7d7668cf329e9b66f29a2d6f0f9aa17",
      "original_line" : 25,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "test/functional/p2p_getdata.py",
      "position" : null,
      "pull_request_review_id" : 403077247,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18808",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T23:34:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417643531",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18808#discussion_r417671022"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18808"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417671022"
         }
      },
      "author_association" : "MEMBER",
      "body" : "no reason. Bad copy-paste. Fixed. Thanks!",
      "commit_id" : "9847e205bf7edcac4c30ce4b6d62f482aa7bc1b7",
      "created_at" : "2020-04-29T23:29:50Z",
      "diff_hunk" : "@@ -0,0 +1,55 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test GETDATA processing behavior\"\"\"\n+from collections import defaultdict\n+\n+from test_framework.messages import (\n+    CInv,\n+    msg_getdata,\n+)\n+from test_framework.mininode import (\n+    mininode_lock,\n+    P2PInterface,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+class P2PStoreBlock(P2PInterface):\n+\n+    def __init__(self):\n+        super().__init__()\n+        self.blocks = defaultdict(int)\n+\n+    def on_inv(self, message):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18808#discussion_r417671022",
      "id" : 417671022,
      "in_reply_to_id" : 417643531,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzY3MTAyMg==",
      "original_commit_id" : "a458f713d7d7668cf329e9b66f29a2d6f0f9aa17",
      "original_line" : 25,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "test/functional/p2p_getdata.py",
      "position" : null,
      "pull_request_review_id" : 403109244,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18808",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T23:34:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417671022",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Why did you choose the former / are there legitimate constellations in which peers would send us unknown GETDATA but be worth staying connected to?\r\n\r\nJust conservatism. Better to not let a logic bug turn into a peer disconnect if possible. In the adversarial case, there are messages that a peer can send us that would be much costlier for us to process, so no need to punish for something that we can just drop.",
      "created_at" : "2020-04-29T23:31:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18808#issuecomment-621523231",
      "id" : 621523231,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18808",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMTUyMzIzMQ==",
      "updated_at" : "2020-04-29T23:31:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/621523231",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, though I think disconnecting the peer because the application doesn't know how to handle a request would be slightly preferable in this case.\r\nIt indicates a bug at the side of the peer and explicit error handling is better to track down errors.\r\nI could understand the ignore behavior as a kind of extension mechanism, however, I think in case of a protocol extension it needs to be negotiated in some way first, not simply assumed to be present.",
      "created_at" : "2020-04-30T08:34:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18808#issuecomment-621694651",
      "id" : 621694651,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18808",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMTY5NDY1MQ==",
      "updated_at" : "2020-04-30T08:34:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/621694651",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ACK https://github.com/bitcoin/bitcoin/commit/9847e205bf7edcac4c30ce4b6d62f482aa7bc1b7\r\n\r\nBuilt, run and tested on macOS Catalina 10.15.4.\r\nFunctional test `p2p_getdata` successful. ",
      "created_at" : "2020-04-30T16:16:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18808#issuecomment-621954752",
      "id" : 621954752,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18808",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMTk1NDc1Mg==",
      "updated_at" : "2020-04-30T16:16:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/621954752",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : ">  I think disconnecting the peer because the application doesn't know how to handle a request would be slightly preferable in this case.\r\n> It indicates a bug at the side of the peer and explicit error handling is better to track down errors.\r\n\r\nThere are lots of p2p messages that indicate bugs in the peer which we just silently drop, eg if a peer sends us multiple VERACKs, multiple SENDHEADERs, a GETDATA with no items, etc. I think if the cost to process those messages is low, then dropping and not disconnecting is the safer thing to do.",
      "created_at" : "2020-04-30T16:58:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18808#issuecomment-621978212",
      "id" : 621978212,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18808",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMTk3ODIxMg==",
      "updated_at" : "2020-04-30T16:58:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/621978212",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : ">Why did you choose the former / are there legitimate constellations in which peers would send us unknown GETDATA but be worth staying connected to?\r\n\r\nIt's generally important to avoid splitting the p2p network. Even if peers are implementing different rules allowing invalid stuff (eg, an old node after a softfork), they still need to get the blocks from updated peers...",
      "created_at" : "2020-05-02T22:06:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18808#issuecomment-623021660",
      "id" : 623021660,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18808",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMzAyMTY2MA==",
      "updated_at" : "2020-05-02T22:06:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/623021660",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : ">if a peer sends us multiple VERACKs, multiple SENDHEADERs, a GETDATA with no items, etc. I think if the cost to process those messages is low, then dropping and not disconnecting is the safer thing to do.\r\n\r\nI think those are different in that they are quantitatively different not qualitatively. There may be spurious messages (or lack of messages) but the messages that are sent have a known meaning. In this case the type is unknown and it is completely unknown how to handle it.",
      "created_at" : "2020-05-06T12:23:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18808#issuecomment-624617288",
      "id" : 624617288,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18808",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyNDYxNzI4OA==",
      "updated_at" : "2020-05-06T12:23:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/624617288",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> In this case the type is unknown and it is completely unknown how to handle it.\r\n\r\nYes, and so the most cautious action is to drop it. We already drop unknown message types:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/60091d20f9bb6bb2d57b634567ba63b4f0e458d0/src/net_processing.cpp#L3299-L3301\r\n\r\nI could use the same extensibility argument here. It's possible that in future another P2P client or a future version of Bitcoin Core might use the inv/getdata/notfound messages for different payload types. We shouldn't disconnect them unnecessarily.",
      "created_at" : "2020-05-06T13:50:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18808#issuecomment-624661388",
      "id" : 624661388,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18808",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyNDY2MTM4OA==",
      "updated_at" : "2020-05-06T13:50:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/624661388",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 9847e205bf7edcac4c30ce4b6d62f482aa7bc1b7",
      "created_at" : "2020-05-08T02:22:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18808#issuecomment-625592620",
      "id" : 625592620,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18808",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyNTU5MjYyMA==",
      "updated_at" : "2020-05-08T02:22:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/625592620",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "utACK 9847e20",
      "created_at" : "2020-05-08T14:50:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18808#issuecomment-625853037",
      "id" : 625853037,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18808",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyNTg1MzAzNw==",
      "updated_at" : "2020-05-08T14:50:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/625853037",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18808#discussion_r423137297"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18808"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/423137297"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Seems mildly wasteful to grab the `cs_main` lock just to skip over `MSG_TX` and `MSG_WITNESS_TX`. I think this patch (\"ignore tx GETDATA from blocks only peers\") could be dropped entirely, allowing the \"ignore unknown INV types in GETDATA messages\" patch's handling to cover it instead.",
      "commit_id" : "9847e205bf7edcac4c30ce4b6d62f482aa7bc1b7",
      "created_at" : "2020-05-11T15:47:20Z",
      "diff_hunk" : "@@ -1613,8 +1611,12 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n             if (pfrom->fPauseSend)\n                 break;\n \n-            const CInv &inv = *it;\n-            it++;\n+            const CInv &inv = *it++;\n+\n+            if (pfrom->m_tx_relay == nullptr) {\n+                // Ignore GETDATA requests for transactions from blocks-only peers.\n+                continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18808#discussion_r423137297",
      "id" : 423137297,
      "line" : 1622,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzEzNzI5Nw==",
      "original_commit_id" : "047ceac142246b5d51056a51dbf4645b31802be4",
      "original_line" : 1618,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 39,
      "pull_request_review_id" : 409299347,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18808",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-11T15:56:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/423137297",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18808#discussion_r423238089"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18808"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/423238089"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah, it's _slightly_ wasteful, but I think it's clearer to have tx and non-tx handling fully separated in different parts of the functions, and explicitly have a code path/comment documenting behaviour, rather than having to think \"so what happens if we receive a request for a tx from a blocks-relay-only peer? Oh, it falls through here and then we handle it below as if it were an unknown type\".",
      "commit_id" : "9847e205bf7edcac4c30ce4b6d62f482aa7bc1b7",
      "created_at" : "2020-05-11T18:33:25Z",
      "diff_hunk" : "@@ -1613,8 +1611,12 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n             if (pfrom->fPauseSend)\n                 break;\n \n-            const CInv &inv = *it;\n-            it++;\n+            const CInv &inv = *it++;\n+\n+            if (pfrom->m_tx_relay == nullptr) {\n+                // Ignore GETDATA requests for transactions from blocks-only peers.\n+                continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18808#discussion_r423238089",
      "id" : 423238089,
      "in_reply_to_id" : 423137297,
      "line" : 1622,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzIzODA4OQ==",
      "original_commit_id" : "047ceac142246b5d51056a51dbf4645b31802be4",
      "original_line" : 1618,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 39,
      "pull_request_review_id" : 409426557,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18808",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-11T18:33:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/423238089",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Post merge ACK 9847e205bf7edcac4c30ce4b6d62f482aa7bc1b7",
      "created_at" : "2020-05-23T14:11:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18808#issuecomment-633061479",
      "id" : 633061479,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18808",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMzA2MTQ3OQ==",
      "updated_at" : "2020-05-23T14:11:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/633061479",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
