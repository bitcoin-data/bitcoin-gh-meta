[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r418334282"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/418334282"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: typo\r\n\r\n```suggestion\r\nUtilities for working directly with the wallet's BDB database file\r\n```",
      "commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "created_at" : "2020-04-30T22:55:05Z",
      "diff_hunk" : "@@ -0,0 +1,152 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Utilities for working directly with the wallet's BDB databse file",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r418334282",
      "id" : 418334282,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODMzNDI4Mg==",
      "original_commit_id" : "78d1c21533f83a0f5a74a684f3558d7d8b01573f",
      "original_line" : 6,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/bdb.py",
      "position" : null,
      "pull_request_review_id" : 403931831,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-04T17:21:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/418334282",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ACK 0c961088a608b92851642ef9406f5362a63e9b15\r\n\r\nBuilt, run and tested on macOS Catalina 10.15.4\r\n\r\n```shell\r\n./test/functional/wallet_upgradewallet.py  (3m 25s 785ms)  \r\n2020-04-30T22:45:54.168000Z TestFramework (INFO): Initializing test directory /var/folders/7q/4ffytzk562dd2ky4bfg9_w7h0000gn/T/bitcoin_func_test_aq11myt5\r\n2020-04-30T22:45:57.594000Z TestFramework (INFO): Test upgradewallet RPC...\r\n2020-04-30T22:46:05.290000Z TestFramework (INFO): Intermediary versions don't effect anything\r\n2020-04-30T22:46:05.995000Z TestFramework (INFO): Wallets cannot be downgraded\r\n2020-04-30T22:46:06.480000Z TestFramework (INFO): Can upgrade to HD\r\n2020-04-30T22:46:07.020000Z TestFramework (INFO): Cannot upgrade to HD Split, needs Pre Split Keypool\r\n2020-04-30T22:46:07.027000Z TestFramework (INFO): Upgrade HD to HD chain split\r\n2020-04-30T22:46:07.371000Z TestFramework (INFO): Upgrade non-HD to HD chain split\r\n2020-04-30T22:46:08.167000Z TestFramework (INFO): KeyMetadata should upgrade when loading into master\r\n2020-04-30T22:46:08.422000Z TestFramework (INFO): Upgrading to NO_DEFAULT_KEY should not remove the defaultkey\r\n2020-04-30T22:46:08.813000Z TestFramework (INFO): Stopping nodes\r\n2020-04-30T22:46:09.184000Z TestFramework (INFO): Cleaning up /var/folders/7q/4ffytzk562dd2ky4bfg9_w7h0000gn/T/bitcoin_func_test_aq11myt5 on exit\r\n2020-04-30T22:46:09.184000Z TestFramework (INFO): Tests successful\r\n```",
      "created_at" : "2020-04-30T23:00:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#issuecomment-622163232",
      "id" : 622163232,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18836",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMjE2MzIzMg==",
      "updated_at" : "2020-04-30T23:01:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/622163232",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #20362 (test: Implicitly sync after generate* to preempt races and intermittent test failures by MarcoFalke)\n* #20275 (wallet: List SQLite wallets in non-SQLite builds by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-05-01T01:57:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#issuecomment-622211447",
      "id" : 622211447,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18836",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMjIxMTQ0Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-13T14:54:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/622211447",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-05-01T19:11:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#issuecomment-622522488",
      "id" : 622522488,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18836",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMjUyMjQ4OA==",
      "updated_at" : "2020-05-01T19:11:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/622522488",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r418954989"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/418954989"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit in commit d0982de633783ba285772d159e87672762e0c400\r\n\r\n`-upgradewallet` has been removed\r\n\r\n```suggestion\r\n    if (version == 0) {\r\n```\r\n\r\nOr, if you feel like it you may also just cherry-pick the commits from #18730 ",
      "commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "created_at" : "2020-05-02T12:47:36Z",
      "diff_hunk" : "@@ -4037,33 +4017,32 @@ const CAddressBookData* CWallet::FindAddressBookEntry(const CTxDestination& dest\n bool CWallet::UpgradeWallet(int version, std::string& error, std::vector<std::string>& warnings)\n {\n     int prev_version = GetVersion();\n-    int nMaxVersion = version;\n-    if (nMaxVersion == 0) // the -upgradewallet without argument case\n+    if (version == 0) // the -upgradewallet without argument case",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r418954989",
      "id" : 418954989,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk1NDk4OQ==",
      "original_commit_id" : "c3fdecccb886c804cf63326829ae5b225133dfa3",
      "original_line" : 4021,
      "original_position" : 57,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 404525688,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-04T17:21:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/418954989",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-05-04T15:48:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#issuecomment-623544922",
      "id" : 623544922,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18836",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMzU0NDkyMg==",
      "updated_at" : "2020-05-04T15:48:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/623544922",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r419570191"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/419570191"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've cherry picked those commits.",
      "commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "created_at" : "2020-05-04T16:37:34Z",
      "diff_hunk" : "@@ -4037,33 +4017,32 @@ const CAddressBookData* CWallet::FindAddressBookEntry(const CTxDestination& dest\n bool CWallet::UpgradeWallet(int version, std::string& error, std::vector<std::string>& warnings)\n {\n     int prev_version = GetVersion();\n-    int nMaxVersion = version;\n-    if (nMaxVersion == 0) // the -upgradewallet without argument case\n+    if (version == 0) // the -upgradewallet without argument case",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r419570191",
      "id" : 419570191,
      "in_reply_to_id" : 418954989,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU3MDE5MQ==",
      "original_commit_id" : "c3fdecccb886c804cf63326829ae5b225133dfa3",
      "original_line" : 4021,
      "original_position" : 57,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 405156797,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-04T17:21:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/419570191",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "How does this handle very old wallets that were previously -upgradewallet (to increment max version), but never actually upgraded (due to not using the new features)?",
      "created_at" : "2020-05-04T18:19:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#issuecomment-623624842",
      "id" : 623624842,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18836",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMzYyNDg0Mg==",
      "updated_at" : "2020-05-04T18:19:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/623624842",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> How does this handle very old wallets that were previously -upgradewallet (to increment max version), but never actually upgraded (due to not using the new features)?\r\n\r\n`nWalletMaxVersion` is an in-memory variable. So nothing was written to the wallet. Such users would not see anything different happen to their wallets.",
      "created_at" : "2020-05-04T18:50:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#issuecomment-623640596",
      "id" : 623640596,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18836",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMzY0MDU5Ng==",
      "updated_at" : "2020-05-04T18:50:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/623640596",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-05-27T03:29:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#issuecomment-634406478",
      "id" : 634406478,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18836",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNDQwNjQ3OA==",
      "updated_at" : "2020-05-27T03:29:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/634406478",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Had to rebase this on top of #19054 as the bug it fixes has an effect on the `UpgradeKeyMetaData` test.",
      "created_at" : "2020-06-02T22:09:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#issuecomment-637832181",
      "id" : 637832181,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18836",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNzgzMjE4MQ==",
      "updated_at" : "2020-06-02T22:09:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/637832181",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-06-19T20:53:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#issuecomment-646856653",
      "id" : 646856653,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18836",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0Njg1NjY1Mw==",
      "updated_at" : "2020-06-19T20:53:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646856653",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Assigned milestone because this might be a required bugfix",
      "created_at" : "2020-08-17T17:30:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#issuecomment-675012718",
      "id" : 675012718,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18836",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3NTAxMjcxOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-17T17:30:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/675012718",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r472981883"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472981883"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I believe we can drop old version of `Upgrade` now",
      "commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "created_at" : "2020-08-19T12:13:40Z",
      "diff_hunk" : "@@ -207,6 +207,7 @@ class ScriptPubKeyMan\n \n     /** Upgrades the wallet to the specified version */\n     virtual bool Upgrade(int prev_version, bilingual_str& error) { return false; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r472981883",
      "id" : 472981883,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk4MTg4Mw==",
      "original_commit_id" : "a63d3c95baf098cecfaf3663476d817f1ebc9c5f",
      "original_line" : 209,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : null,
      "pull_request_review_id" : 470395380,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-04T17:21:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472981883",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r473875972"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/473875972"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It's slightly better to move this condition to parent `if` to avoid log entry in case when we don't actually upgrade anything.",
      "commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "created_at" : "2020-08-20T10:48:14Z",
      "diff_hunk" : "@@ -452,10 +452,15 @@ bool LegacyScriptPubKeyMan::Upgrade(int prev_version, bilingual_str& error)\n         hd_upgrade = true;\n     }\n     // Upgrade to HD chain split if necessary\n-    if (m_storage.CanSupportFeature(FEATURE_HD_SPLIT) && CHDChain::VERSION_HD_CHAIN_SPLIT) {\n+    if (IsFeatureSupported(new_version, FEATURE_HD_SPLIT)) {\n         WalletLogPrintf(\"Upgrading wallet to use HD chain split\\n\");\n         m_storage.SetMinVersion(FEATURE_PRE_SPLIT_KEYPOOL);\n         split_upgrade = FEATURE_HD_SPLIT > prev_version;\n+        // Upgrade the HDChain\n+        if (m_hd_chain.nVersion < CHDChain::VERSION_HD_CHAIN_SPLIT) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r473875972",
      "id" : 473875972,
      "line" : 461,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzg3NTk3Mg==",
      "original_commit_id" : "a63d3c95baf098cecfaf3663476d817f1ebc9c5f",
      "original_line" : 461,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 25,
      "pull_request_review_id" : 470395380,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-04T17:21:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/473875972",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r474126327"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/474126327"
         }
      },
      "author_association" : "MEMBER",
      "body" : "We are still upgrading to HD chain split even if the HDChain version is `VERSION_HD_CHAIN_SPLIT`. Theoretically, it is possible to have a HDChain with `VERSION_HD_CHAIN_SPLIT` but still be using non-split HD. But in practice, I don't think that can actually happen.",
      "commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "created_at" : "2020-08-20T16:42:31Z",
      "diff_hunk" : "@@ -452,10 +452,15 @@ bool LegacyScriptPubKeyMan::Upgrade(int prev_version, bilingual_str& error)\n         hd_upgrade = true;\n     }\n     // Upgrade to HD chain split if necessary\n-    if (m_storage.CanSupportFeature(FEATURE_HD_SPLIT) && CHDChain::VERSION_HD_CHAIN_SPLIT) {\n+    if (IsFeatureSupported(new_version, FEATURE_HD_SPLIT)) {\n         WalletLogPrintf(\"Upgrading wallet to use HD chain split\\n\");\n         m_storage.SetMinVersion(FEATURE_PRE_SPLIT_KEYPOOL);\n         split_upgrade = FEATURE_HD_SPLIT > prev_version;\n+        // Upgrade the HDChain\n+        if (m_hd_chain.nVersion < CHDChain::VERSION_HD_CHAIN_SPLIT) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r474126327",
      "id" : 474126327,
      "in_reply_to_id" : 473875972,
      "line" : 461,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDEyNjMyNw==",
      "original_commit_id" : "a63d3c95baf098cecfaf3663476d817f1ebc9c5f",
      "original_line" : 461,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 25,
      "pull_request_review_id" : 471801298,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-04T17:21:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/474126327",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r474141867"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/474141867"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "created_at" : "2020-08-20T17:04:43Z",
      "diff_hunk" : "@@ -207,6 +207,7 @@ class ScriptPubKeyMan\n \n     /** Upgrades the wallet to the specified version */\n     virtual bool Upgrade(int prev_version, bilingual_str& error) { return false; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r474141867",
      "id" : 474141867,
      "in_reply_to_id" : 472981883,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDE0MTg2Nw==",
      "original_commit_id" : "a63d3c95baf098cecfaf3663476d817f1ebc9c5f",
      "original_line" : 209,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : null,
      "pull_request_review_id" : 471817571,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-04T17:21:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/474141867",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased as apparently there was a silent merge conflict with master.",
      "created_at" : "2020-08-20T17:31:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#issuecomment-677800052",
      "id" : 677800052,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18836",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3NzgwMDA1Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-20T17:31:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/677800052",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ACK 7f625c0c9a2ab214b23929cecb1e703be7e17058\r\n\r\nBtw, any reasons why not fix typo pointed out by brakmic?",
      "created_at" : "2020-08-21T08:05:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#issuecomment-678105365",
      "id" : 678105365,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18836",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3ODEwNTM2NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-21T08:05:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/678105365",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Btw, any reasons why not fix typo pointed out by brakmic?\r\n\r\nForgot to do that. I'll do it if I need to push again.",
      "created_at" : "2020-08-21T17:07:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#issuecomment-678395355",
      "id" : 678395355,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18836",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3ODM5NTM1NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-21T17:07:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/678395355",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-09-01T03:04:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#issuecomment-684166654",
      "id" : 684166654,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18836",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NDE2NjY1NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-01T03:04:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/684166654",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r481266048"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/481266048"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed",
      "commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "created_at" : "2020-09-01T16:12:34Z",
      "diff_hunk" : "@@ -0,0 +1,152 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Utilities for working directly with the wallet's BDB databse file",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r481266048",
      "id" : 481266048,
      "in_reply_to_id" : 418334282,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTI2NjA0OA==",
      "original_commit_id" : "78d1c21533f83a0f5a74a684f3558d7d8b01573f",
      "original_line" : 6,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/bdb.py",
      "position" : null,
      "pull_request_review_id" : 479908438,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-04T17:21:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/481266048",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-09-07T00:50:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#issuecomment-687954540",
      "id" : 687954540,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18836",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4Nzk1NDU0MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-07T00:50:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/687954540",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-09-18T00:22:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#issuecomment-694571946",
      "id" : 694571946,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18836",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5NDU3MTk0Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-18T00:22:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/694571946",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ryanofsky any chance you'd be interested in reviewing here?",
      "created_at" : "2020-09-29T12:35:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#issuecomment-700672834",
      "id" : 700672834,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18836",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwMDY3MjgzNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-29T12:35:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/700672834",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Are any of your Twitch streams focused on the writing of this PR @achow101 or any particular guidance on review? \r\n\r\nI'd like to dig into it and provide more than a cursory review but unsure where to start.",
      "created_at" : "2020-09-29T12:52:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#issuecomment-700682034",
      "id" : 700682034,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18836",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwMDY4MjAzNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-29T12:52:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/700682034",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/16323900?v=4",
         "events_url" : "https://api.github.com/users/michaelfolkson/events{/privacy}",
         "followers_url" : "https://api.github.com/users/michaelfolkson/followers",
         "following_url" : "https://api.github.com/users/michaelfolkson/following{/other_user}",
         "gists_url" : "https://api.github.com/users/michaelfolkson/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/michaelfolkson",
         "id" : 16323900,
         "login" : "michaelfolkson",
         "node_id" : "MDQ6VXNlcjE2MzIzOTAw",
         "organizations_url" : "https://api.github.com/users/michaelfolkson/orgs",
         "received_events_url" : "https://api.github.com/users/michaelfolkson/received_events",
         "repos_url" : "https://api.github.com/users/michaelfolkson/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/michaelfolkson/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/michaelfolkson/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/michaelfolkson"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Are any of your Twitch streams focused on the writing of this PR\r\n\r\nUnfortunately no.\r\n\r\n> or any particular guidance on review?\r\n\r\nThe goal is to make explicitly clear as to when an upgrade is occurring for a particular version. There are two main components to this, although both boil down to the same fix.\r\n\r\n1. `CanSupportFeature` doesn't just check whether the current wallet version (the version written to the wallet) is able to support a particular version, it also checks the `nWalletMaxVersion` memory only variable. This makes some components in `UpgradeWallet` not work or behave unintuitively because we assume `CanSupportFeature` only does the obvious thing of checking the actual wallet version.\r\n2. Because of `nWalletMaxVersion`, for some features, the actual wallet version doesn't change until that feature is used. However for other features, `UpgradeWallet` immediately changes the version number and activates the new feature. This behavior is also unintuitive and could result in the user expecting an upgrade to have occurred when one did not.\r\n\r\nThe solution to these issues is to remove `nWalletMaxVersion`. This makes `CanSupportFeature` intuitive and easy to reason about. This removes the delayed upgrade behavior so `UpgradeWallet` behaves as we would expect it to and the behavior of upgrading is unified for all features.",
      "created_at" : "2020-09-29T15:24:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#issuecomment-700781603",
      "id" : 700781603,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18836",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwMDc4MTYwMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-29T15:35:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/700781603",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-10-02T15:51:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#issuecomment-702812062",
      "id" : 702812062,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18836",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwMjgxMjA2Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-02T15:51:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/702812062",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased for silent merge conflict",
      "created_at" : "2020-10-19T04:24:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#issuecomment-711527549",
      "id" : 711527549,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18836",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxMTUyNzU0OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-19T04:24:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/711527549",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Re-ACK c8d14017f12e79c48f4d4f1dd1b420982bf45ffc\r\n\r\nReviewed the diff between 7f625c0c9a2ab214b23929cecb1e703be7e17058.. c8d14017f12e79c48f4d4f1dd1b420982bf45ffc\r\nOnly changes related to new `self.default_wallet_name` in tests, an additional assert added and typo fixed.",
      "created_at" : "2020-10-22T02:56:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#issuecomment-714188792",
      "id" : 714188792,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18836",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxNDE4ODc5Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-22T02:56:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/714188792",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r517334437"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/517334437"
         }
      },
      "author_association" : "MEMBER",
      "body" : "new_version is generally `0` to upgrade all, so this check will fail\r\n\r\nThis is fixed in the next commit, but tests will probably fail on this commit (if we have tests for this).\r\n\r\nMay be possible to fix by adding an `&` between `int nMaxVersion`: `int& nMaxVersion`",
      "commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "created_at" : "2020-11-04T13:16:24Z",
      "diff_hunk" : "@@ -453,7 +453,7 @@ bool LegacyScriptPubKeyMan::Upgrade(int prev_version, bilingual_str& error)\n         hd_upgrade = true;\n     }\n     // Upgrade to HD chain split if necessary\n-    if (m_storage.CanSupportFeature(FEATURE_HD_SPLIT)) {\n+    if (IsFeatureSupported(new_version, FEATURE_HD_SPLIT)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r517334437",
      "id" : 517334437,
      "line" : 456,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzMzNDQzNw==",
      "original_commit_id" : "6d2935b1f3a0e5e479697b419e6b227e66cde540",
      "original_line" : 456,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 20,
      "pull_request_review_id" : 523348314,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-04T17:21:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/517334437",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r517347065"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/517347065"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit in a772fa8c7f8c8130c3400fd2a9288e1280b4dac8: any reason to change the formatting here?",
      "commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "created_at" : "2020-11-04T13:37:03Z",
      "diff_hunk" : "@@ -4120,31 +4100,31 @@ const CAddressBookData* CWallet::FindAddressBookEntry(const CTxDestination& dest\n bool CWallet::UpgradeWallet(int version, bilingual_str& error, std::vector<bilingual_str>& warnings)\n {\n     int prev_version = GetVersion();\n-    int nMaxVersion = version;\n-    if (nMaxVersion == 0) // the -upgradewallet without argument case\n+    if (version == 0) // the -upgradewallet without argument case\n     {\n         WalletLogPrintf(\"Performing wallet upgrade to %i\\n\", FEATURE_LATEST);\n-        nMaxVersion = FEATURE_LATEST;\n-        SetMinVersion(FEATURE_LATEST); // permanently upgrade the wallet immediately\n-    } else {\n-        WalletLogPrintf(\"Allowing wallet upgrade up to %i\\n\", nMaxVersion);\n+        version = FEATURE_LATEST;\n+    }\n+    else {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r517347065",
      "id" : 517347065,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzM0NzA2NQ==",
      "original_commit_id" : "a772fa8c7f8c8130c3400fd2a9288e1280b4dac8",
      "original_line" : 4108,
      "original_position" : 66,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 523348314,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-04T17:21:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/517347065",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r517406238"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/517406238"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: remove (silent merge conflict)",
      "commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "created_at" : "2020-11-04T14:59:29Z",
      "diff_hunk" : "@@ -2,6 +2,7 @@\n // Distributed under the MIT software license, see the accompanying\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n+#include <support/allocators/secure.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r517406238",
      "id" : 517406238,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzQwNjIzOA==",
      "original_commit_id" : "c8d14017f12e79c48f4d4f1dd1b420982bf45ffc",
      "original_line" : 5,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/dummywallet.cpp",
      "position" : null,
      "pull_request_review_id" : 523348314,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-04T17:21:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/517406238",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r517406894"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/517406894"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit 91125ca0d459c112e48db9bbaa10dd1380a3e32c:\r\n\r\nPretty sure you can just write seed_id.hex() (without binascii)",
      "commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "created_at" : "2020-11-04T15:00:17Z",
      "diff_hunk" : "@@ -137,5 +183,165 @@ def run_test(self):\n         # after conversion master key hash should be present\n         assert_is_hex_string(wallet.getwalletinfo()['hdseedid'])\n \n+        self.log.info('Intermediary versions don\\'t effect anything')\n+        copy_non_hd()\n+        # Wallet starts with 60000\n+        assert_equal(60000, wallet.getwalletinfo()['walletversion'])\n+        wallet.unloadwallet()\n+        before_checksum = sha256sum_file(node_master_wallet)\n+        node_master.loadwallet('')\n+        # Can \"upgrade\" to 129999 which should have no effect on the wallet\n+        wallet.upgradewallet(129999)\n+        assert_equal(60000, wallet.getwalletinfo()['walletversion'])\n+        wallet.unloadwallet()\n+        assert_equal(before_checksum, sha256sum_file(node_master_wallet))\n+        node_master.loadwallet('')\n+\n+        self.log.info('Wallets cannot be downgraded')\n+        copy_non_hd()\n+        assert_raises_rpc_error(-4, 'Cannot downgrade wallet', wallet.upgradewallet, 40000)\n+        wallet.unloadwallet()\n+        assert_equal(before_checksum, sha256sum_file(node_master_wallet))\n+        node_master.loadwallet('')\n+\n+        self.log.info('Can upgrade to HD')\n+        # Inspect the old wallet and make sure there is no hdchain\n+        orig_kvs = dump_bdb_kv(node_master_wallet)\n+        assert b'\\x07hdchain' not in orig_kvs\n+        # Upgrade to HD, no split\n+        wallet.upgradewallet(130000)\n+        assert_equal(130000, wallet.getwalletinfo()['walletversion'])\n+        # Check that there is now a hd chain and it is version 1, no internal chain counter\n+        new_kvs = dump_bdb_kv(node_master_wallet)\n+        assert b'\\x07hdchain' in new_kvs\n+        hd_chain = new_kvs[b'\\x07hdchain']\n+        assert_equal(28, len(hd_chain))\n+        hd_chain_version, external_counter, seed_id = struct.unpack('<iI20s', hd_chain)\n+        assert_equal(1, hd_chain_version)\n+        seed_id = bytearray(seed_id)\n+        seed_id.reverse()\n+        old_kvs = new_kvs\n+        # First 2 keys should still be non-HD\n+        for i in range(0, 2):\n+            info = wallet.getaddressinfo(wallet.getnewaddress())\n+            assert 'hdkeypath' not in info\n+            assert 'hdseedid' not in info\n+        # Next key should be HD\n+        info = wallet.getaddressinfo(wallet.getnewaddress())\n+        assert_equal(binascii.hexlify(seed_id).decode(), info['hdseedid'])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r517406894",
      "id" : 517406894,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzQwNjg5NA==",
      "original_commit_id" : "91125ca0d459c112e48db9bbaa10dd1380a3e32c",
      "original_line" : 231,
      "original_position" : 189,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : null,
      "pull_request_review_id" : 523348314,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-04T17:21:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/517406894",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r517507750"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/517507750"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It appears the tests didn't cover this, so there was no test failure here. However I've changed nMaxVersion to a reference as suggested.",
      "commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "created_at" : "2020-11-04T17:22:07Z",
      "diff_hunk" : "@@ -453,7 +453,7 @@ bool LegacyScriptPubKeyMan::Upgrade(int prev_version, bilingual_str& error)\n         hd_upgrade = true;\n     }\n     // Upgrade to HD chain split if necessary\n-    if (m_storage.CanSupportFeature(FEATURE_HD_SPLIT)) {\n+    if (IsFeatureSupported(new_version, FEATURE_HD_SPLIT)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r517507750",
      "id" : 517507750,
      "in_reply_to_id" : 517334437,
      "line" : 456,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzUwNzc1MA==",
      "original_commit_id" : "6d2935b1f3a0e5e479697b419e6b227e66cde540",
      "original_line" : 456,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 20,
      "pull_request_review_id" : 523577212,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-04T17:22:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/517507750",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r517507801"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/517507801"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed",
      "commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "created_at" : "2020-11-04T17:22:12Z",
      "diff_hunk" : "@@ -4120,31 +4100,31 @@ const CAddressBookData* CWallet::FindAddressBookEntry(const CTxDestination& dest\n bool CWallet::UpgradeWallet(int version, bilingual_str& error, std::vector<bilingual_str>& warnings)\n {\n     int prev_version = GetVersion();\n-    int nMaxVersion = version;\n-    if (nMaxVersion == 0) // the -upgradewallet without argument case\n+    if (version == 0) // the -upgradewallet without argument case\n     {\n         WalletLogPrintf(\"Performing wallet upgrade to %i\\n\", FEATURE_LATEST);\n-        nMaxVersion = FEATURE_LATEST;\n-        SetMinVersion(FEATURE_LATEST); // permanently upgrade the wallet immediately\n-    } else {\n-        WalletLogPrintf(\"Allowing wallet upgrade up to %i\\n\", nMaxVersion);\n+        version = FEATURE_LATEST;\n+    }\n+    else {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r517507801",
      "id" : 517507801,
      "in_reply_to_id" : 517347065,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzUwNzgwMQ==",
      "original_commit_id" : "a772fa8c7f8c8130c3400fd2a9288e1280b4dac8",
      "original_line" : 4108,
      "original_position" : 66,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 523577276,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-04T17:22:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/517507801",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r517507870"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/517507870"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Removed",
      "commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "created_at" : "2020-11-04T17:22:18Z",
      "diff_hunk" : "@@ -2,6 +2,7 @@\n // Distributed under the MIT software license, see the accompanying\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n+#include <support/allocators/secure.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r517507870",
      "id" : 517507870,
      "in_reply_to_id" : 517406238,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzUwNzg3MA==",
      "original_commit_id" : "c8d14017f12e79c48f4d4f1dd1b420982bf45ffc",
      "original_line" : 5,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/dummywallet.cpp",
      "position" : null,
      "pull_request_review_id" : 523577356,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-04T17:22:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/517507870",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r517507962"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/517507962"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "created_at" : "2020-11-04T17:22:28Z",
      "diff_hunk" : "@@ -137,5 +183,165 @@ def run_test(self):\n         # after conversion master key hash should be present\n         assert_is_hex_string(wallet.getwalletinfo()['hdseedid'])\n \n+        self.log.info('Intermediary versions don\\'t effect anything')\n+        copy_non_hd()\n+        # Wallet starts with 60000\n+        assert_equal(60000, wallet.getwalletinfo()['walletversion'])\n+        wallet.unloadwallet()\n+        before_checksum = sha256sum_file(node_master_wallet)\n+        node_master.loadwallet('')\n+        # Can \"upgrade\" to 129999 which should have no effect on the wallet\n+        wallet.upgradewallet(129999)\n+        assert_equal(60000, wallet.getwalletinfo()['walletversion'])\n+        wallet.unloadwallet()\n+        assert_equal(before_checksum, sha256sum_file(node_master_wallet))\n+        node_master.loadwallet('')\n+\n+        self.log.info('Wallets cannot be downgraded')\n+        copy_non_hd()\n+        assert_raises_rpc_error(-4, 'Cannot downgrade wallet', wallet.upgradewallet, 40000)\n+        wallet.unloadwallet()\n+        assert_equal(before_checksum, sha256sum_file(node_master_wallet))\n+        node_master.loadwallet('')\n+\n+        self.log.info('Can upgrade to HD')\n+        # Inspect the old wallet and make sure there is no hdchain\n+        orig_kvs = dump_bdb_kv(node_master_wallet)\n+        assert b'\\x07hdchain' not in orig_kvs\n+        # Upgrade to HD, no split\n+        wallet.upgradewallet(130000)\n+        assert_equal(130000, wallet.getwalletinfo()['walletversion'])\n+        # Check that there is now a hd chain and it is version 1, no internal chain counter\n+        new_kvs = dump_bdb_kv(node_master_wallet)\n+        assert b'\\x07hdchain' in new_kvs\n+        hd_chain = new_kvs[b'\\x07hdchain']\n+        assert_equal(28, len(hd_chain))\n+        hd_chain_version, external_counter, seed_id = struct.unpack('<iI20s', hd_chain)\n+        assert_equal(1, hd_chain_version)\n+        seed_id = bytearray(seed_id)\n+        seed_id.reverse()\n+        old_kvs = new_kvs\n+        # First 2 keys should still be non-HD\n+        for i in range(0, 2):\n+            info = wallet.getaddressinfo(wallet.getnewaddress())\n+            assert 'hdkeypath' not in info\n+            assert 'hdseedid' not in info\n+        # Next key should be HD\n+        info = wallet.getaddressinfo(wallet.getnewaddress())\n+        assert_equal(binascii.hexlify(seed_id).decode(), info['hdseedid'])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r517507962",
      "id" : 517507962,
      "in_reply_to_id" : 517406894,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzUwNzk2Mg==",
      "original_commit_id" : "91125ca0d459c112e48db9bbaa10dd1380a3e32c",
      "original_line" : 231,
      "original_position" : 189,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : null,
      "pull_request_review_id" : 523577477,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-04T17:22:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/517507962",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "approach ACK 5f9c0b6360 \r\n",
      "created_at" : "2020-11-04T19:37:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#issuecomment-721933685",
      "id" : 721933685,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18836",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyMTkzMzY4NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-04T19:37:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/721933685",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r519314282"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519314282"
         }
      },
      "author_association" : "MEMBER",
      "body" : "5f72054 here and in the function definition, would be clearer to specify kind of version (wallet or feature) by using the same param naming as `IsFeatureSupported()` (maybe it should be named `feature_version`; not clear to me)\r\n```suggestion\r\nWalletFeature GetClosestWalletFeature(int wallet_version);\r\n```",
      "commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "created_at" : "2020-11-08T09:24:06Z",
      "diff_hunk" : "@@ -29,7 +29,8 @@ enum WalletFeature\n     FEATURE_LATEST = FEATURE_PRE_SPLIT_KEYPOOL\n };\n \n-\n+bool IsFeatureSupported(int wallet_version, int feature_version);\n+WalletFeature GetClosestWalletFeature(int version);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r519314282",
      "id" : 519314282,
      "line" : 33,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTMxNDI4Mg==",
      "original_commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "original_line" : 33,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/walletutil.h",
      "position" : 6,
      "pull_request_review_id" : 525789555,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-08T11:09:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519314282",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r519328607"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519328607"
         }
      },
      "author_association" : "MEMBER",
      "body" : "5f72054 could do this (tested); shorter, easier to update, less error-prone as no double entry of each constant name\r\n```diff\r\nWalletFeature GetClosestWalletFeature(int version)\r\n {\r\n-    if (version >= FEATURE_LATEST) return FEATURE_LATEST;\r\n-    if (version >= FEATURE_PRE_SPLIT_KEYPOOL) return FEATURE_PRE_SPLIT_KEYPOOL;\r\n-    if (version >= FEATURE_NO_DEFAULT_KEY) return FEATURE_NO_DEFAULT_KEY;\r\n-    if (version >= FEATURE_HD_SPLIT) return FEATURE_HD_SPLIT;\r\n-    if (version >= FEATURE_HD) return FEATURE_HD;\r\n-    if (version >= FEATURE_COMPRPUBKEY) return FEATURE_COMPRPUBKEY;\r\n-    if (version >= FEATURE_WALLETCRYPT) return FEATURE_WALLETCRYPT;\r\n-    if (version >= FEATURE_BASE) return FEATURE_BASE;\r\n+    const std::array<WalletFeature, 8> wallet_features{{FEATURE_LATEST, FEATURE_PRE_SPLIT_KEYPOOL, FEATURE_NO_DEFAULT_KEY, FEATURE_HD_SPLIT, FEATURE_HD, FEATURE_COMPRPUBKEY, FEATURE_WALLETCRYPT, FEATURE_BASE}};\r\n+    for (const WalletFeature& wf : wallet_features) {\r\n+        if (version >= wf) return wf;\r\n+    }\r\n     return static_cast<WalletFeature>(0);\r\n }\r\n```\r\n",
      "commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "created_at" : "2020-11-08T09:59:06Z",
      "diff_hunk" : "@@ -70,3 +70,21 @@ std::vector<fs::path> ListWalletDir()\n \n     return paths;\n }\n+\n+bool IsFeatureSupported(int wallet_version, int feature_version)\n+{\n+    return wallet_version >= feature_version;\n+}\n+\n+WalletFeature GetClosestWalletFeature(int version)\n+{\n+    if (version >= FEATURE_LATEST) return FEATURE_LATEST;\n+    if (version >= FEATURE_PRE_SPLIT_KEYPOOL) return FEATURE_PRE_SPLIT_KEYPOOL;\n+    if (version >= FEATURE_NO_DEFAULT_KEY) return FEATURE_NO_DEFAULT_KEY;\n+    if (version >= FEATURE_HD_SPLIT) return FEATURE_HD_SPLIT;\n+    if (version >= FEATURE_HD) return FEATURE_HD;\n+    if (version >= FEATURE_COMPRPUBKEY) return FEATURE_COMPRPUBKEY;\n+    if (version >= FEATURE_WALLETCRYPT) return FEATURE_WALLETCRYPT;\n+    if (version >= FEATURE_BASE) return FEATURE_BASE;\n+    return static_cast<WalletFeature>(0);\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r519328607",
      "id" : 519328607,
      "line" : 90,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTMyODYwNw==",
      "original_commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "original_line" : 90,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/wallet/walletutil.cpp",
      "position" : 21,
      "pull_request_review_id" : 525789555,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-08T11:10:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519328607",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r519336055"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519336055"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should this downgrade check and error message be done first, e.g. at the top of `UpgradeWallet()`, and the two values printed in the error message for user friendliness",
      "commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "created_at" : "2020-11-08T10:19:13Z",
      "diff_hunk" : "@@ -4120,33 +4100,31 @@ const CAddressBookData* CWallet::FindAddressBookEntry(const CTxDestination& dest\n bool CWallet::UpgradeWallet(int version, bilingual_str& error, std::vector<bilingual_str>& warnings)\n {\n     int prev_version = GetVersion();\n-    int nMaxVersion = version;\n-    if (nMaxVersion == 0) // the -upgradewallet without argument case\n-    {\n+    if (version == 0) {\n         WalletLogPrintf(\"Performing wallet upgrade to %i\\n\", FEATURE_LATEST);\n-        nMaxVersion = FEATURE_LATEST;\n-        SetMinVersion(FEATURE_LATEST); // permanently upgrade the wallet immediately\n+        version = FEATURE_LATEST;\n     } else {\n-        WalletLogPrintf(\"Allowing wallet upgrade up to %i\\n\", nMaxVersion);\n+        WalletLogPrintf(\"Allowing wallet upgrade up to %i\\n\", version);\n     }\n-    if (nMaxVersion < GetVersion())\n+    if (version < prev_version)\n     {\n         error = _(\"Cannot downgrade wallet\");\n         return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r519336055",
      "id" : 519336055,
      "line" : 4112,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTMzNjA1NQ==",
      "original_commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "original_line" : 4112,
      "original_position" : 71,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 71,
      "pull_request_review_id" : 525789555,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-08T11:05:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519336055",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r519339269"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519339269"
         }
      },
      "author_association" : "MEMBER",
      "body" : "092fc43 A similar function exists in `test/functional/tool_wallet.py.wallet_shasum`, perhaps combine the two. Nit: add a newline before and after this function.",
      "commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "created_at" : "2020-11-08T10:28:23Z",
      "diff_hunk" : "@@ -260,6 +261,14 @@ def wait_until_helper(predicate, *, attempts=float('inf'), timeout=float('inf'),\n         raise AssertionError(\"Predicate {} not true after {} seconds\".format(predicate_source, timeout))\n     raise RuntimeError('Unreachable')\n \n+def sha256sum_file(filename):\n+    h = hashlib.sha256()\n+    with open(filename, 'rb') as f:\n+        d = f.read(4096)\n+        while len(d) > 0:\n+            h.update(d)\n+            d = f.read(4096)\n+    return h.digest()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r519339269",
      "id" : 519339269,
      "line" : 271,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTMzOTI2OQ==",
      "original_commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "original_line" : 271,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/util.py",
      "position" : 19,
      "pull_request_review_id" : 525789555,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-08T11:05:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519339269",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r519340299"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519340299"
         }
      },
      "author_association" : "MEMBER",
      "body" : "bf76359 maybe make this comment a docstring, idem for the two preceding new functions",
      "commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "created_at" : "2020-11-08T10:31:06Z",
      "diff_hunk" : "@@ -87,22 +111,53 @@ def run_test(self):\n \n         self.log.info(\"Test upgradewallet RPC...\")\n         # Prepare for copying of the older wallet\n-        node_master_wallet_dir = os.path.join(node_master.datadir, \"regtest/wallets\")\n+        node_master_wallet_dir = os.path.join(node_master.datadir, \"regtest/wallets\", self.default_wallet_name)\n+        node_master_wallet = os.path.join(node_master_wallet_dir, self.default_wallet_name, self.wallet_data_filename)\n         v16_3_wallet       = os.path.join(v16_3_node.datadir, \"regtest/wallets/wallet.dat\")\n         v15_2_wallet       = os.path.join(v15_2_node.datadir, \"regtest/wallet.dat\")\n+        split_hd_wallet    = os.path.join(v15_2_node.datadir, \"regtest/splithd\")\n         self.stop_nodes()\n \n-        # Copy the 0.16.3 wallet to the last Bitcoin Core version and open it:\n-        shutil.rmtree(node_master_wallet_dir)\n-        os.mkdir(node_master_wallet_dir)\n-        shutil.copy(\n-            v16_3_wallet,\n-            node_master_wallet_dir\n-        )\n-        self.restart_node(0, ['-nowallet'])\n-        node_master.loadwallet('')\n+        # Make split hd wallet\n+        self.start_node(2, ['-usehd=1', '-keypool=2', '-wallet=splithd'])\n+        self.stop_node(2)\n+\n+        def copy_v16():\n+            node_master.get_wallet_rpc(self.default_wallet_name).unloadwallet()\n+            # Copy the 0.16.3 wallet to the last Bitcoin Core version and open it:\n+            shutil.rmtree(node_master_wallet_dir)\n+            os.mkdir(node_master_wallet_dir)\n+            shutil.copy(\n+                v16_3_wallet,\n+                node_master_wallet_dir\n+            )\n+            node_master.loadwallet(self.default_wallet_name)\n+\n+        def copy_non_hd():\n+            node_master.get_wallet_rpc(self.default_wallet_name).unloadwallet()\n+            # Copy the 0.15.2 non hd wallet to the last Bitcoin Core version and open it:\n+            shutil.rmtree(node_master_wallet_dir)\n+            os.mkdir(node_master_wallet_dir)\n+            shutil.copy(\n+                v15_2_wallet,\n+                node_master_wallet_dir\n+            )\n+            node_master.loadwallet(self.default_wallet_name)\n \n-        wallet = node_master.get_wallet_rpc('')\n+        def copy_split_hd():\n+            node_master.get_wallet_rpc(self.default_wallet_name).unloadwallet()\n+            # Copy the 0.15.2 split hd wallet to the last Bitcoin Core version and open it:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r519340299",
      "id" : 519340299,
      "line" : 149,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTM0MDI5OQ==",
      "original_commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "original_line" : 149,
      "original_position" : 101,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : 101,
      "pull_request_review_id" : 525789555,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-08T11:05:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519340299",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r519340510"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519340510"
         }
      },
      "author_association" : "MEMBER",
      "body" : "bf76359 \r\n```suggestion\r\n        self.log.info(\"Intermediary versions don't effect anything\")\r\n```",
      "commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "created_at" : "2020-11-08T10:31:46Z",
      "diff_hunk" : "@@ -137,5 +182,165 @@ def run_test(self):\n         # after conversion master key hash should be present\n         assert_is_hex_string(wallet.getwalletinfo()['hdseedid'])\n \n+        self.log.info('Intermediary versions don\\'t effect anything')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r519340510",
      "id" : 519340510,
      "line" : 185,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTM0MDUxMA==",
      "original_commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "original_line" : 185,
      "original_position" : 141,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : 141,
      "pull_request_review_id" : 525789555,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-08T11:05:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519340510",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r519342488"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519342488"
         }
      },
      "author_association" : "MEMBER",
      "body" : "5f9c0b6 Can you make this change in the \"wallet: remove nWalletMaxVersion\" commit instead",
      "commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "created_at" : "2020-11-08T10:37:05Z",
      "diff_hunk" : "@@ -4120,33 +4100,31 @@ const CAddressBookData* CWallet::FindAddressBookEntry(const CTxDestination& dest\n bool CWallet::UpgradeWallet(int version, bilingual_str& error, std::vector<bilingual_str>& warnings)\n {\n     int prev_version = GetVersion();\n-    int nMaxVersion = version;\n-    if (nMaxVersion == 0) // the -upgradewallet without argument case\n-    {\n+    if (version == 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r519342488",
      "id" : 519342488,
      "line" : 4103,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTM0MjQ4OA==",
      "original_commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "original_line" : 4103,
      "original_position" : 58,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 58,
      "pull_request_review_id" : 525789555,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-08T11:05:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519342488",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r519457180"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519457180"
         }
      },
      "author_association" : "MEMBER",
      "body" : "There's only one version number, the wallet version number. The `feature_version` above is for the version number constants.",
      "commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "created_at" : "2020-11-08T17:56:42Z",
      "diff_hunk" : "@@ -29,7 +29,8 @@ enum WalletFeature\n     FEATURE_LATEST = FEATURE_PRE_SPLIT_KEYPOOL\n };\n \n-\n+bool IsFeatureSupported(int wallet_version, int feature_version);\n+WalletFeature GetClosestWalletFeature(int version);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r519457180",
      "id" : 519457180,
      "in_reply_to_id" : 519314282,
      "line" : 33,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ1NzE4MA==",
      "original_commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "original_line" : 33,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/walletutil.h",
      "position" : 6,
      "pull_request_review_id" : 525830973,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-08T17:56:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519457180",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r519457689"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519457689"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No, `version` needs to be determined first. Otherwise it could be `0` here and that would not be correct.",
      "commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "created_at" : "2020-11-08T18:01:49Z",
      "diff_hunk" : "@@ -4120,33 +4100,31 @@ const CAddressBookData* CWallet::FindAddressBookEntry(const CTxDestination& dest\n bool CWallet::UpgradeWallet(int version, bilingual_str& error, std::vector<bilingual_str>& warnings)\n {\n     int prev_version = GetVersion();\n-    int nMaxVersion = version;\n-    if (nMaxVersion == 0) // the -upgradewallet without argument case\n-    {\n+    if (version == 0) {\n         WalletLogPrintf(\"Performing wallet upgrade to %i\\n\", FEATURE_LATEST);\n-        nMaxVersion = FEATURE_LATEST;\n-        SetMinVersion(FEATURE_LATEST); // permanently upgrade the wallet immediately\n+        version = FEATURE_LATEST;\n     } else {\n-        WalletLogPrintf(\"Allowing wallet upgrade up to %i\\n\", nMaxVersion);\n+        WalletLogPrintf(\"Allowing wallet upgrade up to %i\\n\", version);\n     }\n-    if (nMaxVersion < GetVersion())\n+    if (version < prev_version)\n     {\n         error = _(\"Cannot downgrade wallet\");\n         return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r519457689",
      "id" : 519457689,
      "in_reply_to_id" : 519336055,
      "line" : 4112,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ1NzY4OQ==",
      "original_commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "original_line" : 4112,
      "original_position" : 71,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 71,
      "pull_request_review_id" : 525831323,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-08T18:01:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519457689",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r519458003"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519458003"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can be done in a followup. The `WalletFeature` enum needs to be cleaned up a bit too.",
      "commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "created_at" : "2020-11-08T18:05:06Z",
      "diff_hunk" : "@@ -70,3 +70,21 @@ std::vector<fs::path> ListWalletDir()\n \n     return paths;\n }\n+\n+bool IsFeatureSupported(int wallet_version, int feature_version)\n+{\n+    return wallet_version >= feature_version;\n+}\n+\n+WalletFeature GetClosestWalletFeature(int version)\n+{\n+    if (version >= FEATURE_LATEST) return FEATURE_LATEST;\n+    if (version >= FEATURE_PRE_SPLIT_KEYPOOL) return FEATURE_PRE_SPLIT_KEYPOOL;\n+    if (version >= FEATURE_NO_DEFAULT_KEY) return FEATURE_NO_DEFAULT_KEY;\n+    if (version >= FEATURE_HD_SPLIT) return FEATURE_HD_SPLIT;\n+    if (version >= FEATURE_HD) return FEATURE_HD;\n+    if (version >= FEATURE_COMPRPUBKEY) return FEATURE_COMPRPUBKEY;\n+    if (version >= FEATURE_WALLETCRYPT) return FEATURE_WALLETCRYPT;\n+    if (version >= FEATURE_BASE) return FEATURE_BASE;\n+    return static_cast<WalletFeature>(0);\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r519458003",
      "id" : 519458003,
      "in_reply_to_id" : 519328607,
      "line" : 90,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ1ODAwMw==",
      "original_commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "original_line" : 90,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/wallet/walletutil.cpp",
      "position" : 21,
      "pull_request_review_id" : 525831573,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-08T18:05:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519458003",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r519458020"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519458020"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can be done in a followup.",
      "commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "created_at" : "2020-11-08T18:05:16Z",
      "diff_hunk" : "@@ -260,6 +261,14 @@ def wait_until_helper(predicate, *, attempts=float('inf'), timeout=float('inf'),\n         raise AssertionError(\"Predicate {} not true after {} seconds\".format(predicate_source, timeout))\n     raise RuntimeError('Unreachable')\n \n+def sha256sum_file(filename):\n+    h = hashlib.sha256()\n+    with open(filename, 'rb') as f:\n+        d = f.read(4096)\n+        while len(d) > 0:\n+            h.update(d)\n+            d = f.read(4096)\n+    return h.digest()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r519458020",
      "id" : 519458020,
      "in_reply_to_id" : 519339269,
      "line" : 271,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ1ODAyMA==",
      "original_commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "original_line" : 271,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/util.py",
      "position" : 19,
      "pull_request_review_id" : 525831583,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-08T18:05:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519458020",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r519458156"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519458156"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This was moved so I will leave it as is for now.",
      "commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "created_at" : "2020-11-08T18:06:45Z",
      "diff_hunk" : "@@ -87,22 +111,53 @@ def run_test(self):\n \n         self.log.info(\"Test upgradewallet RPC...\")\n         # Prepare for copying of the older wallet\n-        node_master_wallet_dir = os.path.join(node_master.datadir, \"regtest/wallets\")\n+        node_master_wallet_dir = os.path.join(node_master.datadir, \"regtest/wallets\", self.default_wallet_name)\n+        node_master_wallet = os.path.join(node_master_wallet_dir, self.default_wallet_name, self.wallet_data_filename)\n         v16_3_wallet       = os.path.join(v16_3_node.datadir, \"regtest/wallets/wallet.dat\")\n         v15_2_wallet       = os.path.join(v15_2_node.datadir, \"regtest/wallet.dat\")\n+        split_hd_wallet    = os.path.join(v15_2_node.datadir, \"regtest/splithd\")\n         self.stop_nodes()\n \n-        # Copy the 0.16.3 wallet to the last Bitcoin Core version and open it:\n-        shutil.rmtree(node_master_wallet_dir)\n-        os.mkdir(node_master_wallet_dir)\n-        shutil.copy(\n-            v16_3_wallet,\n-            node_master_wallet_dir\n-        )\n-        self.restart_node(0, ['-nowallet'])\n-        node_master.loadwallet('')\n+        # Make split hd wallet\n+        self.start_node(2, ['-usehd=1', '-keypool=2', '-wallet=splithd'])\n+        self.stop_node(2)\n+\n+        def copy_v16():\n+            node_master.get_wallet_rpc(self.default_wallet_name).unloadwallet()\n+            # Copy the 0.16.3 wallet to the last Bitcoin Core version and open it:\n+            shutil.rmtree(node_master_wallet_dir)\n+            os.mkdir(node_master_wallet_dir)\n+            shutil.copy(\n+                v16_3_wallet,\n+                node_master_wallet_dir\n+            )\n+            node_master.loadwallet(self.default_wallet_name)\n+\n+        def copy_non_hd():\n+            node_master.get_wallet_rpc(self.default_wallet_name).unloadwallet()\n+            # Copy the 0.15.2 non hd wallet to the last Bitcoin Core version and open it:\n+            shutil.rmtree(node_master_wallet_dir)\n+            os.mkdir(node_master_wallet_dir)\n+            shutil.copy(\n+                v15_2_wallet,\n+                node_master_wallet_dir\n+            )\n+            node_master.loadwallet(self.default_wallet_name)\n \n-        wallet = node_master.get_wallet_rpc('')\n+        def copy_split_hd():\n+            node_master.get_wallet_rpc(self.default_wallet_name).unloadwallet()\n+            # Copy the 0.15.2 split hd wallet to the last Bitcoin Core version and open it:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r519458156",
      "id" : 519458156,
      "in_reply_to_id" : 519340299,
      "line" : 149,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ1ODE1Ng==",
      "original_commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "original_line" : 149,
      "original_position" : 101,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : 101,
      "pull_request_review_id" : 525831670,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-08T18:06:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519458156",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r519458184"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519458184"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Meh. Will leave this alone to avoid invalidating ACKs.",
      "commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "created_at" : "2020-11-08T18:07:09Z",
      "diff_hunk" : "@@ -137,5 +182,165 @@ def run_test(self):\n         # after conversion master key hash should be present\n         assert_is_hex_string(wallet.getwalletinfo()['hdseedid'])\n \n+        self.log.info('Intermediary versions don\\'t effect anything')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r519458184",
      "id" : 519458184,
      "in_reply_to_id" : 519340510,
      "line" : 185,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ1ODE4NA==",
      "original_commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "original_line" : 185,
      "original_position" : 141,
      "original_start_line" : null,
      "path" : "test/functional/wallet_upgradewallet.py",
      "position" : 141,
      "pull_request_review_id" : 525831693,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-08T18:07:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519458184",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r519458357"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519458357"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That commit still uses the `nMaxVersion` so I don't think this change would be appropriate there.",
      "commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "created_at" : "2020-11-08T18:09:02Z",
      "diff_hunk" : "@@ -4120,33 +4100,31 @@ const CAddressBookData* CWallet::FindAddressBookEntry(const CTxDestination& dest\n bool CWallet::UpgradeWallet(int version, bilingual_str& error, std::vector<bilingual_str>& warnings)\n {\n     int prev_version = GetVersion();\n-    int nMaxVersion = version;\n-    if (nMaxVersion == 0) // the -upgradewallet without argument case\n-    {\n+    if (version == 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r519458357",
      "id" : 519458357,
      "in_reply_to_id" : 519342488,
      "line" : 4103,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ1ODM1Nw==",
      "original_commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "original_line" : 4103,
      "original_position" : 58,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 58,
      "pull_request_review_id" : 525831832,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-08T18:09:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519458357",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r519459391"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519459391"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think it may be clearer as `wallet_version` if you retouch now or later.",
      "commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "created_at" : "2020-11-08T18:18:56Z",
      "diff_hunk" : "@@ -29,7 +29,8 @@ enum WalletFeature\n     FEATURE_LATEST = FEATURE_PRE_SPLIT_KEYPOOL\n };\n \n-\n+bool IsFeatureSupported(int wallet_version, int feature_version);\n+WalletFeature GetClosestWalletFeature(int version);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r519459391",
      "id" : 519459391,
      "in_reply_to_id" : 519314282,
      "line" : 33,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ1OTM5MQ==",
      "original_commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "original_line" : 33,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/walletutil.h",
      "position" : 6,
      "pull_request_review_id" : 525832530,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-12T17:35:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519459391",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r522291059"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/522291059"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Re-looking, I agree it could be in either commit, nvm.",
      "commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "created_at" : "2020-11-12T17:37:02Z",
      "diff_hunk" : "@@ -4120,33 +4100,31 @@ const CAddressBookData* CWallet::FindAddressBookEntry(const CTxDestination& dest\n bool CWallet::UpgradeWallet(int version, bilingual_str& error, std::vector<bilingual_str>& warnings)\n {\n     int prev_version = GetVersion();\n-    int nMaxVersion = version;\n-    if (nMaxVersion == 0) // the -upgradewallet without argument case\n-    {\n+    if (version == 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r522291059",
      "id" : 522291059,
      "in_reply_to_id" : 519342488,
      "line" : 4103,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjI5MTA1OQ==",
      "original_commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "original_line" : 4103,
      "original_position" : 58,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 58,
      "pull_request_review_id" : 529330396,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-12T17:37:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/522291059",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r522342731"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/522342731"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think it's awesome workâ¦ but I'm a bit surprised and ambivalent about maintaining our own bdb parsing. At least it's test only :slightly_smiling_face: ",
      "commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "created_at" : "2020-11-12T18:59:07Z",
      "diff_hunk" : "@@ -0,0 +1,152 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Utilities for working directly with the wallet's BDB database file\n+\n+This is specific to the configuration of BDB used in this project:\n+    - pagesize: 4096 bytes\n+    - Outer database contains single subdatabase named 'main'\n+    - btree\n+    - btree leaf pages\n+\n+Each key-value pair is two entries in a btree leaf. The first is the key, the one that follows\n+is the value. And so on. Note that the entry data is itself not in the correct order. Instead\n+entry offsets are stored in the correct order and those offsets are needed to then retrieve\n+the data itself.\n+\n+Page format can be found in BDB source code dbinc/db_page.h\n+This only implements the deserialization of btree metadata pages and normal btree pages. Overflow\n+pages are not implemented but may be needed in the future if dealing with wallets with large\n+transactions.\n+\n+`db_dump -da wallet.dat` is useful to see the data in a wallet.dat BDB file",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r522342731",
      "id" : 522342731,
      "line" : 24,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjM0MjczMQ==",
      "original_commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "original_line" : 24,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/bdb.py",
      "position" : 24,
      "pull_request_review_id" : 529396637,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-12T18:59:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/522342731",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK 5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "created_at" : "2020-11-16T10:02:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#issuecomment-727873820",
      "id" : 727873820,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18836",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyNzg3MzgyMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-16T10:02:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/727873820",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Is there any summary of the user visible parts of this change? The 8e32e1c41c995e832e643f605d35a7aa112837e6 commit seems like a user-visible change, but it's unclear how it manifests. It's also not clear if there are behavior changes in other commits like 0bd995aa19be65b0dd23df1df571c71428c2bc32 or if these are just refactorings.\r\n\r\nIf there are behavior changes, the best thing would be a followup PR adding some release notes. It seems like `upgradewallet` will now **immediately** make a wallet incompatible with previous versions instead of only allowing new features which **might** make it incompatible in the future. But it would be helpful to know any if there are specific features or versions that are relevant, or if there are other user-visible changes, or if maybe I'm incorrect and the `upgradewallet` RPC always made wallets incompatible before this PR.\r\n",
      "created_at" : "2020-11-16T12:16:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#issuecomment-727942460",
      "id" : 727942460,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18836",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyNzk0MjQ2MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-16T12:16:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/727942460",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> If there are behavior changes, the best thing would be a followup PR adding some release notes\r\n\r\nPlease edit release notes in the wiki: https://github.com/bitcoin-core/bitcoin-devwiki/wiki/0.21.0-Release-Notes-Draft\r\n\r\n> It seems like upgradewallet will now immediately make a wallet incompatible with previous versions instead of only allowing new features which might make it incompatible in the future.\r\n\r\nI had expected this to already be the behavior of upgradewallet, to be honest. It's pretty standard predictable upgrading behavior. I don't think \"it becomes incompatible at some unspecifid time in the future\" is in any way more useful. But sure, I guess if that changed it needs to be documented.",
      "created_at" : "2020-11-16T13:21:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#issuecomment-728002296",
      "id" : 728002296,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18836",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyODAwMjI5Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-16T13:24:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/728002296",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Not sure if relevant to the discussion, but `upgradewallet` is a new rpc in this release",
      "created_at" : "2020-11-16T13:30:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#issuecomment-728015998",
      "id" : 728015998,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18836",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyODAxNTk5OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-16T13:30:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/728015998",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r524479438"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/524479438"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done in #20403",
      "commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "created_at" : "2020-11-16T18:21:48Z",
      "diff_hunk" : "@@ -70,3 +70,21 @@ std::vector<fs::path> ListWalletDir()\n \n     return paths;\n }\n+\n+bool IsFeatureSupported(int wallet_version, int feature_version)\n+{\n+    return wallet_version >= feature_version;\n+}\n+\n+WalletFeature GetClosestWalletFeature(int version)\n+{\n+    if (version >= FEATURE_LATEST) return FEATURE_LATEST;\n+    if (version >= FEATURE_PRE_SPLIT_KEYPOOL) return FEATURE_PRE_SPLIT_KEYPOOL;\n+    if (version >= FEATURE_NO_DEFAULT_KEY) return FEATURE_NO_DEFAULT_KEY;\n+    if (version >= FEATURE_HD_SPLIT) return FEATURE_HD_SPLIT;\n+    if (version >= FEATURE_HD) return FEATURE_HD;\n+    if (version >= FEATURE_COMPRPUBKEY) return FEATURE_COMPRPUBKEY;\n+    if (version >= FEATURE_WALLETCRYPT) return FEATURE_WALLETCRYPT;\n+    if (version >= FEATURE_BASE) return FEATURE_BASE;\n+    return static_cast<WalletFeature>(0);\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18836#discussion_r524479438",
      "id" : 524479438,
      "in_reply_to_id" : 519328607,
      "line" : 90,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDQ3OTQzOA==",
      "original_commit_id" : "5f9c0b6360215636cfa62a70d3a70f1feb3977ab",
      "original_line" : 90,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/wallet/walletutil.cpp",
      "position" : 21,
      "pull_request_review_id" : 531588161,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18836",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-16T18:21:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/524479438",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   }
]
