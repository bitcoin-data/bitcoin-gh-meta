[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #10102 ([experimental] Multiprocess bitcoin by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-04-11T04:04:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18588#issuecomment-612319147",
      "id" : 612319147,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18588",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxMjMxOTE0Nw==",
      "updated_at" : "2020-04-11T04:04:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/612319147",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@fanquake Thanks for the writeup and questions. I think we should go ahead and merge this and then reopen #16367, so that the questions can be discussed in the pull request that introduces the code changes, not the one that reverts them.",
      "created_at" : "2020-04-11T13:28:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18588#issuecomment-612421342",
      "id" : 612421342,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18588",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxMjQyMTM0Mg==",
      "updated_at" : "2020-04-11T13:28:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/612421342",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for writing that out @fanquake.\r\n\r\nACK on the revert for now with the understanding that this was simply merged too early, and with a few too many unanswered questions.",
      "created_at" : "2020-04-11T14:08:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18588#issuecomment-612429512",
      "id" : 612429512,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18588",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxMjQyOTUxMg==",
      "updated_at" : "2020-04-11T14:08:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/612429512",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for writing up these questions.\r\n\r\n> 1. What's the expectation for when this should/would be turned on by default? If this remained merged now, would it be on by 0.22? Or is the thinking an even later release?\r\n\r\nI'm not going to push for this to be on by default. I want this to be an optional feature you can ignore if you're happy with current bitcoin usage, or use if you want to try new things like starting and stopping gui/node/wallet processes separately or running from different containers or devices.\r\n\r\n> 2. How will Cores build/compatibility requirements change when we adopt this?\r\n\r\nRequirements should not change because this is an optional feature.\r\n\r\nIf you download a source distribution and want to build ii with `--enable-multiprocess`,  you will [currently](https://github.com/chaincodelabs/libmultiprocess/pull/25) need a compiler that supports c++17. But this is a recent change that I thought was harmless and could be reversed if it's a problem. #16367 added a travis variant to make sure building in this configuration works and functional tests pass using the multiprocess binaries.\r\n\r\nIf we add decide to add new multiprocess binaries `bitcoin-gui` `bitcoin-node` and `bitcoin-wallet` to our binary distributions after #10102, these will work well on mac and linux, but I will need to replace fork/exec/pipe usages in libmultiprocess to make them useful or interesting to run on windows.\r\n\r\n> * [libmultiprocess](https://github.com/chaincodelabs/libmultiprocess/) currently requires C++17 (although Russ has mentioned that it'd be possible to drop back to a C++11 if necessary).\r\n\r\nYes, that's all correct\r\n\r\n> * If the install method is clone and build, users would need autotools and cmake to build Core.\r\n\r\n\"users would need autotools and cmake to build Core\" is only true if you are talking about building the new, optional, disabled-by-default multiprocess `bitcoin-gui` `bitcoin-node` and `bitcoin-wallet` binaries.\r\n\r\n> * I assume capnproto can be installed and \"just works\" for our purposes everywhere we'd expect anyone to be building Core?\r\n\r\nI'm not assuming this. I'm assuming linux/mac/windows support is good but would not be surprised by build or other issues on Android, CloudABI, other less common IDEs or platforms people build bitcoin for. That's why capnp isn't a dependency unless you enable an optional feature.\r\n\r\n> * It was [pointed out](https://github.com/bitcoin/bitcoin/pull/16367#issuecomment-595349319) that building capnproto from source currently requires a newer compiler than what we do for building Core.\r\n\r\nOnly the latest capnp releases require c++14. The previous releases which I haven't used recently but should still work require c++11.\r\n\r\n> * It looks like there are already some [back-compat patches](https://github.com/chaincodelabs/libmultiprocess/blob/master/cmake/capnp_compat.cmake) being applied for the version of capnproto that ships with Ubuntu Bionic (18.04). Does libmultiprocess work with the older version of capnproto that ships with [Ubuntu Xenial](https://packages.ubuntu.com/xenial/capnproto)? Is the expectation that some/all users might have to build capnproto from source?\r\n\r\nI don't know if it currently works with the xenial capnp package, but I started with 0.5.3 originally, and if it doesn't still work, any bugs should be fixable\r\n\r\n> 1. What does integration actually look like:\r\n> \r\n> * Will libmultiprocess end up being a submodule?\r\n> * How will it be versioned / tied to releases of Core?\r\n\r\nWeak preference for not doing whatever we are doing with univalue and leveldb, because I get confused by the 30 different places you can submit univalue pull requests, and because I want to reduce barriers preventing good review. The context hash pinning in #16367 is nice because it's more straightforward to review a diff of two content hashes than it is to review diffs of diffs like seems to be required to review other dependency update PRs.\r\n\r\nI would like to move the [libmultiprocess](https://github.com/chaincodelabs/libmultiprocess/) repo from the [chaincode org](https://github.com/chaincodelabs/) to [bitcoin-core](https://github.com/bitcoin-core/) and to start signing tags for versioning.\r\n\r\n> Apart from that, I might be incorrect here, but it seems we've gotten some changes, such as adding a native_boost package, that I'd assume are now unnecessary given that libmultiprocess has dropped it's Boost usage? That was at least [mentioned in 16367](https://github.com/bitcoin/bitcoin/pull/16367#issuecomment-592135865), although looking at [later comments](https://github.com/bitcoin/bitcoin/pull/16367#issuecomment-596585996) this is unclear, and it seems the Boost dependency might be coming back anyways?\r\n\r\nI thought this was covered during #16367 review discussion, and I was thinking native_boost could be useful again, but it's basically just a handful of variable declarations. Will drop if / when I resubmit #16367\r\n\r\n> * Does the capnproto release schedule/upstream maintainence matter to us? Looking at the [repo](https://github.com/capnproto/capnproto), it seems that there are at least a couple people calling for a new release ([1](https://github.com/capnproto/capnproto/issues/948), [2](https://github.com/capnproto/capnproto/issues/949)), and the current maintainer has mentioned that's he basically too busy at the moment. This might be irrelevant (and it seems that a release prep PR has been merged), but worth noting if this project is going to take on (by extension) a new dependency.\r\n\r\nI'm only using basic features, and I believe the release from 5 years ago should still work fine. Also, CapnProto itself shouldn't be a hangup. I like it very much at this point, but if somebody doesn't like it, they should be able to ignore it and not use it. If someone wants to use a different protocol as an alternative or replacement, much of the work I've done here (interface declarations, process spawning code, build support) should be compatible or reusable for that.\r\n\r\n> ACK on the revert for now with the understanding that this was simply merged too early, and with a few too many unanswered questions.\r\n\r\nThanks for the questions. I'm sure there will be more asked, but I'll try to keep the number of unanswered ones close to zero",
      "created_at" : "2020-04-11T18:46:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18588#issuecomment-612487964",
      "id" : 612487964,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18588",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxMjQ4Nzk2NA==",
      "updated_at" : "2020-04-11T18:46:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/612487964",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   }
]
