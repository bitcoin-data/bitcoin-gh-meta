[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm happy to drop the last commit if it's not wanted. Main goal of this PR is to add test coverage, which is what the first two commits do. The code cleanup in the third commit could be done in another PR or replaced with a different approach.\r\n\r\n---\r\n\r\nUPDATE: Final commit def672f8706e13f4153ff9aca3fb9e1becddae26 is dropped for now to make the PR smaller and test-only",
      "created_at" : "2021-06-04T23:26:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22155#issuecomment-855110475",
      "id" : 855110475,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22155",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg1NTExMDQ3NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-20T18:15:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/855110475",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #22260 by Sjors\n* #22183 by kiminuo\n* #22100 by ryanofsky\n* #21206 by ryanofsky\n* #19101 by ryanofsky\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-06-05T05:26:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22155#issuecomment-855186589",
      "id" : 855186589,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22155",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg1NTE4NjU4OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-23T23:38:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/855186589",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22155#discussion_r647013596"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22155"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/647013596"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In e459d013d7f2e92d51e52fdf3dd7ccdd3c57db68 \"wallet test: Add test for subtract fee from recipient behavior\"\r\n\r\nSince fee estimation is not available in tests, the feerate that is used by this test is 0, which makes it not particularly meaningful. But we can set a feerate in the `CCoinControl` and force it to be used, e.g.\r\n\r\n```suggestion\r\n    CCoinControl coin_control;\r\n    coin_control.m_feerate.emplace(10000);\r\n    coin_control.fOverrideFeeRate = true;\r\n```",
      "commit_id" : "fe6dc76b7c9c5405f37464a3b19fcf82aaf22861",
      "created_at" : "2021-06-07T23:50:32Z",
      "diff_hunk" : "@@ -0,0 +1,48 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/fees.h>\n+#include <validation.h>\n+#include <wallet/coincontrol.h>\n+#include <wallet/test/util.h>\n+#include <wallet/test/wallet_test_fixture.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+BOOST_FIXTURE_TEST_SUITE(spend_tests, WalletTestingSetup)\n+\n+BOOST_FIXTURE_TEST_CASE(SubtractFee, TestChain100Setup)\n+{\n+    CChain& cchain = m_node.chainman->ActiveChain();\n+    CreateAndProcessBlock({}, GetScriptForRawPubKey(coinbaseKey.GetPubKey()));\n+    auto wallet = CreateSyncedWallet(*m_node.chain, cchain, coinbaseKey);\n+\n+    // Check subtract from recipient transaction equal to coinbase amount does\n+    // not create change output.\n+    CRecipient recipient{GetScriptForRawPubKey({}), 50 * COIN, true /* subtract fee */};\n+    CTransactionRef tx;\n+    CAmount fee;\n+    int change_pos = -1;\n+    bilingual_str error;\n+    CCoinControl coin_control;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22155#discussion_r647013596",
      "id" : 647013596,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NzAxMzU5Ng==",
      "original_commit_id" : "e459d013d7f2e92d51e52fdf3dd7ccdd3c57db68",
      "original_line" : 28,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/wallet/test/spend_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 677973556,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22155",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-08T00:07:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/647013596",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22155#discussion_r647082115"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22155"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/647082115"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Since fee estimation is not available in tests, the feerate that is used by this test is 0, which makes it not particularly meaningful. But we can set a feerate in the `CCoinControl` and force it to be used, e.g.\r\n\r\nThank you, great catch! I had assumed a nonzero minimum relay fee would be used. I think the tests still did cover relevant `to_reduce == 0` and `to_reduce < 0` cases, but having a nonzero fee is obviously more realistic.",
      "commit_id" : "fe6dc76b7c9c5405f37464a3b19fcf82aaf22861",
      "created_at" : "2021-06-08T03:24:19Z",
      "diff_hunk" : "@@ -0,0 +1,48 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/fees.h>\n+#include <validation.h>\n+#include <wallet/coincontrol.h>\n+#include <wallet/test/util.h>\n+#include <wallet/test/wallet_test_fixture.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+BOOST_FIXTURE_TEST_SUITE(spend_tests, WalletTestingSetup)\n+\n+BOOST_FIXTURE_TEST_CASE(SubtractFee, TestChain100Setup)\n+{\n+    CChain& cchain = m_node.chainman->ActiveChain();\n+    CreateAndProcessBlock({}, GetScriptForRawPubKey(coinbaseKey.GetPubKey()));\n+    auto wallet = CreateSyncedWallet(*m_node.chain, cchain, coinbaseKey);\n+\n+    // Check subtract from recipient transaction equal to coinbase amount does\n+    // not create change output.\n+    CRecipient recipient{GetScriptForRawPubKey({}), 50 * COIN, true /* subtract fee */};\n+    CTransactionRef tx;\n+    CAmount fee;\n+    int change_pos = -1;\n+    bilingual_str error;\n+    CCoinControl coin_control;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22155#discussion_r647082115",
      "id" : 647082115,
      "in_reply_to_id" : 647013596,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NzA4MjExNQ==",
      "original_commit_id" : "e459d013d7f2e92d51e52fdf3dd7ccdd3c57db68",
      "original_line" : 28,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/wallet/test/spend_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 678053411,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22155",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-08T13:47:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/647082115",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 972e87c08268879576b9287b5998739bef1c4cc1",
      "created_at" : "2021-06-08T18:22:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22155#issuecomment-856993434",
      "id" : 856993434,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22155",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg1Njk5MzQzNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-08T18:22:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/856993434",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-06-09T12:00:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22155#issuecomment-857634636",
      "id" : 857634636,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22155",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg1NzYzNDYzNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-09T12:00:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/857634636",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased 972e87c08268879576b9287b5998739bef1c4cc1 -> 8f6113f51de8b04ae39be897b2dedf98c3e8a54b ([`pr/subfee.3`](https://github.com/ryanofsky/bitcoin/commits/pr/subfee.3) -> [`pr/subfee.4`](https://github.com/ryanofsky/bitcoin/commits/pr/subfee.4), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/subfee.3-rebase..pr/subfee.4)) due to conflict with #22008\r\n",
      "created_at" : "2021-06-10T12:26:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22155#issuecomment-858577045",
      "id" : 858577045,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22155",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg1ODU3NzA0NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-10T12:26:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/858577045",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, good to see test coverage here.",
      "created_at" : "2021-06-10T12:50:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22155#issuecomment-858594253",
      "id" : 858594253,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22155",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg1ODU5NDI1Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-10T12:50:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/858594253",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated 8f6113f51de8b04ae39be897b2dedf98c3e8a54b -> 6a50482691964c782eecea573abeff0e2169dfcb ([`pr/subfee.4`](https://github.com/ryanofsky/bitcoin/commits/pr/subfee.4) -> [`pr/subfee.5`](https://github.com/ryanofsky/bitcoin/commits/pr/subfee.5), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/subfee.4..pr/subfee.5)) to fix appveyor link error https://ci.appveyor.com/project/DrahtBot/bitcoin/builds/39546773#L32",
      "created_at" : "2021-06-10T14:56:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22155#issuecomment-858694581",
      "id" : 858694581,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22155",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg1ODY5NDU4MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-10T14:56:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/858694581",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-ACK 6a50482691964c782eecea573abeff0e2169dfcb",
      "created_at" : "2021-06-10T18:26:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22155#issuecomment-858874553",
      "id" : 858874553,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22155",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg1ODg3NDU1Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-10T18:26:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/858874553",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-06-12T04:41:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22155#issuecomment-859997326",
      "id" : 859997326,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22155",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg1OTk5NzMyNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-12T04:41:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/859997326",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased 6a50482691964c782eecea573abeff0e2169dfcb -> 0cc10f8377495fb60156d116307848674e4be38e ([`pr/subfee.5`](https://github.com/ryanofsky/bitcoin/commits/pr/subfee.5) -> [`pr/subfee.6`](https://github.com/ryanofsky/bitcoin/commits/pr/subfee.6), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/subfee.5-rebase..pr/subfee.6)) due to conflict with #21866",
      "created_at" : "2021-06-12T18:46:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22155#issuecomment-860093503",
      "id" : 860093503,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22155",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2MDA5MzUwMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-12T18:46:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/860093503",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated 0cc10f8377495fb60156d116307848674e4be38e -> def672f8706e13f4153ff9aca3fb9e1becddae26 ([`pr/subfee.6`](https://github.com/ryanofsky/bitcoin/commits/pr/subfee.6) -> [`pr/subfee.7`](https://github.com/ryanofsky/bitcoin/commits/pr/subfee.7), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/subfee.6..pr/subfee.7)) with minor updates suggested by jonatack (thanks!) and some tweaks (keeping a wallet line unchanged and preferring forward declarations over includes)",
      "created_at" : "2021-07-14T18:19:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22155#issuecomment-880110218",
      "id" : 880110218,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22155",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg4MDExMDIxOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-14T18:19:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/880110218",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22155#discussion_r669864128"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22155"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/669864128"
         }
      },
      "author_association" : "MEMBER",
      "body" : "def672f870 (feel free to ignore)\r\n```suggestion\r\n        const CAmount to_reduce{nFeeRet + change_amount - change_and_fee};\r\n```",
      "commit_id" : "fe6dc76b7c9c5405f37464a3b19fcf82aaf22861",
      "created_at" : "2021-07-14T18:42:52Z",
      "diff_hunk" : "@@ -774,17 +773,12 @@ bool CWallet::CreateTransactionInternal(\n         // Because we have dropped this change, the tx size and required fee will be different, so let's recalculate those\n         tx_sizes = CalculateMaximumSignedTxSize(CTransaction(txNew), this, coin_control.fAllowWatchOnly);\n         nBytes = tx_sizes.vsize;\n-        fee_needed = coin_selection_params.m_effective_feerate.GetFee(nBytes);\n-    }\n-\n-    // Update nFeeRet in case fee_needed changed due to dropping the change output\n-    if (fee_needed <= change_and_fee - change_amount) {\n-        nFeeRet = change_and_fee - change_amount;\n+        nFeeRet = coin_selection_params.m_effective_feerate.GetFee(nBytes);\n     }\n \n     // Reduce output values for subtractFeeFromAmount\n     if (coin_selection_params.m_subtract_fee_outputs) {\n-        CAmount to_reduce = fee_needed + change_amount - change_and_fee;\n+        CAmount to_reduce = nFeeRet + change_amount - change_and_fee;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22155#discussion_r669864128",
      "id" : 669864128,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2OTg2NDEyOA==",
      "original_commit_id" : "def672f8706e13f4153ff9aca3fb9e1becddae26",
      "original_line" : 781,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 706603715,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22155",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-14T18:50:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/669864128",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22155#discussion_r670192976"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22155"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/670192976"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Isn't it always just `50 * COIN - fee`\r\nI believe it'd be slightly easier to understand",
      "commit_id" : "fe6dc76b7c9c5405f37464a3b19fcf82aaf22861",
      "created_at" : "2021-07-15T07:08:39Z",
      "diff_hunk" : "@@ -0,0 +1,61 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/fees.h>\n+#include <validation.h>\n+#include <wallet/coincontrol.h>\n+#include <wallet/test/util.h>\n+#include <wallet/test/wallet_test_fixture.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+BOOST_FIXTURE_TEST_SUITE(spend_tests, WalletTestingSetup)\n+\n+BOOST_FIXTURE_TEST_CASE(SubtractFee, TestChain100Setup)\n+{\n+    CreateAndProcessBlock({}, GetScriptForRawPubKey(coinbaseKey.GetPubKey()));\n+    auto wallet = CreateSyncedWallet(*m_node.chain, m_node.chainman->ActiveChain(), coinbaseKey);\n+\n+    // Check that a subtract-from-recipient transaction slightly less than the\n+    // coinbase input amount does not create a change output (because it would\n+    // be uneconomical to add and spend the output), and make sure it pays the\n+    // leftover input amount which would have been change to the recipient\n+    // instead of the miner.\n+    auto check_tx = [&wallet](CAmount leftover_input_amount) {\n+        CRecipient recipient{GetScriptForRawPubKey({}), 50 * COIN - leftover_input_amount, true /* subtract fee */};\n+        CTransactionRef tx;\n+        CAmount fee;\n+        int change_pos = -1;\n+        bilingual_str error;\n+        CCoinControl coin_control;\n+        coin_control.m_feerate.emplace(10000);\n+        coin_control.fOverrideFeeRate = true;\n+        FeeCalculation fee_calc;\n+        BOOST_CHECK(wallet->CreateTransaction({recipient}, tx, fee, change_pos, error, coin_control, fee_calc));\n+        BOOST_CHECK_EQUAL(tx->vout.size(), 1);\n+        BOOST_CHECK_EQUAL(tx->vout[0].nValue, recipient.nAmount + leftover_input_amount - fee);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22155#discussion_r670192976",
      "id" : 670192976,
      "line" : 37,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MDE5Mjk3Ng==",
      "original_commit_id" : "fe6dc76b7c9c5405f37464a3b19fcf82aaf22861",
      "original_line" : 37,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/wallet/test/spend_tests.cpp",
      "position" : 37,
      "pull_request_review_id" : 706998784,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22155",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-20T07:54:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/670192976",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22155#discussion_r670200733"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22155"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/670200733"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Any reasons to extract this from `ListCoinsTestingSetup` instead of using the fixture directly?\r\n\r\nIt looks like currently fixtures are preferred method of sharing setup/teardown between unit tests. `ListCoinsTestingSetup` already exists and does exactly what we need.",
      "commit_id" : "fe6dc76b7c9c5405f37464a3b19fcf82aaf22861",
      "created_at" : "2021-07-15T07:20:43Z",
      "diff_hunk" : "@@ -0,0 +1,38 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <wallet/test/util.h>\n+\n+#include <chain.h>\n+#include <key.h>\n+#include <test/util/setup_common.h>\n+#include <wallet/wallet.h>\n+#include <wallet/walletdb.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+#include <memory>\n+\n+std::unique_ptr<CWallet> CreateSyncedWallet(interfaces::Chain& chain, CChain& cchain, const CKey& key)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22155#discussion_r670200733",
      "id" : 670200733,
      "line" : 17,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MDIwMDczMw==",
      "original_commit_id" : "2565478c813fb7278153b113de4b9338fc186872",
      "original_line" : 17,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/wallet/test/util.cpp",
      "position" : 17,
      "pull_request_review_id" : 706998784,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22155",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-20T07:54:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/670200733",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22155#discussion_r672880212"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22155"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672880212"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why not reuse `wallet/test/wallet_test_fixture.*`?\r\n\r\nIt already contains `WalletTestingSetup` that we use anyway.",
      "commit_id" : "fe6dc76b7c9c5405f37464a3b19fcf82aaf22861",
      "created_at" : "2021-07-20T07:36:15Z",
      "diff_hunk" : "@@ -170,6 +170,8 @@ endif\n \n \n BITCOIN_TEST_SUITE += \\\n+  wallet/test/util.cpp \\\n+  wallet/test/util.h \\",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22155#discussion_r672880212",
      "id" : 672880212,
      "line" : 175,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3Mjg4MDIxMg==",
      "original_commit_id" : "2565478c813fb7278153b113de4b9338fc186872",
      "original_line" : 175,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/Makefile.test.include",
      "position" : 13,
      "pull_request_review_id" : 706998784,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22155",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-20T07:54:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672880212",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22155#discussion_r672890164"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22155"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672890164"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "No need to override fixture declared for test suite. You can do\r\n\r\n```\r\nBOOST_FIXTURE_TEST_SUITE(spend_tests, TestChain100Setup)\r\nBOOST_AUTO_TEST_CASE(SubtractFee)\r\n```\r\n\r\nor\r\n\r\n```\r\nBOOST_AUTO_TEST_SUITE(spend_tests)\r\nBOOST_FIXTURE_TEST_CASE(SubtractFee, TestChain100Setup)\r\n```",
      "commit_id" : "fe6dc76b7c9c5405f37464a3b19fcf82aaf22861",
      "created_at" : "2021-07-20T07:51:09Z",
      "diff_hunk" : "@@ -0,0 +1,61 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/fees.h>\n+#include <validation.h>\n+#include <wallet/coincontrol.h>\n+#include <wallet/test/util.h>\n+#include <wallet/test/wallet_test_fixture.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+BOOST_FIXTURE_TEST_SUITE(spend_tests, WalletTestingSetup)\n+\n+BOOST_FIXTURE_TEST_CASE(SubtractFee, TestChain100Setup)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22155#discussion_r672890164",
      "id" : 672890164,
      "line" : 15,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3Mjg5MDE2NA==",
      "original_commit_id" : "fe6dc76b7c9c5405f37464a3b19fcf82aaf22861",
      "original_line" : 15,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/wallet/test/spend_tests.cpp",
      "position" : 15,
      "pull_request_review_id" : 706998784,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22155",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-20T07:54:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672890164",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22155#discussion_r673033794"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22155"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/673033794"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/22155#discussion_r672880212\r\n\r\n> Why not reuse `wallet/test/wallet_test_fixture.*`?\r\n\r\nResponded in detail about the fixtures below.",
      "commit_id" : "fe6dc76b7c9c5405f37464a3b19fcf82aaf22861",
      "created_at" : "2021-07-20T11:22:07Z",
      "diff_hunk" : "@@ -170,6 +170,8 @@ endif\n \n \n BITCOIN_TEST_SUITE += \\\n+  wallet/test/util.cpp \\\n+  wallet/test/util.h \\",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22155#discussion_r673033794",
      "id" : 673033794,
      "in_reply_to_id" : 672880212,
      "line" : 175,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MzAzMzc5NA==",
      "original_commit_id" : "2565478c813fb7278153b113de4b9338fc186872",
      "original_line" : 175,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/Makefile.test.include",
      "position" : 13,
      "pull_request_review_id" : 710463472,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22155",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-20T18:11:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/673033794",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22155#discussion_r673037356"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22155"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/673037356"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/22155#discussion_r672890164\r\n\r\n> No need to override fixture declared for test suite. You can do [...]\r\n\r\nI know you can do these things, but don't see what makes them better or meaningfully different. What I think is nice about the current approach is that it makes spend_tests setup consistent with wallet_tests setup, and more efficient by default because the wallet test fixture does less work than the chain100 fixture.",
      "commit_id" : "fe6dc76b7c9c5405f37464a3b19fcf82aaf22861",
      "created_at" : "2021-07-20T11:28:02Z",
      "diff_hunk" : "@@ -0,0 +1,61 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/fees.h>\n+#include <validation.h>\n+#include <wallet/coincontrol.h>\n+#include <wallet/test/util.h>\n+#include <wallet/test/wallet_test_fixture.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+BOOST_FIXTURE_TEST_SUITE(spend_tests, WalletTestingSetup)\n+\n+BOOST_FIXTURE_TEST_CASE(SubtractFee, TestChain100Setup)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22155#discussion_r673037356",
      "id" : 673037356,
      "in_reply_to_id" : 672890164,
      "line" : 15,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MzAzNzM1Ng==",
      "original_commit_id" : "fe6dc76b7c9c5405f37464a3b19fcf82aaf22861",
      "original_line" : 15,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/wallet/test/spend_tests.cpp",
      "position" : 15,
      "pull_request_review_id" : 710463472,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22155",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-20T18:11:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/673037356",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22155#discussion_r673045063"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22155"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/673045063"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/22155#discussion_r670192976\r\n\r\n> Isn't it always just `50 * COIN - fee`\r\n> I believe it'd be slightly easier to understand\r\n\r\nThis is surprising to me, and I'm not sure how the thinking goes. I think `recipient.nAmount + leftover_input_amount - fee` captures the idea that when the subtract-from-recipient option is used, the recipient will receive the amount originally requested (`recipient.nAmount`) plus any dust amount (`leftover_input_amount`) that is too small to refund to the sender, minus the fee (`fee`). I'm not sure what `50 * COIN - fee` communicates since it is involving the block reward which is a just a coincidental part of the test setup. It seems like this would be checking for the right result incidentally instead of explicitly, and it could also be more difficult to extend or maintain because it is repeating hardcoded setup values which aren't related to the behavior being verified.",
      "commit_id" : "fe6dc76b7c9c5405f37464a3b19fcf82aaf22861",
      "created_at" : "2021-07-20T11:40:33Z",
      "diff_hunk" : "@@ -0,0 +1,61 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/fees.h>\n+#include <validation.h>\n+#include <wallet/coincontrol.h>\n+#include <wallet/test/util.h>\n+#include <wallet/test/wallet_test_fixture.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+BOOST_FIXTURE_TEST_SUITE(spend_tests, WalletTestingSetup)\n+\n+BOOST_FIXTURE_TEST_CASE(SubtractFee, TestChain100Setup)\n+{\n+    CreateAndProcessBlock({}, GetScriptForRawPubKey(coinbaseKey.GetPubKey()));\n+    auto wallet = CreateSyncedWallet(*m_node.chain, m_node.chainman->ActiveChain(), coinbaseKey);\n+\n+    // Check that a subtract-from-recipient transaction slightly less than the\n+    // coinbase input amount does not create a change output (because it would\n+    // be uneconomical to add and spend the output), and make sure it pays the\n+    // leftover input amount which would have been change to the recipient\n+    // instead of the miner.\n+    auto check_tx = [&wallet](CAmount leftover_input_amount) {\n+        CRecipient recipient{GetScriptForRawPubKey({}), 50 * COIN - leftover_input_amount, true /* subtract fee */};\n+        CTransactionRef tx;\n+        CAmount fee;\n+        int change_pos = -1;\n+        bilingual_str error;\n+        CCoinControl coin_control;\n+        coin_control.m_feerate.emplace(10000);\n+        coin_control.fOverrideFeeRate = true;\n+        FeeCalculation fee_calc;\n+        BOOST_CHECK(wallet->CreateTransaction({recipient}, tx, fee, change_pos, error, coin_control, fee_calc));\n+        BOOST_CHECK_EQUAL(tx->vout.size(), 1);\n+        BOOST_CHECK_EQUAL(tx->vout[0].nValue, recipient.nAmount + leftover_input_amount - fee);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22155#discussion_r673045063",
      "id" : 673045063,
      "in_reply_to_id" : 670192976,
      "line" : 37,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MzA0NTA2Mw==",
      "original_commit_id" : "fe6dc76b7c9c5405f37464a3b19fcf82aaf22861",
      "original_line" : 37,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/wallet/test/spend_tests.cpp",
      "position" : 37,
      "pull_request_review_id" : 710463472,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22155",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-20T18:11:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/673045063",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22155#discussion_r673051693"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22155"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/673051693"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/22155#discussion_r670200733\r\n\r\n> Any reasons to extract this from `ListCoinsTestingSetup` instead of using the fixture directly?\r\n> \r\n> It looks like currently fixtures are preferred method of sharing setup/teardown between unit tests. `ListCoinsTestingSetup` already exists and does exactly what we need.\r\n\r\nFixtures are overused in general right now, causing tests to do unnecessary work, and they make setup code that could be reused in other contexts (benchmarks & fuzz tests, future test & simulation code) harder to understand and less reusable. The current hierarchy of test fixtures that inherit from each other is also confusing and inflexible.\r\n\r\nThe suggestion here also seems a little vague, because I'm not sure what form or members you'd want a generic fixture to have. ListCoinsTestingSetup has more functionality than the new test requires, and less functionality than new tests may require. Would the new fixture only support tests with one synced wallet, or with multiple wallets? Would it require all the wallets to be created before each test starts, or could the tests create the wallets as needed?\r\n\r\nThe simplicity a `CreateSyncedWallet` util function not tied to a class hierarchy makes more sense to me than a test fixture that is more complicated with more usage restrictions.",
      "commit_id" : "fe6dc76b7c9c5405f37464a3b19fcf82aaf22861",
      "created_at" : "2021-07-20T11:51:13Z",
      "diff_hunk" : "@@ -0,0 +1,38 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <wallet/test/util.h>\n+\n+#include <chain.h>\n+#include <key.h>\n+#include <test/util/setup_common.h>\n+#include <wallet/wallet.h>\n+#include <wallet/walletdb.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+#include <memory>\n+\n+std::unique_ptr<CWallet> CreateSyncedWallet(interfaces::Chain& chain, CChain& cchain, const CKey& key)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22155#discussion_r673051693",
      "id" : 673051693,
      "in_reply_to_id" : 670200733,
      "line" : 17,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MzA1MTY5Mw==",
      "original_commit_id" : "2565478c813fb7278153b113de4b9338fc186872",
      "original_line" : 17,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/wallet/test/util.cpp",
      "position" : 17,
      "pull_request_review_id" : 710463472,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22155",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-20T18:11:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/673051693",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22155#discussion_r673705394"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22155"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/673705394"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The thinking is that the recipient always gets the whole UTXO - fee.\r\nOn the first look it seemed to me that the value received would be different since `leftover_input_amount` is different for different invocations. It took me some time to figure out that the `leftover_input_amount` variable  cancels out.\r\n\r\nI understand your thinking as well and I don't know which one is better.",
      "commit_id" : "fe6dc76b7c9c5405f37464a3b19fcf82aaf22861",
      "created_at" : "2021-07-21T06:49:53Z",
      "diff_hunk" : "@@ -0,0 +1,61 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/fees.h>\n+#include <validation.h>\n+#include <wallet/coincontrol.h>\n+#include <wallet/test/util.h>\n+#include <wallet/test/wallet_test_fixture.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+BOOST_FIXTURE_TEST_SUITE(spend_tests, WalletTestingSetup)\n+\n+BOOST_FIXTURE_TEST_CASE(SubtractFee, TestChain100Setup)\n+{\n+    CreateAndProcessBlock({}, GetScriptForRawPubKey(coinbaseKey.GetPubKey()));\n+    auto wallet = CreateSyncedWallet(*m_node.chain, m_node.chainman->ActiveChain(), coinbaseKey);\n+\n+    // Check that a subtract-from-recipient transaction slightly less than the\n+    // coinbase input amount does not create a change output (because it would\n+    // be uneconomical to add and spend the output), and make sure it pays the\n+    // leftover input amount which would have been change to the recipient\n+    // instead of the miner.\n+    auto check_tx = [&wallet](CAmount leftover_input_amount) {\n+        CRecipient recipient{GetScriptForRawPubKey({}), 50 * COIN - leftover_input_amount, true /* subtract fee */};\n+        CTransactionRef tx;\n+        CAmount fee;\n+        int change_pos = -1;\n+        bilingual_str error;\n+        CCoinControl coin_control;\n+        coin_control.m_feerate.emplace(10000);\n+        coin_control.fOverrideFeeRate = true;\n+        FeeCalculation fee_calc;\n+        BOOST_CHECK(wallet->CreateTransaction({recipient}, tx, fee, change_pos, error, coin_control, fee_calc));\n+        BOOST_CHECK_EQUAL(tx->vout.size(), 1);\n+        BOOST_CHECK_EQUAL(tx->vout[0].nValue, recipient.nAmount + leftover_input_amount - fee);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22155#discussion_r673705394",
      "id" : 673705394,
      "in_reply_to_id" : 670192976,
      "line" : 37,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MzcwNTM5NA==",
      "original_commit_id" : "fe6dc76b7c9c5405f37464a3b19fcf82aaf22861",
      "original_line" : 37,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/wallet/test/spend_tests.cpp",
      "position" : 37,
      "pull_request_review_id" : 711310675,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22155",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-21T06:49:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/673705394",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22155#discussion_r673741284"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22155"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/673741284"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Fixtures are overused in general right now, causing tests to do unnecessary work, and they make setup code that could be reused in other contexts (benchmarks & fuzz tests, future test & simulation code) harder to understand and less reusable. \r\n\r\nIn this specific case the fixture doesn't cause unnecessary work.\r\n`CreateSyncedWallet` function is used in only two places now: 1) in `ListCoinsTestingSetup` and 2) in the new test that uses `TestChain100Setup` fixture anyway.\r\n\r\nIn general I agree that fixtures are harder to reuse in other contexts but without having a real use case I'm not sure that `CreateSyncedWallet` will actually meet the requirements.\r\n\r\n> The current hierarchy of test fixtures that inherit from each other is also confusing and inflexible.\r\n\r\nBut you are using fixtures anyway right now. So why then split some part of the setup in fixture and some part in a standalone method. Using two separate mechanism to do the test setup is even more confusing. \r\n\r\nAlso there is value in maintaining uniformity in how the test setup is done. \r\nFixtures are already used extensively in the code base. There are 72 test suites that use fixtures vs 24 that don't. According to my spot check the ones that don't use fixtures also don't use standalone setup function as a way to reuse setup code between tests. \r\n\r\n> The suggestion here also seems a little vague, because I'm not sure what form or members you'd want a generic fixture to have. ListCoinsTestingSetup has more functionality than the new test requires, and less functionality than new tests may require. Would the new fixture only support tests with one synced wallet, or with multiple wallets? Would it require all the wallets to be created before each test starts, or could the tests create the wallets as needed?\r\n\r\nMy suggestion is to not introduce a second mechanism to do test setups and just reuse existing fixture (probably renaming it to `SyncedWalletTestingSetup`) because it has exactly the right setup. \r\n\r\nThe new `SubtractFee` test has the setup exactly equivalent to the setup of `ListCoinsTestingSetup`. `ListCoinsTestingSetup` has also `AddTx` method which is used exactly one time and could easily be inlined or extracted.",
      "commit_id" : "fe6dc76b7c9c5405f37464a3b19fcf82aaf22861",
      "created_at" : "2021-07-21T07:49:48Z",
      "diff_hunk" : "@@ -0,0 +1,38 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <wallet/test/util.h>\n+\n+#include <chain.h>\n+#include <key.h>\n+#include <test/util/setup_common.h>\n+#include <wallet/wallet.h>\n+#include <wallet/walletdb.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+#include <memory>\n+\n+std::unique_ptr<CWallet> CreateSyncedWallet(interfaces::Chain& chain, CChain& cchain, const CKey& key)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22155#discussion_r673741284",
      "id" : 673741284,
      "in_reply_to_id" : 670200733,
      "line" : 17,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3Mzc0MTI4NA==",
      "original_commit_id" : "2565478c813fb7278153b113de4b9338fc186872",
      "original_line" : 17,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/wallet/test/util.cpp",
      "position" : 17,
      "pull_request_review_id" : 711356168,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22155",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-21T07:49:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/673741284",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22155#discussion_r673743964"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22155"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/673743964"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It's better because it avoids unnecessary information. `WalletTestingSetup` is never used in the test suite.\r\n\r\nThere is no point in setting TEST_SUITE fixture to `WalletTestingSetup` when the only test case in the test suite overrides the fixture and uses `TestChain100Setup`.  It's just unused information in the test that could potentially confuse readers.\r\n\r\nSame goes for `wallet_tests`. Every test case there defines there own fixture explicitly and don't inherit it from the test suite. I have no idea why it's like that",
      "commit_id" : "fe6dc76b7c9c5405f37464a3b19fcf82aaf22861",
      "created_at" : "2021-07-21T07:53:51Z",
      "diff_hunk" : "@@ -0,0 +1,61 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/fees.h>\n+#include <validation.h>\n+#include <wallet/coincontrol.h>\n+#include <wallet/test/util.h>\n+#include <wallet/test/wallet_test_fixture.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+BOOST_FIXTURE_TEST_SUITE(spend_tests, WalletTestingSetup)\n+\n+BOOST_FIXTURE_TEST_CASE(SubtractFee, TestChain100Setup)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22155#discussion_r673743964",
      "id" : 673743964,
      "in_reply_to_id" : 672890164,
      "line" : 15,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3Mzc0Mzk2NA==",
      "original_commit_id" : "fe6dc76b7c9c5405f37464a3b19fcf82aaf22861",
      "original_line" : 15,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/wallet/test/spend_tests.cpp",
      "position" : 15,
      "pull_request_review_id" : 711359537,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22155",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-21T07:53:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/673743964",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK fe6dc76b7c9c5405f37464a3b19fcf82aaf22861",
      "created_at" : "2021-07-21T19:02:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22155#issuecomment-884422497",
      "id" : 884422497,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22155",
      "node_id" : "IC_kwDOABII5840tzdh",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-21T19:02:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/884422497",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22155#discussion_r675579250"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22155"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/675579250"
         }
      },
      "author_association" : "MEMBER",
      "body" : "fe6dc76b7c9c5405f37464a3b19fcf82aaf22861\r\n\r\nnit, also check `change_pos == -1`.",
      "commit_id" : "fe6dc76b7c9c5405f37464a3b19fcf82aaf22861",
      "created_at" : "2021-07-23T13:48:55Z",
      "diff_hunk" : "@@ -0,0 +1,61 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/fees.h>\n+#include <validation.h>\n+#include <wallet/coincontrol.h>\n+#include <wallet/test/util.h>\n+#include <wallet/test/wallet_test_fixture.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+BOOST_FIXTURE_TEST_SUITE(spend_tests, WalletTestingSetup)\n+\n+BOOST_FIXTURE_TEST_CASE(SubtractFee, TestChain100Setup)\n+{\n+    CreateAndProcessBlock({}, GetScriptForRawPubKey(coinbaseKey.GetPubKey()));\n+    auto wallet = CreateSyncedWallet(*m_node.chain, m_node.chainman->ActiveChain(), coinbaseKey);\n+\n+    // Check that a subtract-from-recipient transaction slightly less than the\n+    // coinbase input amount does not create a change output (because it would\n+    // be uneconomical to add and spend the output), and make sure it pays the\n+    // leftover input amount which would have been change to the recipient\n+    // instead of the miner.\n+    auto check_tx = [&wallet](CAmount leftover_input_amount) {\n+        CRecipient recipient{GetScriptForRawPubKey({}), 50 * COIN - leftover_input_amount, true /* subtract fee */};\n+        CTransactionRef tx;\n+        CAmount fee;\n+        int change_pos = -1;\n+        bilingual_str error;\n+        CCoinControl coin_control;\n+        coin_control.m_feerate.emplace(10000);\n+        coin_control.fOverrideFeeRate = true;\n+        FeeCalculation fee_calc;\n+        BOOST_CHECK(wallet->CreateTransaction({recipient}, tx, fee, change_pos, error, coin_control, fee_calc));\n+        BOOST_CHECK_EQUAL(tx->vout.size(), 1);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22155#discussion_r675579250",
      "id" : 675579250,
      "line" : 36,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3NTU3OTI1MA==",
      "original_commit_id" : "fe6dc76b7c9c5405f37464a3b19fcf82aaf22861",
      "original_line" : 36,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/wallet/test/spend_tests.cpp",
      "position" : 36,
      "pull_request_review_id" : 713746109,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22155",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-23T13:56:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/675579250",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : ":scream: Apparently I missed a review club about this https://bitcoincore.reviews/22155. Sorry I missed but relieved it didn't find any terrible problems!",
      "created_at" : "2021-07-29T16:01:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22155#issuecomment-889269873",
      "id" : 889269873,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22155",
      "node_id" : "IC_kwDOABII5841AS5x",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-29T16:01:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/889269873",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22155#discussion_r679296345"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22155"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/679296345"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I understand the motivation now and yes I agree. WalletTestingSetup can be overkill because even if you are testing wallet code, you are likely testing smaller functions and classes that don't need the full setup. It's nicer in general to use simpler fixtures for efficiency and easier comprehension, and would be good to see use of fixtures cleaned up and simplified in future PRs. Consistency between spend_tests and wallet_tests here may at least help with that.",
      "commit_id" : "fe6dc76b7c9c5405f37464a3b19fcf82aaf22861",
      "created_at" : "2021-07-29T16:13:54Z",
      "diff_hunk" : "@@ -0,0 +1,61 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/fees.h>\n+#include <validation.h>\n+#include <wallet/coincontrol.h>\n+#include <wallet/test/util.h>\n+#include <wallet/test/wallet_test_fixture.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+BOOST_FIXTURE_TEST_SUITE(spend_tests, WalletTestingSetup)\n+\n+BOOST_FIXTURE_TEST_CASE(SubtractFee, TestChain100Setup)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22155#discussion_r679296345",
      "id" : 679296345,
      "in_reply_to_id" : 672890164,
      "line" : 15,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3OTI5NjM0NQ==",
      "original_commit_id" : "fe6dc76b7c9c5405f37464a3b19fcf82aaf22861",
      "original_line" : 15,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/wallet/test/spend_tests.cpp",
      "position" : 15,
      "pull_request_review_id" : 718288189,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22155",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-29T16:13:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/679296345",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22155#discussion_r679313586"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22155"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/679313586"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/22155#discussion_r673741284\r\n\r\n> My suggestion is to not introduce a second mechanism to do test setups and just reuse existing fixture (probably renaming it to `SyncedWalletTestingSetup`) because it has exactly the right setup.\r\n\r\nYes, I see what you're saying here. If you can use fixtures to help with test setup, and you can also use normal functions to also help with test setup, then setup code might be less discoverable, and someone who is trying to write a new test and only looking at the fixtures might miss a function that could be useful. I would not deny that this is a drawback. I just think there are some advantages on the other side. (Functions that don't maintain state can be easier to understand than fixtures that are stateful. Functions can be more flexible than fixtures and in this case let you create many synced wallets instead of one. Functions can be shared across frameworks including boost framework, qt test framework, fuzzing framework, benchmark framework, and other future frameworks, instead of limited to the boost framework. And this change adds a place for more functions to go and more fixture code to be detached even if is not moving right away)",
      "commit_id" : "fe6dc76b7c9c5405f37464a3b19fcf82aaf22861",
      "created_at" : "2021-07-29T16:36:27Z",
      "diff_hunk" : "@@ -0,0 +1,38 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <wallet/test/util.h>\n+\n+#include <chain.h>\n+#include <key.h>\n+#include <test/util/setup_common.h>\n+#include <wallet/wallet.h>\n+#include <wallet/walletdb.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+#include <memory>\n+\n+std::unique_ptr<CWallet> CreateSyncedWallet(interfaces::Chain& chain, CChain& cchain, const CKey& key)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22155#discussion_r679313586",
      "id" : 679313586,
      "in_reply_to_id" : 670200733,
      "line" : 17,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3OTMxMzU4Ng==",
      "original_commit_id" : "2565478c813fb7278153b113de4b9338fc186872",
      "original_line" : 17,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/wallet/test/util.cpp",
      "position" : 17,
      "pull_request_review_id" : 718309979,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22155",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-29T16:36:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/679313586",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Good suggestions for followup\r\n\r\n- S3RK switching wallet & spend test default fixtures to minimal basic setup https://github.com/bitcoin/bitcoin/pull/22155#discussion_r673743964\r\n- glozow extending coverage for multiple recipients https://github.com/bitcoin/bitcoin/pull/22155#pullrequestreview-713724079\r\n- promag checking returned `changed_pos` https://github.com/bitcoin/bitcoin/pull/22155#discussion_r675579250\r\n\r\n",
      "created_at" : "2021-07-29T16:42:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22155#issuecomment-889299234",
      "id" : 889299234,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22155",
      "node_id" : "IC_kwDOABII5841AaEi",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-29T16:42:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/889299234",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   }
]
