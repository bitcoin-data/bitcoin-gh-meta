{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "Based on:  #22075\r\nCode reviewers: I recommend reading the new `guix-{attest,verify}` files instead of trying to read the diff\r\n\r\nThe following changes resolve many usability improvements which were pointed out to me:\r\n1. Some maintainers like to extract their \"uncodesigned tarball\" inside the `output/` directory, resulting in the older `guix-attest` mistakenly attesting to the extracted contents\r\n2. Maintainers whose GPG keys reside on an external smartcard often need to physically interact with the smartcard as a way to approve the signing operation, having one signature per platform means a lot of fidgeting\r\n3. Maintainers wishing to sign on a separate machine now has the option of transferring only a subtree of `output/`, namely `output/*/SHA256SUMS.part`, in order to perform a signature (you may need to specify an `$OUTDIR_BASE` env var)\r\n4. The `all.SHA256SUMS` file should be usable as the base `SHA256SUMS` in bitcoin core torrents and on the release server.\r\n\r\n-----\r\n\r\nAfter this change, output directories will now include a `SHA256SUMS.part` fragment, created immediately after a successful build:\r\n```\r\noutput\r\nâââ x86_64-w64-mingw32\r\n    âââ bitcoin-4e069f7589da-win64-debug.zip\r\n    âââ bitcoin-4e069f7589da-win64-setup-unsigned.exe\r\n    âââ bitcoin-4e069f7589da-win64.zip\r\n    âââ bitcoin-4e069f7589da-win-unsigned.tar.gz\r\n    âââ SHA256SUMS.part\r\n```\r\n\r\nThese `SHA256SUMS.part` fragments look something like:\r\n```\r\n3ebd7262b1a0a5bb757fef1f70e7e14033c70f98c059bc4dbfee5d1992b25825  dist-archive/bitcoin-4e069f7589da.tar.gz\r\ndef2e7d3de5ab3e3f955344e75151df4f33713f9101f5295bd13c9375bdf633b  x86_64-w64-mingw32/bitcoin-4e069f7589da-win64-debug.zip\r\n643049fe3ee4a4e83a1739607e67b11b7c9b1a66208a6f35a9ff634ba795500e  x86_64-w64-mingw32/bitcoin-4e069f7589da-win64-setup-unsigned.exe\r\na247a1ccec0ccc2e138c648284bd01f6a761f2d8d6d07d91b5b4a6670ec3f288  x86_64-w64-mingw32/bitcoin-4e069f7589da-win-unsigned.tar.gz\r\nfab76a836dcc592e39c04fd2396696633fb6eb56e39ecbf6c909bd173ed4280c  x86_64-w64-mingw32/bitcoin-4e069f7589da-win64.zip\r\n```\r\n\r\nMeaning that they are valid `SHA256SUMS` files when `sha256sum --check`'d at the `guix-build-*/output` directory level\r\n\r\nWhen `guix-attest` is invoked, these `SHA256SUMS.part` files are combined and sorted (by `-k2`, `LC_ALL=C`) to create:\r\n\r\n1. `noncodesigned.SHA256SUMS` for a manifest of all non-codesigned outputs, and\r\n3. `all.SHA256SUMS` for a manifest of all outputs including non-codesigned outputs\r\n\r\nThen both files are signed, resulting in the following `guix.sigs` hierarchy:\r\n```\r\n4e069f7589da/\r\nâââ dongcarl\r\n    âââ all.SHA256SUMS\r\n    âââ all.SHA256SUMS.asc\r\n    âââ noncodesigned.SHA256SUMS\r\n    âââ noncodesigned.SHA256SUMS.asc\r\n```\r\n\r\n",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 0,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22182/comments",
   "created_at" : "2021-06-07T19:28:53Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22182/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/22182",
   "id" : 913888780,
   "labels" : [],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22182/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDExOlB1bGxSZXF1ZXN0NjYzODU3MTIz",
   "number" : 22182,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/22182.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22182",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/22182.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22182"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "guix: Overhaul how guix-{attest,verify} works and hierarchy",
   "updated_at" : "2021-06-07T19:38:15Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22182",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
      "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
      "followers_url" : "https://api.github.com/users/dongcarl/followers",
      "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/dongcarl",
      "id" : 3445290,
      "login" : "dongcarl",
      "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
      "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
      "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
      "repos_url" : "https://api.github.com/users/dongcarl/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/dongcarl"
   }
}
