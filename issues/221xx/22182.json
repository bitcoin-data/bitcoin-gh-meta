{
   "active_lock_reason" : "resolved",
   "assignee" : null,
   "assignees" : [],
   "author_association" : "MEMBER",
   "body" : "Based on:  #22075\r\nCode reviewers: I recommend reading the new `guix-{attest,verify}` files instead of trying to read the diff\r\n\r\nThe following changes resolve many usability improvements which were pointed out to me:\r\n1. Some maintainers like to extract their \"uncodesigned tarball\" inside the `output/` directory, resulting in the older `guix-attest` mistakenly attesting to the extracted contents\r\n2. Maintainers whose GPG keys reside on an external smartcard often need to physically interact with the smartcard as a way to approve the signing operation, having one signature per platform means a lot of fidgeting\r\n3. Maintainers wishing to sign on a separate machine now has the option of transferring only a subtree of `output/`, namely `output/*/SHA256SUMS.part`, in order to perform a signature (you may need to specify an `$OUTDIR_BASE` env var)\r\n4. An `all.SHA256SUMS` file should be usable as the base `SHA256SUMS` in bitcoin core torrents and on the release server.\r\n\r\nFor those who sign on an separate machine than the one you do builds on, the following steps will work:\r\n1. `env GUIX_SIGS_REPO=/home/achow101/guix.sigs SIGNER=achow101 NO_SIGN=1 ./contrib/guix/guix-attest`\r\n2. Copy `/home/achow101/guix.sigs/<tag>/achow101` (which does not yet have signatures) to signing machine\r\n3. Sign the `SHA256SUMS` files:\r\n    ```bash\r\n    for i in \"<path-to-achow101>/*.SHA256SUMS\"; do\r\n        gpg --detach-sign --local-user \"<your-key-here>\" --armor --output \"$i\"{.asc,}\r\n    done\r\n    ```\r\n5. Upload `<path-to-achow101>` (now with signatures) to `guix.sigs`\r\n\r\n-----\r\n\r\nAfter this change, output directories will now include a `SHA256SUMS.part` fragment, created immediately after a successful build:\r\n```\r\noutput\r\nâââ x86_64-w64-mingw32\r\n    âââ bitcoin-4e069f7589da-win64-debug.zip\r\n    âââ bitcoin-4e069f7589da-win64-setup-unsigned.exe\r\n    âââ bitcoin-4e069f7589da-win64.zip\r\n    âââ bitcoin-4e069f7589da-win-unsigned.tar.gz\r\n    âââ SHA256SUMS.part\r\n```\r\n\r\nThese `SHA256SUMS.part` fragments look something like:\r\n```\r\n3ebd7262b1a0a5bb757fef1f70e7e14033c70f98c059bc4dbfee5d1992b25825  dist-archive/bitcoin-4e069f7589da.tar.gz\r\ndef2e7d3de5ab3e3f955344e75151df4f33713f9101f5295bd13c9375bdf633b  x86_64-w64-mingw32/bitcoin-4e069f7589da-win64-debug.zip\r\n643049fe3ee4a4e83a1739607e67b11b7c9b1a66208a6f35a9ff634ba795500e  x86_64-w64-mingw32/bitcoin-4e069f7589da-win64-setup-unsigned.exe\r\na247a1ccec0ccc2e138c648284bd01f6a761f2d8d6d07d91b5b4a6670ec3f288  x86_64-w64-mingw32/bitcoin-4e069f7589da-win-unsigned.tar.gz\r\nfab76a836dcc592e39c04fd2396696633fb6eb56e39ecbf6c909bd173ed4280c  x86_64-w64-mingw32/bitcoin-4e069f7589da-win64.zip\r\n```\r\n\r\nMeaning that they are valid `SHA256SUMS` files when `sha256sum --check`'d at the `guix-build-*/output` directory level\r\n\r\nWhen `guix-attest` is invoked, these `SHA256SUMS.part` files are combined and sorted (by `-k2`, `LC_ALL=C`) to create:\r\n\r\n1. `noncodesigned.SHA256SUMS` for a manifest of all non-codesigned outputs, and\r\n3. `all.SHA256SUMS` for a manifest of all outputs including non-codesigned outputs\r\n\r\nThen both files are signed, resulting in the following `guix.sigs` hierarchy:\r\n```\r\n4e069f7589da/\r\nâââ dongcarl\r\n    âââ all.SHA256SUMS\r\n    âââ all.SHA256SUMS.asc\r\n    âââ noncodesigned.SHA256SUMS\r\n    âââ noncodesigned.SHA256SUMS.asc\r\n```\r\n\r\n",
   "closed_at" : "2021-06-17T05:10:57Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
      "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
      "followers_url" : "https://api.github.com/users/fanquake/followers",
      "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/fanquake",
      "id" : 863730,
      "login" : "fanquake",
      "node_id" : "MDQ6VXNlcjg2MzczMA==",
      "organizations_url" : "https://api.github.com/users/fanquake/orgs",
      "received_events_url" : "https://api.github.com/users/fanquake/received_events",
      "repos_url" : "https://api.github.com/users/fanquake/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/fanquake"
   },
   "comments" : 13,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22182/comments",
   "created_at" : "2021-06-07T19:28:53Z",
   "draft" : false,
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22182/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/22182",
   "id" : 913888780,
   "labels" : [
      {
         "color" : "ffffee",
         "default" : false,
         "description" : null,
         "id" : 231994551,
         "name" : "Scripts and tools",
         "node_id" : "MDU6TGFiZWwyMzE5OTQ1NTE=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Scripts%20and%20tools"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22182/labels{/name}",
   "locked" : true,
   "milestone" : {
      "closed_at" : "2021-09-09T12:47:52Z",
      "closed_issues" : 124,
      "created_at" : "2020-04-25T00:14:49Z",
      "creator" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      },
      "description" : "",
      "due_on" : null,
      "html_url" : "https://github.com/bitcoin/bitcoin/milestone/47",
      "id" : 5347322,
      "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/milestones/47/labels",
      "node_id" : "MDk6TWlsZXN0b25lNTM0NzMyMg==",
      "number" : 47,
      "open_issues" : 0,
      "state" : "closed",
      "title" : "22.0",
      "updated_at" : "2021-09-14T07:16:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/milestones/47"
   },
   "node_id" : "MDExOlB1bGxSZXF1ZXN0NjYzODU3MTIz",
   "number" : 22182,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/22182.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22182",
      "merged_at" : "2021-06-17T05:10:56Z",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/22182.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22182"
   },
   "reactions" : {
      "+1" : 1,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 2,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 3,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22182/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "state_reason" : null,
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22182/timeline",
   "title" : "guix: Overhaul how guix-{attest,verify} works and hierarchy",
   "updated_at" : "2022-08-18T18:31:31Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22182",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
      "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
      "followers_url" : "https://api.github.com/users/dongcarl/followers",
      "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/dongcarl",
      "id" : 3445290,
      "login" : "dongcarl",
      "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
      "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
      "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
      "repos_url" : "https://api.github.com/users/dongcarl/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/dongcarl"
   }
}
