[
   {
      "author_association" : "MEMBER",
      "body" : "The gains are quite impressive!\r\n\r\nThat said, this does make the code longer and quite a bit more complicated.\r\n\r\nWhat motivated you to optimize this specifically? Are you experiencing any behavior where decoding / encoding Base58 is in the critical path?",
      "created_at" : "2021-02-15T07:41:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21176#issuecomment-779019128",
      "id" : 779019128,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21176",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3OTAxOTEyOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-15T07:41:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/779019128",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "In my tool [BitcoinUtxoVisualizer](https://github.com/martinus/BitcoinUtxoVisualizer) I am basically limited by the speed of how fast bitcoind can send me JSON block data. While profiling I saw `EncodeBase58` quite a few times so I had a look at it. It's about 2% faster or so with that change.\r\n\r\nSo for my use case honestly this change is probably not worth it. There are other much more important changes, e.g. #21006. But I saw @promag's PR #7656 so having a faster Base58 encoding might be worthwhile for others? If not, feel free to decline the PR, I'm perfectly fine with that!",
      "created_at" : "2021-02-15T07:55:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21176#issuecomment-779027171",
      "id" : 779027171,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21176",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3OTAyNzE3MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-15T07:55:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/779027171",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> In my tool BitcoinUtxoVisualizer I am basically limited by the speed of how fast bitcoind can send me JSON block data\r\n\r\nThanks, that makes sense.\r\n\r\n> might be worthwhile for others? If not, feel free to decline the PR, I'm perfectly fine with that!\r\n\r\nI'll leave that to others. If this can get enough review I'm fully okay with it! I'm not really declining this, my point was only that \"reviewable straightforward code\" is important from a security perspective and this sometimes trumps pure performance (depending on the part of the code). Especially in a memory-unsafe language like C++ where it's so easy to reach outside a buffer. We've had some discussions about this in the past when Base58 seemed to attract a lot of pretty arbitrary \"make it faster\" changes. At least you're doing proper benchmarking.",
      "created_at" : "2021-02-15T08:13:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21176#issuecomment-779038255",
      "id" : 779038255,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21176",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3OTAzODI1NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-15T08:13:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/779038255",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Personally I find the existing version in `master` easier to reason about.\r\n\r\nI tend to prefer \"dumb and easy to reason about\" over \"cleverly optimised but harder to reason about\" in code that is not performance critical (as seen from a macro level).\r\n\r\nI don't mean to be boring: this is a clever optimization. I'm just afraid it might remove the \"trivially correct\" property of the code it optimizes :)\r\n\r\n@martinus, out of curiosity: have you looked anything at profiling IBD in search of optimization opportunities?",
      "created_at" : "2021-02-15T11:01:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21176#issuecomment-779143444",
      "id" : 779143444,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21176",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3OTE0MzQ0NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-15T11:05:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/779143444",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I agree the existing version is easier to read. I did not look at IBD at all, are there still improvements to be done there? It seemed to me that it's already well optimized.\r\n\r\nI mostly profiled fetching JSON block data. The biggest optimization opportunity for this is reducing the global lock, and making univalue faster.",
      "created_at" : "2021-02-15T12:03:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21176#issuecomment-779177583",
      "id" : 779177583,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21176",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3OTE3NzU4Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-15T12:03:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/779177583",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Closing, as it's not performance relevant but critical code so more complexity is bad. Thanks for having a look!",
      "created_at" : "2021-02-17T10:02:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21176#issuecomment-780443888",
      "id" : 780443888,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21176",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc4MDQ0Mzg4OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-17T10:02:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/780443888",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   }
]
