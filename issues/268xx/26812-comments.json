[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#27491](https://github.com/bitcoin/bitcoin/pull/27491) (refactor: Move chain constants to the util library by TheCharlatan)\n* [#27476](https://github.com/bitcoin/bitcoin/pull/27476) (mempool: keep CPFP'd transactions when loading from mempool.dat by glozow)\n* [#27469](https://github.com/bitcoin/bitcoin/pull/27469) (wallet: improve IBD sync time by skipping block scanning prior birth time by furszy)\n* [#27385](https://github.com/bitcoin/bitcoin/pull/27385) (net, refactor: extract Network and BIP155Network logic to node/network by jonatack)\n* [#26933](https://github.com/bitcoin/bitcoin/pull/26933) (mempool: disallow txns under min relay fee, even in packages by glozow)\n* [#26711](https://github.com/bitcoin/bitcoin/pull/26711) (validate package transactions with their in-package ancestor sets by glozow)\n* [#26403](https://github.com/bitcoin/bitcoin/pull/26403) ([POLICY] Ephemeral anchors by instagibbs)\n* [#26312](https://github.com/bitcoin/bitcoin/pull/26312) (Remove Sock::Get() and Sock::Sock() by vasild)\n* [#25908](https://github.com/bitcoin/bitcoin/pull/25908) (p2p: remove adjusted time by fanquake)\n* [#25572](https://github.com/bitcoin/bitcoin/pull/25572) (refactor: Introduce EvictionManager and use it for the inbound eviction logic by dergoegge)\n* [#25268](https://github.com/bitcoin/bitcoin/pull/25268) (refactor: Introduce EvictionManager by dergoegge)\n* [#25038](https://github.com/bitcoin/bitcoin/pull/25038) (policy: nVersion=3 and Package RBF by glozow)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-01-04T14:39:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26812#issuecomment-1371011959",
      "id" : 1371011959,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26812",
      "node_id" : "IC_kwDOABII585Rt_t3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1371011959/reactions"
      },
      "updated_at" : "2023-04-21T13:50:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1371011959",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26812#discussion_r1061551756"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26812"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1061551756"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This is inspired by https://github.com/bitcoin/bitcoin/pull/25515",
      "commit_id" : "9b7e9dad271167af913828aaf3b75a9942770a34",
      "created_at" : "2023-01-04T14:41:02Z",
      "diff_hunk" : "@@ -0,0 +1,183 @@\n+// Copyright (c) 2022-2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <net_processing.h>\n+#include <netaddress.h>\n+#include <protocol.h>\n+#include <test/util/logging.h>\n+#include <test/util/net.h>\n+#include <test/util/setup_common.h>\n+#include <util/time.h>\n+#include <version.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+#include <chrono>\n+#include <string>\n+#include <unordered_map>\n+\n+BOOST_FIXTURE_TEST_SUITE(netmsg_tests, NetTestingSetup)\n+\n+BOOST_AUTO_TEST_CASE(initial_messages_exchange)\n+{\n+    std::unordered_map<std::string, size_t> count_sent_messages;\n+    auto pipes = m_sockets_pipes.PopFront();\n+\n+    // Wait for all messages due to the initial handshake to be Send() to the socket.\n+    // The FEEFILTER is the last one, so quit when we get that.\n+    for (;;) {\n+        auto msg = pipes->send.GetNetMsg();\n+        if (msg.has_value()) {\n+            count_sent_messages[msg->m_type]++;\n+            if (msg->m_type == NetMsgType::FEEFILTER) {\n+                break;\n+            }\n+        } else {\n+            break;\n+        }\n+    }\n+\n+    BOOST_CHECK_EQUAL(count_sent_messages[NetMsgType::VERSION], 1);\n+    BOOST_CHECK_EQUAL(count_sent_messages[NetMsgType::WTXIDRELAY], 1);\n+    BOOST_CHECK_EQUAL(count_sent_messages[NetMsgType::SENDADDRV2], 1);\n+    BOOST_CHECK_EQUAL(count_sent_messages[NetMsgType::VERACK], 1);\n+    BOOST_CHECK_EQUAL(count_sent_messages[NetMsgType::GETADDR], 1);\n+    BOOST_CHECK_EQUAL(count_sent_messages[NetMsgType::SENDCMPCT], 1);\n+    BOOST_CHECK_EQUAL(count_sent_messages[NetMsgType::PING], 1);\n+    BOOST_CHECK_EQUAL(count_sent_messages[NetMsgType::GETHEADERS], 1);\n+    BOOST_CHECK_EQUAL(count_sent_messages[NetMsgType::FEEFILTER], 1);\n+}\n+\n+BOOST_AUTO_TEST_CASE(addr)\n+{\n+    auto pipes = m_sockets_pipes.PopFront();\n+    std::vector<CAddress> addresses{5};\n+\n+    DebugLogHelper debug_log{strprintf(\"Received addr: %u addresses\", addresses.size())};\n+    pipes->recv.PushNetMsg(NetMsgType::ADDRV2, addresses);\n+    debug_log.EndAndThrowIfNotFound(30s);\n+}\n+\n+BOOST_AUTO_TEST_CASE(getblocks)\n+{\n+    auto pipes = m_sockets_pipes.PopFront();\n+    std::vector<uint256> hashes{5};\n+    CBlockLocator block_locator{std::move(hashes)};\n+    uint256 hash_stop;\n+\n+    DebugLogHelper debug_log{\"getblocks -1 to end\"};\n+    pipes->recv.PushNetMsg(NetMsgType::GETBLOCKS, block_locator, hash_stop);\n+    debug_log.EndAndThrowIfNotFound(30s);\n+}\n+\n+BOOST_AUTO_TEST_CASE(ping)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26812#discussion_r1061551756",
      "id" : 1061551756,
      "line" : 74,
      "node_id" : "PRRC_kwDOABII584_Rf6M",
      "original_commit_id" : "9b7e9dad271167af913828aaf3b75a9942770a34",
      "original_line" : 74,
      "original_position" : 74,
      "original_start_line" : null,
      "path" : "src/test/netmsg_tests.cpp",
      "position" : 74,
      "pull_request_review_id" : 1235986976,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26812",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1061551756/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-04T14:46:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1061551756",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26812#discussion_r1061557476"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26812"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1061557476"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This is duplicated from `src/test/fuzz/process_message.cpp`. It should be deduplicated by putting it in a common header file, but I wonder if the new tests in `fuzz/netmsg.cpp` make the tests from `fuzz/process_message.cpp` and `fuzz/process_messages.cpp` obsolete and whether the latter should be removed. @MarcoFalke, as the author of `process_message[s]`, what do you think?",
      "commit_id" : "9b7e9dad271167af913828aaf3b75a9942770a34",
      "created_at" : "2023-01-04T14:46:19Z",
      "diff_hunk" : "@@ -0,0 +1,140 @@\n+// Copyright (c) 2020-2023 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <banman.h>\n+#include <blockencodings.h>\n+#include <consensus/consensus.h>\n+#include <protocol.h>\n+#include <streams.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/mining.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/validation.h>\n+#include <util/check.h>\n+#include <util/time.h>\n+#include <validationinterface.h>\n+\n+#include <chrono>\n+#include <string>\n+#include <thread>\n+\n+namespace {\n+NetTestingSetup* g_setup;\n+} // namespace\n+\n+static size_t& GetNumMsgTypes()\n+{\n+    static size_t g_num_msg_types{0};\n+    return g_num_msg_types;\n+}\n+#define FUZZ_TARGET_MSG(msg_type)                          \\\n+    struct msg_type##CountBeforeMain {                     \\\n+        msg_type##CountBeforeMain()                        \\\n+        {                                                  \\\n+            ++GetNumMsgTypes();                            \\\n+        }                                                  \\\n+    } const static g_##msg_type##count_before_main;        \\\n+    FUZZ_TARGET_INIT(netmsg_##msg_type, initialize_netmsg) \\\n+    {                                                      \\\n+        fuzz_target(buffer, #msg_type);                    \\\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26812#discussion_r1061557476",
      "id" : 1061557476,
      "line" : 43,
      "node_id" : "PRRC_kwDOABII584_RhTk",
      "original_commit_id" : "9b7e9dad271167af913828aaf3b75a9942770a34",
      "original_line" : 43,
      "original_position" : 43,
      "original_start_line" : 28,
      "path" : "src/test/fuzz/netmsg.cpp",
      "position" : 43,
      "pull_request_review_id" : 1235986976,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26812",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1061557476/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 28,
      "start_side" : "RIGHT",
      "updated_at" : "2023-01-04T14:46:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1061557476",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26812#discussion_r1061884646"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26812"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1061884646"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Key difference in #25515 is that it is testing net processing in isolation (at least isolated from CConnman), which imo is something we definitely should be doing. We already have e2e tests i.e. the functional tests, so I don't see the benefit to your approach here (besides the c++ tests being faster than the python ones).",
      "commit_id" : "9b7e9dad271167af913828aaf3b75a9942770a34",
      "created_at" : "2023-01-04T21:08:42Z",
      "diff_hunk" : "@@ -0,0 +1,183 @@\n+// Copyright (c) 2022-2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <net_processing.h>\n+#include <netaddress.h>\n+#include <protocol.h>\n+#include <test/util/logging.h>\n+#include <test/util/net.h>\n+#include <test/util/setup_common.h>\n+#include <util/time.h>\n+#include <version.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+#include <chrono>\n+#include <string>\n+#include <unordered_map>\n+\n+BOOST_FIXTURE_TEST_SUITE(netmsg_tests, NetTestingSetup)\n+\n+BOOST_AUTO_TEST_CASE(initial_messages_exchange)\n+{\n+    std::unordered_map<std::string, size_t> count_sent_messages;\n+    auto pipes = m_sockets_pipes.PopFront();\n+\n+    // Wait for all messages due to the initial handshake to be Send() to the socket.\n+    // The FEEFILTER is the last one, so quit when we get that.\n+    for (;;) {\n+        auto msg = pipes->send.GetNetMsg();\n+        if (msg.has_value()) {\n+            count_sent_messages[msg->m_type]++;\n+            if (msg->m_type == NetMsgType::FEEFILTER) {\n+                break;\n+            }\n+        } else {\n+            break;\n+        }\n+    }\n+\n+    BOOST_CHECK_EQUAL(count_sent_messages[NetMsgType::VERSION], 1);\n+    BOOST_CHECK_EQUAL(count_sent_messages[NetMsgType::WTXIDRELAY], 1);\n+    BOOST_CHECK_EQUAL(count_sent_messages[NetMsgType::SENDADDRV2], 1);\n+    BOOST_CHECK_EQUAL(count_sent_messages[NetMsgType::VERACK], 1);\n+    BOOST_CHECK_EQUAL(count_sent_messages[NetMsgType::GETADDR], 1);\n+    BOOST_CHECK_EQUAL(count_sent_messages[NetMsgType::SENDCMPCT], 1);\n+    BOOST_CHECK_EQUAL(count_sent_messages[NetMsgType::PING], 1);\n+    BOOST_CHECK_EQUAL(count_sent_messages[NetMsgType::GETHEADERS], 1);\n+    BOOST_CHECK_EQUAL(count_sent_messages[NetMsgType::FEEFILTER], 1);\n+}\n+\n+BOOST_AUTO_TEST_CASE(addr)\n+{\n+    auto pipes = m_sockets_pipes.PopFront();\n+    std::vector<CAddress> addresses{5};\n+\n+    DebugLogHelper debug_log{strprintf(\"Received addr: %u addresses\", addresses.size())};\n+    pipes->recv.PushNetMsg(NetMsgType::ADDRV2, addresses);\n+    debug_log.EndAndThrowIfNotFound(30s);\n+}\n+\n+BOOST_AUTO_TEST_CASE(getblocks)\n+{\n+    auto pipes = m_sockets_pipes.PopFront();\n+    std::vector<uint256> hashes{5};\n+    CBlockLocator block_locator{std::move(hashes)};\n+    uint256 hash_stop;\n+\n+    DebugLogHelper debug_log{\"getblocks -1 to end\"};\n+    pipes->recv.PushNetMsg(NetMsgType::GETBLOCKS, block_locator, hash_stop);\n+    debug_log.EndAndThrowIfNotFound(30s);\n+}\n+\n+BOOST_AUTO_TEST_CASE(ping)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26812#discussion_r1061884646",
      "id" : 1061884646,
      "in_reply_to_id" : 1061551756,
      "line" : 74,
      "node_id" : "PRRC_kwDOABII584_SxLm",
      "original_commit_id" : "9b7e9dad271167af913828aaf3b75a9942770a34",
      "original_line" : 74,
      "original_position" : 74,
      "original_start_line" : null,
      "path" : "src/test/netmsg_tests.cpp",
      "position" : 74,
      "pull_request_review_id" : 1236481487,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26812",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1061884646/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-04T22:09:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1061884646",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26812#discussion_r1061894472"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26812"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1061894472"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This target is averaging 2 execs/s on my machine. A good target should average a 1000 execs/s (https://github.com/google/fuzzing/blob/master/docs/good-fuzz-target.md#speed).\r\n\r\nI don't quite see the upside of this target over the `process_message(s)` targets. It might be able to find additional bugs if run with ThreadSanitizer but the current performance is gonna stop it from doing so effectively.\r\n\r\nFuzzing is particularly effective when the targets are kept narrow. For example: fuzzing net, net processing, validation or any of their sub components (e.g. TxRequestTracker or AddrMan) in isolation makes sense but all of it together will be inefficient.",
      "commit_id" : "9b7e9dad271167af913828aaf3b75a9942770a34",
      "created_at" : "2023-01-04T21:24:39Z",
      "diff_hunk" : "@@ -0,0 +1,140 @@\n+// Copyright (c) 2020-2023 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <banman.h>\n+#include <blockencodings.h>\n+#include <consensus/consensus.h>\n+#include <protocol.h>\n+#include <streams.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/mining.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/validation.h>\n+#include <util/check.h>\n+#include <util/time.h>\n+#include <validationinterface.h>\n+\n+#include <chrono>\n+#include <string>\n+#include <thread>\n+\n+namespace {\n+NetTestingSetup* g_setup;\n+} // namespace\n+\n+static size_t& GetNumMsgTypes()\n+{\n+    static size_t g_num_msg_types{0};\n+    return g_num_msg_types;\n+}\n+#define FUZZ_TARGET_MSG(msg_type)                          \\\n+    struct msg_type##CountBeforeMain {                     \\\n+        msg_type##CountBeforeMain()                        \\\n+        {                                                  \\\n+            ++GetNumMsgTypes();                            \\\n+        }                                                  \\\n+    } const static g_##msg_type##count_before_main;        \\\n+    FUZZ_TARGET_INIT(netmsg_##msg_type, initialize_netmsg) \\\n+    {                                                      \\\n+        fuzz_target(buffer, #msg_type);                    \\\n+    }\n+\n+void initialize_netmsg()\n+{\n+    Assert(GetNumMsgTypes() == getAllNetMessageTypes().size()); // If this fails, add or remove the message type below\n+\n+    static const auto testing_setup = MakeNoLogFileContext<NetTestingSetup>();\n+    g_setup = testing_setup.get();\n+    for (int i = 0; i < 2 * COINBASE_MATURITY; i++) {\n+        MineBlock(g_setup->m_node, CScript() << OP_TRUE);\n+    }\n+    SyncWithValidationInterfaceQueue();\n+}\n+\n+static void fuzz_target(FuzzBufferType buffer, const std::string& limit_to_message_type)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26812#discussion_r1061894472",
      "id" : 1061894472,
      "line" : 57,
      "node_id" : "PRRC_kwDOABII584_SzlI",
      "original_commit_id" : "9b7e9dad271167af913828aaf3b75a9942770a34",
      "original_line" : 57,
      "original_position" : 57,
      "original_start_line" : null,
      "path" : "src/test/fuzz/netmsg.cpp",
      "position" : 57,
      "pull_request_review_id" : 1236481487,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26812",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1061894472/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-04T22:09:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1061894472",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26812#discussion_r1061896055"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26812"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1061896055"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I suspect this is the main reason for the poor performance, but the additional threading also doesn't help.",
      "commit_id" : "9b7e9dad271167af913828aaf3b75a9942770a34",
      "created_at" : "2023-01-04T21:27:00Z",
      "diff_hunk" : "@@ -0,0 +1,140 @@\n+// Copyright (c) 2020-2023 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <banman.h>\n+#include <blockencodings.h>\n+#include <consensus/consensus.h>\n+#include <protocol.h>\n+#include <streams.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/mining.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/validation.h>\n+#include <util/check.h>\n+#include <util/time.h>\n+#include <validationinterface.h>\n+\n+#include <chrono>\n+#include <string>\n+#include <thread>\n+\n+namespace {\n+NetTestingSetup* g_setup;\n+} // namespace\n+\n+static size_t& GetNumMsgTypes()\n+{\n+    static size_t g_num_msg_types{0};\n+    return g_num_msg_types;\n+}\n+#define FUZZ_TARGET_MSG(msg_type)                          \\\n+    struct msg_type##CountBeforeMain {                     \\\n+        msg_type##CountBeforeMain()                        \\\n+        {                                                  \\\n+            ++GetNumMsgTypes();                            \\\n+        }                                                  \\\n+    } const static g_##msg_type##count_before_main;        \\\n+    FUZZ_TARGET_INIT(netmsg_##msg_type, initialize_netmsg) \\\n+    {                                                      \\\n+        fuzz_target(buffer, #msg_type);                    \\\n+    }\n+\n+void initialize_netmsg()\n+{\n+    Assert(GetNumMsgTypes() == getAllNetMessageTypes().size()); // If this fails, add or remove the message type below\n+\n+    static const auto testing_setup = MakeNoLogFileContext<NetTestingSetup>();\n+    g_setup = testing_setup.get();\n+    for (int i = 0; i < 2 * COINBASE_MATURITY; i++) {\n+        MineBlock(g_setup->m_node, CScript() << OP_TRUE);\n+    }\n+    SyncWithValidationInterfaceQueue();\n+}\n+\n+static void fuzz_target(FuzzBufferType buffer, const std::string& limit_to_message_type)\n+{\n+    FuzzedDataProvider fuzzed_data_provider(buffer.data(), buffer.size());\n+\n+    g_setup->m_node.banman->TestOnlyReset();\n+\n+    // Addrman and CConnman deprioritize addresses tried in the last 10min. Avoid that since\n+    // our addrman has very few addresses.\n+    SetMockTime(GetMockTime() + std::chrono::minutes{\n+                                    fuzzed_data_provider.ConsumeIntegralInRange<uint8_t>(11, 255)});\n+\n+    auto pipes = g_setup->m_sockets_pipes.PopFront();\n+\n+    uint8_t buf[1024];\n+\n+    LIMITED_WHILE(fuzzed_data_provider.remaining_bytes() > 0, 100) {\n+\n+        const std::string message_type =\n+            limit_to_message_type.empty() ?\n+                fuzzed_data_provider.ConsumeBytesAsString(CMessageHeader::COMMAND_SIZE) :\n+                limit_to_message_type;\n+\n+        CDataStream payload{\n+            ConsumeRandomLengthByteVector(fuzzed_data_provider), SER_NETWORK, PROTOCOL_VERSION};\n+\n+        pipes->recv.PushNetMsg(message_type, payload);\n+\n+        if (pipes->send.GetBytes(buf, sizeof(buf)) == 0) { // EOF, the socket has been closed.\n+            return;\n+        }\n+    }\n+\n+    TestChainState& chainstate = *static_cast<TestChainState*>(&g_setup->m_node.chainman->ActiveChainstate());\n+\n+    // Force a disconnect and wait for it.\n+    for (;;) {\n+        // Push a message that will cause a disconnect and socket closure (EOF on the Send() pipe).\n+        pipes->recv.PushNetMsg(\n+            NetMsgType::GETBLOCKTXN,\n+            BlockTransactionsRequest{.blockhash = chainstate.m_chain.Tip()->GetBlockHash(),\n+                                     .indexes = {1, UINT16_MAX}});\n+        if (pipes->send.GetBytes(buf, sizeof(buf)) == 0) {\n+            break;\n+        }\n+        std::this_thread::sleep_for(50ms);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26812#discussion_r1061896055",
      "id" : 1061896055,
      "line" : 101,
      "node_id" : "PRRC_kwDOABII584_Sz93",
      "original_commit_id" : "9b7e9dad271167af913828aaf3b75a9942770a34",
      "original_line" : 101,
      "original_position" : 101,
      "original_start_line" : null,
      "path" : "src/test/fuzz/netmsg.cpp",
      "position" : 101,
      "pull_request_review_id" : 1236481487,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26812",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1061896055/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-04T22:09:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1061896055",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26812#discussion_r1061896936"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26812"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1061896936"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this is missing a call to `SyncWithValidationInterfaceQueue` here.",
      "commit_id" : "9b7e9dad271167af913828aaf3b75a9942770a34",
      "created_at" : "2023-01-04T21:28:10Z",
      "diff_hunk" : "@@ -0,0 +1,140 @@\n+// Copyright (c) 2020-2023 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <banman.h>\n+#include <blockencodings.h>\n+#include <consensus/consensus.h>\n+#include <protocol.h>\n+#include <streams.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/mining.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/validation.h>\n+#include <util/check.h>\n+#include <util/time.h>\n+#include <validationinterface.h>\n+\n+#include <chrono>\n+#include <string>\n+#include <thread>\n+\n+namespace {\n+NetTestingSetup* g_setup;\n+} // namespace\n+\n+static size_t& GetNumMsgTypes()\n+{\n+    static size_t g_num_msg_types{0};\n+    return g_num_msg_types;\n+}\n+#define FUZZ_TARGET_MSG(msg_type)                          \\\n+    struct msg_type##CountBeforeMain {                     \\\n+        msg_type##CountBeforeMain()                        \\\n+        {                                                  \\\n+            ++GetNumMsgTypes();                            \\\n+        }                                                  \\\n+    } const static g_##msg_type##count_before_main;        \\\n+    FUZZ_TARGET_INIT(netmsg_##msg_type, initialize_netmsg) \\\n+    {                                                      \\\n+        fuzz_target(buffer, #msg_type);                    \\\n+    }\n+\n+void initialize_netmsg()\n+{\n+    Assert(GetNumMsgTypes() == getAllNetMessageTypes().size()); // If this fails, add or remove the message type below\n+\n+    static const auto testing_setup = MakeNoLogFileContext<NetTestingSetup>();\n+    g_setup = testing_setup.get();\n+    for (int i = 0; i < 2 * COINBASE_MATURITY; i++) {\n+        MineBlock(g_setup->m_node, CScript() << OP_TRUE);\n+    }\n+    SyncWithValidationInterfaceQueue();\n+}\n+\n+static void fuzz_target(FuzzBufferType buffer, const std::string& limit_to_message_type)\n+{\n+    FuzzedDataProvider fuzzed_data_provider(buffer.data(), buffer.size());\n+\n+    g_setup->m_node.banman->TestOnlyReset();\n+\n+    // Addrman and CConnman deprioritize addresses tried in the last 10min. Avoid that since\n+    // our addrman has very few addresses.\n+    SetMockTime(GetMockTime() + std::chrono::minutes{\n+                                    fuzzed_data_provider.ConsumeIntegralInRange<uint8_t>(11, 255)});\n+\n+    auto pipes = g_setup->m_sockets_pipes.PopFront();\n+\n+    uint8_t buf[1024];\n+\n+    LIMITED_WHILE(fuzzed_data_provider.remaining_bytes() > 0, 100) {\n+\n+        const std::string message_type =\n+            limit_to_message_type.empty() ?\n+                fuzzed_data_provider.ConsumeBytesAsString(CMessageHeader::COMMAND_SIZE) :\n+                limit_to_message_type;\n+\n+        CDataStream payload{\n+            ConsumeRandomLengthByteVector(fuzzed_data_provider), SER_NETWORK, PROTOCOL_VERSION};\n+\n+        pipes->recv.PushNetMsg(message_type, payload);\n+\n+        if (pipes->send.GetBytes(buf, sizeof(buf)) == 0) { // EOF, the socket has been closed.\n+            return;\n+        }\n+    }\n+\n+    TestChainState& chainstate = *static_cast<TestChainState*>(&g_setup->m_node.chainman->ActiveChainstate());\n+\n+    // Force a disconnect and wait for it.\n+    for (;;) {\n+        // Push a message that will cause a disconnect and socket closure (EOF on the Send() pipe).\n+        pipes->recv.PushNetMsg(\n+            NetMsgType::GETBLOCKTXN,\n+            BlockTransactionsRequest{.blockhash = chainstate.m_chain.Tip()->GetBlockHash(),\n+                                     .indexes = {1, UINT16_MAX}});\n+        if (pipes->send.GetBytes(buf, sizeof(buf)) == 0) {\n+            break;\n+        }\n+        std::this_thread::sleep_for(50ms);\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26812#discussion_r1061896936",
      "id" : 1061896936,
      "line" : 102,
      "node_id" : "PRRC_kwDOABII584_S0Lo",
      "original_commit_id" : "9b7e9dad271167af913828aaf3b75a9942770a34",
      "original_line" : 102,
      "original_position" : 102,
      "original_start_line" : null,
      "path" : "src/test/fuzz/netmsg.cpp",
      "position" : 102,
      "pull_request_review_id" : 1236481487,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26812",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1061896936/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-04T22:09:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1061896936",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`9b7e9dad27...daee83c1c5`: optimize the fuzz test a bit",
      "created_at" : "2023-01-12T14:07:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26812#issuecomment-1380407070",
      "id" : 1380407070,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26812",
      "node_id" : "IC_kwDOABII585SR1ce",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1380407070/reactions"
      },
      "updated_at" : "2023-01-12T14:07:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1380407070",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26812#discussion_r1068176623"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26812"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1068176623"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, both testing in isolation and e2e is good to have. The difference between the tests included in this PR and the functional tests is that when the test code runs inside the same process:\r\n\r\n* it has greater control and observability - the test can read any global or member variable and can call arbitrary functions \r\n* it can do fuzzing\r\n\r\nI think all those tests are complementary, not mutually exclusive.",
      "commit_id" : "32ab679f54a4f36cc315d0bd36638b7942f752f6",
      "created_at" : "2023-01-12T14:16:57Z",
      "diff_hunk" : "@@ -0,0 +1,183 @@\n+// Copyright (c) 2022-2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <net_processing.h>\n+#include <netaddress.h>\n+#include <protocol.h>\n+#include <test/util/logging.h>\n+#include <test/util/net.h>\n+#include <test/util/setup_common.h>\n+#include <util/time.h>\n+#include <version.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+#include <chrono>\n+#include <string>\n+#include <unordered_map>\n+\n+BOOST_FIXTURE_TEST_SUITE(netmsg_tests, NetTestingSetup)\n+\n+BOOST_AUTO_TEST_CASE(initial_messages_exchange)\n+{\n+    std::unordered_map<std::string, size_t> count_sent_messages;\n+    auto pipes = m_sockets_pipes.PopFront();\n+\n+    // Wait for all messages due to the initial handshake to be Send() to the socket.\n+    // The FEEFILTER is the last one, so quit when we get that.\n+    for (;;) {\n+        auto msg = pipes->send.GetNetMsg();\n+        if (msg.has_value()) {\n+            count_sent_messages[msg->m_type]++;\n+            if (msg->m_type == NetMsgType::FEEFILTER) {\n+                break;\n+            }\n+        } else {\n+            break;\n+        }\n+    }\n+\n+    BOOST_CHECK_EQUAL(count_sent_messages[NetMsgType::VERSION], 1);\n+    BOOST_CHECK_EQUAL(count_sent_messages[NetMsgType::WTXIDRELAY], 1);\n+    BOOST_CHECK_EQUAL(count_sent_messages[NetMsgType::SENDADDRV2], 1);\n+    BOOST_CHECK_EQUAL(count_sent_messages[NetMsgType::VERACK], 1);\n+    BOOST_CHECK_EQUAL(count_sent_messages[NetMsgType::GETADDR], 1);\n+    BOOST_CHECK_EQUAL(count_sent_messages[NetMsgType::SENDCMPCT], 1);\n+    BOOST_CHECK_EQUAL(count_sent_messages[NetMsgType::PING], 1);\n+    BOOST_CHECK_EQUAL(count_sent_messages[NetMsgType::GETHEADERS], 1);\n+    BOOST_CHECK_EQUAL(count_sent_messages[NetMsgType::FEEFILTER], 1);\n+}\n+\n+BOOST_AUTO_TEST_CASE(addr)\n+{\n+    auto pipes = m_sockets_pipes.PopFront();\n+    std::vector<CAddress> addresses{5};\n+\n+    DebugLogHelper debug_log{strprintf(\"Received addr: %u addresses\", addresses.size())};\n+    pipes->recv.PushNetMsg(NetMsgType::ADDRV2, addresses);\n+    debug_log.EndAndThrowIfNotFound(30s);\n+}\n+\n+BOOST_AUTO_TEST_CASE(getblocks)\n+{\n+    auto pipes = m_sockets_pipes.PopFront();\n+    std::vector<uint256> hashes{5};\n+    CBlockLocator block_locator{std::move(hashes)};\n+    uint256 hash_stop;\n+\n+    DebugLogHelper debug_log{\"getblocks -1 to end\"};\n+    pipes->recv.PushNetMsg(NetMsgType::GETBLOCKS, block_locator, hash_stop);\n+    debug_log.EndAndThrowIfNotFound(30s);\n+}\n+\n+BOOST_AUTO_TEST_CASE(ping)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26812#discussion_r1068176623",
      "id" : 1068176623,
      "in_reply_to_id" : 1061551756,
      "line" : 74,
      "node_id" : "PRRC_kwDOABII584_qxTv",
      "original_commit_id" : "9b7e9dad271167af913828aaf3b75a9942770a34",
      "original_line" : 74,
      "original_position" : 74,
      "original_start_line" : null,
      "path" : "src/test/netmsg_tests.cpp",
      "position" : 74,
      "pull_request_review_id" : 1245688508,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26812",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1068176623/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-12T14:16:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1068176623",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26812#discussion_r1068182302"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26812"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1068182302"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Pushed an improvement that changes it to about 17 exec/s, it tends to increase if the test is left to run for some time.\r\n\r\nIMO e2e fuzzing has some value.",
      "commit_id" : "32ab679f54a4f36cc315d0bd36638b7942f752f6",
      "created_at" : "2023-01-12T14:21:50Z",
      "diff_hunk" : "@@ -0,0 +1,140 @@\n+// Copyright (c) 2020-2023 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <banman.h>\n+#include <blockencodings.h>\n+#include <consensus/consensus.h>\n+#include <protocol.h>\n+#include <streams.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/mining.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/validation.h>\n+#include <util/check.h>\n+#include <util/time.h>\n+#include <validationinterface.h>\n+\n+#include <chrono>\n+#include <string>\n+#include <thread>\n+\n+namespace {\n+NetTestingSetup* g_setup;\n+} // namespace\n+\n+static size_t& GetNumMsgTypes()\n+{\n+    static size_t g_num_msg_types{0};\n+    return g_num_msg_types;\n+}\n+#define FUZZ_TARGET_MSG(msg_type)                          \\\n+    struct msg_type##CountBeforeMain {                     \\\n+        msg_type##CountBeforeMain()                        \\\n+        {                                                  \\\n+            ++GetNumMsgTypes();                            \\\n+        }                                                  \\\n+    } const static g_##msg_type##count_before_main;        \\\n+    FUZZ_TARGET_INIT(netmsg_##msg_type, initialize_netmsg) \\\n+    {                                                      \\\n+        fuzz_target(buffer, #msg_type);                    \\\n+    }\n+\n+void initialize_netmsg()\n+{\n+    Assert(GetNumMsgTypes() == getAllNetMessageTypes().size()); // If this fails, add or remove the message type below\n+\n+    static const auto testing_setup = MakeNoLogFileContext<NetTestingSetup>();\n+    g_setup = testing_setup.get();\n+    for (int i = 0; i < 2 * COINBASE_MATURITY; i++) {\n+        MineBlock(g_setup->m_node, CScript() << OP_TRUE);\n+    }\n+    SyncWithValidationInterfaceQueue();\n+}\n+\n+static void fuzz_target(FuzzBufferType buffer, const std::string& limit_to_message_type)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26812#discussion_r1068182302",
      "id" : 1068182302,
      "in_reply_to_id" : 1061894472,
      "line" : 58,
      "node_id" : "PRRC_kwDOABII584_qyse",
      "original_commit_id" : "9b7e9dad271167af913828aaf3b75a9942770a34",
      "original_line" : 58,
      "original_position" : 57,
      "original_start_line" : null,
      "path" : "src/test/fuzz/netmsg.cpp",
      "position" : 58,
      "pull_request_review_id" : 1245697308,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26812",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1068182302/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-12T14:21:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1068182302",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26812#discussion_r1068182986"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26812"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1068182986"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It wasn't but I ditched it anyway in `9b7e9dad27...daee83c1c5`.",
      "commit_id" : "32ab679f54a4f36cc315d0bd36638b7942f752f6",
      "created_at" : "2023-01-12T14:22:26Z",
      "diff_hunk" : "@@ -0,0 +1,140 @@\n+// Copyright (c) 2020-2023 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <banman.h>\n+#include <blockencodings.h>\n+#include <consensus/consensus.h>\n+#include <protocol.h>\n+#include <streams.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/mining.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/validation.h>\n+#include <util/check.h>\n+#include <util/time.h>\n+#include <validationinterface.h>\n+\n+#include <chrono>\n+#include <string>\n+#include <thread>\n+\n+namespace {\n+NetTestingSetup* g_setup;\n+} // namespace\n+\n+static size_t& GetNumMsgTypes()\n+{\n+    static size_t g_num_msg_types{0};\n+    return g_num_msg_types;\n+}\n+#define FUZZ_TARGET_MSG(msg_type)                          \\\n+    struct msg_type##CountBeforeMain {                     \\\n+        msg_type##CountBeforeMain()                        \\\n+        {                                                  \\\n+            ++GetNumMsgTypes();                            \\\n+        }                                                  \\\n+    } const static g_##msg_type##count_before_main;        \\\n+    FUZZ_TARGET_INIT(netmsg_##msg_type, initialize_netmsg) \\\n+    {                                                      \\\n+        fuzz_target(buffer, #msg_type);                    \\\n+    }\n+\n+void initialize_netmsg()\n+{\n+    Assert(GetNumMsgTypes() == getAllNetMessageTypes().size()); // If this fails, add or remove the message type below\n+\n+    static const auto testing_setup = MakeNoLogFileContext<NetTestingSetup>();\n+    g_setup = testing_setup.get();\n+    for (int i = 0; i < 2 * COINBASE_MATURITY; i++) {\n+        MineBlock(g_setup->m_node, CScript() << OP_TRUE);\n+    }\n+    SyncWithValidationInterfaceQueue();\n+}\n+\n+static void fuzz_target(FuzzBufferType buffer, const std::string& limit_to_message_type)\n+{\n+    FuzzedDataProvider fuzzed_data_provider(buffer.data(), buffer.size());\n+\n+    g_setup->m_node.banman->TestOnlyReset();\n+\n+    // Addrman and CConnman deprioritize addresses tried in the last 10min. Avoid that since\n+    // our addrman has very few addresses.\n+    SetMockTime(GetMockTime() + std::chrono::minutes{\n+                                    fuzzed_data_provider.ConsumeIntegralInRange<uint8_t>(11, 255)});\n+\n+    auto pipes = g_setup->m_sockets_pipes.PopFront();\n+\n+    uint8_t buf[1024];\n+\n+    LIMITED_WHILE(fuzzed_data_provider.remaining_bytes() > 0, 100) {\n+\n+        const std::string message_type =\n+            limit_to_message_type.empty() ?\n+                fuzzed_data_provider.ConsumeBytesAsString(CMessageHeader::COMMAND_SIZE) :\n+                limit_to_message_type;\n+\n+        CDataStream payload{\n+            ConsumeRandomLengthByteVector(fuzzed_data_provider), SER_NETWORK, PROTOCOL_VERSION};\n+\n+        pipes->recv.PushNetMsg(message_type, payload);\n+\n+        if (pipes->send.GetBytes(buf, sizeof(buf)) == 0) { // EOF, the socket has been closed.\n+            return;\n+        }\n+    }\n+\n+    TestChainState& chainstate = *static_cast<TestChainState*>(&g_setup->m_node.chainman->ActiveChainstate());\n+\n+    // Force a disconnect and wait for it.\n+    for (;;) {\n+        // Push a message that will cause a disconnect and socket closure (EOF on the Send() pipe).\n+        pipes->recv.PushNetMsg(\n+            NetMsgType::GETBLOCKTXN,\n+            BlockTransactionsRequest{.blockhash = chainstate.m_chain.Tip()->GetBlockHash(),\n+                                     .indexes = {1, UINT16_MAX}});\n+        if (pipes->send.GetBytes(buf, sizeof(buf)) == 0) {\n+            break;\n+        }\n+        std::this_thread::sleep_for(50ms);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26812#discussion_r1068182986",
      "id" : 1068182986,
      "in_reply_to_id" : 1061896055,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584_qy3K",
      "original_commit_id" : "9b7e9dad271167af913828aaf3b75a9942770a34",
      "original_line" : 101,
      "original_position" : 101,
      "original_start_line" : null,
      "path" : "src/test/fuzz/netmsg.cpp",
      "position" : null,
      "pull_request_review_id" : 1245698381,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26812",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1068182986/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-12T14:22:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1068182986",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26812#discussion_r1068185233"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26812"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1068185233"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe. I am probably missing something. Can you elaborate why it is missing a call to `SyncWithValidationInterfaceQueue()`?",
      "commit_id" : "32ab679f54a4f36cc315d0bd36638b7942f752f6",
      "created_at" : "2023-01-12T14:24:17Z",
      "diff_hunk" : "@@ -0,0 +1,140 @@\n+// Copyright (c) 2020-2023 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <banman.h>\n+#include <blockencodings.h>\n+#include <consensus/consensus.h>\n+#include <protocol.h>\n+#include <streams.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/mining.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/validation.h>\n+#include <util/check.h>\n+#include <util/time.h>\n+#include <validationinterface.h>\n+\n+#include <chrono>\n+#include <string>\n+#include <thread>\n+\n+namespace {\n+NetTestingSetup* g_setup;\n+} // namespace\n+\n+static size_t& GetNumMsgTypes()\n+{\n+    static size_t g_num_msg_types{0};\n+    return g_num_msg_types;\n+}\n+#define FUZZ_TARGET_MSG(msg_type)                          \\\n+    struct msg_type##CountBeforeMain {                     \\\n+        msg_type##CountBeforeMain()                        \\\n+        {                                                  \\\n+            ++GetNumMsgTypes();                            \\\n+        }                                                  \\\n+    } const static g_##msg_type##count_before_main;        \\\n+    FUZZ_TARGET_INIT(netmsg_##msg_type, initialize_netmsg) \\\n+    {                                                      \\\n+        fuzz_target(buffer, #msg_type);                    \\\n+    }\n+\n+void initialize_netmsg()\n+{\n+    Assert(GetNumMsgTypes() == getAllNetMessageTypes().size()); // If this fails, add or remove the message type below\n+\n+    static const auto testing_setup = MakeNoLogFileContext<NetTestingSetup>();\n+    g_setup = testing_setup.get();\n+    for (int i = 0; i < 2 * COINBASE_MATURITY; i++) {\n+        MineBlock(g_setup->m_node, CScript() << OP_TRUE);\n+    }\n+    SyncWithValidationInterfaceQueue();\n+}\n+\n+static void fuzz_target(FuzzBufferType buffer, const std::string& limit_to_message_type)\n+{\n+    FuzzedDataProvider fuzzed_data_provider(buffer.data(), buffer.size());\n+\n+    g_setup->m_node.banman->TestOnlyReset();\n+\n+    // Addrman and CConnman deprioritize addresses tried in the last 10min. Avoid that since\n+    // our addrman has very few addresses.\n+    SetMockTime(GetMockTime() + std::chrono::minutes{\n+                                    fuzzed_data_provider.ConsumeIntegralInRange<uint8_t>(11, 255)});\n+\n+    auto pipes = g_setup->m_sockets_pipes.PopFront();\n+\n+    uint8_t buf[1024];\n+\n+    LIMITED_WHILE(fuzzed_data_provider.remaining_bytes() > 0, 100) {\n+\n+        const std::string message_type =\n+            limit_to_message_type.empty() ?\n+                fuzzed_data_provider.ConsumeBytesAsString(CMessageHeader::COMMAND_SIZE) :\n+                limit_to_message_type;\n+\n+        CDataStream payload{\n+            ConsumeRandomLengthByteVector(fuzzed_data_provider), SER_NETWORK, PROTOCOL_VERSION};\n+\n+        pipes->recv.PushNetMsg(message_type, payload);\n+\n+        if (pipes->send.GetBytes(buf, sizeof(buf)) == 0) { // EOF, the socket has been closed.\n+            return;\n+        }\n+    }\n+\n+    TestChainState& chainstate = *static_cast<TestChainState*>(&g_setup->m_node.chainman->ActiveChainstate());\n+\n+    // Force a disconnect and wait for it.\n+    for (;;) {\n+        // Push a message that will cause a disconnect and socket closure (EOF on the Send() pipe).\n+        pipes->recv.PushNetMsg(\n+            NetMsgType::GETBLOCKTXN,\n+            BlockTransactionsRequest{.blockhash = chainstate.m_chain.Tip()->GetBlockHash(),\n+                                     .indexes = {1, UINT16_MAX}});\n+        if (pipes->send.GetBytes(buf, sizeof(buf)) == 0) {\n+            break;\n+        }\n+        std::this_thread::sleep_for(50ms);\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26812#discussion_r1068185233",
      "id" : 1068185233,
      "in_reply_to_id" : 1061896936,
      "line" : 96,
      "node_id" : "PRRC_kwDOABII584_qzaR",
      "original_commit_id" : "9b7e9dad271167af913828aaf3b75a9942770a34",
      "original_line" : 96,
      "original_position" : 102,
      "original_start_line" : null,
      "path" : "src/test/fuzz/netmsg.cpp",
      "position" : 96,
      "pull_request_review_id" : 1245701729,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26812",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1068185233/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-12T14:24:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1068185233",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26812#discussion_r1068191630"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26812"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1068191630"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If (in theory) it is possible to push an event on the queue, it should be handled before starting the next input. (Not sure if applicable here)",
      "commit_id" : "32ab679f54a4f36cc315d0bd36638b7942f752f6",
      "created_at" : "2023-01-12T14:29:52Z",
      "diff_hunk" : "@@ -0,0 +1,140 @@\n+// Copyright (c) 2020-2023 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <banman.h>\n+#include <blockencodings.h>\n+#include <consensus/consensus.h>\n+#include <protocol.h>\n+#include <streams.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/mining.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/validation.h>\n+#include <util/check.h>\n+#include <util/time.h>\n+#include <validationinterface.h>\n+\n+#include <chrono>\n+#include <string>\n+#include <thread>\n+\n+namespace {\n+NetTestingSetup* g_setup;\n+} // namespace\n+\n+static size_t& GetNumMsgTypes()\n+{\n+    static size_t g_num_msg_types{0};\n+    return g_num_msg_types;\n+}\n+#define FUZZ_TARGET_MSG(msg_type)                          \\\n+    struct msg_type##CountBeforeMain {                     \\\n+        msg_type##CountBeforeMain()                        \\\n+        {                                                  \\\n+            ++GetNumMsgTypes();                            \\\n+        }                                                  \\\n+    } const static g_##msg_type##count_before_main;        \\\n+    FUZZ_TARGET_INIT(netmsg_##msg_type, initialize_netmsg) \\\n+    {                                                      \\\n+        fuzz_target(buffer, #msg_type);                    \\\n+    }\n+\n+void initialize_netmsg()\n+{\n+    Assert(GetNumMsgTypes() == getAllNetMessageTypes().size()); // If this fails, add or remove the message type below\n+\n+    static const auto testing_setup = MakeNoLogFileContext<NetTestingSetup>();\n+    g_setup = testing_setup.get();\n+    for (int i = 0; i < 2 * COINBASE_MATURITY; i++) {\n+        MineBlock(g_setup->m_node, CScript() << OP_TRUE);\n+    }\n+    SyncWithValidationInterfaceQueue();\n+}\n+\n+static void fuzz_target(FuzzBufferType buffer, const std::string& limit_to_message_type)\n+{\n+    FuzzedDataProvider fuzzed_data_provider(buffer.data(), buffer.size());\n+\n+    g_setup->m_node.banman->TestOnlyReset();\n+\n+    // Addrman and CConnman deprioritize addresses tried in the last 10min. Avoid that since\n+    // our addrman has very few addresses.\n+    SetMockTime(GetMockTime() + std::chrono::minutes{\n+                                    fuzzed_data_provider.ConsumeIntegralInRange<uint8_t>(11, 255)});\n+\n+    auto pipes = g_setup->m_sockets_pipes.PopFront();\n+\n+    uint8_t buf[1024];\n+\n+    LIMITED_WHILE(fuzzed_data_provider.remaining_bytes() > 0, 100) {\n+\n+        const std::string message_type =\n+            limit_to_message_type.empty() ?\n+                fuzzed_data_provider.ConsumeBytesAsString(CMessageHeader::COMMAND_SIZE) :\n+                limit_to_message_type;\n+\n+        CDataStream payload{\n+            ConsumeRandomLengthByteVector(fuzzed_data_provider), SER_NETWORK, PROTOCOL_VERSION};\n+\n+        pipes->recv.PushNetMsg(message_type, payload);\n+\n+        if (pipes->send.GetBytes(buf, sizeof(buf)) == 0) { // EOF, the socket has been closed.\n+            return;\n+        }\n+    }\n+\n+    TestChainState& chainstate = *static_cast<TestChainState*>(&g_setup->m_node.chainman->ActiveChainstate());\n+\n+    // Force a disconnect and wait for it.\n+    for (;;) {\n+        // Push a message that will cause a disconnect and socket closure (EOF on the Send() pipe).\n+        pipes->recv.PushNetMsg(\n+            NetMsgType::GETBLOCKTXN,\n+            BlockTransactionsRequest{.blockhash = chainstate.m_chain.Tip()->GetBlockHash(),\n+                                     .indexes = {1, UINT16_MAX}});\n+        if (pipes->send.GetBytes(buf, sizeof(buf)) == 0) {\n+            break;\n+        }\n+        std::this_thread::sleep_for(50ms);\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26812#discussion_r1068191630",
      "id" : 1068191630,
      "in_reply_to_id" : 1061896936,
      "line" : 96,
      "node_id" : "PRRC_kwDOABII584_q0-O",
      "original_commit_id" : "9b7e9dad271167af913828aaf3b75a9942770a34",
      "original_line" : 96,
      "original_position" : 102,
      "original_start_line" : null,
      "path" : "src/test/fuzz/netmsg.cpp",
      "position" : 96,
      "pull_request_review_id" : 1245711657,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26812",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1068191630/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-12T14:29:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1068191630",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26812#discussion_r1068212938"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26812"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1068212938"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Added.",
      "commit_id" : "32ab679f54a4f36cc315d0bd36638b7942f752f6",
      "created_at" : "2023-01-12T14:47:14Z",
      "diff_hunk" : "@@ -0,0 +1,140 @@\n+// Copyright (c) 2020-2023 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <banman.h>\n+#include <blockencodings.h>\n+#include <consensus/consensus.h>\n+#include <protocol.h>\n+#include <streams.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/mining.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/validation.h>\n+#include <util/check.h>\n+#include <util/time.h>\n+#include <validationinterface.h>\n+\n+#include <chrono>\n+#include <string>\n+#include <thread>\n+\n+namespace {\n+NetTestingSetup* g_setup;\n+} // namespace\n+\n+static size_t& GetNumMsgTypes()\n+{\n+    static size_t g_num_msg_types{0};\n+    return g_num_msg_types;\n+}\n+#define FUZZ_TARGET_MSG(msg_type)                          \\\n+    struct msg_type##CountBeforeMain {                     \\\n+        msg_type##CountBeforeMain()                        \\\n+        {                                                  \\\n+            ++GetNumMsgTypes();                            \\\n+        }                                                  \\\n+    } const static g_##msg_type##count_before_main;        \\\n+    FUZZ_TARGET_INIT(netmsg_##msg_type, initialize_netmsg) \\\n+    {                                                      \\\n+        fuzz_target(buffer, #msg_type);                    \\\n+    }\n+\n+void initialize_netmsg()\n+{\n+    Assert(GetNumMsgTypes() == getAllNetMessageTypes().size()); // If this fails, add or remove the message type below\n+\n+    static const auto testing_setup = MakeNoLogFileContext<NetTestingSetup>();\n+    g_setup = testing_setup.get();\n+    for (int i = 0; i < 2 * COINBASE_MATURITY; i++) {\n+        MineBlock(g_setup->m_node, CScript() << OP_TRUE);\n+    }\n+    SyncWithValidationInterfaceQueue();\n+}\n+\n+static void fuzz_target(FuzzBufferType buffer, const std::string& limit_to_message_type)\n+{\n+    FuzzedDataProvider fuzzed_data_provider(buffer.data(), buffer.size());\n+\n+    g_setup->m_node.banman->TestOnlyReset();\n+\n+    // Addrman and CConnman deprioritize addresses tried in the last 10min. Avoid that since\n+    // our addrman has very few addresses.\n+    SetMockTime(GetMockTime() + std::chrono::minutes{\n+                                    fuzzed_data_provider.ConsumeIntegralInRange<uint8_t>(11, 255)});\n+\n+    auto pipes = g_setup->m_sockets_pipes.PopFront();\n+\n+    uint8_t buf[1024];\n+\n+    LIMITED_WHILE(fuzzed_data_provider.remaining_bytes() > 0, 100) {\n+\n+        const std::string message_type =\n+            limit_to_message_type.empty() ?\n+                fuzzed_data_provider.ConsumeBytesAsString(CMessageHeader::COMMAND_SIZE) :\n+                limit_to_message_type;\n+\n+        CDataStream payload{\n+            ConsumeRandomLengthByteVector(fuzzed_data_provider), SER_NETWORK, PROTOCOL_VERSION};\n+\n+        pipes->recv.PushNetMsg(message_type, payload);\n+\n+        if (pipes->send.GetBytes(buf, sizeof(buf)) == 0) { // EOF, the socket has been closed.\n+            return;\n+        }\n+    }\n+\n+    TestChainState& chainstate = *static_cast<TestChainState*>(&g_setup->m_node.chainman->ActiveChainstate());\n+\n+    // Force a disconnect and wait for it.\n+    for (;;) {\n+        // Push a message that will cause a disconnect and socket closure (EOF on the Send() pipe).\n+        pipes->recv.PushNetMsg(\n+            NetMsgType::GETBLOCKTXN,\n+            BlockTransactionsRequest{.blockhash = chainstate.m_chain.Tip()->GetBlockHash(),\n+                                     .indexes = {1, UINT16_MAX}});\n+        if (pipes->send.GetBytes(buf, sizeof(buf)) == 0) {\n+            break;\n+        }\n+        std::this_thread::sleep_for(50ms);\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26812#discussion_r1068212938",
      "id" : 1068212938,
      "in_reply_to_id" : 1061896936,
      "line" : 96,
      "node_id" : "PRRC_kwDOABII584_q6LK",
      "original_commit_id" : "9b7e9dad271167af913828aaf3b75a9942770a34",
      "original_line" : 96,
      "original_position" : 102,
      "original_start_line" : null,
      "path" : "src/test/fuzz/netmsg.cpp",
      "position" : 96,
      "pull_request_review_id" : 1245744856,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26812",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1068212938/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-12T14:47:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1068212938",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26812#discussion_r1068245906"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26812"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1068245906"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why not de-duplicate by putting it in the existing `./src/test/fuzz/process_message.cpp` file?",
      "commit_id" : "32ab679f54a4f36cc315d0bd36638b7942f752f6",
      "created_at" : "2023-01-12T15:12:13Z",
      "diff_hunk" : "@@ -0,0 +1,140 @@\n+// Copyright (c) 2020-2023 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <banman.h>\n+#include <blockencodings.h>\n+#include <consensus/consensus.h>\n+#include <protocol.h>\n+#include <streams.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/mining.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/validation.h>\n+#include <util/check.h>\n+#include <util/time.h>\n+#include <validationinterface.h>\n+\n+#include <chrono>\n+#include <string>\n+#include <thread>\n+\n+namespace {\n+NetTestingSetup* g_setup;\n+} // namespace\n+\n+static size_t& GetNumMsgTypes()\n+{\n+    static size_t g_num_msg_types{0};\n+    return g_num_msg_types;\n+}\n+#define FUZZ_TARGET_MSG(msg_type)                          \\\n+    struct msg_type##CountBeforeMain {                     \\\n+        msg_type##CountBeforeMain()                        \\\n+        {                                                  \\\n+            ++GetNumMsgTypes();                            \\\n+        }                                                  \\\n+    } const static g_##msg_type##count_before_main;        \\\n+    FUZZ_TARGET_INIT(netmsg_##msg_type, initialize_netmsg) \\\n+    {                                                      \\\n+        fuzz_target(buffer, #msg_type);                    \\\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26812#discussion_r1068245906",
      "id" : 1068245906,
      "in_reply_to_id" : 1061557476,
      "line" : 44,
      "node_id" : "PRRC_kwDOABII584_rCOS",
      "original_commit_id" : "9b7e9dad271167af913828aaf3b75a9942770a34",
      "original_line" : 44,
      "original_position" : 43,
      "original_start_line" : 28,
      "path" : "src/test/fuzz/netmsg.cpp",
      "position" : 44,
      "pull_request_review_id" : 1245795841,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26812",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1068245906/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 29,
      "start_side" : "RIGHT",
      "updated_at" : "2023-01-12T15:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1068245906",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26812#discussion_r1068310185"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26812"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1068310185"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "You mean to put the entire contents of the newly introduced `fuzz/netmsg.cpp` inside `fuzz/process_message.cpp`?",
      "commit_id" : "32ab679f54a4f36cc315d0bd36638b7942f752f6",
      "created_at" : "2023-01-12T16:03:46Z",
      "diff_hunk" : "@@ -0,0 +1,140 @@\n+// Copyright (c) 2020-2023 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <banman.h>\n+#include <blockencodings.h>\n+#include <consensus/consensus.h>\n+#include <protocol.h>\n+#include <streams.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/mining.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/validation.h>\n+#include <util/check.h>\n+#include <util/time.h>\n+#include <validationinterface.h>\n+\n+#include <chrono>\n+#include <string>\n+#include <thread>\n+\n+namespace {\n+NetTestingSetup* g_setup;\n+} // namespace\n+\n+static size_t& GetNumMsgTypes()\n+{\n+    static size_t g_num_msg_types{0};\n+    return g_num_msg_types;\n+}\n+#define FUZZ_TARGET_MSG(msg_type)                          \\\n+    struct msg_type##CountBeforeMain {                     \\\n+        msg_type##CountBeforeMain()                        \\\n+        {                                                  \\\n+            ++GetNumMsgTypes();                            \\\n+        }                                                  \\\n+    } const static g_##msg_type##count_before_main;        \\\n+    FUZZ_TARGET_INIT(netmsg_##msg_type, initialize_netmsg) \\\n+    {                                                      \\\n+        fuzz_target(buffer, #msg_type);                    \\\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26812#discussion_r1068310185",
      "id" : 1068310185,
      "in_reply_to_id" : 1061557476,
      "line" : 44,
      "node_id" : "PRRC_kwDOABII584_rR6p",
      "original_commit_id" : "9b7e9dad271167af913828aaf3b75a9942770a34",
      "original_line" : 44,
      "original_position" : 43,
      "original_start_line" : 28,
      "path" : "src/test/fuzz/netmsg.cpp",
      "position" : 44,
      "pull_request_review_id" : 1245900568,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26812",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1068310185/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 29,
      "start_side" : "RIGHT",
      "updated_at" : "2023-01-12T16:03:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1068310185",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26812#discussion_r1068314583"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26812"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1068314583"
         }
      },
      "author_association" : "MEMBER",
      "body" : "yes",
      "commit_id" : "32ab679f54a4f36cc315d0bd36638b7942f752f6",
      "created_at" : "2023-01-12T16:07:36Z",
      "diff_hunk" : "@@ -0,0 +1,140 @@\n+// Copyright (c) 2020-2023 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <banman.h>\n+#include <blockencodings.h>\n+#include <consensus/consensus.h>\n+#include <protocol.h>\n+#include <streams.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/mining.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/validation.h>\n+#include <util/check.h>\n+#include <util/time.h>\n+#include <validationinterface.h>\n+\n+#include <chrono>\n+#include <string>\n+#include <thread>\n+\n+namespace {\n+NetTestingSetup* g_setup;\n+} // namespace\n+\n+static size_t& GetNumMsgTypes()\n+{\n+    static size_t g_num_msg_types{0};\n+    return g_num_msg_types;\n+}\n+#define FUZZ_TARGET_MSG(msg_type)                          \\\n+    struct msg_type##CountBeforeMain {                     \\\n+        msg_type##CountBeforeMain()                        \\\n+        {                                                  \\\n+            ++GetNumMsgTypes();                            \\\n+        }                                                  \\\n+    } const static g_##msg_type##count_before_main;        \\\n+    FUZZ_TARGET_INIT(netmsg_##msg_type, initialize_netmsg) \\\n+    {                                                      \\\n+        fuzz_target(buffer, #msg_type);                    \\\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26812#discussion_r1068314583",
      "id" : 1068314583,
      "in_reply_to_id" : 1061557476,
      "line" : 44,
      "node_id" : "PRRC_kwDOABII584_rS_X",
      "original_commit_id" : "9b7e9dad271167af913828aaf3b75a9942770a34",
      "original_line" : 44,
      "original_position" : 43,
      "original_start_line" : 28,
      "path" : "src/test/fuzz/netmsg.cpp",
      "position" : 44,
      "pull_request_review_id" : 1245907668,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26812",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1068314583/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 29,
      "start_side" : "RIGHT",
      "updated_at" : "2023-01-12T16:07:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1068314583",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26812#discussion_r1068407369"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26812"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1068407369"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> IMO e2e fuzzing has some value.\r\n\r\nYes, but I think it should focus on what you are trying to test. If you keep the target to broad the fuzzer is gonna have a hard time finding interesting test cases (especially if the target is slow). One obvious way of focusing is to only fuzz smaller units of code and in the e2e case you probably want to narrow the way you are interpreting the fuzz input so that you are actually testing what you want to test.\r\n\r\nThe approach here currently seems to be very similar to the `process_message(s)` targets (which is why you suggested to replace them iiuc), in that you are interpreting most of the fuzz input as a sequence of arbitrary messages, so the questions that I have are:\r\n* What do you want to test here? Message processing? connman internals? the interactions between connman/peerman?\r\n* What bugs is your target capable of finding that `process_message(s)` (or other targets) are not? In other words which areas/interactions is this fuzzing that are previously not covered?\r\n* Are the message contents (and their mutations) of all message types useful for what you are trying to test here? e.g. does it matter if a tx message contains a transaction with 1 input or 5? because the fuzzer will likely find that difference interesting but it doesn't seem like this would add value to what you are trying to test here, since the goal (correct me if I am wrong) isn't fuzzing validation.\r\n* Could the input interpretation be narrowed to only include the messages that lead to interactions you are trying to test?",
      "commit_id" : "32ab679f54a4f36cc315d0bd36638b7942f752f6",
      "created_at" : "2023-01-12T17:31:09Z",
      "diff_hunk" : "@@ -0,0 +1,140 @@\n+// Copyright (c) 2020-2023 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <banman.h>\n+#include <blockencodings.h>\n+#include <consensus/consensus.h>\n+#include <protocol.h>\n+#include <streams.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/mining.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/validation.h>\n+#include <util/check.h>\n+#include <util/time.h>\n+#include <validationinterface.h>\n+\n+#include <chrono>\n+#include <string>\n+#include <thread>\n+\n+namespace {\n+NetTestingSetup* g_setup;\n+} // namespace\n+\n+static size_t& GetNumMsgTypes()\n+{\n+    static size_t g_num_msg_types{0};\n+    return g_num_msg_types;\n+}\n+#define FUZZ_TARGET_MSG(msg_type)                          \\\n+    struct msg_type##CountBeforeMain {                     \\\n+        msg_type##CountBeforeMain()                        \\\n+        {                                                  \\\n+            ++GetNumMsgTypes();                            \\\n+        }                                                  \\\n+    } const static g_##msg_type##count_before_main;        \\\n+    FUZZ_TARGET_INIT(netmsg_##msg_type, initialize_netmsg) \\\n+    {                                                      \\\n+        fuzz_target(buffer, #msg_type);                    \\\n+    }\n+\n+void initialize_netmsg()\n+{\n+    Assert(GetNumMsgTypes() == getAllNetMessageTypes().size()); // If this fails, add or remove the message type below\n+\n+    static const auto testing_setup = MakeNoLogFileContext<NetTestingSetup>();\n+    g_setup = testing_setup.get();\n+    for (int i = 0; i < 2 * COINBASE_MATURITY; i++) {\n+        MineBlock(g_setup->m_node, CScript() << OP_TRUE);\n+    }\n+    SyncWithValidationInterfaceQueue();\n+}\n+\n+static void fuzz_target(FuzzBufferType buffer, const std::string& limit_to_message_type)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26812#discussion_r1068407369",
      "id" : 1068407369,
      "in_reply_to_id" : 1061894472,
      "line" : 58,
      "node_id" : "PRRC_kwDOABII584_rppJ",
      "original_commit_id" : "9b7e9dad271167af913828aaf3b75a9942770a34",
      "original_line" : 58,
      "original_position" : 57,
      "original_start_line" : null,
      "path" : "src/test/fuzz/netmsg.cpp",
      "position" : 58,
      "pull_request_review_id" : 1246114670,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26812",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1068407369/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-12T17:31:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1068407369",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26812#discussion_r1070262419"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26812"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1070262419"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Looks plausible. I will try to do that and see how it will look.",
      "commit_id" : "32ab679f54a4f36cc315d0bd36638b7942f752f6",
      "created_at" : "2023-01-14T12:58:20Z",
      "diff_hunk" : "@@ -0,0 +1,140 @@\n+// Copyright (c) 2020-2023 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <banman.h>\n+#include <blockencodings.h>\n+#include <consensus/consensus.h>\n+#include <protocol.h>\n+#include <streams.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/mining.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/validation.h>\n+#include <util/check.h>\n+#include <util/time.h>\n+#include <validationinterface.h>\n+\n+#include <chrono>\n+#include <string>\n+#include <thread>\n+\n+namespace {\n+NetTestingSetup* g_setup;\n+} // namespace\n+\n+static size_t& GetNumMsgTypes()\n+{\n+    static size_t g_num_msg_types{0};\n+    return g_num_msg_types;\n+}\n+#define FUZZ_TARGET_MSG(msg_type)                          \\\n+    struct msg_type##CountBeforeMain {                     \\\n+        msg_type##CountBeforeMain()                        \\\n+        {                                                  \\\n+            ++GetNumMsgTypes();                            \\\n+        }                                                  \\\n+    } const static g_##msg_type##count_before_main;        \\\n+    FUZZ_TARGET_INIT(netmsg_##msg_type, initialize_netmsg) \\\n+    {                                                      \\\n+        fuzz_target(buffer, #msg_type);                    \\\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26812#discussion_r1070262419",
      "id" : 1070262419,
      "in_reply_to_id" : 1061557476,
      "line" : 44,
      "node_id" : "PRRC_kwDOABII584_yuiT",
      "original_commit_id" : "9b7e9dad271167af913828aaf3b75a9942770a34",
      "original_line" : 44,
      "original_position" : 43,
      "original_start_line" : 28,
      "path" : "src/test/fuzz/netmsg.cpp",
      "position" : 44,
      "pull_request_review_id" : 1248763319,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26812",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1070262419/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 29,
      "start_side" : "RIGHT",
      "updated_at" : "2023-01-14T12:58:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1070262419",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-02-01T11:35:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26812#issuecomment-1411914720",
      "id" : 1411914720,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26812",
      "node_id" : "IC_kwDOABII585UKBvg",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1411914720/reactions"
      },
      "updated_at" : "2023-02-01T11:35:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1411914720",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`32ab679f54...7c591c868d`: rebase due to conflicts",
      "created_at" : "2023-02-09T14:00:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26812#issuecomment-1424234586",
      "id" : 1424234586,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26812",
      "node_id" : "IC_kwDOABII585U5Bha",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1424234586/reactions"
      },
      "updated_at" : "2023-02-09T14:00:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1424234586",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26812#discussion_r1111936979"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26812"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1111936979"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done. This also reduced the size of the diff (the last commit). Thanks!",
      "commit_id" : "a81fe4ff9bb907e3a8e8f027a9cac440a82e7a14",
      "created_at" : "2023-02-20T13:05:33Z",
      "diff_hunk" : "@@ -0,0 +1,140 @@\n+// Copyright (c) 2020-2023 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <banman.h>\n+#include <blockencodings.h>\n+#include <consensus/consensus.h>\n+#include <protocol.h>\n+#include <streams.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/mining.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/validation.h>\n+#include <util/check.h>\n+#include <util/time.h>\n+#include <validationinterface.h>\n+\n+#include <chrono>\n+#include <string>\n+#include <thread>\n+\n+namespace {\n+NetTestingSetup* g_setup;\n+} // namespace\n+\n+static size_t& GetNumMsgTypes()\n+{\n+    static size_t g_num_msg_types{0};\n+    return g_num_msg_types;\n+}\n+#define FUZZ_TARGET_MSG(msg_type)                          \\\n+    struct msg_type##CountBeforeMain {                     \\\n+        msg_type##CountBeforeMain()                        \\\n+        {                                                  \\\n+            ++GetNumMsgTypes();                            \\\n+        }                                                  \\\n+    } const static g_##msg_type##count_before_main;        \\\n+    FUZZ_TARGET_INIT(netmsg_##msg_type, initialize_netmsg) \\\n+    {                                                      \\\n+        fuzz_target(buffer, #msg_type);                    \\\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26812#discussion_r1111936979",
      "id" : 1111936979,
      "in_reply_to_id" : 1061557476,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585CRs_T",
      "original_commit_id" : "9b7e9dad271167af913828aaf3b75a9942770a34",
      "original_line" : 44,
      "original_position" : 43,
      "original_start_line" : 28,
      "path" : "src/test/fuzz/netmsg.cpp",
      "position" : null,
      "pull_request_review_id" : 1305767542,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26812",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1111936979/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2023-02-20T13:05:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1111936979",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`7c591c868d...a81fe4ff9b`: rebase and put the fuzz tests in `fuzz/process_message.cpp` instead of in a new file, as [suggested](https://github.com/bitcoin/bitcoin/pull/26812#discussion_r1068245906).",
      "created_at" : "2023-02-20T13:07:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26812#issuecomment-1436999481",
      "id" : 1436999481,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26812",
      "node_id" : "IC_kwDOABII585Vpt85",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1436999481/reactions"
      },
      "updated_at" : "2023-02-20T13:07:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1436999481",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "There may be a silent merge conflict. After rebase to current master at fde224a6610699a6a28cc27e299ac14cbf7e16ca, building with Clang 16 fails at commit `test: add a mocked Sock that allows inspecting what has been Send() to it`.\r\n\r\n<details><summary>build error</summary><p>\r\n\r\n```\r\ntest/util/net.cpp:280:12: error: no viable conversion from returned value of type 'const CNetMessage' to function return type 'std::optional<CNetMessage>'\r\n    return msg;\r\n           ^~~\r\n/opt/homebrew/opt/llvm/bin/../include/c++/v1/optional:736:41: note: candidate constructor not viable: no known conversion from 'const CNetMessage' to 'const optional<CNetMessage> &' for 1st argument\r\n    _LIBCPP_INLINE_VISIBILITY constexpr optional(const optional&) = default;\r\n                                        ^\r\n/opt/homebrew/opt/llvm/bin/../include/c++/v1/optional:737:41: note: candidate constructor not viable: no known conversion from 'const CNetMessage' to 'optional<CNetMessage> &&' for 1st argument\r\n    _LIBCPP_INLINE_VISIBILITY constexpr optional(optional&&) = default;\r\n                                        ^\r\n/opt/homebrew/opt/llvm/bin/../include/c++/v1/optional:738:41: note: candidate constructor not viable: no known conversion from 'const CNetMessage' to 'nullopt_t' for 1st argument\r\n    _LIBCPP_INLINE_VISIBILITY constexpr optional(nullopt_t) noexcept {}\r\n                                        ^\r\n/opt/homebrew/opt/llvm/bin/../include/c++/v1/optional:762:15: note: candidate template ignored: requirement '_CheckOptionalArgsCtor<const CNetMessage &>::__enable_implicit()' was not satisfied [with _Up = const CNetMessage &]\r\n    constexpr optional(_Up&& __v)\r\n              ^\r\n/opt/homebrew/opt/llvm/bin/../include/c++/v1/optional:777:35: note: candidate template ignored: could not match 'const optional<_Up>' against 'const CNetMessage'\r\n    _LIBCPP_CONSTEXPR_SINCE_CXX20 optional(const optional<_Up>& __v)\r\n                                  ^\r\n/opt/homebrew/opt/llvm/bin/../include/c++/v1/optional:795:35: note: candidate template ignored: could not match 'optional<_Up>' against 'const CNetMessage'\r\n    _LIBCPP_CONSTEXPR_SINCE_CXX20 optional(optional<_Up>&& __v)\r\n                                  ^\r\n/opt/homebrew/opt/llvm/bin/../include/c++/v1/optional:748:24: note: explicit constructor is not a candidate\r\n    constexpr explicit optional(_InPlaceT, _Args&&... __args)\r\n                       ^\r\n/opt/homebrew/opt/llvm/bin/../include/c++/v1/optional:769:24: note: explicit constructor is not a candidate\r\n    constexpr explicit optional(_Up&& __v)\r\n                       ^\r\n/opt/homebrew/opt/llvm/bin/../include/c++/v1/optional:785:44: note: explicit constructor is not a candidate\r\n    _LIBCPP_CONSTEXPR_SINCE_CXX20 explicit optional(const optional<_Up>& __v)\r\n                                           ^\r\n/opt/homebrew/opt/llvm/bin/../include/c++/v1/optional:803:44: note: explicit constructor is not a candidate\r\n    _LIBCPP_CONSTEXPR_SINCE_CXX20 explicit optional(optional<_Up>&& __v)\r\n                                           ^\r\n1 error generated.\r\nmake[2]: *** [test/util/libtest_util_a-net.o] Error 1\r\nmake[2]: *** Waiting for unfinished jobs....\r\nmake[1]: *** [all-recursive] Error 1\r\nmake: *** [all-recursive] Error 1\r\n```\r\n</p></details>\r\n\r\n```\r\n$ clang --version\r\nHomebrew clang version 16.0.1\r\nTarget: arm64-apple-darwin22.4.0\r\nThread model: posix\r\n```",
      "created_at" : "2023-04-19T15:06:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26812#issuecomment-1514904243",
      "id" : 1514904243,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26812",
      "node_id" : "IC_kwDOABII585aS5qz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1514904243/reactions"
      },
      "updated_at" : "2023-04-19T15:06:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1514904243",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> There may be a silent merge conflict.\r\n\r\nProbably because of https://github.com/bitcoin/bitcoin/pull/27324, copying `CNetMessage`s is no longer possible.",
      "created_at" : "2023-04-19T15:12:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26812#issuecomment-1514913010",
      "id" : 1514913010,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26812",
      "node_id" : "IC_kwDOABII585aS7zy",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1514913010/reactions"
      },
      "updated_at" : "2023-04-19T15:12:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1514913010",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-04-26T11:55:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26812#issuecomment-1523290738",
      "id" : 1523290738,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26812",
      "node_id" : "IC_kwDOABII585ay5Jy",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1523290738/reactions"
      },
      "updated_at" : "2023-04-26T11:55:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1523290738",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`a81fe4ff9b...f559067e27`: rebase due to conflicts, thanks for looking into this!",
      "created_at" : "2023-05-12T11:34:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26812#issuecomment-1545603904",
      "id" : 1545603904,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26812",
      "node_id" : "IC_kwDOABII585cIAtA",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1545603904/reactions"
      },
      "updated_at" : "2023-05-12T11:34:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1545603904",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   }
]
