[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [vasild](https://github.com/bitcoin/bitcoin/pull/26862#pullrequestreview-1241978416) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#26177](https://github.com/bitcoin/bitcoin/pull/26177) (refactor / kernel: Move non-gArgs chainparams functionality to kernel by TheCharlatan)\n* [#22729](https://github.com/bitcoin/bitcoin/pull/22729) (Make it possible to disable Tor binds and abort startup on bind failure by vasild)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-01-10T10:46:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26862#issuecomment-1377064104",
      "id" : 1377064104,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26862",
      "node_id" : "IC_kwDOABII585SFFSo",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1377064104/reactions"
      },
      "updated_at" : "2023-01-10T18:13:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1377064104",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26862#discussion_r1065638842"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26862"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065638842"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This would ignore `bind=...=onion` if `listenonion=0`. That will break the static Tor configurations where the hidden service is configured in the Tor daemon and `bitcoind` is running with `-bind=...=onion -listenonion=0`.\r\n\r\nSee `## 3. Manually create a Bitcoin Core onion service` in `doc/tor.md`.",
      "commit_id" : "a6f6f3861970a7d16bfadc6440fddd6881c2b76c",
      "created_at" : "2023-01-10T11:05:43Z",
      "diff_hunk" : "@@ -1741,7 +1742,8 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n             }\n         } else {\n             const std::string network_type = bind_arg.substr(index + 1);\n-            if (network_type == \"onion\") {\n+            // Do not fill in connOptions.onion_binds if you are not running the Tor service\n+            if (args.GetBoolArg(\"-listenonion\", DEFAULT_LISTEN_ONION) && network_type == \"onion\") {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26862#discussion_r1065638842",
      "id" : 1065638842,
      "line" : 1746,
      "node_id" : "PRRC_kwDOABII584_hFu6",
      "original_commit_id" : "99612afb7a6bcb54860b0077063f7046a25cc689",
      "original_line" : 1746,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 14,
      "pull_request_review_id" : 1241978416,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26862",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065638842/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-10T11:21:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065638842",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26862#discussion_r1065641070"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26862"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065641070"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This option conflicts with `-bind=addr:port=onion` because both provide a way to specify the port. Better have one way to specify things.",
      "commit_id" : "a6f6f3861970a7d16bfadc6440fddd6881c2b76c",
      "created_at" : "2023-01-10T11:08:05Z",
      "diff_hunk" : "@@ -472,6 +472,7 @@ void SetupServerArgs(ArgsManager& argsman)\n     argsman.AddArg(\"-maxtimeadjustment\", strprintf(\"Maximum allowed median peer time offset adjustment. Local perspective of time may be influenced by outbound peers forward or backward by this amount (default: %u seconds).\", DEFAULT_MAX_TIME_ADJUSTMENT), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n     argsman.AddArg(\"-maxuploadtarget=<n>\", strprintf(\"Tries to keep outbound traffic under the given target per 24h. Limit does not apply to peers with 'download' permission or blocks created within past week. 0 = no limit (default: %s). Optional suffix units [k|K|m|M|g|G|t|T] (default: M). Lowercase is 1000 base while uppercase is 1024 base\", DEFAULT_MAX_UPLOAD_TARGET), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n     argsman.AddArg(\"-onion=<ip:port>\", \"Use separate SOCKS5 proxy to reach peers via Tor onion services, set -noonion to disable (default: -proxy)\", ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n+    argsman.AddArg(\"-onionport=<port>\", strprintf(\"Use this port for Tor connections (default: %u, testnet: %u, signet: %u, regtest: %u)\", defaultBaseParams->OnionServiceTargetPort(), testnetBaseParams->OnionServiceTargetPort(), signetBaseParams->OnionServiceTargetPort(), regtestBaseParams->OnionServiceTargetPort()), ArgsManager::ALLOW_ANY, OptionsCategory::RPC);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26862#discussion_r1065641070",
      "id" : 1065641070,
      "line" : 475,
      "node_id" : "PRRC_kwDOABII584_hGRu",
      "original_commit_id" : "99612afb7a6bcb54860b0077063f7046a25cc689",
      "original_line" : 475,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 4,
      "pull_request_review_id" : 1241978416,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26862",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065641070/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-10T11:21:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065641070",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Thanks for your review!\r\n\r\nIn general, I understood how to avoid the problem of duplicating the port bind in tests through `bind=address:port=onion` by increasing the `port` for each subsequent node.\r\n\r\nIn this case, it remains only to exclude the forced onion binding of the port.. I think one simple argument is missing, something like `usetor=1|0` - which would include or exclude all functionality. Although I understand that this is a major change, given the reach of users.\r\n\r\nI think I'll close this PR, since I don't have a solution yet)",
      "created_at" : "2023-01-11T08:06:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26862#issuecomment-1378370996",
      "id" : 1378370996,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26862",
      "node_id" : "IC_kwDOABII585SKEW0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1378370996/reactions"
      },
      "updated_at" : "2023-01-11T08:06:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1378370996",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/24531527?v=4",
         "events_url" : "https://api.github.com/users/andyoknen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/andyoknen/followers",
         "following_url" : "https://api.github.com/users/andyoknen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/andyoknen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/andyoknen",
         "id" : 24531527,
         "login" : "andyoknen",
         "node_id" : "MDQ6VXNlcjI0NTMxNTI3",
         "organizations_url" : "https://api.github.com/users/andyoknen/orgs",
         "received_events_url" : "https://api.github.com/users/andyoknen/received_events",
         "repos_url" : "https://api.github.com/users/andyoknen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/andyoknen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/andyoknen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/andyoknen"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> it remains only to exclude the forced onion binding of the port\r\n\r\nWhat is that \"forced onion binding\"?",
      "created_at" : "2023-01-14T12:45:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26862#issuecomment-1382729695",
      "id" : 1382729695,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26862",
      "node_id" : "IC_kwDOABII585Sasff",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1382729695/reactions"
      },
      "updated_at" : "2023-01-14T12:45:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1382729695",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> > it remains only to exclude the forced onion binding of the port\r\n> \r\n> What is that \"forced onion binding\"?\r\n\r\nI mean that port binding happens anyway whether I want to use TOR or not",
      "created_at" : "2023-01-18T05:29:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26862#issuecomment-1386511762",
      "id" : 1386511762,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26862",
      "node_id" : "IC_kwDOABII585SpH2S",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1386511762/reactions"
      },
      "updated_at" : "2023-01-18T05:29:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1386511762",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/24531527?v=4",
         "events_url" : "https://api.github.com/users/andyoknen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/andyoknen/followers",
         "following_url" : "https://api.github.com/users/andyoknen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/andyoknen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/andyoknen",
         "id" : 24531527,
         "login" : "andyoknen",
         "node_id" : "MDQ6VXNlcjI0NTMxNTI3",
         "organizations_url" : "https://api.github.com/users/andyoknen/orgs",
         "received_events_url" : "https://api.github.com/users/andyoknen/received_events",
         "repos_url" : "https://api.github.com/users/andyoknen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/andyoknen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/andyoknen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/andyoknen"
      }
   }
]
