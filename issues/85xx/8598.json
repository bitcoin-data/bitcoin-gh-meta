{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "Currently, commands like `decodescript` that return an assembly representation of the script will show seemingly valid integers for a number of incorrectly pushed int values of sizes 0 to 4. The purpose of this change is to allow `ScriptToAsmStr` to return a more accurate representation of the assembly.\n\nIn addition, `ScriptToAsmStr` will not fail on what are considered invalid pushes altogether. This change will make `ScriptToAsmStr` return an '[error]' string, much like other invalid pushes.\n\nI believe this makes more sense when displaying decoded script.\nAs opposed to showing the valid representation of an int for an incorrectly pushed value, the value is returned either as a number if both the push is minimal and the encoding is correct, or as hex if the push is not minimal.  Invalid pushes are shown as '[error]' and end the decoding.\n\nExamples:\n\nHere the first two pushes are valid numbers.  The rest are shown as hex data. \n\n```\n$ for i in 52 0152 025200 03520000 0452000000 055200000000; do echo \"hex script: ${i}\"; bitcoin-cli decodescript ${i} | grep asm; done\n\nhex script: 52\n  \"asm\": \"2\",\nhex script: 0152\n  \"asm\": \"82\",\nhex script: 025200\n  \"asm\": \"5200\",\nhex script: 03520000\n  \"asm\": \"520000\",\nhex script: 0452000000\n  \"asm\": \"52000000\",\nhex script: 055200000000\n  \"asm\": \"5200000000\",\n```\n\nPushing -1,[1,16] incorrectly, after and before the patch.\n\n```\n$ for i in 81 {01..09} 0A 0B 0C 0D 0E 0F 10; do echo \"hex script: 01${i}\"; bitcoin-cli decodescript 01${i} | grep asm; done\n\nAfter:                             Before:\n\nhex script: 0181                   hex script: 0181\n  \"asm\": \"[error]\",                     \"asm\": \"-1\",\nhex script: 0101                   hex script: 0101\n  \"asm\": \"[error]\",                     \"asm\": \"1\",\nhex script: 0102                   hex script: 0102\n  \"asm\": \"[error]\",                     \"asm\": \"2\",\nhex script: 0103                   hex script: 0103\n  \"asm\": \"[error]\",                     \"asm\": \"3\",\nhex script: 0104                   hex script: 0104\n  \"asm\": \"[error]\",                     \"asm\": \"4\",\nhex script: 0105                   hex script: 0105\n  \"asm\": \"[error]\",                     \"asm\": \"5\",\nhex script: 0106                   hex script: 0106\n  \"asm\": \"[error]\",                     \"asm\": \"6\",\nhex script: 0107                   hex script: 0107\n  \"asm\": \"[error]\",                     \"asm\": \"7\",\nhex script: 0108                   hex script: 0108\n  \"asm\": \"[error]\",                     \"asm\": \"8\",\nhex script: 0109                   hex script: 0109\n  \"asm\": \"[error]\",                     \"asm\": \"9\",\nhex script: 010A                   hex script: 010A\n  \"asm\": \"[error]\",                     \"asm\": \"10\",\nhex script: 010B                   hex script: 010B\n  \"asm\": \"[error]\",                     \"asm\": \"11\",\nhex script: 010C                   hex script: 010C\n  \"asm\": \"[error]\",                     \"asm\": \"12\",\nhex script: 010D                   hex script: 010D\n  \"asm\": \"[error]\",                     \"asm\": \"13\",\nhex script: 010E                   hex script: 010E\n  \"asm\": \"[error]\",                     \"asm\": \"14\",\nhex script: 010F                   hex script: 010F\n  \"asm\": \"[error]\",                     \"asm\": \"15\",\nhex script: 0110                   hex script: 0110\n  \"asm\": \"[error]\",                     \"asm\": \"16\",\n```\n\nActual example of how '0' and '0x00' are different.  Both pushes are currently shown as '0'. After the patch, the first will be shown as '0' and the second as '00', making the distinction more obvious.\n\n```\n$ bitcoin-cli decodescript 00A820E3B0C44298FC1C149AFBF4C8996FB92427AE41E4649B934CA495991B7852B85587 | grep asm\n\n  \"asm\": \"0 OP_SHA256 e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855 OP_EQUAL\",\n\n$ bitcoin-cli signrawtransaction \\\n0100000001aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa00000000252400a820e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b85587ffffffff0100000000000000001976a914bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb88ac00000000 \\\n'[{\"txid\":\"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\",\"vout\":0,\"scriptPubKey\":\"A914D227B69A4FE6FED60B20CFC31AED65027CF3DAC287\",\"redeemScript\":\"00A820E3B0C44298FC1C149AFBF4C8996FB92427AE41E4649B934CA495991B7852B85587\",\"amount\":0}]'\n\n...\n  \"complete\": true\n```\n\nvs\n\n```\nbitcoin-cli decodescript 0100A8206E340B9CFFB37A989CA544E6BB780A2C78901D3FB33738768511A30617AFA01D87 | grep asm\n\n  \"asm\": \"0 OP_SHA256 6e340b9cffb37a989ca544e6bb780a2c78901d3fb33738768511a30617afa01d OP_EQUAL\",\n\nbitcoin-cli signrawtransaction \\\n0100000001aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa0000000026250100a8206e340b9cffb37a989ca544e6bb780a2c78901d3fb33738768511a30617afa01d87ffffffff0100000000000000001976a914bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb88ac00000000 \\\n'[{\"txid\":\"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\",\"vout\":0,\"scriptPubKey\":\"A914CF527A41C9908B23B16F854A15F2B4ECB18D8A7187\",\"redeemScript\":\"0100A8206E340B9CFFB37A989CA544E6BB780A2C78901D3FB33738768511A30617AFA01D87\",\"amount\":0}]'\n\n...\n  \"complete\": true\n```\n",
   "closed_at" : "2016-09-04T21:00:19Z",
   "closed_by" : {
      "avatar_url" : "https://avatars0.githubusercontent.com/u/5624963?v=4",
      "events_url" : "https://api.github.com/users/fivepiece/events{/privacy}",
      "followers_url" : "https://api.github.com/users/fivepiece/followers",
      "following_url" : "https://api.github.com/users/fivepiece/following{/other_user}",
      "gists_url" : "https://api.github.com/users/fivepiece/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/fivepiece",
      "id" : 5624963,
      "login" : "fivepiece",
      "node_id" : "MDQ6VXNlcjU2MjQ5NjM=",
      "organizations_url" : "https://api.github.com/users/fivepiece/orgs",
      "received_events_url" : "https://api.github.com/users/fivepiece/received_events",
      "repos_url" : "https://api.github.com/users/fivepiece/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/fivepiece/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/fivepiece/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/fivepiece"
   },
   "comments" : 7,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8598/comments",
   "created_at" : "2016-08-26T07:34:09Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8598/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/8598",
   "id" : 173388224,
   "labels" : [
      {
         "color" : "0052cc",
         "default" : false,
         "id" : 98279177,
         "name" : "RPC/REST/ZMQ",
         "node_id" : "MDU6TGFiZWw5ODI3OTE3Nw==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/RPC/REST/ZMQ"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8598/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDExOlB1bGxSZXF1ZXN0ODI4NDM5NDY=",
   "number" : 8598,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/8598.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8598",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/8598.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8598"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "Fix displaying of invalid and non-minimal small pushes as numbers",
   "updated_at" : "2016-09-04T21:00:19Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8598",
   "user" : {
      "avatar_url" : "https://avatars0.githubusercontent.com/u/5624963?v=4",
      "events_url" : "https://api.github.com/users/fivepiece/events{/privacy}",
      "followers_url" : "https://api.github.com/users/fivepiece/followers",
      "following_url" : "https://api.github.com/users/fivepiece/following{/other_user}",
      "gists_url" : "https://api.github.com/users/fivepiece/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/fivepiece",
      "id" : 5624963,
      "login" : "fivepiece",
      "node_id" : "MDQ6VXNlcjU2MjQ5NjM=",
      "organizations_url" : "https://api.github.com/users/fivepiece/orgs",
      "received_events_url" : "https://api.github.com/users/fivepiece/received_events",
      "repos_url" : "https://api.github.com/users/fivepiece/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/fivepiece/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/fivepiece/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/fivepiece"
   }
}
