[
   {
      "body" : "Looks OK from quick glance.  Test plan?\r\n",
      "created_at" : "2015-04-10T17:34:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5996#issuecomment-91630210",
      "id" : 91630210,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5996",
      "updated_at" : "2015-04-10T17:34:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/91630210",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "utACK.\r\n\r\nOne way to test this would be creating a unit test with the old GetBlockValue() implementation, and calling it for some arbitrary heights/fees, and comparing with the new. It looks trivially correct to me, though.",
      "created_at" : "2015-04-11T08:42:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5996#issuecomment-91795371",
      "id" : 91795371,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5996",
      "updated_at" : "2015-04-11T08:42:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/91795371",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Needed rebase.\r\nI also think it is trivial enough: passing Consensus::Params, adding the fees outside of the function and not calculating the initial subsidy if it's going to return 0.\r\n\r\nIn any case, the current main_tests.cpp (which just tests this function) could be improved, it only checks that the subsidy is always <= 50 * COIN. Probably a dataset with pairs height -> subsidy would be better.\r\n\r\nWe could also test for other subsidy halving intervals (now that Consensus::Params it's passed, it's trivial to set another Consensus::Params::nSubsidyHalvingInterval in the tests, even without calling Params()).\r\nDoes that sound good enough? Suggestions for improving main_tests (sat some point they should be renamed subsidy_tests and moved to src/consensus/tests but not yet)?\r\n",
      "created_at" : "2015-04-13T16:31:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5996#issuecomment-92418696",
      "id" : 92418696,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5996",
      "updated_at" : "2015-04-13T16:31:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/92418696",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Needed rebase again.\r\nI also added some more tests.\r\nNote that if the constants...\r\n```\r\n    int maxHalvings = 64;\r\n    CAmount nInitialSubsidy = 50 * COIN;\r\n```\r\n...were part of Consensus::Params, we could easily adapt my tests to test different values for them.\r\nBut I'm not sure it's worth it.\r\nAnd even less sure if that belongs to this PR, I mean to get rid of CChainParams::SubsidyHalvingInterval() I could have simply added the Consensus::Params parameter to GetBlockValue without removing the nFees parameter...\r\n",
      "created_at" : "2015-04-15T14:03:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5996#issuecomment-93413373",
      "id" : 93413373,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5996",
      "updated_at" : "2015-04-15T14:03:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/93413373",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Rebased",
      "created_at" : "2015-05-15T14:13:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5996#issuecomment-102410095",
      "id" : 102410095,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5996",
      "updated_at" : "2015-05-15T14:13:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/102410095",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "> I mean to get rid of CChainParams::SubsidyHalvingInterval() I could have simply added the Consensus::Params parameter to GetBlockValue without removing the nFees parameter...\r\n\r\nIf you had done that, this would have already been merged. I'm a bit wary as this changes the fee computation code and is not simple substitution like the other \"Remove redundant getter\" pulls.\r\n",
      "created_at" : "2015-05-16T08:13:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5996#issuecomment-102586431",
      "id" : 102586431,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5996",
      "updated_at" : "2015-05-16T08:13:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/102586431",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "That's fine.\r\nLibconsensus-wise, this is only required for VerifyBlock, which can only come after both VerifyTx and VerifyHeader, so this isn't really blocking anything in the short term. Therefore I prefer to do it in a way that I think is right rather than in the fastest way possible.\r\n\r\nThis doesn't \"change the way fees are computed\": fees are computed outside of this function. The only difference is that the subsidy and the fees were added together inside the function and now they will be added outside it. If the previous function had a more descriptive declaration like ```Camount CalculateSubsidyAndAddPreviouslyCalculatedFeesToIt(nHeight, previouslyCalucaletedFees)``` I doubt anybody would have complained about replacing ```CalculateSubsidyAndAddPreviouslyCalculatedFeesToIt(nHeight, nFees)``` with ```GetSubsidy(nHeight) + nFees```, which is far more readable IMO (and more aligned with general principles about reusability, but let's not go there).\r\n\r\nCalculating the initial subsidy to then ignore when halvings >= 64 it's stupid, so I would have also felt bad if I had touched this function without fixing that. I can always remove that tiny optimization if people insist on keep doing the wrong thing.\r\n\r\nMaybe I should have done this in 3 commits and only squash them after people have seen this as the obviously equivalent-but-clearer thing I see. If someone else wants to do a version without the optimization and keeping the addition inside the function (because somehow they thing ```, nFees)``` is clearer than ```+ nFees```), I'm totally fine with it. But it will change exactly 2 lines less (the 2 lines required for the micro-optimization, that is, moving ```CAmount nSubsidy = 50 * COIN;``` after ``````if halvings >= 64```).\r\nIf the creator of the competitor PR likes the micro-optimization but still wants to do the addition inside the function, the new PR will change exactly the same lines.\r\nBut I'm sorry, I'm not proposing that alternative myself because I don't like it, my change is free diff-wise and I consider rejecting that change another form of \"DoS against development\" that IMO makes less sense than asking people to order includes alphabetically (which at least has some minimal advantages rather than minimal disadvantages). \r\n",
      "created_at" : "2015-05-16T09:42:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5996#issuecomment-102596718",
      "id" : 102596718,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5996",
      "updated_at" : "2015-05-16T09:47:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/102596718",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "@jjtimon I didn't intend to argue, or demand that you have to change this code now after all that time, just tried to explain why this one requires more thorough scrutiny than those other mentioned pulls.\r\n\r\nThat said, the change looks good to me. utACK",
      "created_at" : "2015-05-18T06:27:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5996#issuecomment-102936478",
      "id" : 102936478,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5996",
      "updated_at" : "2015-05-18T06:27:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/102936478",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "I understood that and that's why this one got tests.\r\nRe-reading my comment it sounds overly defensive and almost rude, my apologies. \r\n",
      "created_at" : "2015-05-19T00:05:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5996#issuecomment-103275155",
      "id" : 103275155,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5996",
      "updated_at" : "2015-05-19T00:05:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/103275155",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/5996#discussion_r30702997"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5996"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/30702997"
         }
      },
      "body" : "Nit: You could have added a comment explaining the function AFAIK all main.h functions should include a comment.",
      "commit_id" : "935bd0a447834fa48c218ddae2a5d835a67979ef",
      "created_at" : "2015-05-20T13:50:09Z",
      "diff_hunk" : "@@ -202,7 +202,7 @@ std::string GetWarnings(std::string strFor);\n bool GetTransaction(const uint256 &hash, CTransaction &tx, uint256 &hashBlock, bool fAllowSlow = false);\n /** Find the best known block, and make it the tip of the block chain */\n bool ActivateBestChain(CValidationState &state, CBlock *pblock = NULL);\n-CAmount GetBlockValue(int nHeight, const CAmount& nFees);\n+CAmount GetBlockSubsidy(int nHeight, const Consensus::Params& consensusParams);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5996#discussion_r30702997",
      "id" : 30702997,
      "original_commit_id" : "935bd0a447834fa48c218ddae2a5d835a67979ef",
      "original_position" : 5,
      "path" : "src/main.h",
      "position" : 5,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5996",
      "updated_at" : "2015-05-20T13:50:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/30702997",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1419649?v=3",
         "events_url" : "https://api.github.com/users/Diapolo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Diapolo/followers",
         "following_url" : "https://api.github.com/users/Diapolo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Diapolo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Diapolo",
         "id" : 1419649,
         "login" : "Diapolo",
         "organizations_url" : "https://api.github.com/users/Diapolo/orgs",
         "received_events_url" : "https://api.github.com/users/Diapolo/received_events",
         "repos_url" : "https://api.github.com/users/Diapolo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Diapolo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Diapolo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Diapolo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/5996#discussion_r30744433"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5996"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/30744433"
         }
      },
      "body" : "That can still be done as an independent PR. Documentation is good, but there's no reason why it has to be added when a function is touched. For example, should I complete the documentation of all functions touched in  #6163 ? Seems orthogonal to me...\r\nAlso I don't see how functions declared main.h should be special in that regard.",
      "commit_id" : "935bd0a447834fa48c218ddae2a5d835a67979ef",
      "created_at" : "2015-05-20T20:19:07Z",
      "diff_hunk" : "@@ -202,7 +202,7 @@ std::string GetWarnings(std::string strFor);\n bool GetTransaction(const uint256 &hash, CTransaction &tx, uint256 &hashBlock, bool fAllowSlow = false);\n /** Find the best known block, and make it the tip of the block chain */\n bool ActivateBestChain(CValidationState &state, CBlock *pblock = NULL);\n-CAmount GetBlockValue(int nHeight, const CAmount& nFees);\n+CAmount GetBlockSubsidy(int nHeight, const Consensus::Params& consensusParams);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5996#discussion_r30744433",
      "id" : 30744433,
      "original_commit_id" : "935bd0a447834fa48c218ddae2a5d835a67979ef",
      "original_position" : 5,
      "path" : "src/main.h",
      "position" : 5,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5996",
      "updated_at" : "2015-05-20T20:19:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/30744433",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   }
]
