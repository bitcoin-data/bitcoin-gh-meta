[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [ccdle12](https://github.com/bitcoin/bitcoin/pull/27534#issuecomment-1531657509) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#27491](https://github.com/bitcoin/bitcoin/pull/27491) (refactor: Move chain constants to the util library by TheCharlatan)\n* [#27407](https://github.com/bitcoin/bitcoin/pull/27407) (net, refactor: Privatise CNode send queue by dergoegge)\n* [#27213](https://github.com/bitcoin/bitcoin/pull/27213) (p2p: Diversify automatic outbound connections with respect to networks by amitiuttarwar)\n* [#25908](https://github.com/bitcoin/bitcoin/pull/25908) (p2p: remove adjusted time by fanquake)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-04-26T20:21:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27534#issuecomment-1523998461",
      "id" : 1523998461,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27534",
      "node_id" : "IC_kwDOABII585a1l79",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1523998461/reactions"
      },
      "updated_at" : "2023-05-07T02:28:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1523998461",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27534#discussion_r1179500435"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27534"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1179500435"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Would it be better to pass a reference of NetStats to every CNode upon initialization?\r\n\r\nExample: https://github.com/bitcoin/bitcoin/commit/cd0c8eeb0940790b6ba83786d1c9e362d4dc4829\r\n\r\n",
      "commit_id" : "9269b747b2a2d3140353a8bc8fb728093aa3bacb",
      "created_at" : "2023-04-27T17:42:39Z",
      "diff_hunk" : "@@ -421,8 +500,10 @@ class CNode\n \n     const ConnectionType m_conn_type;\n \n-    /** Move all messages from the received queue to the processing queue. */\n-    void MarkReceivedMsgsForProcessing()\n+    /** Move all messages from the received queue to the processing queue.\n+     * Also update the global map of network message statistics.\n+     */\n+    void MarkReceivedMsgsForProcessing(NetStats& net_stats)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27534#discussion_r1179500435",
      "id" : 1179500435,
      "line" : 506,
      "node_id" : "PRRC_kwDOABII585GTb-T",
      "original_commit_id" : "210cf10227d0a6093af2061525052aeaba770b7e",
      "original_line" : 506,
      "original_position" : 104,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 104,
      "pull_request_review_id" : 1404575036,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27534",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1179500435/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-27T17:52:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1179500435",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1823216?v=4",
         "events_url" : "https://api.github.com/users/satsie/events{/privacy}",
         "followers_url" : "https://api.github.com/users/satsie/followers",
         "following_url" : "https://api.github.com/users/satsie/following{/other_user}",
         "gists_url" : "https://api.github.com/users/satsie/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/satsie",
         "id" : 1823216,
         "login" : "satsie",
         "node_id" : "MDQ6VXNlcjE4MjMyMTY=",
         "organizations_url" : "https://api.github.com/users/satsie/orgs",
         "received_events_url" : "https://api.github.com/users/satsie/received_events",
         "repos_url" : "https://api.github.com/users/satsie/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/satsie/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/satsie/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/satsie"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27534#discussion_r1179508199"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27534"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1179508199"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Now that an effort has been made to remove the friendship between CConnman and CNode (see this PR: https://github.com/bitcoin/bitcoin/pull/27257) I'm unsure if this (recording network stats on a CConnman object) belongs here.\r\n\r\nAlso related, is an open PR that would similarly impact the recording of sent stats: https://github.com/bitcoin/bitcoin/pull/27407",
      "commit_id" : "9269b747b2a2d3140353a8bc8fb728093aa3bacb",
      "created_at" : "2023-04-27T17:51:10Z",
      "diff_hunk" : "@@ -2828,6 +2936,12 @@ void CNode::MarkReceivedMsgsForProcessing()\n         // vRecvMsg contains only completed CNetMessage\n         // the single possible partially deserialized message are held by TransportDeserializer\n         nSizeAdded += msg.m_raw_message_size;\n+\n+        net_stats.Record(NetStats::Direction::RECV,\n+                         ConnectedThroughNetwork(),\n+                         m_conn_type,\n+                         msg.m_type,\n+                         msg.m_raw_message_size);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27534#discussion_r1179508199",
      "id" : 1179508199,
      "line" : 2944,
      "node_id" : "PRRC_kwDOABII585GTd3n",
      "original_commit_id" : "210cf10227d0a6093af2061525052aeaba770b7e",
      "original_line" : 2944,
      "original_position" : 153,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 153,
      "pull_request_review_id" : 1404575036,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27534",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1179508199/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-27T17:53:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1179508199",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1823216?v=4",
         "events_url" : "https://api.github.com/users/satsie/events{/privacy}",
         "followers_url" : "https://api.github.com/users/satsie/followers",
         "following_url" : "https://api.github.com/users/satsie/following{/other_user}",
         "gists_url" : "https://api.github.com/users/satsie/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/satsie",
         "id" : 1823216,
         "login" : "satsie",
         "node_id" : "MDQ6VXNlcjE4MjMyMTY=",
         "organizations_url" : "https://api.github.com/users/satsie/orgs",
         "received_events_url" : "https://api.github.com/users/satsie/received_events",
         "repos_url" : "https://api.github.com/users/satsie/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/satsie/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/satsie/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/satsie"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27534#discussion_r1179509345"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27534"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1179509345"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This was moved over from net.cpp. Should it be in the NetMsgType namespace? If so, what about the allNetMessageTypes array? There are places in this PR where I have to add +1 to account for the missing 'other' message type, and I'm not sure if it's appropriate for this to be a special case.",
      "commit_id" : "9269b747b2a2d3140353a8bc8fb728093aa3bacb",
      "created_at" : "2023-04-27T17:52:26Z",
      "diff_hunk" : "@@ -49,6 +49,8 @@ const char *WTXIDRELAY=\"wtxidrelay\";\n const char *SENDTXRCNCL=\"sendtxrcncl\";\n } // namespace NetMsgType\n \n+const std::string NET_MESSAGE_TYPE_OTHER = \"*other*\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27534#discussion_r1179509345",
      "id" : 1179509345,
      "line" : 52,
      "node_id" : "PRRC_kwDOABII585GTeJh",
      "original_commit_id" : "210cf10227d0a6093af2061525052aeaba770b7e",
      "original_line" : 52,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/protocol.cpp",
      "position" : 4,
      "pull_request_review_id" : 1404575036,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27534",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1179509345/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-27T17:52:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1179509345",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1823216?v=4",
         "events_url" : "https://api.github.com/users/satsie/events{/privacy}",
         "followers_url" : "https://api.github.com/users/satsie/followers",
         "following_url" : "https://api.github.com/users/satsie/following{/other_user}",
         "gists_url" : "https://api.github.com/users/satsie/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/satsie",
         "id" : 1823216,
         "login" : "satsie",
         "node_id" : "MDQ6VXNlcjE4MjMyMTY=",
         "organizations_url" : "https://api.github.com/users/satsie/orgs",
         "received_events_url" : "https://api.github.com/users/satsie/received_events",
         "repos_url" : "https://api.github.com/users/satsie/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/satsie/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/satsie/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/satsie"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27534#discussion_r1179532400"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27534"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1179532400"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Would it be a good idea for this class to be in its own file/compilation unit, rather than added into `net.h` (which is included in 40+ other files)?",
      "commit_id" : "9269b747b2a2d3140353a8bc8fb728093aa3bacb",
      "created_at" : "2023-04-27T18:16:19Z",
      "diff_hunk" : "@@ -345,6 +344,86 @@ class V1TransportSerializer : public TransportSerializer {\n     void prepareForTransport(CSerializedNetMsg& msg, std::vector<unsigned char>& header) const override;\n };\n \n+/**\n+ * Placeholder for total network traffic. Split by direction, network, connection\n+ * type and message type (byte and message counts).\n+ */\n+class NetStats",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27534#discussion_r1179532400",
      "id" : 1179532400,
      "line" : 351,
      "node_id" : "PRRC_kwDOABII585GTjxw",
      "original_commit_id" : "210cf10227d0a6093af2061525052aeaba770b7e",
      "original_line" : 351,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 16,
      "pull_request_review_id" : 1404629427,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27534",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1179532400/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-27T18:52:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1179532400",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27534#discussion_r1179538880"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27534"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1179538880"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Not sure if these to/from util helper methods are needed or if this is the right place for them rather than in their respective domains where available, like `node/connection_type` and `node/network` (the latter proposed in #27385).\r\n\r\nUnrelated, can also make the declaration of new methods that return a value [`[[nodiscard]]`](https://en.cppreference.com/w/cpp/language/attributes/nodiscard).",
      "commit_id" : "9269b747b2a2d3140353a8bc8fb728093aa3bacb",
      "created_at" : "2023-04-27T18:23:44Z",
      "diff_hunk" : "@@ -345,6 +344,86 @@ class V1TransportSerializer : public TransportSerializer {\n     void prepareForTransport(CSerializedNetMsg& msg, std::vector<unsigned char>& header) const override;\n };\n \n+/**\n+ * Placeholder for total network traffic. Split by direction, network, connection\n+ * type and message type (byte and message counts).\n+ */\n+class NetStats\n+{\n+public:\n+    struct MsgStat {\n+        std::atomic_uint64_t byte_count; //!< Number of bytes transferred.\n+        std::atomic_uint64_t msg_count;  //!< Number of messages transferred.\n+\n+        MsgStat() : byte_count{0}, msg_count{0} {}\n+\n+        MsgStat(const MsgStat& x) : byte_count{x.byte_count.load()}, msg_count{x.msg_count.load()} {}\n+\n+        MsgStat(std::atomic_uint64_t x, std::atomic_uint64_t y) : byte_count{x.load()}, msg_count{y.load()} {}\n+    };\n+\n+    enum class Direction { SENT,\n+                            RECV };\n+\n+    /// Number of elements in `Direction`.\n+    static constexpr size_t NUM_DIRECTIONS{2};\n+\n+    using MultiDimensionalStats = std::array<std::array<std::array<std::array<MsgStat,\n+                                                                                // add 1 for the other message type\n+                                                                                NUM_NET_MESSAGE_TYPES + 1>,\n+                                                                    NUM_CONNECTION_TYPES>,\n+                                                        NET_MAX>,\n+                                                NUM_DIRECTIONS>;\n+\n+    MultiDimensionalStats m_data;\n+\n+    void Init()\n+    {\n+        for (std::size_t direction_index = 0; direction_index < NUM_DIRECTIONS; direction_index++) {\n+            for (int network_index = 0; network_index < NET_MAX; network_index++) {\n+                for (std::size_t connection_index = 0; connection_index < NUM_CONNECTION_TYPES; connection_index++) {\n+                    for (std::size_t message_index = 0; message_index < NUM_NET_MESSAGE_TYPES + 1; message_index++) {\n+                        // +1 for the \"other\" message type\n+                        auto& stat = m_data.at(direction_index)\n+                                           .at(network_index)\n+                                           .at(connection_index)\n+                                           .at(message_index);\n+\n+                        stat.msg_count = 0;\n+                        stat.byte_count = 0;\n+                    }\n+                }\n+            }\n+        }\n+    }\n+\n+    /**\n+     * Increment the amount of bytes transferred by `bytes` and the amount of messages by 1.\n+     */\n+    void Record(Direction direction,\n+                Network net,\n+                ConnectionType conn_type,\n+                const std::string& msg_type,\n+                size_t byte_count);\n+\n+    // The ...FromIndex() and ...ToIndex() methods below convert from/to\n+    // indexes of `m_data[]` to the actual values they represent. For example,\n+    // assuming MessageTypeToIndex(\"ping\") == 15, then everything stored in\n+    // m_data[x][y][z][15] is traffic from \"ping\" messages (for any x, y or z).\n+\n+    static Direction DirectionFromIndex(size_t index);\n+    static Network NetworkFromIndex(size_t index);\n+    static ConnectionType ConnectionTypeFromIndex(size_t index);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27534#discussion_r1179538880",
      "id" : 1179538880,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585GTlXA",
      "original_commit_id" : "210cf10227d0a6093af2061525052aeaba770b7e",
      "original_line" : 416,
      "original_position" : 81,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 1404629427,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27534",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1179538880/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-27T18:55:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1179538880",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27534#discussion_r1179540855"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27534"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1179540855"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Perhaps consider putting all this new code in its own `rpc/netstats` files.",
      "commit_id" : "9269b747b2a2d3140353a8bc8fb728093aa3bacb",
      "created_at" : "2023-04-27T18:25:59Z",
      "diff_hunk" : "@@ -509,6 +511,396 @@ static RPCHelpMan getaddednodeinfo()\n     };\n }\n \n+namespace net_stats {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27534#discussion_r1179540855",
      "id" : 1179540855,
      "line" : 514,
      "node_id" : "PRRC_kwDOABII585GTl13",
      "original_commit_id" : "210cf10227d0a6093af2061525052aeaba770b7e",
      "original_line" : 514,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : 20,
      "pull_request_review_id" : 1404629427,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27534",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1179540855/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-27T18:52:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1179540855",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27534#discussion_r1179543384"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27534"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1179543384"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit unless I'm missing something, https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#f16-for-in-parameters-pass-cheaply-copied-types-by-value-and-others-by-reference-to-const",
      "commit_id" : "9269b747b2a2d3140353a8bc8fb728093aa3bacb",
      "created_at" : "2023-04-27T18:28:53Z",
      "diff_hunk" : "@@ -266,9 +266,20 @@ extern const char* WTXIDRELAY;\n extern const char* SENDTXRCNCL;\n }; // namespace NetMsgType\n \n+extern const std::string NET_MESSAGE_TYPE_OTHER;\n+\n+/* Number of entries in allNetMessageTypes in protocol.cpp */\n+static constexpr size_t NUM_NET_MESSAGE_TYPES{35};\n+\n /* Get a vector of all valid message types (see above) */\n const std::vector<std::string>& getAllNetMessageTypes();\n \n+/* Get the index of a message type from the vector of all message types */\n+int messageTypeToIndex(std::string msg_type);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27534#discussion_r1179543384",
      "id" : 1179543384,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585GTmdY",
      "original_commit_id" : "210cf10227d0a6093af2061525052aeaba770b7e",
      "original_line" : 278,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/protocol.h",
      "position" : null,
      "pull_request_review_id" : 1404629427,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27534",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1179543384/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-27T18:52:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1179543384",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27534#discussion_r1179553879"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27534"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1179553879"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Perhaps better to calculate this programmatically, so it doesn't need to be updated, as there are multiple pulls IIRC that propose to add more such types.",
      "commit_id" : "9269b747b2a2d3140353a8bc8fb728093aa3bacb",
      "created_at" : "2023-04-27T18:41:31Z",
      "diff_hunk" : "@@ -76,6 +77,9 @@ enum class ConnectionType {\n     ADDR_FETCH,\n };\n \n+/** Number of entries in ConnectionType. */\n+static constexpr size_t NUM_CONNECTION_TYPES{6};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27534#discussion_r1179553879",
      "id" : 1179553879,
      "line" : 81,
      "node_id" : "PRRC_kwDOABII585GTpBX",
      "original_commit_id" : "210cf10227d0a6093af2061525052aeaba770b7e",
      "original_line" : 81,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/node/connection_types.h",
      "position" : 15,
      "pull_request_review_id" : 1404629427,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27534",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1179553879/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-27T18:53:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1179553879",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27534#discussion_r1181755516"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27534"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1181755516"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Agree with the idea of programmatic calculation. I noticed [NET_MAX](https://github.com/bitcoin/bitcoin/blob/v25.0rc1/src/netaddress.h#L68) in `netaddress.h` accomplishes this by adding an enum value to the end of the list. That new value serves as a counter for all the enums. I initially implemented these (number of connection and message types) in that same manner because it seemed more programmatic. As long as new enums were inserted before, then I figured they would be accounted for in the total.\r\n\r\nHowever, l Iater got feedback and the unreliability of mapping enums to integers was brought to my attention. Every single enum needs to be explicitly mapped to an integer, and if you're going to go through the trouble of that, then it comes out to be basically the same amount of work to make a standalone constant. There's also something that doesn't feel consistent about having an enum that accounts for the total living alongside the enum values that are being counted.\r\n\r\nIn this PR I have a `static assert` checking that `NUM_NET_MESSAGE_TYPES` is what we expect it to be. Would love if there was somehow a way to do that with the number of connection types as well. It's not exactly setting the value in a programmatic way, but it's at least providing some kind of check.\r\n\r\nFrom `src/protocol.cpp`:\r\n```\r\nstatic_assert(NUM_NET_MESSAGE_TYPES == sizeof(allNetMessageTypes) / sizeof(allNetMessageTypes[0]), \"Please update NUM_NET_MESSAGE_TYPES\");\r\n```\r\n",
      "commit_id" : "9269b747b2a2d3140353a8bc8fb728093aa3bacb",
      "created_at" : "2023-05-01T17:49:48Z",
      "diff_hunk" : "@@ -76,6 +77,9 @@ enum class ConnectionType {\n     ADDR_FETCH,\n };\n \n+/** Number of entries in ConnectionType. */\n+static constexpr size_t NUM_CONNECTION_TYPES{6};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27534#discussion_r1181755516",
      "id" : 1181755516,
      "in_reply_to_id" : 1179553879,
      "line" : 81,
      "node_id" : "PRRC_kwDOABII585GcCh8",
      "original_commit_id" : "210cf10227d0a6093af2061525052aeaba770b7e",
      "original_line" : 81,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/node/connection_types.h",
      "position" : 15,
      "pull_request_review_id" : 1407886120,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27534",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1181755516/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-01T17:49:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1181755516",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1823216?v=4",
         "events_url" : "https://api.github.com/users/satsie/events{/privacy}",
         "followers_url" : "https://api.github.com/users/satsie/followers",
         "following_url" : "https://api.github.com/users/satsie/following{/other_user}",
         "gists_url" : "https://api.github.com/users/satsie/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/satsie",
         "id" : 1823216,
         "login" : "satsie",
         "node_id" : "MDQ6VXNlcjE4MjMyMTY=",
         "organizations_url" : "https://api.github.com/users/satsie/orgs",
         "received_events_url" : "https://api.github.com/users/satsie/received_events",
         "repos_url" : "https://api.github.com/users/satsie/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/satsie/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/satsie/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/satsie"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27534#discussion_r1181764326"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27534"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1181764326"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ooooo thank you! I never would have caught this. Fixed and rebased: https://github.com/bitcoin/bitcoin/pull/27534/commits/5ed0c78efd9e43bcb84d85c257081e224cf5e69f",
      "commit_id" : "9269b747b2a2d3140353a8bc8fb728093aa3bacb",
      "created_at" : "2023-05-01T18:01:20Z",
      "diff_hunk" : "@@ -266,9 +266,20 @@ extern const char* WTXIDRELAY;\n extern const char* SENDTXRCNCL;\n }; // namespace NetMsgType\n \n+extern const std::string NET_MESSAGE_TYPE_OTHER;\n+\n+/* Number of entries in allNetMessageTypes in protocol.cpp */\n+static constexpr size_t NUM_NET_MESSAGE_TYPES{35};\n+\n /* Get a vector of all valid message types (see above) */\n const std::vector<std::string>& getAllNetMessageTypes();\n \n+/* Get the index of a message type from the vector of all message types */\n+int messageTypeToIndex(std::string msg_type);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27534#discussion_r1181764326",
      "id" : 1181764326,
      "in_reply_to_id" : 1179543384,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585GcErm",
      "original_commit_id" : "210cf10227d0a6093af2061525052aeaba770b7e",
      "original_line" : 278,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/protocol.h",
      "position" : null,
      "pull_request_review_id" : 1407899294,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27534",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1181764326/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-01T18:01:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1181764326",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1823216?v=4",
         "events_url" : "https://api.github.com/users/satsie/events{/privacy}",
         "followers_url" : "https://api.github.com/users/satsie/followers",
         "following_url" : "https://api.github.com/users/satsie/following{/other_user}",
         "gists_url" : "https://api.github.com/users/satsie/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/satsie",
         "id" : 1823216,
         "login" : "satsie",
         "node_id" : "MDQ6VXNlcjE4MjMyMTY=",
         "organizations_url" : "https://api.github.com/users/satsie/orgs",
         "received_events_url" : "https://api.github.com/users/satsie/received_events",
         "repos_url" : "https://api.github.com/users/satsie/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/satsie/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/satsie/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/satsie"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27534#discussion_r1181791254"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27534"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1181791254"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I agree with the questioning of where these util methods belong.\r\n\r\nI didn't know about `[[nodiscard]]`. Cool feature! Added it to the public `*(to/from)Index` and private `*ToIndex` methods by this comment. New commit after update + rebase: https://github.com/bitcoin/bitcoin/pull/27534/commits/fc86267b0ece8d31915a4869741f4602622f2bcb\r\n\r\nI may end up adding it to more stuff as I work through the code, but did not do a full sweep of additional areas where it could be applied.",
      "commit_id" : "9269b747b2a2d3140353a8bc8fb728093aa3bacb",
      "created_at" : "2023-05-01T18:40:15Z",
      "diff_hunk" : "@@ -345,6 +344,86 @@ class V1TransportSerializer : public TransportSerializer {\n     void prepareForTransport(CSerializedNetMsg& msg, std::vector<unsigned char>& header) const override;\n };\n \n+/**\n+ * Placeholder for total network traffic. Split by direction, network, connection\n+ * type and message type (byte and message counts).\n+ */\n+class NetStats\n+{\n+public:\n+    struct MsgStat {\n+        std::atomic_uint64_t byte_count; //!< Number of bytes transferred.\n+        std::atomic_uint64_t msg_count;  //!< Number of messages transferred.\n+\n+        MsgStat() : byte_count{0}, msg_count{0} {}\n+\n+        MsgStat(const MsgStat& x) : byte_count{x.byte_count.load()}, msg_count{x.msg_count.load()} {}\n+\n+        MsgStat(std::atomic_uint64_t x, std::atomic_uint64_t y) : byte_count{x.load()}, msg_count{y.load()} {}\n+    };\n+\n+    enum class Direction { SENT,\n+                            RECV };\n+\n+    /// Number of elements in `Direction`.\n+    static constexpr size_t NUM_DIRECTIONS{2};\n+\n+    using MultiDimensionalStats = std::array<std::array<std::array<std::array<MsgStat,\n+                                                                                // add 1 for the other message type\n+                                                                                NUM_NET_MESSAGE_TYPES + 1>,\n+                                                                    NUM_CONNECTION_TYPES>,\n+                                                        NET_MAX>,\n+                                                NUM_DIRECTIONS>;\n+\n+    MultiDimensionalStats m_data;\n+\n+    void Init()\n+    {\n+        for (std::size_t direction_index = 0; direction_index < NUM_DIRECTIONS; direction_index++) {\n+            for (int network_index = 0; network_index < NET_MAX; network_index++) {\n+                for (std::size_t connection_index = 0; connection_index < NUM_CONNECTION_TYPES; connection_index++) {\n+                    for (std::size_t message_index = 0; message_index < NUM_NET_MESSAGE_TYPES + 1; message_index++) {\n+                        // +1 for the \"other\" message type\n+                        auto& stat = m_data.at(direction_index)\n+                                           .at(network_index)\n+                                           .at(connection_index)\n+                                           .at(message_index);\n+\n+                        stat.msg_count = 0;\n+                        stat.byte_count = 0;\n+                    }\n+                }\n+            }\n+        }\n+    }\n+\n+    /**\n+     * Increment the amount of bytes transferred by `bytes` and the amount of messages by 1.\n+     */\n+    void Record(Direction direction,\n+                Network net,\n+                ConnectionType conn_type,\n+                const std::string& msg_type,\n+                size_t byte_count);\n+\n+    // The ...FromIndex() and ...ToIndex() methods below convert from/to\n+    // indexes of `m_data[]` to the actual values they represent. For example,\n+    // assuming MessageTypeToIndex(\"ping\") == 15, then everything stored in\n+    // m_data[x][y][z][15] is traffic from \"ping\" messages (for any x, y or z).\n+\n+    static Direction DirectionFromIndex(size_t index);\n+    static Network NetworkFromIndex(size_t index);\n+    static ConnectionType ConnectionTypeFromIndex(size_t index);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27534#discussion_r1181791254",
      "id" : 1181791254,
      "in_reply_to_id" : 1179538880,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585GcLQW",
      "original_commit_id" : "210cf10227d0a6093af2061525052aeaba770b7e",
      "original_line" : 416,
      "original_position" : 81,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 1407940102,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27534",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1181791254/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-01T18:44:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1181791254",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1823216?v=4",
         "events_url" : "https://api.github.com/users/satsie/events{/privacy}",
         "followers_url" : "https://api.github.com/users/satsie/followers",
         "following_url" : "https://api.github.com/users/satsie/following{/other_user}",
         "gists_url" : "https://api.github.com/users/satsie/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/satsie",
         "id" : 1823216,
         "login" : "satsie",
         "node_id" : "MDQ6VXNlcjE4MjMyMTY=",
         "organizations_url" : "https://api.github.com/users/satsie/orgs",
         "received_events_url" : "https://api.github.com/users/satsie/received_events",
         "repos_url" : "https://api.github.com/users/satsie/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/satsie/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/satsie/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/satsie"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thank you for taking a look @jonatack! :pray: All your comments on code organization are fair game and something I've wondered myself. Because I have absolutely zero point of reference for any of this, I'm going to to leave your comments about organization open with the hopes of getting more feedback.",
      "created_at" : "2023-05-01T18:45:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27534#issuecomment-1530063074",
      "id" : 1530063074,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27534",
      "node_id" : "IC_kwDOABII585bMuji",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1530063074/reactions"
      },
      "updated_at" : "2023-05-01T18:45:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1530063074",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1823216?v=4",
         "events_url" : "https://api.github.com/users/satsie/events{/privacy}",
         "followers_url" : "https://api.github.com/users/satsie/followers",
         "following_url" : "https://api.github.com/users/satsie/following{/other_user}",
         "gists_url" : "https://api.github.com/users/satsie/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/satsie",
         "id" : 1823216,
         "login" : "satsie",
         "node_id" : "MDQ6VXNlcjE4MjMyMTY=",
         "organizations_url" : "https://api.github.com/users/satsie/orgs",
         "received_events_url" : "https://api.github.com/users/satsie/received_events",
         "repos_url" : "https://api.github.com/users/satsie/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/satsie/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/satsie/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/satsie"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27534#discussion_r1182690915"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27534"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1182690915"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "\r\nnit: This constructor could use the default keyword since `byte_count` and `msg_count` will default to 0.\r\n\r\ne.g. https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#c80-use-default-if-you-have-to-be-explicit-about-using-the-default-semantics\r\n\r\n```\r\n MsgStat() = default;\r\n ```",
      "commit_id" : "9269b747b2a2d3140353a8bc8fb728093aa3bacb",
      "created_at" : "2023-05-02T15:11:50Z",
      "diff_hunk" : "@@ -345,6 +344,40 @@ class V1TransportSerializer : public TransportSerializer {\n     void prepareForTransport(CSerializedNetMsg& msg, std::vector<unsigned char>& header) const override;\n };\n \n+/**\n+ * Placeholder for total network traffic. Split by direction, network, connection\n+ * type and message type (byte and message counts).\n+ */\n+class NetStats\n+{\n+public:\n+    struct MsgStat {\n+        std::atomic_uint64_t byte_count; //!< Number of bytes transferred.\n+        std::atomic_uint64_t msg_count;  //!< Number of messages transferred.\n+\n+        MsgStat() : byte_count{0}, msg_count{0} {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27534#discussion_r1182690915",
      "id" : 1182690915,
      "line" : 358,
      "node_id" : "PRRC_kwDOABII585Gfm5j",
      "original_commit_id" : "689a0cb0adf9e05eb9ded41a95126275c4a13e81",
      "original_line" : 358,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 23,
      "pull_request_review_id" : 1409325178,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27534",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1182690915/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-02T15:11:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1182690915",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/18324680?v=4",
         "events_url" : "https://api.github.com/users/ccdle12/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ccdle12/followers",
         "following_url" : "https://api.github.com/users/ccdle12/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ccdle12/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ccdle12",
         "id" : 18324680,
         "login" : "ccdle12",
         "node_id" : "MDQ6VXNlcjE4MzI0Njgw",
         "organizations_url" : "https://api.github.com/users/ccdle12/orgs",
         "received_events_url" : "https://api.github.com/users/ccdle12/received_events",
         "repos_url" : "https://api.github.com/users/ccdle12/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ccdle12/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ccdle12/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ccdle12"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27534#discussion_r1182691546"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27534"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1182691546"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "According to this review comment: https://github.com/bitcoin/bitcoin/pull/27257#discussion_r1146305999 - It looks like it would be preferable for CNode to have net_stats as a member variable (I could be wrong) but that might mean each CNode would need to have a shared_ptr to a NetStats instance.",
      "commit_id" : "9269b747b2a2d3140353a8bc8fb728093aa3bacb",
      "created_at" : "2023-05-02T15:12:22Z",
      "diff_hunk" : "@@ -421,8 +500,10 @@ class CNode\n \n     const ConnectionType m_conn_type;\n \n-    /** Move all messages from the received queue to the processing queue. */\n-    void MarkReceivedMsgsForProcessing()\n+    /** Move all messages from the received queue to the processing queue.\n+     * Also update the global map of network message statistics.\n+     */\n+    void MarkReceivedMsgsForProcessing(NetStats& net_stats)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27534#discussion_r1182691546",
      "id" : 1182691546,
      "in_reply_to_id" : 1179500435,
      "line" : 506,
      "node_id" : "PRRC_kwDOABII585GfnDa",
      "original_commit_id" : "210cf10227d0a6093af2061525052aeaba770b7e",
      "original_line" : 506,
      "original_position" : 104,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 104,
      "pull_request_review_id" : 1409326197,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27534",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1182691546/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-02T15:12:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1182691546",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/18324680?v=4",
         "events_url" : "https://api.github.com/users/ccdle12/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ccdle12/followers",
         "following_url" : "https://api.github.com/users/ccdle12/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ccdle12/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ccdle12",
         "id" : 18324680,
         "login" : "ccdle12",
         "node_id" : "MDQ6VXNlcjE4MzI0Njgw",
         "organizations_url" : "https://api.github.com/users/ccdle12/orgs",
         "received_events_url" : "https://api.github.com/users/ccdle12/received_events",
         "repos_url" : "https://api.github.com/users/ccdle12/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ccdle12/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ccdle12/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ccdle12"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept tACK - left a few very minor comments, happy to keep testing and reviewing in more depth",
      "created_at" : "2023-05-02T15:14:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27534#issuecomment-1531657509",
      "id" : 1531657509,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27534",
      "node_id" : "IC_kwDOABII585bSz0l",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1531657509/reactions"
      },
      "updated_at" : "2023-05-02T15:14:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1531657509",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/18324680?v=4",
         "events_url" : "https://api.github.com/users/ccdle12/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ccdle12/followers",
         "following_url" : "https://api.github.com/users/ccdle12/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ccdle12/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ccdle12",
         "id" : 18324680,
         "login" : "ccdle12",
         "node_id" : "MDQ6VXNlcjE4MzI0Njgw",
         "organizations_url" : "https://api.github.com/users/ccdle12/orgs",
         "received_events_url" : "https://api.github.com/users/ccdle12/received_events",
         "repos_url" : "https://api.github.com/users/ccdle12/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ccdle12/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ccdle12/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ccdle12"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27534#discussion_r1190350382"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27534"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1190350382"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ooooo thank you! C++ rookie here :smile: \r\n\r\nFixed in f5c8b5f78f93bea96e6846ef9d5b787269029b50",
      "commit_id" : "3e0a98c35e8ca2ce9a581da279e8458ba6855697",
      "created_at" : "2023-05-10T20:11:26Z",
      "diff_hunk" : "@@ -345,6 +344,40 @@ class V1TransportSerializer : public TransportSerializer {\n     void prepareForTransport(CSerializedNetMsg& msg, std::vector<unsigned char>& header) const override;\n };\n \n+/**\n+ * Placeholder for total network traffic. Split by direction, network, connection\n+ * type and message type (byte and message counts).\n+ */\n+class NetStats\n+{\n+public:\n+    struct MsgStat {\n+        std::atomic_uint64_t byte_count; //!< Number of bytes transferred.\n+        std::atomic_uint64_t msg_count;  //!< Number of messages transferred.\n+\n+        MsgStat() : byte_count{0}, msg_count{0} {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27534#discussion_r1190350382",
      "id" : 1190350382,
      "in_reply_to_id" : 1182690915,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585G804u",
      "original_commit_id" : "689a0cb0adf9e05eb9ded41a95126275c4a13e81",
      "original_line" : 358,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 1421311987,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27534",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1190350382/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-10T20:11:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1190350382",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1823216?v=4",
         "events_url" : "https://api.github.com/users/satsie/events{/privacy}",
         "followers_url" : "https://api.github.com/users/satsie/followers",
         "following_url" : "https://api.github.com/users/satsie/following{/other_user}",
         "gists_url" : "https://api.github.com/users/satsie/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/satsie",
         "id" : 1823216,
         "login" : "satsie",
         "node_id" : "MDQ6VXNlcjE4MjMyMTY=",
         "organizations_url" : "https://api.github.com/users/satsie/orgs",
         "received_events_url" : "https://api.github.com/users/satsie/received_events",
         "repos_url" : "https://api.github.com/users/satsie/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/satsie/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/satsie/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/satsie"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27534#discussion_r1190362272"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27534"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1190362272"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This is a great point. I think I need to take a closer look at some of the refactoring that's going on in `net` in hopes of finding other examples/decisions that support making `NetStats` a member variable in `CNode`. I think the comment you linked to is very relevant.",
      "commit_id" : "3e0a98c35e8ca2ce9a581da279e8458ba6855697",
      "created_at" : "2023-05-10T20:25:39Z",
      "diff_hunk" : "@@ -421,8 +500,10 @@ class CNode\n \n     const ConnectionType m_conn_type;\n \n-    /** Move all messages from the received queue to the processing queue. */\n-    void MarkReceivedMsgsForProcessing()\n+    /** Move all messages from the received queue to the processing queue.\n+     * Also update the global map of network message statistics.\n+     */\n+    void MarkReceivedMsgsForProcessing(NetStats& net_stats)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27534#discussion_r1190362272",
      "id" : 1190362272,
      "in_reply_to_id" : 1179500435,
      "line" : 506,
      "node_id" : "PRRC_kwDOABII585G83yg",
      "original_commit_id" : "210cf10227d0a6093af2061525052aeaba770b7e",
      "original_line" : 506,
      "original_position" : 104,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 104,
      "pull_request_review_id" : 1421329760,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27534",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1190362272/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-10T20:25:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1190362272",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1823216?v=4",
         "events_url" : "https://api.github.com/users/satsie/events{/privacy}",
         "followers_url" : "https://api.github.com/users/satsie/followers",
         "following_url" : "https://api.github.com/users/satsie/following{/other_user}",
         "gists_url" : "https://api.github.com/users/satsie/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/satsie",
         "id" : 1823216,
         "login" : "satsie",
         "node_id" : "MDQ6VXNlcjE4MjMyMTY=",
         "organizations_url" : "https://api.github.com/users/satsie/orgs",
         "received_events_url" : "https://api.github.com/users/satsie/received_events",
         "repos_url" : "https://api.github.com/users/satsie/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/satsie/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/satsie/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/satsie"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thank you for testing and taking a peek at this @ccdle12 :hugs: Appreciate the review and will definitely be taking you up on the offer for a  more in depth review as this evolves! :wink: \r\n\r\nEDIT: also wanted to mention I rebased. I'm guessing DrahtBot is going to remove the label? :eyes: ",
      "created_at" : "2023-05-10T20:27:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27534#issuecomment-1542767255",
      "id" : 1542767255,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27534",
      "node_id" : "IC_kwDOABII585b9MKX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1542767255/reactions"
      },
      "updated_at" : "2023-05-10T20:27:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1542767255",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1823216?v=4",
         "events_url" : "https://api.github.com/users/satsie/events{/privacy}",
         "followers_url" : "https://api.github.com/users/satsie/followers",
         "following_url" : "https://api.github.com/users/satsie/following{/other_user}",
         "gists_url" : "https://api.github.com/users/satsie/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/satsie",
         "id" : 1823216,
         "login" : "satsie",
         "node_id" : "MDQ6VXNlcjE4MjMyMTY=",
         "organizations_url" : "https://api.github.com/users/satsie/orgs",
         "received_events_url" : "https://api.github.com/users/satsie/received_events",
         "repos_url" : "https://api.github.com/users/satsie/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/satsie/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/satsie/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/satsie"
      }
   }
]
