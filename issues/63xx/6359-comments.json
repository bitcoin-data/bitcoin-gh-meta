[
   {
      "body" : "Since I'm still working on this...closing for now. I mainly wanted to ping @theuni and what is here works and is enough to start receiving feedback.",
      "created_at" : "2015-07-02T14:36:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6359#issuecomment-118052171",
      "id" : 118052171,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6359",
      "updated_at" : "2015-07-02T14:37:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/118052171",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "@jtimon I'm not sure it's worth the complication of a factory here. Given that all chainparams and consensusparams are immutable, why not just pass around new instances when necessary? That should still be cheap, and much simpler? Especially given the trend to pass the params around as necessary rather than call Params() directly.\r\n\r\nSomething like:\r\n```c++\r\nstatic CBaseChainParams::Network nCurrentParams = CBaseChainParams::MAX_NETWORK_TYPES;\r\n\r\nconst CChainParams Params() {\r\n    switch (nCurrentParams) {\r\n        case CBaseChainParams::MAIN:\r\n            return CChainParams(CMainParams());\r\n        case CBaseChainParams::TESTNET:\r\n            return CChainParams(CTestNetParams());\r\n        case CBaseChainParams::REGTEST:\r\n            return CChainParams(CRegTestParams());\r\n        default:\r\n            assert(false && \"Unimplemented network\");\r\n            return CChainParams(CMainParams());\r\n    }\r\n}\r\n\r\nvoid SelectParams(CBaseChainParams::Network network) {\r\n    SelectBaseParams(network);\r\n    nCurrentParams = network;\r\n}\r\n```\r\nHell, since there are no virtual functions left (nor should there be), we could even do away with the inheritance and just make CBaseChainParams::Network a ctor arg for CChainParams.",
      "created_at" : "2015-07-02T16:43:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6359#issuecomment-118089634",
      "id" : 118089634,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6359",
      "updated_at" : "2015-07-02T16:46:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/118089634",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "The main point of the factory is that it is not on globals/ because once we're finished \"passing chainparams around\" there should be no need for any global at all: You either take it as parameter or use the factory (this includes removing the SelectParams from ```BasicTestingSetup::BasicTestingSetup()```, since nobody depends on the global and tests can use the factory directly).\r\n\r\nBut if copying the object in the factory (like you do with the ```Params()``` of your example), then the factory doesn't need to return a pointer (it could just be the current parametrized Params() ), and the Container would also be unnecessary (and the same goes for CPolicy).\r\n\r\nThe enum doesn't scale very well once you go beyond -testnet and -regtest (see #5229 in fact, I'm preparing a PR to add infinite new testing altchains). The same happens with the single constructor parameter. \r\nBut you are right, the inheritance is overkill here.\r\nWith a fully parametric constructor the factory can just always call that constructor with different values.\r\nie:\r\n```\r\nCChainParams* Params(const std::string& chain)\r\n{\r\n   if (chain == CBaseChainParams::MAIN)\r\n        return new CChainParams(\"main\", 210000, 750, 950, 1000...);\r\n    else if (chain == CBaseChainParams::TESTNET)\r\n ...\r\n```",
      "created_at" : "2015-07-02T19:22:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6359#issuecomment-118139777",
      "id" : 118139777,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6359",
      "updated_at" : "2015-07-02T19:25:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/118139777",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "@theuni I've been exploring your suggestion and it's not so straight-forward as you may think.\r\nIf Params(string) returns a new object instead of a reference some places will crash, like this one: \r\nhttps://github.com/bitcoin/bitcoin/blob/master/src/test/alert_tests.cpp#L125\r\nIt also means that Params() and BaseParams() have to return a new object as well instead of a const reference.\r\nIt works fine for ParamsBase, which doesn't have a similar &ParamsBase(enum/string) psedo-factory.\r\nBut I really prefer to just remove the interface functions in this case (where it's easy, see https://github.com/jtimon/bitcoin/commit/7fb9f6ad7bad4b64df0fdb36e5230becd2290864 ).\r\nCan we first agree that it will be better to remove SelectParamsFromCommandLine and SelectBaseParamsFromCommandLine before separating the globals?\r\nI have reopened #6235 with that.\r\n@rustyrussell you may be interested in this discussion, or reviewing #6235.\r\n",
      "created_at" : "2015-07-06T14:20:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6359#issuecomment-118870341",
      "id" : 118870341,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6359",
      "updated_at" : "2015-07-06T14:20:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/118870341",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   }
]
