[
   {
      "body" : "This is likely something locking cs_main. That sounds about like the current issue that slows down message processing while ActivateBestChain() is being run with lots of blocks to connect.\r\n\r\nYou could verify that by tailing the log and watching when the gui is frozen. I bet you'll see a stream of \"UpdateTip: new best=\", then unfrozen gui the instant that's done.",
      "created_at" : "2015-06-24T20:02:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6338#issuecomment-114994337",
      "id" : 114994337,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6338",
      "updated_at" : "2015-06-24T20:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/114994337",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "I sent a transaction yesterday that took the two addresses I had in my wallet. Now my wallet is empty, and I for the moment I can no longer reproduce the issue.",
      "created_at" : "2015-06-25T17:15:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6338#issuecomment-115327659",
      "id" : 115327659,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6338",
      "updated_at" : "2015-06-25T17:15:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/115327659",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6033231?v=3",
         "events_url" : "https://api.github.com/users/stevenwagner/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stevenwagner/followers",
         "following_url" : "https://api.github.com/users/stevenwagner/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stevenwagner/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stevenwagner",
         "id" : 6033231,
         "login" : "stevenwagner",
         "organizations_url" : "https://api.github.com/users/stevenwagner/orgs",
         "received_events_url" : "https://api.github.com/users/stevenwagner/received_events",
         "repos_url" : "https://api.github.com/users/stevenwagner/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stevenwagner/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stevenwagner/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stevenwagner"
      }
   },
   {
      "body" : "I have added funds to my wallet, but currently am not able to duplicate the issue. I believe this means the issue was in creation of the tree in the coin selection dialog for the specific transactions I previously held. ",
      "created_at" : "2015-06-26T20:54:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6338#issuecomment-115877416",
      "id" : 115877416,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6338",
      "updated_at" : "2015-06-26T20:54:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/115877416",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6033231?v=3",
         "events_url" : "https://api.github.com/users/stevenwagner/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stevenwagner/followers",
         "following_url" : "https://api.github.com/users/stevenwagner/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stevenwagner/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stevenwagner",
         "id" : 6033231,
         "login" : "stevenwagner",
         "organizations_url" : "https://api.github.com/users/stevenwagner/orgs",
         "received_events_url" : "https://api.github.com/users/stevenwagner/received_events",
         "repos_url" : "https://api.github.com/users/stevenwagner/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stevenwagner/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stevenwagner/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stevenwagner"
      }
   },
   {
      "body" : "I was able to duplicate it again now. Response times aren't as long as they were before, but still getting delays of around 8 seconds which is substantial and is probably the same issue I originally reported.\r\n\r\nWith  -debug -printtoconsole, ...\r\n\r\nwhen I am seeing these msgs, the 'Inputs...' button response just fine, no issue.\r\n\r\ngot inv: tx a79c3767db0e08c8fd2f25f3d35dd0d526631c42d5fa199a1b639b8f35d27b69  have peer=7\r\nreceived: inv (37 bytes) peer=9\r\ngot inv: tx c3df9219382981d3ea4126e42af99c7079a213c9f93551cb16c2fdd758afedca  new peer=9\r\naskfor tx c3df9219382981d3ea4126e42af99c7079a213c9f93551cb16c2fdd758afedca  0 (00:00:00) peer=9\r\nRequesting tx c3df9219382981d3ea4126e42af99c7079a213c9f93551cb16c2fdd758afedca peer=9\r\nsending: getdata (37 bytes) peer=9\r\nreceived: inv (37 bytes) peer=11\r\n\r\nOn the other hand, when these msgs are coming up, the 'Inputs...' button is not responding and bitcoin-qt is unresponsive.\r\n\r\nestimates: for confirming within 0 blocks based on 100/100 samples, fee=0.00077821 BTC/kB, prio=1.6705e+10\r\n...\r\nestimates: for confirming within 24 blocks based on 100/100 samples, fee=0.00001004 BTC/kB, prio=6.13641e+07\r\nUpdateTip: new best=00000000000000000a8fd8b725a30bcabfda90b864d112303dd14d60b1d64501  height=362758  log2_work=82.995042  tx=73548426  date=2015-06-27 09:48:12 progress=0.999290  cache=78161\r\n  - Connect postprocess: 8.43ms [0.25s]\r\n- Connect block: 1677.76ms [50.22s]\r\n  - Load block from disk: 6.18ms [0.19s]\r\n      - Connect 889 transactions: 186.80ms (0.210ms/tx, 0.062ms/txin) [10.53s]\r\n    - Verify 3033 txins: 963.75ms (0.318ms/txin) [47.21s]\r\n    - Index writing: 3.79ms [0.17s]\r\n    - Callbacks: 0.03ms [0.00s]\r\n  - Connect total: 1017.41ms [50.39s]\r\n  - Flush: 12.88ms [0.40s]\r\n  - Writing chainstate: 0.46ms [0.01s]\r\n\r\n@theuni , your hunch that id see \"UpdateTip: new best=\"  was correct.",
      "created_at" : "2015-06-27T22:30:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6338#issuecomment-116163567",
      "id" : 116163567,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6338",
      "updated_at" : "2015-06-27T22:30:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/116163567",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6033231?v=3",
         "events_url" : "https://api.github.com/users/stevenwagner/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stevenwagner/followers",
         "following_url" : "https://api.github.com/users/stevenwagner/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stevenwagner/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stevenwagner",
         "id" : 6033231,
         "login" : "stevenwagner",
         "organizations_url" : "https://api.github.com/users/stevenwagner/orgs",
         "received_events_url" : "https://api.github.com/users/stevenwagner/received_events",
         "repos_url" : "https://api.github.com/users/stevenwagner/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stevenwagner/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stevenwagner/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stevenwagner"
      }
   },
   {
      "body" : "I am noticing some other things which seem related to this issue, probably what @theuni was talking about with \"the current issue that slows down message processing while ActivateBestChain() is being run with lots of blocks to connect.\"\r\n\r\n1- Seem more likely to occur when I am further back in the chain. I am 2 days behind, and the slow down is substantial. I am seeing 'UpdateTip' constantly in the debug, about once per second. Why is it running over and over again?\r\n2- Other things are suspiciously slow as well. Though I have many connections to many peers (9), the blockchain download is going really slow. Looking at the bandwidth graph I am going through long periods of less then 10k throughput of block download with a few short bursts of 100k. Likewise, I am noticing the client still says '2 days behind' for a long time. I am having no connectivity issues.\r\n3- Suddenly my client is all caught up. It went from '2 days behind' to 'Up to date' very quickly. Is it possible that all the blocks were downloaded, but the lag was just in verifying them locally?\r\n4- I noticed in the gui debug window, the Peers tab, that querying agent information from the peers was no visible and apparently bottle necked as well.\r\n\r\nIs there another bug filed for the 'ActivateBestChain' issue?",
      "created_at" : "2015-06-30T15:47:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6338#issuecomment-117234527",
      "id" : 117234527,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6338",
      "updated_at" : "2015-06-30T15:47:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/117234527",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6033231?v=3",
         "events_url" : "https://api.github.com/users/stevenwagner/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stevenwagner/followers",
         "following_url" : "https://api.github.com/users/stevenwagner/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stevenwagner/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stevenwagner",
         "id" : 6033231,
         "login" : "stevenwagner",
         "organizations_url" : "https://api.github.com/users/stevenwagner/orgs",
         "received_events_url" : "https://api.github.com/users/stevenwagner/received_events",
         "repos_url" : "https://api.github.com/users/stevenwagner/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stevenwagner/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stevenwagner/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stevenwagner"
      }
   },
   {
      "body" : "Yes this has been a known issue for a while and is related to holding the `cs_main` lock for a long time while syncing/catching up: #5851,  #5664",
      "created_at" : "2015-07-01T06:17:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6338#issuecomment-117446595",
      "id" : 117446595,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6338",
      "updated_at" : "2015-07-01T06:17:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/117446595",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "I am not longer experiencing this issue in 0.11.0.  Closing.",
      "created_at" : "2015-07-14T00:35:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6338#issuecomment-121098935",
      "id" : 121098935,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6338",
      "updated_at" : "2015-07-14T00:35:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/121098935",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6033231?v=3",
         "events_url" : "https://api.github.com/users/stevenwagner/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stevenwagner/followers",
         "following_url" : "https://api.github.com/users/stevenwagner/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stevenwagner/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stevenwagner",
         "id" : 6033231,
         "login" : "stevenwagner",
         "organizations_url" : "https://api.github.com/users/stevenwagner/orgs",
         "received_events_url" : "https://api.github.com/users/stevenwagner/received_events",
         "repos_url" : "https://api.github.com/users/stevenwagner/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stevenwagner/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stevenwagner/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stevenwagner"
      }
   }
]
