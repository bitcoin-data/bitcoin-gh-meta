[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#bitcoin-core/gui/650](https://github.com/bitcoin-core/gui/pull/650) (Add Import to Wallet GUI by KolbyML)\n* [#27224](https://github.com/bitcoin/bitcoin/pull/27224) (refactor: Remove CAddressBookData::destdata by ryanofsky)\n* [#27215](https://github.com/bitcoin/bitcoin/pull/27215) (wallet: Turn `destdata` entries into  `CAddressBookData` fields by achow101)\n* [#26858](https://github.com/bitcoin/bitcoin/pull/26858) (wallet: Use defined purposes instead of inlining by aureleoules)\n* [#26840](https://github.com/bitcoin/bitcoin/pull/26840) (refactor: importpubkey, importprivkey, importaddress, importmulti, and importdescriptors rpc by KolbyML)\n* [#26836](https://github.com/bitcoin/bitcoin/pull/26836) (wallet: finish addressbook encapsulation by furszy)\n* [#26699](https://github.com/bitcoin/bitcoin/pull/26699) (wallet, gui: bugfix, getAvailableBalance skips selected coins by furszy)\n* [#25620](https://github.com/bitcoin/bitcoin/pull/25620) (wallet: Introduce AddressBookManager by furszy)\n* [#25297](https://github.com/bitcoin/bitcoin/pull/25297) (wallet: group independent db writes on single batched db transaction by furszy)\n* [#24914](https://github.com/bitcoin/bitcoin/pull/24914) (wallet: Load database records in a particular order by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-03-06T22:29:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#issuecomment-1457117597",
      "id" : 1457117597,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27217",
      "node_id" : "IC_kwDOABII585W2dmd",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1457117597/reactions"
      },
      "updated_at" : "2023-03-11T15:29:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1457117597",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1127561494"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1127561494"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit:\r\n\r\n```\r\ntest/functional/wallet_labels.py:76:132: E703 statement ends with a semicolon",
      "commit_id" : "44a2ae100b600bc9c9f4c956223fab3b1948ea8d",
      "created_at" : "2023-03-07T09:11:40Z",
      "diff_hunk" : "@@ -71,6 +71,10 @@ def run_test(self):\n         node = self.nodes[0]\n         assert_equal(len(node.listunspent()), 0)\n \n+        self.log.info(\"Checking listlabels' invalid parameters\")\n+        assert_raises_rpc_error(-8, \"Invalid 'purpose' argument, must be one of 'send', or 'receive'.\", node.listlabels, \"notavalidpurpose\");\n+        assert_raises_rpc_error(-8, \"Invalid 'purpose' argument, must be one of 'send', or 'receive'.\", node.listlabels, \"unknown\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1127561494",
      "id" : 1127561494,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585DNTkW",
      "original_commit_id" : "87f8f8be652f66e22bf4df5241222b4554c2c9d6",
      "original_line" : 76,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "test/functional/wallet_labels.py",
      "position" : null,
      "pull_request_review_id" : 1327941131,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1127561494/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-03-07T09:15:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1127561494",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1127564320"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1127564320"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n        } // no default case so the compiler will warn when a new enum is added\r\n        \r\n```\r\n\r\nnit: typo",
      "commit_id" : "44a2ae100b600bc9c9f4c956223fab3b1948ea8d",
      "created_at" : "2023-03-07T09:14:07Z",
      "diff_hunk" : "@@ -206,10 +207,48 @@ class CAddressBookData\n private:\n     bool m_change{true};\n     std::string m_label;\n-public:\n     std::string purpose;\n+    //! The purpose of this address\n+    interfaces::Wallet::AddressPurpose m_purpose{interfaces::Wallet::AddressPurpose::UNKNOWN};\n+\n+public:\n+    CAddressBookData() {}\n+\n+    static std::string PurposeToString(interfaces::Wallet::AddressPurpose p)\n+    {\n+        switch(p) {\n+        case interfaces::Wallet::AddressPurpose::UNKNOWN:\n+            return \"unknown\";\n+        case interfaces::Wallet::AddressPurpose::RECEIVE:\n+            return \"receive\";\n+        case interfaces::Wallet::AddressPurpose::SEND:\n+            return \"send\";\n+        // no default case so the compiler will warn when a new enum as added\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1127564320",
      "id" : 1127564320,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585DNUQg",
      "original_commit_id" : "87f8f8be652f66e22bf4df5241222b4554c2c9d6",
      "original_line" : 227,
      "original_position" : 30,
      "original_start_line" : 226,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 1327941131,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1127564320/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2023-03-07T09:15:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1127564320",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1127566183"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1127566183"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n            // Any other string is a programming error or disk corruption\r\n```\r\n\r\nnit: This could also happen on disk corruption, no?",
      "commit_id" : "44a2ae100b600bc9c9f4c956223fab3b1948ea8d",
      "created_at" : "2023-03-07T09:15:42Z",
      "diff_hunk" : "@@ -206,10 +207,48 @@ class CAddressBookData\n private:\n     bool m_change{true};\n     std::string m_label;\n-public:\n     std::string purpose;\n+    //! The purpose of this address\n+    interfaces::Wallet::AddressPurpose m_purpose{interfaces::Wallet::AddressPurpose::UNKNOWN};\n+\n+public:\n+    CAddressBookData() {}\n+\n+    static std::string PurposeToString(interfaces::Wallet::AddressPurpose p)\n+    {\n+        switch(p) {\n+        case interfaces::Wallet::AddressPurpose::UNKNOWN:\n+            return \"unknown\";\n+        case interfaces::Wallet::AddressPurpose::RECEIVE:\n+            return \"receive\";\n+        case interfaces::Wallet::AddressPurpose::SEND:\n+            return \"send\";\n+        // no default case so the compiler will warn when a new enum as added\n+        }\n+        assert(false);\n+    }\n+    static interfaces::Wallet::AddressPurpose PurposeFromString(const std::string& s)\n+    {\n+        if (s == \"unknown\") {\n+            return interfaces::Wallet::AddressPurpose::UNKNOWN;\n+        } else if (s == \"receive\") {\n+            return interfaces::Wallet::AddressPurpose::RECEIVE;\n+        } else if (s == \"send\") {\n+            return interfaces::Wallet::AddressPurpose::SEND;\n+        } else {\n+            // Any other string is a programming error",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1127566183",
      "id" : 1127566183,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585DNUtn",
      "original_commit_id" : "87f8f8be652f66e22bf4df5241222b4554c2c9d6",
      "original_line" : 239,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 1327941131,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1127566183/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-03-07T09:15:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1127566183",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1128102630"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1128102630"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed",
      "commit_id" : "44a2ae100b600bc9c9f4c956223fab3b1948ea8d",
      "created_at" : "2023-03-07T15:56:50Z",
      "diff_hunk" : "@@ -71,6 +71,10 @@ def run_test(self):\n         node = self.nodes[0]\n         assert_equal(len(node.listunspent()), 0)\n \n+        self.log.info(\"Checking listlabels' invalid parameters\")\n+        assert_raises_rpc_error(-8, \"Invalid 'purpose' argument, must be one of 'send', or 'receive'.\", node.listlabels, \"notavalidpurpose\");\n+        assert_raises_rpc_error(-8, \"Invalid 'purpose' argument, must be one of 'send', or 'receive'.\", node.listlabels, \"unknown\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1128102630",
      "id" : 1128102630,
      "in_reply_to_id" : 1127561494,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585DPXrm",
      "original_commit_id" : "87f8f8be652f66e22bf4df5241222b4554c2c9d6",
      "original_line" : 76,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "test/functional/wallet_labels.py",
      "position" : null,
      "pull_request_review_id" : 1328900697,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1128102630/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-03-07T15:56:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1128102630",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1128102852"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1128102852"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "44a2ae100b600bc9c9f4c956223fab3b1948ea8d",
      "created_at" : "2023-03-07T15:56:57Z",
      "diff_hunk" : "@@ -206,10 +207,48 @@ class CAddressBookData\n private:\n     bool m_change{true};\n     std::string m_label;\n-public:\n     std::string purpose;\n+    //! The purpose of this address\n+    interfaces::Wallet::AddressPurpose m_purpose{interfaces::Wallet::AddressPurpose::UNKNOWN};\n+\n+public:\n+    CAddressBookData() {}\n+\n+    static std::string PurposeToString(interfaces::Wallet::AddressPurpose p)\n+    {\n+        switch(p) {\n+        case interfaces::Wallet::AddressPurpose::UNKNOWN:\n+            return \"unknown\";\n+        case interfaces::Wallet::AddressPurpose::RECEIVE:\n+            return \"receive\";\n+        case interfaces::Wallet::AddressPurpose::SEND:\n+            return \"send\";\n+        // no default case so the compiler will warn when a new enum as added\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1128102852",
      "id" : 1128102852,
      "in_reply_to_id" : 1127564320,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585DPXvE",
      "original_commit_id" : "87f8f8be652f66e22bf4df5241222b4554c2c9d6",
      "original_line" : 227,
      "original_position" : 30,
      "original_start_line" : 226,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 1328901063,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1128102852/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2023-03-07T15:56:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1128102852",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1128103018"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1128103018"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "44a2ae100b600bc9c9f4c956223fab3b1948ea8d",
      "created_at" : "2023-03-07T15:57:03Z",
      "diff_hunk" : "@@ -206,10 +207,48 @@ class CAddressBookData\n private:\n     bool m_change{true};\n     std::string m_label;\n-public:\n     std::string purpose;\n+    //! The purpose of this address\n+    interfaces::Wallet::AddressPurpose m_purpose{interfaces::Wallet::AddressPurpose::UNKNOWN};\n+\n+public:\n+    CAddressBookData() {}\n+\n+    static std::string PurposeToString(interfaces::Wallet::AddressPurpose p)\n+    {\n+        switch(p) {\n+        case interfaces::Wallet::AddressPurpose::UNKNOWN:\n+            return \"unknown\";\n+        case interfaces::Wallet::AddressPurpose::RECEIVE:\n+            return \"receive\";\n+        case interfaces::Wallet::AddressPurpose::SEND:\n+            return \"send\";\n+        // no default case so the compiler will warn when a new enum as added\n+        }\n+        assert(false);\n+    }\n+    static interfaces::Wallet::AddressPurpose PurposeFromString(const std::string& s)\n+    {\n+        if (s == \"unknown\") {\n+            return interfaces::Wallet::AddressPurpose::UNKNOWN;\n+        } else if (s == \"receive\") {\n+            return interfaces::Wallet::AddressPurpose::RECEIVE;\n+        } else if (s == \"send\") {\n+            return interfaces::Wallet::AddressPurpose::SEND;\n+        } else {\n+            // Any other string is a programming error",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1128103018",
      "id" : 1128103018,
      "in_reply_to_id" : 1127566183,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585DPXxq",
      "original_commit_id" : "87f8f8be652f66e22bf4df5241222b4554c2c9d6",
      "original_line" : 239,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 1328901385,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1128103018/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-03-07T15:57:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1128103018",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1132779833"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1132779833"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: Replace use of purpose strings with an enum\" (44a2ae100b600bc9c9f4c956223fab3b1948ea8d)\r\n\r\nLet's get rid of this unknown enum value. It looks like it was never written to disk and was purely an in-memory value. There are only two `WalletBatch::WritePurpose` calls in the codebase and if you check their callers you can see they are always passing hardcoded \"send\" and \"receive\" or \"\" values. This goes back to #2539 when purpose rows were first added to the database.\r\n\r\nHaving this UNKNOWN value would just be confusing and could be a footgun because you couldn't write a function taking an `AddressPurpose` argument and have the compiler guarantee it was passed a known value.",
      "commit_id" : "44a2ae100b600bc9c9f4c956223fab3b1948ea8d",
      "created_at" : "2023-03-10T19:12:00Z",
      "diff_hunk" : "@@ -57,6 +57,12 @@ using WalletValueMap = std::map<std::string, std::string>;\n class Wallet\n {\n public:\n+    enum class AddressPurpose : uint8_t {\n+        UNKNOWN = 0,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1132779833",
      "id" : 1132779833,
      "line" : 61,
      "node_id" : "PRRC_kwDOABII585DhNk5",
      "original_commit_id" : "44a2ae100b600bc9c9f4c956223fab3b1948ea8d",
      "original_line" : 61,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/interfaces/wallet.h",
      "position" : 5,
      "pull_request_review_id" : 1335473435,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1132779833/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-03-10T20:03:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1132779833",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1132788102"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1132788102"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: Replace use of purpose strings with an enum\" (44a2ae100b600bc9c9f4c956223fab3b1948ea8d)\r\n\r\nIn #2539 there was also a [\"refund\"](https://github.com/bitcoin/bitcoin/blob/a41d5fe01947f2f878c055670986a165af800f9a/src/qt/paymentserver.cpp#L536) purpose, so it might make sense to add a REFUND enum value to allow those wallets to be loaded without triggering an `assert(false)` error in PurposeFromString.",
      "commit_id" : "44a2ae100b600bc9c9f4c956223fab3b1948ea8d",
      "created_at" : "2023-03-10T19:20:56Z",
      "diff_hunk" : "@@ -57,6 +57,12 @@ using WalletValueMap = std::map<std::string, std::string>;\n class Wallet\n {\n public:\n+    enum class AddressPurpose : uint8_t {\n+        UNKNOWN = 0,\n+        RECEIVE = 1,\n+        SEND = 2,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1132788102",
      "id" : 1132788102,
      "line" : 63,
      "node_id" : "PRRC_kwDOABII585DhPmG",
      "original_commit_id" : "44a2ae100b600bc9c9f4c956223fab3b1948ea8d",
      "original_line" : 63,
      "original_position" : 7,
      "original_start_line" : 62,
      "path" : "src/interfaces/wallet.h",
      "position" : 7,
      "pull_request_review_id" : 1335473435,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1132788102/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 62,
      "start_side" : "RIGHT",
      "updated_at" : "2023-03-10T20:03:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1132788102",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1132795600"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1132795600"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: Replace use of purpose strings with an enum\" (44a2ae100b600bc9c9f4c956223fab3b1948ea8d)\r\n\r\nCode style comment: It is a little inconsistent to call .value() in one case but not the other. Personally, I think it would be clearest to write this as `if (purpose == SEND) ... else if (purpose == RECEIVE) else ... ` like the original code, instead of being overly verbose and paranoid about null values, which are already handled sanely by [`operator==`](https://en.cppreference.com/w/cpp/utility/optional/operator_cmp)",
      "commit_id" : "44a2ae100b600bc9c9f4c956223fab3b1948ea8d",
      "created_at" : "2023-03-10T19:28:16Z",
      "diff_hunk" : "@@ -52,16 +52,17 @@ struct AddressTableEntryLessThan\n };\n \n /* Determine address type from address purpose */\n-static AddressTableEntry::Type translateTransactionType(const QString &strPurpose, bool isMine)\n+static AddressTableEntry::Type translateTransactionType(const std::optional<interfaces::Wallet::AddressPurpose>& purpose, bool isMine)\n {\n     AddressTableEntry::Type addressType = AddressTableEntry::Hidden;\n     // \"refund\" addresses aren't shown, and change addresses aren't returned by getAddresses at all.\n-    if (strPurpose == \"send\")\n+    if (!purpose.has_value() || purpose.value() == interfaces::Wallet::AddressPurpose::UNKNOWN) { // if purpose not set, guess\n+        addressType = (isMine ? AddressTableEntry::Receiving : AddressTableEntry::Sending);\n+    } else if (purpose.value() == interfaces::Wallet::AddressPurpose::SEND) {\n         addressType = AddressTableEntry::Sending;\n-    else if (strPurpose == \"receive\")\n+    } else if (purpose == interfaces::Wallet::AddressPurpose::RECEIVE) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1132795600",
      "id" : 1132795600,
      "line" : 63,
      "node_id" : "PRRC_kwDOABII585DhRbQ",
      "original_commit_id" : "44a2ae100b600bc9c9f4c956223fab3b1948ea8d",
      "original_line" : 63,
      "original_position" : 15,
      "original_start_line" : 62,
      "path" : "src/qt/addresstablemodel.cpp",
      "position" : 15,
      "pull_request_review_id" : 1335473435,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1132795600/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 62,
      "start_side" : "RIGHT",
      "updated_at" : "2023-03-10T20:04:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1132795600",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1132814936"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1132814936"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: Replace use of purpose strings with an enum\" (44a2ae100b600bc9c9f4c956223fab3b1948ea8d)\r\n\r\nIt seems like it would be better to do something like log a warning or return an error message if an unrecognized purpose is set here, rather than crashing with an assert.",
      "commit_id" : "44a2ae100b600bc9c9f4c956223fab3b1948ea8d",
      "created_at" : "2023-03-10T19:49:35Z",
      "diff_hunk" : "@@ -347,7 +347,9 @@ ReadKeyValue(CWallet* pwallet, DataStream& ssKey, CDataStream& ssValue,\n         } else if (strType == DBKeys::PURPOSE) {\n             std::string strAddress;\n             ssKey >> strAddress;\n-            ssValue >> pwallet->m_address_book[DecodeDestination(strAddress)].purpose;\n+            std::string purpose_str;\n+            ssValue >> purpose_str;\n+            pwallet->m_address_book[DecodeDestination(strAddress)].SetPurposeFromString(purpose_str);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1132814936",
      "id" : 1132814936,
      "line" : 352,
      "node_id" : "PRRC_kwDOABII585DhWJY",
      "original_commit_id" : "44a2ae100b600bc9c9f4c956223fab3b1948ea8d",
      "original_line" : 352,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : 7,
      "pull_request_review_id" : 1335473435,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1132814936/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-03-10T20:03:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1132814936",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1132816332"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1132816332"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: Replace use of purpose strings with an enum\" (44a2ae100b600bc9c9f4c956223fab3b1948ea8d)\r\n\r\nShould this older purpose field be dropped?",
      "commit_id" : "44a2ae100b600bc9c9f4c956223fab3b1948ea8d",
      "created_at" : "2023-03-10T19:51:36Z",
      "diff_hunk" : "@@ -206,10 +207,47 @@ class CAddressBookData\n private:\n     bool m_change{true};\n     std::string m_label;\n-public:\n     std::string purpose;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1132816332",
      "id" : 1132816332,
      "line" : 210,
      "node_id" : "PRRC_kwDOABII585DhWfM",
      "original_commit_id" : "44a2ae100b600bc9c9f4c956223fab3b1948ea8d",
      "original_line" : 210,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : 13,
      "pull_request_review_id" : 1335473435,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1132816332/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-03-10T20:03:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1132816332",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1132822542"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1132822542"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: Replace use of purpose strings with an enum\" (44a2ae100b600bc9c9f4c956223fab3b1948ea8d)\r\n\r\nIt seems a little misleading to set default address book entry purpose to UNKNOWN, because the purpose of addresses with default entries are known: they are just change addresses used to hold avoid_reuse bookkeeping info.\r\n\r\nSo I think it would probably be better to change type of `m_purpose` field to `optional<AddressPurpose>` and leave it unset, when `m_change` is true, rather making the purpose seem unknown.\r\n\r\nAlternately, could be more ambitious and add an `AddressPurpose::CHANGE` enum value and drop `bool m_change` entirely.\r\n\r\n---\r\n\r\nEDIT: I forgot to mention the other case when purpose will be is UNKNOWN here. It will be UNKNOWN not just for change addresses with avoid_reuse info, but also for addresses from old wallet databases that do not contain \"purpose\" rows. In this latter case, UNKNOWN values would actually be descriptive and not misleading. However, I still think the two suggested alternatives above that drop UNKNOWN would be preferable, because UNKNOWN is misleading in some cases, even if it is not misleading in every case.",
      "commit_id" : "44a2ae100b600bc9c9f4c956223fab3b1948ea8d",
      "created_at" : "2023-03-10T19:59:48Z",
      "diff_hunk" : "@@ -206,10 +207,47 @@ class CAddressBookData\n private:\n     bool m_change{true};\n     std::string m_label;\n-public:\n     std::string purpose;\n+    //! The purpose of this address\n+    interfaces::Wallet::AddressPurpose m_purpose{interfaces::Wallet::AddressPurpose::UNKNOWN};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1132822542",
      "id" : 1132822542,
      "line" : 212,
      "node_id" : "PRRC_kwDOABII585DhYAO",
      "original_commit_id" : "44a2ae100b600bc9c9f4c956223fab3b1948ea8d",
      "original_line" : 212,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : 15,
      "pull_request_review_id" : 1335473435,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1132822542/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-03-10T20:23:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1132822542",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I made some changes to this in a branch that could be adopted https://github.com/ryanofsky/bitcoin/commits/review.27217.1-edit\r\n\r\n- Tries to split commits and add a lot of comments so this is easier to review\r\n- Make enum a public wallet type instead of putting it in interfaces/ so wallet/ code does not depend on interfaces/wallet code and `interfaces::Wallet::AddressPurpose` becomes just `wallet::AddressPurpose`\r\n- Replaced `std::optional<AddressPurpose>` with plain `AddressPurpose` in many places where purpose is known or can be derived from IsMine, to simplify code and avoid bugs.\r\n- Dropped `AddressPurpose::UNKNOWN` to avoid defining an enum value that doesn't have any corresponding value in the wallet database.\r\n- Added `AddressPurpse::REFUND` enum value to be able to load old wallets that may have refund addresses without errors or warnings.\r\n- Changed assert(0) failure when loading wallets with unrecognized purpose strings with a warning.",
      "created_at" : "2023-03-13T21:57:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#issuecomment-1467021441",
      "id" : 1467021441,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27217",
      "node_id" : "IC_kwDOABII585XcPiB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1467021441/reactions"
      },
      "updated_at" : "2023-03-13T21:57:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1467021441",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I made some changes to this in a branch that could be adopted https://github.com/ryanofsky/bitcoin/commits/review.27217.1-edit\r\n\r\nI've adopted these changes.",
      "created_at" : "2023-03-15T17:10:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#issuecomment-1470427455",
      "id" : 1470427455,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27217",
      "node_id" : "IC_kwDOABII585XpPE_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1470427455/reactions"
      },
      "updated_at" : "2023-03-15T17:10:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1470427455",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1137712523"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137712523"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: Replace use of purpose strings with an enum\" (db521d3e89b23046f73410a875bb9660178e3842)\r\n\r\nNote for reviewers: in a few places in this PR, struct order or argument order is changed so the `AddressPurpose` field follows IsMine or IsChange fields. This is done because the fields hold overlapping information, and in most cases new code should rely on the other fields instead of `AddressPurpose`.",
      "commit_id" : "0d18142f595b43070bd07b608d43c9ed9b37cdcc",
      "created_at" : "2023-03-15T20:06:38Z",
      "diff_hunk" : "@@ -352,11 +353,11 @@ struct WalletAddress\n {\n     CTxDestination dest;\n     wallet::isminetype is_mine;\n+    wallet::AddressPurpose purpose;\n     std::string name;\n-    std::string purpose;\n \n-    WalletAddress(CTxDestination dest, wallet::isminetype is_mine, std::string name, std::string purpose)\n-        : dest(std::move(dest)), is_mine(is_mine), name(std::move(name)), purpose(std::move(purpose))\n+    WalletAddress(CTxDestination dest, wallet::isminetype is_mine, wallet::AddressPurpose purpose, std::string name)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1137712523",
      "id" : 1137712523,
      "line" : 359,
      "node_id" : "PRRC_kwDOABII585D0B2L",
      "original_commit_id" : "db521d3e89b23046f73410a875bb9660178e3842",
      "original_line" : 359,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/interfaces/wallet.h",
      "position" : 45,
      "pull_request_review_id" : 1342339656,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137712523/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-15T21:07:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137712523",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1137726714"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137726714"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: Replace use of purpose strings with an enum\" (db521d3e89b23046f73410a875bb9660178e3842)\r\n\r\nWould maybe add a comment like \"// In very old wallets, address purpose may not recorded, so derive it from IsMine value\"",
      "commit_id" : "0d18142f595b43070bd07b608d43c9ed9b37cdcc",
      "created_at" : "2023-03-15T20:16:08Z",
      "diff_hunk" : "@@ -189,29 +189,34 @@ class WalletImpl : public Wallet\n     bool getAddress(const CTxDestination& dest,\n         std::string* name,\n         isminetype* is_mine,\n-        std::string* purpose) override\n+        AddressPurpose* purpose) override\n     {\n         LOCK(m_wallet->cs_wallet);\n         const auto& entry = m_wallet->FindAddressBookEntry(dest, /*allow_change=*/false);\n         if (!entry) return false; // addr not found\n         if (name) {\n             *name = entry->GetLabel();\n         }\n+        std::optional<isminetype> dest_is_mine;\n+        if (is_mine || purpose) {\n+            dest_is_mine = m_wallet->IsMine(dest);\n+        }\n         if (is_mine) {\n-            *is_mine = m_wallet->IsMine(dest);\n+            *is_mine = *dest_is_mine;\n         }\n         if (purpose) {\n-            *purpose = entry->purpose;\n+            *purpose = entry->purpose ? *entry->purpose : *dest_is_mine ? AddressPurpose::RECEIVE : AddressPurpose::SEND;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1137726714",
      "id" : 1137726714,
      "line" : 209,
      "node_id" : "PRRC_kwDOABII585D0FT6",
      "original_commit_id" : "db521d3e89b23046f73410a875bb9660178e3842",
      "original_line" : 209,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "src/wallet/interfaces.cpp",
      "position" : 42,
      "pull_request_review_id" : 1342339656,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137726714/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-15T21:07:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137726714",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1137728596"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137728596"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: Replace use of purpose strings with an enum\" (db521d3e89b23046f73410a875bb9660178e3842)\r\n\r\nCould add the same comment here (\"In very old wallets, address purpose may not recorded, so derive it from IsMine value\")",
      "commit_id" : "0d18142f595b43070bd07b608d43c9ed9b37cdcc",
      "created_at" : "2023-03-15T20:18:11Z",
      "diff_hunk" : "@@ -189,29 +189,34 @@ class WalletImpl : public Wallet\n     bool getAddress(const CTxDestination& dest,\n         std::string* name,\n         isminetype* is_mine,\n-        std::string* purpose) override\n+        AddressPurpose* purpose) override\n     {\n         LOCK(m_wallet->cs_wallet);\n         const auto& entry = m_wallet->FindAddressBookEntry(dest, /*allow_change=*/false);\n         if (!entry) return false; // addr not found\n         if (name) {\n             *name = entry->GetLabel();\n         }\n+        std::optional<isminetype> dest_is_mine;\n+        if (is_mine || purpose) {\n+            dest_is_mine = m_wallet->IsMine(dest);\n+        }\n         if (is_mine) {\n-            *is_mine = m_wallet->IsMine(dest);\n+            *is_mine = *dest_is_mine;\n         }\n         if (purpose) {\n-            *purpose = entry->purpose;\n+            *purpose = entry->purpose ? *entry->purpose : *dest_is_mine ? AddressPurpose::RECEIVE : AddressPurpose::SEND;\n         }\n         return true;\n     }\n     std::vector<WalletAddress> getAddresses() const override\n     {\n         LOCK(m_wallet->cs_wallet);\n         std::vector<WalletAddress> result;\n-        m_wallet->ForEachAddrBookEntry([&](const CTxDestination& dest, const std::string& label, const std::string& purpose, bool is_change) EXCLUSIVE_LOCKS_REQUIRED(m_wallet->cs_wallet) {\n+        m_wallet->ForEachAddrBookEntry([&](const CTxDestination& dest, const std::string& label, bool is_change, const std::optional<AddressPurpose>& purpose) EXCLUSIVE_LOCKS_REQUIRED(m_wallet->cs_wallet) {\n             if (is_change) return;\n-            result.emplace_back(dest, m_wallet->IsMine(dest), label, purpose);\n+            isminetype is_mine = m_wallet->IsMine(dest);\n+            result.emplace_back(dest, is_mine, purpose ? *purpose : is_mine ? AddressPurpose::RECEIVE : AddressPurpose::SEND, label);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1137728596",
      "id" : 1137728596,
      "line" : 221,
      "node_id" : "PRRC_kwDOABII585D0FxU",
      "original_commit_id" : "db521d3e89b23046f73410a875bb9660178e3842",
      "original_line" : 221,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/wallet/interfaces.cpp",
      "position" : 56,
      "pull_request_review_id" : 1342339656,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137728596/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-15T21:07:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137728596",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1137732694"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137732694"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: Replace use of purpose strings with an enum\" (db521d3e89b23046f73410a875bb9660178e3842)\r\n\r\nNote for reviewers: this is preserving previous behavior. Default value for `CAddressBook::purpose` field previously was `\"unknown\"` when a purpose was not recorded, and now it is null which is translated to `\"unknown\"`",
      "commit_id" : "0d18142f595b43070bd07b608d43c9ed9b37cdcc",
      "created_at" : "2023-03-15T20:22:14Z",
      "diff_hunk" : "@@ -677,7 +677,7 @@ RPCHelpMan getaddressesbylabel()\n             // std::set in O(log(N))), UniValue::__pushKV is used instead,\n             // which currently is O(1).\n             UniValue value(UniValue::VOBJ);\n-            value.pushKV(\"purpose\", _purpose);\n+            value.pushKV(\"purpose\", _purpose ? PurposeToString(*_purpose) : \"unknown\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1137732694",
      "id" : 1137732694,
      "line" : 680,
      "node_id" : "PRRC_kwDOABII585D0GxW",
      "original_commit_id" : "db521d3e89b23046f73410a875bb9660178e3842",
      "original_line" : 680,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/addresses.cpp",
      "position" : 35,
      "pull_request_review_id" : 1342339656,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137732694/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-15T21:07:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137732694",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1137736576"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137736576"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: Replace use of purpose strings with an enum\" (db521d3e89b23046f73410a875bb9660178e3842)\r\n\r\nIf not updating the code above, would be good to add `assert(purpose)` or a similar check here, because that condition would indicate a bug.",
      "commit_id" : "0d18142f595b43070bd07b608d43c9ed9b37cdcc",
      "created_at" : "2023-03-15T20:25:44Z",
      "diff_hunk" : "@@ -721,9 +721,15 @@ RPCHelpMan listlabels()\n \n     LOCK(pwallet->cs_wallet);\n \n-    std::string purpose;\n+    std::optional<AddressPurpose> purpose;\n     if (!request.params[0].isNull()) {\n-        purpose = request.params[0].get_str();\n+        std::string purpose_str = request.params[0].get_str();\n+        if (!purpose_str.empty()) {\n+            if (!IsValidPurposeString(purpose_str)) {\n+                throw JSONRPCError(RPC_INVALID_PARAMETER, \"Invalid 'purpose' argument, must be one of 'send', or 'receive'.\");\n+            }\n+            purpose = PurposeFromString(purpose_str);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1137736576",
      "id" : 1137736576,
      "line" : 728,
      "node_id" : "PRRC_kwDOABII585D0HuA",
      "original_commit_id" : "db521d3e89b23046f73410a875bb9660178e3842",
      "original_line" : 728,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/addresses.cpp",
      "position" : 49,
      "pull_request_review_id" : 1342339656,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137736576/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-15T21:07:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137736576",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1137745598"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137745598"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: Replace use of purpose strings with an enum\" (db521d3e89b23046f73410a875bb9660178e3842)\r\n\r\nI think it might be a little better to drop the IsValidPurposeString function and just write:\r\n\r\n```\r\npurpose = PurposeFromString(purpose_str);\r\nif (!purpose) {\r\n    throw JSONRPCError(RPC_INVALID_PARAMETER, \"Invalid purpose argument, must a known purpose string, typically 'send' or 'receive'.\");\r\n}\r\n```\r\n\r\nsince underlying code should work for any past purpose string like \"refund\", or future ones.",
      "commit_id" : "0d18142f595b43070bd07b608d43c9ed9b37cdcc",
      "created_at" : "2023-03-15T20:35:39Z",
      "diff_hunk" : "@@ -721,9 +721,15 @@ RPCHelpMan listlabels()\n \n     LOCK(pwallet->cs_wallet);\n \n-    std::string purpose;\n+    std::optional<AddressPurpose> purpose;\n     if (!request.params[0].isNull()) {\n-        purpose = request.params[0].get_str();\n+        std::string purpose_str = request.params[0].get_str();\n+        if (!purpose_str.empty()) {\n+            if (!IsValidPurposeString(purpose_str)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1137745598",
      "id" : 1137745598,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585D0J6-",
      "original_commit_id" : "db521d3e89b23046f73410a875bb9660178e3842",
      "original_line" : 728,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/addresses.cpp",
      "position" : null,
      "pull_request_review_id" : 1342339656,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137745598/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-15T21:07:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137745598",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1137754658"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137754658"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: Replace use of purpose strings with an enum\" (db521d3e89b23046f73410a875bb9660178e3842)\r\n\r\nThis change should be moved to previous commit \"wallet: add AddressPurpose enum to replace string values\" (2932d7be3cdf3de79b2767735a91180192d4efce), instead of being here. Alternately, could also keep the fixed width type, though IMO it is not helpful.",
      "commit_id" : "0d18142f595b43070bd07b608d43c9ed9b37cdcc",
      "created_at" : "2023-03-15T20:46:03Z",
      "diff_hunk" : "@@ -57,7 +57,7 @@ using isminefilter = std::underlying_type<isminetype>::type;\n  * interfaces and saved for new addresses. It is basically redundant with an\n  * address's IsMine() result.\n  */\n-enum class AddressPurpose : uint8_t {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1137754658",
      "id" : 1137754658,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585D0MIi",
      "original_commit_id" : "db521d3e89b23046f73410a875bb9660178e3842",
      "original_line" : 60,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/types.h",
      "position" : null,
      "pull_request_review_id" : 1342339656,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137754658/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-15T21:07:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137754658",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1137756043"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137756043"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: Replace use of purpose strings with an enum\" (db521d3e89b23046f73410a875bb9660178e3842)\r\n\r\nCould add the same comment suggested previously here above NotifyAddressBookChanged (\"In very old wallets, address purpose may not recorded, so derive it from IsMine value\")",
      "commit_id" : "0d18142f595b43070bd07b608d43c9ed9b37cdcc",
      "created_at" : "2023-03-15T20:47:31Z",
      "diff_hunk" : "@@ -2399,35 +2399,39 @@ DBErrors CWallet::ZapSelectTx(std::vector<uint256>& vHashIn, std::vector<uint256\n     return DBErrors::LOAD_OK;\n }\n \n-bool CWallet::SetAddressBookWithDB(WalletBatch& batch, const CTxDestination& address, const std::string& strName, const std::string& strPurpose)\n+bool CWallet::SetAddressBookWithDB(WalletBatch& batch, const CTxDestination& address, const std::string& strName, const std::optional<AddressPurpose>& new_purpose)\n {\n     bool fUpdated = false;\n     bool is_mine;\n+    std::optional<AddressPurpose> purpose;\n     {\n         LOCK(cs_wallet);\n         std::map<CTxDestination, CAddressBookData>::iterator mi = m_address_book.find(address);\n         fUpdated = (mi != m_address_book.end() && !mi->second.IsChange());\n         m_address_book[address].SetLabel(strName);\n-        if (!strPurpose.empty()) /* update purpose only if requested */\n-            m_address_book[address].purpose = strPurpose;\n         is_mine = IsMine(address) != ISMINE_NO;\n+        if (new_purpose) { /* update purpose only if requested */\n+            purpose = m_address_book[address].purpose = new_purpose;\n+        } else {\n+            purpose = m_address_book[address].purpose;\n+        }\n     }\n     NotifyAddressBookChanged(address, strName, is_mine,\n-                             strPurpose, (fUpdated ? CT_UPDATED : CT_NEW));\n-    if (!strPurpose.empty() && !batch.WritePurpose(EncodeDestination(address), strPurpose))\n+                             purpose ? *purpose : is_mine ? AddressPurpose::RECEIVE : AddressPurpose::SEND,\n+                             (fUpdated ? CT_UPDATED : CT_NEW));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1137756043",
      "id" : 1137756043,
      "line" : 2422,
      "node_id" : "PRRC_kwDOABII585D0MeL",
      "original_commit_id" : "db521d3e89b23046f73410a875bb9660178e3842",
      "original_line" : 2422,
      "original_position" : 46,
      "original_start_line" : 2419,
      "path" : "src/wallet/wallet.cpp",
      "position" : 47,
      "pull_request_review_id" : 1342339656,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137756043/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 2420,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-03-15T21:07:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137756043",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1137760371"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137760371"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: Replace use of purpose strings with an enum\" (db521d3e89b23046f73410a875bb9660178e3842)\r\n\r\ns/spend/spent/",
      "commit_id" : "0d18142f595b43070bd07b608d43c9ed9b37cdcc",
      "created_at" : "2023-03-15T20:51:49Z",
      "diff_hunk" : "@@ -200,28 +201,75 @@ class ReserveDestination\n     void KeepDestination();\n };\n \n-/** Address book data */\n-class CAddressBookData\n+/**\n+ * Address book data.\n+ */\n+struct CAddressBookData\n {\n-private:\n-    bool m_change{true};\n-    std::string m_label;\n-public:\n-    std::string purpose;\n+    /**\n+     * Address label for sending and receiving addresses, most commonly set to\n+     * \"\", which is the default label. Change addresses do not have labels, and\n+     * wallet code uses lack of a label to identify change address for fee\n+     * bumping and listing transactions.\n+     */\n+    std::optional<std::string> label;\n \n-    CAddressBookData() : purpose(\"unknown\") {}\n+    /**\n+     * Address purpose which was originally recorded for payment protocol\n+     * support but now serves as a cached IsMine value. Wallet code should\n+     * not rely on this field being set.\n+     */\n+    std::optional<AddressPurpose> purpose;\n \n+    /**\n+     * Additional address metadata map that can currently hold two types of keys:\n+     *\n+     *   \"used\" keys with values always set to \"p\" if present. This is set on\n+     *       IsMine addresses that have already been spend from if the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1137760371",
      "id" : 1137760371,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585D0Nhz",
      "original_commit_id" : "db521d3e89b23046f73410a875bb9660178e3842",
      "original_line" : 228,
      "original_position" : 44,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 1342339656,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137760371/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-15T21:07:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137760371",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1137773684"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137773684"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: Replace use of purpose strings with an enum\" (db521d3e89b23046f73410a875bb9660178e3842)\r\n\r\nI think the PR might benefit from a release note, or at least a summary of behavior changes in the PR description like, 'Wallet loading code will now issue warnings if addresses have unrecognized purpose strings other than \"send\" \"receive\" and \"refund\" and `listlabels` RPC will raise an error if an unrecognized purpose is requested.'",
      "commit_id" : "0d18142f595b43070bd07b608d43c9ed9b37cdcc",
      "created_at" : "2023-03-15T21:06:49Z",
      "diff_hunk" : "@@ -71,6 +71,10 @@ def run_test(self):\n         node = self.nodes[0]\n         assert_equal(len(node.listunspent()), 0)\n \n+        self.log.info(\"Checking listlabels' invalid parameters\")\n+        assert_raises_rpc_error(-8, \"Invalid 'purpose' argument, must be one of 'send', or 'receive'.\", node.listlabels, \"notavalidpurpose\")\n+        assert_raises_rpc_error(-8, \"Invalid 'purpose' argument, must be one of 'send', or 'receive'.\", node.listlabels, \"unknown\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1137773684",
      "id" : 1137773684,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585D0Qx0",
      "original_commit_id" : "db521d3e89b23046f73410a875bb9660178e3842",
      "original_line" : 76,
      "original_position" : 6,
      "original_start_line" : 74,
      "path" : "test/functional/wallet_labels.py",
      "position" : null,
      "pull_request_review_id" : 1342339656,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137773684/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-03-15T21:07:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137773684",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1140711112"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140711112"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "0d18142f595b43070bd07b608d43c9ed9b37cdcc",
      "created_at" : "2023-03-17T21:10:34Z",
      "diff_hunk" : "@@ -189,29 +189,34 @@ class WalletImpl : public Wallet\n     bool getAddress(const CTxDestination& dest,\n         std::string* name,\n         isminetype* is_mine,\n-        std::string* purpose) override\n+        AddressPurpose* purpose) override\n     {\n         LOCK(m_wallet->cs_wallet);\n         const auto& entry = m_wallet->FindAddressBookEntry(dest, /*allow_change=*/false);\n         if (!entry) return false; // addr not found\n         if (name) {\n             *name = entry->GetLabel();\n         }\n+        std::optional<isminetype> dest_is_mine;\n+        if (is_mine || purpose) {\n+            dest_is_mine = m_wallet->IsMine(dest);\n+        }\n         if (is_mine) {\n-            *is_mine = m_wallet->IsMine(dest);\n+            *is_mine = *dest_is_mine;\n         }\n         if (purpose) {\n-            *purpose = entry->purpose;\n+            *purpose = entry->purpose ? *entry->purpose : *dest_is_mine ? AddressPurpose::RECEIVE : AddressPurpose::SEND;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1140711112",
      "id" : 1140711112,
      "in_reply_to_id" : 1137726714,
      "line" : 209,
      "node_id" : "PRRC_kwDOABII585D_d7I",
      "original_commit_id" : "db521d3e89b23046f73410a875bb9660178e3842",
      "original_line" : 209,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "src/wallet/interfaces.cpp",
      "position" : 42,
      "pull_request_review_id" : 1346742213,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140711112/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-17T21:10:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140711112",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1140711178"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140711178"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "0d18142f595b43070bd07b608d43c9ed9b37cdcc",
      "created_at" : "2023-03-17T21:10:39Z",
      "diff_hunk" : "@@ -189,29 +189,34 @@ class WalletImpl : public Wallet\n     bool getAddress(const CTxDestination& dest,\n         std::string* name,\n         isminetype* is_mine,\n-        std::string* purpose) override\n+        AddressPurpose* purpose) override\n     {\n         LOCK(m_wallet->cs_wallet);\n         const auto& entry = m_wallet->FindAddressBookEntry(dest, /*allow_change=*/false);\n         if (!entry) return false; // addr not found\n         if (name) {\n             *name = entry->GetLabel();\n         }\n+        std::optional<isminetype> dest_is_mine;\n+        if (is_mine || purpose) {\n+            dest_is_mine = m_wallet->IsMine(dest);\n+        }\n         if (is_mine) {\n-            *is_mine = m_wallet->IsMine(dest);\n+            *is_mine = *dest_is_mine;\n         }\n         if (purpose) {\n-            *purpose = entry->purpose;\n+            *purpose = entry->purpose ? *entry->purpose : *dest_is_mine ? AddressPurpose::RECEIVE : AddressPurpose::SEND;\n         }\n         return true;\n     }\n     std::vector<WalletAddress> getAddresses() const override\n     {\n         LOCK(m_wallet->cs_wallet);\n         std::vector<WalletAddress> result;\n-        m_wallet->ForEachAddrBookEntry([&](const CTxDestination& dest, const std::string& label, const std::string& purpose, bool is_change) EXCLUSIVE_LOCKS_REQUIRED(m_wallet->cs_wallet) {\n+        m_wallet->ForEachAddrBookEntry([&](const CTxDestination& dest, const std::string& label, bool is_change, const std::optional<AddressPurpose>& purpose) EXCLUSIVE_LOCKS_REQUIRED(m_wallet->cs_wallet) {\n             if (is_change) return;\n-            result.emplace_back(dest, m_wallet->IsMine(dest), label, purpose);\n+            isminetype is_mine = m_wallet->IsMine(dest);\n+            result.emplace_back(dest, is_mine, purpose ? *purpose : is_mine ? AddressPurpose::RECEIVE : AddressPurpose::SEND, label);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1140711178",
      "id" : 1140711178,
      "in_reply_to_id" : 1137728596,
      "line" : 221,
      "node_id" : "PRRC_kwDOABII585D_d8K",
      "original_commit_id" : "db521d3e89b23046f73410a875bb9660178e3842",
      "original_line" : 221,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/wallet/interfaces.cpp",
      "position" : 56,
      "pull_request_review_id" : 1346742273,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140711178/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-17T21:10:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140711178",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1140711535"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140711535"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "0d18142f595b43070bd07b608d43c9ed9b37cdcc",
      "created_at" : "2023-03-17T21:11:05Z",
      "diff_hunk" : "@@ -721,9 +721,15 @@ RPCHelpMan listlabels()\n \n     LOCK(pwallet->cs_wallet);\n \n-    std::string purpose;\n+    std::optional<AddressPurpose> purpose;\n     if (!request.params[0].isNull()) {\n-        purpose = request.params[0].get_str();\n+        std::string purpose_str = request.params[0].get_str();\n+        if (!purpose_str.empty()) {\n+            if (!IsValidPurposeString(purpose_str)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1140711535",
      "id" : 1140711535,
      "in_reply_to_id" : 1137745598,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585D_eBv",
      "original_commit_id" : "db521d3e89b23046f73410a875bb9660178e3842",
      "original_line" : 728,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/addresses.cpp",
      "position" : null,
      "pull_request_review_id" : 1346742671,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140711535/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-17T21:11:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140711535",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1140711618"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140711618"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "0d18142f595b43070bd07b608d43c9ed9b37cdcc",
      "created_at" : "2023-03-17T21:11:11Z",
      "diff_hunk" : "@@ -57,7 +57,7 @@ using isminefilter = std::underlying_type<isminetype>::type;\n  * interfaces and saved for new addresses. It is basically redundant with an\n  * address's IsMine() result.\n  */\n-enum class AddressPurpose : uint8_t {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1140711618",
      "id" : 1140711618,
      "in_reply_to_id" : 1137754658,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585D_eDC",
      "original_commit_id" : "db521d3e89b23046f73410a875bb9660178e3842",
      "original_line" : 60,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/types.h",
      "position" : null,
      "pull_request_review_id" : 1346742759,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140711618/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-17T21:11:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140711618",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1140711716"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140711716"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "0d18142f595b43070bd07b608d43c9ed9b37cdcc",
      "created_at" : "2023-03-17T21:11:18Z",
      "diff_hunk" : "@@ -2399,35 +2399,39 @@ DBErrors CWallet::ZapSelectTx(std::vector<uint256>& vHashIn, std::vector<uint256\n     return DBErrors::LOAD_OK;\n }\n \n-bool CWallet::SetAddressBookWithDB(WalletBatch& batch, const CTxDestination& address, const std::string& strName, const std::string& strPurpose)\n+bool CWallet::SetAddressBookWithDB(WalletBatch& batch, const CTxDestination& address, const std::string& strName, const std::optional<AddressPurpose>& new_purpose)\n {\n     bool fUpdated = false;\n     bool is_mine;\n+    std::optional<AddressPurpose> purpose;\n     {\n         LOCK(cs_wallet);\n         std::map<CTxDestination, CAddressBookData>::iterator mi = m_address_book.find(address);\n         fUpdated = (mi != m_address_book.end() && !mi->second.IsChange());\n         m_address_book[address].SetLabel(strName);\n-        if (!strPurpose.empty()) /* update purpose only if requested */\n-            m_address_book[address].purpose = strPurpose;\n         is_mine = IsMine(address) != ISMINE_NO;\n+        if (new_purpose) { /* update purpose only if requested */\n+            purpose = m_address_book[address].purpose = new_purpose;\n+        } else {\n+            purpose = m_address_book[address].purpose;\n+        }\n     }\n     NotifyAddressBookChanged(address, strName, is_mine,\n-                             strPurpose, (fUpdated ? CT_UPDATED : CT_NEW));\n-    if (!strPurpose.empty() && !batch.WritePurpose(EncodeDestination(address), strPurpose))\n+                             purpose ? *purpose : is_mine ? AddressPurpose::RECEIVE : AddressPurpose::SEND,\n+                             (fUpdated ? CT_UPDATED : CT_NEW));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1140711716",
      "id" : 1140711716,
      "in_reply_to_id" : 1137756043,
      "line" : 2422,
      "node_id" : "PRRC_kwDOABII585D_eEk",
      "original_commit_id" : "db521d3e89b23046f73410a875bb9660178e3842",
      "original_line" : 2422,
      "original_position" : 46,
      "original_start_line" : 2419,
      "path" : "src/wallet/wallet.cpp",
      "position" : 47,
      "pull_request_review_id" : 1346742838,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140711716/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 2420,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-03-17T21:11:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140711716",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1140711786"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140711786"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "0d18142f595b43070bd07b608d43c9ed9b37cdcc",
      "created_at" : "2023-03-17T21:11:22Z",
      "diff_hunk" : "@@ -200,28 +201,75 @@ class ReserveDestination\n     void KeepDestination();\n };\n \n-/** Address book data */\n-class CAddressBookData\n+/**\n+ * Address book data.\n+ */\n+struct CAddressBookData\n {\n-private:\n-    bool m_change{true};\n-    std::string m_label;\n-public:\n-    std::string purpose;\n+    /**\n+     * Address label for sending and receiving addresses, most commonly set to\n+     * \"\", which is the default label. Change addresses do not have labels, and\n+     * wallet code uses lack of a label to identify change address for fee\n+     * bumping and listing transactions.\n+     */\n+    std::optional<std::string> label;\n \n-    CAddressBookData() : purpose(\"unknown\") {}\n+    /**\n+     * Address purpose which was originally recorded for payment protocol\n+     * support but now serves as a cached IsMine value. Wallet code should\n+     * not rely on this field being set.\n+     */\n+    std::optional<AddressPurpose> purpose;\n \n+    /**\n+     * Additional address metadata map that can currently hold two types of keys:\n+     *\n+     *   \"used\" keys with values always set to \"p\" if present. This is set on\n+     *       IsMine addresses that have already been spend from if the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1140711786",
      "id" : 1140711786,
      "in_reply_to_id" : 1137760371,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585D_eFq",
      "original_commit_id" : "db521d3e89b23046f73410a875bb9660178e3842",
      "original_line" : 228,
      "original_position" : 44,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 1346742910,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140711786/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-17T21:11:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140711786",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1140711857"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140711857"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "0d18142f595b43070bd07b608d43c9ed9b37cdcc",
      "created_at" : "2023-03-17T21:11:27Z",
      "diff_hunk" : "@@ -71,6 +71,10 @@ def run_test(self):\n         node = self.nodes[0]\n         assert_equal(len(node.listunspent()), 0)\n \n+        self.log.info(\"Checking listlabels' invalid parameters\")\n+        assert_raises_rpc_error(-8, \"Invalid 'purpose' argument, must be one of 'send', or 'receive'.\", node.listlabels, \"notavalidpurpose\")\n+        assert_raises_rpc_error(-8, \"Invalid 'purpose' argument, must be one of 'send', or 'receive'.\", node.listlabels, \"unknown\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1140711857",
      "id" : 1140711857,
      "in_reply_to_id" : 1137773684,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585D_eGx",
      "original_commit_id" : "db521d3e89b23046f73410a875bb9660178e3842",
      "original_line" : 76,
      "original_position" : 6,
      "original_start_line" : 74,
      "path" : "test/functional/wallet_labels.py",
      "position" : null,
      "pull_request_review_id" : 1346742995,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140711857/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-03-17T21:11:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140711857",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1142308217"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142308217"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: Add wallet/types.h for simple public enum and struct types\" (f00f5dad29d81b9700dd84ec08a6e72f915988a0)\r\n\r\nLooks like there might be an extra 3 lines of space instead of 2 (but fine to keep if that's intentional)\r\n\r\n",
      "commit_id" : "a48010f1fd6d8a430b8234789ac3c91ec9d06972",
      "created_at" : "2023-03-20T15:32:11Z",
      "diff_hunk" : "@@ -108,8 +110,30 @@ static inline int TxStateSerializedIndex(const TxState& state)\n }\n \n \n+/**\n+ * Cachable amount subdivided into watchonly and spendable parts.\n+ */\n+struct CachableAmount\n+{\n+    // NO and ALL are never (supposed to be) cached\n+    std::bitset<ISMINE_ENUM_ELEMENTS> m_cached;\n+    CAmount m_value[ISMINE_ENUM_ELEMENTS];\n+    inline void Reset()\n+    {\n+        m_cached.reset();\n+    }\n+    void Set(isminefilter filter, CAmount value)\n+    {\n+        m_cached.set(filter);\n+        m_value[filter] = value;\n+    }\n+};\n+\n+\n typedef std::map<std::string, std::string> mapValue_t;\n \n+\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1142308217",
      "id" : 1142308217,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585EFj15",
      "original_commit_id" : "f00f5dad29d81b9700dd84ec08a6e72f915988a0",
      "original_line" : 136,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "src/wallet/transaction.h",
      "position" : null,
      "pull_request_review_id" : 1348830142,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142308217/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-20T15:47:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142308217",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1142325608"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142325608"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: Replace use of purpose strings with an enum\" (ea3cc035ddf8f15fd18407231c3ff9edde8891c1)\r\n\r\ns/address/addresses/",
      "commit_id" : "a48010f1fd6d8a430b8234789ac3c91ec9d06972",
      "created_at" : "2023-03-20T15:41:02Z",
      "diff_hunk" : "@@ -200,28 +201,70 @@ class ReserveDestination\n     void KeepDestination();\n };\n \n-/** Address book data */\n-class CAddressBookData\n+/**\n+ * Address book data.\n+ */\n+struct CAddressBookData\n {\n-private:\n-    bool m_change{true};\n-    std::string m_label;\n-public:\n-    std::string purpose;\n+    /**\n+     * Address label for sending and receiving addresses, most commonly set to\n+     * \"\", which is the default label. Change addresses do not have labels, and\n+     * wallet code uses lack of a label to identify change address for fee",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1142325608",
      "id" : 1142325608,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585EFoFo",
      "original_commit_id" : "ea3cc035ddf8f15fd18407231c3ff9edde8891c1",
      "original_line" : 212,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 1348830142,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142325608/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-20T15:47:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142325608",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1142331004"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142331004"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"doc: Release note for purpose string restriction\" (0d18142f595b43070bd07b608d43c9ed9b37cdcc)\r\n\r\nMaybe s/restricted/now restricted/ to be clear this is new behavior not background information.",
      "commit_id" : "a48010f1fd6d8a430b8234789ac3c91ec9d06972",
      "created_at" : "2023-03-20T15:44:52Z",
      "diff_hunk" : "@@ -0,0 +1,6 @@\n+Wallet\n+------\n+\n+* Purposes strings are restricted to the currently known values of \"send\", \"receive\", and \"refund\".",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1142331004",
      "id" : 1142331004,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585EFpZ8",
      "original_commit_id" : "0d18142f595b43070bd07b608d43c9ed9b37cdcc",
      "original_line" : 4,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "doc/release-notes-27217.md",
      "position" : null,
      "pull_request_review_id" : 1348830142,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142331004/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-20T15:47:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142331004",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1142432253"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142432253"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed",
      "commit_id" : "a48010f1fd6d8a430b8234789ac3c91ec9d06972",
      "created_at" : "2023-03-20T16:57:05Z",
      "diff_hunk" : "@@ -108,8 +110,30 @@ static inline int TxStateSerializedIndex(const TxState& state)\n }\n \n \n+/**\n+ * Cachable amount subdivided into watchonly and spendable parts.\n+ */\n+struct CachableAmount\n+{\n+    // NO and ALL are never (supposed to be) cached\n+    std::bitset<ISMINE_ENUM_ELEMENTS> m_cached;\n+    CAmount m_value[ISMINE_ENUM_ELEMENTS];\n+    inline void Reset()\n+    {\n+        m_cached.reset();\n+    }\n+    void Set(isminefilter filter, CAmount value)\n+    {\n+        m_cached.set(filter);\n+        m_value[filter] = value;\n+    }\n+};\n+\n+\n typedef std::map<std::string, std::string> mapValue_t;\n \n+\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1142432253",
      "id" : 1142432253,
      "in_reply_to_id" : 1142308217,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585EGCH9",
      "original_commit_id" : "f00f5dad29d81b9700dd84ec08a6e72f915988a0",
      "original_line" : 136,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "src/wallet/transaction.h",
      "position" : null,
      "pull_request_review_id" : 1349028134,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142432253/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-20T16:57:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142432253",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1142432364"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142432364"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "a48010f1fd6d8a430b8234789ac3c91ec9d06972",
      "created_at" : "2023-03-20T16:57:10Z",
      "diff_hunk" : "@@ -200,28 +201,70 @@ class ReserveDestination\n     void KeepDestination();\n };\n \n-/** Address book data */\n-class CAddressBookData\n+/**\n+ * Address book data.\n+ */\n+struct CAddressBookData\n {\n-private:\n-    bool m_change{true};\n-    std::string m_label;\n-public:\n-    std::string purpose;\n+    /**\n+     * Address label for sending and receiving addresses, most commonly set to\n+     * \"\", which is the default label. Change addresses do not have labels, and\n+     * wallet code uses lack of a label to identify change address for fee",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1142432364",
      "id" : 1142432364,
      "in_reply_to_id" : 1142325608,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585EGCJs",
      "original_commit_id" : "ea3cc035ddf8f15fd18407231c3ff9edde8891c1",
      "original_line" : 212,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 1349028277,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142432364/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-20T16:57:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142432364",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1142432481"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142432481"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "a48010f1fd6d8a430b8234789ac3c91ec9d06972",
      "created_at" : "2023-03-20T16:57:15Z",
      "diff_hunk" : "@@ -0,0 +1,6 @@\n+Wallet\n+------\n+\n+* Purposes strings are restricted to the currently known values of \"send\", \"receive\", and \"refund\".",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1142432481",
      "id" : 1142432481,
      "in_reply_to_id" : 1142331004,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585EGCLh",
      "original_commit_id" : "0d18142f595b43070bd07b608d43c9ed9b37cdcc",
      "original_line" : 4,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "doc/release-notes-27217.md",
      "position" : null,
      "pull_request_review_id" : 1349028434,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142432481/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-20T16:57:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142432481",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1148451397"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1148451397"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Could use `purpose.value_or(is_mine ? AddressPurpose::RECEIVE : AddressPurpose::SEND)` instead.\r\nSame for other instances.",
      "commit_id" : "a48010f1fd6d8a430b8234789ac3c91ec9d06972",
      "created_at" : "2023-03-25T23:59:31Z",
      "diff_hunk" : "@@ -2399,35 +2399,40 @@ DBErrors CWallet::ZapSelectTx(std::vector<uint256>& vHashIn, std::vector<uint256\n     return DBErrors::LOAD_OK;\n }\n \n-bool CWallet::SetAddressBookWithDB(WalletBatch& batch, const CTxDestination& address, const std::string& strName, const std::string& strPurpose)\n+bool CWallet::SetAddressBookWithDB(WalletBatch& batch, const CTxDestination& address, const std::string& strName, const std::optional<AddressPurpose>& new_purpose)\n {\n     bool fUpdated = false;\n     bool is_mine;\n+    std::optional<AddressPurpose> purpose;\n     {\n         LOCK(cs_wallet);\n         std::map<CTxDestination, CAddressBookData>::iterator mi = m_address_book.find(address);\n         fUpdated = (mi != m_address_book.end() && !mi->second.IsChange());\n         m_address_book[address].SetLabel(strName);\n-        if (!strPurpose.empty()) /* update purpose only if requested */\n-            m_address_book[address].purpose = strPurpose;\n         is_mine = IsMine(address) != ISMINE_NO;\n+        if (new_purpose) { /* update purpose only if requested */\n+            purpose = m_address_book[address].purpose = new_purpose;\n+        } else {\n+            purpose = m_address_book[address].purpose;\n+        }\n     }\n+    // In very old wallets, address purpose may not be recorded so we derive it from IsMine\n     NotifyAddressBookChanged(address, strName, is_mine,\n-                             strPurpose, (fUpdated ? CT_UPDATED : CT_NEW));\n-    if (!strPurpose.empty() && !batch.WritePurpose(EncodeDestination(address), strPurpose))\n+                             purpose ? *purpose : is_mine ? AddressPurpose::RECEIVE : AddressPurpose::SEND,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1148451397",
      "id" : 1148451397,
      "line" : 2421,
      "node_id" : "PRRC_kwDOABII585Ec_pF",
      "original_commit_id" : "a48010f1fd6d8a430b8234789ac3c91ec9d06972",
      "original_line" : 2421,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 46,
      "pull_request_review_id" : 1357917977,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1148451397/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-26T00:11:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1148451397",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1149457810"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1149457810"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "IIRC, don't we get all sorts of compiler goodness if we use `switch` with an enum, like compiler warnings for unhandled cases? Would be nice, in the event we ever add a new case to the enum (although seems unlikely for this specific use-case).\r\n\r\nI always prefer using `switch` with enums, but feel free to ignore if you don't feel like retouching/don't share the same opinion.",
      "commit_id" : "a48010f1fd6d8a430b8234789ac3c91ec9d06972",
      "created_at" : "2023-03-27T15:50:49Z",
      "diff_hunk" : "@@ -52,16 +53,17 @@ struct AddressTableEntryLessThan\n };\n \n /* Determine address type from address purpose */\n-static AddressTableEntry::Type translateTransactionType(const QString &strPurpose, bool isMine)\n+static AddressTableEntry::Type translateTransactionType(wallet::AddressPurpose purpose, bool isMine)\n {\n     AddressTableEntry::Type addressType = AddressTableEntry::Hidden;\n     // \"refund\" addresses aren't shown, and change addresses aren't returned by getAddresses at all.\n-    if (strPurpose == \"send\")\n+    if (purpose == wallet::AddressPurpose::SEND) {\n         addressType = AddressTableEntry::Sending;\n-    else if (strPurpose == \"receive\")\n+    } else if (purpose == wallet::AddressPurpose::RECEIVE) {\n         addressType = AddressTableEntry::Receiving;\n-    else if (strPurpose == \"unknown\" || strPurpose == \"\") // if purpose not set, guess\n+    } else {\n         addressType = (isMine ? AddressTableEntry::Receiving : AddressTableEntry::Sending);\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1149457810",
      "id" : 1149457810,
      "line" : 66,
      "node_id" : "PRRC_kwDOABII585Eg1WS",
      "original_commit_id" : "a48010f1fd6d8a430b8234789ac3c91ec9d06972",
      "original_line" : 66,
      "original_position" : 26,
      "original_start_line" : 60,
      "path" : "src/qt/addresstablemodel.cpp",
      "position" : 26,
      "pull_request_review_id" : 1359373444,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1149457810/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 60,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-03-27T15:54:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1149457810",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1149481491"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1149481491"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html#index-Wswitch-enum , super nice and still warns for unhandled cases even when you have a default.",
      "commit_id" : "a48010f1fd6d8a430b8234789ac3c91ec9d06972",
      "created_at" : "2023-03-27T16:09:20Z",
      "diff_hunk" : "@@ -52,16 +53,17 @@ struct AddressTableEntryLessThan\n };\n \n /* Determine address type from address purpose */\n-static AddressTableEntry::Type translateTransactionType(const QString &strPurpose, bool isMine)\n+static AddressTableEntry::Type translateTransactionType(wallet::AddressPurpose purpose, bool isMine)\n {\n     AddressTableEntry::Type addressType = AddressTableEntry::Hidden;\n     // \"refund\" addresses aren't shown, and change addresses aren't returned by getAddresses at all.\n-    if (strPurpose == \"send\")\n+    if (purpose == wallet::AddressPurpose::SEND) {\n         addressType = AddressTableEntry::Sending;\n-    else if (strPurpose == \"receive\")\n+    } else if (purpose == wallet::AddressPurpose::RECEIVE) {\n         addressType = AddressTableEntry::Receiving;\n-    else if (strPurpose == \"unknown\" || strPurpose == \"\") // if purpose not set, guess\n+    } else {\n         addressType = (isMine ? AddressTableEntry::Receiving : AddressTableEntry::Sending);\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1149481491",
      "id" : 1149481491,
      "in_reply_to_id" : 1149457810,
      "line" : 66,
      "node_id" : "PRRC_kwDOABII585Eg7IT",
      "original_commit_id" : "a48010f1fd6d8a430b8234789ac3c91ec9d06972",
      "original_line" : 66,
      "original_position" : 26,
      "original_start_line" : 60,
      "path" : "src/qt/addresstablemodel.cpp",
      "position" : 26,
      "pull_request_review_id" : 1359408658,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1149481491/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 60,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-03-27T16:09:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1149481491",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1160736280"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160736280"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: Replace use of purpose strings with an enum\" (ccddce7582a51fd2857ce4d142076167631e9cfe)\r\n\r\nre: https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1149457810\r\n\r\nI think I agree with the suggestion to use a switch statement here. Also:\r\n\r\n- It looks like behavior of this code has been changed unintentionally to no longer return hidden in the \"refund\" case.\r\n- The \"if purpose not set, guess\" logic is no longer here needed because it is implemented at the lower layer\r\n\r\nSo this could be written as:\r\n\r\n```c++\r\n/* Determine address type from address purpose */\r\nstatic AddressTableEntry::Type translateTransactionType(wallet::AddressPurpose purpose)\r\n{\r\n    // \"refund\" addresses aren't shown, and change addresses aren't returned by getAddresses at all.\r\n    switch (purpose) {\r\n        case wallet::AddressPurpose::RECEIVE: return AddressTableEntry::Receiving;\r\n        case wallet::AddressPurpose::SEND:    return AddressTableEntry::Sending;\r\n        case wallet::AddressPurpose::REFUND:  return AddressTableEntry::Hidden;\r\n    }\r\n}\r\n```",
      "commit_id" : "a48010f1fd6d8a430b8234789ac3c91ec9d06972",
      "created_at" : "2023-04-07T14:22:14Z",
      "diff_hunk" : "@@ -52,16 +53,17 @@ struct AddressTableEntryLessThan\n };\n \n /* Determine address type from address purpose */\n-static AddressTableEntry::Type translateTransactionType(const QString &strPurpose, bool isMine)\n+static AddressTableEntry::Type translateTransactionType(wallet::AddressPurpose purpose, bool isMine)\n {\n     AddressTableEntry::Type addressType = AddressTableEntry::Hidden;\n     // \"refund\" addresses aren't shown, and change addresses aren't returned by getAddresses at all.\n-    if (strPurpose == \"send\")\n+    if (purpose == wallet::AddressPurpose::SEND) {\n         addressType = AddressTableEntry::Sending;\n-    else if (strPurpose == \"receive\")\n+    } else if (purpose == wallet::AddressPurpose::RECEIVE) {\n         addressType = AddressTableEntry::Receiving;\n-    else if (strPurpose == \"unknown\" || strPurpose == \"\") // if purpose not set, guess\n+    } else {\n         addressType = (isMine ? AddressTableEntry::Receiving : AddressTableEntry::Sending);\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1160736280",
      "id" : 1160736280,
      "in_reply_to_id" : 1149457810,
      "line" : 66,
      "node_id" : "PRRC_kwDOABII585FL24Y",
      "original_commit_id" : "a48010f1fd6d8a430b8234789ac3c91ec9d06972",
      "original_line" : 66,
      "original_position" : 26,
      "original_start_line" : 60,
      "path" : "src/qt/addresstablemodel.cpp",
      "position" : 26,
      "pull_request_review_id" : 1376251729,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160736280/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 60,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-04-07T15:16:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160736280",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1160747569"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160747569"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: Replace use of purpose strings with an enum\" (ccddce7582a51fd2857ce4d142076167631e9cfe)\r\n\r\nIt would be good to make it more explicit that value is null for change addresses. Could say:\r\n\r\n```c++\r\n/**\r\n * Address label which is always nullopt for change addresses. For sending\r\n * and receiving addresses, it will be set to an arbitrary label string\r\n * provided by the user, or to \"\", which is the default label. The presence\r\n * or absence of a label is used to distinguish change addresses from\r\n * non-change addresses by wallet transaction listing and fee bumping code.\r\n */\r\nstd::optional<std::string> label;\r\n```",
      "commit_id" : "a48010f1fd6d8a430b8234789ac3c91ec9d06972",
      "created_at" : "2023-04-07T14:39:05Z",
      "diff_hunk" : "@@ -200,28 +201,70 @@ class ReserveDestination\n     void KeepDestination();\n };\n \n-/** Address book data */\n-class CAddressBookData\n+/**\n+ * Address book data.\n+ */\n+struct CAddressBookData\n {\n-private:\n-    bool m_change{true};\n-    std::string m_label;\n-public:\n-    std::string purpose;\n+    /**\n+     * Address label for sending and receiving addresses, most commonly set to\n+     * \"\", which is the default label. Change addresses do not have labels, and",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1160747569",
      "id" : 1160747569,
      "line" : 211,
      "node_id" : "PRRC_kwDOABII585FL5ox",
      "original_commit_id" : "ccddce7582a51fd2857ce4d142076167631e9cfe",
      "original_line" : 211,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : 26,
      "pull_request_review_id" : 1376251729,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160747569/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-07T15:16:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160747569",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1160759069"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160759069"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: Replace use of purpose strings with an enum\" (ccddce7582a51fd2857ce4d142076167631e9cfe)\r\n\r\nTo be more accurate, comment should say `with values set to \"1\" or \"p\" if present`. Value was inadvertently changed from `\"p\"` to `\"1\"` in f5ba424cd44619d9b9be88b8593d69a7ba96db26 from #21353",
      "commit_id" : "a48010f1fd6d8a430b8234789ac3c91ec9d06972",
      "created_at" : "2023-04-07T14:57:13Z",
      "diff_hunk" : "@@ -200,28 +201,70 @@ class ReserveDestination\n     void KeepDestination();\n };\n \n-/** Address book data */\n-class CAddressBookData\n+/**\n+ * Address book data.\n+ */\n+struct CAddressBookData\n {\n-private:\n-    bool m_change{true};\n-    std::string m_label;\n-public:\n-    std::string purpose;\n+    /**\n+     * Address label for sending and receiving addresses, most commonly set to\n+     * \"\", which is the default label. Change addresses do not have labels, and\n+     * wallet code uses lack of a label to identify change addresses for fee\n+     * bumping and listing transactions.\n+     */\n+    std::optional<std::string> label;\n \n-    CAddressBookData() : purpose(\"unknown\") {}\n+    /**\n+     * Address purpose which was originally recorded for payment protocol\n+     * support but now serves as a cached IsMine value. Wallet code should\n+     * not rely on this field being set.\n+     */\n+    std::optional<AddressPurpose> purpose;\n \n+    /**\n+     * Additional address metadata map that can currently hold two types of keys:\n+     *\n+     *   \"used\" keys with values always set to \"p\" if present. This is set on",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1160759069",
      "id" : 1160759069,
      "line" : 227,
      "node_id" : "PRRC_kwDOABII585FL8cd",
      "original_commit_id" : "ccddce7582a51fd2857ce4d142076167631e9cfe",
      "original_line" : 227,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : 43,
      "pull_request_review_id" : 1376251729,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160759069/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-07T15:16:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160759069",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1161777870"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161777870"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Changed here and elsewhere",
      "commit_id" : "98821a7aca88ac9401786e848899866b71446460",
      "created_at" : "2023-04-10T14:40:39Z",
      "diff_hunk" : "@@ -2399,35 +2399,40 @@ DBErrors CWallet::ZapSelectTx(std::vector<uint256>& vHashIn, std::vector<uint256\n     return DBErrors::LOAD_OK;\n }\n \n-bool CWallet::SetAddressBookWithDB(WalletBatch& batch, const CTxDestination& address, const std::string& strName, const std::string& strPurpose)\n+bool CWallet::SetAddressBookWithDB(WalletBatch& batch, const CTxDestination& address, const std::string& strName, const std::optional<AddressPurpose>& new_purpose)\n {\n     bool fUpdated = false;\n     bool is_mine;\n+    std::optional<AddressPurpose> purpose;\n     {\n         LOCK(cs_wallet);\n         std::map<CTxDestination, CAddressBookData>::iterator mi = m_address_book.find(address);\n         fUpdated = (mi != m_address_book.end() && !mi->second.IsChange());\n         m_address_book[address].SetLabel(strName);\n-        if (!strPurpose.empty()) /* update purpose only if requested */\n-            m_address_book[address].purpose = strPurpose;\n         is_mine = IsMine(address) != ISMINE_NO;\n+        if (new_purpose) { /* update purpose only if requested */\n+            purpose = m_address_book[address].purpose = new_purpose;\n+        } else {\n+            purpose = m_address_book[address].purpose;\n+        }\n     }\n+    // In very old wallets, address purpose may not be recorded so we derive it from IsMine\n     NotifyAddressBookChanged(address, strName, is_mine,\n-                             strPurpose, (fUpdated ? CT_UPDATED : CT_NEW));\n-    if (!strPurpose.empty() && !batch.WritePurpose(EncodeDestination(address), strPurpose))\n+                             purpose ? *purpose : is_mine ? AddressPurpose::RECEIVE : AddressPurpose::SEND,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1161777870",
      "id" : 1161777870,
      "in_reply_to_id" : 1148451397,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585FP1LO",
      "original_commit_id" : "a48010f1fd6d8a430b8234789ac3c91ec9d06972",
      "original_line" : 2421,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1377632092,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161777870/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-10T14:40:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161777870",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1161777986"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161777986"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done as suggested",
      "commit_id" : "98821a7aca88ac9401786e848899866b71446460",
      "created_at" : "2023-04-10T14:40:47Z",
      "diff_hunk" : "@@ -52,16 +53,17 @@ struct AddressTableEntryLessThan\n };\n \n /* Determine address type from address purpose */\n-static AddressTableEntry::Type translateTransactionType(const QString &strPurpose, bool isMine)\n+static AddressTableEntry::Type translateTransactionType(wallet::AddressPurpose purpose, bool isMine)\n {\n     AddressTableEntry::Type addressType = AddressTableEntry::Hidden;\n     // \"refund\" addresses aren't shown, and change addresses aren't returned by getAddresses at all.\n-    if (strPurpose == \"send\")\n+    if (purpose == wallet::AddressPurpose::SEND) {\n         addressType = AddressTableEntry::Sending;\n-    else if (strPurpose == \"receive\")\n+    } else if (purpose == wallet::AddressPurpose::RECEIVE) {\n         addressType = AddressTableEntry::Receiving;\n-    else if (strPurpose == \"unknown\" || strPurpose == \"\") // if purpose not set, guess\n+    } else {\n         addressType = (isMine ? AddressTableEntry::Receiving : AddressTableEntry::Sending);\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1161777986",
      "id" : 1161777986,
      "in_reply_to_id" : 1149457810,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585FP1NC",
      "original_commit_id" : "a48010f1fd6d8a430b8234789ac3c91ec9d06972",
      "original_line" : 64,
      "original_position" : 26,
      "original_start_line" : 60,
      "path" : "src/qt/addresstablemodel.cpp",
      "position" : null,
      "pull_request_review_id" : 1377632385,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161777986/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-04-10T14:40:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161777986",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1161778269"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161778269"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done as suggested",
      "commit_id" : "98821a7aca88ac9401786e848899866b71446460",
      "created_at" : "2023-04-10T14:41:06Z",
      "diff_hunk" : "@@ -200,28 +201,70 @@ class ReserveDestination\n     void KeepDestination();\n };\n \n-/** Address book data */\n-class CAddressBookData\n+/**\n+ * Address book data.\n+ */\n+struct CAddressBookData\n {\n-private:\n-    bool m_change{true};\n-    std::string m_label;\n-public:\n-    std::string purpose;\n+    /**\n+     * Address label for sending and receiving addresses, most commonly set to\n+     * \"\", which is the default label. Change addresses do not have labels, and",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1161778269",
      "id" : 1161778269,
      "in_reply_to_id" : 1160747569,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585FP1Rd",
      "original_commit_id" : "ccddce7582a51fd2857ce4d142076167631e9cfe",
      "original_line" : 211,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 1377633080,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161778269/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-10T14:41:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161778269",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1161778333"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161778333"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done as suggested",
      "commit_id" : "98821a7aca88ac9401786e848899866b71446460",
      "created_at" : "2023-04-10T14:41:11Z",
      "diff_hunk" : "@@ -200,28 +201,70 @@ class ReserveDestination\n     void KeepDestination();\n };\n \n-/** Address book data */\n-class CAddressBookData\n+/**\n+ * Address book data.\n+ */\n+struct CAddressBookData\n {\n-private:\n-    bool m_change{true};\n-    std::string m_label;\n-public:\n-    std::string purpose;\n+    /**\n+     * Address label for sending and receiving addresses, most commonly set to\n+     * \"\", which is the default label. Change addresses do not have labels, and\n+     * wallet code uses lack of a label to identify change addresses for fee\n+     * bumping and listing transactions.\n+     */\n+    std::optional<std::string> label;\n \n-    CAddressBookData() : purpose(\"unknown\") {}\n+    /**\n+     * Address purpose which was originally recorded for payment protocol\n+     * support but now serves as a cached IsMine value. Wallet code should\n+     * not rely on this field being set.\n+     */\n+    std::optional<AddressPurpose> purpose;\n \n+    /**\n+     * Additional address metadata map that can currently hold two types of keys:\n+     *\n+     *   \"used\" keys with values always set to \"p\" if present. This is set on",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1161778333",
      "id" : 1161778333,
      "in_reply_to_id" : 1160759069,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585FP1Sd",
      "original_commit_id" : "ccddce7582a51fd2857ce4d142076167631e9cfe",
      "original_line" : 227,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 1377633254,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161778333/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-10T14:41:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161778333",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1161939317"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161939317"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit, typo:\r\n```suggestion\r\n * receiving addresses since BIP70 payment protocol support was added in\r\n```",
      "commit_id" : "98821a7aca88ac9401786e848899866b71446460",
      "created_at" : "2023-04-10T17:53:20Z",
      "diff_hunk" : "@@ -48,6 +48,20 @@ enum isminetype : unsigned int {\n };\n /** used for bitflags of isminetype */\n using isminefilter = std::underlying_type<isminetype>::type;\n+\n+/**\n+ * Address purpose field that has been been stored with wallet sending and\n+ * receiving addreses since BIP70 payment protocol support was added in",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1161939317",
      "id" : 1161939317,
      "line" : 54,
      "node_id" : "PRRC_kwDOABII585FQcl1",
      "original_commit_id" : "af47fff6804defb1d7a8b538d6f2e7a39c6aa213",
      "original_line" : 54,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/wallet/types.h",
      "position" : 35,
      "pull_request_review_id" : 1377895422,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161939317/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-10T18:28:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161939317",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1161952231"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161952231"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I thought here first that if the user does not set a label, we might treat an address as change. However, I realized that an empty string `\"\"` is truthy, while no string being set is falsy, i.e. even if the address label is set to `\"\"` which appears to be the case for any receive addresses, itâll be truthy.",
      "commit_id" : "98821a7aca88ac9401786e848899866b71446460",
      "created_at" : "2023-04-10T18:09:06Z",
      "diff_hunk" : "@@ -200,28 +201,71 @@ class ReserveDestination\n     void KeepDestination();\n };\n \n-/** Address book data */\n-class CAddressBookData\n+/**\n+ * Address book data.\n+ */\n+struct CAddressBookData\n {\n-private:\n-    bool m_change{true};\n-    std::string m_label;\n-public:\n-    std::string purpose;\n+    /**\n+     * Address label which is always nullopt for change addresses. For sending\n+     * and receiving addresses, it will be set to an arbitrary label string\n+     * provided by the user, or to \"\", which is the default label. The presence\n+     * or absence of a label is used to distinguish change addresses from\n+     * non-change addresses by wallet transaction listing and fee bumping code.\n+     */\n+    std::optional<std::string> label;\n \n-    CAddressBookData() : purpose(\"unknown\") {}\n+    /**\n+     * Address purpose which was originally recorded for payment protocol\n+     * support but now serves as a cached IsMine value. Wallet code should\n+     * not rely on this field being set.\n+     */\n+    std::optional<AddressPurpose> purpose;\n \n+    /**\n+     * Additional address metadata map that can currently hold two types of keys:\n+     *\n+     *   \"used\" keys with values always set to \"1\" or \"p\" if present. This is set on\n+     *       IsMine addresses that have already been spent from if the\n+     *       avoid_reuse option is enabled\n+     *\n+     *   \"rr##\" keys where ## is a decimal number, with serialized\n+     *       RecentRequestEntry objects as values\n+     */\n     typedef std::map<std::string, std::string> StringMap;\n     StringMap destdata;\n \n-    bool IsChange() const { return m_change; }\n-    const std::string& GetLabel() const { return m_label; }\n-    void SetLabel(const std::string& label) {\n-        m_change = false;\n-        m_label = label;\n-    }\n+    /** Accessor methods. */\n+    bool IsChange() const { return !label; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1161952231",
      "id" : 1161952231,
      "line" : 239,
      "node_id" : "PRRC_kwDOABII585FQfvn",
      "original_commit_id" : "a52f20224f8054f3e6f628fe228284e6f3b7ce7e",
      "original_line" : 239,
      "original_position" : 61,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : 61,
      "pull_request_review_id" : 1377895422,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161952231/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-10T18:28:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161952231",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1161954369"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161954369"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit, since each immediately returns, this may be more readable:\r\n\r\n```suggestion\r\n    if (s == \"receive\") return AddressPurpose::RECEIVE;\r\n    if (s == \"send\") return AddressPurpose::SEND;\r\n    if (s == \"refund\") return AddressPurpose::REFUND;\r\n```",
      "commit_id" : "98821a7aca88ac9401786e848899866b71446460",
      "created_at" : "2023-04-10T18:11:51Z",
      "diff_hunk" : "@@ -200,28 +201,71 @@ class ReserveDestination\n     void KeepDestination();\n };\n \n-/** Address book data */\n-class CAddressBookData\n+/**\n+ * Address book data.\n+ */\n+struct CAddressBookData\n {\n-private:\n-    bool m_change{true};\n-    std::string m_label;\n-public:\n-    std::string purpose;\n+    /**\n+     * Address label which is always nullopt for change addresses. For sending\n+     * and receiving addresses, it will be set to an arbitrary label string\n+     * provided by the user, or to \"\", which is the default label. The presence\n+     * or absence of a label is used to distinguish change addresses from\n+     * non-change addresses by wallet transaction listing and fee bumping code.\n+     */\n+    std::optional<std::string> label;\n \n-    CAddressBookData() : purpose(\"unknown\") {}\n+    /**\n+     * Address purpose which was originally recorded for payment protocol\n+     * support but now serves as a cached IsMine value. Wallet code should\n+     * not rely on this field being set.\n+     */\n+    std::optional<AddressPurpose> purpose;\n \n+    /**\n+     * Additional address metadata map that can currently hold two types of keys:\n+     *\n+     *   \"used\" keys with values always set to \"1\" or \"p\" if present. This is set on\n+     *       IsMine addresses that have already been spent from if the\n+     *       avoid_reuse option is enabled\n+     *\n+     *   \"rr##\" keys where ## is a decimal number, with serialized\n+     *       RecentRequestEntry objects as values\n+     */\n     typedef std::map<std::string, std::string> StringMap;\n     StringMap destdata;\n \n-    bool IsChange() const { return m_change; }\n-    const std::string& GetLabel() const { return m_label; }\n-    void SetLabel(const std::string& label) {\n-        m_change = false;\n-        m_label = label;\n-    }\n+    /** Accessor methods. */\n+    bool IsChange() const { return !label; }\n+    std::string GetLabel() const { return label ? *label : std::string{}; }\n+    void SetLabel(std::string name) { label = std::move(name); }\n };\n \n+inline std::string PurposeToString(AddressPurpose p)\n+{\n+    switch(p) {\n+    case AddressPurpose::RECEIVE:\n+        return \"receive\";\n+    case AddressPurpose::SEND:\n+        return \"send\";\n+    case AddressPurpose::REFUND:\n+        return \"refund\";\n+    } // no default case so the compiler will warn when a new enum as added\n+    assert(false);\n+}\n+\n+inline std::optional<AddressPurpose> PurposeFromString(std::string_view s)\n+{\n+    if (s == \"receive\") {\n+        return AddressPurpose::RECEIVE;\n+    } else if (s == \"send\") {\n+        return AddressPurpose::SEND;\n+    } else if (s == \"refund\") {\n+        return AddressPurpose::REFUND;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1161954369",
      "id" : 1161954369,
      "line" : 265,
      "node_id" : "PRRC_kwDOABII585FQgRB",
      "original_commit_id" : "a52f20224f8054f3e6f628fe228284e6f3b7ce7e",
      "original_line" : 265,
      "original_position" : 87,
      "original_start_line" : 259,
      "path" : "src/wallet/wallet.h",
      "position" : 87,
      "pull_request_review_id" : 1377895422,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161954369/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 259,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-04-10T18:28:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161954369",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1161967546"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161967546"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Perhaps mention that the âpurpose stringâ appears in the context of addresses, at least for me that would not necessarily have been obvious just from this release note without reviewing the PR.",
      "commit_id" : "98821a7aca88ac9401786e848899866b71446460",
      "created_at" : "2023-04-10T18:28:27Z",
      "diff_hunk" : "@@ -0,0 +1,6 @@\n+Wallet\n+------\n+\n+* Purposes strings are now restricted to the currently known values of \"send\", \"receive\", and \"refund\".\n+  Wallets that have unrecognized purpose strings will have loading warnings, and the `listlabels`\n+  RPC will raise an error if an unrecognized purpose is requested.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1161967546",
      "id" : 1161967546,
      "line" : 6,
      "node_id" : "PRRC_kwDOABII585FQje6",
      "original_commit_id" : "98821a7aca88ac9401786e848899866b71446460",
      "original_line" : 6,
      "original_position" : 6,
      "original_start_line" : 4,
      "path" : "doc/release-notes-27217.md",
      "position" : 6,
      "pull_request_review_id" : 1377895422,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161967546/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 4,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-04-10T18:28:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161967546",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1162194379"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1162194379"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed.",
      "commit_id" : "635c50a57b3f72f83f1ee681f6a4b7766b8988f6",
      "created_at" : "2023-04-11T00:44:10Z",
      "diff_hunk" : "@@ -48,6 +48,20 @@ enum isminetype : unsigned int {\n };\n /** used for bitflags of isminetype */\n using isminefilter = std::underlying_type<isminetype>::type;\n+\n+/**\n+ * Address purpose field that has been been stored with wallet sending and\n+ * receiving addreses since BIP70 payment protocol support was added in",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1162194379",
      "id" : 1162194379,
      "in_reply_to_id" : 1161939317,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585FRa3L",
      "original_commit_id" : "af47fff6804defb1d7a8b538d6f2e7a39c6aa213",
      "original_line" : 54,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/wallet/types.h",
      "position" : null,
      "pull_request_review_id" : 1378299830,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1162194379/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-11T00:44:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1162194379",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1162194453"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1162194453"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've made this clearer by using `has_value()`.",
      "commit_id" : "635c50a57b3f72f83f1ee681f6a4b7766b8988f6",
      "created_at" : "2023-04-11T00:44:27Z",
      "diff_hunk" : "@@ -200,28 +201,71 @@ class ReserveDestination\n     void KeepDestination();\n };\n \n-/** Address book data */\n-class CAddressBookData\n+/**\n+ * Address book data.\n+ */\n+struct CAddressBookData\n {\n-private:\n-    bool m_change{true};\n-    std::string m_label;\n-public:\n-    std::string purpose;\n+    /**\n+     * Address label which is always nullopt for change addresses. For sending\n+     * and receiving addresses, it will be set to an arbitrary label string\n+     * provided by the user, or to \"\", which is the default label. The presence\n+     * or absence of a label is used to distinguish change addresses from\n+     * non-change addresses by wallet transaction listing and fee bumping code.\n+     */\n+    std::optional<std::string> label;\n \n-    CAddressBookData() : purpose(\"unknown\") {}\n+    /**\n+     * Address purpose which was originally recorded for payment protocol\n+     * support but now serves as a cached IsMine value. Wallet code should\n+     * not rely on this field being set.\n+     */\n+    std::optional<AddressPurpose> purpose;\n \n+    /**\n+     * Additional address metadata map that can currently hold two types of keys:\n+     *\n+     *   \"used\" keys with values always set to \"1\" or \"p\" if present. This is set on\n+     *       IsMine addresses that have already been spent from if the\n+     *       avoid_reuse option is enabled\n+     *\n+     *   \"rr##\" keys where ## is a decimal number, with serialized\n+     *       RecentRequestEntry objects as values\n+     */\n     typedef std::map<std::string, std::string> StringMap;\n     StringMap destdata;\n \n-    bool IsChange() const { return m_change; }\n-    const std::string& GetLabel() const { return m_label; }\n-    void SetLabel(const std::string& label) {\n-        m_change = false;\n-        m_label = label;\n-    }\n+    /** Accessor methods. */\n+    bool IsChange() const { return !label; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1162194453",
      "id" : 1162194453,
      "in_reply_to_id" : 1161952231,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585FRa4V",
      "original_commit_id" : "a52f20224f8054f3e6f628fe228284e6f3b7ce7e",
      "original_line" : 239,
      "original_position" : 61,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 1378299949,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1162194453/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-11T00:44:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1162194453",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1162194642"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1162194642"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I prefer the `else if` style, but have collapsed this and `PurposeToString` to be more readable.",
      "commit_id" : "635c50a57b3f72f83f1ee681f6a4b7766b8988f6",
      "created_at" : "2023-04-11T00:45:02Z",
      "diff_hunk" : "@@ -200,28 +201,71 @@ class ReserveDestination\n     void KeepDestination();\n };\n \n-/** Address book data */\n-class CAddressBookData\n+/**\n+ * Address book data.\n+ */\n+struct CAddressBookData\n {\n-private:\n-    bool m_change{true};\n-    std::string m_label;\n-public:\n-    std::string purpose;\n+    /**\n+     * Address label which is always nullopt for change addresses. For sending\n+     * and receiving addresses, it will be set to an arbitrary label string\n+     * provided by the user, or to \"\", which is the default label. The presence\n+     * or absence of a label is used to distinguish change addresses from\n+     * non-change addresses by wallet transaction listing and fee bumping code.\n+     */\n+    std::optional<std::string> label;\n \n-    CAddressBookData() : purpose(\"unknown\") {}\n+    /**\n+     * Address purpose which was originally recorded for payment protocol\n+     * support but now serves as a cached IsMine value. Wallet code should\n+     * not rely on this field being set.\n+     */\n+    std::optional<AddressPurpose> purpose;\n \n+    /**\n+     * Additional address metadata map that can currently hold two types of keys:\n+     *\n+     *   \"used\" keys with values always set to \"1\" or \"p\" if present. This is set on\n+     *       IsMine addresses that have already been spent from if the\n+     *       avoid_reuse option is enabled\n+     *\n+     *   \"rr##\" keys where ## is a decimal number, with serialized\n+     *       RecentRequestEntry objects as values\n+     */\n     typedef std::map<std::string, std::string> StringMap;\n     StringMap destdata;\n \n-    bool IsChange() const { return m_change; }\n-    const std::string& GetLabel() const { return m_label; }\n-    void SetLabel(const std::string& label) {\n-        m_change = false;\n-        m_label = label;\n-    }\n+    /** Accessor methods. */\n+    bool IsChange() const { return !label; }\n+    std::string GetLabel() const { return label ? *label : std::string{}; }\n+    void SetLabel(std::string name) { label = std::move(name); }\n };\n \n+inline std::string PurposeToString(AddressPurpose p)\n+{\n+    switch(p) {\n+    case AddressPurpose::RECEIVE:\n+        return \"receive\";\n+    case AddressPurpose::SEND:\n+        return \"send\";\n+    case AddressPurpose::REFUND:\n+        return \"refund\";\n+    } // no default case so the compiler will warn when a new enum as added\n+    assert(false);\n+}\n+\n+inline std::optional<AddressPurpose> PurposeFromString(std::string_view s)\n+{\n+    if (s == \"receive\") {\n+        return AddressPurpose::RECEIVE;\n+    } else if (s == \"send\") {\n+        return AddressPurpose::SEND;\n+    } else if (s == \"refund\") {\n+        return AddressPurpose::REFUND;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1162194642",
      "id" : 1162194642,
      "in_reply_to_id" : 1161954369,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585FRa7S",
      "original_commit_id" : "a52f20224f8054f3e6f628fe228284e6f3b7ce7e",
      "original_line" : 265,
      "original_position" : 87,
      "original_start_line" : 259,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 1378300228,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1162194642/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-04-11T00:45:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1162194642",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1162194740"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1162194740"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "635c50a57b3f72f83f1ee681f6a4b7766b8988f6",
      "created_at" : "2023-04-11T00:45:16Z",
      "diff_hunk" : "@@ -0,0 +1,6 @@\n+Wallet\n+------\n+\n+* Purposes strings are now restricted to the currently known values of \"send\", \"receive\", and \"refund\".\n+  Wallets that have unrecognized purpose strings will have loading warnings, and the `listlabels`\n+  RPC will raise an error if an unrecognized purpose is requested.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1162194740",
      "id" : 1162194740,
      "in_reply_to_id" : 1161967546,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585FRa80",
      "original_commit_id" : "98821a7aca88ac9401786e848899866b71446460",
      "original_line" : 6,
      "original_position" : 6,
      "original_start_line" : 4,
      "path" : "doc/release-notes-27217.md",
      "position" : null,
      "pull_request_review_id" : 1378300341,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1162194740/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-04-11T00:45:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1162194740",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1165016111"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165016111"
         }
      },
      "author_association" : "NONE",
      "body" : "This change appears to trigger this assert when executing \"getnewaddress\" from the Console:\r\nAssertion failed: (invoked), function NotifyAddressBookChanged, file walletmodel.cpp, line 392.\r\n\r\ndebug.log shows this error message:\r\nGUI: QMetaMethod::invoke: Unable to handle unregistered datatype 'wallet::AddressPurpose'",
      "commit_id" : "18fc71a3adee5de0f74ba6ff18f5ed31ba79a646",
      "created_at" : "2023-04-13T05:29:01Z",
      "diff_hunk" : "@@ -377,18 +377,17 @@ static void NotifyKeyStoreStatusChanged(WalletModel *walletmodel)\n \n static void NotifyAddressBookChanged(WalletModel *walletmodel,\n         const CTxDestination &address, const std::string &label, bool isMine,\n-        const std::string &purpose, ChangeType status)\n+        wallet::AddressPurpose purpose, ChangeType status)\n {\n     QString strAddress = QString::fromStdString(EncodeDestination(address));\n     QString strLabel = QString::fromStdString(label);\n-    QString strPurpose = QString::fromStdString(purpose);\n \n-    qDebug() << \"NotifyAddressBookChanged: \" + strAddress + \" \" + strLabel + \" isMine=\" + QString::number(isMine) + \" purpose=\" + strPurpose + \" status=\" + QString::number(status);\n+    qDebug() << \"NotifyAddressBookChanged: \" + strAddress + \" \" + strLabel + \" isMine=\" + QString::number(isMine) + \" purpose=\" + QString::number(static_cast<uint8_t>(purpose)) + \" status=\" + QString::number(status);\n     bool invoked = QMetaObject::invokeMethod(walletmodel, \"updateAddressBook\",\n                               Q_ARG(QString, strAddress),\n                               Q_ARG(QString, strLabel),\n                               Q_ARG(bool, isMine),\n-                              Q_ARG(QString, strPurpose),\n+                              Q_ARG(wallet::AddressPurpose, purpose),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1165016111",
      "id" : 1165016111,
      "line" : 390,
      "node_id" : "PRRC_kwDOABII585FcLwv",
      "original_commit_id" : "e83babe3b85b22e2360a99f9827b2b0d107ad0fa",
      "original_line" : 390,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "src/qt/walletmodel.cpp",
      "position" : 41,
      "pull_request_review_id" : 1382653264,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165016111/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-13T05:29:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165016111",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/123340139?v=4",
         "events_url" : "https://api.github.com/users/denavila/events{/privacy}",
         "followers_url" : "https://api.github.com/users/denavila/followers",
         "following_url" : "https://api.github.com/users/denavila/following{/other_user}",
         "gists_url" : "https://api.github.com/users/denavila/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/denavila",
         "id" : 123340139,
         "login" : "denavila",
         "node_id" : "U_kgDOB1oFaw",
         "organizations_url" : "https://api.github.com/users/denavila/orgs",
         "received_events_url" : "https://api.github.com/users/denavila/received_events",
         "repos_url" : "https://api.github.com/users/denavila/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/denavila/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/denavila/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/denavila"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1165251694"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165251694"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, opened an issue here to follow up: https://github.com/bitcoin-core/gui/issues/725.",
      "commit_id" : "18fc71a3adee5de0f74ba6ff18f5ed31ba79a646",
      "created_at" : "2023-04-13T09:17:25Z",
      "diff_hunk" : "@@ -377,18 +377,17 @@ static void NotifyKeyStoreStatusChanged(WalletModel *walletmodel)\n \n static void NotifyAddressBookChanged(WalletModel *walletmodel,\n         const CTxDestination &address, const std::string &label, bool isMine,\n-        const std::string &purpose, ChangeType status)\n+        wallet::AddressPurpose purpose, ChangeType status)\n {\n     QString strAddress = QString::fromStdString(EncodeDestination(address));\n     QString strLabel = QString::fromStdString(label);\n-    QString strPurpose = QString::fromStdString(purpose);\n \n-    qDebug() << \"NotifyAddressBookChanged: \" + strAddress + \" \" + strLabel + \" isMine=\" + QString::number(isMine) + \" purpose=\" + strPurpose + \" status=\" + QString::number(status);\n+    qDebug() << \"NotifyAddressBookChanged: \" + strAddress + \" \" + strLabel + \" isMine=\" + QString::number(isMine) + \" purpose=\" + QString::number(static_cast<uint8_t>(purpose)) + \" status=\" + QString::number(status);\n     bool invoked = QMetaObject::invokeMethod(walletmodel, \"updateAddressBook\",\n                               Q_ARG(QString, strAddress),\n                               Q_ARG(QString, strLabel),\n                               Q_ARG(bool, isMine),\n-                              Q_ARG(QString, strPurpose),\n+                              Q_ARG(wallet::AddressPurpose, purpose),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1165251694",
      "id" : 1165251694,
      "in_reply_to_id" : 1165016111,
      "line" : 390,
      "node_id" : "PRRC_kwDOABII585FdFRu",
      "original_commit_id" : "e83babe3b85b22e2360a99f9827b2b0d107ad0fa",
      "original_line" : 390,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "src/qt/walletmodel.cpp",
      "position" : 41,
      "pull_request_review_id" : 1383002967,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165251694/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-13T09:17:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165251694",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1165367412"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165367412"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed in https://github.com/bitcoin-core/gui/pull/726.",
      "commit_id" : "18fc71a3adee5de0f74ba6ff18f5ed31ba79a646",
      "created_at" : "2023-04-13T11:05:03Z",
      "diff_hunk" : "@@ -377,18 +377,17 @@ static void NotifyKeyStoreStatusChanged(WalletModel *walletmodel)\n \n static void NotifyAddressBookChanged(WalletModel *walletmodel,\n         const CTxDestination &address, const std::string &label, bool isMine,\n-        const std::string &purpose, ChangeType status)\n+        wallet::AddressPurpose purpose, ChangeType status)\n {\n     QString strAddress = QString::fromStdString(EncodeDestination(address));\n     QString strLabel = QString::fromStdString(label);\n-    QString strPurpose = QString::fromStdString(purpose);\n \n-    qDebug() << \"NotifyAddressBookChanged: \" + strAddress + \" \" + strLabel + \" isMine=\" + QString::number(isMine) + \" purpose=\" + strPurpose + \" status=\" + QString::number(status);\n+    qDebug() << \"NotifyAddressBookChanged: \" + strAddress + \" \" + strLabel + \" isMine=\" + QString::number(isMine) + \" purpose=\" + QString::number(static_cast<uint8_t>(purpose)) + \" status=\" + QString::number(status);\n     bool invoked = QMetaObject::invokeMethod(walletmodel, \"updateAddressBook\",\n                               Q_ARG(QString, strAddress),\n                               Q_ARG(QString, strLabel),\n                               Q_ARG(bool, isMine),\n-                              Q_ARG(QString, strPurpose),\n+                              Q_ARG(wallet::AddressPurpose, purpose),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27217#discussion_r1165367412",
      "id" : 1165367412,
      "in_reply_to_id" : 1165016111,
      "line" : 390,
      "node_id" : "PRRC_kwDOABII585Fdhh0",
      "original_commit_id" : "e83babe3b85b22e2360a99f9827b2b0d107ad0fa",
      "original_line" : 390,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "src/qt/walletmodel.cpp",
      "position" : 41,
      "pull_request_review_id" : 1383174091,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27217",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165367412/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-13T11:05:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165367412",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   }
]
