{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "NONE",
   "body" : "### Is there an existing issue for this?\r\n\r\n- [ ] Similar questions was raised in #15745 but it is marked as \"solved\" and closed.\r\n\r\n### Current behaviour\r\n\r\nRegistry has a REG_SZ key `HKEY_CURRENT_USER\\SOFTWARE\\Bitcoin\\Bitcoin-Qt\\strDataDir` (and there can be Bitcoin-Qt-regtest\\strDataDir, Bitcoin-Qt-testnet\\strDataDir for test chains).\r\nIt is created by default when bitcoin-qt starts first time and after editing/accepting first start wizard.\r\nChange database directory to non-default path, put there bitcoin.conf with datadir=databasepath and run bitcoin-qt (-cli/etc) and bitcoin ignores datadir path if no -datadir argument passed to a program exclusively.\r\n\r\n### Expected behaviour\r\n\r\nIn all situations behavior must be identical - if we start without arguments or pass \"-conf\" then use .conf \"datadir=path\" (according to sections [main], [regtest], [test] or global if there are no sections) if .conf exists and datadir are there. Now it is ignored.\r\nIf we start with \"-datadir=path\" argument it's works.\r\n\r\n- - -\r\n### Steps to reproduce\r\n\r\n1. For example, change `HKEY_CURRENT_USER\\SOFTWARE\\Bitcoin\\Bitcoin-Qt\\strDataDir` to `W:\\BitcoinCore\\strDataDir` (assuming our disk is W: and all paths in this example exists).\r\n2. Create W:\\BitcoinCore\\strDataDir\\bitcoin.conf with three lines:\r\n`datadir=W:/BitcoinCore/DataDir/main1\r\n[main]\r\ndatadir=W:/BitcoinCore/DataDir/main2`\r\n3. Start `bitcoin-qt.exe -debuglogfile=W:/BitcoinCore/debug.no_params.log`\r\n4. After a few seconds close opened walled (bitcoin-qt) [Alt-F4].\r\n5. Start `bitcoin-qt.exe -datadir=W:\\BitcoinCore\\DataDir\\main -debuglogfile=W:\\BitcoinCore\\debug.w_datadir_param.log`   \r\n6. After a few seconds close opened walled (bitcoin-qt) [Alt-F4].\r\n7. Start `bitcoin-qt.exe -conf=W:\\BitcoinCore\\strDataDir\\bitcoin.conf -debuglogfile=W:\\BitcoinCore\\debug.w_conf_param.log`   \r\n8. After a few seconds close opened walled (bitcoin-qt) [Alt-F4].\r\n9. Check filesystem and logs (attached).\r\n\r\nI've used Sysinternals Process Monitor to dig what's happening.\r\n\r\n- - -\r\n### Relevant log output\r\n\r\n**debug.no_params.log**:\r\n\r\n> Default data directory C:\\Users\\USERNAME\\AppData\\Roaming\\Bitcoin\r\n> **Using data directory** W:\\BitcoinCore\\\\**strDataDir**\r\n> Config file: W:\\BitcoinCore\\strDataDir\\bitcoin.conf\r\n> Config file arg: datadir=\"W:/BitcoinCore/DataDir/main1\"\r\n> **Config file arg**: **[main] datadir**=\"W:/BitcoinCore/**DataDir/main2**\"\r\n> Creating peers.dat because the file was not found (\"W:\\BitcoinCore\\\\**strDataDir**\\peers.dat\")\r\n> Opening LevelDB in W:\\BitcoinCore\\\\**strDataDir\\blocks\\index**\r\n> Opening LevelDB in W:\\BitcoinCore\\\\**strDataDir\\chainstate**\r\n\r\n**debug.w_datadir_param.log**:\r\n\r\n> Default data directory C:\\Users\\USERNAME\\AppData\\Roaming\\Bitcoin\r\n> **Using data directory** W:\\BitcoinCore\\\\**DataDir\\main**\r\n> Config file: W:\\BitcoinCore\\DataDir\\main\\bitcoin.conf (not found, skipping)\r\n> **Command-line arg**: datadir=\"W:\\\\\\\\BitcoinCore\\\\\\\\**DataDir\\\\\\\\main**\"\r\n> Opening LevelDB in W:\\BitcoinCore\\\\\\\\**DataDir\\main\\blocks\\index**\r\n> Opening LevelDB in W:\\BitcoinCore\\\\**DataDir\\main\\chainstate**\r\n\r\n**debug.w_conf_param.log** output is identical to debug.no_params.log.\r\n\r\n- - -\r\n### How did you obtain Bitcoin Core\r\n\r\n1. Downloaded from [bitcoincore.org/bin](https://bitcoincore.org/bin/)\r\n2. Compiled from source\r\n\r\n### What version of Bitcoin Core are you using?\r\n\r\n24.0.1\r\n\r\n### Operating system and version\r\n\r\nWin 10 x64\r\n\r\n### Machine specifications\r\n\r\nNon relevant",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 0,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27246/comments",
   "created_at" : "2023-03-12T13:46:00Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27246/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/27246",
   "id" : 1620371911,
   "labels" : [],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27246/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "I_kwDOABII585glOnH",
   "number" : 27246,
   "performed_via_github_app" : null,
   "reactions" : {
      "+1" : 0,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 1,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 1,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27246/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "state_reason" : null,
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27246/timeline",
   "title" : "Bitcoin ignores datadir parameter in .conf",
   "updated_at" : "2023-03-12T14:44:23Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27246",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/18093731?v=4",
      "events_url" : "https://api.github.com/users/desirepl/events{/privacy}",
      "followers_url" : "https://api.github.com/users/desirepl/followers",
      "following_url" : "https://api.github.com/users/desirepl/following{/other_user}",
      "gists_url" : "https://api.github.com/users/desirepl/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/desirepl",
      "id" : 18093731,
      "login" : "desirepl",
      "node_id" : "MDQ6VXNlcjE4MDkzNzMx",
      "organizations_url" : "https://api.github.com/users/desirepl/orgs",
      "received_events_url" : "https://api.github.com/users/desirepl/received_events",
      "repos_url" : "https://api.github.com/users/desirepl/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/desirepl/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/desirepl/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/desirepl"
   }
}
