[
   {
      "author_association" : "MEMBER",
      "body" : "cc @achow101",
      "created_at" : "2023-03-20T12:03:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27283#issuecomment-1476101437",
      "id" : 1476101437,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27283",
      "node_id" : "IC_kwDOABII585X-4U9",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1476101437/reactions"
      },
      "updated_at" : "2023-03-20T12:03:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1476101437",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Doesn't look like you've provided anything more actionable or useful than the last comment in #19034?",
      "created_at" : "2023-03-20T12:08:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27283#issuecomment-1476110273",
      "id" : 1476110273,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27283",
      "node_id" : "IC_kwDOABII585X-6fB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1476110273/reactions"
      },
      "updated_at" : "2023-03-20T12:08:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1476110273",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Also if you are going to open issues like this, can you provide more information. i.e you don't even tell us what version of the code this happens with. I guess we are meant to assume it's the latest commit in master? What compiler versions did you use? What system are you running on?",
      "created_at" : "2023-03-20T12:12:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27283#issuecomment-1476116230",
      "id" : 1476116230,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27283",
      "node_id" : "IC_kwDOABII585X-78G",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1476116230/reactions"
      },
      "updated_at" : "2023-03-20T12:12:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1476116230",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : ">There's currently no suppression file for the address sanitizer \r\n\r\nSee https://github.com/bitcoin/bitcoin/blob/master/test/sanitizer_suppressions/lsan",
      "created_at" : "2023-03-20T12:15:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27283#issuecomment-1476120851",
      "id" : 1476120851,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27283",
      "node_id" : "IC_kwDOABII585X-9ET",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1476120851/reactions"
      },
      "updated_at" : "2023-03-20T12:15:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1476120851",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@fanquake that was 65840 bytes, this one is 320 bytes, so I assume it's a different issue?\r\n\r\nI was going to add more details if anyone couldn't reproduce it, but here we go:\r\n\r\nFound it while testing a PR, but reproduced on master @ 40e1c4d4024b8ad35f2511b2e10bf80c5531dfde.\r\n\r\n```\r\nUbuntu clang version 15.0.6\r\nTarget: x86_64-pc-linux-gnu\r\n\r\nUbuntu 22.10 (GNU/Linux 6.0.6-060006-generic x86_64)\r\n```\r\n\r\n@MarcoFalke I'll see if I can get that too work.",
      "created_at" : "2023-03-20T12:34:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27283#issuecomment-1476147317",
      "id" : 1476147317,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27283",
      "node_id" : "IC_kwDOABII585X_Dh1",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1476147317/reactions"
      },
      "updated_at" : "2023-03-20T12:34:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1476147317",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This leak may be fixed in bdb5.3, but I haven't re-checked this.",
      "created_at" : "2023-03-20T12:36:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27283#issuecomment-1476150784",
      "id" : 1476150784,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27283",
      "node_id" : "IC_kwDOABII585X_EYA",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1476150784/reactions"
      },
      "updated_at" : "2023-03-20T12:36:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1476150784",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Narrowed it down to `BOOST_FIXTURE_TEST_CASE(CreateWallet, TestChain100Setup)`.",
      "created_at" : "2023-03-20T12:58:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27283#issuecomment-1476189108",
      "id" : 1476189108,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27283",
      "node_id" : "IC_kwDOABII585X_Nu0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1476189108/reactions"
      },
      "updated_at" : "2023-03-20T12:58:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1476189108",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I was going to add more details if anyone couldn't reproduce it, but here we go\n\nIn future, save us all wasting our time, and provide the (trivial to do so) details initially.",
      "created_at" : "2023-03-20T13:03:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27283#issuecomment-1476197268",
      "id" : 1476197268,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27283",
      "node_id" : "IC_kwDOABII585X_PuU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1476197268/reactions"
      },
      "updated_at" : "2023-03-20T13:03:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1476197268",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "That test can be further narrowed down:\r\n\r\n```cpp\r\nBOOST_FIXTURE_TEST_CASE(CreateWallet, TestChain100Setup)\r\n{\r\n    WalletContext context;\r\n    context.args = &m_args;\r\n    context.chain = m_node.chain.get();\r\n    auto wallet = TestLoadWallet(context);\r\n    // TestUnloadWallet(std::move(wallet));\r\n    // wallet = TestLoadWallet(context);\r\n    TestUnloadWallet(std::move(wallet));\r\n}\r\n```\r\n\r\nUncommenting the extra unload & load will trigger the sanitizer.\r\n\r\n\r\nThis also implies it's different from #19034 because that specifically refers to \"This happens when trying to load a wallet with corrupt logs.\". I might do a bisect...",
      "created_at" : "2023-03-20T13:09:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27283#issuecomment-1476207042",
      "id" : 1476207042,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27283",
      "node_id" : "IC_kwDOABII585X_SHC",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1476207042/reactions"
      },
      "updated_at" : "2023-03-20T13:20:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1476207042",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I went back to the #18727 merge commit 0f204dd3f21b997334a0e99954c939db154b64ca where this test was introduced. In order to test that old commit, I used `contrib/install_db4.sh` as it existed at the time, but otherwise didn't use depends (can't get that old version of boost to build). I then recreated a narrowed down test:\r\n\r\n```cpp\r\n    auto chain = interfaces::MakeChain(m_node);\r\n    auto wallet = TestLoadWallet(*chain);\r\n    TestUnloadWallet(std::move(wallet));\r\n    wallet = TestLoadWallet(*chain);\r\n    TestUnloadWallet(std::move(wallet));\r\n```\r\n\r\nThis did not produce a memory leak (the full test file does).\r\n\r\nSo I guess we have a `good` and `bad` for `bisect` now, but with all the build system changes it's a bit non-trivial. It may be more efficient to just figure out what causes the memory leak.",
      "created_at" : "2023-03-20T14:44:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27283#issuecomment-1476364655",
      "id" : 1476364655,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27283",
      "node_id" : "IC_kwDOABII585X_4lv",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1476364655/reactions"
      },
      "updated_at" : "2023-03-20T14:44:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1476364655",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Git bisect points to 8b5e7297c02f3100a9cb27bfe206e3fc617ec173 as the culprit (#19619). I verified that this commit triggers the error whereas its parent 3c815cfe54087fd139169161d2fd175e99840e6a doesn't.\r\n\r\nIt makes sense that this went unnoticed because `wallet_tests` was already suffering from a different memory leak at the time. cc @ryanofsky",
      "created_at" : "2023-03-20T15:58:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27283#issuecomment-1476501591",
      "id" : 1476501591,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27283",
      "node_id" : "IC_kwDOABII585YAaBX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1476501591/reactions"
      },
      "updated_at" : "2023-03-20T15:58:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1476501591",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "It's not limited to the test. Running that commit in regtest, creating a wallet and then exiting triggers it too. That should make debugging easierâ¦ And after that it's just a matter of starting and stopping bitcoind.\r\n\r\nOr just do it on master @ f4e42a78c75719ad6a99962360ec67d92a563a9d. But there it only happens if you load a legacy wallet. Not when you create one.",
      "created_at" : "2023-03-20T18:43:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27283#issuecomment-1476753978",
      "id" : 1476753978,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27283",
      "node_id" : "IC_kwDOABII585YBXo6",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1476753978/reactions"
      },
      "updated_at" : "2023-03-20T18:54:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1476753978",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Building bdb with DEBUG=1 did not make the `LeakSanitizer` output more usable.\r\n\r\nI also tried compiling with gcc (12.2.0) and then running under valgrind (3.18.1). This yielded much more useful info:\r\n\r\n```sh\r\n./configure BDB_LIBS=â¦ --enable-suppress-external-warnings --enable-debug --disable-asm  --disable-fuzz-binary --disable-bench --without-gui --disable-test\r\nâ¦ \r\nvalgrind âleak-check=full src/bitcoind -regtest -nowallet -wallet=test_legacy\r\n```\r\n\r\n```\r\n023-03-20T19:32:09Z [test_legacy] Releasing wallet\r\n2023-03-20T19:32:09Z Shutdown: done\r\n==1744646== \r\n==1744646== HEAP SUMMARY:\r\n==1744646==     in use at exit: 2,377 bytes in 12 blocks\r\n==1744646==   total heap usage: 296,219 allocs, 296,207 frees, 103,153,206 bytes allocated\r\n==1744646== \r\n==1744646== 160 bytes in 1 blocks are definitely lost in loss record 6 of 12\r\n==1744646==    at 0x4844899: malloc (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so)\r\n==1744646==    by 0xE702AD: __os_malloc (in /home/sjors/dev/bitcoin2/src/bitcoind)\r\n==1744646==    by 0xE455CC: __env_alloc (in /home/sjors/dev/bitcoin2/src/bitcoind)\r\n==1744646==    by 0xEE3CC1: __lock_open (in /home/sjors/dev/bitcoin2/src/bitcoind)\r\n==1744646==    by 0xE497EB: __env_attach_regions (in /home/sjors/dev/bitcoin2/src/bitcoind)\r\n==1744646==    by 0xE49A8E: __env_open (in /home/sjors/dev/bitcoin2/src/bitcoind)\r\n==1744646==    by 0xE49C01: __env_open_pp (in /home/sjors/dev/bitcoin2/src/bitcoind)\r\n==1744646==    by 0xE16E7D: DbEnv::open(char const*, unsigned int, int) (in /home/sjors/dev/bitcoin2/src/bitcoind)\r\n==1744646==    by 0x9EDDE8: wallet::BerkeleyEnvironment::Open(bilingual_str&) (bdb.cpp:164)\r\n==1744646==    by 0x9EEF34: wallet::BerkeleyDatabase::Verify(bilingual_str&) (bdb.cpp:271)\r\n==1744646==    by 0x9F41C8: wallet::MakeBerkeleyDatabase(fs::path const&, wallet::DatabaseOptions const&, wallet::DatabaseStatus&, bilingual_str&) (bdb.cpp:849)\r\n==1744646==    by 0x9A074A: wallet::MakeDatabase(fs::path const&, wallet::DatabaseOptions const&, wallet::DatabaseStatus&, bilingual_str&) (walletdb.cpp:1228)\r\n==1744646== \r\n==1744646== LEAK SUMMARY:\r\n==1744646==    definitely lost: 160 bytes in 1 blocks\r\n==1744646==    indirectly lost: 0 bytes in 0 blocks\r\n==1744646==      possibly lost: 0 bytes in 0 blocks\r\n==1744646==    still reachable: 2,217 bytes in 11 blocks\r\n==1744646==         suppressed: 0 bytes in 0 blocks\r\n==1744646== Reachable blocks (those to which a pointer was found) are not shown.\r\n==1744646== To see them, rerun with: --leak-check=full --show-leak-kinds=all\r\n==1744646== \r\n==1744646== For lists of detected and suppressed errors, rerun with: -s\r\n==1744646== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)\r\n```",
      "created_at" : "2023-03-20T19:32:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27283#issuecomment-1476822455",
      "id" : 1476822455,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27283",
      "node_id" : "IC_kwDOABII585YBoW3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1476822455/reactions"
      },
      "updated_at" : "2023-03-20T19:35:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1476822455",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> This leak may be fixed in bdb5.3, but I haven't re-checked this.\r\n\r\nI tried with `apt install libdb++-dev` version 5.3.28 and `./configure --with-incompatible-bdb â¦`\r\n\r\nThis shows \"Using BerkeleyDB version Berkeley DB 5.3.28: (September  9, 2013)\" in the log.\r\n\r\nThere's no leak. Not with valgrind (gcc) and not with the address sanitizer (clang).\r\n\r\nI clarified the top description (but also kept the original text).",
      "created_at" : "2023-03-20T19:46:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27283#issuecomment-1476836735",
      "id" : 1476836735,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27283",
      "node_id" : "IC_kwDOABII585YBr1_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1476836735/reactions"
      },
      "updated_at" : "2023-03-20T20:03:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1476836735",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This is puzzling because https://github.com/bitcoin/bitcoin/issues/27283#issuecomment-1476822455 seems to suggest that memory is leaked while creating the BDB environment, but the commit which triggers the leak 8b5e7297c02f3100a9cb27bfe206e3fc617ec173 does not seem to be changing the way the environment is created or how it is used. The commit does switch from using a function called `CreateWalletDatabase` to another one called `MakeWalletDatabase`, but in both cases the functions are calling the same `GetWalletEnv` function to get a shared_ptr to the BerkeleyEnvironment, and passing that pointer to the BerkeleyDatabase constructor.\r\n\r\nI guess the fact that the leak happens in one version of BDB but another suggests it is a BDB bug, but it's not clear what could be changing in commit 8b5e7297c02f3100a9cb27bfe206e3fc617ec173 which triggers the bug.\r\n\r\nI haven't tried to reproduce this myself, though, so just going off of the information above.",
      "created_at" : "2023-03-20T22:10:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27283#issuecomment-1477004863",
      "id" : 1477004863,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27283",
      "node_id" : "IC_kwDOABII585YCU4_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1477004863/reactions"
      },
      "updated_at" : "2023-03-20T22:10:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1477004863",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've been able to reproduce the leak that valgrind finds on master. It appears to be related to the `-privdb` option; looking at the BDB source, the problem occurs inside a block of code guarded by a check for the `DB_PRIVATE` flag. Disabling that with `-privdb=0` \"resolves\" the leak. Changing this setting in the code also resolves the LeakSanitizer error.\r\n\r\nNone of the commits mentioned that are supposed to be \"good\" are not for me. They all fail in valgrind with the same error. I believe this is an issue with BDB itself that we cannot fix. I think the only solution is for us to either update BDB or ditch it entirely.\r\n\r\nI've looked through the BDB change logs between 4.8 and 5.3, and it seems like having memory leaks for private dbs is not uncommon. Multiple changelogs mention a couple fixes of memory leaks regarding private dbs.",
      "created_at" : "2023-03-20T23:13:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27283#issuecomment-1477072935",
      "id" : 1477072935,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27283",
      "node_id" : "IC_kwDOABII585YClgn",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1477072935/reactions"
      },
      "updated_at" : "2023-03-20T23:53:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1477072935",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "It turns out 8b5e7297c02f3100a9cb27bfe206e3fc617ec173 triggers the test failure I [described above](https://github.com/bitcoin/bitcoin/issues/27283#issuecomment-1476364655), but it had no impact on the regular wallet loading / unloading. So maybe it's not exactly the same issue.\r\n\r\nStarting with `-privdb=0` indeed removes the memory leak for me for wallet loading / unloading. Dropping the `DB_PRIVATE` in `bdb.cpp` also fixes the test for me.\r\n\r\nThe release notes for 0.3.13 state \"Dropped DB_PRIVATE Berkeley DB flag.\", but it was added back in #1367.\r\n\r\n",
      "created_at" : "2023-03-21T12:21:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27283#issuecomment-1477744971",
      "id" : 1477744971,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27283",
      "node_id" : "IC_kwDOABII585YFJlL",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1477744971/reactions"
      },
      "updated_at" : "2023-03-21T12:22:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1477744971",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   }
]
