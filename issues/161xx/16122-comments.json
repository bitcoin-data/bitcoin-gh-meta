[
   {
      "author_association" : "MEMBER",
      "body" : "It's not possible to run RPC commands (not even by bitcoin-cli) if the initial rescan hasn't completed.  A long term alternative is to move this rescan after the initialization? /cc @ryanofsky ",
      "created_at" : "2019-05-29T22:04:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16122#issuecomment-497125663",
      "id" : 497125663,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16122",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5NzEyNTY2Mw==",
      "updated_at" : "2019-05-29T22:04:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/497125663",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> A long term alternative is to move this rescan after the initialization? /cc @ryanofsky\r\n\r\nSince the rescan loop doesn't hold onto cs_main anymore, I'd expect that RPC commands could work during a rescan, and don't understand exactly what problem causes this crash, and what problem causes bitcoin-cli not to work right now.\r\n\r\nLonger term, I think the main thing that needs to happen is for the rescan loop to move out of the wallet into the node (`src/node/rescan.cpp` or someplace like that) so when multiple wallets are loaded they are all rescanned in parallel instead of sequentially one after another other. I expect the way that would work is that during loading, each wallet would asynchronously request a rescan from the node, passing it a locator. Then after all the wallets are loaded, the node would do a single rescan from the earliest point, sending wallets the normal notifications.\r\n\r\nIn terms of implementation I would build this on top of #15719 by adding a `CBlockLocator` argument to ~~`Chain::requestNotifications()`~~ `Chain::handleNotifications()`. There would also need to be explicit `requestRescan`/`abortRescan` `Chain` methods to trigger rescans after wallets are loaded, for when users import keys or explicity request rescans.",
      "created_at" : "2019-05-30T11:24:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16122#issuecomment-497297921",
      "id" : 497297921,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16122",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5NzI5NzkyMQ==",
      "updated_at" : "2019-05-30T15:51:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/497297921",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> and what problem causes bitcoin-cli not to work right now.\r\n\r\nBecause the server gives `RPC_IN_WARMUP`:\r\n```sh\r\nsrc/bitcoin-cli -regtest help\r\nerror code: -28\r\nerror message:\r\nRescanning...\r\n```\r\n\r\n> don't understand exactly what problem causes this crash\r\n\r\nBecause  `autoCompleter` is null here:\r\nhttps://github.com/bitcoin/bitcoin/blob/727143b65cdb801a0b755cb8b3aff97da5fe8f27/src/qt/rpcconsole.cpp#L535 \r\n\r\n> I think the main thing that needs to happen is for the rescan loop to move out of the wallet into the node\r\n\r\nThis would go away right?\r\nhttps://github.com/bitcoin/bitcoin/blob/c7cfd20a77ce57d200b3b9e5e0dfb0d63818abdc/src/walletinitinterface.h#L22-L23",
      "created_at" : "2019-05-30T15:38:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16122#issuecomment-497375129",
      "id" : 497375129,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16122",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5NzM3NTEyOQ==",
      "updated_at" : "2019-05-30T15:38:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/497375129",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16122#discussion_r289049142"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16122"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/289049142"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe add a comment saying the edit line starts off disabled to wait for rpc warmup.",
      "commit_id" : "2d8ad2f99710a8981e33fe2d6ce834b0076c4e80",
      "created_at" : "2019-05-30T15:45:00Z",
      "diff_hunk" : "@@ -677,6 +677,7 @@ void RPCConsole::setClientModel(ClientModel *model)\n         wordList.sort();\n         autoCompleter = new QCompleter(wordList, this);\n         autoCompleter->setModelSorting(QCompleter::CaseSensitivelySortedModel);\n+        ui->lineEdit->setEnabled(true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16122#discussion_r289049142",
      "id" : 289049142,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTA0OTE0Mg==",
      "original_commit_id" : "727143b65cdb801a0b755cb8b3aff97da5fe8f27",
      "original_position" : 4,
      "path" : "src/qt/rpcconsole.cpp",
      "position" : 6,
      "pull_request_review_id" : 243871522,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16122",
      "updated_at" : "2019-05-30T22:26:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/289049142",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16122#discussion_r289196362"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16122"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/289196362"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "2d8ad2f99710a8981e33fe2d6ce834b0076c4e80",
      "created_at" : "2019-05-30T22:26:27Z",
      "diff_hunk" : "@@ -677,6 +677,7 @@ void RPCConsole::setClientModel(ClientModel *model)\n         wordList.sort();\n         autoCompleter = new QCompleter(wordList, this);\n         autoCompleter->setModelSorting(QCompleter::CaseSensitivelySortedModel);\n+        ui->lineEdit->setEnabled(true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16122#discussion_r289196362",
      "id" : 289196362,
      "in_reply_to_id" : 289049142,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTE5NjM2Mg==",
      "original_commit_id" : "727143b65cdb801a0b755cb8b3aff97da5fe8f27",
      "original_position" : 4,
      "path" : "src/qt/rpcconsole.cpp",
      "position" : 6,
      "pull_request_review_id" : 244060228,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16122",
      "updated_at" : "2019-05-30T22:26:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/289196362",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "tACK https://github.com/bitcoin/bitcoin/pull/16122/commits/2d8ad2f99710a8981e33fe2d6ce834b0076c4e80 on macOS.\r\n\r\nUsing master (c7cfd20a77ce57d200b3b9e5e0dfb0d63818abdc) it's possible to cause a crash during startup by opening `Window` -> `Console` typing anything into the console and hitting enter.\r\n\r\n```bash\r\nlldb Bitcoin-Qt.app\r\n(lldb) target create \"Bitcoin-Qt.app\"\r\nCurrent executable set to 'Bitcoin-Qt.app' (x86_64).\r\n(lldb) run\r\nProcess 59937 launched: '/Users/michael/github/bitcoin/Bitcoin-Qt.app/Contents/MacOS/Bitcoin-Qt' (x86_64)\r\n2019-05-31 09:53:29.580881-0400 Bitcoin-Qt[59937:3647765] MessageTracer: Falling back to default whitelist\r\nProcess 59937 stopped\r\n* thread #1, name = 'bitcoin-main', queue = 'com.apple.main-thread', stop reason = EXC_BAD_ACCESS (code=1, address=0x8)\r\n    frame #0: 0x00000001011a78ba QtWidgets`QCompleter::popup() const + 10\r\nQtWidgets`QCompleter::popup:\r\n->  0x1011a78ba <+10>: movq   0x8(%rdi), %rbx\r\n    0x1011a78be <+14>: movq   0x88(%rbx), %rax\r\n    0x1011a78c5 <+21>: testq  %rax, %rax\r\n    0x1011a78c8 <+24>: jne    0x1011a7942               ; <+146>\r\nTarget 0: (Bitcoin-Qt) stopped.\r\n```\r\n\r\nUsing this PR (https://github.com/bitcoin/bitcoin/pull/16122/commits/2d8ad2f99710a8981e33fe2d6ce834b0076c4e80), it's still possible to get to the console during startup, but it's impossible to enter or execute any commands. The console is enabled when startup completes.",
      "created_at" : "2019-05-31T14:06:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16122#issuecomment-497721221",
      "id" : 497721221,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16122",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5NzcyMTIyMQ==",
      "updated_at" : "2019-05-31T14:06:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/497721221",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   }
]
