[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19137 (wallettool: Add dump and createfromdump commands by achow101)\n* #19078 (test: Add salvage test for wallet tool by MarcoFalke)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-11-11T12:34:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20365#issuecomment-725398667",
      "id" : 725398667,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20365",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyNTM5ODY2Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-02T17:29:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/725398667",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. cc @achow101 ",
      "created_at" : "2020-11-12T12:51:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20365#issuecomment-726058845",
      "id" : 726058845,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20365",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyNjA1ODg0NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-12T12:51:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/726058845",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20365#discussion_r522265003"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20365"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/522265003"
         }
      },
      "author_association" : "MEMBER",
      "body" : "For a followup, we should de-duplicate this logic with the setup in `CWallet::Create`.",
      "commit_id" : "173cc9b7be335b5dd2cc1bb112dfa6ec5c13ec12",
      "created_at" : "2020-11-12T17:01:32Z",
      "diff_hunk" : "@@ -21,16 +21,19 @@ static void WalletToolReleaseWallet(CWallet* wallet)\n     delete wallet;\n }\n \n-static void WalletCreate(CWallet* wallet_instance)\n+static void WalletCreate(CWallet* wallet_instance, uint64_t wallet_creation_flags)\n {\n     LOCK(wallet_instance->cs_wallet);\n \n     wallet_instance->SetMinVersion(FEATURE_HD_SPLIT);\n+    wallet_instance->AddWalletFlags(wallet_creation_flags);\n \n-    // generate a new HD seed\n-    auto spk_man = wallet_instance->GetOrCreateLegacyScriptPubKeyMan();\n-    CPubKey seed = spk_man->GenerateNewSeed();\n-    spk_man->SetHDSeed(seed);\n+    if (!wallet_instance->IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS)) {\n+        auto spk_man = wallet_instance->GetOrCreateLegacyScriptPubKeyMan();\n+        spk_man->SetupGeneration(false);\n+    } else {\n+        wallet_instance->SetupDescriptorScriptPubKeyMans();\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20365#discussion_r522265003",
      "id" : 522265003,
      "line" : 36,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjI2NTAwMw==",
      "original_commit_id" : "345e88eecf1b28607d5da3af38e19794a8a115ce",
      "original_line" : 36,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : 21,
      "pull_request_review_id" : 529296267,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20365",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-13T10:52:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/522265003",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, could use some tests.",
      "created_at" : "2020-11-12T17:02:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20365#issuecomment-726207650",
      "id" : 726207650,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20365",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyNjIwNzY1MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-12T17:02:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/726207650",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20365#discussion_r522771512"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20365"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/522771512"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "That is what I was thinking too. The main challenge is that `CWallet::Create` requires a `chain` object which is used in quite a few places. Other than that it does what we need. I have a few ideas how to deal with it:\r\n\r\na) create dummy chain object that would return only zero/null values\r\nb) make `chain` argument optional and check every time before using it\r\nc) chip away a piece of `CWallet::Create` that could be used without chain into a separate function\r\n\r\n@achow101  What do you think is the best option in your opinion?",
      "commit_id" : "173cc9b7be335b5dd2cc1bb112dfa6ec5c13ec12",
      "created_at" : "2020-11-13T08:10:18Z",
      "diff_hunk" : "@@ -21,16 +21,19 @@ static void WalletToolReleaseWallet(CWallet* wallet)\n     delete wallet;\n }\n \n-static void WalletCreate(CWallet* wallet_instance)\n+static void WalletCreate(CWallet* wallet_instance, uint64_t wallet_creation_flags)\n {\n     LOCK(wallet_instance->cs_wallet);\n \n     wallet_instance->SetMinVersion(FEATURE_HD_SPLIT);\n+    wallet_instance->AddWalletFlags(wallet_creation_flags);\n \n-    // generate a new HD seed\n-    auto spk_man = wallet_instance->GetOrCreateLegacyScriptPubKeyMan();\n-    CPubKey seed = spk_man->GenerateNewSeed();\n-    spk_man->SetHDSeed(seed);\n+    if (!wallet_instance->IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS)) {\n+        auto spk_man = wallet_instance->GetOrCreateLegacyScriptPubKeyMan();\n+        spk_man->SetupGeneration(false);\n+    } else {\n+        wallet_instance->SetupDescriptorScriptPubKeyMans();\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20365#discussion_r522771512",
      "id" : 522771512,
      "in_reply_to_id" : 522265003,
      "line" : 36,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjc3MTUxMg==",
      "original_commit_id" : "345e88eecf1b28607d5da3af38e19794a8a115ce",
      "original_line" : 36,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : 21,
      "pull_request_review_id" : 529851924,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20365",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-13T10:52:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/522771512",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20365#discussion_r524499630"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20365"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/524499630"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/20365#discussion_r522771512\r\n\r\nOffhand (c) sounds great, (b) would be also be good, and it would be nice to avoid (a). The CWallet class is huge and to the extent you can pull out more functionality into standalone functions that's a good thing. Especially any functionality that does not require access to a chain state and a running node is a good candidate for being pulled out of CWallet.\r\n\r\nCommit be164f9cf89b123f03b926aa980996919924ee64 from #15719 is kind of related (best viewed with `git log -p -n1 -w --color-moved=dimmed_zebra be164f9cf89b123f03b926aa980996919924ee64` since github display doesn't detect moved code). It moves some online functionality out of CWallet::Create into a new CWallet::AttachChain method.",
      "commit_id" : "173cc9b7be335b5dd2cc1bb112dfa6ec5c13ec12",
      "created_at" : "2020-11-16T18:55:08Z",
      "diff_hunk" : "@@ -21,16 +21,19 @@ static void WalletToolReleaseWallet(CWallet* wallet)\n     delete wallet;\n }\n \n-static void WalletCreate(CWallet* wallet_instance)\n+static void WalletCreate(CWallet* wallet_instance, uint64_t wallet_creation_flags)\n {\n     LOCK(wallet_instance->cs_wallet);\n \n     wallet_instance->SetMinVersion(FEATURE_HD_SPLIT);\n+    wallet_instance->AddWalletFlags(wallet_creation_flags);\n \n-    // generate a new HD seed\n-    auto spk_man = wallet_instance->GetOrCreateLegacyScriptPubKeyMan();\n-    CPubKey seed = spk_man->GenerateNewSeed();\n-    spk_man->SetHDSeed(seed);\n+    if (!wallet_instance->IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS)) {\n+        auto spk_man = wallet_instance->GetOrCreateLegacyScriptPubKeyMan();\n+        spk_man->SetupGeneration(false);\n+    } else {\n+        wallet_instance->SetupDescriptorScriptPubKeyMans();\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20365#discussion_r524499630",
      "id" : 524499630,
      "in_reply_to_id" : 522265003,
      "line" : 36,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDQ5OTYzMA==",
      "original_commit_id" : "345e88eecf1b28607d5da3af38e19794a8a115ce",
      "original_line" : 36,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : 21,
      "pull_request_review_id" : 531613426,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20365",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-16T18:55:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/524499630",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20365#discussion_r524503841"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20365"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/524503841"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Agree with @ryanofsky. The best option I think is to break apart `CWallet::Create` and refactor pieces of it into standalone functions.",
      "commit_id" : "173cc9b7be335b5dd2cc1bb112dfa6ec5c13ec12",
      "created_at" : "2020-11-16T19:02:01Z",
      "diff_hunk" : "@@ -21,16 +21,19 @@ static void WalletToolReleaseWallet(CWallet* wallet)\n     delete wallet;\n }\n \n-static void WalletCreate(CWallet* wallet_instance)\n+static void WalletCreate(CWallet* wallet_instance, uint64_t wallet_creation_flags)\n {\n     LOCK(wallet_instance->cs_wallet);\n \n     wallet_instance->SetMinVersion(FEATURE_HD_SPLIT);\n+    wallet_instance->AddWalletFlags(wallet_creation_flags);\n \n-    // generate a new HD seed\n-    auto spk_man = wallet_instance->GetOrCreateLegacyScriptPubKeyMan();\n-    CPubKey seed = spk_man->GenerateNewSeed();\n-    spk_man->SetHDSeed(seed);\n+    if (!wallet_instance->IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS)) {\n+        auto spk_man = wallet_instance->GetOrCreateLegacyScriptPubKeyMan();\n+        spk_man->SetupGeneration(false);\n+    } else {\n+        wallet_instance->SetupDescriptorScriptPubKeyMans();\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20365#discussion_r524503841",
      "id" : 524503841,
      "in_reply_to_id" : 522265003,
      "line" : 36,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDUwMzg0MQ==",
      "original_commit_id" : "345e88eecf1b28607d5da3af38e19794a8a115ce",
      "original_line" : 36,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : 21,
      "pull_request_review_id" : 531618707,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20365",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-16T19:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/524503841",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20365#discussion_r524855811"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20365"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/524855811"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "@ryanofsky @achow101 thanks for the advice and the reference. I'll start working on the refactoring in separate PR as I think it's better not to mix things up.\r\n\r\nI've extended functional tests to cover for the new parameter. Any comments on this PR?",
      "commit_id" : "173cc9b7be335b5dd2cc1bb112dfa6ec5c13ec12",
      "created_at" : "2020-11-17T03:07:28Z",
      "diff_hunk" : "@@ -21,16 +21,19 @@ static void WalletToolReleaseWallet(CWallet* wallet)\n     delete wallet;\n }\n \n-static void WalletCreate(CWallet* wallet_instance)\n+static void WalletCreate(CWallet* wallet_instance, uint64_t wallet_creation_flags)\n {\n     LOCK(wallet_instance->cs_wallet);\n \n     wallet_instance->SetMinVersion(FEATURE_HD_SPLIT);\n+    wallet_instance->AddWalletFlags(wallet_creation_flags);\n \n-    // generate a new HD seed\n-    auto spk_man = wallet_instance->GetOrCreateLegacyScriptPubKeyMan();\n-    CPubKey seed = spk_man->GenerateNewSeed();\n-    spk_man->SetHDSeed(seed);\n+    if (!wallet_instance->IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS)) {\n+        auto spk_man = wallet_instance->GetOrCreateLegacyScriptPubKeyMan();\n+        spk_man->SetupGeneration(false);\n+    } else {\n+        wallet_instance->SetupDescriptorScriptPubKeyMans();\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20365#discussion_r524855811",
      "id" : 524855811,
      "in_reply_to_id" : 522265003,
      "line" : 36,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg1NTgxMQ==",
      "original_commit_id" : "345e88eecf1b28607d5da3af38e19794a8a115ce",
      "original_line" : 36,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : 21,
      "pull_request_review_id" : 531989559,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20365",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-17T03:07:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/524855811",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20365#discussion_r534395176"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20365"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/534395176"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallettool: add param to create descriptors wallet\" (345e88eecf1b28607d5da3af38e19794a8a115ce)\r\n\r\nIt would be good to have enforcement in ExecuteWalletToolFunc that option is only allowed for create command so existing \"info\" and \"salvage\" commands don't start accepting but ignoring this option now, and so future commands like \"createfromdump\" don't start accepting it in the future. Something like the following should be sufficient for now (could generalize later):\r\n\r\n```c++\r\nif (gArgs.IsArgSet(\"-descriptors\") && command != \"create\") {\r\n   tfm::format(std::cerr, \"Invalid parameter %s\\n\", \"-descriptors\");\r\n   return false;\r\n}\r\n```",
      "commit_id" : "173cc9b7be335b5dd2cc1bb112dfa6ec5c13ec12",
      "created_at" : "2020-12-02T18:37:54Z",
      "diff_hunk" : "@@ -27,6 +27,7 @@ static void SetupWalletToolArgs(ArgsManager& argsman)\n     argsman.AddArg(\"-datadir=<dir>\", \"Specify data directory\", ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-wallet=<wallet-name>\", \"Specify wallet name\", ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-debug=<category>\", \"Output debugging information (default: 0).\", ArgsManager::ALLOW_ANY, OptionsCategory::DEBUG_TEST);\n+    argsman.AddArg(\"-descriptors\", \"Create descriptors wallet. Only for create\", ArgsManager::ALLOW_BOOL, OptionsCategory::OPTIONS);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20365#discussion_r534395176",
      "id" : 534395176,
      "line" : 30,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDM5NTE3Ng==",
      "original_commit_id" : "345e88eecf1b28607d5da3af38e19794a8a115ce",
      "original_line" : 30,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/bitcoin-wallet.cpp",
      "position" : 4,
      "pull_request_review_id" : 543129983,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20365",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-02T18:45:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/534395176",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20365#discussion_r534395401"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20365"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/534395401"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/20365#discussion_r524855811\r\n\r\n> @ryanofsky @achow101 thanks for the advice and the reference. I'll start working on the refactoring in separate PR as I think it's better not to mix things up.\r\n> \r\n> I've extended functional tests to cover for the new parameter. Any comments on this PR?\r\n\r\nLooks good!",
      "commit_id" : "173cc9b7be335b5dd2cc1bb112dfa6ec5c13ec12",
      "created_at" : "2020-12-02T18:38:17Z",
      "diff_hunk" : "@@ -21,16 +21,19 @@ static void WalletToolReleaseWallet(CWallet* wallet)\n     delete wallet;\n }\n \n-static void WalletCreate(CWallet* wallet_instance)\n+static void WalletCreate(CWallet* wallet_instance, uint64_t wallet_creation_flags)\n {\n     LOCK(wallet_instance->cs_wallet);\n \n     wallet_instance->SetMinVersion(FEATURE_HD_SPLIT);\n+    wallet_instance->AddWalletFlags(wallet_creation_flags);\n \n-    // generate a new HD seed\n-    auto spk_man = wallet_instance->GetOrCreateLegacyScriptPubKeyMan();\n-    CPubKey seed = spk_man->GenerateNewSeed();\n-    spk_man->SetHDSeed(seed);\n+    if (!wallet_instance->IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS)) {\n+        auto spk_man = wallet_instance->GetOrCreateLegacyScriptPubKeyMan();\n+        spk_man->SetupGeneration(false);\n+    } else {\n+        wallet_instance->SetupDescriptorScriptPubKeyMans();\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20365#discussion_r534395401",
      "id" : 534395401,
      "in_reply_to_id" : 522265003,
      "line" : 36,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDM5NTQwMQ==",
      "original_commit_id" : "345e88eecf1b28607d5da3af38e19794a8a115ce",
      "original_line" : 36,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : 21,
      "pull_request_review_id" : 543129983,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20365",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-02T18:45:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/534395401",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 173cc9b7be335b5dd2cc1bb112dfa6ec5c13ec12",
      "created_at" : "2020-12-02T22:55:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20365#issuecomment-737545508",
      "id" : 737545508,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20365",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDczNzU0NTUwOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-02T22:55:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/737545508",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Seems like this might be ready for merge. This is a straightforward change just adding a wallet tool create option. Does it need more review than it's had?",
      "created_at" : "2020-12-11T15:15:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20365#issuecomment-743251629",
      "id" : 743251629,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20365",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0MzI1MTYyOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-11T15:15:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/743251629",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   }
]
