[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r625042438"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/625042438"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe print the unrecognized string:\r\n```suggestion\r\n        throw JSONRPCError(RPC_INVALID_PARAMETER, strprintf(\"Network not recognized: %s\", request.params[1].get_str());\r\n```",
      "commit_id" : "bdc57fc120affcd255b5b79b505433f5ed4dc843",
      "created_at" : "2021-05-03T12:10:40Z",
      "diff_hunk" : "@@ -875,8 +879,13 @@ static RPCHelpMan getnodeaddresses()\n     const int count{request.params[0].isNull() ? 1 : request.params[0].get_int()};\n     if (count < 0) throw JSONRPCError(RPC_INVALID_PARAMETER, \"Address count out of range\");\n \n+    const Network network{request.params[1].isNull() ? Network::NET_MAX : ParseNetwork(request.params[1].get_str())};\n+    if (network == NET_UNROUTABLE) {\n+        throw JSONRPCError(RPC_INVALID_PARAMETER, \"Invalid network (not recognized)\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r625042438",
      "id" : 625042438,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNTA0MjQzOA==",
      "original_commit_id" : "faa28f6eceb84f861766c1b7f1109f608333402f",
      "original_line" : 884,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 650293036,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T07:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/625042438",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r625043781"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/625043781"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "To designate \"not specified / any network\", maybe `std::optional` would fit better than using the special value `NET_MAX`? I plan to remove `NET_MAX` some day.",
      "commit_id" : "bdc57fc120affcd255b5b79b505433f5ed4dc843",
      "created_at" : "2021-05-03T12:13:34Z",
      "diff_hunk" : "@@ -716,13 +716,13 @@ friend class CAddrManTest;\n     }\n \n     //! Return a bunch of addresses, selected at random.\n-    std::vector<CAddress> GetAddr(size_t max_addresses, size_t max_pct)\n+    std::vector<CAddress> GetAddr(size_t max_addresses, size_t max_pct, Network net = Network::NET_MAX)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r625043781",
      "id" : 625043781,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNTA0Mzc4MQ==",
      "original_commit_id" : "faa28f6eceb84f861766c1b7f1109f608333402f",
      "original_line" : 719,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 650293036,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T07:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/625043781",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r625045041"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/625045041"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The default value can be removed since all callers of this method always provide the argument.\r\n\r\n```suggestion\r\n    void GetAddr_(std::vector<CAddress> &vAddr, size_t max_addresses, size_t max_pct, Network net) EXCLUSIVE_LOCKS_REQUIRED(cs);\r\n```",
      "commit_id" : "bdc57fc120affcd255b5b79b505433f5ed4dc843",
      "created_at" : "2021-05-03T12:16:12Z",
      "diff_hunk" : "@@ -279,7 +279,7 @@ friend class CAddrManTest;\n #endif\n \n     //! Select several addresses at once.\n-    void GetAddr_(std::vector<CAddress> &vAddr, size_t max_addresses, size_t max_pct) EXCLUSIVE_LOCKS_REQUIRED(cs);\n+    void GetAddr_(std::vector<CAddress> &vAddr, size_t max_addresses, size_t max_pct, Network net = Network::NET_MAX) EXCLUSIVE_LOCKS_REQUIRED(cs);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r625045041",
      "id" : 625045041,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNTA0NTA0MQ==",
      "original_commit_id" : "faa28f6eceb84f861766c1b7f1109f608333402f",
      "original_line" : 282,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 650293036,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T07:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/625045041",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r625048295"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/625048295"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I was asking myself if `std::optional` would be better here. Thanks!",
      "commit_id" : "bdc57fc120affcd255b5b79b505433f5ed4dc843",
      "created_at" : "2021-05-03T12:22:48Z",
      "diff_hunk" : "@@ -716,13 +716,13 @@ friend class CAddrManTest;\n     }\n \n     //! Return a bunch of addresses, selected at random.\n-    std::vector<CAddress> GetAddr(size_t max_addresses, size_t max_pct)\n+    std::vector<CAddress> GetAddr(size_t max_addresses, size_t max_pct, Network net = Network::NET_MAX)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r625048295",
      "id" : 625048295,
      "in_reply_to_id" : 625043781,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNTA0ODI5NQ==",
      "original_commit_id" : "faa28f6eceb84f861766c1b7f1109f608333402f",
      "original_line" : 719,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 650300712,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T07:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/625048295",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r625311317"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/625311317"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good idea! Done.",
      "commit_id" : "bdc57fc120affcd255b5b79b505433f5ed4dc843",
      "created_at" : "2021-05-03T19:22:48Z",
      "diff_hunk" : "@@ -875,8 +879,13 @@ static RPCHelpMan getnodeaddresses()\n     const int count{request.params[0].isNull() ? 1 : request.params[0].get_int()};\n     if (count < 0) throw JSONRPCError(RPC_INVALID_PARAMETER, \"Address count out of range\");\n \n+    const Network network{request.params[1].isNull() ? Network::NET_MAX : ParseNetwork(request.params[1].get_str())};\n+    if (network == NET_UNROUTABLE) {\n+        throw JSONRPCError(RPC_INVALID_PARAMETER, \"Invalid network (not recognized)\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r625311317",
      "id" : 625311317,
      "in_reply_to_id" : 625042438,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNTMxMTMxNw==",
      "original_commit_id" : "faa28f6eceb84f861766c1b7f1109f608333402f",
      "original_line" : 884,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 650649499,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T07:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/625311317",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r625311617"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/625311617"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Indeed! Done.",
      "commit_id" : "bdc57fc120affcd255b5b79b505433f5ed4dc843",
      "created_at" : "2021-05-03T19:23:21Z",
      "diff_hunk" : "@@ -279,7 +279,7 @@ friend class CAddrManTest;\n #endif\n \n     //! Select several addresses at once.\n-    void GetAddr_(std::vector<CAddress> &vAddr, size_t max_addresses, size_t max_pct) EXCLUSIVE_LOCKS_REQUIRED(cs);\n+    void GetAddr_(std::vector<CAddress> &vAddr, size_t max_addresses, size_t max_pct, Network net = Network::NET_MAX) EXCLUSIVE_LOCKS_REQUIRED(cs);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r625311617",
      "id" : 625311617,
      "in_reply_to_id" : 625045041,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNTMxMTYxNw==",
      "original_commit_id" : "faa28f6eceb84f861766c1b7f1109f608333402f",
      "original_line" : 282,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 650649885,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T07:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/625311617",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r625311691"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/625311691"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Indeed! Done.",
      "commit_id" : "bdc57fc120affcd255b5b79b505433f5ed4dc843",
      "created_at" : "2021-05-03T19:23:31Z",
      "diff_hunk" : "@@ -279,7 +279,7 @@ friend class CAddrManTest;\n #endif\n \n     //! Select several addresses at once.\n-    void GetAddr_(std::vector<CAddress> &vAddr, size_t max_addresses, size_t max_pct) EXCLUSIVE_LOCKS_REQUIRED(cs);\n+    void GetAddr_(std::vector<CAddress> &vAddr, size_t max_addresses, size_t max_pct, Network net = Network::NET_MAX) EXCLUSIVE_LOCKS_REQUIRED(cs);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r625311691",
      "id" : 625311691,
      "in_reply_to_id" : 625045041,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNTMxMTY5MQ==",
      "original_commit_id" : "faa28f6eceb84f861766c1b7f1109f608333402f",
      "original_line" : 282,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 650649995,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T07:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/625311691",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the early feedback @vasild! Updated and ready for review.",
      "created_at" : "2021-05-03T23:00:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21843#issuecomment-831588071",
      "id" : 831588071,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21843",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgzMTU4ODA3MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-03T23:00:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/831588071",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #21941 (fuzz: Call const member functions in addrman fuzz test only once by MarcoFalke)\n* #21940 (refactor: Mark CAddrMan::Select const by MarcoFalke)\n* #20833 (rpc/validation: enable packages through testmempoolaccept by glozow)\n* #18722 (addrman: improve performance by using more suitable containers by vasild)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-05-04T00:13:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21843#issuecomment-831611812",
      "id" : 831611812,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21843",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgzMTYxMTgxMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-19T16:30:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/831611812",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r625554482"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/625554482"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It just occurred to me that the only (non test) caller of `GetAddr()` is `GetAddresses()` which will always pass 3 arguments. Maybe consider removing the default from here since it is not necessary.\r\n\r\n```suggestion\r\n    std::vector<CAddress> GetAddr(size_t max_addresses, size_t max_pct, std::optional<Network> network)\r\n```",
      "commit_id" : "bdc57fc120affcd255b5b79b505433f5ed4dc843",
      "created_at" : "2021-05-04T07:10:45Z",
      "diff_hunk" : "@@ -715,14 +723,20 @@ friend class CAddrManTest;\n         return addrRet;\n     }\n \n-    //! Return a bunch of addresses, selected at random.\n-    std::vector<CAddress> GetAddr(size_t max_addresses, size_t max_pct)\n+    /**\n+     * Return all or many randomly selected addresses, optionally by network.\n+     *\n+     * @param[in] max_addresses  Maximum number of addresses to return (0 = all).\n+     * @param[in] max_pct        Maximum percentage of addresses to return (0 = all).\n+     * @param[in] network        Select only addresses of this network (nullopt = all).\n+     */\n+    std::vector<CAddress> GetAddr(size_t max_addresses, size_t max_pct, std::optional<Network> network = std::nullopt)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r625554482",
      "id" : 625554482,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNTU1NDQ4Mg==",
      "original_commit_id" : "ac01ec096bc5ff437db5c4797e3d98b7a6efad23",
      "original_line" : 733,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 650939520,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T07:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/625554482",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r625561771"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/625561771"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why remove this test?",
      "commit_id" : "bdc57fc120affcd255b5b79b505433f5ed4dc843",
      "created_at" : "2021-05-04T07:23:36Z",
      "diff_hunk" : "@@ -187,43 +187,54 @@ def test_service_flags(self):\n     def test_getnodeaddresses(self):\n         self.log.info(\"Test getnodeaddresses\")\n         self.nodes[0].add_p2p_connection(P2PInterface())\n+        services = NODE_NETWORK | NODE_WITNESS\n \n-        # Add some addresses to the Address Manager over RPC. Due to the way\n-        # bucket and bucket position are calculated, some of these addresses\n-        # will collide.\n+        # Add an IPv6 address to the address manager.\n+        ipv6_addr = \"1233:3432:2434:2343:3234:2345:6546:4534\"\n+        self.nodes[0].addpeeraddress(address=ipv6_addr, port=8333)\n+\n+        # Add 10,000 IPv4 addresses to the address manager. Due to the way bucket\n+        # and bucket positions are calculated, some of these addresses will collide.\n         imported_addrs = []\n         for i in range(10000):\n             first_octet = i >> 8\n             second_octet = i % 256\n-            a = \"{}.{}.1.1\".format(first_octet, second_octet)  # IPV4\n+            a = f\"{first_octet}.{second_octet}.1.1\"\n             imported_addrs.append(a)\n             self.nodes[0].addpeeraddress(a, 8333)\n \n-        # Obtain addresses via rpc call and check they were ones sent in before.\n-        #\n-        # Maximum possible addresses in addrman is 10000, although actual\n-        # number will usually be less due to bucket and bucket position\n-        # collisions.\n-        node_addresses = self.nodes[0].getnodeaddresses(0)\n+        # Fetch the addresses via the RPC and test the results.\n+        assert_equal(len(self.nodes[0].getnodeaddresses()), 1)  # default count is 1\n+        assert_equal(len(self.nodes[0].getnodeaddresses(count=2)), 2)\n+        assert_equal(len(self.nodes[0].getnodeaddresses(network=\"ipv4\", count=8)), 8)\n+\n+        # Maximum possible addresses in AddrMan is 10000. The actual number will\n+        # usually be less due to bucket and bucket position collisions.\n+        node_addresses = self.nodes[0].getnodeaddresses(0, \"ipv4\")\n         assert_greater_than(len(node_addresses), 5000)\n         assert_greater_than(10000, len(node_addresses))\n         for a in node_addresses:\n             assert_greater_than(a[\"time\"], 1527811200)  # 1st June 2018\n-            assert_equal(a[\"services\"], NODE_NETWORK | NODE_WITNESS)\n+            assert_equal(a[\"services\"], services)\n             assert a[\"address\"] in imported_addrs\n             assert_equal(a[\"port\"], 8333)\n             assert_equal(a[\"network\"], \"ipv4\")\n \n-        node_addresses = self.nodes[0].getnodeaddresses(1)\n-        assert_equal(len(node_addresses), 1)\n+        # Test the IPv6 address.\n+        res = self.nodes[0].getnodeaddresses(0, \"ipv6\")\n+        assert_equal(len(res), 1)\n+        assert_equal(res[0][\"address\"], ipv6_addr)\n+        assert_equal(res[0][\"network\"], \"ipv6\")\n+        assert_equal(res[0][\"port\"], 8333)\n+        assert_equal(res[0][\"services\"], services)\n \n-        assert_raises_rpc_error(-8, \"Address count out of range\", self.nodes[0].getnodeaddresses, -1)\n+        # Test for the absence of onion and I2P addresses.\n+        for network in [\"onion\", \"i2p\"]:\n+            assert_equal(self.nodes[0].getnodeaddresses(0, network), [])\n \n-        # addrman's size cannot be known reliably after insertion, as hash collisions may occur\n-        # so only test that requesting a large number of addresses returns less than that\n-        LARGE_REQUEST_COUNT = 10000\n-        node_addresses = self.nodes[0].getnodeaddresses(LARGE_REQUEST_COUNT)\n-        assert_greater_than(LARGE_REQUEST_COUNT, len(node_addresses))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r625561771",
      "id" : 625561771,
      "line" : 226,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNTU2MTc3MQ==",
      "original_commit_id" : "ac01ec096bc5ff437db5c4797e3d98b7a6efad23",
      "original_line" : 226,
      "original_position" : 67,
      "original_start_line" : 222,
      "path" : "test/functional/rpc_net.py",
      "position" : 67,
      "pull_request_review_id" : 650939520,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843",
      "side" : "LEFT",
      "start_line" : 222,
      "start_side" : "LEFT",
      "updated_at" : "2021-05-06T07:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/625561771",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r625564054"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/625564054"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This move is unrelated to this PR. If this PR does not fly, when the move will not fly either.",
      "commit_id" : "bdc57fc120affcd255b5b79b505433f5ed4dc843",
      "created_at" : "2021-05-04T07:27:37Z",
      "diff_hunk" : "@@ -130,9 +136,6 @@ Changes to Wallet or GUI related settings can be found in the GUI or Wallet sect\n \n - Passing an invalid `-rpcauth` argument now cause bitcoind to fail to start.  (#20461)\n \n-- The `getnodeaddresses` RPC now returns a \"network\" field indicating the\n-  network type (ipv4, ipv6, onion, or i2p) for each address.  (#21594)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r625564054",
      "id" : 625564054,
      "line" : 134,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNTU2NDA1NA==",
      "original_commit_id" : "ac01ec096bc5ff437db5c4797e3d98b7a6efad23",
      "original_line" : 134,
      "original_position" : 18,
      "original_start_line" : 133,
      "path" : "doc/release-notes.md",
      "position" : 18,
      "pull_request_review_id" : 650939520,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843",
      "side" : "LEFT",
      "start_line" : 133,
      "start_side" : "LEFT",
      "updated_at" : "2021-05-06T07:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/625564054",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r625615095"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/625615095"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's redundant with the assertion in line 215 (before this change they were two identical tests as well, by two different authors).",
      "commit_id" : "bdc57fc120affcd255b5b79b505433f5ed4dc843",
      "created_at" : "2021-05-04T08:53:48Z",
      "diff_hunk" : "@@ -187,43 +187,54 @@ def test_service_flags(self):\n     def test_getnodeaddresses(self):\n         self.log.info(\"Test getnodeaddresses\")\n         self.nodes[0].add_p2p_connection(P2PInterface())\n+        services = NODE_NETWORK | NODE_WITNESS\n \n-        # Add some addresses to the Address Manager over RPC. Due to the way\n-        # bucket and bucket position are calculated, some of these addresses\n-        # will collide.\n+        # Add an IPv6 address to the address manager.\n+        ipv6_addr = \"1233:3432:2434:2343:3234:2345:6546:4534\"\n+        self.nodes[0].addpeeraddress(address=ipv6_addr, port=8333)\n+\n+        # Add 10,000 IPv4 addresses to the address manager. Due to the way bucket\n+        # and bucket positions are calculated, some of these addresses will collide.\n         imported_addrs = []\n         for i in range(10000):\n             first_octet = i >> 8\n             second_octet = i % 256\n-            a = \"{}.{}.1.1\".format(first_octet, second_octet)  # IPV4\n+            a = f\"{first_octet}.{second_octet}.1.1\"\n             imported_addrs.append(a)\n             self.nodes[0].addpeeraddress(a, 8333)\n \n-        # Obtain addresses via rpc call and check they were ones sent in before.\n-        #\n-        # Maximum possible addresses in addrman is 10000, although actual\n-        # number will usually be less due to bucket and bucket position\n-        # collisions.\n-        node_addresses = self.nodes[0].getnodeaddresses(0)\n+        # Fetch the addresses via the RPC and test the results.\n+        assert_equal(len(self.nodes[0].getnodeaddresses()), 1)  # default count is 1\n+        assert_equal(len(self.nodes[0].getnodeaddresses(count=2)), 2)\n+        assert_equal(len(self.nodes[0].getnodeaddresses(network=\"ipv4\", count=8)), 8)\n+\n+        # Maximum possible addresses in AddrMan is 10000. The actual number will\n+        # usually be less due to bucket and bucket position collisions.\n+        node_addresses = self.nodes[0].getnodeaddresses(0, \"ipv4\")\n         assert_greater_than(len(node_addresses), 5000)\n         assert_greater_than(10000, len(node_addresses))\n         for a in node_addresses:\n             assert_greater_than(a[\"time\"], 1527811200)  # 1st June 2018\n-            assert_equal(a[\"services\"], NODE_NETWORK | NODE_WITNESS)\n+            assert_equal(a[\"services\"], services)\n             assert a[\"address\"] in imported_addrs\n             assert_equal(a[\"port\"], 8333)\n             assert_equal(a[\"network\"], \"ipv4\")\n \n-        node_addresses = self.nodes[0].getnodeaddresses(1)\n-        assert_equal(len(node_addresses), 1)\n+        # Test the IPv6 address.\n+        res = self.nodes[0].getnodeaddresses(0, \"ipv6\")\n+        assert_equal(len(res), 1)\n+        assert_equal(res[0][\"address\"], ipv6_addr)\n+        assert_equal(res[0][\"network\"], \"ipv6\")\n+        assert_equal(res[0][\"port\"], 8333)\n+        assert_equal(res[0][\"services\"], services)\n \n-        assert_raises_rpc_error(-8, \"Address count out of range\", self.nodes[0].getnodeaddresses, -1)\n+        # Test for the absence of onion and I2P addresses.\n+        for network in [\"onion\", \"i2p\"]:\n+            assert_equal(self.nodes[0].getnodeaddresses(0, network), [])\n \n-        # addrman's size cannot be known reliably after insertion, as hash collisions may occur\n-        # so only test that requesting a large number of addresses returns less than that\n-        LARGE_REQUEST_COUNT = 10000\n-        node_addresses = self.nodes[0].getnodeaddresses(LARGE_REQUEST_COUNT)\n-        assert_greater_than(LARGE_REQUEST_COUNT, len(node_addresses))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r625615095",
      "id" : 625615095,
      "in_reply_to_id" : 625561771,
      "line" : 226,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNTYxNTA5NQ==",
      "original_commit_id" : "ac01ec096bc5ff437db5c4797e3d98b7a6efad23",
      "original_line" : 226,
      "original_position" : 67,
      "original_start_line" : 222,
      "path" : "test/functional/rpc_net.py",
      "position" : 67,
      "pull_request_review_id" : 651017511,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843",
      "side" : "LEFT",
      "start_line" : 222,
      "start_side" : "LEFT",
      "updated_at" : "2021-05-06T07:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/625615095",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r625619180"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/625619180"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think it's ok. If this PR doesn't make the release, I can move the existing note to the right place when the notes are moved to the wiki for editing (I usually make some corrections in the wiki before the notes are moved back to the repo for -final). ",
      "commit_id" : "bdc57fc120affcd255b5b79b505433f5ed4dc843",
      "created_at" : "2021-05-04T09:00:14Z",
      "diff_hunk" : "@@ -130,9 +136,6 @@ Changes to Wallet or GUI related settings can be found in the GUI or Wallet sect\n \n - Passing an invalid `-rpcauth` argument now cause bitcoind to fail to start.  (#20461)\n \n-- The `getnodeaddresses` RPC now returns a \"network\" field indicating the\n-  network type (ipv4, ipv6, onion, or i2p) for each address.  (#21594)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r625619180",
      "id" : 625619180,
      "in_reply_to_id" : 625564054,
      "line" : 134,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNTYxOTE4MA==",
      "original_commit_id" : "ac01ec096bc5ff437db5c4797e3d98b7a6efad23",
      "original_line" : 134,
      "original_position" : 18,
      "original_start_line" : 133,
      "path" : "doc/release-notes.md",
      "position" : 18,
      "pull_request_review_id" : 651022768,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843",
      "side" : "LEFT",
      "start_line" : 133,
      "start_side" : "LEFT",
      "updated_at" : "2021-05-06T07:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/625619180",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r625632446"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/625632446"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good idea, doing (this will add fuzz coverage for change too).",
      "commit_id" : "bdc57fc120affcd255b5b79b505433f5ed4dc843",
      "created_at" : "2021-05-04T09:21:21Z",
      "diff_hunk" : "@@ -715,14 +723,20 @@ friend class CAddrManTest;\n         return addrRet;\n     }\n \n-    //! Return a bunch of addresses, selected at random.\n-    std::vector<CAddress> GetAddr(size_t max_addresses, size_t max_pct)\n+    /**\n+     * Return all or many randomly selected addresses, optionally by network.\n+     *\n+     * @param[in] max_addresses  Maximum number of addresses to return (0 = all).\n+     * @param[in] max_pct        Maximum percentage of addresses to return (0 = all).\n+     * @param[in] network        Select only addresses of this network (nullopt = all).\n+     */\n+    std::vector<CAddress> GetAddr(size_t max_addresses, size_t max_pct, std::optional<Network> network = std::nullopt)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r625632446",
      "id" : 625632446,
      "in_reply_to_id" : 625554482,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNTYzMjQ0Ng==",
      "original_commit_id" : "ac01ec096bc5ff437db5c4797e3d98b7a6efad23",
      "original_line" : 733,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 651039867,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-06T07:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/625632446",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thank you @vasild. Removed the defaults and improved the fuzzing per `git diff ac01ec0 09f2c20`. ",
      "created_at" : "2021-05-04T16:39:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21843#issuecomment-832083003",
      "id" : 832083003,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21843",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgzMjA4MzAwMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-05T11:14:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/832083003",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "CI failure is unrelated (https://github.com/bitcoin/bitcoin/issues/21632).",
      "created_at" : "2021-05-05T15:01:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21843#issuecomment-832760493",
      "id" : 832760493,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21843",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgzMjc2MDQ5Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-05T15:01:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/832760493",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased for CI fix on master.",
      "created_at" : "2021-05-06T07:10:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21843#issuecomment-833286989",
      "id" : 833286989,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21843",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgzMzI4Njk4OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-06T07:10:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/833286989",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "The latest push removed the default value for the `network` argument from `CAddrMan::GetAddr()` and from `CConnMan::GetAddresses()` too. The latter deserves a default value because now there are a lot of call sites like `connman.GetAddresses(..., std::nullopt)`, no?",
      "created_at" : "2021-05-11T12:44:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21843#issuecomment-838409013",
      "id" : 838409013,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21843",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgzODQwOTAxMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-11T12:44:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/838409013",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> GetAddresses(..., std::nullopt)`\r\n\r\nOnly in two places outside of tests, so it seemed better to pass it explicitly.\r\n",
      "created_at" : "2021-05-11T13:13:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21843#issuecomment-838450410",
      "id" : 838450410,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21843",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgzODQ1MDQxMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-11T13:13:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/838450410",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r630874278"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/630874278"
         }
      },
      "author_association" : "MEMBER",
      "body" : "8d4b14e001ec026f346c6b4b00509adae7769415\r\n\r\nI'd use a different approach to not mix different conditions:\r\n\r\n```cpp\r\n// Filter by network (optional)\r\nif (network != std::nullopt && ai.GetNetClass() != network) continue;\r\n\r\n// Filter for quality\r\nif (ai.IsTerrible()) continue;\r\n\r\nvAddr.push_back(ai);\r\n```\r\n\r\nAlso note that it first filters by network, which I think is slightly better.\r\n\r\nI also want to point that `IsTerrible` default argument is computed in each iteration, I'd suggest:\r\n\r\n```cpp\r\n    const int64_t now = GetAdjustedTime();\r\n\r\n    // gather a list of random nodes, skipping those of low quality\r\n    for (unsigned int n = 0; n < vRandom.size(); n++) {\r\n       ...\r\n       if (ai.IsTerrible(now)) continue;\r\n\r\n```\r\n\r\n",
      "commit_id" : "bdc57fc120affcd255b5b79b505433f5ed4dc843",
      "created_at" : "2021-05-12T09:21:32Z",
      "diff_hunk" : "@@ -501,8 +503,10 @@ void CAddrMan::GetAddr_(std::vector<CAddress>& vAddr, size_t max_addresses, size\n         assert(mapInfo.count(vRandom[n]) == 1);\n \n         const CAddrInfo& ai = mapInfo[vRandom[n]];\n-        if (!ai.IsTerrible())\n+        // Filter for quality, and if a network is passed, filter also by network.\n+        if (!ai.IsTerrible() && (network == std::nullopt || ai.GetNetClass() == network)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r630874278",
      "id" : 630874278,
      "line" : 507,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMDg3NDI3OA==",
      "original_commit_id" : "8d4b14e001ec026f346c6b4b00509adae7769415",
      "original_line" : 507,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 27,
      "pull_request_review_id" : 657659486,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-12T09:29:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/630874278",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r630876740"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/630876740"
         }
      },
      "author_association" : "MEMBER",
      "body" : "8942494e8c5eff8a3e268fe830868faf8ce19f9f\r\n\r\nWhy not `network = std::nullopt`? It would avoid changes in call sites.",
      "commit_id" : "bdc57fc120affcd255b5b79b505433f5ed4dc843",
      "created_at" : "2021-05-12T09:25:02Z",
      "diff_hunk" : "@@ -723,14 +723,20 @@ friend class CAddrManTest;\n         return addrRet;\n     }\n \n-    //! Return a bunch of addresses, selected at random.\n-    std::vector<CAddress> GetAddr(size_t max_addresses, size_t max_pct)\n+    /**\n+     * Return all or many randomly selected addresses, optionally by network.\n+     *\n+     * @param[in] max_addresses  Maximum number of addresses to return (0 = all).\n+     * @param[in] max_pct        Maximum percentage of addresses to return (0 = all).\n+     * @param[in] network        Select only addresses of this network (nullopt = all).\n+     */\n+    std::vector<CAddress> GetAddr(size_t max_addresses, size_t max_pct, std::optional<Network> network)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r630876740",
      "id" : 630876740,
      "line" : 733,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMDg3Njc0MA==",
      "original_commit_id" : "8942494e8c5eff8a3e268fe830868faf8ce19f9f",
      "original_line" : 733,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 39,
      "pull_request_review_id" : 657659486,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-12T09:29:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/630876740",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r630884631"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/630884631"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, that is what the PR initially did, as it was a smaller diff and I tend to start with the smaller change. It is now passed explicitly in reponse to review feedback. I agree that explicit is good too.",
      "commit_id" : "bdc57fc120affcd255b5b79b505433f5ed4dc843",
      "created_at" : "2021-05-12T09:36:19Z",
      "diff_hunk" : "@@ -723,14 +723,20 @@ friend class CAddrManTest;\n         return addrRet;\n     }\n \n-    //! Return a bunch of addresses, selected at random.\n-    std::vector<CAddress> GetAddr(size_t max_addresses, size_t max_pct)\n+    /**\n+     * Return all or many randomly selected addresses, optionally by network.\n+     *\n+     * @param[in] max_addresses  Maximum number of addresses to return (0 = all).\n+     * @param[in] max_pct        Maximum percentage of addresses to return (0 = all).\n+     * @param[in] network        Select only addresses of this network (nullopt = all).\n+     */\n+    std::vector<CAddress> GetAddr(size_t max_addresses, size_t max_pct, std::optional<Network> network)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r630884631",
      "id" : 630884631,
      "in_reply_to_id" : 630876740,
      "line" : 733,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMDg4NDYzMQ==",
      "original_commit_id" : "8942494e8c5eff8a3e268fe830868faf8ce19f9f",
      "original_line" : 733,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 39,
      "pull_request_review_id" : 657673586,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-12T09:36:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/630884631",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r630889511"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/630889511"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You can dismiss my comment, just checked @vasild comment https://github.com/bitcoin/bitcoin/pull/21843#discussion_r625554482.",
      "commit_id" : "bdc57fc120affcd255b5b79b505433f5ed4dc843",
      "created_at" : "2021-05-12T09:43:33Z",
      "diff_hunk" : "@@ -723,14 +723,20 @@ friend class CAddrManTest;\n         return addrRet;\n     }\n \n-    //! Return a bunch of addresses, selected at random.\n-    std::vector<CAddress> GetAddr(size_t max_addresses, size_t max_pct)\n+    /**\n+     * Return all or many randomly selected addresses, optionally by network.\n+     *\n+     * @param[in] max_addresses  Maximum number of addresses to return (0 = all).\n+     * @param[in] max_pct        Maximum percentage of addresses to return (0 = all).\n+     * @param[in] network        Select only addresses of this network (nullopt = all).\n+     */\n+    std::vector<CAddress> GetAddr(size_t max_addresses, size_t max_pct, std::optional<Network> network)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r630889511",
      "id" : 630889511,
      "in_reply_to_id" : 630876740,
      "line" : 733,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMDg4OTUxMQ==",
      "original_commit_id" : "8942494e8c5eff8a3e268fe830868faf8ce19f9f",
      "original_line" : 733,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 39,
      "pull_request_review_id" : 657680221,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-12T09:43:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/630889511",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r631145323"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631145323"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks @promag, done and added a commit by you for the gettime optimization.",
      "commit_id" : "9d17f30c7e281d0f424eb45129beb6a6e62e37b9",
      "created_at" : "2021-05-12T15:25:49Z",
      "diff_hunk" : "@@ -501,8 +503,10 @@ void CAddrMan::GetAddr_(std::vector<CAddress>& vAddr, size_t max_addresses, size\n         assert(mapInfo.count(vRandom[n]) == 1);\n \n         const CAddrInfo& ai = mapInfo[vRandom[n]];\n-        if (!ai.IsTerrible())\n+        // Filter for quality, and if a network is passed, filter also by network.\n+        if (!ai.IsTerrible() && (network == std::nullopt || ai.GetNetClass() == network)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r631145323",
      "id" : 631145323,
      "in_reply_to_id" : 630874278,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMTE0NTMyMw==",
      "original_commit_id" : "8d4b14e001ec026f346c6b4b00509adae7769415",
      "original_line" : 507,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 658029556,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-12T15:25:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631145323",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks @vasild, agreed. Making them explicit was more work, but I reckon sooner or later someone is going to make them explicit so may as well do it now.",
      "created_at" : "2021-05-12T15:29:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21843#issuecomment-839866656",
      "id" : 839866656,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21843",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgzOTg2NjY1Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-12T15:29:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/839866656",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Only change is @promag's suggestion: ` git diff bdc57fc 9d17f30`\r\n```diff\r\ndiff --git a/src/addrman.cpp b/src/addrman.cpp\r\nindex 473ac21ad0..ceab1689d7 100644\r\n--- a/src/addrman.cpp\r\n+++ b/src/addrman.cpp\r\n@@ -494,6 +494,7 @@ void CAddrMan::GetAddr_(std::vector<CAddress>& vAddr, size_t max_addresses, size\r\n+    const int64_t now{GetAdjustedTime()};\r\n     for (unsigned int n = 0; n < vRandom.size(); n++) {\r\n         if (vAddr.size() >= nNodes)\r\n             break;\r\n@@ -503,10 +504,14 @@ void CAddrMan::GetAddr_(std::vector<CAddress>& vAddr, size_t max_addresses, size\r\n         assert(mapInfo.count(vRandom[n]) == 1);\r\n \r\n         const CAddrInfo& ai = mapInfo[vRandom[n]];\r\n-        // Filter for quality, and if a network is passed, filter also by network.\r\n-        if (!ai.IsTerrible() && (network == std::nullopt || ai.GetNetClass() == network)) {\r\n-            vAddr.push_back(ai);\r\n-        }\r\n+\r\n+        // Filter by network (optional)\r\n+        if (network != std::nullopt && ai.GetNetClass() != network) continue;\r\n+\r\n+        // Filter for quality\r\n+        if (ai.IsTerrible(now)) continue;\r\n+\r\n+        vAddr.push_back(ai);\r\n     }\r\n }\r\n```\r\n",
      "created_at" : "2021-05-12T15:32:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21843#issuecomment-839869158",
      "id" : 839869158,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21843",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgzOTg2OTE1OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-12T15:32:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/839869158",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-05-19T10:58:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21843#issuecomment-843990440",
      "id" : 843990440,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21843",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg0Mzk5MDQ0MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-19T10:58:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/843990440",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "rebased after merge of #21506, no other change\r\n\r\n`git range-diff 4da26fb 9d17f30 ce6bca8`\r\n```diff\r\n     @@ src/net_processing.cpp: void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\r\n              pfrom.vAddrToSend.clear();\r\n              std::vector<CAddress> vAddr;\r\n-         if (pfrom.HasPermission(PF_ADDR)) {\r\n+         if (pfrom.HasPermission(NetPermissionFlags::Addr)) {\r\n              vAddr = m_connman.GetAddresses(MAX_ADDR_TO_SEND, MAX_PCT_ADDR_TO_SEND, /* network */ std::nullopt);\r\n```\r\n",
      "created_at" : "2021-05-19T11:10:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21843#issuecomment-843998813",
      "id" : 843998813,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21843",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg0Mzk5ODgxMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-19T11:12:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/843998813",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review and lightly tested ACK ce6bca88e8c685c69686e0b8dc095ffc3e2ac34d",
      "created_at" : "2021-05-20T18:47:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21843#issuecomment-845382366",
      "id" : 845382366,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21843",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg0NTM4MjM2Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-20T18:47:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/845382366",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "post-merge ACK ð",
      "created_at" : "2021-05-20T18:55:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21843#issuecomment-845388483",
      "id" : 845388483,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21843",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg0NTM4ODQ4Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-20T18:55:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/845388483",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23396902?v=4",
         "events_url" : "https://api.github.com/users/jarolrod/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jarolrod/followers",
         "following_url" : "https://api.github.com/users/jarolrod/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jarolrod/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jarolrod",
         "id" : 23396902,
         "login" : "jarolrod",
         "node_id" : "MDQ6VXNlcjIzMzk2OTAy",
         "organizations_url" : "https://api.github.com/users/jarolrod/orgs",
         "received_events_url" : "https://api.github.com/users/jarolrod/received_events",
         "repos_url" : "https://api.github.com/users/jarolrod/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jarolrod/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jarolrod/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jarolrod"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r636431728"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/636431728"
         }
      },
      "author_association" : "MEMBER",
      "body" : "~~Won't this result in infnite loops, if there are not enough of the requested net class? I think doing this correctly requires keeping track of the counts per network.~~\r\n\r\nEDIT: nevermind, it's bounded by the size of vRandom as pointed out below.\r\n\r\n",
      "commit_id" : "ce6bca88e8c685c69686e0b8dc095ffc3e2ac34d",
      "created_at" : "2021-05-20T19:59:44Z",
      "diff_hunk" : "@@ -501,8 +504,14 @@ void CAddrMan::GetAddr_(std::vector<CAddress>& vAddr, size_t max_addresses, size\n         assert(mapInfo.count(vRandom[n]) == 1);\n \n         const CAddrInfo& ai = mapInfo[vRandom[n]];\n-        if (!ai.IsTerrible())\n-            vAddr.push_back(ai);\n+\n+        // Filter by network (optional)\n+        if (network != std::nullopt && ai.GetNetClass() != network) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r636431728",
      "id" : 636431728,
      "line" : 509,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNjQzMTcyOA==",
      "original_commit_id" : "ce6bca88e8c685c69686e0b8dc095ffc3e2ac34d",
      "original_line" : 509,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 37,
      "pull_request_review_id" : 664845868,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-20T20:17:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/636431728",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r636439771"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/636439771"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If the early exit isn't triggered (e.g. `getnodeaddresses 10000 i2p`) the loop terminates after it has iterated through vRandom.",
      "commit_id" : "ce6bca88e8c685c69686e0b8dc095ffc3e2ac34d",
      "created_at" : "2021-05-20T20:13:41Z",
      "diff_hunk" : "@@ -501,8 +504,14 @@ void CAddrMan::GetAddr_(std::vector<CAddress>& vAddr, size_t max_addresses, size\n         assert(mapInfo.count(vRandom[n]) == 1);\n \n         const CAddrInfo& ai = mapInfo[vRandom[n]];\n-        if (!ai.IsTerrible())\n-            vAddr.push_back(ai);\n+\n+        // Filter by network (optional)\n+        if (network != std::nullopt && ai.GetNetClass() != network) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r636439771",
      "id" : 636439771,
      "in_reply_to_id" : 636431728,
      "line" : 509,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNjQzOTc3MQ==",
      "original_commit_id" : "ce6bca88e8c685c69686e0b8dc095ffc3e2ac34d",
      "original_line" : 509,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 37,
      "pull_request_review_id" : 664856745,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-20T20:13:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/636439771",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r636723391"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/636723391"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Today's computers are so fast that even the infinite loop finishes in about 6 seconds.",
      "commit_id" : "ce6bca88e8c685c69686e0b8dc095ffc3e2ac34d",
      "created_at" : "2021-05-21T08:09:38Z",
      "diff_hunk" : "@@ -501,8 +504,14 @@ void CAddrMan::GetAddr_(std::vector<CAddress>& vAddr, size_t max_addresses, size\n         assert(mapInfo.count(vRandom[n]) == 1);\n \n         const CAddrInfo& ai = mapInfo[vRandom[n]];\n-        if (!ai.IsTerrible())\n-            vAddr.push_back(ai);\n+\n+        // Filter by network (optional)\n+        if (network != std::nullopt && ai.GetNetClass() != network) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r636723391",
      "id" : 636723391,
      "in_reply_to_id" : 636431728,
      "line" : 509,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNjcyMzM5MQ==",
      "original_commit_id" : "ce6bca88e8c685c69686e0b8dc095ffc3e2ac34d",
      "original_line" : 509,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 37,
      "pull_request_review_id" : 665200706,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-21T08:09:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/636723391",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r636726197"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/636726197"
         }
      },
      "author_association" : "MEMBER",
      "body" : "(I think the added functional tests here cover it.)",
      "commit_id" : "ce6bca88e8c685c69686e0b8dc095ffc3e2ac34d",
      "created_at" : "2021-05-21T08:14:15Z",
      "diff_hunk" : "@@ -501,8 +504,14 @@ void CAddrMan::GetAddr_(std::vector<CAddress>& vAddr, size_t max_addresses, size\n         assert(mapInfo.count(vRandom[n]) == 1);\n \n         const CAddrInfo& ai = mapInfo[vRandom[n]];\n-        if (!ai.IsTerrible())\n-            vAddr.push_back(ai);\n+\n+        // Filter by network (optional)\n+        if (network != std::nullopt && ai.GetNetClass() != network) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21843#discussion_r636726197",
      "id" : 636726197,
      "in_reply_to_id" : 636431728,
      "line" : 509,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNjcyNjE5Nw==",
      "original_commit_id" : "ce6bca88e8c685c69686e0b8dc095ffc3e2ac34d",
      "original_line" : 509,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 37,
      "pull_request_review_id" : 665204565,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21843",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-21T08:14:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/636726197",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   }
]
