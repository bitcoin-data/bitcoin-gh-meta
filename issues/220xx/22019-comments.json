[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#23534](https://github.com/bitcoin/bitcoin/pull/23534) (wallet: Allow negtive effective value inputs when subtracting fee from outputs by achow101)\n* [#23497](https://github.com/bitcoin/bitcoin/pull/23497) (Add `src/node/` and `src/wallet/` code to `node::` and `wallet::` namespaces by ryanofsky)\n* [#23475](https://github.com/bitcoin/bitcoin/pull/23475) (wallet: add config to prioritize a solution that doesn't create change in coin selection by brunoerg)\n* [#23367](https://github.com/bitcoin/bitcoin/pull/23367) (Optimize coin selection by dropping BnB upper limit by S3RK)\n* [#23202](https://github.com/bitcoin/bitcoin/pull/23202) (wallet: allow psbtbumpfee to work with txs with external inputs by achow101)\n* [#23201](https://github.com/bitcoin/bitcoin/pull/23201) (wallet: Allow users to specify input weights when funding a transaction by achow101)\n* [#13226](https://github.com/bitcoin/bitcoin/pull/13226) (Optimize SelectCoinsBnB by tracking the selection by index rather than by position by Empact)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-05-22T03:49:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#issuecomment-846344191",
      "id" : 846344191,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22019",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg0NjM0NDE5MQ==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/846344191/reactions"
      },
      "updated_at" : "2021-12-09T14:37:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/846344191",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-09-03T09:27:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#issuecomment-912397463",
      "id" : 912397463,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22019",
      "node_id" : "IC_kwDOABII5842YhSX",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-03T09:27:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/912397463",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702143396"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702143396"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Commit 80402a13e52671aa7359e3b87d85098805926a63: This may be more a comment on the commit message, but shouldn't the result of BnB be deterministic? Are the OutputGroups unsorted, or how is this happening?",
      "commit_id" : "2df49b3314a6b0b10eb4016bd11743db6db0c428",
      "created_at" : "2021-09-03T20:22:38Z",
      "diff_hunk" : "@@ -178,15 +197,15 @@ BOOST_AUTO_TEST_CASE(bnb_search_test)\n     // Select 1 Cent\n     add_coin(1 * CENT, 1, actual_selection);\n     BOOST_CHECK(SelectCoinsBnB(GroupCoins(utxo_pool), 1 * CENT, 0.5 * CENT, selection, value_ret));\n-    BOOST_CHECK(equal_sets(selection, actual_selection));\n+    BOOST_CHECK(equivalent_sets(selection, actual_selection));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702143396",
      "id" : 702143396,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMjE0MzM5Ng==",
      "original_commit_id" : "bf455047a0cc4ed9d968b92884f1f77f8e60eada",
      "original_line" : 200,
      "original_position" : 61,
      "original_start_line" : null,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 746445559,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-03T21:43:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702143396",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702158462"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702158462"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n    /** Whether the input values for calculations should be the effective value (true) or normal value (false) */\r\n```",
      "commit_id" : "2df49b3314a6b0b10eb4016bd11743db6db0c428",
      "created_at" : "2021-09-03T21:00:23Z",
      "diff_hunk" : "@@ -193,6 +193,17 @@ struct SelectionResult\n      *  hit a specific target.\n      */\n     CAmount input_fees{0};\n+    /** Whether the input values for calculations should be the the effective value (true) or normal value (false) */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702158462",
      "id" : 702158462,
      "line" : 198,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMjE1ODQ2Mg==",
      "original_commit_id" : "187a9d92854e99104e17b551bb39a4072a5d09fe",
      "original_line" : 198,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.h",
      "position" : 26,
      "pull_request_review_id" : 746445559,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-03T21:43:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702158462",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702160046"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702160046"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "What do you mean with \"independent of the selection\"? Do you mean that it's the same across different algorithms, independent of the inputs that get picked, or smth else? It's definitely dependent on the selection parameters, especially the feerate.",
      "commit_id" : "2df49b3314a6b0b10eb4016bd11743db6db0c428",
      "created_at" : "2021-09-03T21:05:04Z",
      "diff_hunk" : "@@ -193,6 +193,17 @@ struct SelectionResult\n      *  hit a specific target.\n      */\n     CAmount input_fees{0};\n+    /** Whether the input values for calculations should be the the effective value (true) or normal value (false) */\n+    bool m_use_effective{true};\n+    /** The algorithm used supports making change outputs. */\n+    bool m_make_change{false};\n+    /** The cost of making a change output and spending it in the future. Since this is largely a static parameter independent of the selection, it is not cleared by Clear() */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702160046",
      "id" : 702160046,
      "line" : 202,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMjE2MDA0Ng==",
      "original_commit_id" : "187a9d92854e99104e17b551bb39a4072a5d09fe",
      "original_line" : 202,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.h",
      "position" : 30,
      "pull_request_review_id" : 746445559,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-03T21:43:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702160046",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702160682"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702160682"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Could 75672596d018f857013599b94f65efaf6446a825 perhaps be a scripted diff?",
      "commit_id" : "2df49b3314a6b0b10eb4016bd11743db6db0c428",
      "created_at" : "2021-09-03T21:06:59Z",
      "diff_hunk" : "@@ -177,7 +177,7 @@ BOOST_AUTO_TEST_CASE(bnb_search_test)\n     // Setup\n     std::vector<CInputCoin> utxo_pool;\n     CoinSet selection;\n-    CoinSet actual_selection;\n+    SelectionResult expected_result;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702160682",
      "id" : 702160682,
      "line" : 157,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMjE2MDY4Mg==",
      "original_commit_id" : "405e7801105bce4396732017d5910d7b223388c7",
      "original_line" : 157,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : 52,
      "pull_request_review_id" : 746445559,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-03T21:43:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702160682",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702168017"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702168017"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This looks perhaps like an accidental edit\r\n```suggestion\r\nbool AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,\r\n```",
      "commit_id" : "2df49b3314a6b0b10eb4016bd11743db6db0c428",
      "created_at" : "2021-09-03T21:28:39Z",
      "diff_hunk" : "@@ -357,17 +357,15 @@ std::vector<OutputGroup> GroupOutputs(const CWallet& wallet, const std::vector<C\n     return groups_out;\n }\n \n-bool AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,\n-                                 std::set<CInputCoin>& setCoinsRet, CAmount& nValueRet, const CoinSelectionParams& coin_selection_params)\n+bool AttemptSelection(const CWallet& walletconst CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702168017",
      "id" : 702168017,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMjE2ODAxNw==",
      "original_commit_id" : "b6ef0e496a5d91d4cbd8d6e7ff9dbb6935b9a172",
      "original_line" : 360,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 746445559,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-03T21:43:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702168017",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702169072"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702169072"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "\"as don't matter\" seems to be missing a word",
      "commit_id" : "2df49b3314a6b0b10eb4016bd11743db6db0c428",
      "created_at" : "2021-09-03T21:31:48Z",
      "diff_hunk" : "@@ -394,29 +394,32 @@ bool AttemptSelection(const CWallet& walletconst CAmount& nTargetValue, const Co\n     return true;\n }\n \n-bool SelectCoins(const CWallet& wallet, const std::vector<COutput>& vAvailableCoins, const CAmount& nTargetValue, std::set<CInputCoin>& setCoinsRet, CAmount& nValueRet, const CCoinControl& coin_control, CoinSelectionParams& coin_selection_params)\n+bool SelectCoins(const CWallet& wallet, const std::vector<COutput>& vAvailableCoins, const CAmount& nTargetValue, const CCoinControl& coin_control, CoinSelectionParams& coin_selection_params, SelectionResult& result)\n {\n-    SelectionResult result;\n+    result.Clear();\n+\n     std::vector<COutput> vCoins(vAvailableCoins);\n     CAmount value_to_select = nTargetValue;\n \n+    OutputGroup preset_inputs(coin_selection_params);\n+\n     // coin control -> return all selected outputs (we want all selected to go into the transaction for sure)\n     if (coin_control.HasSelected() && !coin_control.fAllowOtherInputs)\n     {\n-        for (const COutput& out : vCoins)\n-        {\n-            if (!out.fSpendable)\n-                 continue;\n-            nValueRet += out.tx->tx->vout[out.i].nValue;\n-            setCoinsRet.insert(out.GetInputCoin());\n+        for (const COutput& out : vCoins) {\n+            if (!out.fSpendable) continue;\n+            /* Set depth, from_me, ancestors, and descendants to 0 or false as don't matter for preset inputs as no actual selection is being done.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702169072",
      "id" : 702169072,
      "line" : 411,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMjE2OTA3Mg==",
      "original_commit_id" : "10492b60ad8f439b29a200b9fa3acce7cdce8f6d",
      "original_line" : 411,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 80,
      "pull_request_review_id" : 746445559,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-03T21:43:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702169072",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702180754"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702180754"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't remember the specifics, but I think it had to with different txids being in `utxo_pool` and `actual_selection`",
      "commit_id" : "2df49b3314a6b0b10eb4016bd11743db6db0c428",
      "created_at" : "2021-09-03T22:12:32Z",
      "diff_hunk" : "@@ -178,15 +197,15 @@ BOOST_AUTO_TEST_CASE(bnb_search_test)\n     // Select 1 Cent\n     add_coin(1 * CENT, 1, actual_selection);\n     BOOST_CHECK(SelectCoinsBnB(GroupCoins(utxo_pool), 1 * CENT, 0.5 * CENT, selection, value_ret));\n-    BOOST_CHECK(equal_sets(selection, actual_selection));\n+    BOOST_CHECK(equivalent_sets(selection, actual_selection));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702180754",
      "id" : 702180754,
      "in_reply_to_id" : 702143396,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMjE4MDc1NA==",
      "original_commit_id" : "bf455047a0cc4ed9d968b92884f1f77f8e60eada",
      "original_line" : 200,
      "original_position" : 61,
      "original_start_line" : null,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 746492501,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-03T22:12:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702180754",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702181824"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702181824"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Independent of the algorithm.",
      "commit_id" : "2df49b3314a6b0b10eb4016bd11743db6db0c428",
      "created_at" : "2021-09-03T22:16:36Z",
      "diff_hunk" : "@@ -193,6 +193,17 @@ struct SelectionResult\n      *  hit a specific target.\n      */\n     CAmount input_fees{0};\n+    /** Whether the input values for calculations should be the the effective value (true) or normal value (false) */\n+    bool m_use_effective{true};\n+    /** The algorithm used supports making change outputs. */\n+    bool m_make_change{false};\n+    /** The cost of making a change output and spending it in the future. Since this is largely a static parameter independent of the selection, it is not cleared by Clear() */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702181824",
      "id" : 702181824,
      "in_reply_to_id" : 702160046,
      "line" : 202,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMjE4MTgyNA==",
      "original_commit_id" : "187a9d92854e99104e17b551bb39a4072a5d09fe",
      "original_line" : 202,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.h",
      "position" : 30,
      "pull_request_review_id" : 746493751,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-03T22:16:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702181824",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702208825"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702208825"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed",
      "commit_id" : "a066567bd405d403def2da16a9fabbc7ebf93a3f",
      "created_at" : "2021-09-04T00:34:33Z",
      "diff_hunk" : "@@ -193,6 +193,17 @@ struct SelectionResult\n      *  hit a specific target.\n      */\n     CAmount input_fees{0};\n+    /** Whether the input values for calculations should be the the effective value (true) or normal value (false) */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702208825",
      "id" : 702208825,
      "in_reply_to_id" : 702158462,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMjIwODgyNQ==",
      "original_commit_id" : "187a9d92854e99104e17b551bb39a4072a5d09fe",
      "original_line" : 198,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.h",
      "position" : null,
      "pull_request_review_id" : 746523146,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-04T00:34:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702208825",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702208834"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702208834"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Clarified the comment.",
      "commit_id" : "a066567bd405d403def2da16a9fabbc7ebf93a3f",
      "created_at" : "2021-09-04T00:34:40Z",
      "diff_hunk" : "@@ -193,6 +193,17 @@ struct SelectionResult\n      *  hit a specific target.\n      */\n     CAmount input_fees{0};\n+    /** Whether the input values for calculations should be the the effective value (true) or normal value (false) */\n+    bool m_use_effective{true};\n+    /** The algorithm used supports making change outputs. */\n+    bool m_make_change{false};\n+    /** The cost of making a change output and spending it in the future. Since this is largely a static parameter independent of the selection, it is not cleared by Clear() */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702208834",
      "id" : 702208834,
      "in_reply_to_id" : 702160046,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMjIwODgzNA==",
      "original_commit_id" : "187a9d92854e99104e17b551bb39a4072a5d09fe",
      "original_line" : 202,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.h",
      "position" : null,
      "pull_request_review_id" : 746523157,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-04T00:34:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702208834",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702208838"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702208838"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "a066567bd405d403def2da16a9fabbc7ebf93a3f",
      "created_at" : "2021-09-04T00:34:44Z",
      "diff_hunk" : "@@ -177,7 +177,7 @@ BOOST_AUTO_TEST_CASE(bnb_search_test)\n     // Setup\n     std::vector<CInputCoin> utxo_pool;\n     CoinSet selection;\n-    CoinSet actual_selection;\n+    SelectionResult expected_result;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702208838",
      "id" : 702208838,
      "in_reply_to_id" : 702160682,
      "line" : 157,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMjIwODgzOA==",
      "original_commit_id" : "405e7801105bce4396732017d5910d7b223388c7",
      "original_line" : 157,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : 52,
      "pull_request_review_id" : 746523164,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-04T00:34:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702208838",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702208846"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702208846"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed",
      "commit_id" : "a066567bd405d403def2da16a9fabbc7ebf93a3f",
      "created_at" : "2021-09-04T00:34:51Z",
      "diff_hunk" : "@@ -357,17 +357,15 @@ std::vector<OutputGroup> GroupOutputs(const CWallet& wallet, const std::vector<C\n     return groups_out;\n }\n \n-bool AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,\n-                                 std::set<CInputCoin>& setCoinsRet, CAmount& nValueRet, const CoinSelectionParams& coin_selection_params)\n+bool AttemptSelection(const CWallet& walletconst CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702208846",
      "id" : 702208846,
      "in_reply_to_id" : 702168017,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMjIwODg0Ng==",
      "original_commit_id" : "b6ef0e496a5d91d4cbd8d6e7ff9dbb6935b9a172",
      "original_line" : 360,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 746523172,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-04T00:34:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702208846",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702208852"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702208852"
         }
      },
      "author_association" : "MEMBER",
      "body" : "fixed",
      "commit_id" : "a066567bd405d403def2da16a9fabbc7ebf93a3f",
      "created_at" : "2021-09-04T00:34:56Z",
      "diff_hunk" : "@@ -394,29 +394,32 @@ bool AttemptSelection(const CWallet& walletconst CAmount& nTargetValue, const Co\n     return true;\n }\n \n-bool SelectCoins(const CWallet& wallet, const std::vector<COutput>& vAvailableCoins, const CAmount& nTargetValue, std::set<CInputCoin>& setCoinsRet, CAmount& nValueRet, const CCoinControl& coin_control, CoinSelectionParams& coin_selection_params)\n+bool SelectCoins(const CWallet& wallet, const std::vector<COutput>& vAvailableCoins, const CAmount& nTargetValue, const CCoinControl& coin_control, CoinSelectionParams& coin_selection_params, SelectionResult& result)\n {\n-    SelectionResult result;\n+    result.Clear();\n+\n     std::vector<COutput> vCoins(vAvailableCoins);\n     CAmount value_to_select = nTargetValue;\n \n+    OutputGroup preset_inputs(coin_selection_params);\n+\n     // coin control -> return all selected outputs (we want all selected to go into the transaction for sure)\n     if (coin_control.HasSelected() && !coin_control.fAllowOtherInputs)\n     {\n-        for (const COutput& out : vCoins)\n-        {\n-            if (!out.fSpendable)\n-                 continue;\n-            nValueRet += out.tx->tx->vout[out.i].nValue;\n-            setCoinsRet.insert(out.GetInputCoin());\n+        for (const COutput& out : vCoins) {\n+            if (!out.fSpendable) continue;\n+            /* Set depth, from_me, ancestors, and descendants to 0 or false as don't matter for preset inputs as no actual selection is being done.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702208852",
      "id" : 702208852,
      "in_reply_to_id" : 702169072,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMjIwODg1Mg==",
      "original_commit_id" : "10492b60ad8f439b29a200b9fa3acce7cdce8f6d",
      "original_line" : 411,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 746523179,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-04T00:34:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702208852",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2021-09-08T14:38:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#issuecomment-915297129",
      "id" : 915297129,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22019",
      "node_id" : "IC_kwDOABII5842jlNp",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-08T14:38:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/915297129",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-09-09T04:40:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#issuecomment-915757240",
      "id" : 915757240,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22019",
      "node_id" : "IC_kwDOABII5842lVi4",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-09T04:40:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/915757240",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased. I've also made some additional changes. Notably, instead of using `SelectionResult` as an out parameter, all of the coin selection functions will return an `std::optional<SelectionResult>` instead.",
      "created_at" : "2021-09-28T23:18:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#issuecomment-929692924",
      "id" : 929692924,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22019",
      "node_id" : "IC_kwDOABII5843afz8",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-28T23:18:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/929692924",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-10-04T09:50:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#issuecomment-933323710",
      "id" : 933323710,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22019",
      "node_id" : "IC_kwDOABII5843oWO-",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/933323710/reactions"
      },
      "updated_at" : "2021-10-04T09:50:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/933323710",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK, going to review the code",
      "created_at" : "2021-10-07T07:53:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#issuecomment-937544686",
      "id" : 937544686,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22019",
      "node_id" : "IC_kwDOABII58434cvu",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/937544686/reactions"
      },
      "updated_at" : "2021-10-07T07:53:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/937544686",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-10-08T02:00:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#issuecomment-938278242",
      "id" : 938278242,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22019",
      "node_id" : "IC_kwDOABII58437P1i",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/938278242/reactions"
      },
      "updated_at" : "2021-10-08T02:00:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/938278242",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK.\r\n\r\nWas troubled by the largely unused `cost_of_change` attr, and looked to narrow its scope. I think I've come up with some useful additions here: https://github.com/achow101/bitcoin/compare/selectionresult...Empact:selectionresult\r\n\r\n* test: Drop unused knapsack_result var\r\n* refactor: Move cost_of_change param from SelectionResult to #GetWaste\r\n* refactor: Calculate waste once for each result, rather than once for comparison\r\n* refactor: Move SelectionResult#Equivalent/EqualResult to test",
      "created_at" : "2021-10-13T12:12:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#issuecomment-942238913",
      "id" : 942238913,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22019",
      "node_id" : "IC_kwDOABII5844KWzB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/942238913/reactions"
      },
      "updated_at" : "2021-10-13T12:36:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/942238913",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r727997015"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/727997015"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is apparently unused. https://github.com/Empact/bitcoin/commit/4719cc5aacf7531724d24a81b5b8935d2605f13f",
      "commit_id" : "c5da3dfe9367713d01569df18c65b563eca25087",
      "created_at" : "2021-10-13T12:14:04Z",
      "diff_hunk" : "@@ -602,8 +622,7 @@ BOOST_AUTO_TEST_CASE(knapsack_solver_test)\n \n BOOST_AUTO_TEST_CASE(ApproximateBestSubset)\n {\n-    CoinSet setCoinsRet;\n-    CAmount nValueRet;\n+    SelectionResult knapsack_result(CAmount(0), true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r727997015",
      "id" : 727997015,
      "line" : 625,
      "node_id" : "PRRC_kwDOABII584rZFpX",
      "original_commit_id" : "c5da3dfe9367713d01569df18c65b563eca25087",
      "original_line" : 625,
      "original_position" : 615,
      "original_start_line" : null,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : 615,
      "pull_request_review_id" : 778485819,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/727997015/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-13T12:14:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/727997015",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've pulled in all of the suggested changes.",
      "created_at" : "2021-10-13T17:29:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#issuecomment-942552328",
      "id" : 942552328,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22019",
      "node_id" : "IC_kwDOABII5844LjUI",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/942552328/reactions"
      },
      "updated_at" : "2021-10-13T17:29:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/942552328",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-10-22T13:35:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#issuecomment-949638794",
      "id" : 949638794,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22019",
      "node_id" : "IC_kwDOABII5844mlaK",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/949638794/reactions"
      },
      "updated_at" : "2021-10-22T13:35:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/949638794",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r740817760"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740817760"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n        if (result.GetSelectedValue() < nTargetValue) return std::nullopt;\r\n```",
      "commit_id" : "1036ab72f8db0f85c7a294d01c25d00ec8f0b421",
      "created_at" : "2021-11-02T08:34:09Z",
      "diff_hunk" : "@@ -373,76 +373,72 @@ std::vector<OutputGroup> GroupOutputs(const CWallet& wallet, const std::vector<C\n     return groups_out;\n }\n \n-bool AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,\n-                                 std::set<CInputCoin>& setCoinsRet, CAmount& nValueRet, const CoinSelectionParams& coin_selection_params)\n+std::optional<SelectionResult> AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,\n+                               const CoinSelectionParams& coin_selection_params)\n {\n-    setCoinsRet.clear();\n-    nValueRet = 0;\n-    // Vector of results for use with waste calculation\n-    // In order: calculated waste, selected inputs, selected input value (sum of input values)\n-    // TODO: Use a struct representing the selection result\n-    std::vector<std::tuple<CAmount, std::set<CInputCoin>, CAmount>> results;\n+    // Vector of result and waste pairs. We will choose the best one based on waste.\n+    std::vector<std::pair<SelectionResult, CAmount>> results;\n \n     // Note that unlike KnapsackSolver, we do not include the fee for creating a change output as BnB will not create a change output.\n     std::vector<OutputGroup> positive_groups = GroupOutputs(wallet, coins, coin_selection_params, eligibility_filter, true /* positive_only */);\n-    std::set<CInputCoin> bnb_coins;\n-    CAmount bnb_value;\n-    if (SelectCoinsBnB(positive_groups, nTargetValue, coin_selection_params.m_cost_of_change, bnb_coins, bnb_value)) {\n-        const auto waste = GetSelectionWaste(bnb_coins, /* cost of change */ CAmount(0), nTargetValue, !coin_selection_params.m_subtract_fee_outputs);\n-        results.emplace_back(std::make_tuple(waste, std::move(bnb_coins), bnb_value));\n+    std::optional<SelectionResult> bnb_result = SelectCoinsBnB(positive_groups, nTargetValue, coin_selection_params.m_cost_of_change);\n+    if (bnb_result) {\n+        results.push_back(std::make_pair(*bnb_result, bnb_result->GetWaste(CAmount(0))));\n     }\n \n     // The knapsack solver has some legacy behavior where it will spend dust outputs. We retain this behavior, so don't filter for positive only here.\n     std::vector<OutputGroup> all_groups = GroupOutputs(wallet, coins, coin_selection_params, eligibility_filter, false /* positive_only */);\n     // While nTargetValue includes the transaction fees for non-input things, it does not include the fee for creating a change output.\n     // So we need to include that for KnapsackSolver as well, as we are expecting to create a change output.\n-    std::set<CInputCoin> knapsack_coins;\n-    CAmount knapsack_value;\n-    if (KnapsackSolver(nTargetValue + coin_selection_params.m_change_fee, all_groups, knapsack_coins, knapsack_value)) {\n-        const auto waste = GetSelectionWaste(knapsack_coins, coin_selection_params.m_cost_of_change, nTargetValue + coin_selection_params.m_change_fee, !coin_selection_params.m_subtract_fee_outputs);\n-        results.emplace_back(std::make_tuple(waste, std::move(knapsack_coins), knapsack_value));\n+    std::optional<SelectionResult> knapsack_result = KnapsackSolver(all_groups, nTargetValue + coin_selection_params.m_change_fee);\n+    if (knapsack_result) {\n+        results.push_back(std::make_pair(*knapsack_result, knapsack_result->GetWaste(coin_selection_params.m_cost_of_change)));\n     }\n \n     // We include the minimum final change for SRD as we do want to avoid making really small change.\n     // KnapsackSolver does not need this because it includes MIN_CHANGE internally.\n     const CAmount srd_target = nTargetValue + coin_selection_params.m_change_fee + MIN_FINAL_CHANGE;\n     auto srd_result = SelectCoinsSRD(positive_groups, srd_target);\n     if (srd_result != std::nullopt) {\n-        const auto waste = GetSelectionWaste(srd_result->first, coin_selection_params.m_cost_of_change, srd_target, !coin_selection_params.m_subtract_fee_outputs);\n-        results.emplace_back(std::make_tuple(waste, std::move(srd_result->first), srd_result->second));\n+        results.push_back(std::make_pair(*srd_result, srd_result->GetWaste(coin_selection_params.m_cost_of_change)));\n     }\n \n     if (results.size() == 0) {\n         // No solution found\n-        return false;\n+        return std::nullopt;\n     }\n \n     // Choose the result with the least waste\n     // If the waste is the same, choose the one which spends more inputs.\n-    const auto& best_result = std::min_element(results.begin(), results.end(), [](const auto& a, const auto& b) {\n-        return std::get<0>(a) < std::get<0>(b) || (std::get<0>(a) == std::get<0>(b) && std::get<1>(a).size() > std::get<1>(b).size());\n+    auto [best_result, waste] = *std::min_element(results.begin(), results.end(), [](const auto& a, const auto& b){\n+        const auto [a_result, a_waste] = a;\n+        const auto [b_result, b_waste] = b;\n+        return a_waste < b_waste || (a_waste == b_waste && a_result.m_selected_inputs.size() > b_result.m_selected_inputs.size());\n     });\n-    setCoinsRet = std::get<1>(*best_result);\n-    nValueRet = std::get<2>(*best_result);\n-    return true;\n+    return best_result;\n }\n \n-bool SelectCoins(const CWallet& wallet, const std::vector<COutput>& vAvailableCoins, const CAmount& nTargetValue, std::set<CInputCoin>& setCoinsRet, CAmount& nValueRet, const CCoinControl& coin_control, CoinSelectionParams& coin_selection_params)\n+std::optional<SelectionResult> SelectCoins(const CWallet& wallet, const std::vector<COutput>& vAvailableCoins, const CAmount& nTargetValue, const CCoinControl& coin_control, CoinSelectionParams& coin_selection_params)\n {\n     std::vector<COutput> vCoins(vAvailableCoins);\n     CAmount value_to_select = nTargetValue;\n \n+    OutputGroup preset_inputs(coin_selection_params);\n+\n     // coin control -> return all selected outputs (we want all selected to go into the transaction for sure)\n     if (coin_control.HasSelected() && !coin_control.fAllowOtherInputs)\n     {\n-        for (const COutput& out : vCoins)\n-        {\n-            if (!out.fSpendable)\n-                 continue;\n-            nValueRet += out.tx->tx->vout[out.i].nValue;\n-            setCoinsRet.insert(out.GetInputCoin());\n+        for (const COutput& out : vCoins) {\n+            if (!out.fSpendable) continue;\n+            /* Set depth, from_me, ancestors, and descendants to 0 or false as these don't matter for preset inputs as no actual selection is being done.\n+             * positive_only is set to false because we want to include all preset inputs, even if they are dust.\n+             */\n+            preset_inputs.Insert(out.GetInputCoin(), 0, false, 0, 0, false);\n         }\n-        return (nValueRet >= nTargetValue);\n+        SelectionResult result(nTargetValue);\n+        result.AddInput(preset_inputs);\n+        if (result.GetSelectedValue() >= nTargetValue) return std::nullopt;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r740817760",
      "id" : 740817760,
      "line" : 440,
      "node_id" : "PRRC_kwDOABII584sJ_tg",
      "original_commit_id" : "1036ab72f8db0f85c7a294d01c25d00ec8f0b421",
      "original_line" : 440,
      "original_position" : 102,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 102,
      "pull_request_review_id" : 795009378,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740817760/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-02T08:34:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740817760",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r741267727"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741267727"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oops, fixed.",
      "commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "created_at" : "2021-11-02T16:29:05Z",
      "diff_hunk" : "@@ -373,76 +373,72 @@ std::vector<OutputGroup> GroupOutputs(const CWallet& wallet, const std::vector<C\n     return groups_out;\n }\n \n-bool AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,\n-                                 std::set<CInputCoin>& setCoinsRet, CAmount& nValueRet, const CoinSelectionParams& coin_selection_params)\n+std::optional<SelectionResult> AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,\n+                               const CoinSelectionParams& coin_selection_params)\n {\n-    setCoinsRet.clear();\n-    nValueRet = 0;\n-    // Vector of results for use with waste calculation\n-    // In order: calculated waste, selected inputs, selected input value (sum of input values)\n-    // TODO: Use a struct representing the selection result\n-    std::vector<std::tuple<CAmount, std::set<CInputCoin>, CAmount>> results;\n+    // Vector of result and waste pairs. We will choose the best one based on waste.\n+    std::vector<std::pair<SelectionResult, CAmount>> results;\n \n     // Note that unlike KnapsackSolver, we do not include the fee for creating a change output as BnB will not create a change output.\n     std::vector<OutputGroup> positive_groups = GroupOutputs(wallet, coins, coin_selection_params, eligibility_filter, true /* positive_only */);\n-    std::set<CInputCoin> bnb_coins;\n-    CAmount bnb_value;\n-    if (SelectCoinsBnB(positive_groups, nTargetValue, coin_selection_params.m_cost_of_change, bnb_coins, bnb_value)) {\n-        const auto waste = GetSelectionWaste(bnb_coins, /* cost of change */ CAmount(0), nTargetValue, !coin_selection_params.m_subtract_fee_outputs);\n-        results.emplace_back(std::make_tuple(waste, std::move(bnb_coins), bnb_value));\n+    std::optional<SelectionResult> bnb_result = SelectCoinsBnB(positive_groups, nTargetValue, coin_selection_params.m_cost_of_change);\n+    if (bnb_result) {\n+        results.push_back(std::make_pair(*bnb_result, bnb_result->GetWaste(CAmount(0))));\n     }\n \n     // The knapsack solver has some legacy behavior where it will spend dust outputs. We retain this behavior, so don't filter for positive only here.\n     std::vector<OutputGroup> all_groups = GroupOutputs(wallet, coins, coin_selection_params, eligibility_filter, false /* positive_only */);\n     // While nTargetValue includes the transaction fees for non-input things, it does not include the fee for creating a change output.\n     // So we need to include that for KnapsackSolver as well, as we are expecting to create a change output.\n-    std::set<CInputCoin> knapsack_coins;\n-    CAmount knapsack_value;\n-    if (KnapsackSolver(nTargetValue + coin_selection_params.m_change_fee, all_groups, knapsack_coins, knapsack_value)) {\n-        const auto waste = GetSelectionWaste(knapsack_coins, coin_selection_params.m_cost_of_change, nTargetValue + coin_selection_params.m_change_fee, !coin_selection_params.m_subtract_fee_outputs);\n-        results.emplace_back(std::make_tuple(waste, std::move(knapsack_coins), knapsack_value));\n+    std::optional<SelectionResult> knapsack_result = KnapsackSolver(all_groups, nTargetValue + coin_selection_params.m_change_fee);\n+    if (knapsack_result) {\n+        results.push_back(std::make_pair(*knapsack_result, knapsack_result->GetWaste(coin_selection_params.m_cost_of_change)));\n     }\n \n     // We include the minimum final change for SRD as we do want to avoid making really small change.\n     // KnapsackSolver does not need this because it includes MIN_CHANGE internally.\n     const CAmount srd_target = nTargetValue + coin_selection_params.m_change_fee + MIN_FINAL_CHANGE;\n     auto srd_result = SelectCoinsSRD(positive_groups, srd_target);\n     if (srd_result != std::nullopt) {\n-        const auto waste = GetSelectionWaste(srd_result->first, coin_selection_params.m_cost_of_change, srd_target, !coin_selection_params.m_subtract_fee_outputs);\n-        results.emplace_back(std::make_tuple(waste, std::move(srd_result->first), srd_result->second));\n+        results.push_back(std::make_pair(*srd_result, srd_result->GetWaste(coin_selection_params.m_cost_of_change)));\n     }\n \n     if (results.size() == 0) {\n         // No solution found\n-        return false;\n+        return std::nullopt;\n     }\n \n     // Choose the result with the least waste\n     // If the waste is the same, choose the one which spends more inputs.\n-    const auto& best_result = std::min_element(results.begin(), results.end(), [](const auto& a, const auto& b) {\n-        return std::get<0>(a) < std::get<0>(b) || (std::get<0>(a) == std::get<0>(b) && std::get<1>(a).size() > std::get<1>(b).size());\n+    auto [best_result, waste] = *std::min_element(results.begin(), results.end(), [](const auto& a, const auto& b){\n+        const auto [a_result, a_waste] = a;\n+        const auto [b_result, b_waste] = b;\n+        return a_waste < b_waste || (a_waste == b_waste && a_result.m_selected_inputs.size() > b_result.m_selected_inputs.size());\n     });\n-    setCoinsRet = std::get<1>(*best_result);\n-    nValueRet = std::get<2>(*best_result);\n-    return true;\n+    return best_result;\n }\n \n-bool SelectCoins(const CWallet& wallet, const std::vector<COutput>& vAvailableCoins, const CAmount& nTargetValue, std::set<CInputCoin>& setCoinsRet, CAmount& nValueRet, const CCoinControl& coin_control, CoinSelectionParams& coin_selection_params)\n+std::optional<SelectionResult> SelectCoins(const CWallet& wallet, const std::vector<COutput>& vAvailableCoins, const CAmount& nTargetValue, const CCoinControl& coin_control, CoinSelectionParams& coin_selection_params)\n {\n     std::vector<COutput> vCoins(vAvailableCoins);\n     CAmount value_to_select = nTargetValue;\n \n+    OutputGroup preset_inputs(coin_selection_params);\n+\n     // coin control -> return all selected outputs (we want all selected to go into the transaction for sure)\n     if (coin_control.HasSelected() && !coin_control.fAllowOtherInputs)\n     {\n-        for (const COutput& out : vCoins)\n-        {\n-            if (!out.fSpendable)\n-                 continue;\n-            nValueRet += out.tx->tx->vout[out.i].nValue;\n-            setCoinsRet.insert(out.GetInputCoin());\n+        for (const COutput& out : vCoins) {\n+            if (!out.fSpendable) continue;\n+            /* Set depth, from_me, ancestors, and descendants to 0 or false as these don't matter for preset inputs as no actual selection is being done.\n+             * positive_only is set to false because we want to include all preset inputs, even if they are dust.\n+             */\n+            preset_inputs.Insert(out.GetInputCoin(), 0, false, 0, 0, false);\n         }\n-        return (nValueRet >= nTargetValue);\n+        SelectionResult result(nTargetValue);\n+        result.AddInput(preset_inputs);\n+        if (result.GetSelectedValue() >= nTargetValue) return std::nullopt;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r741267727",
      "id" : 741267727,
      "in_reply_to_id" : 740817760,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584sLtkP",
      "original_commit_id" : "1036ab72f8db0f85c7a294d01c25d00ec8f0b421",
      "original_line" : 440,
      "original_position" : 102,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 795651850,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741267727/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-02T16:29:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741267727",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r741394282"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741394282"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Looks like this hasn't been caught by the tests, probably a nice to have follow up and a good first issue.",
      "commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "created_at" : "2021-11-02T19:16:52Z",
      "diff_hunk" : "@@ -373,76 +373,72 @@ std::vector<OutputGroup> GroupOutputs(const CWallet& wallet, const std::vector<C\n     return groups_out;\n }\n \n-bool AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,\n-                                 std::set<CInputCoin>& setCoinsRet, CAmount& nValueRet, const CoinSelectionParams& coin_selection_params)\n+std::optional<SelectionResult> AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,\n+                               const CoinSelectionParams& coin_selection_params)\n {\n-    setCoinsRet.clear();\n-    nValueRet = 0;\n-    // Vector of results for use with waste calculation\n-    // In order: calculated waste, selected inputs, selected input value (sum of input values)\n-    // TODO: Use a struct representing the selection result\n-    std::vector<std::tuple<CAmount, std::set<CInputCoin>, CAmount>> results;\n+    // Vector of result and waste pairs. We will choose the best one based on waste.\n+    std::vector<std::pair<SelectionResult, CAmount>> results;\n \n     // Note that unlike KnapsackSolver, we do not include the fee for creating a change output as BnB will not create a change output.\n     std::vector<OutputGroup> positive_groups = GroupOutputs(wallet, coins, coin_selection_params, eligibility_filter, true /* positive_only */);\n-    std::set<CInputCoin> bnb_coins;\n-    CAmount bnb_value;\n-    if (SelectCoinsBnB(positive_groups, nTargetValue, coin_selection_params.m_cost_of_change, bnb_coins, bnb_value)) {\n-        const auto waste = GetSelectionWaste(bnb_coins, /* cost of change */ CAmount(0), nTargetValue, !coin_selection_params.m_subtract_fee_outputs);\n-        results.emplace_back(std::make_tuple(waste, std::move(bnb_coins), bnb_value));\n+    std::optional<SelectionResult> bnb_result = SelectCoinsBnB(positive_groups, nTargetValue, coin_selection_params.m_cost_of_change);\n+    if (bnb_result) {\n+        results.push_back(std::make_pair(*bnb_result, bnb_result->GetWaste(CAmount(0))));\n     }\n \n     // The knapsack solver has some legacy behavior where it will spend dust outputs. We retain this behavior, so don't filter for positive only here.\n     std::vector<OutputGroup> all_groups = GroupOutputs(wallet, coins, coin_selection_params, eligibility_filter, false /* positive_only */);\n     // While nTargetValue includes the transaction fees for non-input things, it does not include the fee for creating a change output.\n     // So we need to include that for KnapsackSolver as well, as we are expecting to create a change output.\n-    std::set<CInputCoin> knapsack_coins;\n-    CAmount knapsack_value;\n-    if (KnapsackSolver(nTargetValue + coin_selection_params.m_change_fee, all_groups, knapsack_coins, knapsack_value)) {\n-        const auto waste = GetSelectionWaste(knapsack_coins, coin_selection_params.m_cost_of_change, nTargetValue + coin_selection_params.m_change_fee, !coin_selection_params.m_subtract_fee_outputs);\n-        results.emplace_back(std::make_tuple(waste, std::move(knapsack_coins), knapsack_value));\n+    std::optional<SelectionResult> knapsack_result = KnapsackSolver(all_groups, nTargetValue + coin_selection_params.m_change_fee);\n+    if (knapsack_result) {\n+        results.push_back(std::make_pair(*knapsack_result, knapsack_result->GetWaste(coin_selection_params.m_cost_of_change)));\n     }\n \n     // We include the minimum final change for SRD as we do want to avoid making really small change.\n     // KnapsackSolver does not need this because it includes MIN_CHANGE internally.\n     const CAmount srd_target = nTargetValue + coin_selection_params.m_change_fee + MIN_FINAL_CHANGE;\n     auto srd_result = SelectCoinsSRD(positive_groups, srd_target);\n     if (srd_result != std::nullopt) {\n-        const auto waste = GetSelectionWaste(srd_result->first, coin_selection_params.m_cost_of_change, srd_target, !coin_selection_params.m_subtract_fee_outputs);\n-        results.emplace_back(std::make_tuple(waste, std::move(srd_result->first), srd_result->second));\n+        results.push_back(std::make_pair(*srd_result, srd_result->GetWaste(coin_selection_params.m_cost_of_change)));\n     }\n \n     if (results.size() == 0) {\n         // No solution found\n-        return false;\n+        return std::nullopt;\n     }\n \n     // Choose the result with the least waste\n     // If the waste is the same, choose the one which spends more inputs.\n-    const auto& best_result = std::min_element(results.begin(), results.end(), [](const auto& a, const auto& b) {\n-        return std::get<0>(a) < std::get<0>(b) || (std::get<0>(a) == std::get<0>(b) && std::get<1>(a).size() > std::get<1>(b).size());\n+    auto [best_result, waste] = *std::min_element(results.begin(), results.end(), [](const auto& a, const auto& b){\n+        const auto [a_result, a_waste] = a;\n+        const auto [b_result, b_waste] = b;\n+        return a_waste < b_waste || (a_waste == b_waste && a_result.m_selected_inputs.size() > b_result.m_selected_inputs.size());\n     });\n-    setCoinsRet = std::get<1>(*best_result);\n-    nValueRet = std::get<2>(*best_result);\n-    return true;\n+    return best_result;\n }\n \n-bool SelectCoins(const CWallet& wallet, const std::vector<COutput>& vAvailableCoins, const CAmount& nTargetValue, std::set<CInputCoin>& setCoinsRet, CAmount& nValueRet, const CCoinControl& coin_control, CoinSelectionParams& coin_selection_params)\n+std::optional<SelectionResult> SelectCoins(const CWallet& wallet, const std::vector<COutput>& vAvailableCoins, const CAmount& nTargetValue, const CCoinControl& coin_control, CoinSelectionParams& coin_selection_params)\n {\n     std::vector<COutput> vCoins(vAvailableCoins);\n     CAmount value_to_select = nTargetValue;\n \n+    OutputGroup preset_inputs(coin_selection_params);\n+\n     // coin control -> return all selected outputs (we want all selected to go into the transaction for sure)\n     if (coin_control.HasSelected() && !coin_control.fAllowOtherInputs)\n     {\n-        for (const COutput& out : vCoins)\n-        {\n-            if (!out.fSpendable)\n-                 continue;\n-            nValueRet += out.tx->tx->vout[out.i].nValue;\n-            setCoinsRet.insert(out.GetInputCoin());\n+        for (const COutput& out : vCoins) {\n+            if (!out.fSpendable) continue;\n+            /* Set depth, from_me, ancestors, and descendants to 0 or false as these don't matter for preset inputs as no actual selection is being done.\n+             * positive_only is set to false because we want to include all preset inputs, even if they are dust.\n+             */\n+            preset_inputs.Insert(out.GetInputCoin(), 0, false, 0, 0, false);\n         }\n-        return (nValueRet >= nTargetValue);\n+        SelectionResult result(nTargetValue);\n+        result.AddInput(preset_inputs);\n+        if (result.GetSelectedValue() >= nTargetValue) return std::nullopt;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r741394282",
      "id" : 741394282,
      "in_reply_to_id" : 740817760,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584sMMdq",
      "original_commit_id" : "1036ab72f8db0f85c7a294d01c25d00ec8f0b421",
      "original_line" : 440,
      "original_position" : 102,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 795825067,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741394282/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-02T19:16:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741394282",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748866164"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748866164"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In 94d851d28cb909a8f1f8ab795f1d9fc74bebfc7f\r\n\r\nI think there should definitely be a comment here about the difference describing exactly what `equivalent_sets` checks and its difference vs `equal_sets`",
      "commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "created_at" : "2021-11-14T14:58:57Z",
      "diff_hunk" : "@@ -81,6 +83,23 @@ static void add_coin(std::vector<COutput>& coins, CWallet& wallet, const CAmount\n     coins.push_back(output);\n }\n \n+static bool equivalent_sets(CoinSet a, CoinSet b)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748866164",
      "id" : 748866164,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584sosp0",
      "original_commit_id" : "94d851d28cb909a8f1f8ab795f1d9fc74bebfc7f",
      "original_line" : 86,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 805482179,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748866164/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-14T15:43:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748866164",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748866401"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748866401"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In fe4d2eff23f22ec09b71bd4f218a28c66a386f10:\r\nShould this be `private`? Especially since you have functions to `AddInput()` and `GetInputVector()`, nobody should have direct access to this set.",
      "commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "created_at" : "2021-11-14T15:00:48Z",
      "diff_hunk" : "@@ -197,6 +197,32 @@ struct OutputGroup\n  */\n [[nodiscard]] CAmount GetSelectionWaste(const std::set<CInputCoin>& inputs, CAmount change_cost, CAmount target, bool use_effective_value = true);\n \n+struct SelectionResult\n+{\n+    /** Set of inputs selected by the algorithm to use in the transaction */\n+    std::set<CInputCoin> m_selected_inputs;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748866401",
      "id" : 748866401,
      "line" : 205,
      "node_id" : "PRRC_kwDOABII584sosth",
      "original_commit_id" : "fe4d2eff23f22ec09b71bd4f218a28c66a386f10",
      "original_line" : 203,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.h",
      "position" : 17,
      "pull_request_review_id" : 805482179,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748866401/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-14T15:44:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748866401",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748866526"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748866526"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In fe4d2eff23f22ec09b71bd4f218a28c66a386f10:\r\ndelete default ctor, to make it impossible to create a `SelectionResult` with no specified target?",
      "commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "created_at" : "2021-11-14T15:01:30Z",
      "diff_hunk" : "@@ -197,6 +197,32 @@ struct OutputGroup\n  */\n [[nodiscard]] CAmount GetSelectionWaste(const std::set<CInputCoin>& inputs, CAmount change_cost, CAmount target, bool use_effective_value = true);\n \n+struct SelectionResult\n+{\n+    /** Set of inputs selected by the algorithm to use in the transaction */\n+    std::set<CInputCoin> m_selected_inputs;\n+    /** The target the algorithm selected for. Note that this may not be equal to the recipient amount as it can include non-input fees */\n+    const CAmount m_target;\n+    /** Whether the input values for calculations should be the effective value (true) or normal value (false) */\n+    bool m_use_effective{false};\n+\n+    explicit SelectionResult(const CAmount target)\n+        : m_target(target) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748866526",
      "id" : 748866526,
      "line" : 212,
      "node_id" : "PRRC_kwDOABII584sosve",
      "original_commit_id" : "fe4d2eff23f22ec09b71bd4f218a28c66a386f10",
      "original_line" : 210,
      "original_position" : 14,
      "original_start_line" : 209,
      "path" : "src/wallet/coinselection.h",
      "position" : 24,
      "pull_request_review_id" : 805482179,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748866526/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 211,
      "start_side" : "RIGHT",
      "updated_at" : "2021-11-14T15:44:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748866526",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748867141"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748867141"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In cb6507ca5fc2be3d88ad5764185419e0f20a175c:\r\n\r\nThis seems strange, since `m_use_effective` should never really change. IIRC, `m_subtract_fee_outputs` is known right from the start (`CreateTransactionInternal()`) right? It seems that `SelectionResult::m_use_effective` should be a `const bool` and set in the constructor.",
      "commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "created_at" : "2021-11-14T15:05:41Z",
      "diff_hunk" : "@@ -418,6 +413,7 @@ void SelectionResult::Clear()\n void SelectionResult::AddInput(const OutputGroup& group)\n {\n     util::insert(m_selected_inputs, group.m_outputs);\n+    m_use_effective = !group.m_subtract_fee_outputs;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748867141",
      "id" : 748867141,
      "line" : 408,
      "node_id" : "PRRC_kwDOABII584sos5F",
      "original_commit_id" : "cb6507ca5fc2be3d88ad5764185419e0f20a175c",
      "original_line" : 416,
      "original_position" : 57,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.cpp",
      "position" : 181,
      "pull_request_review_id" : 805482179,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748867141/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-14T15:43:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748867141",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748867273"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748867273"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "My expectation would be to `Assume(group.m_subtract_fee_outputs != m_use_effective)`. Maybe I'm misunderstanding?",
      "commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "created_at" : "2021-11-14T15:06:35Z",
      "diff_hunk" : "@@ -418,6 +413,7 @@ void SelectionResult::Clear()\n void SelectionResult::AddInput(const OutputGroup& group)\n {\n     util::insert(m_selected_inputs, group.m_outputs);\n+    m_use_effective = !group.m_subtract_fee_outputs;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748867273",
      "id" : 748867273,
      "in_reply_to_id" : 748867141,
      "line" : 408,
      "node_id" : "PRRC_kwDOABII584sos7J",
      "original_commit_id" : "cb6507ca5fc2be3d88ad5764185419e0f20a175c",
      "original_line" : 416,
      "original_position" : 57,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.cpp",
      "position" : 181,
      "pull_request_review_id" : 805482179,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748867273/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-14T15:43:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748867273",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748868349"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748868349"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think this is cleaner, and keeps the scope of the result to this `if` block. There's no reason why `r1`'s scope should persist through the end of the lambda.\r\n```suggestion\r\n        if (auto r1{AttemptSelection(wallet, value_to_select, CoinEligibilityFilter(1, 6, 0), vCoins, coin_selection_params)}) {\r\n            return r1.value();\r\n        }\r\n```",
      "commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "created_at" : "2021-11-14T15:14:14Z",
      "diff_hunk" : "@@ -515,60 +515,60 @@ bool SelectCoins(const CWallet& wallet, const std::vector<COutput>& vAvailableCo\n     // Coin Selection attempts to select inputs from a pool of eligible UTXOs to fund the\n     // transaction at a target feerate. If an attempt fails, more attempts may be made using a more\n     // permissive CoinEligibilityFilter.\n-    const bool res = [&] {\n+    std::optional<SelectionResult> res = [&] {\n         // Pre-selected inputs already cover the target amount.\n-        if (value_to_select <= 0) return true;\n+        if (value_to_select <= 0) return std::make_optional(SelectionResult(nTargetValue));\n \n         // If possible, fund the transaction with confirmed UTXOs only. Prefer at least six\n         // confirmations on outputs received from other wallets and only spend confirmed change.\n-        if (AttemptSelection(wallet, value_to_select, CoinEligibilityFilter(1, 6, 0), vCoins, setCoinsRet, nValueRet, coin_selection_params)) return true;\n-        if (AttemptSelection(wallet, value_to_select, CoinEligibilityFilter(1, 1, 0), vCoins, setCoinsRet, nValueRet, coin_selection_params)) return true;\n+        std::optional<SelectionResult> r1 = AttemptSelection(wallet, value_to_select, CoinEligibilityFilter(1, 6, 0), vCoins, coin_selection_params);\n+        if (r1) return r1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748868349",
      "id" : 748868349,
      "line" : 525,
      "node_id" : "PRRC_kwDOABII584sotL9",
      "original_commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "original_line" : 525,
      "original_position" : 160,
      "original_start_line" : 524,
      "path" : "src/wallet/spend.cpp",
      "position" : 160,
      "pull_request_review_id" : 805482179,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748868349/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 524,
      "start_side" : "RIGHT",
      "updated_at" : "2021-11-14T15:43:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748868349",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748868619"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748868619"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "(same with the rest of the `AttemptSelection` calls)",
      "commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "created_at" : "2021-11-14T15:16:33Z",
      "diff_hunk" : "@@ -515,60 +515,60 @@ bool SelectCoins(const CWallet& wallet, const std::vector<COutput>& vAvailableCo\n     // Coin Selection attempts to select inputs from a pool of eligible UTXOs to fund the\n     // transaction at a target feerate. If an attempt fails, more attempts may be made using a more\n     // permissive CoinEligibilityFilter.\n-    const bool res = [&] {\n+    std::optional<SelectionResult> res = [&] {\n         // Pre-selected inputs already cover the target amount.\n-        if (value_to_select <= 0) return true;\n+        if (value_to_select <= 0) return std::make_optional(SelectionResult(nTargetValue));\n \n         // If possible, fund the transaction with confirmed UTXOs only. Prefer at least six\n         // confirmations on outputs received from other wallets and only spend confirmed change.\n-        if (AttemptSelection(wallet, value_to_select, CoinEligibilityFilter(1, 6, 0), vCoins, setCoinsRet, nValueRet, coin_selection_params)) return true;\n-        if (AttemptSelection(wallet, value_to_select, CoinEligibilityFilter(1, 1, 0), vCoins, setCoinsRet, nValueRet, coin_selection_params)) return true;\n+        std::optional<SelectionResult> r1 = AttemptSelection(wallet, value_to_select, CoinEligibilityFilter(1, 6, 0), vCoins, coin_selection_params);\n+        if (r1) return r1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748868619",
      "id" : 748868619,
      "in_reply_to_id" : 748868349,
      "line" : 525,
      "node_id" : "PRRC_kwDOABII584sotQL",
      "original_commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "original_line" : 525,
      "original_position" : 160,
      "original_start_line" : 524,
      "path" : "src/wallet/spend.cpp",
      "position" : 160,
      "pull_request_review_id" : 805482179,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748868619/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 524,
      "start_side" : "RIGHT",
      "updated_at" : "2021-11-14T15:43:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748868619",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748870402"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748870402"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "is there any benefit to using a `std::make_optional` here?\r\n```suggestion\r\n    return result;\r\n```",
      "commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "created_at" : "2021-11-14T15:30:53Z",
      "diff_hunk" : "@@ -156,25 +153,22 @@ bool SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selectio\n \n     // Check for solution\n     if (best_selection.empty()) {\n-        return false;\n+        return std::nullopt;\n     }\n \n     // Set output set\n-    value_ret = 0;\n     for (size_t i = 0; i < best_selection.size(); ++i) {\n         if (best_selection.at(i)) {\n-            util::insert(out_set, utxo_pool.at(i).m_outputs);\n-            value_ret += utxo_pool.at(i).m_value;\n+            result.AddInput(utxo_pool.at(i));\n         }\n     }\n \n-    return true;\n+    return std::make_optional(result);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748870402",
      "id" : 748870402,
      "line" : 166,
      "node_id" : "PRRC_kwDOABII584sotsC",
      "original_commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "original_line" : 166,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.cpp",
      "position" : 49,
      "pull_request_review_id" : 805482179,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748870402/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-14T15:43:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748870402",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748870486"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748870486"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "note to self, `std::make_optional` makes sense here to avoid the copy of the temporary `SelectionResult`; it's constructed in place",
      "commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "created_at" : "2021-11-14T15:31:34Z",
      "diff_hunk" : "@@ -515,60 +515,60 @@ bool SelectCoins(const CWallet& wallet, const std::vector<COutput>& vAvailableCo\n     // Coin Selection attempts to select inputs from a pool of eligible UTXOs to fund the\n     // transaction at a target feerate. If an attempt fails, more attempts may be made using a more\n     // permissive CoinEligibilityFilter.\n-    const bool res = [&] {\n+    std::optional<SelectionResult> res = [&] {\n         // Pre-selected inputs already cover the target amount.\n-        if (value_to_select <= 0) return true;\n+        if (value_to_select <= 0) return std::make_optional(SelectionResult(nTargetValue));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748870486",
      "id" : 748870486,
      "line" : 520,
      "node_id" : "PRRC_kwDOABII584sottW",
      "original_commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "original_line" : 520,
      "original_position" : 153,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 153,
      "pull_request_review_id" : 805482179,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748870486/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-14T15:43:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748870486",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748870890"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748870890"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n    if (auto bnb_result{SelectCoinsBnB(positive_groups, nTargetValue, coin_selection_params.m_cost_of_change)}) {\r\n```",
      "commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "created_at" : "2021-11-14T15:34:24Z",
      "diff_hunk" : "@@ -373,76 +373,72 @@ std::vector<OutputGroup> GroupOutputs(const CWallet& wallet, const std::vector<C\n     return groups_out;\n }\n \n-bool AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,\n-                                 std::set<CInputCoin>& setCoinsRet, CAmount& nValueRet, const CoinSelectionParams& coin_selection_params)\n+std::optional<SelectionResult> AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,\n+                               const CoinSelectionParams& coin_selection_params)\n {\n-    setCoinsRet.clear();\n-    nValueRet = 0;\n-    // Vector of results for use with waste calculation\n-    // In order: calculated waste, selected inputs, selected input value (sum of input values)\n-    // TODO: Use a struct representing the selection result\n-    std::vector<std::tuple<CAmount, std::set<CInputCoin>, CAmount>> results;\n+    // Vector of result and waste pairs. We will choose the best one based on waste.\n+    std::vector<std::pair<SelectionResult, CAmount>> results;\n \n     // Note that unlike KnapsackSolver, we do not include the fee for creating a change output as BnB will not create a change output.\n     std::vector<OutputGroup> positive_groups = GroupOutputs(wallet, coins, coin_selection_params, eligibility_filter, true /* positive_only */);\n-    std::set<CInputCoin> bnb_coins;\n-    CAmount bnb_value;\n-    if (SelectCoinsBnB(positive_groups, nTargetValue, coin_selection_params.m_cost_of_change, bnb_coins, bnb_value)) {\n-        const auto waste = GetSelectionWaste(bnb_coins, /* cost of change */ CAmount(0), nTargetValue, !coin_selection_params.m_subtract_fee_outputs);\n-        results.emplace_back(std::make_tuple(waste, std::move(bnb_coins), bnb_value));\n+    std::optional<SelectionResult> bnb_result = SelectCoinsBnB(positive_groups, nTargetValue, coin_selection_params.m_cost_of_change);\n+    if (bnb_result) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748870890",
      "id" : 748870890,
      "line" : 385,
      "node_id" : "PRRC_kwDOABII584sotzq",
      "original_commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "original_line" : 385,
      "original_position" : 26,
      "original_start_line" : 384,
      "path" : "src/wallet/spend.cpp",
      "position" : 26,
      "pull_request_review_id" : 805482179,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748870890/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 384,
      "start_side" : "RIGHT",
      "updated_at" : "2021-11-14T15:43:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748870890",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748870994"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748870994"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Can this be written into a comparison operator for `SelectionResult`? The logic of waste and what makes one selection result better than another is inherent to the `SelectionResult` type; imo it fits better there than within `AttemptSelection`. \r\n\r\nIf you have a `<` operator defined, you can sort and/or just return the min element.",
      "commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "created_at" : "2021-11-14T15:35:30Z",
      "diff_hunk" : "@@ -373,76 +373,72 @@ std::vector<OutputGroup> GroupOutputs(const CWallet& wallet, const std::vector<C\n     return groups_out;\n }\n \n-bool AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,\n-                                 std::set<CInputCoin>& setCoinsRet, CAmount& nValueRet, const CoinSelectionParams& coin_selection_params)\n+std::optional<SelectionResult> AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,\n+                               const CoinSelectionParams& coin_selection_params)\n {\n-    setCoinsRet.clear();\n-    nValueRet = 0;\n-    // Vector of results for use with waste calculation\n-    // In order: calculated waste, selected inputs, selected input value (sum of input values)\n-    // TODO: Use a struct representing the selection result\n-    std::vector<std::tuple<CAmount, std::set<CInputCoin>, CAmount>> results;\n+    // Vector of result and waste pairs. We will choose the best one based on waste.\n+    std::vector<std::pair<SelectionResult, CAmount>> results;\n \n     // Note that unlike KnapsackSolver, we do not include the fee for creating a change output as BnB will not create a change output.\n     std::vector<OutputGroup> positive_groups = GroupOutputs(wallet, coins, coin_selection_params, eligibility_filter, true /* positive_only */);\n-    std::set<CInputCoin> bnb_coins;\n-    CAmount bnb_value;\n-    if (SelectCoinsBnB(positive_groups, nTargetValue, coin_selection_params.m_cost_of_change, bnb_coins, bnb_value)) {\n-        const auto waste = GetSelectionWaste(bnb_coins, /* cost of change */ CAmount(0), nTargetValue, !coin_selection_params.m_subtract_fee_outputs);\n-        results.emplace_back(std::make_tuple(waste, std::move(bnb_coins), bnb_value));\n+    std::optional<SelectionResult> bnb_result = SelectCoinsBnB(positive_groups, nTargetValue, coin_selection_params.m_cost_of_change);\n+    if (bnb_result) {\n+        results.push_back(std::make_pair(*bnb_result, bnb_result->GetWaste(CAmount(0))));\n     }\n \n     // The knapsack solver has some legacy behavior where it will spend dust outputs. We retain this behavior, so don't filter for positive only here.\n     std::vector<OutputGroup> all_groups = GroupOutputs(wallet, coins, coin_selection_params, eligibility_filter, false /* positive_only */);\n     // While nTargetValue includes the transaction fees for non-input things, it does not include the fee for creating a change output.\n     // So we need to include that for KnapsackSolver as well, as we are expecting to create a change output.\n-    std::set<CInputCoin> knapsack_coins;\n-    CAmount knapsack_value;\n-    if (KnapsackSolver(nTargetValue + coin_selection_params.m_change_fee, all_groups, knapsack_coins, knapsack_value)) {\n-        const auto waste = GetSelectionWaste(knapsack_coins, coin_selection_params.m_cost_of_change, nTargetValue + coin_selection_params.m_change_fee, !coin_selection_params.m_subtract_fee_outputs);\n-        results.emplace_back(std::make_tuple(waste, std::move(knapsack_coins), knapsack_value));\n+    std::optional<SelectionResult> knapsack_result = KnapsackSolver(all_groups, nTargetValue + coin_selection_params.m_change_fee);\n+    if (knapsack_result) {\n+        results.push_back(std::make_pair(*knapsack_result, knapsack_result->GetWaste(coin_selection_params.m_cost_of_change)));\n     }\n \n     // We include the minimum final change for SRD as we do want to avoid making really small change.\n     // KnapsackSolver does not need this because it includes MIN_CHANGE internally.\n     const CAmount srd_target = nTargetValue + coin_selection_params.m_change_fee + MIN_FINAL_CHANGE;\n     auto srd_result = SelectCoinsSRD(positive_groups, srd_target);\n     if (srd_result != std::nullopt) {\n-        const auto waste = GetSelectionWaste(srd_result->first, coin_selection_params.m_cost_of_change, srd_target, !coin_selection_params.m_subtract_fee_outputs);\n-        results.emplace_back(std::make_tuple(waste, std::move(srd_result->first), srd_result->second));\n+        results.push_back(std::make_pair(*srd_result, srd_result->GetWaste(coin_selection_params.m_cost_of_change)));\n     }\n \n     if (results.size() == 0) {\n         // No solution found\n-        return false;\n+        return std::nullopt;\n     }\n \n     // Choose the result with the least waste\n     // If the waste is the same, choose the one which spends more inputs.\n-    const auto& best_result = std::min_element(results.begin(), results.end(), [](const auto& a, const auto& b) {\n-        return std::get<0>(a) < std::get<0>(b) || (std::get<0>(a) == std::get<0>(b) && std::get<1>(a).size() > std::get<1>(b).size());\n+    auto [best_result, waste] = *std::min_element(results.begin(), results.end(), [](const auto& a, const auto& b){\n+        const auto [a_result, a_waste] = a;\n+        const auto [b_result, b_waste] = b;\n+        return a_waste < b_waste || (a_waste == b_waste && a_result.m_selected_inputs.size() > b_result.m_selected_inputs.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748870994",
      "id" : 748870994,
      "line" : 416,
      "node_id" : "PRRC_kwDOABII584sot1S",
      "original_commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "original_line" : 416,
      "original_position" : 67,
      "original_start_line" : 413,
      "path" : "src/wallet/spend.cpp",
      "position" : 67,
      "pull_request_review_id" : 805482179,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748870994/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 413,
      "start_side" : "RIGHT",
      "updated_at" : "2021-11-14T15:43:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748870994",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755390185"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755390185"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think randomizing in a `Get` function is very unexpected. You wouldn't expect it to return a different value every time. I'd prefer to either rename this function to e.g. `RandomizedInputVector()` or, do it at the call site, or do the shuffle somewhere else.",
      "commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "created_at" : "2021-11-23T18:09:26Z",
      "diff_hunk" : "@@ -395,3 +387,30 @@ CAmount GetSelectionWaste(const std::set<CInputCoin>& inputs, CAmount change_cos\n \n     return waste;\n }\n+\n+CAmount SelectionResult::GetSelectedValue() const\n+{\n+    CAmount ret = 0;\n+    for (const auto& coin : m_selected_inputs) {\n+        ret += coin.txout.nValue;\n+    }\n+    return ret;\n+}\n+\n+void SelectionResult::Clear()\n+{\n+    m_selected_inputs.clear();\n+}\n+\n+void SelectionResult::AddInput(const OutputGroup& group)\n+{\n+    util::insert(m_selected_inputs, group.m_outputs);\n+    m_use_effective = !group.m_subtract_fee_outputs;\n+}\n+\n+std::vector<CInputCoin> SelectionResult::GetInputVector() const\n+{\n+    std::vector<CInputCoin> coins(m_selected_inputs.begin(), m_selected_inputs.end());\n+    Shuffle(coins.begin(), coins.end(), FastRandomContext());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755390185",
      "id" : 755390185,
      "line" : 414,
      "node_id" : "PRRC_kwDOABII584tBlbp",
      "original_commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "original_line" : 414,
      "original_position" : 187,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.cpp",
      "position" : 187,
      "pull_request_review_id" : 814021649,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755390185/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-23T18:12:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755390185",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755390977"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755390977"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe move this under the global `::GetSelectionWaste`? Currently no problem but if you'd ever want to make it static.",
      "commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "created_at" : "2021-11-23T18:10:34Z",
      "diff_hunk" : "@@ -369,6 +356,11 @@ CAmount OutputGroup::GetSelectionAmount() const\n     return m_subtract_fee_outputs ? m_value : effective_value;\n }\n \n+CAmount SelectionResult::GetWaste(CAmount change_cost) const\n+{\n+    return GetSelectionWaste(m_selected_inputs, change_cost, m_target, m_use_effective);\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755390977",
      "id" : 755390977,
      "line" : 362,
      "node_id" : "PRRC_kwDOABII584tBloB",
      "original_commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "original_line" : 362,
      "original_position" : 154,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.cpp",
      "position" : 154,
      "pull_request_review_id" : 814022678,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755390977/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-23T18:10:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755390977",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755393639"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755393639"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Local function, could be static",
      "commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "created_at" : "2021-11-23T18:14:24Z",
      "diff_hunk" : "@@ -81,10 +84,30 @@ static void add_coin(std::vector<COutput>& coins, CWallet& wallet, const CAmount\n     coins.push_back(output);\n }\n \n-static bool equal_sets(CoinSet a, CoinSet b)\n+/** Check if SelectionResult a is equivalent to SelectionResult b.\n+ * Equivalent means same input values, but maybe different inputs (i.e. same value, different prevout) */\n+bool EquivalentResult(const SelectionResult& a, const SelectionResult& b)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755393639",
      "id" : 755393639,
      "line" : 89,
      "node_id" : "PRRC_kwDOABII584tBmRn",
      "original_commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "original_line" : 89,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : 46,
      "pull_request_review_id" : 814026131,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755393639/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-23T18:14:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755393639",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755398596"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755398596"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think this function is ever used. I think I'd prefer to remove it, in general it seems unnecessary to have a `Clear` function instead of replacing the structure with a new, empty one.",
      "commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "created_at" : "2021-11-23T18:21:37Z",
      "diff_hunk" : "@@ -395,3 +387,30 @@ CAmount GetSelectionWaste(const std::set<CInputCoin>& inputs, CAmount change_cos\n \n     return waste;\n }\n+\n+CAmount SelectionResult::GetSelectedValue() const\n+{\n+    CAmount ret = 0;\n+    for (const auto& coin : m_selected_inputs) {\n+        ret += coin.txout.nValue;\n+    }\n+    return ret;\n+}\n+\n+void SelectionResult::Clear()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755398596",
      "id" : 755398596,
      "line" : 400,
      "node_id" : "PRRC_kwDOABII584tBnfE",
      "original_commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "original_line" : 400,
      "original_position" : 173,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.cpp",
      "position" : 173,
      "pull_request_review_id" : 814032855,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755398596/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-23T18:21:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755398596",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755419084"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755419084"
         }
      },
      "author_association" : "MEMBER",
      "body" : "A comment is added when these are later replaced with `EquivalentResuls` and `EqualResults`.",
      "commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "created_at" : "2021-11-23T18:51:20Z",
      "diff_hunk" : "@@ -81,6 +83,23 @@ static void add_coin(std::vector<COutput>& coins, CWallet& wallet, const CAmount\n     coins.push_back(output);\n }\n \n+static bool equivalent_sets(CoinSet a, CoinSet b)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755419084",
      "id" : 755419084,
      "in_reply_to_id" : 748866164,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tBsfM",
      "original_commit_id" : "94d851d28cb909a8f1f8ab795f1d9fc74bebfc7f",
      "original_line" : 86,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 814059944,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755419084/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-23T18:51:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755419084",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755420991"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755420991"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I did it this way because `SelectionResult`s are constructed by the `SelectCoins*` functions which do not know about `m_subtract_fee_outputs` and didn't feel like adding more parameters to those functions just to have `m_use_effective` be set in the constructor.",
      "commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "created_at" : "2021-11-23T18:54:10Z",
      "diff_hunk" : "@@ -418,6 +413,7 @@ void SelectionResult::Clear()\n void SelectionResult::AddInput(const OutputGroup& group)\n {\n     util::insert(m_selected_inputs, group.m_outputs);\n+    m_use_effective = !group.m_subtract_fee_outputs;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755420991",
      "id" : 755420991,
      "in_reply_to_id" : 748867141,
      "line" : 408,
      "node_id" : "PRRC_kwDOABII584tBs8_",
      "original_commit_id" : "cb6507ca5fc2be3d88ad5764185419e0f20a175c",
      "original_line" : 416,
      "original_position" : 57,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.cpp",
      "position" : 181,
      "pull_request_review_id" : 814062516,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755420991/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-23T18:54:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755420991",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755536234"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755536234"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Inserted a commit which makes them private.",
      "commit_id" : "4f292092d5ad399d274159716f4c2550d5301167",
      "created_at" : "2021-11-23T22:03:14Z",
      "diff_hunk" : "@@ -197,6 +197,32 @@ struct OutputGroup\n  */\n [[nodiscard]] CAmount GetSelectionWaste(const std::set<CInputCoin>& inputs, CAmount change_cost, CAmount target, bool use_effective_value = true);\n \n+struct SelectionResult\n+{\n+    /** Set of inputs selected by the algorithm to use in the transaction */\n+    std::set<CInputCoin> m_selected_inputs;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755536234",
      "id" : 755536234,
      "in_reply_to_id" : 748866401,
      "line" : 206,
      "node_id" : "PRRC_kwDOABII584tCJFq",
      "original_commit_id" : "fe4d2eff23f22ec09b71bd4f218a28c66a386f10",
      "original_line" : 206,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.h",
      "position" : 18,
      "pull_request_review_id" : 814216411,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755536234/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-23T22:03:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755536234",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755536278"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755536278"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "4f292092d5ad399d274159716f4c2550d5301167",
      "created_at" : "2021-11-23T22:03:20Z",
      "diff_hunk" : "@@ -197,6 +197,32 @@ struct OutputGroup\n  */\n [[nodiscard]] CAmount GetSelectionWaste(const std::set<CInputCoin>& inputs, CAmount change_cost, CAmount target, bool use_effective_value = true);\n \n+struct SelectionResult\n+{\n+    /** Set of inputs selected by the algorithm to use in the transaction */\n+    std::set<CInputCoin> m_selected_inputs;\n+    /** The target the algorithm selected for. Note that this may not be equal to the recipient amount as it can include non-input fees */\n+    const CAmount m_target;\n+    /** Whether the input values for calculations should be the effective value (true) or normal value (false) */\n+    bool m_use_effective{false};\n+\n+    explicit SelectionResult(const CAmount target)\n+        : m_target(target) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755536278",
      "id" : 755536278,
      "in_reply_to_id" : 748866526,
      "line" : 216,
      "node_id" : "PRRC_kwDOABII584tCJGW",
      "original_commit_id" : "fe4d2eff23f22ec09b71bd4f218a28c66a386f10",
      "original_line" : 216,
      "original_position" : 14,
      "original_start_line" : 209,
      "path" : "src/wallet/coinselection.h",
      "position" : 28,
      "pull_request_review_id" : 814216466,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755536278/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 215,
      "start_side" : "RIGHT",
      "updated_at" : "2021-11-23T22:03:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755536278",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755536363"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755536363"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done here and elsewhere.",
      "commit_id" : "4f292092d5ad399d274159716f4c2550d5301167",
      "created_at" : "2021-11-23T22:03:30Z",
      "diff_hunk" : "@@ -515,60 +515,60 @@ bool SelectCoins(const CWallet& wallet, const std::vector<COutput>& vAvailableCo\n     // Coin Selection attempts to select inputs from a pool of eligible UTXOs to fund the\n     // transaction at a target feerate. If an attempt fails, more attempts may be made using a more\n     // permissive CoinEligibilityFilter.\n-    const bool res = [&] {\n+    std::optional<SelectionResult> res = [&] {\n         // Pre-selected inputs already cover the target amount.\n-        if (value_to_select <= 0) return true;\n+        if (value_to_select <= 0) return std::make_optional(SelectionResult(nTargetValue));\n \n         // If possible, fund the transaction with confirmed UTXOs only. Prefer at least six\n         // confirmations on outputs received from other wallets and only spend confirmed change.\n-        if (AttemptSelection(wallet, value_to_select, CoinEligibilityFilter(1, 6, 0), vCoins, setCoinsRet, nValueRet, coin_selection_params)) return true;\n-        if (AttemptSelection(wallet, value_to_select, CoinEligibilityFilter(1, 1, 0), vCoins, setCoinsRet, nValueRet, coin_selection_params)) return true;\n+        std::optional<SelectionResult> r1 = AttemptSelection(wallet, value_to_select, CoinEligibilityFilter(1, 6, 0), vCoins, coin_selection_params);\n+        if (r1) return r1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755536363",
      "id" : 755536363,
      "in_reply_to_id" : 748868349,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tCJHr",
      "original_commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "original_line" : 525,
      "original_position" : 160,
      "original_start_line" : 524,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 814216597,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755536363/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-11-23T22:03:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755536363",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755536456"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755536456"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No, changed to just `return result`.",
      "commit_id" : "4f292092d5ad399d274159716f4c2550d5301167",
      "created_at" : "2021-11-23T22:03:41Z",
      "diff_hunk" : "@@ -156,25 +153,22 @@ bool SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selectio\n \n     // Check for solution\n     if (best_selection.empty()) {\n-        return false;\n+        return std::nullopt;\n     }\n \n     // Set output set\n-    value_ret = 0;\n     for (size_t i = 0; i < best_selection.size(); ++i) {\n         if (best_selection.at(i)) {\n-            util::insert(out_set, utxo_pool.at(i).m_outputs);\n-            value_ret += utxo_pool.at(i).m_value;\n+            result.AddInput(utxo_pool.at(i));\n         }\n     }\n \n-    return true;\n+    return std::make_optional(result);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755536456",
      "id" : 755536456,
      "in_reply_to_id" : 748870402,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tCJJI",
      "original_commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "original_line" : 166,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.cpp",
      "position" : null,
      "pull_request_review_id" : 814216732,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755536456/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-23T22:03:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755536456",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755536553"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755536553"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "4f292092d5ad399d274159716f4c2550d5301167",
      "created_at" : "2021-11-23T22:03:52Z",
      "diff_hunk" : "@@ -373,76 +373,72 @@ std::vector<OutputGroup> GroupOutputs(const CWallet& wallet, const std::vector<C\n     return groups_out;\n }\n \n-bool AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,\n-                                 std::set<CInputCoin>& setCoinsRet, CAmount& nValueRet, const CoinSelectionParams& coin_selection_params)\n+std::optional<SelectionResult> AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,\n+                               const CoinSelectionParams& coin_selection_params)\n {\n-    setCoinsRet.clear();\n-    nValueRet = 0;\n-    // Vector of results for use with waste calculation\n-    // In order: calculated waste, selected inputs, selected input value (sum of input values)\n-    // TODO: Use a struct representing the selection result\n-    std::vector<std::tuple<CAmount, std::set<CInputCoin>, CAmount>> results;\n+    // Vector of result and waste pairs. We will choose the best one based on waste.\n+    std::vector<std::pair<SelectionResult, CAmount>> results;\n \n     // Note that unlike KnapsackSolver, we do not include the fee for creating a change output as BnB will not create a change output.\n     std::vector<OutputGroup> positive_groups = GroupOutputs(wallet, coins, coin_selection_params, eligibility_filter, true /* positive_only */);\n-    std::set<CInputCoin> bnb_coins;\n-    CAmount bnb_value;\n-    if (SelectCoinsBnB(positive_groups, nTargetValue, coin_selection_params.m_cost_of_change, bnb_coins, bnb_value)) {\n-        const auto waste = GetSelectionWaste(bnb_coins, /* cost of change */ CAmount(0), nTargetValue, !coin_selection_params.m_subtract_fee_outputs);\n-        results.emplace_back(std::make_tuple(waste, std::move(bnb_coins), bnb_value));\n+    std::optional<SelectionResult> bnb_result = SelectCoinsBnB(positive_groups, nTargetValue, coin_selection_params.m_cost_of_change);\n+    if (bnb_result) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755536553",
      "id" : 755536553,
      "in_reply_to_id" : 748870890,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tCJKp",
      "original_commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "original_line" : 385,
      "original_position" : 26,
      "original_start_line" : 384,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 814216858,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755536553/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-11-23T22:03:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755536553",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755537255"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755537255"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I didn't want to always be computing waste every time, especially because we may not have access to information such as the cost of change. So the approach I've done for this is to have a function which computes and stores the waste inside of `SelectionResult`, and then `operator<` will use that when doing the comparison.",
      "commit_id" : "4f292092d5ad399d274159716f4c2550d5301167",
      "created_at" : "2021-11-23T22:05:17Z",
      "diff_hunk" : "@@ -373,76 +373,72 @@ std::vector<OutputGroup> GroupOutputs(const CWallet& wallet, const std::vector<C\n     return groups_out;\n }\n \n-bool AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,\n-                                 std::set<CInputCoin>& setCoinsRet, CAmount& nValueRet, const CoinSelectionParams& coin_selection_params)\n+std::optional<SelectionResult> AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,\n+                               const CoinSelectionParams& coin_selection_params)\n {\n-    setCoinsRet.clear();\n-    nValueRet = 0;\n-    // Vector of results for use with waste calculation\n-    // In order: calculated waste, selected inputs, selected input value (sum of input values)\n-    // TODO: Use a struct representing the selection result\n-    std::vector<std::tuple<CAmount, std::set<CInputCoin>, CAmount>> results;\n+    // Vector of result and waste pairs. We will choose the best one based on waste.\n+    std::vector<std::pair<SelectionResult, CAmount>> results;\n \n     // Note that unlike KnapsackSolver, we do not include the fee for creating a change output as BnB will not create a change output.\n     std::vector<OutputGroup> positive_groups = GroupOutputs(wallet, coins, coin_selection_params, eligibility_filter, true /* positive_only */);\n-    std::set<CInputCoin> bnb_coins;\n-    CAmount bnb_value;\n-    if (SelectCoinsBnB(positive_groups, nTargetValue, coin_selection_params.m_cost_of_change, bnb_coins, bnb_value)) {\n-        const auto waste = GetSelectionWaste(bnb_coins, /* cost of change */ CAmount(0), nTargetValue, !coin_selection_params.m_subtract_fee_outputs);\n-        results.emplace_back(std::make_tuple(waste, std::move(bnb_coins), bnb_value));\n+    std::optional<SelectionResult> bnb_result = SelectCoinsBnB(positive_groups, nTargetValue, coin_selection_params.m_cost_of_change);\n+    if (bnb_result) {\n+        results.push_back(std::make_pair(*bnb_result, bnb_result->GetWaste(CAmount(0))));\n     }\n \n     // The knapsack solver has some legacy behavior where it will spend dust outputs. We retain this behavior, so don't filter for positive only here.\n     std::vector<OutputGroup> all_groups = GroupOutputs(wallet, coins, coin_selection_params, eligibility_filter, false /* positive_only */);\n     // While nTargetValue includes the transaction fees for non-input things, it does not include the fee for creating a change output.\n     // So we need to include that for KnapsackSolver as well, as we are expecting to create a change output.\n-    std::set<CInputCoin> knapsack_coins;\n-    CAmount knapsack_value;\n-    if (KnapsackSolver(nTargetValue + coin_selection_params.m_change_fee, all_groups, knapsack_coins, knapsack_value)) {\n-        const auto waste = GetSelectionWaste(knapsack_coins, coin_selection_params.m_cost_of_change, nTargetValue + coin_selection_params.m_change_fee, !coin_selection_params.m_subtract_fee_outputs);\n-        results.emplace_back(std::make_tuple(waste, std::move(knapsack_coins), knapsack_value));\n+    std::optional<SelectionResult> knapsack_result = KnapsackSolver(all_groups, nTargetValue + coin_selection_params.m_change_fee);\n+    if (knapsack_result) {\n+        results.push_back(std::make_pair(*knapsack_result, knapsack_result->GetWaste(coin_selection_params.m_cost_of_change)));\n     }\n \n     // We include the minimum final change for SRD as we do want to avoid making really small change.\n     // KnapsackSolver does not need this because it includes MIN_CHANGE internally.\n     const CAmount srd_target = nTargetValue + coin_selection_params.m_change_fee + MIN_FINAL_CHANGE;\n     auto srd_result = SelectCoinsSRD(positive_groups, srd_target);\n     if (srd_result != std::nullopt) {\n-        const auto waste = GetSelectionWaste(srd_result->first, coin_selection_params.m_cost_of_change, srd_target, !coin_selection_params.m_subtract_fee_outputs);\n-        results.emplace_back(std::make_tuple(waste, std::move(srd_result->first), srd_result->second));\n+        results.push_back(std::make_pair(*srd_result, srd_result->GetWaste(coin_selection_params.m_cost_of_change)));\n     }\n \n     if (results.size() == 0) {\n         // No solution found\n-        return false;\n+        return std::nullopt;\n     }\n \n     // Choose the result with the least waste\n     // If the waste is the same, choose the one which spends more inputs.\n-    const auto& best_result = std::min_element(results.begin(), results.end(), [](const auto& a, const auto& b) {\n-        return std::get<0>(a) < std::get<0>(b) || (std::get<0>(a) == std::get<0>(b) && std::get<1>(a).size() > std::get<1>(b).size());\n+    auto [best_result, waste] = *std::min_element(results.begin(), results.end(), [](const auto& a, const auto& b){\n+        const auto [a_result, a_waste] = a;\n+        const auto [b_result, b_waste] = b;\n+        return a_waste < b_waste || (a_waste == b_waste && a_result.m_selected_inputs.size() > b_result.m_selected_inputs.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755537255",
      "id" : 755537255,
      "in_reply_to_id" : 748870994,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tCJVn",
      "original_commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "original_line" : 416,
      "original_position" : 67,
      "original_start_line" : 413,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 814217814,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755537255/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-11-23T22:05:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755537255",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755537550"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755537550"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've added `GetInputSet` to just return `m_selected_inputs` and changed this to be `GetShuffledInputVector`.",
      "commit_id" : "4f292092d5ad399d274159716f4c2550d5301167",
      "created_at" : "2021-11-23T22:05:44Z",
      "diff_hunk" : "@@ -395,3 +387,30 @@ CAmount GetSelectionWaste(const std::set<CInputCoin>& inputs, CAmount change_cos\n \n     return waste;\n }\n+\n+CAmount SelectionResult::GetSelectedValue() const\n+{\n+    CAmount ret = 0;\n+    for (const auto& coin : m_selected_inputs) {\n+        ret += coin.txout.nValue;\n+    }\n+    return ret;\n+}\n+\n+void SelectionResult::Clear()\n+{\n+    m_selected_inputs.clear();\n+}\n+\n+void SelectionResult::AddInput(const OutputGroup& group)\n+{\n+    util::insert(m_selected_inputs, group.m_outputs);\n+    m_use_effective = !group.m_subtract_fee_outputs;\n+}\n+\n+std::vector<CInputCoin> SelectionResult::GetInputVector() const\n+{\n+    std::vector<CInputCoin> coins(m_selected_inputs.begin(), m_selected_inputs.end());\n+    Shuffle(coins.begin(), coins.end(), FastRandomContext());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755537550",
      "id" : 755537550,
      "in_reply_to_id" : 755390185,
      "line" : 425,
      "node_id" : "PRRC_kwDOABII584tCJaO",
      "original_commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "original_line" : 425,
      "original_position" : 187,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.cpp",
      "position" : 191,
      "pull_request_review_id" : 814218152,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755537550/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-23T22:05:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755537550",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755537591"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755537591"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "4f292092d5ad399d274159716f4c2550d5301167",
      "created_at" : "2021-11-23T22:05:51Z",
      "diff_hunk" : "@@ -369,6 +356,11 @@ CAmount OutputGroup::GetSelectionAmount() const\n     return m_subtract_fee_outputs ? m_value : effective_value;\n }\n \n+CAmount SelectionResult::GetWaste(CAmount change_cost) const\n+{\n+    return GetSelectionWaste(m_selected_inputs, change_cost, m_target, m_use_effective);\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755537591",
      "id" : 755537591,
      "in_reply_to_id" : 755390977,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tCJa3",
      "original_commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "original_line" : 362,
      "original_position" : 154,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.cpp",
      "position" : null,
      "pull_request_review_id" : 814218231,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755537591/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-23T22:05:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755537591",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755537641"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755537641"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "4f292092d5ad399d274159716f4c2550d5301167",
      "created_at" : "2021-11-23T22:05:57Z",
      "diff_hunk" : "@@ -81,10 +84,30 @@ static void add_coin(std::vector<COutput>& coins, CWallet& wallet, const CAmount\n     coins.push_back(output);\n }\n \n-static bool equal_sets(CoinSet a, CoinSet b)\n+/** Check if SelectionResult a is equivalent to SelectionResult b.\n+ * Equivalent means same input values, but maybe different inputs (i.e. same value, different prevout) */\n+bool EquivalentResult(const SelectionResult& a, const SelectionResult& b)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755537641",
      "id" : 755537641,
      "in_reply_to_id" : 755393639,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tCJbp",
      "original_commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "original_line" : 89,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 814218290,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755537641/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-23T22:05:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755537641",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755537859"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755537859"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I had intended to use it in the tests, and with the changes to make `m_selected_inputs` private, it is now being used by those tests.",
      "commit_id" : "4f292092d5ad399d274159716f4c2550d5301167",
      "created_at" : "2021-11-23T22:06:22Z",
      "diff_hunk" : "@@ -395,3 +387,30 @@ CAmount GetSelectionWaste(const std::set<CInputCoin>& inputs, CAmount change_cos\n \n     return waste;\n }\n+\n+CAmount SelectionResult::GetSelectedValue() const\n+{\n+    CAmount ret = 0;\n+    for (const auto& coin : m_selected_inputs) {\n+        ret += coin.txout.nValue;\n+    }\n+    return ret;\n+}\n+\n+void SelectionResult::Clear()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755537859",
      "id" : 755537859,
      "in_reply_to_id" : 755398596,
      "line" : 406,
      "node_id" : "PRRC_kwDOABII584tCJfD",
      "original_commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "original_line" : 406,
      "original_position" : 173,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.cpp",
      "position" : 172,
      "pull_request_review_id" : 814218575,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755537859/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-23T22:06:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755537859",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r756925836"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/756925836"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks!",
      "commit_id" : "e142d9af81c502a4694565ee6eef7b87ca1c0387",
      "created_at" : "2021-11-25T14:14:03Z",
      "diff_hunk" : "@@ -395,3 +387,30 @@ CAmount GetSelectionWaste(const std::set<CInputCoin>& inputs, CAmount change_cos\n \n     return waste;\n }\n+\n+CAmount SelectionResult::GetSelectedValue() const\n+{\n+    CAmount ret = 0;\n+    for (const auto& coin : m_selected_inputs) {\n+        ret += coin.txout.nValue;\n+    }\n+    return ret;\n+}\n+\n+void SelectionResult::Clear()\n+{\n+    m_selected_inputs.clear();\n+}\n+\n+void SelectionResult::AddInput(const OutputGroup& group)\n+{\n+    util::insert(m_selected_inputs, group.m_outputs);\n+    m_use_effective = !group.m_subtract_fee_outputs;\n+}\n+\n+std::vector<CInputCoin> SelectionResult::GetInputVector() const\n+{\n+    std::vector<CInputCoin> coins(m_selected_inputs.begin(), m_selected_inputs.end());\n+    Shuffle(coins.begin(), coins.end(), FastRandomContext());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r756925836",
      "id" : 756925836,
      "in_reply_to_id" : 755390185,
      "line" : 425,
      "node_id" : "PRRC_kwDOABII584tHcWM",
      "original_commit_id" : "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
      "original_line" : 425,
      "original_position" : 187,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.cpp",
      "position" : 191,
      "pull_request_review_id" : 816037750,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/756925836/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-25T14:14:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/756925836",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r761190815"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/761190815"
         }
      },
      "author_association" : "MEMBER",
      "body" : "- It looks like `CoinsSelectionParams&` can be const\r\n- Doc comment above needs to be updated, it refers to arguments that no longer exist (applies to multiple functions)",
      "commit_id" : "e142d9af81c502a4694565ee6eef7b87ca1c0387",
      "created_at" : "2021-12-02T15:13:45Z",
      "diff_hunk" : "@@ -122,8 +122,8 @@ bool AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const\n  * param@[out]  nValueRet           Total value of selected coins including pre-selected ones\n  *                                  from coin_control and Coin Selection if successful.\n  */\n-bool SelectCoins(const CWallet& wallet, const std::vector<COutput>& vAvailableCoins, const CAmount& nTargetValue, std::set<CInputCoin>& setCoinsRet, CAmount& nValueRet,\n-                 const CCoinControl& coin_control, CoinSelectionParams& coin_selection_params) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet);\n+std::optional<SelectionResult> SelectCoins(const CWallet& wallet, const std::vector<COutput>& vAvailableCoins, const CAmount& nTargetValue, const CCoinControl& coin_control,\n+                 CoinSelectionParams& coin_selection_params) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r761190815",
      "id" : 761190815,
      "line" : 126,
      "node_id" : "PRRC_kwDOABII584tXtmf",
      "original_commit_id" : "e142d9af81c502a4694565ee6eef7b87ca1c0387",
      "original_line" : 126,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/wallet/spend.h",
      "position" : 18,
      "pull_request_review_id" : 821637958,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/761190815/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-02T15:14:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/761190815",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK e142d9af81c502a4694565ee6eef7b87ca1c0387 \r\nSeems pretty close to merge, found some last minute nits (sorry).",
      "created_at" : "2021-12-02T15:16:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#issuecomment-984722508",
      "id" : 984722508,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22019",
      "node_id" : "IC_kwDOABII5846saxM",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/984722508/reactions"
      },
      "updated_at" : "2021-12-02T15:16:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/984722508",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r761238656"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/761238656"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In 1b1ad425d6b2ca951e0a7e6096819fc5e468af4b:\r\n\r\nWould it be better if, when waste is `nullopt`, calculate it? The `*m_waste` would throw an exception if `m_waste == std::nullopt`, so the `Assume` doesn't do much.",
      "commit_id" : "e142d9af81c502a4694565ee6eef7b87ca1c0387",
      "created_at" : "2021-12-02T16:01:22Z",
      "diff_hunk" : "@@ -395,3 +395,53 @@ CAmount GetSelectionWaste(const std::set<CInputCoin>& inputs, CAmount change_cos\n \n     return waste;\n }\n+\n+void SelectionResult::ComputeAndSetWaste(CAmount change_cost)\n+{\n+    m_waste = GetSelectionWaste(m_selected_inputs, change_cost, m_target, m_use_effective);\n+}\n+\n+CAmount SelectionResult::GetWaste() const\n+{\n+    Assume(m_waste != std::nullopt);\n+    return *m_waste;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r761238656",
      "id" : 761238656,
      "line" : 394,
      "node_id" : "PRRC_kwDOABII584tX5SA",
      "original_commit_id" : "1b1ad425d6b2ca951e0a7e6096819fc5e468af4b",
      "original_line" : 407,
      "original_position" : 13,
      "original_start_line" : 406,
      "path" : "src/wallet/coinselection.cpp",
      "position" : 160,
      "pull_request_review_id" : 821704423,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/761238656/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 393,
      "start_side" : "RIGHT",
      "updated_at" : "2021-12-02T16:47:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/761238656",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r761239517"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/761239517"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In 1b1ad425d6b2ca951e0a7e6096819fc5e468af4b\r\n```suggestion\r\n    return std::accumulate(m_selected_inputs.cbegin(), m_selected_inputs.cend(), CAmount{0}, [](CAmount sum, const auto& coin) { return sum + coin.txout.nValue;});\r\n```",
      "commit_id" : "e142d9af81c502a4694565ee6eef7b87ca1c0387",
      "created_at" : "2021-12-02T16:02:19Z",
      "diff_hunk" : "@@ -395,3 +395,53 @@ CAmount GetSelectionWaste(const std::set<CInputCoin>& inputs, CAmount change_cos\n \n     return waste;\n }\n+\n+void SelectionResult::ComputeAndSetWaste(CAmount change_cost)\n+{\n+    m_waste = GetSelectionWaste(m_selected_inputs, change_cost, m_target, m_use_effective);\n+}\n+\n+CAmount SelectionResult::GetWaste() const\n+{\n+    Assume(m_waste != std::nullopt);\n+    return *m_waste;\n+}\n+\n+CAmount SelectionResult::GetSelectedValue() const\n+{\n+    CAmount ret = 0;\n+    for (const auto& coin : m_selected_inputs) {\n+        ret += coin.txout.nValue;\n+    }\n+    return ret;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r761239517",
      "id" : 761239517,
      "line" : 403,
      "node_id" : "PRRC_kwDOABII584tX5fd",
      "original_commit_id" : "1b1ad425d6b2ca951e0a7e6096819fc5e468af4b",
      "original_line" : 416,
      "original_position" : 22,
      "original_start_line" : 412,
      "path" : "src/wallet/coinselection.cpp",
      "position" : 169,
      "pull_request_review_id" : 821704423,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/761239517/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 399,
      "start_side" : "RIGHT",
      "updated_at" : "2021-12-02T16:47:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/761239517",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r761251539"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/761251539"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In 22e3b5b63c46d2e2dc601a8ca061823e21ab7151: Why delete alias?\r\n```suggestion\r\n    std::pair<CoinSet::iterator, CoinSet::iterator> ret = std::mismatch(a.GetInputSet().begin(), a.GetInputSet().end(), b.GetInputSet().begin());\r\n    return ret.first == a.GetInputSet().end() && ret.second == b.GetInputSet().end();\r\n```",
      "commit_id" : "e142d9af81c502a4694565ee6eef7b87ca1c0387",
      "created_at" : "2021-12-02T16:15:17Z",
      "diff_hunk" : "@@ -115,10 +115,11 @@ static bool EquivalentResult(const SelectionResult& a, const SelectionResult& b)\n     return ret.first == a_amts.end() && ret.second == b_amts.end();\n }\n \n-static bool equal_sets(CoinSet a, CoinSet b)\n+/** Check if this selection is equal to another one. Equal means same inputs (i.e same value and prevout) */\n+static bool EqualResult(const SelectionResult& a, const SelectionResult& b)\n {\n-    std::pair<CoinSet::iterator, CoinSet::iterator> ret = mismatch(a.begin(), a.end(), b.begin());\n-    return ret.first == a.end() && ret.second == b.end();\n+    std::pair<std::set<CInputCoin>::iterator, std::set<CInputCoin>::iterator> ret = std::mismatch(a.GetInputSet().begin(), a.GetInputSet().end(), b.GetInputSet().begin());\n+    return ret.first == a.GetInputSet().end() && ret.second == b.GetInputSet().end();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r761251539",
      "id" : 761251539,
      "line" : 122,
      "node_id" : "PRRC_kwDOABII584tX8bT",
      "original_commit_id" : "22e3b5b63c46d2e2dc601a8ca061823e21ab7151",
      "original_line" : 122,
      "original_position" : 11,
      "original_start_line" : 121,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : 82,
      "pull_request_review_id" : 821704423,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/761251539/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 121,
      "start_side" : "RIGHT",
      "updated_at" : "2021-12-02T16:47:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/761251539",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r761257373"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/761257373"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "0211023c256dd5fde9ff82e832305c8b3c981d89:\r\n\r\nReally nice that it's just `SelectionResults` instead of tuples now :D but the comment needs to be updated",
      "commit_id" : "e142d9af81c502a4694565ee6eef7b87ca1c0387",
      "created_at" : "2021-12-02T16:21:31Z",
      "diff_hunk" : "@@ -378,16 +378,14 @@ bool AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const\n {\n     setCoinsRet.clear();\n     nValueRet = 0;\n-    // Vector of results for use with waste calculation\n-    // In order: calculated waste, selected inputs, selected input value (sum of input values)\n-    // TODO: Use a struct representing the selection result\n-    std::vector<std::tuple<CAmount, std::set<CInputCoin>, CAmount>> results;\n+    // Vector of result and waste pairs. We will choose the best one based on waste.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r761257373",
      "id" : 761257373,
      "line" : 379,
      "node_id" : "PRRC_kwDOABII584tX92d",
      "original_commit_id" : "0211023c256dd5fde9ff82e832305c8b3c981d89",
      "original_line" : 381,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 15,
      "pull_request_review_id" : 821704423,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/761257373/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-02T16:47:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/761257373",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r761263907"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/761263907"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "in 0211023c256dd5fde9ff82e832305c8b3c981d89:\r\n\r\nwhy not keep `emplace_back`?",
      "commit_id" : "e142d9af81c502a4694565ee6eef7b87ca1c0387",
      "created_at" : "2021-12-02T16:28:29Z",
      "diff_hunk" : "@@ -378,16 +378,14 @@ bool AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const\n {\n     setCoinsRet.clear();\n     nValueRet = 0;\n-    // Vector of results for use with waste calculation\n-    // In order: calculated waste, selected inputs, selected input value (sum of input values)\n-    // TODO: Use a struct representing the selection result\n-    std::vector<std::tuple<CAmount, std::set<CInputCoin>, CAmount>> results;\n+    // Vector of result and waste pairs. We will choose the best one based on waste.\n+    std::vector<SelectionResult> results;\n \n     // Note that unlike KnapsackSolver, we do not include the fee for creating a change output as BnB will not create a change output.\n     std::vector<OutputGroup> positive_groups = GroupOutputs(wallet, coins, coin_selection_params, eligibility_filter, true /* positive_only */);\n     if (auto bnb_result{SelectCoinsBnB(positive_groups, nTargetValue, coin_selection_params.m_cost_of_change)}) {\n         bnb_result->ComputeAndSetWaste(CAmount(0));\n-        results.emplace_back(std::make_tuple(bnb_result->GetWaste(), bnb_result->GetInputSet(), bnb_result->GetSelectedValue()));\n+        results.push_back(*bnb_result);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r761263907",
      "id" : 761263907,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tX_cj",
      "original_commit_id" : "0211023c256dd5fde9ff82e832305c8b3c981d89",
      "original_line" : 388,
      "original_position" : 16,
      "original_start_line" : 390,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 821704423,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/761263907/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "LEFT",
      "updated_at" : "2021-12-02T16:47:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/761263907",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r761265233"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/761265233"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "in 0211023c256dd5fde9ff82e832305c8b3c981d89: try not to make a copy of the result",
      "commit_id" : "e142d9af81c502a4694565ee6eef7b87ca1c0387",
      "created_at" : "2021-12-02T16:29:53Z",
      "diff_hunk" : "@@ -414,11 +412,9 @@ bool AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const\n \n     // Choose the result with the least waste\n     // If the waste is the same, choose the one which spends more inputs.\n-    const auto& best_result = std::min_element(results.begin(), results.end(), [](const auto& a, const auto& b) {\n-        return std::get<0>(a) < std::get<0>(b) || (std::get<0>(a) == std::get<0>(b) && std::get<1>(a).size() > std::get<1>(b).size());\n-    });\n-    setCoinsRet = std::get<1>(*best_result);\n-    nValueRet = std::get<2>(*best_result);\n+    auto best_result = *std::min_element(results.begin(), results.end());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r761265233",
      "id" : 761265233,
      "line" : 413,
      "node_id" : "PRRC_kwDOABII584tX_xR",
      "original_commit_id" : "0211023c256dd5fde9ff82e832305c8b3c981d89",
      "original_line" : 415,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 70,
      "pull_request_review_id" : 821704423,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/761265233/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-02T16:47:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/761265233",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r761274888"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/761274888"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In 1b1ad425d6b2ca951e0a7e6096819fc5e468af4b: [[nodiscard]] the `GetWaste()` and `GetSelectedValue()` functions?",
      "commit_id" : "e142d9af81c502a4694565ee6eef7b87ca1c0387",
      "created_at" : "2021-12-02T16:40:31Z",
      "diff_hunk" : "@@ -395,3 +382,54 @@ CAmount GetSelectionWaste(const std::set<CInputCoin>& inputs, CAmount change_cos\n \n     return waste;\n }\n+\n+void SelectionResult::ComputeAndSetWaste(CAmount change_cost)\n+{\n+    m_waste = GetSelectionWaste(m_selected_inputs, change_cost, m_target, m_use_effective);\n+}\n+\n+CAmount SelectionResult::GetWaste() const\n+{\n+    Assume(m_waste != std::nullopt);\n+    return *m_waste;\n+}\n+\n+CAmount SelectionResult::GetSelectedValue() const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r761274888",
      "id" : 761274888,
      "line" : 397,
      "node_id" : "PRRC_kwDOABII584tYCII",
      "original_commit_id" : "e142d9af81c502a4694565ee6eef7b87ca1c0387",
      "original_line" : 397,
      "original_position" : 163,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.cpp",
      "position" : 163,
      "pull_request_review_id" : 821704423,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/761274888/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-02T16:47:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/761274888",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r761276397"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/761276397"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In 1b1ad42\r\nShould this function also clear `m_waste`?",
      "commit_id" : "e142d9af81c502a4694565ee6eef7b87ca1c0387",
      "created_at" : "2021-12-02T16:42:13Z",
      "diff_hunk" : "@@ -395,3 +382,54 @@ CAmount GetSelectionWaste(const std::set<CInputCoin>& inputs, CAmount change_cos\n \n     return waste;\n }\n+\n+void SelectionResult::ComputeAndSetWaste(CAmount change_cost)\n+{\n+    m_waste = GetSelectionWaste(m_selected_inputs, change_cost, m_target, m_use_effective);\n+}\n+\n+CAmount SelectionResult::GetWaste() const\n+{\n+    Assume(m_waste != std::nullopt);\n+    return *m_waste;\n+}\n+\n+CAmount SelectionResult::GetSelectedValue() const\n+{\n+    CAmount ret = 0;\n+    for (const auto& coin : m_selected_inputs) {\n+        ret += coin.txout.nValue;\n+    }\n+    return ret;\n+}\n+\n+void SelectionResult::Clear()\n+{\n+    m_selected_inputs.clear();\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r761276397",
      "id" : 761276397,
      "line" : 409,
      "node_id" : "PRRC_kwDOABII584tYCft",
      "original_commit_id" : "e142d9af81c502a4694565ee6eef7b87ca1c0387",
      "original_line" : 409,
      "original_position" : 175,
      "original_start_line" : 406,
      "path" : "src/wallet/coinselection.cpp",
      "position" : 175,
      "pull_request_review_id" : 821704423,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/761276397/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 406,
      "start_side" : "RIGHT",
      "updated_at" : "2021-12-02T16:47:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/761276397",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r762599036"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762599036"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The cost of change is not known to `SelectionResult` so it cannot be calculated.",
      "commit_id" : "05300c14392facf38330eb4fcd8e695a838b76f3",
      "created_at" : "2021-12-05T18:34:20Z",
      "diff_hunk" : "@@ -395,3 +395,53 @@ CAmount GetSelectionWaste(const std::set<CInputCoin>& inputs, CAmount change_cos\n \n     return waste;\n }\n+\n+void SelectionResult::ComputeAndSetWaste(CAmount change_cost)\n+{\n+    m_waste = GetSelectionWaste(m_selected_inputs, change_cost, m_target, m_use_effective);\n+}\n+\n+CAmount SelectionResult::GetWaste() const\n+{\n+    Assume(m_waste != std::nullopt);\n+    return *m_waste;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r762599036",
      "id" : 762599036,
      "in_reply_to_id" : 761238656,
      "line" : 394,
      "node_id" : "PRRC_kwDOABII584tdFZ8",
      "original_commit_id" : "1b1ad425d6b2ca951e0a7e6096819fc5e468af4b",
      "original_line" : 394,
      "original_position" : 13,
      "original_start_line" : 406,
      "path" : "src/wallet/coinselection.cpp",
      "position" : 160,
      "pull_request_review_id" : 823420481,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762599036/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 393,
      "start_side" : "RIGHT",
      "updated_at" : "2021-12-05T18:34:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762599036",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r762599778"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762599778"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ah right ð¤¦ ",
      "commit_id" : "05300c14392facf38330eb4fcd8e695a838b76f3",
      "created_at" : "2021-12-05T18:41:32Z",
      "diff_hunk" : "@@ -395,3 +395,53 @@ CAmount GetSelectionWaste(const std::set<CInputCoin>& inputs, CAmount change_cos\n \n     return waste;\n }\n+\n+void SelectionResult::ComputeAndSetWaste(CAmount change_cost)\n+{\n+    m_waste = GetSelectionWaste(m_selected_inputs, change_cost, m_target, m_use_effective);\n+}\n+\n+CAmount SelectionResult::GetWaste() const\n+{\n+    Assume(m_waste != std::nullopt);\n+    return *m_waste;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r762599778",
      "id" : 762599778,
      "in_reply_to_id" : 761238656,
      "line" : 394,
      "node_id" : "PRRC_kwDOABII584tdFli",
      "original_commit_id" : "1b1ad425d6b2ca951e0a7e6096819fc5e468af4b",
      "original_line" : 394,
      "original_position" : 13,
      "original_start_line" : 406,
      "path" : "src/wallet/coinselection.cpp",
      "position" : 160,
      "pull_request_review_id" : 823421016,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762599778/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 393,
      "start_side" : "RIGHT",
      "updated_at" : "2021-12-05T18:41:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762599778",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r762599876"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762599876"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The result is already constructed.",
      "commit_id" : "05300c14392facf38330eb4fcd8e695a838b76f3",
      "created_at" : "2021-12-05T18:42:28Z",
      "diff_hunk" : "@@ -378,16 +378,14 @@ bool AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const\n {\n     setCoinsRet.clear();\n     nValueRet = 0;\n-    // Vector of results for use with waste calculation\n-    // In order: calculated waste, selected inputs, selected input value (sum of input values)\n-    // TODO: Use a struct representing the selection result\n-    std::vector<std::tuple<CAmount, std::set<CInputCoin>, CAmount>> results;\n+    // Vector of result and waste pairs. We will choose the best one based on waste.\n+    std::vector<SelectionResult> results;\n \n     // Note that unlike KnapsackSolver, we do not include the fee for creating a change output as BnB will not create a change output.\n     std::vector<OutputGroup> positive_groups = GroupOutputs(wallet, coins, coin_selection_params, eligibility_filter, true /* positive_only */);\n     if (auto bnb_result{SelectCoinsBnB(positive_groups, nTargetValue, coin_selection_params.m_cost_of_change)}) {\n         bnb_result->ComputeAndSetWaste(CAmount(0));\n-        results.emplace_back(std::make_tuple(bnb_result->GetWaste(), bnb_result->GetInputSet(), bnb_result->GetSelectedValue()));\n+        results.push_back(*bnb_result);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r762599876",
      "id" : 762599876,
      "in_reply_to_id" : 761263907,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tdFnE",
      "original_commit_id" : "0211023c256dd5fde9ff82e832305c8b3c981d89",
      "original_line" : 386,
      "original_position" : 16,
      "original_start_line" : 390,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 823421091,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762599876/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "LEFT",
      "updated_at" : "2021-12-05T18:42:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762599876",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r762600650"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762600650"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done both.",
      "commit_id" : "05300c14392facf38330eb4fcd8e695a838b76f3",
      "created_at" : "2021-12-05T18:49:51Z",
      "diff_hunk" : "@@ -122,8 +122,8 @@ bool AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const\n  * param@[out]  nValueRet           Total value of selected coins including pre-selected ones\n  *                                  from coin_control and Coin Selection if successful.\n  */\n-bool SelectCoins(const CWallet& wallet, const std::vector<COutput>& vAvailableCoins, const CAmount& nTargetValue, std::set<CInputCoin>& setCoinsRet, CAmount& nValueRet,\n-                 const CCoinControl& coin_control, CoinSelectionParams& coin_selection_params) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet);\n+std::optional<SelectionResult> SelectCoins(const CWallet& wallet, const std::vector<COutput>& vAvailableCoins, const CAmount& nTargetValue, const CCoinControl& coin_control,\n+                 CoinSelectionParams& coin_selection_params) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r762600650",
      "id" : 762600650,
      "in_reply_to_id" : 761190815,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tdFzK",
      "original_commit_id" : "e142d9af81c502a4694565ee6eef7b87ca1c0387",
      "original_line" : 126,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/wallet/spend.h",
      "position" : null,
      "pull_request_review_id" : 823421642,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762600650/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-05T18:49:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762600650",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r762600663"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762600663"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "05300c14392facf38330eb4fcd8e695a838b76f3",
      "created_at" : "2021-12-05T18:49:59Z",
      "diff_hunk" : "@@ -395,3 +395,53 @@ CAmount GetSelectionWaste(const std::set<CInputCoin>& inputs, CAmount change_cos\n \n     return waste;\n }\n+\n+void SelectionResult::ComputeAndSetWaste(CAmount change_cost)\n+{\n+    m_waste = GetSelectionWaste(m_selected_inputs, change_cost, m_target, m_use_effective);\n+}\n+\n+CAmount SelectionResult::GetWaste() const\n+{\n+    Assume(m_waste != std::nullopt);\n+    return *m_waste;\n+}\n+\n+CAmount SelectionResult::GetSelectedValue() const\n+{\n+    CAmount ret = 0;\n+    for (const auto& coin : m_selected_inputs) {\n+        ret += coin.txout.nValue;\n+    }\n+    return ret;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r762600663",
      "id" : 762600663,
      "in_reply_to_id" : 761239517,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tdFzX",
      "original_commit_id" : "1b1ad425d6b2ca951e0a7e6096819fc5e468af4b",
      "original_line" : 416,
      "original_position" : 22,
      "original_start_line" : 412,
      "path" : "src/wallet/coinselection.cpp",
      "position" : null,
      "pull_request_review_id" : 823421653,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762600663/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-12-05T18:49:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762600663",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r762600680"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762600680"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "05300c14392facf38330eb4fcd8e695a838b76f3",
      "created_at" : "2021-12-05T18:50:04Z",
      "diff_hunk" : "@@ -115,10 +115,11 @@ static bool EquivalentResult(const SelectionResult& a, const SelectionResult& b)\n     return ret.first == a_amts.end() && ret.second == b_amts.end();\n }\n \n-static bool equal_sets(CoinSet a, CoinSet b)\n+/** Check if this selection is equal to another one. Equal means same inputs (i.e same value and prevout) */\n+static bool EqualResult(const SelectionResult& a, const SelectionResult& b)\n {\n-    std::pair<CoinSet::iterator, CoinSet::iterator> ret = mismatch(a.begin(), a.end(), b.begin());\n-    return ret.first == a.end() && ret.second == b.end();\n+    std::pair<std::set<CInputCoin>::iterator, std::set<CInputCoin>::iterator> ret = std::mismatch(a.GetInputSet().begin(), a.GetInputSet().end(), b.GetInputSet().begin());\n+    return ret.first == a.GetInputSet().end() && ret.second == b.GetInputSet().end();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r762600680",
      "id" : 762600680,
      "in_reply_to_id" : 761251539,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tdFzo",
      "original_commit_id" : "22e3b5b63c46d2e2dc601a8ca061823e21ab7151",
      "original_line" : 122,
      "original_position" : 11,
      "original_start_line" : 121,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 823421659,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762600680/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-12-05T18:50:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762600680",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r762600682"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762600682"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "05300c14392facf38330eb4fcd8e695a838b76f3",
      "created_at" : "2021-12-05T18:50:09Z",
      "diff_hunk" : "@@ -378,16 +378,14 @@ bool AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const\n {\n     setCoinsRet.clear();\n     nValueRet = 0;\n-    // Vector of results for use with waste calculation\n-    // In order: calculated waste, selected inputs, selected input value (sum of input values)\n-    // TODO: Use a struct representing the selection result\n-    std::vector<std::tuple<CAmount, std::set<CInputCoin>, CAmount>> results;\n+    // Vector of result and waste pairs. We will choose the best one based on waste.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r762600682",
      "id" : 762600682,
      "in_reply_to_id" : 761257373,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tdFzq",
      "original_commit_id" : "0211023c256dd5fde9ff82e832305c8b3c981d89",
      "original_line" : 381,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 823421663,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762600682/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-05T18:50:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762600682",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r762600703"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762600703"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Changed to `auto&`",
      "commit_id" : "05300c14392facf38330eb4fcd8e695a838b76f3",
      "created_at" : "2021-12-05T18:50:20Z",
      "diff_hunk" : "@@ -414,11 +412,9 @@ bool AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const\n \n     // Choose the result with the least waste\n     // If the waste is the same, choose the one which spends more inputs.\n-    const auto& best_result = std::min_element(results.begin(), results.end(), [](const auto& a, const auto& b) {\n-        return std::get<0>(a) < std::get<0>(b) || (std::get<0>(a) == std::get<0>(b) && std::get<1>(a).size() > std::get<1>(b).size());\n-    });\n-    setCoinsRet = std::get<1>(*best_result);\n-    nValueRet = std::get<2>(*best_result);\n+    auto best_result = *std::min_element(results.begin(), results.end());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r762600703",
      "id" : 762600703,
      "in_reply_to_id" : 761265233,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tdFz_",
      "original_commit_id" : "0211023c256dd5fde9ff82e832305c8b3c981d89",
      "original_line" : 415,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 823421677,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762600703/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-05T18:50:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762600703",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r762600705"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762600705"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "05300c14392facf38330eb4fcd8e695a838b76f3",
      "created_at" : "2021-12-05T18:50:26Z",
      "diff_hunk" : "@@ -395,3 +382,54 @@ CAmount GetSelectionWaste(const std::set<CInputCoin>& inputs, CAmount change_cos\n \n     return waste;\n }\n+\n+void SelectionResult::ComputeAndSetWaste(CAmount change_cost)\n+{\n+    m_waste = GetSelectionWaste(m_selected_inputs, change_cost, m_target, m_use_effective);\n+}\n+\n+CAmount SelectionResult::GetWaste() const\n+{\n+    Assume(m_waste != std::nullopt);\n+    return *m_waste;\n+}\n+\n+CAmount SelectionResult::GetSelectedValue() const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r762600705",
      "id" : 762600705,
      "in_reply_to_id" : 761274888,
      "line" : 397,
      "node_id" : "PRRC_kwDOABII584tdF0B",
      "original_commit_id" : "e142d9af81c502a4694565ee6eef7b87ca1c0387",
      "original_line" : 397,
      "original_position" : 163,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.cpp",
      "position" : 163,
      "pull_request_review_id" : 823421679,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762600705/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-05T18:50:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762600705",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r762600718"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762600718"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "05300c14392facf38330eb4fcd8e695a838b76f3",
      "created_at" : "2021-12-05T18:50:32Z",
      "diff_hunk" : "@@ -395,3 +382,54 @@ CAmount GetSelectionWaste(const std::set<CInputCoin>& inputs, CAmount change_cos\n \n     return waste;\n }\n+\n+void SelectionResult::ComputeAndSetWaste(CAmount change_cost)\n+{\n+    m_waste = GetSelectionWaste(m_selected_inputs, change_cost, m_target, m_use_effective);\n+}\n+\n+CAmount SelectionResult::GetWaste() const\n+{\n+    Assume(m_waste != std::nullopt);\n+    return *m_waste;\n+}\n+\n+CAmount SelectionResult::GetSelectedValue() const\n+{\n+    CAmount ret = 0;\n+    for (const auto& coin : m_selected_inputs) {\n+        ret += coin.txout.nValue;\n+    }\n+    return ret;\n+}\n+\n+void SelectionResult::Clear()\n+{\n+    m_selected_inputs.clear();\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r762600718",
      "id" : 762600718,
      "in_reply_to_id" : 761276397,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tdF0O",
      "original_commit_id" : "e142d9af81c502a4694565ee6eef7b87ca1c0387",
      "original_line" : 406,
      "original_position" : 175,
      "original_start_line" : 406,
      "path" : "src/wallet/coinselection.cpp",
      "position" : null,
      "pull_request_review_id" : 823421684,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762600718/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-12-05T18:50:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762600718",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK 05300c14392facf38330eb4fcd8e695a838b76f3",
      "created_at" : "2021-12-09T16:20:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#issuecomment-990005305",
      "id" : 990005305,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22019",
      "node_id" : "IC_kwDOABII5847Akg5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/990005305/reactions"
      },
      "updated_at" : "2021-12-09T16:20:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/990005305",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r765957658"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765957658"
         }
      },
      "author_association" : "MEMBER",
      "body" : " ð ð ",
      "commit_id" : "05300c14392facf38330eb4fcd8e695a838b76f3",
      "created_at" : "2021-12-09T16:30:43Z",
      "diff_hunk" : "@@ -373,81 +373,72 @@ std::vector<OutputGroup> GroupOutputs(const CWallet& wallet, const std::vector<C\n     return groups_out;\n }\n \n-bool AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,\n-                                 std::set<CInputCoin>& setCoinsRet, CAmount& nValueRet, const CoinSelectionParams& coin_selection_params)\n+std::optional<SelectionResult> AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,\n+                               const CoinSelectionParams& coin_selection_params)\n {\n-    setCoinsRet.clear();\n-    nValueRet = 0;\n-    // Vector of results for use with waste calculation\n-    // In order: calculated waste, selected inputs, selected input value (sum of input values)\n-    // TODO: Use a struct representing the selection result\n-    std::vector<std::tuple<CAmount, std::set<CInputCoin>, CAmount>> results;\n+    // Vector of results. We will choose the best one based on waste.\n+    std::vector<SelectionResult> results;\n \n     // Note that unlike KnapsackSolver, we do not include the fee for creating a change output as BnB will not create a change output.\n     std::vector<OutputGroup> positive_groups = GroupOutputs(wallet, coins, coin_selection_params, eligibility_filter, true /* positive_only */);\n-    std::set<CInputCoin> bnb_coins;\n-    CAmount bnb_value;\n-    if (SelectCoinsBnB(positive_groups, nTargetValue, coin_selection_params.m_cost_of_change, bnb_coins, bnb_value)) {\n-        const auto waste = GetSelectionWaste(bnb_coins, /* cost of change */ CAmount(0), nTargetValue, !coin_selection_params.m_subtract_fee_outputs);\n-        results.emplace_back(std::make_tuple(waste, std::move(bnb_coins), bnb_value));\n+    if (auto bnb_result{SelectCoinsBnB(positive_groups, nTargetValue, coin_selection_params.m_cost_of_change)}) {\n+        bnb_result->ComputeAndSetWaste(CAmount(0));\n+        results.push_back(*bnb_result);\n     }\n \n     // The knapsack solver has some legacy behavior where it will spend dust outputs. We retain this behavior, so don't filter for positive only here.\n     std::vector<OutputGroup> all_groups = GroupOutputs(wallet, coins, coin_selection_params, eligibility_filter, false /* positive_only */);\n     // While nTargetValue includes the transaction fees for non-input things, it does not include the fee for creating a change output.\n     // So we need to include that for KnapsackSolver as well, as we are expecting to create a change output.\n-    std::set<CInputCoin> knapsack_coins;\n-    CAmount knapsack_value;\n-    if (KnapsackSolver(nTargetValue + coin_selection_params.m_change_fee, all_groups, knapsack_coins, knapsack_value)) {\n-        const auto waste = GetSelectionWaste(knapsack_coins, coin_selection_params.m_cost_of_change, nTargetValue + coin_selection_params.m_change_fee, !coin_selection_params.m_subtract_fee_outputs);\n-        results.emplace_back(std::make_tuple(waste, std::move(knapsack_coins), knapsack_value));\n+    if (auto knapsack_result{KnapsackSolver(all_groups, nTargetValue + coin_selection_params.m_change_fee)}) {\n+        knapsack_result->ComputeAndSetWaste(coin_selection_params.m_cost_of_change);\n+        results.push_back(*knapsack_result);\n     }\n \n     // We include the minimum final change for SRD as we do want to avoid making really small change.\n     // KnapsackSolver does not need this because it includes MIN_CHANGE internally.\n     const CAmount srd_target = nTargetValue + coin_selection_params.m_change_fee + MIN_FINAL_CHANGE;\n-    auto srd_result = SelectCoinsSRD(positive_groups, srd_target);\n-    if (srd_result != std::nullopt) {\n-        const auto waste = GetSelectionWaste(srd_result->first, coin_selection_params.m_cost_of_change, srd_target, !coin_selection_params.m_subtract_fee_outputs);\n-        results.emplace_back(std::make_tuple(waste, std::move(srd_result->first), srd_result->second));\n+    if (auto srd_result{SelectCoinsSRD(positive_groups, srd_target)}) {\n+        srd_result->ComputeAndSetWaste(coin_selection_params.m_cost_of_change);\n+        results.push_back(*srd_result);\n     }\n \n     if (results.size() == 0) {\n         // No solution found\n-        return false;\n+        return std::nullopt;\n     }\n \n     // Choose the result with the least waste\n     // If the waste is the same, choose the one which spends more inputs.\n-    const auto& best_result = std::min_element(results.begin(), results.end(), [](const auto& a, const auto& b) {\n-        return std::get<0>(a) < std::get<0>(b) || (std::get<0>(a) == std::get<0>(b) && std::get<1>(a).size() > std::get<1>(b).size());\n-    });\n-    setCoinsRet = std::get<1>(*best_result);\n-    nValueRet = std::get<2>(*best_result);\n-    return true;\n+    auto& best_result = *std::min_element(results.begin(), results.end());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r765957658",
      "id" : 765957658,
      "line" : 413,
      "node_id" : "PRRC_kwDOABII584tp5Ya",
      "original_commit_id" : "05300c14392facf38330eb4fcd8e695a838b76f3",
      "original_line" : 413,
      "original_position" : 70,
      "original_start_line" : 422,
      "path" : "src/wallet/spend.cpp",
      "position" : 70,
      "pull_request_review_id" : 827920926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765957658/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 422,
      "start_side" : "LEFT",
      "updated_at" : "2021-12-09T16:36:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765957658",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r765989542"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765989542"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This will need to be Assert, otherwise you might run into UB, no?",
      "commit_id" : "05300c14392facf38330eb4fcd8e695a838b76f3",
      "created_at" : "2021-12-09T17:07:11Z",
      "diff_hunk" : "@@ -395,3 +382,51 @@ CAmount GetSelectionWaste(const std::set<CInputCoin>& inputs, CAmount change_cos\n \n     return waste;\n }\n+\n+void SelectionResult::ComputeAndSetWaste(CAmount change_cost)\n+{\n+    m_waste = GetSelectionWaste(m_selected_inputs, change_cost, m_target, m_use_effective);\n+}\n+\n+CAmount SelectionResult::GetWaste() const\n+{\n+    Assume(m_waste != std::nullopt);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r765989542",
      "id" : 765989542,
      "line" : 393,
      "node_id" : "PRRC_kwDOABII584tqBKm",
      "original_commit_id" : "05300c14392facf38330eb4fcd8e695a838b76f3",
      "original_line" : 393,
      "original_position" : 159,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.cpp",
      "position" : 159,
      "pull_request_review_id" : 827965335,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765989542/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-09T17:16:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765989542",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r765989922"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765989922"
         }
      },
      "author_association" : "MEMBER",
      "body" : "same",
      "commit_id" : "05300c14392facf38330eb4fcd8e695a838b76f3",
      "created_at" : "2021-12-09T17:07:40Z",
      "diff_hunk" : "@@ -395,3 +382,51 @@ CAmount GetSelectionWaste(const std::set<CInputCoin>& inputs, CAmount change_cos\n \n     return waste;\n }\n+\n+void SelectionResult::ComputeAndSetWaste(CAmount change_cost)\n+{\n+    m_waste = GetSelectionWaste(m_selected_inputs, change_cost, m_target, m_use_effective);\n+}\n+\n+CAmount SelectionResult::GetWaste() const\n+{\n+    Assume(m_waste != std::nullopt);\n+    return *m_waste;\n+}\n+\n+CAmount SelectionResult::GetSelectedValue() const\n+{\n+    return std::accumulate(m_selected_inputs.cbegin(), m_selected_inputs.cend(), CAmount{0}, [](CAmount sum, const auto& coin) { return sum + coin.txout.nValue; });\n+}\n+\n+void SelectionResult::Clear()\n+{\n+    m_selected_inputs.clear();\n+    m_waste.reset();\n+}\n+\n+void SelectionResult::AddInput(const OutputGroup& group)\n+{\n+    util::insert(m_selected_inputs, group.m_outputs);\n+    m_use_effective = !group.m_subtract_fee_outputs;\n+}\n+\n+const std::set<CInputCoin>& SelectionResult::GetInputSet() const\n+{\n+    return m_selected_inputs;\n+}\n+\n+std::vector<CInputCoin> SelectionResult::GetShuffledInputVector() const\n+{\n+    std::vector<CInputCoin> coins(m_selected_inputs.begin(), m_selected_inputs.end());\n+    Shuffle(coins.begin(), coins.end(), FastRandomContext());\n+    return coins;\n+}\n+\n+bool SelectionResult::operator<(SelectionResult other) const\n+{\n+    Assume(m_waste != std::nullopt);\n+    Assume(other.m_waste != std::nullopt);\n+    // As this operator is only used in std::min_element, we want the result that has more inputs when waste are equal.\n+    return *m_waste < *other.m_waste || (*m_waste == *other.m_waste && m_selected_inputs.size() > other.m_selected_inputs.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r765989922",
      "id" : 765989922,
      "line" : 431,
      "node_id" : "PRRC_kwDOABII584tqBQi",
      "original_commit_id" : "05300c14392facf38330eb4fcd8e695a838b76f3",
      "original_line" : 431,
      "original_position" : 197,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.cpp",
      "position" : 197,
      "pull_request_review_id" : 827965335,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765989922/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-09T17:16:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765989922",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r767773327"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/767773327"
         }
      },
      "author_association" : "MEMBER",
      "body" : "https://github.com/bitcoin/bitcoin/pull/23762",
      "commit_id" : "05300c14392facf38330eb4fcd8e695a838b76f3",
      "created_at" : "2021-12-13T13:49:32Z",
      "diff_hunk" : "@@ -395,3 +382,51 @@ CAmount GetSelectionWaste(const std::set<CInputCoin>& inputs, CAmount change_cos\n \n     return waste;\n }\n+\n+void SelectionResult::ComputeAndSetWaste(CAmount change_cost)\n+{\n+    m_waste = GetSelectionWaste(m_selected_inputs, change_cost, m_target, m_use_effective);\n+}\n+\n+CAmount SelectionResult::GetWaste() const\n+{\n+    Assume(m_waste != std::nullopt);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r767773327",
      "id" : 767773327,
      "in_reply_to_id" : 765989542,
      "line" : 393,
      "node_id" : "PRRC_kwDOABII584tw0qP",
      "original_commit_id" : "05300c14392facf38330eb4fcd8e695a838b76f3",
      "original_line" : 393,
      "original_position" : 159,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.cpp",
      "position" : 159,
      "pull_request_review_id" : 830260024,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/767773327/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-13T13:49:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/767773327",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
