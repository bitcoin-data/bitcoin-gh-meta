[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #21514 (p2p: Ignore ports on I2P addresses by vasild)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-05-24T22:03:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22043#issuecomment-847375756",
      "id" : 847375756,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22043",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg0NzM3NTc1Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-24T22:03:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/847375756",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Tested ACK. Run on signet, Fedora 34 and Ubuntu 20.x\r\n\r\n<details hidden><summary>rpc log</summary>\r\n   \r\n    [user@fedora bitcoin]$ ./src/bitcoin-cli -signet addpeeraddress x.xxx.xxx.x 38333\r\n    {\r\n      \"success\": true\r\n    }\r\n    [user@fedora bitcoin]$ ./src/bitcoin-cli -signet getnodeaddresses 0\r\n    [\r\n      {\r\n       \"time\": 1621866922,\r\n        \"services\": 1033,\r\n        \"address\": \"xxxx:xxxx:xxxx:x:xxxx:xxxx:xxxx:xxxxx\",\r\n        \"port\": 38333,\r\n        \"network\": \"ipv6\"\r\n      }\r\n    ]\r\n    [user@fedora bitcoin]$ ./src/bitcoin-cli -signet addpeeraddress SAMEADDRESS 38333\r\n    {\r\n      \"success\": false\r\n    }\r\n    [user@fedora bitcoin]$ ./src/bitcoin-cli -signet addpeeraddress \"\" 38333\r\n    {\r\n      \"success\": false\r\n    }\r\n\r\n</details> \r\n\r\n<details hidden><summary>test log</summary>\r\n\r\n    [user@fedora bitcoin]$ ./test/functional/rpc_net.py \r\n    2021-05-25T03:37:33.624000Z TestFramework (INFO): Initializing test directory /tmp/bitcoin_func_test_ulr3n_ye\r\n    2021-05-25T03:37:34.200000Z TestFramework (INFO): Test getconnectioncount\r\n    2021-05-25T03:37:34.201000Z TestFramework (INFO): Test getpeerinfo\r\n    2021-05-25T03:37:37.237000Z TestFramework (INFO): Test getnettotals\r\n    2021-05-25T03:37:37.360000Z TestFramework (INFO): Test getnetworkinfo\r\n    2021-05-25T03:37:37.511000Z TestFramework (INFO): Test getaddednodeinfo\r\n    2021-05-25T03:37:37.528000Z TestFramework (INFO): Test service flags\r\n    2021-05-25T03:37:37.697000Z TestFramework (INFO): Test getnodeaddresses\r\n    2021-05-25T03:37:43.703000Z TestFramework (INFO): Test addpeeraddress\r\n    2021-05-25T03:37:43.766000Z TestFramework (INFO): Stopping nodes\r\n    2021-05-25T03:37:43.920000Z TestFramework (INFO): Cleaning up /tmp/bitcoin_func_test_ulr3n_ye on exit\r\n    2021-05-25T03:37:43.921000Z TestFramework (INFO): Tests successful\r\n\r\n</details>",
      "created_at" : "2021-05-25T03:44:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22043#issuecomment-847506606",
      "id" : 847506606,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22043",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg0NzUwNjYwNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-25T03:44:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/847506606",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13033037?v=4",
         "events_url" : "https://api.github.com/users/reemuru/events{/privacy}",
         "followers_url" : "https://api.github.com/users/reemuru/followers",
         "following_url" : "https://api.github.com/users/reemuru/following{/other_user}",
         "gists_url" : "https://api.github.com/users/reemuru/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/reemuru",
         "id" : 13033037,
         "login" : "reemuru",
         "node_id" : "MDQ6VXNlcjEzMDMzMDM3",
         "organizations_url" : "https://api.github.com/users/reemuru/orgs",
         "received_events_url" : "https://api.github.com/users/reemuru/received_events",
         "repos_url" : "https://api.github.com/users/reemuru/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/reemuru/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/reemuru/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/reemuru"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22043#discussion_r638535703"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22043"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/638535703"
         }
      },
      "author_association" : "MEMBER",
      "body" : "could remove duplicate `CAddress` constructor\r\n\r\n```suggestion\r\n        CAddress address{{net_addr, port}, ServiceFlags{NODE_NETWORK | NODE_WITNESS}};\r\n```",
      "commit_id" : "b36e0cd1b9d361ac6f9777c09328a13e9ee923be",
      "created_at" : "2021-05-25T07:42:33Z",
      "diff_hunk" : "@@ -931,26 +931,22 @@ static RPCHelpMan addpeeraddress()\n         throw JSONRPCError(RPC_CLIENT_P2P_DISABLED, \"Error: Address manager functionality missing or disabled\");\n     }\n \n-    UniValue obj(UniValue::VOBJ);\n-\n-    std::string addr_string = request.params[0].get_str();\n-    uint16_t port{static_cast<uint16_t>(request.params[1].get_int())};\n+    const std::string& addr_string{request.params[0].get_str()};\n+    const uint16_t port{static_cast<uint16_t>(request.params[1].get_int())};\n \n+    UniValue obj(UniValue::VOBJ);\n     CNetAddr net_addr;\n-    if (!LookupHost(addr_string, net_addr, false)) {\n-        obj.pushKV(\"success\", false);\n-        return obj;\n-    }\n-    CAddress address = CAddress({net_addr, port}, ServiceFlags(NODE_NETWORK|NODE_WITNESS));\n-    address.nTime = GetAdjustedTime();\n-    // The source address is set equal to the address. This is equivalent to the peer\n-    // announcing itself.\n-    if (!node.addrman->Add(address, address)) {\n-        obj.pushKV(\"success\", false);\n-        return obj;\n+    bool success{false};\n+\n+    if (LookupHost(addr_string, net_addr, false)) {\n+        CAddress address{CAddress({net_addr, port}, ServiceFlags(NODE_NETWORK | NODE_WITNESS))};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22043#discussion_r638535703",
      "id" : 638535703,
      "line" : 942,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzODUzNTcwMw==",
      "original_commit_id" : "b36e0cd1b9d361ac6f9777c09328a13e9ee923be",
      "original_line" : 942,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : 27,
      "pull_request_review_id" : 667492858,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22043",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-25T07:42:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/638535703",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
