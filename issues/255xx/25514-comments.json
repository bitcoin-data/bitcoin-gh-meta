[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#25619](https://github.com/bitcoin/bitcoin/pull/25619) (net: avoid overriding non-virtual ToString() in CService and use better naming by vasild)\n* [#25572](https://github.com/bitcoin/bitcoin/pull/25572) (refactor: Introduce EvictionManager and use it for the inbound eviction logic by dergoegge)\n* [#25555](https://github.com/bitcoin/bitcoin/pull/25555) (refactor: Move num_unconnecting_headers_msgs out of cs_main guard by MarcoFalke)\n* [#25355](https://github.com/bitcoin/bitcoin/pull/25355) (I2P: add support for transient addresses for outbound connections by vasild)\n* [#25268](https://github.com/bitcoin/bitcoin/pull/25268) (refactor: Introduce EvictionManager by dergoegge)\n* [#25174](https://github.com/bitcoin/bitcoin/pull/25174) (net/net_processing: Add thread safety related annotations for CNode and Peer by ajtowns)\n* [#24697](https://github.com/bitcoin/bitcoin/pull/24697) (refactor address relay time by MarcoFalke)\n* [#24571](https://github.com/bitcoin/bitcoin/pull/24571) (p2p: Prevent block index fingerprinting by sending additional getheaders messages by dergoegge)\n* [#24170](https://github.com/bitcoin/bitcoin/pull/24170) (p2p, rpc: Manual block-relay-only connections with addnode by mzumsande)\n* [#24008](https://github.com/bitcoin/bitcoin/pull/24008) (assumeutxo: net_processing changes by jamesob)\n* [#23443](https://github.com/bitcoin/bitcoin/pull/23443) (p2p: Erlay support signaling by naumenkogs)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-06-30T19:52:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#issuecomment-1171615993",
      "id" : 1171615993,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25514",
      "node_id" : "IC_kwDOABII585F1XD5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1171615993/reactions"
      },
      "updated_at" : "2022-07-18T21:36:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1171615993",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r912007088"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/912007088"
         }
      },
      "author_association" : "MEMBER",
      "body" : "why is this removed when it can be moved down?",
      "commit_id" : "10a4ebab27309c781f284d260c882055c66eeb1e",
      "created_at" : "2022-07-01T14:20:32Z",
      "diff_hunk" : "@@ -324,7 +324,6 @@ void FillNode(FuzzedDataProvider& fuzzed_data_provider, ConnmanTestMsg& connman,\n     if (node.fDisconnect) return;\n     assert(node.nVersion == version);\n     assert(node.GetCommonVersion() == std::min(version, PROTOCOL_VERSION));\n-    assert(node.nServices == remote_services);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r912007088",
      "id" : 912007088,
      "line" : 327,
      "node_id" : "PRRC_kwDOABII5842XB-w",
      "original_commit_id" : "10a4ebab27309c781f284d260c882055c66eeb1e",
      "original_line" : 327,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/test/fuzz/util.cpp",
      "position" : 4,
      "pull_request_review_id" : 1026286280,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/912007088/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-01T14:22:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/912007088",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r912007425"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/912007425"
         }
      },
      "author_association" : "MEMBER",
      "body" : "why is this removed and replaced with a hardcoded value?",
      "commit_id" : "10a4ebab27309c781f284d260c882055c66eeb1e",
      "created_at" : "2022-07-01T14:20:56Z",
      "diff_hunk" : "@@ -296,7 +296,6 @@ template <bool ReturnUniquePtr = false>\n auto ConsumeNode(FuzzedDataProvider& fuzzed_data_provider, const std::optional<NodeId>& node_id_in = std::nullopt) noexcept\n {\n     const NodeId node_id = node_id_in.value_or(fuzzed_data_provider.ConsumeIntegralInRange<NodeId>(0, std::numeric_limits<NodeId>::max()));\n-    const ServiceFlags local_services = ConsumeWeakEnum(fuzzed_data_provider, ALL_SERVICE_FLAGS);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r912007425",
      "id" : 912007425,
      "line" : 299,
      "node_id" : "PRRC_kwDOABII5842XCEB",
      "original_commit_id" : "10a4ebab27309c781f284d260c882055c66eeb1e",
      "original_line" : 299,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/test/fuzz/util.h",
      "position" : 4,
      "pull_request_review_id" : 1026286280,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/912007425/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-01T14:22:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/912007425",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r912734475"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/912734475"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This function no longer requires `cs_main`.",
      "commit_id" : "10a4ebab27309c781f284d260c882055c66eeb1e",
      "created_at" : "2022-07-04T08:05:02Z",
      "diff_hunk" : "@@ -636,7 +653,7 @@ class PeerManagerImpl final : public PeerManager\n     /** Get a pointer to a mutable CNodeState. */\n     CNodeState* State(NodeId pnode) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n-    uint32_t GetFetchFlags(const CNode& pfrom) const EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+    uint32_t GetFetchFlags(const Peer& peer) const EXCLUSIVE_LOCKS_REQUIRED(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r912734475",
      "id" : 912734475,
      "line" : 656,
      "node_id" : "PRRC_kwDOABII5842ZzkL",
      "original_commit_id" : "10a4ebab27309c781f284d260c882055c66eeb1e",
      "original_line" : 656,
      "original_position" : 68,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 68,
      "pull_request_review_id" : 1027168080,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/912734475/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-04T08:45:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/912734475",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r912735065"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/912735065"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Perhaps it makes sense to remove `NodeId nodeid` as an argument to this function, now that it can easily be accessed from the `peer` argument.",
      "commit_id" : "10a4ebab27309c781f284d260c882055c66eeb1e",
      "created_at" : "2022-07-04T08:05:49Z",
      "diff_hunk" : "@@ -757,7 +774,7 @@ class PeerManagerImpl final : public PeerManager\n     /** Update pindexLastCommonBlock and add not-in-flight missing successors to vBlocks, until it has\n      *  at most count entries.\n      */\n-    void FindNextBlocksToDownload(NodeId nodeid, unsigned int count, std::vector<const CBlockIndex*>& vBlocks, NodeId& nodeStaller) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+    void FindNextBlocksToDownload(NodeId nodeid, const Peer& peer, unsigned int count, std::vector<const CBlockIndex*>& vBlocks, NodeId& nodeStaller) EXCLUSIVE_LOCKS_REQUIRED(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r912735065",
      "id" : 912735065,
      "line" : 777,
      "node_id" : "PRRC_kwDOABII5842ZztZ",
      "original_commit_id" : "10a4ebab27309c781f284d260c882055c66eeb1e",
      "original_line" : 777,
      "original_position" : 77,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 77,
      "pull_request_review_id" : 1027168080,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/912735065/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-04T08:45:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/912735065",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r912751871"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/912751871"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm not sure if changing these fields to optional requires a release note, since missing fields that used to be always present could break clients that assume they'll be there. See #25176 for example.",
      "commit_id" : "10a4ebab27309c781f284d260c882055c66eeb1e",
      "created_at" : "2022-07-04T08:25:04Z",
      "diff_hunk" : "@@ -130,6 +125,11 @@ static RPCHelpMan getpeerinfo()\n                     {RPCResult::Type::BOOL, \"inbound\", \"Inbound (true) or Outbound (false)\"},\n                     {RPCResult::Type::BOOL, \"bip152_hb_to\", \"Whether we selected peer as (compact blocks) high-bandwidth peer\"},\n                     {RPCResult::Type::BOOL, \"bip152_hb_from\", \"Whether peer selected us as (compact blocks) high-bandwidth peer\"},\n+                    {RPCResult::Type::STR_HEX, \"services\", /*optional=*/true, \"The services offered\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r912751871",
      "id" : 912751871,
      "line" : 128,
      "node_id" : "PRRC_kwDOABII5842Z3z_",
      "original_commit_id" : "10a4ebab27309c781f284d260c882055c66eeb1e",
      "original_line" : 128,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : 16,
      "pull_request_review_id" : 1027168080,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/912751871/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-04T08:45:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/912751871",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r912765757"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/912765757"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think the line lower down:\r\n\r\n```\r\naddrLocal = CAddress{pnode->GetAddrLocal(), addrLocal.nServices, addrLocal.nTime};\r\n```\r\n\r\nNo longer makes sense, since `addrLocal.nServices` will always be `NODE_NONE`. Perhaps change `addrLocal.nServices` to `NODE_NONE`, since it is the caller's job to set the services.\r\n\r\nPerhaps even better would be to change `GetLocalAddrForPeer` and `GetLocalAddress` to return a `CService` instead of a `CAddress`, so the caller has to set the `nTime` and `nServices` fields (which might help avoid bugs like #25314).",
      "commit_id" : "10a4ebab27309c781f284d260c882055c66eeb1e",
      "created_at" : "2022-07-04T08:40:39Z",
      "diff_hunk" : "@@ -235,10 +235,10 @@ bool IsPeerAddrLocalGood(CNode *pnode)\n \n std::optional<CAddress> GetLocalAddrForPeer(CNode *pnode)\n {\n-    CAddress addrLocal = GetLocalAddress(&pnode->addr, pnode->GetLocalServices());\n+    CAddress addrLocal = GetLocalAddress(&pnode->addr);\n     if (gArgs.GetBoolArg(\"-addrmantest\", false)) {\n         // use IPv4 loopback during addrmantest\n-        addrLocal = CAddress(CService(LookupNumeric(\"127.0.0.1\", GetListenPort())), pnode->GetLocalServices());\n+        addrLocal = CAddress(CService(LookupNumeric(\"127.0.0.1\", GetListenPort())), NODE_NONE);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r912765757",
      "id" : 912765757,
      "line" : 241,
      "node_id" : "PRRC_kwDOABII5842Z7M9",
      "original_commit_id" : "10a4ebab27309c781f284d260c882055c66eeb1e",
      "original_line" : 241,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 26,
      "pull_request_review_id" : 1027168080,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/912765757/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-04T08:45:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/912765757",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r912770455"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/912770455"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Which hardcoded value? The `CNode` object no longer contains `nServices`, so there's nothing to set here.",
      "commit_id" : "10a4ebab27309c781f284d260c882055c66eeb1e",
      "created_at" : "2022-07-04T08:45:36Z",
      "diff_hunk" : "@@ -296,7 +296,6 @@ template <bool ReturnUniquePtr = false>\n auto ConsumeNode(FuzzedDataProvider& fuzzed_data_provider, const std::optional<NodeId>& node_id_in = std::nullopt) noexcept\n {\n     const NodeId node_id = node_id_in.value_or(fuzzed_data_provider.ConsumeIntegralInRange<NodeId>(0, std::numeric_limits<NodeId>::max()));\n-    const ServiceFlags local_services = ConsumeWeakEnum(fuzzed_data_provider, ALL_SERVICE_FLAGS);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r912770455",
      "id" : 912770455,
      "in_reply_to_id" : 912007425,
      "line" : 299,
      "node_id" : "PRRC_kwDOABII5842Z8WX",
      "original_commit_id" : "10a4ebab27309c781f284d260c882055c66eeb1e",
      "original_line" : 299,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/test/fuzz/util.h",
      "position" : 4,
      "pull_request_review_id" : 1027168080,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/912770455/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-04T08:45:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/912770455",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r912817160"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/912817160"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The symbol is moved from `CNode` to `Peer`. I think a refactoring pull request should not change the value of the symbol.\r\n\r\nIf the local service flags were previously determined by the fuzz engine, they should still be after this change, regardless of the namespace of the symbol.",
      "commit_id" : "10a4ebab27309c781f284d260c882055c66eeb1e",
      "created_at" : "2022-07-04T09:34:58Z",
      "diff_hunk" : "@@ -296,7 +296,6 @@ template <bool ReturnUniquePtr = false>\n auto ConsumeNode(FuzzedDataProvider& fuzzed_data_provider, const std::optional<NodeId>& node_id_in = std::nullopt) noexcept\n {\n     const NodeId node_id = node_id_in.value_or(fuzzed_data_provider.ConsumeIntegralInRange<NodeId>(0, std::numeric_limits<NodeId>::max()));\n-    const ServiceFlags local_services = ConsumeWeakEnum(fuzzed_data_provider, ALL_SERVICE_FLAGS);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r912817160",
      "id" : 912817160,
      "in_reply_to_id" : 912007425,
      "line" : 299,
      "node_id" : "PRRC_kwDOABII5842aHwI",
      "original_commit_id" : "10a4ebab27309c781f284d260c882055c66eeb1e",
      "original_line" : 299,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/test/fuzz/util.h",
      "position" : 4,
      "pull_request_review_id" : 1027284569,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/912817160/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-04T09:34:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/912817160",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r912899595"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/912899595"
         }
      },
      "author_association" : "MEMBER",
      "body" : "To be clear, are you suggesting that the `InitializeNode()` calls in fuzz/processmessage.cpp and fuzz/processmessages.cpp should be updated to take `ConsumeWeakEnum(fuzzed_data_provider, ALL_SERVICE_FLAGS)`?",
      "commit_id" : "10a4ebab27309c781f284d260c882055c66eeb1e",
      "created_at" : "2022-07-04T11:15:13Z",
      "diff_hunk" : "@@ -296,7 +296,6 @@ template <bool ReturnUniquePtr = false>\n auto ConsumeNode(FuzzedDataProvider& fuzzed_data_provider, const std::optional<NodeId>& node_id_in = std::nullopt) noexcept\n {\n     const NodeId node_id = node_id_in.value_or(fuzzed_data_provider.ConsumeIntegralInRange<NodeId>(0, std::numeric_limits<NodeId>::max()));\n-    const ServiceFlags local_services = ConsumeWeakEnum(fuzzed_data_provider, ALL_SERVICE_FLAGS);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r912899595",
      "id" : 912899595,
      "in_reply_to_id" : 912007425,
      "line" : 299,
      "node_id" : "PRRC_kwDOABII5842ab4L",
      "original_commit_id" : "10a4ebab27309c781f284d260c882055c66eeb1e",
      "original_line" : 299,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/test/fuzz/util.h",
      "position" : 4,
      "pull_request_review_id" : 1027404490,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/912899595/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-04T11:15:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/912899595",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r912904348"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/912904348"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes.\r\n\r\nI am also thinking if `InitializeNode` can be moved into `FillNode`, so that only one place needs to be updated.",
      "commit_id" : "10a4ebab27309c781f284d260c882055c66eeb1e",
      "created_at" : "2022-07-04T11:21:38Z",
      "diff_hunk" : "@@ -296,7 +296,6 @@ template <bool ReturnUniquePtr = false>\n auto ConsumeNode(FuzzedDataProvider& fuzzed_data_provider, const std::optional<NodeId>& node_id_in = std::nullopt) noexcept\n {\n     const NodeId node_id = node_id_in.value_or(fuzzed_data_provider.ConsumeIntegralInRange<NodeId>(0, std::numeric_limits<NodeId>::max()));\n-    const ServiceFlags local_services = ConsumeWeakEnum(fuzzed_data_provider, ALL_SERVICE_FLAGS);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r912904348",
      "id" : 912904348,
      "in_reply_to_id" : 912007425,
      "line" : 299,
      "node_id" : "PRRC_kwDOABII5842adCc",
      "original_commit_id" : "10a4ebab27309c781f284d260c882055c66eeb1e",
      "original_line" : 299,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/test/fuzz/util.h",
      "position" : 4,
      "pull_request_review_id" : 1027411098,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/912904348/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-04T11:21:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/912904348",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r913133744"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/913133744"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Moved the assert down.",
      "commit_id" : "fae6a00290e0eb9584e2205f252ab46648d6fbdc",
      "created_at" : "2022-07-04T16:18:17Z",
      "diff_hunk" : "@@ -324,7 +324,6 @@ void FillNode(FuzzedDataProvider& fuzzed_data_provider, ConnmanTestMsg& connman,\n     if (node.fDisconnect) return;\n     assert(node.nVersion == version);\n     assert(node.GetCommonVersion() == std::min(version, PROTOCOL_VERSION));\n-    assert(node.nServices == remote_services);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r913133744",
      "id" : 913133744,
      "in_reply_to_id" : 912007088,
      "line" : 327,
      "node_id" : "PRRC_kwDOABII5842bVCw",
      "original_commit_id" : "10a4ebab27309c781f284d260c882055c66eeb1e",
      "original_line" : 327,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/test/fuzz/util.cpp",
      "position" : 18,
      "pull_request_review_id" : 1027737610,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/913133744/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-04T16:18:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/913133744",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r913134477"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/913134477"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Moved all `InitializeNode` calls (there were only 2) into `FillNode` with service flags consumed from the fuzzer.",
      "commit_id" : "fae6a00290e0eb9584e2205f252ab46648d6fbdc",
      "created_at" : "2022-07-04T16:19:39Z",
      "diff_hunk" : "@@ -296,7 +296,6 @@ template <bool ReturnUniquePtr = false>\n auto ConsumeNode(FuzzedDataProvider& fuzzed_data_provider, const std::optional<NodeId>& node_id_in = std::nullopt) noexcept\n {\n     const NodeId node_id = node_id_in.value_or(fuzzed_data_provider.ConsumeIntegralInRange<NodeId>(0, std::numeric_limits<NodeId>::max()));\n-    const ServiceFlags local_services = ConsumeWeakEnum(fuzzed_data_provider, ALL_SERVICE_FLAGS);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r913134477",
      "id" : 913134477,
      "in_reply_to_id" : 912007425,
      "line" : 299,
      "node_id" : "PRRC_kwDOABII5842bVON",
      "original_commit_id" : "10a4ebab27309c781f284d260c882055c66eeb1e",
      "original_line" : 299,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/test/fuzz/util.h",
      "position" : 4,
      "pull_request_review_id" : 1027738527,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/913134477/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-04T16:19:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/913134477",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r913134913"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/913134913"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yup, removed the NodeId arg.",
      "commit_id" : "fae6a00290e0eb9584e2205f252ab46648d6fbdc",
      "created_at" : "2022-07-04T16:20:33Z",
      "diff_hunk" : "@@ -757,7 +774,7 @@ class PeerManagerImpl final : public PeerManager\n     /** Update pindexLastCommonBlock and add not-in-flight missing successors to vBlocks, until it has\n      *  at most count entries.\n      */\n-    void FindNextBlocksToDownload(NodeId nodeid, unsigned int count, std::vector<const CBlockIndex*>& vBlocks, NodeId& nodeStaller) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+    void FindNextBlocksToDownload(NodeId nodeid, const Peer& peer, unsigned int count, std::vector<const CBlockIndex*>& vBlocks, NodeId& nodeStaller) EXCLUSIVE_LOCKS_REQUIRED(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r913134913",
      "id" : 913134913,
      "in_reply_to_id" : 912735065,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5842bVVB",
      "original_commit_id" : "10a4ebab27309c781f284d260c882055c66eeb1e",
      "original_line" : 777,
      "original_position" : 77,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1027739092,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/913134913/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-04T16:20:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/913134913",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r913135978"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/913135978"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Perhaps even better would be to change GetLocalAddrForPeer and GetLocalAddress to return a `CService`\r\n\r\nAdded an extra commit to do this. Makes it obvious that the caller is supposed to set the `nTime` and `nServices` fields.",
      "commit_id" : "fae6a00290e0eb9584e2205f252ab46648d6fbdc",
      "created_at" : "2022-07-04T16:22:37Z",
      "diff_hunk" : "@@ -235,10 +235,10 @@ bool IsPeerAddrLocalGood(CNode *pnode)\n \n std::optional<CAddress> GetLocalAddrForPeer(CNode *pnode)\n {\n-    CAddress addrLocal = GetLocalAddress(&pnode->addr, pnode->GetLocalServices());\n+    CAddress addrLocal = GetLocalAddress(&pnode->addr);\n     if (gArgs.GetBoolArg(\"-addrmantest\", false)) {\n         // use IPv4 loopback during addrmantest\n-        addrLocal = CAddress(CService(LookupNumeric(\"127.0.0.1\", GetListenPort())), pnode->GetLocalServices());\n+        addrLocal = CAddress(CService(LookupNumeric(\"127.0.0.1\", GetListenPort())), NODE_NONE);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r913135978",
      "id" : 913135978,
      "in_reply_to_id" : 912765757,
      "line" : 239,
      "node_id" : "PRRC_kwDOABII5842bVlq",
      "original_commit_id" : "10a4ebab27309c781f284d260c882055c66eeb1e",
      "original_line" : 239,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 32,
      "pull_request_review_id" : 1027740470,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/913135978/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-04T16:22:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/913135978",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r913146453"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/913146453"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I changed this back to be non-optional just to stick with the previous behavior (i.e. when the peer has not sent a `version` message yet we default to  `NODE_NONE`).",
      "commit_id" : "fae6a00290e0eb9584e2205f252ab46648d6fbdc",
      "created_at" : "2022-07-04T16:45:07Z",
      "diff_hunk" : "@@ -130,6 +125,11 @@ static RPCHelpMan getpeerinfo()\n                     {RPCResult::Type::BOOL, \"inbound\", \"Inbound (true) or Outbound (false)\"},\n                     {RPCResult::Type::BOOL, \"bip152_hb_to\", \"Whether we selected peer as (compact blocks) high-bandwidth peer\"},\n                     {RPCResult::Type::BOOL, \"bip152_hb_from\", \"Whether peer selected us as (compact blocks) high-bandwidth peer\"},\n+                    {RPCResult::Type::STR_HEX, \"services\", /*optional=*/true, \"The services offered\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r913146453",
      "id" : 913146453,
      "in_reply_to_id" : 912751871,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5842bYJV",
      "original_commit_id" : "10a4ebab27309c781f284d260c882055c66eeb1e",
      "original_line" : 128,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1027754456,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/913146453/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-04T16:45:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/913146453",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-07-04T21:06:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#issuecomment-1174361399",
      "id" : 1174361399,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25514",
      "node_id" : "IC_kwDOABII585F_1U3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1174361399/reactions"
      },
      "updated_at" : "2022-07-04T21:06:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1174361399",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r914765678"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/914765678"
         }
      },
      "author_association" : "MEMBER",
      "body" : ":+1: Seems pragmatic",
      "commit_id" : "d5b6ba717686ccb06ae06a553f2a563e97f53327",
      "created_at" : "2022-07-06T12:14:03Z",
      "diff_hunk" : "@@ -130,6 +125,11 @@ static RPCHelpMan getpeerinfo()\n                     {RPCResult::Type::BOOL, \"inbound\", \"Inbound (true) or Outbound (false)\"},\n                     {RPCResult::Type::BOOL, \"bip152_hb_to\", \"Whether we selected peer as (compact blocks) high-bandwidth peer\"},\n                     {RPCResult::Type::BOOL, \"bip152_hb_from\", \"Whether peer selected us as (compact blocks) high-bandwidth peer\"},\n+                    {RPCResult::Type::STR_HEX, \"services\", /*optional=*/true, \"The services offered\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r914765678",
      "id" : 914765678,
      "in_reply_to_id" : 912751871,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5842hjdu",
      "original_commit_id" : "10a4ebab27309c781f284d260c882055c66eeb1e",
      "original_line" : 128,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1029987711,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/914765678/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-06T12:14:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/914765678",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK d5b6ba717686ccb06ae06a553f2a563e97f53327",
      "created_at" : "2022-07-06T12:14:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#issuecomment-1176147998",
      "id" : 1176147998,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25514",
      "node_id" : "IC_kwDOABII585GGpge",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1176147998/reactions"
      },
      "updated_at" : "2022-07-06T12:14:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1176147998",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r915008859"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/915008859"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The Ci was failing because the peer manager calls `AddTimeData`  when receiving a version message and since the time offset data for adjusted time is a global this can mess with other tests. Calling `TestOnlyResetTimeData()` here should fix it.",
      "commit_id" : "c38a00d0e3ba0913cce026d3d05088a2fb2a3114",
      "created_at" : "2022-07-06T15:56:26Z",
      "diff_hunk" : "@@ -34,6 +36,56 @@ static CService ip(uint32_t i)\n \n BOOST_FIXTURE_TEST_SUITE(denialofservice_tests, TestingSetup)\n \n+void ConnectNode(ConnmanTestMsg& connman, PeerManager& peerman, CNode& node, ServiceFlags their_services) noexcept\n+{\n+    // Send version message\n+    const CNetMsgMaker mm{0};\n+    CSerializedNetMsg msg_version{\n+        mm.Make(NetMsgType::VERSION,\n+                PROTOCOL_VERSION,                               // current p2p version\n+                Using<CustomUintFormatter<8>>(their_services),  // their service flags\n+                int64_t{},                                      // dummy time\n+                int64_t{},                                      // ignored service bits\n+                CService{},                                     // dummy\n+                int64_t{},                                      // ignored service bits\n+                CService{},                                     // ignored\n+                uint64_t{1},                                    // dummy nonce\n+                std::string{},                                  // dummy subver\n+                int32_t{},                                      // dummy starting_height\n+                true),                                          // fRelay\n+    };\n+\n+    (void)connman.ReceiveMsgFrom(node, msg_version);\n+    node.fPauseSend = false;\n+    connman.ProcessMessagesOnce(node);\n+\n+    // Receive messages\n+    {\n+        LOCK(node.cs_sendProcessing);\n+        peerman.SendMessages(&node);\n+    }\n+    if (node.fDisconnect) return;\n+\n+    BOOST_CHECK_EQUAL(node.nVersion, PROTOCOL_VERSION);\n+    BOOST_CHECK_EQUAL(node.GetCommonVersion(), PROTOCOL_VERSION);\n+    BOOST_CHECK_EQUAL(node.nServices, their_services);\n+\n+    // Send verack message\n+    CSerializedNetMsg msg_verack{mm.Make(NetMsgType::VERACK)};\n+    (void)connman.ReceiveMsgFrom(node, msg_verack);\n+    node.fPauseSend = false;\n+    connman.ProcessMessagesOnce(node);\n+\n+    // Receive messages\n+    {\n+        LOCK(node.cs_sendProcessing);\n+        peerman.SendMessages(&node);\n+    }\n+    BOOST_CHECK_EQUAL(node.fSuccessfullyConnected, true);\n+\n+    TestOnlyResetTimeData();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r915008859",
      "id" : 915008859,
      "line" : 90,
      "node_id" : "PRRC_kwDOABII5842ie1b",
      "original_commit_id" : "40e83ad09dae3bd958dafeb54c6da3193c6e0c6a",
      "original_line" : 86,
      "original_position" : 67,
      "original_start_line" : null,
      "path" : "src/test/denialofservice_tests.cpp",
      "position" : 67,
      "pull_request_review_id" : 1030340529,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/915008859/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-06T15:56:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/915008859",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK c38a00d0e3",
      "created_at" : "2022-07-06T16:22:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#issuecomment-1176425371",
      "id" : 1176425371,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25514",
      "node_id" : "IC_kwDOABII585GHtOb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1176425371/reactions"
      },
      "updated_at" : "2022-07-06T16:22:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1176425371",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r916886542"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916886542"
         }
      },
      "author_association" : "MEMBER",
      "body" : "bd93b709ea4e8e295a3438f30d9d3f6999e7623c: Why are you changing this from `NODE_NETWORK` to something else?",
      "commit_id" : "c38a00d0e3ba0913cce026d3d05088a2fb2a3114",
      "created_at" : "2022-07-08T14:43:24Z",
      "diff_hunk" : "@@ -857,7 +857,7 @@ BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n         *static_cast<TestChainState*>(&m_node.chainman->ActiveChainstate());\n     chainstate.JumpOutOfIbd();\n \n-    m_node.peerman->InitializeNode(&peer);\n+    m_node.peerman->InitializeNode(&peer, ServiceFlags(NODE_NETWORK|NODE_WITNESS));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r916886542",
      "id" : 916886542,
      "line" : 849,
      "node_id" : "PRRC_kwDOABII5842ppQO",
      "original_commit_id" : "bd93b709ea4e8e295a3438f30d9d3f6999e7623c",
      "original_line" : 860,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : 5,
      "pull_request_review_id" : 1033014422,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916886542/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-08T15:16:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916886542",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r916887605"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916887605"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same commit, this should be p2p_node.nLocalServices, not something hardcoded",
      "commit_id" : "c38a00d0e3ba0913cce026d3d05088a2fb2a3114",
      "created_at" : "2022-07-08T14:44:42Z",
      "diff_hunk" : "@@ -46,7 +46,7 @@ FUZZ_TARGET_INIT(process_messages, initialize_process_messages)\n         peers.push_back(ConsumeNodeAsUniquePtr(fuzzed_data_provider, i).release());\n         CNode& p2p_node = *peers.back();\n \n-        g_setup->m_node.peerman->InitializeNode(&p2p_node);\n+        g_setup->m_node.peerman->InitializeNode(&p2p_node, ServiceFlags(NODE_NETWORK|NODE_WITNESS));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r916887605",
      "id" : 916887605,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5842ppg1",
      "original_commit_id" : "bd93b709ea4e8e295a3438f30d9d3f6999e7623c",
      "original_line" : 49,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/fuzz/process_messages.cpp",
      "position" : 5,
      "pull_request_review_id" : 1033014422,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916887605/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-08T15:16:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916887605",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r916887720"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916887720"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same",
      "commit_id" : "c38a00d0e3ba0913cce026d3d05088a2fb2a3114",
      "created_at" : "2022-07-08T14:44:49Z",
      "diff_hunk" : "@@ -80,7 +80,7 @@ void fuzz_target(FuzzBufferType buffer, const std::string& LIMIT_TO_MESSAGE_TYPE\n     CNode& p2p_node = *ConsumeNodeAsUniquePtr(fuzzed_data_provider).release();\n \n     connman.AddTestNode(p2p_node);\n-    g_setup->m_node.peerman->InitializeNode(&p2p_node);\n+    g_setup->m_node.peerman->InitializeNode(&p2p_node, ServiceFlags(NODE_NETWORK|NODE_WITNESS));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r916887720",
      "id" : 916887720,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5842ppio",
      "original_commit_id" : "bd93b709ea4e8e295a3438f30d9d3f6999e7623c",
      "original_line" : 83,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/fuzz/process_message.cpp",
      "position" : 5,
      "pull_request_review_id" : 1033014422,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916887720/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-08T15:16:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916887720",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r916889865"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916889865"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same commit: (nit) `struct` doesn't have the `m_` prefix, see also https://github.com/bitcoin/bitcoin/pull/25555#discussion_r915161295",
      "commit_id" : "c38a00d0e3ba0913cce026d3d05088a2fb2a3114",
      "created_at" : "2022-07-08T14:47:07Z",
      "diff_hunk" : "@@ -207,6 +207,27 @@ struct Peer {\n     /** Same id as the CNode object for this peer */\n     const NodeId m_id{0};\n \n+    /** Services we offered to this peer.\n+     *\n+     *  This is supplied by CConnman during peer initialization. It's const\n+     *  because there is no protocol defined for renegotiating services\n+     *  initially offered to a peer. The set of local services we offer should\n+     *  not change after initialization.\n+     *\n+     *  An interesting example of this is NODE_NETWORK and initial block\n+     *  download: a node which starts up from scratch doesn't have any blocks\n+     *  to serve, but still advertises NODE_NETWORK because it will eventually\n+     *  fulfill this role after IBD completes. P2P code is written in such a\n+     *  way that it can gracefully handle peers who don't make good on their\n+     *  service advertisements.\n+     *\n+     *  TODO: remove redundant CNode::nLocalServices*/\n+    const ServiceFlags m_our_services;\n+    /** Services this peer offered to us.\n+     *\n+     * TODO: remove redundant CNode::nServices */\n+    std::atomic<ServiceFlags> m_their_services{NODE_NONE};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r916889865",
      "id" : 916889865,
      "line" : 225,
      "node_id" : "PRRC_kwDOABII5842pqEJ",
      "original_commit_id" : "bd93b709ea4e8e295a3438f30d9d3f6999e7623c",
      "original_line" : 229,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 23,
      "pull_request_review_id" : 1033014422,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916889865/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-08T15:16:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916889865",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r916895634"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916895634"
         }
      },
      "author_association" : "MEMBER",
      "body" : "40e83ad09dae3bd958dafeb54c6da3193c6e0c6a: Previously it was NODE_NODE, now it is something else, why? ",
      "commit_id" : "c38a00d0e3ba0913cce026d3d05088a2fb2a3114",
      "created_at" : "2022-07-08T14:53:26Z",
      "diff_hunk" : "@@ -63,10 +114,9 @@ BOOST_AUTO_TEST_CASE(outbound_slow_chain_eviction)\n                      /*addrNameIn=*/\"\",\n                      ConnectionType::OUTBOUND_FULL_RELAY,\n                      /*inbound_onion=*/false};\n-    dummyNode1.SetCommonVersion(PROTOCOL_VERSION);\n \n-    peerLogic->InitializeNode(&dummyNode1, ServiceFlags(NODE_NETWORK|NODE_WITNESS));\n-    dummyNode1.fSuccessfullyConnected = true;\n+    peerman.InitializeNode(&dummyNode1, ServiceFlags(NODE_NETWORK|NODE_WITNESS));\n+    ConnectNode(connman, peerman, dummyNode1, ServiceFlags(NODE_NETWORK|NODE_WITNESS));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r916895634",
      "id" : 916895634,
      "line" : 122,
      "node_id" : "PRRC_kwDOABII5842preS",
      "original_commit_id" : "40e83ad09dae3bd958dafeb54c6da3193c6e0c6a",
      "original_line" : 119,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "src/test/denialofservice_tests.cpp",
      "position" : 97,
      "pull_request_review_id" : 1033014422,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916895634/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-08T15:16:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916895634",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r916900775"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916900775"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ded0727ba0747cf1161e29ec33d16998f63ab3ef: Same nit about `m_`, but feel free to ignore, since I am pretty sure I \"violated\" that style rule myself by accident.",
      "commit_id" : "c38a00d0e3ba0913cce026d3d05088a2fb2a3114",
      "created_at" : "2022-07-08T14:59:13Z",
      "diff_hunk" : "@@ -34,6 +34,7 @@ struct CNodeStateStats {\n     uint64_t m_addr_processed = 0;\n     uint64_t m_addr_rate_limited = 0;\n     bool m_addr_relay_enabled{false};\n+    ServiceFlags m_their_services;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r916900775",
      "id" : 916900775,
      "line" : 37,
      "node_id" : "PRRC_kwDOABII5842psun",
      "original_commit_id" : "ded0727ba0747cf1161e29ec33d16998f63ab3ef",
      "original_line" : 37,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.h",
      "position" : 4,
      "pull_request_review_id" : 1033014422,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916900775/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-08T15:16:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916900775",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r916912313"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916912313"
         }
      },
      "author_association" : "MEMBER",
      "body" : "d4759a02b51368870526f04558797bb7f5749c73: Looks like you are changing the value, why?",
      "commit_id" : "c38a00d0e3ba0913cce026d3d05088a2fb2a3114",
      "created_at" : "2022-07-08T15:12:35Z",
      "diff_hunk" : "@@ -356,7 +353,7 @@ BOOST_AUTO_TEST_CASE(peer_discouragement)\n                          ConnectionType::INBOUND,\n                          /*inbound_onion=*/false};\n     nodes[0]->SetCommonVersion(PROTOCOL_VERSION);\n-    peerLogic->InitializeNode(nodes[0], NODE_NETWORK);\n+    peerLogic->InitializeNode(nodes[0], ServiceFlags(NODE_NETWORK | NODE_WITNESS));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r916912313",
      "id" : 916912313,
      "line" : 356,
      "node_id" : "PRRC_kwDOABII5842pvi5",
      "original_commit_id" : "d4759a02b51368870526f04558797bb7f5749c73",
      "original_line" : 356,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/test/denialofservice_tests.cpp",
      "position" : 29,
      "pull_request_review_id" : 1033014422,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916912313/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-08T15:16:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916912313",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r916914710"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916914710"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If this is supposed to be an alias for `peer.nLocalServices`, why not simply type that to make review easier?",
      "commit_id" : "c38a00d0e3ba0913cce026d3d05088a2fb2a3114",
      "created_at" : "2022-07-08T15:15:11Z",
      "diff_hunk" : "@@ -857,7 +857,7 @@ BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n         *static_cast<TestChainState*>(&m_node.chainman->ActiveChainstate());\n     chainstate.JumpOutOfIbd();\n \n-    m_node.peerman->InitializeNode(&peer);\n+    m_node.peerman->InitializeNode(&peer, ServiceFlags(NODE_NETWORK|NODE_WITNESS));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r916914710",
      "id" : 916914710,
      "in_reply_to_id" : 916886542,
      "line" : 849,
      "node_id" : "PRRC_kwDOABII5842pwIW",
      "original_commit_id" : "bd93b709ea4e8e295a3438f30d9d3f6999e7623c",
      "original_line" : 860,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : 5,
      "pull_request_review_id" : 1033014422,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916914710/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-08T15:16:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916914710",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r917071466"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917071466"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is done because this PR removes `CNode::fClient` and `CNode::m_limited_node` members. These two variables are default initialized as `false` and then set to the correct value when a `version` message is received. In production this is fine, as the two bools are not used if the version handshake hasn't happened. In the test however, we don't do the version handshake and manually set `fSuccessfullyConnected = true`. The default `false` then results in the logic behaving as expected (e.g. the node is not a client, so we ask them for headers).\r\n\r\nNow with the PR the two bools are removed and replaced with static functions that operate on `Peer::their_services` to determine client and pruned node status. In the test here, if we keep `Peer::their_services` as `NODE_NONE` then we would consider `dummyNode1` a client and not ask for headers.\r\n\r\nI think this makes the test more realistic (also mentioned in the commit message) and shouldn't change behavior.",
      "commit_id" : "991ea8e224eb6337f81b721872252f296236c00b",
      "created_at" : "2022-07-08T19:00:48Z",
      "diff_hunk" : "@@ -63,10 +114,9 @@ BOOST_AUTO_TEST_CASE(outbound_slow_chain_eviction)\n                      /*addrNameIn=*/\"\",\n                      ConnectionType::OUTBOUND_FULL_RELAY,\n                      /*inbound_onion=*/false};\n-    dummyNode1.SetCommonVersion(PROTOCOL_VERSION);\n \n-    peerLogic->InitializeNode(&dummyNode1, ServiceFlags(NODE_NETWORK|NODE_WITNESS));\n-    dummyNode1.fSuccessfullyConnected = true;\n+    peerman.InitializeNode(&dummyNode1, ServiceFlags(NODE_NETWORK|NODE_WITNESS));\n+    ConnectNode(connman, peerman, dummyNode1, ServiceFlags(NODE_NETWORK|NODE_WITNESS));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r917071466",
      "id" : 917071466,
      "in_reply_to_id" : 916895634,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5842qWZq",
      "original_commit_id" : "40e83ad09dae3bd958dafeb54c6da3193c6e0c6a",
      "original_line" : 119,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "src/test/denialofservice_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1033285672,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917071466/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-08T19:00:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917071466",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r917088986"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917088986"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Changed this to pass `GetLocalServices()` to all the `InitializeNode` calls and only later on when `CNode::nLocalServices` is actually removed, do we set the service flags directly (corresponding to their previous values).",
      "commit_id" : "991ea8e224eb6337f81b721872252f296236c00b",
      "created_at" : "2022-07-08T19:31:51Z",
      "diff_hunk" : "@@ -857,7 +857,7 @@ BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n         *static_cast<TestChainState*>(&m_node.chainman->ActiveChainstate());\n     chainstate.JumpOutOfIbd();\n \n-    m_node.peerman->InitializeNode(&peer);\n+    m_node.peerman->InitializeNode(&peer, ServiceFlags(NODE_NETWORK|NODE_WITNESS));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r917088986",
      "id" : 917088986,
      "in_reply_to_id" : 916886542,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5842qara",
      "original_commit_id" : "bd93b709ea4e8e295a3438f30d9d3f6999e7623c",
      "original_line" : 860,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1033311464,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917088986/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-08T19:31:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917088986",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r917089453"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917089453"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Removed the `m_` prefix.",
      "commit_id" : "991ea8e224eb6337f81b721872252f296236c00b",
      "created_at" : "2022-07-08T19:32:39Z",
      "diff_hunk" : "@@ -207,6 +207,27 @@ struct Peer {\n     /** Same id as the CNode object for this peer */\n     const NodeId m_id{0};\n \n+    /** Services we offered to this peer.\n+     *\n+     *  This is supplied by CConnman during peer initialization. It's const\n+     *  because there is no protocol defined for renegotiating services\n+     *  initially offered to a peer. The set of local services we offer should\n+     *  not change after initialization.\n+     *\n+     *  An interesting example of this is NODE_NETWORK and initial block\n+     *  download: a node which starts up from scratch doesn't have any blocks\n+     *  to serve, but still advertises NODE_NETWORK because it will eventually\n+     *  fulfill this role after IBD completes. P2P code is written in such a\n+     *  way that it can gracefully handle peers who don't make good on their\n+     *  service advertisements.\n+     *\n+     *  TODO: remove redundant CNode::nLocalServices*/\n+    const ServiceFlags m_our_services;\n+    /** Services this peer offered to us.\n+     *\n+     * TODO: remove redundant CNode::nServices */\n+    std::atomic<ServiceFlags> m_their_services{NODE_NONE};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r917089453",
      "id" : 917089453,
      "in_reply_to_id" : 916889865,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5842qayt",
      "original_commit_id" : "bd93b709ea4e8e295a3438f30d9d3f6999e7623c",
      "original_line" : 229,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1033312114,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917089453/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-08T19:32:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917089453",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r917089996"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917089996"
         }
      },
      "author_association" : "MEMBER",
      "body" : "All the service flags should now have the same values as before.",
      "commit_id" : "991ea8e224eb6337f81b721872252f296236c00b",
      "created_at" : "2022-07-08T19:33:37Z",
      "diff_hunk" : "@@ -356,7 +353,7 @@ BOOST_AUTO_TEST_CASE(peer_discouragement)\n                          ConnectionType::INBOUND,\n                          /*inbound_onion=*/false};\n     nodes[0]->SetCommonVersion(PROTOCOL_VERSION);\n-    peerLogic->InitializeNode(nodes[0], NODE_NETWORK);\n+    peerLogic->InitializeNode(nodes[0], ServiceFlags(NODE_NETWORK | NODE_WITNESS));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r917089996",
      "id" : 917089996,
      "in_reply_to_id" : 916912313,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5842qa7M",
      "original_commit_id" : "d4759a02b51368870526f04558797bb7f5749c73",
      "original_line" : 356,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/test/denialofservice_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1033313000,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917089996/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-08T19:33:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917089996",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r918063464"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/918063464"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit in 8960caf8b333ba5b9d226d479329039253161ba6: As you are already changing all call sites, might as well change `*` into `&`. Feel free to ignore, as it is otherwise unrelated to the changes here.",
      "commit_id" : "991ea8e224eb6337f81b721872252f296236c00b",
      "created_at" : "2022-07-11T15:20:43Z",
      "diff_hunk" : "@@ -1299,15 +1321,15 @@ void PeerManagerImpl::UpdateLastBlockAnnounceTime(NodeId node, int64_t time_in_s\n     if (state) state->m_last_block_announcement = time_in_seconds;\n }\n \n-void PeerManagerImpl::InitializeNode(CNode *pnode)\n+void PeerManagerImpl::InitializeNode(CNode *pnode, ServiceFlags our_services)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r918063464",
      "id" : 918063464,
      "line" : 1340,
      "node_id" : "PRRC_kwDOABII5842uIlo",
      "original_commit_id" : "8960caf8b333ba5b9d226d479329039253161ba6",
      "original_line" : 1324,
      "original_position" : 53,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 53,
      "pull_request_review_id" : 1034521708,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/918063464/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-12T06:59:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/918063464",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r918607754"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/918607754"
         }
      },
      "author_association" : "MEMBER",
      "body" : "c132abf1667ea9367ce797d808d6b6c885196601: Why would this disconnect? Seems like copy-pasted dead code?\r\n\r\nAlso, it looks like you forgot to copy-paste the peer-state asserts.\r\n\r\nAlso, I don't see why this is copied in the first place. In the commit message you claim that it is better to make the version handshake consistent with \"live code\". So wouldn't it be better to make this helper easily accessible for all tests instead of forcing reviewers to re-do the copy-paste every time it is and will be used?\r\n\r\nSee https://github.com/bitcoin/bitcoin/pull/25591, which should also make this pull's diff smaller.",
      "commit_id" : "991ea8e224eb6337f81b721872252f296236c00b",
      "created_at" : "2022-07-12T06:51:04Z",
      "diff_hunk" : "@@ -34,6 +36,57 @@ static CService ip(uint32_t i)\n \n BOOST_FIXTURE_TEST_SUITE(denialofservice_tests, TestingSetup)\n \n+void ConnectNode(ConnmanTestMsg& connman, PeerManager& peerman, CNode& node, ServiceFlags their_services) noexcept\n+{\n+    // Send version message\n+    const CNetMsgMaker mm{0};\n+    CSerializedNetMsg msg_version{\n+        mm.Make(NetMsgType::VERSION,\n+                PROTOCOL_VERSION,                               // current p2p version\n+                Using<CustomUintFormatter<8>>(their_services),  // their service flags\n+                int64_t{},                                      // dummy time\n+                int64_t{},                                      // ignored service bits\n+                CService{},                                     // dummy\n+                int64_t{},                                      // ignored service bits\n+                CService{},                                     // ignored\n+                uint64_t{1},                                    // dummy nonce\n+                std::string{},                                  // dummy subver\n+                int32_t{},                                      // dummy starting_height\n+                true),                                          // fRelay\n+    };\n+\n+    (void)connman.ReceiveMsgFrom(node, msg_version);\n+    node.fPauseSend = false;\n+    connman.ProcessMessagesOnce(node);\n+\n+    // Receive messages\n+    {\n+        LOCK(node.cs_sendProcessing);\n+        peerman.SendMessages(&node);\n+    }\n+\n+    TestOnlyResetTimeData();\n+\n+    if (node.fDisconnect) return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r918607754",
      "id" : 918607754,
      "line" : 70,
      "node_id" : "PRRC_kwDOABII5842wNeK",
      "original_commit_id" : "c132abf1667ea9367ce797d808d6b6c885196601",
      "original_line" : 70,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "src/test/denialofservice_tests.cpp",
      "position" : 51,
      "pull_request_review_id" : 1034521708,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/918607754/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-12T06:59:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/918607754",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r918613125"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/918613125"
         }
      },
      "author_association" : "MEMBER",
      "body" : "9d9a6677c483772fe636b61480dfdde7d4586073 (nit): Could run clang-format on this line while touching it?",
      "commit_id" : "991ea8e224eb6337f81b721872252f296236c00b",
      "created_at" : "2022-07-12T06:58:24Z",
      "diff_hunk" : "@@ -234,7 +235,7 @@ void RemoveLocal(const CService& addr);\n bool SeenLocal(const CService& addr);\n bool IsLocal(const CService& addr);\n bool GetLocal(CService &addr, const CNetAddr *paddrPeer = nullptr);\n-CAddress GetLocalAddress(const CNetAddr *paddrPeer, ServiceFlags nLocalServices);\n+CAddress GetLocalAddress(const CNetAddr *paddrPeer);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r918613125",
      "id" : 918613125,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5842wOyF",
      "original_commit_id" : "9d9a6677c483772fe636b61480dfdde7d4586073",
      "original_line" : 238,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 15,
      "pull_request_review_id" : 1034521708,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/918613125/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-12T06:59:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/918613125",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-07-12T15:14:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#issuecomment-1181888881",
      "id" : 1181888881,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25514",
      "node_id" : "IC_kwDOABII585GcjFx",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1181888881/reactions"
      },
      "updated_at" : "2022-07-12T15:14:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1181888881",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r919886729"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919886729"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "8f6ed20acae2a4f93f5b52c3937ab704980db44b",
      "created_at" : "2022-07-13T09:58:30Z",
      "diff_hunk" : "@@ -1299,15 +1321,15 @@ void PeerManagerImpl::UpdateLastBlockAnnounceTime(NodeId node, int64_t time_in_s\n     if (state) state->m_last_block_announcement = time_in_seconds;\n }\n \n-void PeerManagerImpl::InitializeNode(CNode *pnode)\n+void PeerManagerImpl::InitializeNode(CNode *pnode, ServiceFlags our_services)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r919886729",
      "id" : 919886729,
      "in_reply_to_id" : 918063464,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58421FuJ",
      "original_commit_id" : "8960caf8b333ba5b9d226d479329039253161ba6",
      "original_line" : 1324,
      "original_position" : 53,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1037093179,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919886729/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T09:58:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919886729",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r919888276"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919888276"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Rebased on top of the changes in #25591. This test now uses `ConnmanTestMsg::Handshake()`.",
      "commit_id" : "8f6ed20acae2a4f93f5b52c3937ab704980db44b",
      "created_at" : "2022-07-13T10:00:09Z",
      "diff_hunk" : "@@ -34,6 +36,57 @@ static CService ip(uint32_t i)\n \n BOOST_FIXTURE_TEST_SUITE(denialofservice_tests, TestingSetup)\n \n+void ConnectNode(ConnmanTestMsg& connman, PeerManager& peerman, CNode& node, ServiceFlags their_services) noexcept\n+{\n+    // Send version message\n+    const CNetMsgMaker mm{0};\n+    CSerializedNetMsg msg_version{\n+        mm.Make(NetMsgType::VERSION,\n+                PROTOCOL_VERSION,                               // current p2p version\n+                Using<CustomUintFormatter<8>>(their_services),  // their service flags\n+                int64_t{},                                      // dummy time\n+                int64_t{},                                      // ignored service bits\n+                CService{},                                     // dummy\n+                int64_t{},                                      // ignored service bits\n+                CService{},                                     // ignored\n+                uint64_t{1},                                    // dummy nonce\n+                std::string{},                                  // dummy subver\n+                int32_t{},                                      // dummy starting_height\n+                true),                                          // fRelay\n+    };\n+\n+    (void)connman.ReceiveMsgFrom(node, msg_version);\n+    node.fPauseSend = false;\n+    connman.ProcessMessagesOnce(node);\n+\n+    // Receive messages\n+    {\n+        LOCK(node.cs_sendProcessing);\n+        peerman.SendMessages(&node);\n+    }\n+\n+    TestOnlyResetTimeData();\n+\n+    if (node.fDisconnect) return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r919888276",
      "id" : 919888276,
      "in_reply_to_id" : 918607754,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58421GGU",
      "original_commit_id" : "c132abf1667ea9367ce797d808d6b6c885196601",
      "original_line" : 70,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "src/test/denialofservice_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1037095373,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919888276/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T10:00:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919888276",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r919888378"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919888378"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "8f6ed20acae2a4f93f5b52c3937ab704980db44b",
      "created_at" : "2022-07-13T10:00:16Z",
      "diff_hunk" : "@@ -234,7 +235,7 @@ void RemoveLocal(const CService& addr);\n bool SeenLocal(const CService& addr);\n bool IsLocal(const CService& addr);\n bool GetLocal(CService &addr, const CNetAddr *paddrPeer = nullptr);\n-CAddress GetLocalAddress(const CNetAddr *paddrPeer, ServiceFlags nLocalServices);\n+CAddress GetLocalAddress(const CNetAddr *paddrPeer);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r919888378",
      "id" : 919888378,
      "in_reply_to_id" : 918613125,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58421GH6",
      "original_commit_id" : "9d9a6677c483772fe636b61480dfdde7d4586073",
      "original_line" : 238,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 1037095536,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919888378/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T10:00:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919888378",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r919936826"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919936826"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm going to push back against this. It's entirely possible that `Peer` picks up some member functions in future, and therefore becomes a class, in which case these data members would be named incorrectly and inconsistently.",
      "commit_id" : "8f6ed20acae2a4f93f5b52c3937ab704980db44b",
      "created_at" : "2022-07-13T10:49:40Z",
      "diff_hunk" : "@@ -207,6 +207,27 @@ struct Peer {\n     /** Same id as the CNode object for this peer */\n     const NodeId m_id{0};\n \n+    /** Services we offered to this peer.\n+     *\n+     *  This is supplied by CConnman during peer initialization. It's const\n+     *  because there is no protocol defined for renegotiating services\n+     *  initially offered to a peer. The set of local services we offer should\n+     *  not change after initialization.\n+     *\n+     *  An interesting example of this is NODE_NETWORK and initial block\n+     *  download: a node which starts up from scratch doesn't have any blocks\n+     *  to serve, but still advertises NODE_NETWORK because it will eventually\n+     *  fulfill this role after IBD completes. P2P code is written in such a\n+     *  way that it can gracefully handle peers who don't make good on their\n+     *  service advertisements.\n+     *\n+     *  TODO: remove redundant CNode::nLocalServices*/\n+    const ServiceFlags m_our_services;\n+    /** Services this peer offered to us.\n+     *\n+     * TODO: remove redundant CNode::nServices */\n+    std::atomic<ServiceFlags> m_their_services{NODE_NONE};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r919936826",
      "id" : 919936826,
      "in_reply_to_id" : 916889865,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58421R86",
      "original_commit_id" : "bd93b709ea4e8e295a3438f30d9d3f6999e7623c",
      "original_line" : 229,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1037160793,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919936826/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T10:49:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919936826",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r919938845"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919938845"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is beginning to feel very mission-creepy, but if you're changing the argument from being a pointer to a ref, then the name of the argument should also change from `pnode` to `node` (p is the prefix for pointer).\r\n\r\nSame comment internally in net_processing for the `InitializeNode()` methods.",
      "commit_id" : "8f6ed20acae2a4f93f5b52c3937ab704980db44b",
      "created_at" : "2022-07-13T10:52:12Z",
      "diff_hunk" : "@@ -625,7 +604,7 @@ class NetEventsInterface\n {\n public:\n     /** Initialize a peer (setup state, queue any initial messages) */\n-    virtual void InitializeNode(CNode* pnode) = 0;\n+    virtual void InitializeNode(CNode& pnode, ServiceFlags our_services) = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r919938845",
      "id" : 919938845,
      "line" : 607,
      "node_id" : "PRRC_kwDOABII58421Scd",
      "original_commit_id" : "8f6ed20acae2a4f93f5b52c3937ab704980db44b",
      "original_line" : 607,
      "original_position" : 107,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 107,
      "pull_request_review_id" : 1037163691,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919938845/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T10:56:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919938845",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r919957561"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919957561"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit in the second commit: Can be removed?",
      "commit_id" : "8f6ed20acae2a4f93f5b52c3937ab704980db44b",
      "created_at" : "2022-07-13T11:16:09Z",
      "diff_hunk" : "@@ -8,13 +8,15 @@\n #include <chainparams.h>\n #include <net.h>\n #include <net_processing.h>\n+#include <netmessagemaker.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r919957561",
      "id" : 919957561,
      "line" : 11,
      "node_id" : "PRRC_kwDOABII58421XA5",
      "original_commit_id" : "e97192fc87e0aae1f9d78b81ddfe5adc514d2cd6",
      "original_line" : 11,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/test/denialofservice_tests.cpp",
      "position" : 4,
      "pull_request_review_id" : 1037190466,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919957561/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T11:54:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919957561",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r919961118"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919961118"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit in the second commit: Can be written shorter as `static_cast<ConnmanTestMsg&>(*m_node.connman)`?",
      "commit_id" : "8f6ed20acae2a4f93f5b52c3937ab704980db44b",
      "created_at" : "2022-07-13T11:20:53Z",
      "diff_hunk" : "@@ -44,11 +46,10 @@ BOOST_FIXTURE_TEST_SUITE(denialofservice_tests, TestingSetup)\n // work.\n BOOST_AUTO_TEST_CASE(outbound_slow_chain_eviction)\n {\n-    auto connman = std::make_unique<CConnman>(0x1337, 0x1337, *m_node.addrman, *m_node.netgroupman);\n+    ConnmanTestMsg& connman = *static_cast<ConnmanTestMsg*>(m_node.connman.get());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r919961118",
      "id" : 919961118,
      "line" : 49,
      "node_id" : "PRRC_kwDOABII58421X4e",
      "original_commit_id" : "e97192fc87e0aae1f9d78b81ddfe5adc514d2cd6",
      "original_line" : 49,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/test/denialofservice_tests.cpp",
      "position" : 21,
      "pull_request_review_id" : 1037190466,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919961118/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T11:54:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919961118",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r919961812"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919961812"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same: no need for get?",
      "commit_id" : "8f6ed20acae2a4f93f5b52c3937ab704980db44b",
      "created_at" : "2022-07-13T11:21:50Z",
      "diff_hunk" : "@@ -44,11 +46,10 @@ BOOST_FIXTURE_TEST_SUITE(denialofservice_tests, TestingSetup)\n // work.\n BOOST_AUTO_TEST_CASE(outbound_slow_chain_eviction)\n {\n-    auto connman = std::make_unique<CConnman>(0x1337, 0x1337, *m_node.addrman, *m_node.netgroupman);\n+    ConnmanTestMsg& connman = *static_cast<ConnmanTestMsg*>(m_node.connman.get());\n     // Disable inactivity checks for this test to avoid interference\n-    static_cast<ConnmanTestMsg*>(connman.get())->SetPeerConnectTimeout(99999s);\n-    auto peerLogic = PeerManager::make(*connman, *m_node.addrman, nullptr,\n-                                       *m_node.chainman, *m_node.mempool, false);\n+    connman.SetPeerConnectTimeout(99999s);\n+    PeerManager& peerman = *m_node.peerman.get();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r919961812",
      "id" : 919961812,
      "line" : 52,
      "node_id" : "PRRC_kwDOABII58421YDU",
      "original_commit_id" : "e97192fc87e0aae1f9d78b81ddfe5adc514d2cd6",
      "original_line" : 52,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/test/denialofservice_tests.cpp",
      "position" : 27,
      "pull_request_review_id" : 1037190466,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919961812/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T11:54:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919961812",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r919963239"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919963239"
         }
      },
      "author_association" : "MEMBER",
      "body" : "second commit: Maybe mention in the commit message that this is a behaviour change that is needed for the next commit? Previously this was NODE_NODE, now it is something else?",
      "commit_id" : "8f6ed20acae2a4f93f5b52c3937ab704980db44b",
      "created_at" : "2022-07-13T11:23:37Z",
      "diff_hunk" : "@@ -63,10 +64,16 @@ BOOST_AUTO_TEST_CASE(outbound_slow_chain_eviction)\n                      /*addrNameIn=*/\"\",\n                      ConnectionType::OUTBOUND_FULL_RELAY,\n                      /*inbound_onion=*/false};\n-    dummyNode1.SetCommonVersion(PROTOCOL_VERSION);\n \n-    peerLogic->InitializeNode(dummyNode1, dummyNode1.GetLocalServices());\n-    dummyNode1.fSuccessfullyConnected = true;\n+    connman.Handshake(\n+        /*node=*/dummyNode1,\n+        /*successfully_connected=*/true,\n+        /*remote_services=*/ServiceFlags(NODE_NETWORK | NODE_WITNESS),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r919963239",
      "id" : 919963239,
      "line" : 70,
      "node_id" : "PRRC_kwDOABII58421YZn",
      "original_commit_id" : "e97192fc87e0aae1f9d78b81ddfe5adc514d2cd6",
      "original_line" : 71,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/test/denialofservice_tests.cpp",
      "position" : 42,
      "pull_request_review_id" : 1037190466,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919963239/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T11:54:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919963239",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r919979340"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919979340"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit in b41c44dcdc49941c4c2e70bcdfdcd8b1d956c69f: Maybe move `m_has_all_wanted_services` down to the other eviction stuff (m_last_tx_time, ...). Otherwise, the comment \"Used for eviction decisions\" will (incorrectly) imply that m_last_send is also used for eviction, when it is currently not.",
      "commit_id" : "8f6ed20acae2a4f93f5b52c3937ab704980db44b",
      "created_at" : "2022-07-13T11:43:24Z",
      "diff_hunk" : "@@ -376,6 +374,8 @@ class CNode\n \n     uint64_t nRecvBytes GUARDED_BY(cs_vRecv){0};\n \n+    /** Whether this peer provides all services that we want. Used for eviction decisions */\n+    std::atomic_bool m_has_all_wanted_services{false};\n     std::atomic<std::chrono::seconds> m_last_send{0s};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r919979340",
      "id" : 919979340,
      "line" : 379,
      "node_id" : "PRRC_kwDOABII58421cVM",
      "original_commit_id" : "b41c44dcdc49941c4c2e70bcdfdcd8b1d956c69f",
      "original_line" : 379,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 22,
      "pull_request_review_id" : 1037190466,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919979340/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T11:54:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919979340",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r919988031"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919988031"
         }
      },
      "author_association" : "MEMBER",
      "body" : "2c38d6b594db08427afaa8609ce3c8495305279f: Is there an explanation why this can be hardcoded to NODE_NONE everywhere? Maybe put commit 8f6ed20acae2a4f93f5b52c3937ab704980db44b before this one to clarify that this is not (supposed?) to change behavior?",
      "commit_id" : "8f6ed20acae2a4f93f5b52c3937ab704980db44b",
      "created_at" : "2022-07-13T11:53:58Z",
      "diff_hunk" : "@@ -236,10 +236,10 @@ bool IsPeerAddrLocalGood(CNode *pnode)\n \n std::optional<CAddress> GetLocalAddrForPeer(CNode *pnode)\n {\n-    CAddress addrLocal = GetLocalAddress(&pnode->addr, pnode->GetLocalServices());\n+    CAddress addrLocal = GetLocalAddress(&pnode->addr);\n     if (gArgs.GetBoolArg(\"-addrmantest\", false)) {\n         // use IPv4 loopback during addrmantest\n-        addrLocal = CAddress(CService(LookupNumeric(\"127.0.0.1\", GetListenPort())), pnode->GetLocalServices());\n+        addrLocal = CAddress(CService(LookupNumeric(\"127.0.0.1\", GetListenPort())), NODE_NONE);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r919988031",
      "id" : 919988031,
      "line" : 240,
      "node_id" : "PRRC_kwDOABII58421ec_",
      "original_commit_id" : "2c38d6b594db08427afaa8609ce3c8495305279f",
      "original_line" : 242,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 26,
      "pull_request_review_id" : 1037190466,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919988031/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T11:54:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919988031",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r920001079"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920001079"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Tested the result when the stats aren't available, which looks good:\r\n\r\n![Screenshot from 2022-07-13 14-07-22](https://user-images.githubusercontent.com/6399679/178730160-c0daf9f4-5f34-4039-a370-be4e4fe055e2.png)\r\n\r\n",
      "commit_id" : "8f6ed20acae2a4f93f5b52c3937ab704980db44b",
      "created_at" : "2022-07-13T12:09:34Z",
      "diff_hunk" : "@@ -1197,6 +1196,7 @@ void RPCConsole::updateDetailWidget()\n     // This check fails for example if the lock was busy and\n     // nodeStateStats couldn't be fetched.\n     if (stats->fNodeStateStatsAvailable) {\n+        ui->peerServices->setText(GUIUtil::formatServicesStr(stats->nodeStateStats.their_services));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r920001079",
      "id" : 920001079,
      "line" : 1199,
      "node_id" : "PRRC_kwDOABII58421ho3",
      "original_commit_id" : "b41c44dcdc49941c4c2e70bcdfdcd8b1d956c69f",
      "original_line" : 1199,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/qt/rpcconsole.cpp",
      "position" : 12,
      "pull_request_review_id" : 1037251274,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920001079/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T12:14:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920001079",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r920221096"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920221096"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "e7aea6ae6d0cd668dc7228cc24d0a58419c6ebcd",
      "created_at" : "2022-07-13T15:30:29Z",
      "diff_hunk" : "@@ -8,13 +8,15 @@\n #include <chainparams.h>\n #include <net.h>\n #include <net_processing.h>\n+#include <netmessagemaker.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r920221096",
      "id" : 920221096,
      "in_reply_to_id" : 919957561,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58422XWo",
      "original_commit_id" : "e97192fc87e0aae1f9d78b81ddfe5adc514d2cd6",
      "original_line" : 11,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/test/denialofservice_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1037567955,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920221096/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T15:30:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920221096",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r920221397"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920221397"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, done.",
      "commit_id" : "e7aea6ae6d0cd668dc7228cc24d0a58419c6ebcd",
      "created_at" : "2022-07-13T15:30:46Z",
      "diff_hunk" : "@@ -44,11 +46,10 @@ BOOST_FIXTURE_TEST_SUITE(denialofservice_tests, TestingSetup)\n // work.\n BOOST_AUTO_TEST_CASE(outbound_slow_chain_eviction)\n {\n-    auto connman = std::make_unique<CConnman>(0x1337, 0x1337, *m_node.addrman, *m_node.netgroupman);\n+    ConnmanTestMsg& connman = *static_cast<ConnmanTestMsg*>(m_node.connman.get());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r920221397",
      "id" : 920221397,
      "in_reply_to_id" : 919961118,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58422XbV",
      "original_commit_id" : "e97192fc87e0aae1f9d78b81ddfe5adc514d2cd6",
      "original_line" : 49,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/test/denialofservice_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1037568370,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920221397/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T15:30:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920221397",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r920222720"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920222720"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It is actually also needed in this commit because `CNode::fClient` and `CNode::m_limited_node` are set during the version handshake. The commit message now mentions this.",
      "commit_id" : "e7aea6ae6d0cd668dc7228cc24d0a58419c6ebcd",
      "created_at" : "2022-07-13T15:32:00Z",
      "diff_hunk" : "@@ -63,10 +64,16 @@ BOOST_AUTO_TEST_CASE(outbound_slow_chain_eviction)\n                      /*addrNameIn=*/\"\",\n                      ConnectionType::OUTBOUND_FULL_RELAY,\n                      /*inbound_onion=*/false};\n-    dummyNode1.SetCommonVersion(PROTOCOL_VERSION);\n \n-    peerLogic->InitializeNode(dummyNode1, dummyNode1.GetLocalServices());\n-    dummyNode1.fSuccessfullyConnected = true;\n+    connman.Handshake(\n+        /*node=*/dummyNode1,\n+        /*successfully_connected=*/true,\n+        /*remote_services=*/ServiceFlags(NODE_NETWORK | NODE_WITNESS),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r920222720",
      "id" : 920222720,
      "in_reply_to_id" : 919963239,
      "line" : 69,
      "node_id" : "PRRC_kwDOABII58422XwA",
      "original_commit_id" : "e97192fc87e0aae1f9d78b81ddfe5adc514d2cd6",
      "original_line" : 69,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/test/denialofservice_tests.cpp",
      "position" : 40,
      "pull_request_review_id" : 1037570283,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920222720/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T15:32:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920222720",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r920222882"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920222882"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "e7aea6ae6d0cd668dc7228cc24d0a58419c6ebcd",
      "created_at" : "2022-07-13T15:32:09Z",
      "diff_hunk" : "@@ -376,6 +374,8 @@ class CNode\n \n     uint64_t nRecvBytes GUARDED_BY(cs_vRecv){0};\n \n+    /** Whether this peer provides all services that we want. Used for eviction decisions */\n+    std::atomic_bool m_has_all_wanted_services{false};\n     std::atomic<std::chrono::seconds> m_last_send{0s};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r920222882",
      "id" : 920222882,
      "in_reply_to_id" : 919979340,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58422Xyi",
      "original_commit_id" : "b41c44dcdc49941c4c2e70bcdfdcd8b1d956c69f",
      "original_line" : 377,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 1037570526,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920222882/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T15:32:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920222882",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r920223514"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920223514"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Switched the order of the commits. `NODE_NONE` is not used anymore now.",
      "commit_id" : "e7aea6ae6d0cd668dc7228cc24d0a58419c6ebcd",
      "created_at" : "2022-07-13T15:32:42Z",
      "diff_hunk" : "@@ -236,10 +236,10 @@ bool IsPeerAddrLocalGood(CNode *pnode)\n \n std::optional<CAddress> GetLocalAddrForPeer(CNode *pnode)\n {\n-    CAddress addrLocal = GetLocalAddress(&pnode->addr, pnode->GetLocalServices());\n+    CAddress addrLocal = GetLocalAddress(&pnode->addr);\n     if (gArgs.GetBoolArg(\"-addrmantest\", false)) {\n         // use IPv4 loopback during addrmantest\n-        addrLocal = CAddress(CService(LookupNumeric(\"127.0.0.1\", GetListenPort())), pnode->GetLocalServices());\n+        addrLocal = CAddress(CService(LookupNumeric(\"127.0.0.1\", GetListenPort())), NODE_NONE);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r920223514",
      "id" : 920223514,
      "in_reply_to_id" : 919988031,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58422X8a",
      "original_commit_id" : "2c38d6b594db08427afaa8609ce3c8495305279f",
      "original_line" : 242,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1037571361,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920223514/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T15:32:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920223514",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r920253209"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920253209"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "e7aea6ae6d0cd668dc7228cc24d0a58419c6ebcd",
      "created_at" : "2022-07-13T15:59:54Z",
      "diff_hunk" : "@@ -625,7 +604,7 @@ class NetEventsInterface\n {\n public:\n     /** Initialize a peer (setup state, queue any initial messages) */\n-    virtual void InitializeNode(CNode* pnode) = 0;\n+    virtual void InitializeNode(CNode& pnode, ServiceFlags our_services) = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r920253209",
      "id" : 920253209,
      "in_reply_to_id" : 919938845,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58422fMZ",
      "original_commit_id" : "8f6ed20acae2a4f93f5b52c3937ab704980db44b",
      "original_line" : 607,
      "original_position" : 107,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 1037613065,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920253209/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T15:59:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920253209",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks @MarcoFalke and @jnewbery for the reviews! I addressed all comments and rebased.\r\n\r\nAll commits should now build without issues.",
      "created_at" : "2022-07-13T16:01:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#issuecomment-1183404460",
      "id" : 1183404460,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25514",
      "node_id" : "IC_kwDOABII585GiVGs",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1183404460/reactions"
      },
      "updated_at" : "2022-07-13T16:01:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1183404460",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r920270916"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920270916"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit in 4c59e37c18b177fc50786de37ffffb52de6daaa7: Only if you retouch, clang-format this line",
      "commit_id" : "e7aea6ae6d0cd668dc7228cc24d0a58419c6ebcd",
      "created_at" : "2022-07-13T16:18:04Z",
      "diff_hunk" : "@@ -206,15 +206,13 @@ static std::vector<CAddress> ConvertSeeds(const std::vector<uint8_t> &vSeedsIn)\n // Otherwise, return the unroutable 0.0.0.0 but filled in with\n // the normal parameters, since the IP may be changed to a useful\n // one by discovery.\n-CAddress GetLocalAddress(const CNetAddr *paddrPeer, ServiceFlags nLocalServices)\n+CService GetLocalAddress(const CNetAddr *paddrPeer)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r920270916",
      "id" : 920270916,
      "line" : 209,
      "node_id" : "PRRC_kwDOABII58422jhE",
      "original_commit_id" : "4c59e37c18b177fc50786de37ffffb52de6daaa7",
      "original_line" : 209,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 5,
      "pull_request_review_id" : 1037637719,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920270916/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T16:43:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920270916",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r920271048"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920271048"
         }
      },
      "author_association" : "MEMBER",
      "body" : "same",
      "commit_id" : "e7aea6ae6d0cd668dc7228cc24d0a58419c6ebcd",
      "created_at" : "2022-07-13T16:18:11Z",
      "diff_hunk" : "@@ -233,12 +231,12 @@ bool IsPeerAddrLocalGood(CNode *pnode)\n            IsReachable(addrLocal.GetNetwork());\n }\n \n-std::optional<CAddress> GetLocalAddrForPeer(CNode *pnode)\n+std::optional<CService> GetLocalAddrForPeer(CNode *pnode)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r920271048",
      "id" : 920271048,
      "line" : 234,
      "node_id" : "PRRC_kwDOABII58422jjI",
      "original_commit_id" : "4c59e37c18b177fc50786de37ffffb52de6daaa7",
      "original_line" : 234,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 25,
      "pull_request_review_id" : 1037637719,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920271048/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T16:43:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920271048",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r920281819"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920281819"
         }
      },
      "author_association" : "MEMBER",
      "body" : "4c59e37c18b177fc50786de37ffffb52de6daaa7: Is this change needed? For me it compiles without.",
      "commit_id" : "e7aea6ae6d0cd668dc7228cc24d0a58419c6ebcd",
      "created_at" : "2022-07-13T16:28:21Z",
      "diff_hunk" : "@@ -262,7 +260,7 @@ std::optional<CAddress> GetLocalAddrForPeer(CNode *pnode)\n     if (addrLocal.IsRoutable() || gArgs.GetBoolArg(\"-addrmantest\", false))\n     {\n         LogPrint(BCLog::NET, \"Advertising address %s to peer=%d\\n\", addrLocal.ToString(), pnode->GetId());\n-        return addrLocal;\n+        return {addrLocal};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r920281819",
      "id" : 920281819,
      "line" : 263,
      "node_id" : "PRRC_kwDOABII58422mLb",
      "original_commit_id" : "4c59e37c18b177fc50786de37ffffb52de6daaa7",
      "original_line" : 263,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 50,
      "pull_request_review_id" : 1037637719,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920281819/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T16:43:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920281819",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r920285352"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920285352"
         }
      },
      "author_association" : "MEMBER",
      "body" : "4c59e37c18b177fc50786de37ffffb52de6daaa7: While touching this method, could switch `*` to `&`? (And remove \"p\")",
      "commit_id" : "e7aea6ae6d0cd668dc7228cc24d0a58419c6ebcd",
      "created_at" : "2022-07-13T16:32:05Z",
      "diff_hunk" : "@@ -144,8 +144,8 @@ enum\n };\n \n bool IsPeerAddrLocalGood(CNode *pnode);\n-/** Returns a local address that we should advertise to this peer */\n-std::optional<CAddress> GetLocalAddrForPeer(CNode *pnode);\n+/** Returns a local address that we should advertise to this peer. */\n+std::optional<CService> GetLocalAddrForPeer(CNode* pnode);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r920285352",
      "id" : 920285352,
      "line" : 148,
      "node_id" : "PRRC_kwDOABII58422nCo",
      "original_commit_id" : "4c59e37c18b177fc50786de37ffffb52de6daaa7",
      "original_line" : 148,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 7,
      "pull_request_review_id" : 1037637719,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920285352/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T16:43:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920285352",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r920285912"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920285912"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same",
      "commit_id" : "e7aea6ae6d0cd668dc7228cc24d0a58419c6ebcd",
      "created_at" : "2022-07-13T16:32:41Z",
      "diff_hunk" : "@@ -163,7 +163,7 @@ void RemoveLocal(const CService& addr);\n bool SeenLocal(const CService& addr);\n bool IsLocal(const CService& addr);\n bool GetLocal(CService &addr, const CNetAddr *paddrPeer = nullptr);\n-CAddress GetLocalAddress(const CNetAddr *paddrPeer, ServiceFlags nLocalServices);\n+CService GetLocalAddress(const CNetAddr* paddrPeer);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r920285912",
      "id" : 920285912,
      "line" : 166,
      "node_id" : "PRRC_kwDOABII58422nLY",
      "original_commit_id" : "4c59e37c18b177fc50786de37ffffb52de6daaa7",
      "original_line" : 166,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 16,
      "pull_request_review_id" : 1037637719,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920285912/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T16:43:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920285912",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@dergoegge just checking that you saw my comment about member naming: https://github.com/bitcoin/bitcoin/pull/25514#discussion_r919936826.",
      "created_at" : "2022-07-14T11:59:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#issuecomment-1184360787",
      "id" : 1184360787,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25514",
      "node_id" : "IC_kwDOABII585Gl-lT",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1184360787/reactions"
      },
      "updated_at" : "2022-07-14T11:59:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1184360787",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r921157668"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921157668"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No its not, reverted.",
      "commit_id" : "8d8eeb422e64ccd08bce92eed2ee9cbbf55ffd67",
      "created_at" : "2022-07-14T13:30:30Z",
      "diff_hunk" : "@@ -262,7 +260,7 @@ std::optional<CAddress> GetLocalAddrForPeer(CNode *pnode)\n     if (addrLocal.IsRoutable() || gArgs.GetBoolArg(\"-addrmantest\", false))\n     {\n         LogPrint(BCLog::NET, \"Advertising address %s to peer=%d\\n\", addrLocal.ToString(), pnode->GetId());\n-        return addrLocal;\n+        return {addrLocal};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r921157668",
      "id" : 921157668,
      "in_reply_to_id" : 920281819,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584258Ak",
      "original_commit_id" : "4c59e37c18b177fc50786de37ffffb52de6daaa7",
      "original_line" : 263,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1038872913,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921157668/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-14T13:30:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921157668",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r921157794"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921157794"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "8d8eeb422e64ccd08bce92eed2ee9cbbf55ffd67",
      "created_at" : "2022-07-14T13:30:38Z",
      "diff_hunk" : "@@ -144,8 +144,8 @@ enum\n };\n \n bool IsPeerAddrLocalGood(CNode *pnode);\n-/** Returns a local address that we should advertise to this peer */\n-std::optional<CAddress> GetLocalAddrForPeer(CNode *pnode);\n+/** Returns a local address that we should advertise to this peer. */\n+std::optional<CService> GetLocalAddrForPeer(CNode* pnode);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r921157794",
      "id" : 921157794,
      "in_reply_to_id" : 920285352,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584258Ci",
      "original_commit_id" : "4c59e37c18b177fc50786de37ffffb52de6daaa7",
      "original_line" : 148,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 1038873123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921157794/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-14T13:30:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921157794",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r921158971"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921158971"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That seems reasonable, re-added the `m_` prefix.",
      "commit_id" : "8d8eeb422e64ccd08bce92eed2ee9cbbf55ffd67",
      "created_at" : "2022-07-14T13:31:47Z",
      "diff_hunk" : "@@ -207,6 +207,27 @@ struct Peer {\n     /** Same id as the CNode object for this peer */\n     const NodeId m_id{0};\n \n+    /** Services we offered to this peer.\n+     *\n+     *  This is supplied by CConnman during peer initialization. It's const\n+     *  because there is no protocol defined for renegotiating services\n+     *  initially offered to a peer. The set of local services we offer should\n+     *  not change after initialization.\n+     *\n+     *  An interesting example of this is NODE_NETWORK and initial block\n+     *  download: a node which starts up from scratch doesn't have any blocks\n+     *  to serve, but still advertises NODE_NETWORK because it will eventually\n+     *  fulfill this role after IBD completes. P2P code is written in such a\n+     *  way that it can gracefully handle peers who don't make good on their\n+     *  service advertisements.\n+     *\n+     *  TODO: remove redundant CNode::nLocalServices*/\n+    const ServiceFlags m_our_services;\n+    /** Services this peer offered to us.\n+     *\n+     * TODO: remove redundant CNode::nServices */\n+    std::atomic<ServiceFlags> m_their_services{NODE_NONE};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#discussion_r921158971",
      "id" : 921158971,
      "in_reply_to_id" : 916889865,
      "line" : 225,
      "node_id" : "PRRC_kwDOABII584258U7",
      "original_commit_id" : "bd93b709ea4e8e295a3438f30d9d3f6999e7623c",
      "original_line" : 225,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 19,
      "pull_request_review_id" : 1038874898,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25514",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921158971/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-14T13:31:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921158971",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 8d8eeb422e64ccd08bce92eed2ee9cbbf55ffd67 ð\r\n\r\n<details><summary>Show signature</summary>\r\n\r\nSignature:\r\n\r\n```\r\n-----BEGIN PGP SIGNED MESSAGE-----\r\nHash: SHA512\r\n\r\nACK 8d8eeb422e64ccd08bce92eed2ee9cbbf55ffd67 ð\r\n-----BEGIN PGP SIGNATURE-----\r\n\r\niQGzBAEBCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\r\npUjJZQv/TaiI8pAKqRBeggxNkZdPjDY4gnn1vJgyfjjDsVu1FrKZBbOm0AxGPmSP\r\no3N2x5ZZWcjIzU6Rmv0aWqxmz1yaHUByF9bHC8PBcfcdnb9ELVePbYApM3pcFZU1\r\nDX/wR1RJcb+m9/h8Kl8f6wQMIHf/2fCuqi10/AX+RqLIgEpIRECnEGaHVE6jGV2k\r\ngI+KDnQRxRBelpSloDK7lnTAOUbU0H9ReeILtpIDM6HNGynC50C2VEj29cSxjBdD\r\nKaqNPbbcHyqXiDM0DhNtFRRWNS8PP2d46xWOK+yWr/sInPpmdns8xsA29s3FwUp0\r\nmqpseRqrfRaFOZRqtDjVX1nxs3JeQNSkxCnJoVFMReWzZcvEe9PO0jZjOrntCAwU\r\ncxJcrNsRlaxkIT3Ty2mKYuoRZKujxXUmHzBD4KOYiLd0DNHX+xCEcEb/aQFQM21g\r\ncLOkVzMe8IDfocPtbKw38HQSHgsh/ppzWM61KBp8vBuI4jTlGY3XUieUFW6mlhgj\r\nvGhOSGp+\r\n=CVY2\r\n-----END PGP SIGNATURE-----\r\n```\r\n\r\n\r\n</details>\r\n",
      "created_at" : "2022-07-14T13:47:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#issuecomment-1184471068",
      "id" : 1184471068,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25514",
      "node_id" : "IC_kwDOABII585GmZgc",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1184471068/reactions"
      },
      "updated_at" : "2022-07-14T13:47:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1184471068",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@dergoegge @jnewbery I am still digging deeper here, but I have a question (and might be terribly wrong). Moving `nServices` and `nLocalServices` into `Peer` seems to imply that the service bits only gain importance during the VERSION/VERACK handshake and are useful in the P2P layer, not in the transport layer.\r\n\r\nHowever, I think service bits (also propagated with addr relay) are useful at the transport layer. For instance in BIP324, the [proposed signaling method](https://gist.github.com/dhruv/5b1275751bc98f3b64bcafce7876b489#signaling-v2-support) uses `nServices` from addr relay to branch logic in the establishment of the transport. Moving the service flags to `net_processing` will mean that I'll end up having to pass a boolean around. Is that an expected and acceptable consequence?",
      "created_at" : "2022-07-22T18:34:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#issuecomment-1192838690",
      "id" : 1192838690,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25514",
      "node_id" : "IC_kwDOABII585HGUYi",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1192838690/reactions"
      },
      "updated_at" : "2022-07-22T20:06:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1192838690",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@dhruv Currently all service bits signal readiness to serve application layer data (blocks, bloom/compact filters, witness data). The BIP324 service bit differs from that as it signals support for a new transport protocol, which would make it the only bit that is needed within our net layer. I would therefore argue that passing around a bool to/within the net layer for the v2 bit seems more appropriate than passing around all service bits.",
      "created_at" : "2022-07-25T11:08:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25514#issuecomment-1193907800",
      "id" : 1193907800,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25514",
      "node_id" : "IC_kwDOABII585HKZZY",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1193907800/reactions"
      },
      "updated_at" : "2022-07-25T11:08:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1193907800",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   }
]
