[
   {
      "author_association" : "MEMBER",
      "body" : "ACK 23db26fc6263e501312bc015d288f502d40cf0c3 -- this change was entirely authored by Pieter Wuille (i only patched `CheckDuplicateKey` and added a trivial unit test). I reviewed and tested it by rebasing #24148 and #24149 on top of it, checking the runtime of the fuzz targets and adapting the targets creating \"random\" nodes.\r\n\r\nAs a mean of comparison here are the runtime of the `miniscript_string` and `miniscript_script` targets on my machine\r\nwith the corpus from `qa-assets` at commit 1e3c7cd69fc06fda49a5286b98069ee5b0d64edc:\r\n- Before: `Done 1046 runs in 10 second(s)` and `Done 2908 runs in 13 second(s)`\r\n- After: `Done 1046 runs in 0 second(s)` and `Done 2908 runs in 6 second(s)`\r\n\r\nThis also made the two targets from #24149 twice as fast on average.",
      "created_at" : "2022-07-04T13:22:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25540#issuecomment-1173816991",
      "id" : 1173816991,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25540",
      "node_id" : "IC_kwDOABII585F9waf",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1173816991/reactions"
      },
      "updated_at" : "2022-07-04T13:23:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1173816991",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think we should also have a limit on the maximum number of nodes we want to tolerate when parsing. For instance we would happily parse at this moment a string so long that i can't upload it on 0bin, and run out of memory. This can be the reason for fuzz crashes too.\r\n\r\nEDIT: added a commit for this, and changed the OP.",
      "created_at" : "2022-07-04T17:26:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25540#issuecomment-1174022857",
      "id" : 1174022857,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25540",
      "node_id" : "IC_kwDOABII585F-irJ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1174022857/reactions"
      },
      "updated_at" : "2022-07-05T10:06:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1174022857",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#24149](https://github.com/bitcoin/bitcoin/pull/24149) (Signing support for Miniscript Descriptors by darosior)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-07-04T17:27:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25540#issuecomment-1174023533",
      "id" : 1174023533,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25540",
      "node_id" : "IC_kwDOABII585F-i1t",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1174023533/reactions"
      },
      "updated_at" : "2022-08-31T07:16:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1174023533",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-07-14T19:42:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25540#issuecomment-1184829985",
      "id" : 1184829985,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25540",
      "node_id" : "IC_kwDOABII585GnxIh",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1184829985/reactions"
      },
      "updated_at" : "2022-07-14T19:42:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1184829985",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased after #24148 was merged.",
      "created_at" : "2022-07-15T08:48:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25540#issuecomment-1185324206",
      "id" : 1185324206,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25540",
      "node_id" : "IC_kwDOABII585Gppyu",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1185324206/reactions"
      },
      "updated_at" : "2022-07-15T08:48:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1185324206",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25540#discussion_r922679146"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25540"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/922679146"
         }
      },
      "author_association" : "MEMBER",
      "body" : "IIUC this limit is specific to Miniscript inside P2WSH. That's the case now for our descriptor implementation. Maybe use `MAX_SCRIPT_SIZE` (10,000) instead? \r\n\r\nSee also Resource Limitations under https://bitcoin.sipa.be/miniscript/",
      "commit_id" : "088e5b0b9317bd1d7c9755fb839b7326d99bc910",
      "created_at" : "2022-07-16T13:15:08Z",
      "diff_hunk" : "@@ -1030,29 +1030,39 @@ inline NodeRef<Key> Parse(Span<const char> in, const Ctx& ctx)\n {\n     using namespace spanparsing;\n \n+    // Account for the number of fragments we started to parse. Any fragment is at least one byte\n+    // long. If we started to parse more than 3600 of them, don't bother continuing: the resulting\n+    // Miniscript would be invalid.\n+    size_t opened_frags = 0;\n+\n     // The two integers are used to hold state for thresh()\n     std::vector<std::tuple<ParseContext, int64_t, int64_t>> to_parse;\n     std::vector<NodeRef<Key>> constructed;\n \n     to_parse.emplace_back(ParseContext::WRAPPED_EXPR, -1, -1);\n \n     while (!to_parse.empty()) {\n+        if (opened_frags > MAX_STANDARD_P2WSH_SCRIPT_SIZE) return {};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25540#discussion_r922679146",
      "id" : 922679146,
      "line" : 1045,
      "node_id" : "PRRC_kwDOABII5842_vdq",
      "original_commit_id" : "088e5b0b9317bd1d7c9755fb839b7326d99bc910",
      "original_line" : 1045,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 16,
      "pull_request_review_id" : 1040993087,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25540",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/922679146/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-16T13:15:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/922679146",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25540#discussion_r922679472"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25540"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/922679472"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm assuming this is useful because it allows performing other checks (like size limit) _before_ checking for duplicates? Is so, maybe say that in the comment.",
      "commit_id" : "088e5b0b9317bd1d7c9755fb839b7326d99bc910",
      "created_at" : "2022-07-16T13:18:25Z",
      "diff_hunk" : "@@ -301,8 +303,13 @@ struct Node {\n     const Type typ;\n     //! Cached script length (computed by CalcScriptLen).\n     const size_t scriptlen;\n-    //! Whether a public key appears more than once in this node.\n-    const bool duplicate_key;\n+    //! Whether a public key appears more than once in this node. This value is initialized\n+    //! by all constructors except the NoDupCheck ones. The NoDupCheck ones skip the\n+    //! computation, requiring it to be done manually by invoking DuplicateKeyCheck().\n+    //! DuplicateKeyCheck(), or a non-NoDupCheck constructor, will compute has_duplicate_keys\n+    //! for all subnodes as well.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25540#discussion_r922679472",
      "id" : 922679472,
      "line" : 310,
      "node_id" : "PRRC_kwDOABII5842_viw",
      "original_commit_id" : "6705b9cb02a9b8340440dfdf460eb5b44bcf3d9f",
      "original_line" : 310,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 19,
      "pull_request_review_id" : 1040993300,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25540",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/922679472/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-16T13:18:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/922679472",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25540#discussion_r923720098"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25540"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/923720098"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 088e5b0b9317bd1d7c9755fb839b7326d99bc910 \"miniscript: upper bound on the size of inputs to consider for parsing\"\r\n\r\nIt seems like this is an unrelated change. I don't see how changing `colon_index` to an optional is related to the size check.",
      "commit_id" : "088e5b0b9317bd1d7c9755fb839b7326d99bc910",
      "created_at" : "2022-07-18T19:03:31Z",
      "diff_hunk" : "@@ -1030,29 +1030,39 @@ inline NodeRef<Key> Parse(Span<const char> in, const Ctx& ctx)\n {\n     using namespace spanparsing;\n \n+    // Account for the number of fragments we started to parse. Any fragment is at least one byte\n+    // long. If we started to parse more than 3600 of them, don't bother continuing: the resulting\n+    // Miniscript would be invalid.\n+    size_t opened_frags = 0;\n+\n     // The two integers are used to hold state for thresh()\n     std::vector<std::tuple<ParseContext, int64_t, int64_t>> to_parse;\n     std::vector<NodeRef<Key>> constructed;\n \n     to_parse.emplace_back(ParseContext::WRAPPED_EXPR, -1, -1);\n \n     while (!to_parse.empty()) {\n+        if (opened_frags > MAX_STANDARD_P2WSH_SCRIPT_SIZE) return {};\n+\n         // Get the current context we are decoding within\n         auto [cur_context, n, k] = to_parse.back();\n         to_parse.pop_back();\n \n         switch (cur_context) {\n         case ParseContext::WRAPPED_EXPR: {\n-            int colon_index = -1;\n-            for (int i = 1; i < (int)in.size(); ++i) {\n+            std::optional<size_t> colon_index{};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25540#discussion_r923720098",
      "id" : 923720098,
      "line" : 1053,
      "node_id" : "PRRC_kwDOABII5843Dtmi",
      "original_commit_id" : "088e5b0b9317bd1d7c9755fb839b7326d99bc910",
      "original_line" : 1053,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 26,
      "pull_request_review_id" : 1042345210,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25540",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/923720098/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-18T19:03:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/923720098",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25540#discussion_r924437096"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25540"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924437096"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In order to avoid explicit cast all around the place i made it a `size_t`, which makes it impossible to use the `-1` magic value. Hence the optional.",
      "commit_id" : "088e5b0b9317bd1d7c9755fb839b7326d99bc910",
      "created_at" : "2022-07-19T12:27:58Z",
      "diff_hunk" : "@@ -1030,29 +1030,39 @@ inline NodeRef<Key> Parse(Span<const char> in, const Ctx& ctx)\n {\n     using namespace spanparsing;\n \n+    // Account for the number of fragments we started to parse. Any fragment is at least one byte\n+    // long. If we started to parse more than 3600 of them, don't bother continuing: the resulting\n+    // Miniscript would be invalid.\n+    size_t opened_frags = 0;\n+\n     // The two integers are used to hold state for thresh()\n     std::vector<std::tuple<ParseContext, int64_t, int64_t>> to_parse;\n     std::vector<NodeRef<Key>> constructed;\n \n     to_parse.emplace_back(ParseContext::WRAPPED_EXPR, -1, -1);\n \n     while (!to_parse.empty()) {\n+        if (opened_frags > MAX_STANDARD_P2WSH_SCRIPT_SIZE) return {};\n+\n         // Get the current context we are decoding within\n         auto [cur_context, n, k] = to_parse.back();\n         to_parse.pop_back();\n \n         switch (cur_context) {\n         case ParseContext::WRAPPED_EXPR: {\n-            int colon_index = -1;\n-            for (int i = 1; i < (int)in.size(); ++i) {\n+            std::optional<size_t> colon_index{};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25540#discussion_r924437096",
      "id" : 924437096,
      "in_reply_to_id" : 923720098,
      "line" : 1053,
      "node_id" : "PRRC_kwDOABII5843Gcpo",
      "original_commit_id" : "088e5b0b9317bd1d7c9755fb839b7326d99bc910",
      "original_line" : 1053,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 26,
      "pull_request_review_id" : 1043346191,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25540",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924437096/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-19T12:27:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924437096",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25540#discussion_r924439827"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25540"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924439827"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The Miniscript code already is P2WSH specifc. We can change this once we implement Tapscript support in Miniscript.",
      "commit_id" : "088e5b0b9317bd1d7c9755fb839b7326d99bc910",
      "created_at" : "2022-07-19T12:29:38Z",
      "diff_hunk" : "@@ -1030,29 +1030,39 @@ inline NodeRef<Key> Parse(Span<const char> in, const Ctx& ctx)\n {\n     using namespace spanparsing;\n \n+    // Account for the number of fragments we started to parse. Any fragment is at least one byte\n+    // long. If we started to parse more than 3600 of them, don't bother continuing: the resulting\n+    // Miniscript would be invalid.\n+    size_t opened_frags = 0;\n+\n     // The two integers are used to hold state for thresh()\n     std::vector<std::tuple<ParseContext, int64_t, int64_t>> to_parse;\n     std::vector<NodeRef<Key>> constructed;\n \n     to_parse.emplace_back(ParseContext::WRAPPED_EXPR, -1, -1);\n \n     while (!to_parse.empty()) {\n+        if (opened_frags > MAX_STANDARD_P2WSH_SCRIPT_SIZE) return {};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25540#discussion_r924439827",
      "id" : 924439827,
      "in_reply_to_id" : 922679146,
      "line" : 1045,
      "node_id" : "PRRC_kwDOABII5843GdUT",
      "original_commit_id" : "088e5b0b9317bd1d7c9755fb839b7326d99bc910",
      "original_line" : 1045,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 16,
      "pull_request_review_id" : 1043348410,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25540",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924439827/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-19T12:29:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924439827",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25540#discussion_r924447459"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25540"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924447459"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It could technically be used for this but it's not the intended purpose: we only ever use it to skip redundant computation.",
      "commit_id" : "088e5b0b9317bd1d7c9755fb839b7326d99bc910",
      "created_at" : "2022-07-19T12:35:57Z",
      "diff_hunk" : "@@ -301,8 +303,13 @@ struct Node {\n     const Type typ;\n     //! Cached script length (computed by CalcScriptLen).\n     const size_t scriptlen;\n-    //! Whether a public key appears more than once in this node.\n-    const bool duplicate_key;\n+    //! Whether a public key appears more than once in this node. This value is initialized\n+    //! by all constructors except the NoDupCheck ones. The NoDupCheck ones skip the\n+    //! computation, requiring it to be done manually by invoking DuplicateKeyCheck().\n+    //! DuplicateKeyCheck(), or a non-NoDupCheck constructor, will compute has_duplicate_keys\n+    //! for all subnodes as well.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25540#discussion_r924447459",
      "id" : 924447459,
      "in_reply_to_id" : 922679472,
      "line" : 310,
      "node_id" : "PRRC_kwDOABII5843GfLj",
      "original_commit_id" : "6705b9cb02a9b8340440dfdf460eb5b44bcf3d9f",
      "original_line" : 310,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 19,
      "pull_request_review_id" : 1043357127,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25540",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924447459/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-19T12:35:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924447459",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "i didn't author this commit, but i don't think it was intentional. I see no reason for duplicating the checks there. I pushed a version removing them.\r\n\r\n*(Sorry, i had forgotten to reply to your question.)*",
      "created_at" : "2022-08-11T09:40:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25540#issuecomment-1211759777",
      "id" : 1211759777,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25540",
      "node_id" : "IC_kwDOABII585IOfyh",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1211759777/reactions"
      },
      "updated_at" : "2022-08-11T09:40:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1211759777",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 9f92de39e126e3655fbcafd0e19d4b31c1ff099d",
      "created_at" : "2022-08-15T19:51:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25540#issuecomment-1215708999",
      "id" : 1215708999,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25540",
      "node_id" : "IC_kwDOABII585Idj9H",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1215708999/reactions"
      },
      "updated_at" : "2022-08-15T19:51:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1215708999",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Pinging @sipa @sanket1729 if you wouldn't mind taking a look? Or perhaps @stickies-v, @jb55, @Sjors since you reviewed #24147?",
      "created_at" : "2022-09-08T15:29:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25540#issuecomment-1240877669",
      "id" : 1240877669,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25540",
      "node_id" : "IC_kwDOABII585J9kpl",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1240877669/reactions"
      },
      "updated_at" : "2022-09-08T15:29:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1240877669",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@darosior See https://github.com/sipa/bitcoin/commits/202209_miniscript_parsesize for a commit that instead of opened fragments computes the actual script size redundantly during string parsing. That's definitely overkill, but it has the advantage of being very sensitively testable. What do you think?",
      "created_at" : "2022-09-12T18:39:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25540#issuecomment-1244144687",
      "id" : 1244144687,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25540",
      "node_id" : "IC_kwDOABII585KKCQv",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1244144687/reactions"
      },
      "updated_at" : "2022-09-12T18:39:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1244144687",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sipa your commit doesn't limit the number of `v:` and `and_v` we allow, so we could still crash/timeout on parsing a large `and_v(and_v(and_v(.......` string.\r\n\r\nI had incorrectly thought about the `and_v` and `v:` in my version by double counting some ops.\r\n\r\nWhat do you think of a simple arbitrary limit on the number of characters in the string instead? Something like `100_000`?",
      "created_at" : "2022-09-14T13:51:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25540#issuecomment-1246796960",
      "id" : 1246796960,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25540",
      "node_id" : "IC_kwDOABII585KUJyg",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1246796960/reactions"
      },
      "updated_at" : "2022-09-14T13:51:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1246796960",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@darosior Good call!\n\nI think there may be another strategy too based on:\n* every \"leaf\" (pk_k, pk_h, hashes, older, after) is a nonzero number of script bytes\n* every combinator with more than 1 argument increases the total number of leaves by at least one, so will increase the total script size by at least 1, even `and_v`.\n* every combinator with 1 argument also increases the script size by at least one, except `v:`, but `v:` cannot be recursed (`vv:` is never valid), so if it happens in a sequence, it has to be interleaved with other things which do add script size.\n\nSo I think a strategy could be similar to the script size counting I'm doing in my current commit, but instead \"borrow\" 1 byte from each leaf, and add it to the combinator that added that leaf to the count.",
      "created_at" : "2022-09-14T14:11:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25540#issuecomment-1246826163",
      "id" : 1246826163,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25540",
      "node_id" : "IC_kwDOABII585KUQ6z",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1246826163/reactions"
      },
      "updated_at" : "2022-09-14T14:11:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1246826163",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I thought about something along these lines as well. By taking a lower bound of `0.5` bytes per fragment (because of `v:`), we could have accounted for half a byte per combinator and nothing for leaf fragments.\r\nBut this becomes an issue when the number of leaf fragments we parse inside a combinator isn't bounded, like in `thresh`.\r\n\r\nSo we are left with having to conditionally account for leaf fragments, as you mention with \"borrowing\". I'm not sure the complexity is worth it, but we could do this on top of my current version. I've pushed a fixup commit implementing this on top of my branch here. Let me know if i'm missing something or if you think your version accurately accounting for fragments' sizes is still preferable (since it's applicable to it as well).",
      "created_at" : "2022-09-14T14:58:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25540#issuecomment-1246897660",
      "id" : 1246897660,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25540",
      "node_id" : "IC_kwDOABII585KUiX8",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1246897660/reactions"
      },
      "updated_at" : "2022-09-14T14:58:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1246897660",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@darosior See added commit in https://github.com/sipa/bitcoin/commits/202209_miniscript_parsesize",
      "created_at" : "2022-09-14T16:09:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25540#issuecomment-1246993412",
      "id" : 1246993412,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25540",
      "node_id" : "IC_kwDOABII585KU5wE",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1246993412/reactions"
      },
      "updated_at" : "2022-09-14T16:09:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1246993412",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@darosior Not sure you saw my commit above, WDYT? It has the property that every fragment increases the `script_size` variable now, with the exception of `v:` (which needs to be interleaved with others), and `0` and `1` (but those are terminal, so other combinators which do increment the variable are needed to even make a space to add a `0` or `1`).\r\n\r\n~~Its comments are outdated, though. I'll update those if desired.~~\r\n\r\nEDIT: squashed and updated comments",
      "created_at" : "2022-09-15T18:25:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25540#issuecomment-1248450573",
      "id" : 1248450573,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25540",
      "node_id" : "IC_kwDOABII585KadgN",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1248450573/reactions"
      },
      "updated_at" : "2022-09-15T19:01:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1248450573",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I picked @sipa's latest commit and squashed mine with it. Although it replicates all the script size calculation, his version indeed gives better assurance that the check is in fact correct. Thanks!\r\n\r\nI ran this branch against the `descriptor_parse` fuzz corpus augmented with the seeds from https://github.com/bitcoin-core/qa-assets/pull/92. I don't hit a timeout anymore, neither did it hit the new assertion that the parsing-time calculation of the script size is correct.\r\n\r\nACK e8cc2e4afc1142aa2b3da19cd5c17deea9963244 -- it's my own PR but most of the code here was written by sipa. I've reviewed and tested it.",
      "created_at" : "2022-09-17T13:20:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25540#issuecomment-1250070603",
      "id" : 1250070603,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25540",
      "node_id" : "IC_kwDOABII585KgpBL",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1250070603/reactions"
      },
      "updated_at" : "2022-09-17T13:20:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1250070603",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   }
]
