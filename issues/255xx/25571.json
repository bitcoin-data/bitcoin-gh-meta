{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "This PR is a second attempt at #19594. This PR has two motivations:\r\n\r\n- Improve code hygiene by eliminating a global variable, `mapBlocksUnknownParent`\r\n- Fix fuzz test OOM when running too long ([see #19594 comment](https://github.com/bitcoin/bitcoin/pull/19594#issuecomment-958801638))\r\n\r\nA minor added advantage is to release `mapBlocksUnknownParent` memory when the reindexing phase is done. The current situation is somewhat similar to a memory leak because this map exists unused for the remaining lifetime of the process. It's true that this map should be empty of data elements after use, but its internal metadata (indexing structures, etc.) can have non-trivial size because there can be many thousands of simultaneous elements in this map.\r\n\r\nThis PR helps our efforts to reduce the use of global variables. This variable isn't just global, it's hidden inside a function (it looks like a local variable but has the `static` attribute).\r\n\r\nThis global variable exists because the `-reindex` processing code calls `LoadExternalBlockFile()` multiple times (once for each block file), but that function must preserve some state between calls (the `mapBlocksUnknownParent` map). This PR fixes this by allocating this map as a local variable in the caller's scope and passing it in on each call. When reindexing completes, the map goes out of scope and is deallocated.\r\n\r\nI tested this manually by reindexing on mainnet and signet. Also, the existing `feature_reindex.py` functional test passes.",
   "closed_at" : "2022-07-29T14:47:42Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
      "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
      "followers_url" : "https://api.github.com/users/fanquake/followers",
      "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/fanquake",
      "id" : 863730,
      "login" : "fanquake",
      "node_id" : "MDQ6VXNlcjg2MzczMA==",
      "organizations_url" : "https://api.github.com/users/fanquake/orgs",
      "received_events_url" : "https://api.github.com/users/fanquake/received_events",
      "repos_url" : "https://api.github.com/users/fanquake/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/fanquake"
   },
   "comments" : 8,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25571/comments",
   "created_at" : "2022-07-08T05:01:57Z",
   "draft" : false,
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25571/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/25571",
   "id" : 1298491176,
   "labels" : [
      {
         "color" : "E6F6D6",
         "default" : false,
         "description" : null,
         "id" : 135961,
         "name" : "Refactoring",
         "node_id" : "MDU6TGFiZWwxMzU5NjE=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25571/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "PR_kwDOABII5847FGWh",
   "number" : 25571,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/25571.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25571",
      "merged_at" : "2022-07-29T14:47:42Z",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/25571.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25571"
   },
   "reactions" : {
      "+1" : 0,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 0,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25571/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "state_reason" : null,
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25571/timeline",
   "title" : "refactor: Make mapBlocksUnknownParent local, and rename it",
   "updated_at" : "2022-07-29T14:57:02Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25571",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
      "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
      "followers_url" : "https://api.github.com/users/LarryRuane/followers",
      "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
      "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/LarryRuane",
      "id" : 8321330,
      "login" : "LarryRuane",
      "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
      "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
      "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
      "repos_url" : "https://api.github.com/users/LarryRuane/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/LarryRuane"
   }
}
