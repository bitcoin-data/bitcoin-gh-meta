[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18498#discussion_r401700973"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18498"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/401700973"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Wouldn't it be confusing to have `add_p2p_connection(..., wait_for_verack=False, sync_with_ping=True)` **not** execute `sync_with_ping()`?",
      "commit_id" : "522bdf647e807a1cc1cb3947c16a9d7e6469612a",
      "created_at" : "2020-04-01T15:23:27Z",
      "diff_hunk" : "@@ -480,7 +480,9 @@ def add_p2p_connection(self, p2p_conn, *, wait_for_verack=True, **kwargs):\n             #\n             # So syncing here is redundant when we only want to send a message, but the cost is low (a few milliseconds)\n             # in comparision to the upside of making tests less fragile and unexpected intermittent errors less likely.\n-            p2p_conn.sync_with_ping()\n+            # Connections may opt out by passing `sync_with_ping=False`.\n+            if sync_with_ping:\n+                p2p_conn.sync_with_ping()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18498#discussion_r401700973",
      "id" : 401700973,
      "line" : 507,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTcwMDk3Mw==",
      "original_commit_id" : "db53a10bd6b3ac5f78e60d3d656a35addbb7d837",
      "original_line" : 507,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : 18,
      "pull_request_review_id" : 385694296,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18498",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-21T13:36:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/401700973",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18498#discussion_r401714203"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18498"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/401714203"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good call. Updated.",
      "commit_id" : "2f6705c00b55a37cb6f5a9f7063df8177de165da",
      "created_at" : "2020-04-01T15:41:08Z",
      "diff_hunk" : "@@ -480,7 +480,9 @@ def add_p2p_connection(self, p2p_conn, *, wait_for_verack=True, **kwargs):\n             #\n             # So syncing here is redundant when we only want to send a message, but the cost is low (a few milliseconds)\n             # in comparision to the upside of making tests less fragile and unexpected intermittent errors less likely.\n-            p2p_conn.sync_with_ping()\n+            # Connections may opt out by passing `sync_with_ping=False`.\n+            if sync_with_ping:\n+                p2p_conn.sync_with_ping()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18498#discussion_r401714203",
      "id" : 401714203,
      "in_reply_to_id" : 401700973,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTcxNDIwMw==",
      "original_commit_id" : "db53a10bd6b3ac5f78e60d3d656a35addbb7d837",
      "original_line" : 485,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : null,
      "pull_request_review_id" : 385710686,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18498",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-01T15:41:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/401714203",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #18726 (test: check misbehavior more independently in p2p_filter.py by robot-visions)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-04-01T17:10:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18498#issuecomment-607376667",
      "id" : 607376667,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18498",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwNzM3NjY2Nw==",
      "updated_at" : "2020-04-22T02:29:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/607376667",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "CI failures seem unrelated.",
      "created_at" : "2020-04-01T22:06:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18498#issuecomment-607513403",
      "id" : 607513403,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18498",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwNzUxMzQwMw==",
      "updated_at" : "2020-04-01T22:06:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/607513403",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18498#discussion_r402346525"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18498"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/402346525"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks for reviewing! I see your point, but I don't see when we would want a connection like that and AFAIK the test suite doesn't currently have a use for it.",
      "commit_id" : "522bdf647e807a1cc1cb3947c16a9d7e6469612a",
      "created_at" : "2020-04-02T14:14:40Z",
      "diff_hunk" : "@@ -480,7 +480,9 @@ def add_p2p_connection(self, p2p_conn, *, wait_for_verack=True, **kwargs):\n             #\n             # So syncing here is redundant when we only want to send a message, but the cost is low (a few milliseconds)\n             # in comparision to the upside of making tests less fragile and unexpected intermittent errors less likely.\n-            p2p_conn.sync_with_ping()\n+            # Connections may opt out by passing `sync_with_ping=False`.\n+            if sync_with_ping:\n+                p2p_conn.sync_with_ping()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18498#discussion_r402346525",
      "id" : 402346525,
      "in_reply_to_id" : 401700973,
      "line" : 507,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjM0NjUyNQ==",
      "original_commit_id" : "db53a10bd6b3ac5f78e60d3d656a35addbb7d837",
      "original_line" : 507,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : 18,
      "pull_request_review_id" : 386468619,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18498",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-21T13:36:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/402346525",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-04-02T19:16:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18498#issuecomment-608053269",
      "id" : 608053269,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18498",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwODA1MzI2OQ==",
      "updated_at" : "2020-04-02T19:16:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/608053269",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18498#discussion_r402635947"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18498"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/402635947"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Instead of explaining how to opt out, it would help to explain *why* someone would want to opt out. Is this a performance improvement? I yes, then it should be quantified.\r\n\r\nOtherwise it seem like added code-complexity that makes tests more fragile and harder to read, write and maintain.",
      "commit_id" : "522bdf647e807a1cc1cb3947c16a9d7e6469612a",
      "created_at" : "2020-04-02T22:37:29Z",
      "diff_hunk" : "@@ -480,7 +480,10 @@ def add_p2p_connection(self, p2p_conn, *, wait_for_verack=True, **kwargs):\n             #\n             # So syncing here is redundant when we only want to send a message, but the cost is low (a few milliseconds)\n             # in comparision to the upside of making tests less fragile and unexpected intermittent errors less likely.\n-            p2p_conn.sync_with_ping()\n+            #\n+            # Connections may opt out by passing `sync_with_ping=False`.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18498#discussion_r402635947",
      "id" : 402635947,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjYzNTk0Nw==",
      "original_commit_id" : "95aebf321cacd5365151be482589b088f6b044a8",
      "original_line" : 484,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : null,
      "pull_request_review_id" : 386825873,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18498",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-21T13:36:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/402635947",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18498#discussion_r403011756"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18498"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403011756"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good idea. Pushed a new version.",
      "commit_id" : "522bdf647e807a1cc1cb3947c16a9d7e6469612a",
      "created_at" : "2020-04-03T13:39:19Z",
      "diff_hunk" : "@@ -480,7 +480,10 @@ def add_p2p_connection(self, p2p_conn, *, wait_for_verack=True, **kwargs):\n             #\n             # So syncing here is redundant when we only want to send a message, but the cost is low (a few milliseconds)\n             # in comparision to the upside of making tests less fragile and unexpected intermittent errors less likely.\n-            p2p_conn.sync_with_ping()\n+            #\n+            # Connections may opt out by passing `sync_with_ping=False`.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18498#discussion_r403011756",
      "id" : 403011756,
      "in_reply_to_id" : 402635947,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzAxMTc1Ng==",
      "original_commit_id" : "95aebf321cacd5365151be482589b088f6b044a8",
      "original_line" : 484,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : null,
      "pull_request_review_id" : 387264125,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18498",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-21T13:36:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403011756",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-04-15T13:13:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18498#issuecomment-614032548",
      "id" : 614032548,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18498",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxNDAzMjU0OA==",
      "updated_at" : "2020-04-15T13:13:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/614032548",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased.",
      "created_at" : "2020-04-21T13:41:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18498#issuecomment-617187756",
      "id" : 617187756,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18498",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxNzE4Nzc1Ng==",
      "updated_at" : "2020-04-21T13:41:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/617187756",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18498#discussion_r413999984"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18498"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/413999984"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit: As a follow-up to @vasild 's comment, would it make sense to consider one of the following, to prevent possible confusion in the future:\r\n\r\n- Raise an assertion error if `wait_for_verack=False, sync_with_ping=True`\r\n- Instead of passing two boolean parameters, pass a single parameter like `sync_behavior` which can take in three values `NONE`, `VERACK_ONLY`, `VERACK_AND_PING`?",
      "commit_id" : "522bdf647e807a1cc1cb3947c16a9d7e6469612a",
      "created_at" : "2020-04-23T17:48:00Z",
      "diff_hunk" : "@@ -480,7 +480,9 @@ def add_p2p_connection(self, p2p_conn, *, wait_for_verack=True, **kwargs):\n             #\n             # So syncing here is redundant when we only want to send a message, but the cost is low (a few milliseconds)\n             # in comparision to the upside of making tests less fragile and unexpected intermittent errors less likely.\n-            p2p_conn.sync_with_ping()\n+            # Connections may opt out by passing `sync_with_ping=False`.\n+            if sync_with_ping:\n+                p2p_conn.sync_with_ping()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18498#discussion_r413999984",
      "id" : 413999984,
      "in_reply_to_id" : 401700973,
      "line" : 507,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk5OTk4NA==",
      "original_commit_id" : "db53a10bd6b3ac5f78e60d3d656a35addbb7d837",
      "original_line" : 507,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : 18,
      "pull_request_review_id" : 399335343,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18498",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T17:53:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/413999984",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/63171930?v=4",
         "events_url" : "https://api.github.com/users/robot-visions/events{/privacy}",
         "followers_url" : "https://api.github.com/users/robot-visions/followers",
         "following_url" : "https://api.github.com/users/robot-visions/following{/other_user}",
         "gists_url" : "https://api.github.com/users/robot-visions/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/robot-visions",
         "id" : 63171930,
         "login" : "robot-visions",
         "node_id" : "MDQ6VXNlcjYzMTcxOTMw",
         "organizations_url" : "https://api.github.com/users/robot-visions/orgs",
         "received_events_url" : "https://api.github.com/users/robot-visions/received_events",
         "repos_url" : "https://api.github.com/users/robot-visions/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/robot-visions/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/robot-visions/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/robot-visions"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Slightly tend to NACK. This is making the tests harder to read (a reader will ask themselves why some calls have the ping disabled explicitly and the call in the very next line does not have it disabled). Also, it is making the tests harder to write or change, because forgetting to update one of the disabled pings to be enabled, when needed, can easily be forgotten. There is no infrastructure in place to catch such mistakes (other than review).\r\n\r\nI think we should make tests easy to read and easy to write, not the opposite.",
      "created_at" : "2020-04-23T18:32:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18498#issuecomment-618576134",
      "id" : 618576134,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18498",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxODU3NjEzNA==",
      "updated_at" : "2020-04-23T18:32:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/618576134",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the feeback. Below I'll try to summarize the different aspects as I (correctly or not) see them.\r\n\r\n#### Full connections by default instead of partial connections\r\n\r\n`add_p2p_connection` was added in March 2017 with 5e5725cc2b5, which means that for the past 3 years the functional test suite using this method was running without forcing full p2p connections (which were made by calling `sync_with_ping`). If I understand correctly, the motivation for fa9064704524a0fd1fa9ea73e was to hopefully reduce spurious test failures in the CI. Nevertheless, ISTM we would ideally prefer to avoid `sync_with_ping` everywhere by default and could verify regularly if it can be reverted without increasing the number of false test negatives.\r\n\r\n#### Allowing the previous default of partial connections\r\n\r\nIt seems we still need a way for tests to make partial connections. One reason is speed/performance: *Waste not;* gains may appear minor, but the functional suite will continue growing and its run time continue to increase, long-term discouraging people from running it and increasing our dependance on centralized third parties. A more immediately interesting reason is, are there tests that might now be false positives, because their partial connection was changed to a full one to reduce false negatives?\r\n\r\n#### Downside of allowing partial connections\r\n\r\nFor 3 years, connections were partial by default and required an additional `sync_with_ping` to become full. Now, connections are full by default and would only require an additional argument be partial. The complexity is roughly equivalent with only the default state changed, but inevitably we need to be able to test various kinds of connections.\r\n\r\nIn the worst case, a test that was using a partial connection might be modified to not longer need it without the author and reviewers noticing (if the changed test required a full connection, it would fail and be noticed/updated). In that worse case, the connection would function the way the functional test suite did for the previous 3 years. Only if the new test fails would it become an issue needing to be addressed (and the fix is trivial).\r\n\r\n#### Implementation of connection types\r\n\r\nI like @robot-visions' suggestion combining the states into one argument. Yes, I looked for cases where a partial connection is a better test or more practical e.g. followed by a sync already. There are likely more of them.",
      "created_at" : "2020-04-24T11:31:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18498#issuecomment-618957581",
      "id" : 618957581,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18498",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxODk1NzU4MQ==",
      "updated_at" : "2020-04-24T11:31:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/618957581",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Question: what changed since March 2017? An increasing number of spurious (maddening, to be sure) CI failures?",
      "created_at" : "2020-04-24T11:38:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18498#issuecomment-618959922",
      "id" : 618959922,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18498",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxODk1OTkyMg==",
      "updated_at" : "2020-04-24T11:38:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/618959922",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Yes, we have a lot of spurious ci failures. No one reports them as bugs or even tries to fix them (except me). Everyone blindly hits the restart button on travis and it is up to me to beat them and save the logs locally. We have bugs reported by travis that crash the whole node, when a miner submits a block: #18742\r\n\r\nI don't think making a handful of tests faster by a few microseconds is going to help in any notiecable way. And with the risk of making the test suite more fragile and missing actual failures, I don't think the unspecified gain [1] is worth the risk.\r\n\r\n[1] Performance improvements need benchmarks to be useful",
      "created_at" : "2020-04-24T11:44:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18498#issuecomment-618962257",
      "id" : 618962257,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18498",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxODk2MjI1Nw==",
      "updated_at" : "2020-04-24T11:44:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/618962257",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Btw, calling it \"partial connection\" implies that this is a different kind of connection or something that the caller can exploit for a test in some way. This is not true. The verack is already in flight and it can't be erased from the wire or changed in any way. If the caller wanted to exploit that intermittent state for a test, the result would be racy. Races are the number one reason that our tests fail.\r\n\r\nIf a test needs the verack to be not send (and requires a \"partial connection\" or whatever the right term for that is), it  can use `CNodeNoVerackIdle`.",
      "created_at" : "2020-04-24T11:50:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18498#issuecomment-618964519",
      "id" : 618964519,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18498",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxODk2NDUxOQ==",
      "updated_at" : "2020-04-24T11:50:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/618964519",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the feedback. I empathize with the burden of the CI failures you're dealing with and the need for robust tests and benchmarks. Robust > speed. Will think about this more.",
      "created_at" : "2020-04-24T11:55:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18498#issuecomment-618966386",
      "id" : 618966386,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18498",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxODk2NjM4Ng==",
      "updated_at" : "2020-04-24T11:55:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/618966386",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   }
]
