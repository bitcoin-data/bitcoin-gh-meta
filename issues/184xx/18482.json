{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "NONE",
   "body" : "Sometimes RPC API stops responding after calling walletpassphrase \r\nUnfortunately I can not exactly reproduce this bug. \r\nI have tried 20 threads with about 100 requests on each with sequential calling walletpassphrase -> listtransactions -> walletpassphrase -> getransactions, but with no luck.   \r\n\r\nObserve it four-five times a day and only restart of node could help. \r\n\r\nIt happens not only for bitcoin wallet on mainnet and testnet, but also for litecoin and bitcoin abc wallets, also for mainnet and testnet\r\n\r\nI could provide additional data such as logs, etc.\r\n\r\n**System information**\r\n\r\nBitcoin Core version v0.19.1\r\nLitecoin Core Daemon version v0.17.1\r\nBitcoin ABC Daemon version v0.19.9.0-2f1adeefb\r\n\r\nOS: Debian 10, Xen guest, SSD\r\n\r\ndebug.log with last call. after that RPC won't response anymore.\r\n\r\n```\r\n2020-03-31T10:17:47Z received: inv (37 bytes) peer=11\r\n2020-03-31T10:17:47Z got inv: tx bc6099be609e8a81e11b1ba53badd401a3361fe70c8a90dd92cc743ab972b32c  new peer=11\r\n2020-03-31T10:17:47Z Requesting witness-tx bc6099be609e8a81e11b1ba53badd401a3361fe70c8a90dd92cc743ab972b32c peer=11\r\n2020-03-31T10:17:47Z sending getdata (37 bytes) peer=11\r\n2020-03-31T10:17:48Z received: tx (247 bytes) peer=11\r\n2020-03-31T10:17:48Z AcceptToMemoryPool: peer=11: accepted bc6099be609e8a81e11b1ba53badd401a3361fe70c8a90dd92cc743ab972b32c (poolsz 10 txn, 13 kB)\r\n2020-03-31T10:17:48Z sending inv (37 bytes) peer=5\r\n2020-03-31T10:17:48Z received: inv (37 bytes) peer=6\r\n2020-03-31T10:17:48Z got inv: tx bc6099be609e8a81e11b1ba53badd401a3361fe70c8a90dd92cc743ab972b32c  have peer=6\r\n2020-03-31T10:17:48Z sending inv (37 bytes) peer=14\r\n2020-03-31T10:17:48Z sending inv (37 bytes) peer=13\r\n2020-03-31T10:17:49Z received: inv (37 bytes) peer=15\r\n2020-03-31T10:17:49Z got inv: tx bc6099be609e8a81e11b1ba53badd401a3361fe70c8a90dd92cc743ab972b32c  have peer=15\r\n2020-03-31T10:17:50Z received: inv (37 bytes) peer=21\r\n2020-03-31T10:17:50Z got inv: tx bc6099be609e8a81e11b1ba53badd401a3361fe70c8a90dd92cc743ab972b32c  have peer=21\r\n2020-03-31T10:17:50Z received: inv (37 bytes) peer=2\r\n2020-03-31T10:17:50Z got inv: tx bc6099be609e8a81e11b1ba53badd401a3361fe70c8a90dd92cc743ab972b32c  have peer=2\r\n2020-03-31T10:17:50Z libevent: epoll_dispatch: epoll_wait reports 1\r\n2020-03-31T10:17:50Z libevent: event_active: 0x561e681d9d08 (fd 9), res 2, callback 0x7fe4fc82e1b0\r\n2020-03-31T10:17:50Z libevent: event_process_active: event: 0x561e681d9d08, EV_READ   call 0x7fe4fc82e1b0\r\n2020-03-31T10:17:50Z libevent: evhttp_get_request_connection: new request from 10.10.1.10:22443 on 52\r\n\r\n2020-03-31T10:17:50Z libevent: Attempting connection to 10.1.1.10:22443\r\n\r\n2020-03-31T10:17:50Z libevent: event_add: event: 0x7fe4e0000b60 (fd -1), EV_READ    call 0x7fe4fc81ff40\r\n2020-03-31T10:17:50Z libevent: event_del: 0x7fe4e0000be0 (fd -1), callback 0x7fe4fc81fb40\r\n2020-03-31T10:17:50Z libevent: event_del: 0x7fe4e0000b60 (fd -1), callback 0x7fe4fc81ff40\r\n2020-03-31T10:17:50Z libevent: event_del: 0x7fe4e0000be0 (fd -1), callback 0x7fe4fc81fb40\r\n2020-03-31T10:17:50Z libevent: event_add: event: 0x7fe4e0000b60 (fd 52), EV_READ    call 0x7fe4fc81ff40\r\n2020-03-31T10:17:50Z libevent: Epoll ADD(1) on fd 52 okay. Old events were 0; read change was 1 (add); write change was 0 (none); close change was 0 (none)\r\n2020-03-31T10:17:50Z libevent: event_add: event: 0x7fe4e0000b60 (fd 52), EV_READ   EV_TIMEOUT call 0x7fe4fc81ff40\r\n2020-03-31T10:17:50Z libevent: event_add: event 0x7fe4e0000b60, timeout in 30 seconds 0 useconds, call 0x7fe4fc81ff40\r\n2020-03-31T10:17:50Z libevent: event_del: 0x7fe4e0000be0 (fd 52), callback 0x7fe4fc81fb40\r\n2020-03-31T10:17:50Z libevent: event_add: event: 0x7fe4e0000b60 (fd 52), EV_READ   EV_TIMEOUT call 0x7fe4fc81ff40\r\n2020-03-31T10:17:50Z libevent: event_add: event 0x7fe4e0000b60, timeout in 30 seconds 0 useconds, call 0x7fe4fc81ff40\r\n2020-03-31T10:17:50Z libevent: timeout_next: event: 0x7fe4bc001f90, in 0 seconds, 4053 useconds\r\n2020-03-31T10:17:50Z libevent: epoll_dispatch: epoll_wait reports 1\r\n2020-03-31T10:17:50Z libevent: event_active: 0x7fe4e0000b60 (fd 52), res 2, callback 0x7fe4fc81ff40\r\n2020-03-31T10:17:50Z libevent: event_process_active: event: 0x7fe4e0000b60, EV_READ   call 0x7fe4fc81ff40\r\n2020-03-31T10:17:50Z libevent: event_add: event: 0x7fe4e0000b60 (fd 52), EV_READ   EV_TIMEOUT call 0x7fe4fc81ff40\r\n2020-03-31T10:17:50Z libevent: event_add: event 0x7fe4e0000b60, timeout in 8206112 seconds 564133 useconds, call 0x7fe4fc81ff40\r\n2020-03-31T10:17:50Z libevent: evhttp_add_header: key: Host val: 10.1.1.5:50000\r\n2020-03-31T10:17:50Z libevent: evhttp_add_header: key: Authorization val: Basic c210L.....dFZnMGE3YVk3MnRGcU9qTzhRVT0=\r\n\r\n2020-03-31T10:17:50Z libevent: evhttp_add_header: key: Accept val: */*\r\n\r\n2020-03-31T10:17:50Z libevent: evhttp_add_header: key: Content-type val: application/json\r\n\r\n2020-03-31T10:17:50Z libevent: evhttp_add_header: key: Content-Length val: 111\r\n\r\n2020-03-31T10:17:50Z libevent: evhttp_read_header: checking for post data on 52\r\n\r\n2020-03-31T10:17:50Z libevent: evhttp_get_body_length: bytes to read: 111 (in buffer 111)\r\n\r\n2020-03-31T10:17:50Z libevent: event_del: 0x7fe4e0000b60 (fd 52), callback 0x7fe4fc81ff40\r\n2020-03-31T10:17:50Z libevent: Epoll DEL(1) on fd 52 okay. Old events were 2; read change was 2 (del); write change was 0 (none); close change was 0 (none)\r\n2020-03-31T10:17:50Z libevent: event_del: 0x7fe4e0000b60 (fd 52), callback 0x7fe4fc81ff40\r\n2020-03-31T10:17:50Z Received a POST request for /wallet/test from 10.1.1.10:22443\r\n2020-03-31T10:17:50Z libevent: timeout_next: event: 0x7fe4bc001f90, in 0 seconds, 4053 useconds\r\n2020-03-31T10:17:50Z ThreadRPCServer method=walletpassphrase user=test\r\n2020-03-31T10:17:50Z libevent: epoll_dispatch: epoll_wait reports 0\r\n2020-03-31T10:17:50Z libevent: timeout_next: event: 0x7fe4bc001f90, in 0 seconds, 4053 useconds\r\n2020-03-31T10:17:50Z libevent: epoll_dispatch: epoll_wait reports 0\r\n2020-03-31T10:17:50Z libevent: event_del: 0x7fe4bc001f90 (fd -1), callback 0x561e66258dd0\r\n2020-03-31T10:17:50Z libevent: timeout_process: event: 0x7fe4bc001f90, call 0x561e66258dd0\r\n2020-03-31T10:17:50Z libevent: event_active: 0x7fe4bc001f90 (fd -1), res 1, callback 0x561e66258dd0\r\n2020-03-31T10:17:50Z libevent: event_del: 0x7fe4bc001f90 (fd -1), callback 0x561e66258dd0\r\n2020-03-31T10:17:50Z libevent: event_process_active: event: 0x7fe4bc001f90,    call 0x561e66258dd0\r\n2020-03-31T10:17:50Z libevent: event_del: 0x7fe4bc001f90 (fd -1), callback 0x561e66258dd0\r\n2020-03-31T10:17:58Z received: ping (8 bytes) peer=109\r\n2020-03-31T10:17:58Z sending pong (8 bytes) peer=109\r\n2020-03-31T10:19:13Z Making feeler connection to [2607:fea8:8460:2b4a::4]:18333\r\n2020-03-31T10:19:13Z trying connection [2607:fea8:8460:2b4a::4]:18333 lastseen=842.8hrs\r\n2020-03-31T10:19:18Z connection to [2607:fea8:8460:2b4a::4]:18333 timeout\r\n2020-03-31T10:20:03Z socket closed\r\n2020-03-31T10:20:03Z disconnecting peer=110\r\n2020-03-31T10:21:10Z Making feeler connection to 54.162.24.231:18333\r\n2020-03-31T10:21:10Z trying connection 54.162.24.231:18333 lastseen=556.7hrs\r\n2020-03-31T10:21:15Z connection to 54.162.24.231:18333 timeout\r\n2020-03-31T10:21:16Z Making feeler connection to 70.24.60.7:18333\r\n2020-03-31T10:21:16Z trying connection 70.24.60.7:18333 lastseen=634.4hrs\r\n2020-03-31T10:21:21Z connection to 70.24.60.7:18333 timeout\r\n2020-03-31T10:21:35Z socket closed\r\n2020-03-31T10:21:35Z disconnecting peer=111\r\n```",
   "closed_at" : "2020-04-06T18:29:54Z",
   "closed_by" : {
      "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
      "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
      "followers_url" : "https://api.github.com/users/laanwj/followers",
      "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/laanwj",
      "id" : 126646,
      "login" : "laanwj",
      "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
      "organizations_url" : "https://api.github.com/users/laanwj/orgs",
      "received_events_url" : "https://api.github.com/users/laanwj/received_events",
      "repos_url" : "https://api.github.com/users/laanwj/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/laanwj"
   },
   "comments" : 20,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18482/comments",
   "created_at" : "2020-03-31T10:53:59Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18482/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/18482",
   "id" : 591003437,
   "labels" : [
      {
         "color" : "FBBAAB",
         "default" : false,
         "description" : null,
         "id" : 64585,
         "name" : "Bug",
         "node_id" : "MDU6TGFiZWw2NDU4NQ==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18482/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDU6SXNzdWU1OTEwMDM0Mzc=",
   "number" : 18482,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "RPC stuck on walletpassphrase call",
   "updated_at" : "2020-04-06T18:29:54Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18482",
   "user" : {
      "avatar_url" : "https://avatars1.githubusercontent.com/u/13569035?v=4",
      "events_url" : "https://api.github.com/users/kryvel/events{/privacy}",
      "followers_url" : "https://api.github.com/users/kryvel/followers",
      "following_url" : "https://api.github.com/users/kryvel/following{/other_user}",
      "gists_url" : "https://api.github.com/users/kryvel/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/kryvel",
      "id" : 13569035,
      "login" : "kryvel",
      "node_id" : "MDQ6VXNlcjEzNTY5MDM1",
      "organizations_url" : "https://api.github.com/users/kryvel/orgs",
      "received_events_url" : "https://api.github.com/users/kryvel/received_events",
      "repos_url" : "https://api.github.com/users/kryvel/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/kryvel/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/kryvel/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/kryvel"
   }
}
