[
   {
      "author_association" : "MEMBER",
      "body" : "@aalness Removed the offtopic replies here, sorry for continuing them. I was lost in a maze of twisty github issues all alike...\n\nEdit: I also took the liberty to clarify your pull request title somewhat.\n",
      "created_at" : "2014-01-23T08:23:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3574#issuecomment-33104927",
      "id" : 33104927,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3574",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDMzMTA0OTI3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/33104927/reactions"
      },
      "updated_at" : "2014-01-23T08:26:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/33104927",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/3574#discussion_r9105833"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/3574"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9105833"
         }
      },
      "author_association" : "NONE",
      "body" : "Can you use 4-space indentation here also below `throw` please.\n",
      "commit_id" : "74ad5868245790c1f6c712c6afaa0d76398d2d7d",
      "created_at" : "2014-01-23T08:42:45Z",
      "diff_hunk" : "@@ -1791,7 +1793,20 @@ Value lockunspent(const Array& params, bool fHelp)\n             throw JSONRPCError(RPC_INVALID_PARAMETER, \"Invalid parameter, vout must be positive\");\n \n         COutPoint outpt(uint256(txid), nOutput);\n+        if (!pwalletMain->IsLockableCoin(outpt)) {\n+            throw JSONRPCError(RPC_INVALID_PARAMETER,\n+                               \"Invalid parameter, expected unspent output belonging to this wallet\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3574#discussion_r9105833",
      "id" : 9105833,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDkxMDU4MzM=",
      "original_commit_id" : "4420f9101511fe922c4bc68c8b0fb2c2632dee61",
      "original_line" : null,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/3574",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9105833/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2014-01-25T00:43:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9105833",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1419649?v=4",
         "events_url" : "https://api.github.com/users/Diapolo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Diapolo/followers",
         "following_url" : "https://api.github.com/users/Diapolo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Diapolo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Diapolo",
         "id" : 1419649,
         "login" : "Diapolo",
         "node_id" : "MDQ6VXNlcjE0MTk2NDk=",
         "organizations_url" : "https://api.github.com/users/Diapolo/orgs",
         "received_events_url" : "https://api.github.com/users/Diapolo/received_events",
         "repos_url" : "https://api.github.com/users/Diapolo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Diapolo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Diapolo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Diapolo"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Does this change require any changes in the GUI coin-control code or do we directly benefit from this change?\n",
      "created_at" : "2014-01-23T20:40:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3574#issuecomment-33166076",
      "id" : 33166076,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3574",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDMzMTY2MDc2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/33166076/reactions"
      },
      "updated_at" : "2014-01-23T20:40:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/33166076",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1419649?v=4",
         "events_url" : "https://api.github.com/users/Diapolo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Diapolo/followers",
         "following_url" : "https://api.github.com/users/Diapolo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Diapolo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Diapolo",
         "id" : 1419649,
         "login" : "Diapolo",
         "node_id" : "MDQ6VXNlcjE0MTk2NDk=",
         "organizations_url" : "https://api.github.com/users/Diapolo/orgs",
         "received_events_url" : "https://api.github.com/users/Diapolo/received_events",
         "repos_url" : "https://api.github.com/users/Diapolo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Diapolo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Diapolo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Diapolo"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Good question. At first read, it looks like the coin-control GUI could theoretically by-pass this new check and lock an unlockable coin. This could be confusing to an RPC user. eg. GUI user locks an unlockable coin, RPC user sees it in the output for listlockunspent and when they try to unlock it via lockunspent it fails due to the coin being unlockable.\n",
      "created_at" : "2014-01-23T20:55:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3574#issuecomment-33167469",
      "id" : 33167469,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3574",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDMzMTY3NDY5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/33167469/reactions"
      },
      "updated_at" : "2014-01-23T20:55:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/33167469",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4391003?v=4",
         "events_url" : "https://api.github.com/users/aalness/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aalness/followers",
         "following_url" : "https://api.github.com/users/aalness/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aalness/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aalness",
         "id" : 4391003,
         "login" : "aalness",
         "node_id" : "MDQ6VXNlcjQzOTEwMDM=",
         "organizations_url" : "https://api.github.com/users/aalness/orgs",
         "received_events_url" : "https://api.github.com/users/aalness/received_events",
         "repos_url" : "https://api.github.com/users/aalness/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aalness/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aalness/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aalness"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "But does the GUI allow it? I think it's pretty locked down in that regard, showing only coins that can be spent (and thus locked). But I may be wrong.\n",
      "created_at" : "2014-01-24T09:17:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3574#issuecomment-33207808",
      "id" : 33207808,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3574",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDMzMjA3ODA4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/33207808/reactions"
      },
      "updated_at" : "2014-01-24T09:17:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/33207808",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Havent tested, but I agree with @laanwj. You check 4 conditions (mapwallet output.n !ispent ismine), coin control calls AvailableCoins, checking the same but even more conditions.\nSo it should never be possible to lock an unlockable coin in the GUI.\n\nI also suggest:\n- The condition when unlocking a coin could simply be, if it is already locked or not. It should always be possible to unlock a coin, if the coin appears in listlockunspent.\n- rename your function IsLockableCoin to IsAvailableCoin.\n  This way the function can also be used in the future for other stuff.\n- make this function IsAvailableCoin very similar to wallet->AvailableCoins, so that it is easy to maintain (I mean the conditions if(!FinalTx...) etc.)\n- put the function below AvailableCoins\n\nThis would be consistent with the GUI, checking the same conditions.\n",
      "created_at" : "2014-01-24T17:25:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3574#issuecomment-33242899",
      "id" : 33242899,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3574",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDMzMjQyODk5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/33242899/reactions"
      },
      "updated_at" : "2014-01-24T17:25:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/33242899",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2814559?v=4",
         "events_url" : "https://api.github.com/users/cozz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/cozz/followers",
         "following_url" : "https://api.github.com/users/cozz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/cozz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/cozz",
         "id" : 2814559,
         "login" : "cozz",
         "node_id" : "MDQ6VXNlcjI4MTQ1NTk=",
         "organizations_url" : "https://api.github.com/users/cozz/orgs",
         "received_events_url" : "https://api.github.com/users/cozz/received_events",
         "repos_url" : "https://api.github.com/users/cozz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/cozz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/cozz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/cozz"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Ah, good feedback @cozz. Will make those changes. Thanks.\n",
      "created_at" : "2014-01-24T21:01:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3574#issuecomment-33260409",
      "id" : 33260409,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3574",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDMzMjYwNDA5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/33260409/reactions"
      },
      "updated_at" : "2014-01-24T21:01:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/33260409",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4391003?v=4",
         "events_url" : "https://api.github.com/users/aalness/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aalness/followers",
         "following_url" : "https://api.github.com/users/aalness/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aalness/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aalness",
         "id" : 4391003,
         "login" : "aalness",
         "node_id" : "MDQ6VXNlcjQzOTEwMDM=",
         "organizations_url" : "https://api.github.com/users/aalness/orgs",
         "received_events_url" : "https://api.github.com/users/aalness/received_events",
         "repos_url" : "https://api.github.com/users/aalness/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aalness/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aalness/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aalness"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@cozz I incorporated your feedback but note the semantic implication:\n\nlockunspent lock=true for an already locked coin would now throw an error.\nlockunspent unlock=true for an already unlocked coin would now throw an error.\n\nPreviously, the behavior was:\n\nlockunspent lock=true for an already locked coin returns true.\nlockunspent unlock=true for an already unlocked coin would return true.\n\nI think a case could be made for either behavior but I want to point it out in case this violates a convention I'm unaware of. Or if it's particularly distasteful to anyone.\n",
      "created_at" : "2014-01-25T00:51:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3574#issuecomment-33275793",
      "id" : 33275793,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3574",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDMzMjc1Nzkz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/33275793/reactions"
      },
      "updated_at" : "2014-01-25T00:58:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/33275793",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4391003?v=4",
         "events_url" : "https://api.github.com/users/aalness/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aalness/followers",
         "following_url" : "https://api.github.com/users/aalness/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aalness/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aalness",
         "id" : 4391003,
         "login" : "aalness",
         "node_id" : "MDQ6VXNlcjQzOTEwMDM=",
         "organizations_url" : "https://api.github.com/users/aalness/orgs",
         "received_events_url" : "https://api.github.com/users/aalness/received_events",
         "repos_url" : "https://api.github.com/users/aalness/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aalness/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aalness/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aalness"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@aalness yes, maybe in the case \"lockunspent lock=true for an already locked coin\",\nshow a different error message like \"coin already locked\". But throw an error is fine with me.\n\nCode looks good, not sure what the core devs opinion is on this. So lets wait for another opinion here...\n",
      "created_at" : "2014-01-25T02:42:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3574#issuecomment-33279151",
      "id" : 33279151,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3574",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDMzMjc5MTUx",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/33279151/reactions"
      },
      "updated_at" : "2014-01-25T02:42:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/33279151",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2814559?v=4",
         "events_url" : "https://api.github.com/users/cozz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/cozz/followers",
         "following_url" : "https://api.github.com/users/cozz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/cozz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/cozz",
         "id" : 2814559,
         "login" : "cozz",
         "node_id" : "MDQ6VXNlcjI4MTQ1NTk=",
         "organizations_url" : "https://api.github.com/users/cozz/orgs",
         "received_events_url" : "https://api.github.com/users/cozz/received_events",
         "repos_url" : "https://api.github.com/users/cozz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/cozz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/cozz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/cozz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/3574#discussion_r9171174"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/3574"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9171174"
         }
      },
      "author_association" : "MEMBER",
      "body" : "So now we have coin.IsAvailable as well as CWallet::IsAvailableCoin? I think that's a bit confusing.\n",
      "commit_id" : "74ad5868245790c1f6c712c6afaa0d76398d2d7d",
      "created_at" : "2014-01-25T11:39:33Z",
      "diff_hunk" : "@@ -1029,26 +1043,45 @@ void CWallet::AvailableCoins(vector<COutput>& vCoins, bool fOnlyConfirmed, const\n         for (map<uint256, CWalletTx>::const_iterator it = mapWallet.begin(); it != mapWallet.end(); ++it)\n         {\n             const CWalletTx* pcoin = &(*it).second;\n-\n-            if (!IsFinalTx(*pcoin))\n-                continue;\n-\n-            if (fOnlyConfirmed && !pcoin->IsConfirmed())\n-                continue;\n-\n-            if (pcoin->IsCoinBase() && pcoin->GetBlocksToMaturity() > 0)\n+            if (!pcoin->IsAvailable(fOnlyConfirmed))\n                 continue;\n-\n-            for (unsigned int i = 0; i < pcoin->vout.size(); i++) {\n-                if (!(pcoin->IsSpent(i)) && IsMine(pcoin->vout[i]) &&\n-                    !IsLockedCoin((*it).first, i) && pcoin->vout[i].nValue > 0 &&\n-                    (!coinControl || !coinControl->HasSelected() || coinControl->IsSelected((*it).first, i)))\n-                        vCoins.push_back(COutput(pcoin, i, pcoin->GetDepthInMainChain()));\n+            \n+            for (unsigned int i = 0; i < pcoin->vout.size(); i++)\n+            {\n+                if (IsAvailableCoin(*pcoin, (*it).first, i, coinControl))\n+                    vCoins.push_back(COutput(pcoin, i, pcoin->GetDepthInMainChain()));\n             }\n         }\n     }\n }\n \n+bool CWallet::IsAvailableCoin(const COutPoint& output, bool fCheckConfirmed) const\n+{\n+    AssertLockHeld(cs_wallet); // mapWallet\n+    \n+    map<uint256, CWalletTx>::const_iterator it = mapWallet.find(output.hash);\n+    if (it == mapWallet.end())\n+        return false;\n+    \n+    const CWalletTx& coin = (*it).second;\n+    if (!coin.IsAvailable(fCheckConfirmed))\n+        return false;\n+    \n+    return IsAvailableCoin(coin, output.hash, output.n, NULL);\n+}\n+\n+bool CWallet::IsAvailableCoin(const CWalletTx& coin, uint256 hash, unsigned int n, const CCoinControl *coinControl) const\n+{\n+    // It's assumed the caller has tested coin.IsAvailable().",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3574#discussion_r9171174",
      "id" : 9171174,
      "line" : 1075,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDkxNzExNzQ=",
      "original_commit_id" : "74ad5868245790c1f6c712c6afaa0d76398d2d7d",
      "original_line" : null,
      "original_position" : 68,
      "original_start_line" : null,
      "path" : "src/wallet.cpp",
      "position" : 68,
      "pull_request_review_id" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/3574",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9171174/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2014-01-25T11:39:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9171174",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@laanwj yes, so maybe not touch AvailableCoins at all. And just introduce 1 new function IsAvailableCoin, duplicating all the necessary logic. Just like IsLockableCoin before. Thats what I meant initially. Would also be easier to review and to compare. What do you think?\n",
      "created_at" : "2014-01-25T18:25:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3574#issuecomment-33295871",
      "id" : 33295871,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3574",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDMzMjk1ODcx",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/33295871/reactions"
      },
      "updated_at" : "2014-01-25T18:25:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/33295871",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2814559?v=4",
         "events_url" : "https://api.github.com/users/cozz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/cozz/followers",
         "following_url" : "https://api.github.com/users/cozz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/cozz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/cozz",
         "id" : 2814559,
         "login" : "cozz",
         "node_id" : "MDQ6VXNlcjI4MTQ1NTk=",
         "organizations_url" : "https://api.github.com/users/cozz/orgs",
         "received_events_url" : "https://api.github.com/users/cozz/received_events",
         "repos_url" : "https://api.github.com/users/cozz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/cozz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/cozz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/cozz"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@laanwj yeah, that's fair. It bothered me slightly too, although, it seemed to be a bit of an existing convention to call a CWalletTx a \"coin\" or \"pcoin\". Do you think it would be less confusing to simply change the variable to \"wtx\"? Can you think of a better way to describe a transaction in this state, as opposed to \"available\"? Or would you just prefer that I remove the method altogether?\n\n@cozz I do like the property that IsAvailableCoin and AvailableCoins now share the same exact code. It seems like a stronger guarantee that the GUI and listunspent stay consistent with lockunspent.\n",
      "created_at" : "2014-01-25T22:35:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3574#issuecomment-33302797",
      "id" : 33302797,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3574",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDMzMzAyNzk3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/33302797/reactions"
      },
      "updated_at" : "2014-01-25T22:35:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/33302797",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4391003?v=4",
         "events_url" : "https://api.github.com/users/aalness/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aalness/followers",
         "following_url" : "https://api.github.com/users/aalness/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aalness/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aalness",
         "id" : 4391003,
         "login" : "aalness",
         "node_id" : "MDQ6VXNlcjQzOTEwMDM=",
         "organizations_url" : "https://api.github.com/users/aalness/orgs",
         "received_events_url" : "https://api.github.com/users/aalness/received_events",
         "repos_url" : "https://api.github.com/users/aalness/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aalness/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aalness/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aalness"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@aalness Needs rebase\n",
      "created_at" : "2014-02-21T17:05:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3574#issuecomment-35750507",
      "id" : 35750507,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3574",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM1NzUwNTA3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/35750507/reactions"
      },
      "updated_at" : "2014-02-21T17:05:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/35750507",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Automatic sanity-testing: FAILED MERGE, see http://jenkins.bluematt.me/pull-tester/p3574_74ad5868245790c1f6c712c6afaa0d76398d2d7d/ for test log.\n\nThis pull does not merge cleanly onto current master\nThis test script verifies pulls every time they are updated. It, however, dies sometimes and fails to test properly.  If you are waiting on a test, please check timestamps to verify that the test.log is moving at http://jenkins.bluematt.me/pull-tester/current/\nContact BlueMatt on freenode if something looks broken.\n",
      "created_at" : "2014-06-23T16:18:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3574#issuecomment-46866912",
      "id" : 46866912,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3574",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2ODY2OTEy",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/46866912/reactions"
      },
      "updated_at" : "2014-06-23T16:18:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/46866912",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2110907?v=4",
         "events_url" : "https://api.github.com/users/BitcoinPullTester/events{/privacy}",
         "followers_url" : "https://api.github.com/users/BitcoinPullTester/followers",
         "following_url" : "https://api.github.com/users/BitcoinPullTester/following{/other_user}",
         "gists_url" : "https://api.github.com/users/BitcoinPullTester/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/BitcoinPullTester",
         "id" : 2110907,
         "login" : "BitcoinPullTester",
         "node_id" : "MDQ6VXNlcjIxMTA5MDc=",
         "organizations_url" : "https://api.github.com/users/BitcoinPullTester/orgs",
         "received_events_url" : "https://api.github.com/users/BitcoinPullTester/received_events",
         "repos_url" : "https://api.github.com/users/BitcoinPullTester/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/BitcoinPullTester/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/BitcoinPullTester/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/BitcoinPullTester"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Closing this pull as it appears to be inactive. If you intend to resume working on this, let me know.\n",
      "created_at" : "2014-06-24T14:45:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3574#issuecomment-46980317",
      "id" : 46980317,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3574",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2OTgwMzE3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/46980317/reactions"
      },
      "updated_at" : "2014-06-24T14:45:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/46980317",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
