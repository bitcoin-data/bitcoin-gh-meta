[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@ryanofsky w/re https://github.com/bitcoin/bitcoin/pull/21391#discussion_r597163828\r\nI've simplified the changes a bit and it may be a bit easier to review now, see commits:\r\n- 3460a07d88d841c009e7b7efc0be2ae89bb4a63e\r\n- 3b75ec491a68eb6fb137c2f829e7dde93b3c3189",
      "created_at" : "2021-03-24T20:36:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21525#issuecomment-806169911",
      "id" : 806169911,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21525",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwNjE2OTkxMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-24T20:36:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/806169911",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #21061 ([p2p] Introduce node rebroadcast module by amitiuttarwar)\n* #20295 (rpc: getblockfrompeer by Sjors)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-03-24T21:38:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21525#issuecomment-806202814",
      "id" : 806202814,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21525",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwNjIwMjgxNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-24T21:38:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/806202814",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Pushed 3b75ec491a68eb6fb137c2f829e7dde93b3c3189 -> 693414d27181cf967f787a2ca72344e52c58c7f0\r\n- Addressed https://github.com/bitcoin/bitcoin/pull/21391#pullrequestreview-624405217",
      "created_at" : "2021-03-30T17:55:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21525#issuecomment-810460139",
      "id" : 810460139,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21525",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMDQ2MDEzOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-30T17:55:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/810460139",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21525#discussion_r605480513"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21525"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/605480513"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Any reason to use the global here and not `m_node.chainman->ActiveChainstate()`?",
      "commit_id" : "693414d27181cf967f787a2ca72344e52c58c7f0",
      "created_at" : "2021-04-01T08:44:30Z",
      "diff_hunk" : "@@ -244,7 +244,7 @@ CBlock TestChain100Setup::CreateAndProcessBlock(const std::vector<CMutableTransa\n {\n     const CChainParams& chainparams = Params();\n     CTxMemPool empty_pool;\n-    CBlock block = BlockAssembler(empty_pool, chainparams).CreateNewBlock(scriptPubKey)->block;\n+    CBlock block = BlockAssembler(::ChainstateActive(), empty_pool, chainparams).CreateNewBlock(scriptPubKey)->block;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21525#discussion_r605480513",
      "id" : 605480513,
      "line" : 247,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNTQ4MDUxMw==",
      "original_commit_id" : "7b8e976cd5ac78a22f1be2b2fed8562c693af5d9",
      "original_line" : 247,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/util/setup_common.cpp",
      "position" : 5,
      "pull_request_review_id" : 626032477,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21525",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-01T08:58:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/605480513",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21525#discussion_r605480590"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21525"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/605480590"
         }
      },
      "author_association" : "MEMBER",
      "body" : "node.chainman->ActiveChainstate()",
      "commit_id" : "693414d27181cf967f787a2ca72344e52c58c7f0",
      "created_at" : "2021-04-01T08:44:36Z",
      "diff_hunk" : "@@ -41,7 +41,7 @@ CTxIn MineBlock(const NodeContext& node, const CScript& coinbase_scriptPubKey)\n std::shared_ptr<CBlock> PrepareBlock(const NodeContext& node, const CScript& coinbase_scriptPubKey)\n {\n     auto block = std::make_shared<CBlock>(\n-        BlockAssembler{*Assert(node.mempool), Params()}\n+        BlockAssembler{::ChainstateActive(), *Assert(node.mempool), Params()}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21525#discussion_r605480590",
      "id" : 605480590,
      "line" : 44,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNTQ4MDU5MA==",
      "original_commit_id" : "7b8e976cd5ac78a22f1be2b2fed8562c693af5d9",
      "original_line" : 44,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/util/mining.cpp",
      "position" : 6,
      "pull_request_review_id" : 626032477,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21525",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-01T08:58:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/605480590",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21525#discussion_r605480666"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21525"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/605480666"
         }
      },
      "author_association" : "MEMBER",
      "body" : "m_node.chainman->ActiveChainstate()",
      "commit_id" : "693414d27181cf967f787a2ca72344e52c58c7f0",
      "created_at" : "2021-04-01T08:44:43Z",
      "diff_hunk" : "@@ -44,7 +44,7 @@ BlockAssembler MinerTestingSetup::AssemblerForTest(const CChainParams& params)\n \n     options.nBlockMaxWeight = MAX_BLOCK_WEIGHT;\n     options.blockMinFeeRate = blockMinFeeRate;\n-    return BlockAssembler(*m_node.mempool, params, options);\n+    return BlockAssembler(::ChainstateActive(), *m_node.mempool, params, options);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21525#discussion_r605480666",
      "id" : 605480666,
      "line" : 47,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNTQ4MDY2Ng==",
      "original_commit_id" : "7b8e976cd5ac78a22f1be2b2fed8562c693af5d9",
      "original_line" : 47,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/miner_tests.cpp",
      "position" : 5,
      "pull_request_review_id" : 626032477,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21525",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-01T08:58:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/605480666",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21525#discussion_r605480745"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21525"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/605480745"
         }
      },
      "author_association" : "MEMBER",
      "body" : "m_node.chainman->ActiveChainstate()",
      "commit_id" : "693414d27181cf967f787a2ca72344e52c58c7f0",
      "created_at" : "2021-04-01T08:44:51Z",
      "diff_hunk" : "@@ -62,7 +62,7 @@ CBlock BuildChainTestingSetup::CreateBlock(const CBlockIndex* prev,\n     const CScript& scriptPubKey)\n {\n     const CChainParams& chainparams = Params();\n-    std::unique_ptr<CBlockTemplate> pblocktemplate = BlockAssembler(*m_node.mempool, chainparams).CreateNewBlock(scriptPubKey);\n+    std::unique_ptr<CBlockTemplate> pblocktemplate = BlockAssembler(::ChainstateActive(), *m_node.mempool, chainparams).CreateNewBlock(scriptPubKey);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21525#discussion_r605480745",
      "id" : 605480745,
      "line" : 65,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNTQ4MDc0NQ==",
      "original_commit_id" : "7b8e976cd5ac78a22f1be2b2fed8562c693af5d9",
      "original_line" : 65,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/blockfilter_index_tests.cpp",
      "position" : 5,
      "pull_request_review_id" : 626032477,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21525",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-01T08:58:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/605480745",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21525#discussion_r605481488"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21525"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/605481488"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Any reason to take mempool from the `node` and the chainstate from the global?",
      "commit_id" : "693414d27181cf967f787a2ca72344e52c58c7f0",
      "created_at" : "2021-04-01T08:45:59Z",
      "diff_hunk" : "@@ -748,7 +748,7 @@ static RPCHelpMan getblocktemplate()\n \n         // Create new block\n         CScript scriptDummy = CScript() << OP_TRUE;\n-        pblocktemplate = BlockAssembler(mempool, Params()).CreateNewBlock(scriptDummy);\n+        pblocktemplate = BlockAssembler(::ChainstateActive(), mempool, Params()).CreateNewBlock(scriptDummy);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21525#discussion_r605481488",
      "id" : 605481488,
      "line" : 751,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNTQ4MTQ4OA==",
      "original_commit_id" : "7b8e976cd5ac78a22f1be2b2fed8562c693af5d9",
      "original_line" : 751,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/rpc/mining.cpp",
      "position" : 23,
      "pull_request_review_id" : 626032477,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21525",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-01T08:58:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/605481488",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21525#discussion_r605482327"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21525"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/605482327"
         }
      },
      "author_association" : "MEMBER",
      "body" : "same",
      "commit_id" : "693414d27181cf967f787a2ca72344e52c58c7f0",
      "created_at" : "2021-04-01T08:47:17Z",
      "diff_hunk" : "@@ -358,7 +358,7 @@ static RPCHelpMan generateblock()\n         LOCK(cs_main);\n \n         CTxMemPool empty_mempool;\n-        std::unique_ptr<CBlockTemplate> blocktemplate(BlockAssembler(empty_mempool, chainparams).CreateNewBlock(coinbase_script));\n+        std::unique_ptr<CBlockTemplate> blocktemplate(BlockAssembler(::ChainstateActive(), empty_mempool, chainparams).CreateNewBlock(coinbase_script));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21525#discussion_r605482327",
      "id" : 605482327,
      "line" : 361,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNTQ4MjMyNw==",
      "original_commit_id" : "7b8e976cd5ac78a22f1be2b2fed8562c693af5d9",
      "original_line" : 361,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/rpc/mining.cpp",
      "position" : 14,
      "pull_request_review_id" : 626032477,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21525",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-01T08:58:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/605482327",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21525#discussion_r605484142"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21525"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/605484142"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Commit body could mention that this can be reviewed with `--color-moved=dimmed-zebra --color-moved-ws=ignore-all-space`?",
      "commit_id" : "693414d27181cf967f787a2ca72344e52c58c7f0",
      "created_at" : "2021-04-01T08:49:53Z",
      "diff_hunk" : "@@ -475,19 +475,70 @@ class PeerManagerImpl final : public PeerManager\n     /** Offset into vExtraTxnForCompact to insert the next tx */\n     size_t vExtraTxnForCompactIt GUARDED_BY(g_cs_orphans) = 0;\n \n+    /** Check whether the last unknown block a peer advertised is not yet known. */\n     void ProcessBlockAvailability(NodeId nodeid) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+    /** Update tracking information about which blocks a peer is assumed to have. */\n     void UpdateBlockAvailability(NodeId nodeid, const uint256& hash) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n     bool CanDirectFetch() EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+\n+    /**\n+     * To prevent fingerprinting attacks, only send blocks/headers outside of\n+     * the active chain if they are no more than a month older (both in time,\n+     * and in best equivalent proof of work) than the best header chain we know\n+     * about and we fully-validated them at some point.\n+     */\n     bool BlockRequestAllowed(const CBlockIndex* pindex) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n     bool AlreadyHaveBlock(const uint256& block_hash) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n     void ProcessGetBlockData(CNode& pfrom, Peer& peer, const CInv& inv);\n+\n+    /**\n+     * Validation logic for compact filters request handling.\n+     *\n+     * May disconnect from the peer in the case of a bad request.\n+     *\n+     * @param[in]   peer            The peer that we received the request from\n+     * @param[in]   filter_type     The filter type the request is for. Must be basic filters.\n+     * @param[in]   start_height    The start height for the request\n+     * @param[in]   stop_hash       The stop_hash for the request\n+     * @param[in]   max_height_diff The maximum number of items permitted to request, as specified in BIP 157\n+     * @param[out]  stop_index      The CBlockIndex for the stop_hash block, if the request can be serviced.\n+     * @param[out]  filter_index    The filter index, if the request can be serviced.\n+     * @return                      True if the request can be serviced.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21525#discussion_r605484142",
      "id" : 605484142,
      "line" : 506,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNTQ4NDE0Mg==",
      "original_commit_id" : "1dd8ed7a8491e51b76eeb236b15b794d9254f674",
      "original_line" : 506,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 32,
      "pull_request_review_id" : 626032477,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21525",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-01T08:58:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/605484142",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Left some suggestions for bundle 4.75\r\n\r\n\r\nreview ACK 693414d27181cf967f787a2ca72344e52c58c7f0 ð\r\n\r\n<details><summary>Show signature and timestamp</summary>\r\n\r\nSignature:\r\n\r\n```\r\n-----BEGIN PGP SIGNED MESSAGE-----\r\nHash: SHA512\r\n\r\nreview ACK 693414d27181cf967f787a2ca72344e52c58c7f0 ð\r\n-----BEGIN PGP SIGNATURE-----\r\n\r\niQGzBAEBCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\r\npUgGPQwAuhB3nTeI9D7jHjXnmRdMdr3YUwXpCQTpDGxysZm7t2S4vmSsJajBJDN5\r\ne6CYQj/Bi0ZwTognO4SBoxkf9jJBJl/pKtNOrdDr9CEwVUkLTFOSkYCLclg40Vw5\r\nz7FmMX6GsO6YIs5rZhJrQcFfeGAtRiHjW4FBZ397xCr9ol32HZJZoN7TIBShmYda\r\nQ1KHZb2bwDZdkjBFVI8jatIsIwioVRJZ99EU2FxFX6K6Ma36uDXVFLiRDcHK3mKe\r\nHFzChWEP0DOu7Soy9NY2aproiPwiV7y+YZXcgNF9DWRrzGVFifO5fqx+xIimxalh\r\nlRsPUqULdZf2GF0+TGar1w/NC7HAU5tBdbQDO04twYBe3N6+1Wg8yNYfMnb6JmGH\r\nLWAU7JTAQ3t+x7iwYN5N+46fTFrair3j5y/NNCnsOBnH8TDvO/xEDlBgE/30fArG\r\ngz/n/BZ6FAwJb7bZDXdAJBVVmYEDSmCL/fh6Efwg+64ODtHBfFE/dKiQS+uA4JW3\r\nKOBu1ZhV\r\n=fRev\r\n-----END PGP SIGNATURE-----\r\n```\r\n\r\n[Timestamp of file with hash `011488e624ba1f6bc94c50a176ab89a375fd25e7786cc3f970aac8152f9c753b  -`](https://opentimestamps.org/info/?004f70656e54696d657374616d7073000050726f6f6600bf89e2e884e892940108011488e624ba1f6bc94c50a176ab89a375fd25e7786cc3f970aac8152f9c753bf01042e87c26b6d2fb0c7eb5b42e3f937a6208fff010659f2f2617b90f765a210b24f0cae67708f0204af19159e735844573030a873906eb45319d8e624733c95b45c014d9ce4f319108f10460658af1f0089190417836085df70083dfe30d2ef90c8e2e2d68747470733a2f2f616c6963652e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267fff010d1e400ceef9dc564244018032005a9fa08f10460658af1f008658b23eec666008b0083dfe30d2ef90c8e2c2b68747470733a2f2f626f622e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267f010e1f74242c9bd4af16a180312d8b4d19208f020f02138335a1efa10d68796ff9506ffbf6d8bffa1c60fcffbcb2d9a079aa1d88708f10460657d1af008f6238cc80a6caf870083dfe30d2ef90c8e292868747470733a2f2f66696e6e65792e63616c656e6461722e657465726e69747977616c6c2e636f6d)\r\n\r\n</details>\r\n",
      "created_at" : "2021-04-01T08:58:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21525#issuecomment-811762771",
      "id" : 811762771,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21525",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMTc2Mjc3MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-01T08:58:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/811762771",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21525#discussion_r605494218"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21525"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/605494218"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't understand this TODO. CBlockIndex requires the block to be in the blockchain (block tree). However the coinbase commitment is regenerated *before* the block is submitted to the tree.",
      "commit_id" : "693414d27181cf967f787a2ca72344e52c58c7f0",
      "created_at" : "2021-04-01T09:04:58Z",
      "diff_hunk" : "@@ -201,6 +202,7 @@ class BlockAssembler\n void IncrementExtraNonce(CBlock* pblock, const CBlockIndex* pindexPrev, unsigned int& nExtraNonce);\n int64_t UpdateTime(CBlockHeader* pblock, const Consensus::Params& consensusParams, const CBlockIndex* pindexPrev);\n \n+// TODO just accept a CBlockIndex*",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21525#discussion_r605494218",
      "id" : 605494218,
      "line" : 205,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNTQ5NDIxOA==",
      "original_commit_id" : "7b8e976cd5ac78a22f1be2b2fed8562c693af5d9",
      "original_line" : 205,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/miner.h",
      "position" : 27,
      "pull_request_review_id" : 626050373,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21525",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-01T09:04:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/605494218",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21525#discussion_r606625632"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21525"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/606625632"
         }
      },
      "author_association" : "MEMBER",
      "body" : "(Reply https://github.com/bitcoin/bitcoin/pull/21391#issuecomment-812716831)",
      "commit_id" : "693414d27181cf967f787a2ca72344e52c58c7f0",
      "created_at" : "2021-04-03T06:14:06Z",
      "diff_hunk" : "@@ -201,6 +202,7 @@ class BlockAssembler\n void IncrementExtraNonce(CBlock* pblock, const CBlockIndex* pindexPrev, unsigned int& nExtraNonce);\n int64_t UpdateTime(CBlockHeader* pblock, const Consensus::Params& consensusParams, const CBlockIndex* pindexPrev);\n \n+// TODO just accept a CBlockIndex*",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21525#discussion_r606625632",
      "id" : 606625632,
      "in_reply_to_id" : 605494218,
      "line" : 205,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNjYyNTYzMg==",
      "original_commit_id" : "7b8e976cd5ac78a22f1be2b2fed8562c693af5d9",
      "original_line" : 205,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/miner.h",
      "position" : 27,
      "pull_request_review_id" : 627436037,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21525",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-03T06:14:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/606625632",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
