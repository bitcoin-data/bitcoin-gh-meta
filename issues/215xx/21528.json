{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "MEMBER",
   "body" : "This PR builds on the test refactors extracted into #22306 (first 5 commits). \r\n\r\nThis PR aims to reduce addr blackholes. When we receive an `addr` message that contains 10 or less addresses, we forward them to 1-2 peers. This is the main technique we use for self advertisements, so sending to peers that wouldn't relay would effectively \"blackhole\" the trickle. Although we cannot prevent this in a malicious case, we can improve it for the normal, honest cases, and reduce the overall likelihood of occurrence. Two known cases where peers would not participate in addr relay are if they have connected to you as a block-relay-only connection, or if they are a light client. \r\n\r\nThis implementation defers initialization of `m_addr_known` until it is needed, then uses its presence to decide if the peer is participating in addr relay. For outbound (not block-relay-only) peers, we initialize the filter before sending the initial self announcement when processing their `version` message. For inbound peers, we initialize the filter if/when we get an addr related message (`ADDR`, `ADDRV2`, `GETADDR`). We do NOT initialize the filter based on a `SENDADDRV2` message. \r\n\r\nTo communicate about these changes beyond bitcoin core & to (try to) ensure that no other software would be disrupted, I have: \r\n- Posted to the [mailing list](https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2021-April/018784.html)\r\n- Researched other open source clients to confirm compatibility, opened issues in all the projects & documented in https://github.com/bitcoin/bitcoin/pull/21528#issuecomment-809906430. Many have confirmed that this change would not be problematic.\r\n- Raised as topic during [bitcoin-core-dev meeting](https://www.erisian.com.au/bitcoin-core-dev/log-2021-03-25.html#l-954)\r\n- Raised as topic during [bitcoin p2p meeting](https://www.erisian.com.au/bitcoin-core-dev/log-2021-04-20.html#l-439)",
   "closed_at" : "2021-08-03T01:48:25Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
      "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
      "followers_url" : "https://api.github.com/users/fanquake/followers",
      "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/fanquake",
      "id" : 863730,
      "login" : "fanquake",
      "node_id" : "MDQ6VXNlcjg2MzczMA==",
      "organizations_url" : "https://api.github.com/users/fanquake/orgs",
      "received_events_url" : "https://api.github.com/users/fanquake/received_events",
      "repos_url" : "https://api.github.com/users/fanquake/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/fanquake"
   },
   "comments" : 29,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21528/comments",
   "created_at" : "2021-03-25T04:18:07Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21528/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/21528",
   "id" : 840541049,
   "labels" : [
      {
         "color" : "006b75",
         "default" : false,
         "description" : null,
         "id" : 98298007,
         "name" : "P2P",
         "node_id" : "MDU6TGFiZWw5ODI5ODAwNw==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21528/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDExOlB1bGxSZXF1ZXN0NjAwNDEyNjkz",
   "number" : 21528,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/21528.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21528",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/21528.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21528"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "[p2p] Reduce addr blackholes ",
   "updated_at" : "2021-08-03T01:50:23Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21528",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
      "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
      "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
      "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
      "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/amitiuttarwar",
      "id" : 1500952,
      "login" : "amitiuttarwar",
      "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
      "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
      "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
      "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/amitiuttarwar"
   }
}
