{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "The motivation of this PR is to extract and encapsulate logic in [SendMessages()](https://github.com/bitcoin/bitcoin/blob/master/src/net_processing.cpp#L4164) into smaller and focused methods, also motivated by a brief comment during a review of [#21509](https://github.com/bitcoin/bitcoin/pull/21509#issuecomment-805808485).\r\n\r\nThis PR extracts the logic to maybe announce the nodes local address to a peer. \r\n\r\nIf there is sufficient support for this type of refactoring, then the intention would be that further changes should be made in separate PRs to extract each area of logic from `SendMessages()`. \r\n\r\nThe idea would be for the changes to eventually look something like this:\r\n\r\n```\r\nbool PeerManagerImpl::SendMessages(CNode* pto) {\r\n    ...\r\n    {\r\n        LOCK(cs_main);\r\n        ...\r\n        MaybeAnnounceLocalAddress(...);\r\n        SendAddr(...);\r\n        SendGetHeadersBlockSync(...);\r\n        SendBlockAnnouncements(...);\r\n        SendInv(...);\r\n        ...\r\n    }\r\n    ...\r\n}\r\n\r\n```\r\n\r\nThe argument for this change would be, that it would be easier to read and understand the high level logic of `SendMessages()`. There other reason would be to separate and encapsulate each area of logic according to narrow responsibilities.\r\n\r\nSince the logic in `SendMessages()` is important, I am concerned that moving the code around for style and readability may introduce unintended bugs, for example implementing safe and correct method signatures. I was also unable to find tests that specifically target announcing local addresses while in IBD or if the peer is `block-relay-only`. \r\n\r\nAny feedback would greatly appreciated.\r\n\r\n",
   "closed_at" : "2021-03-28T14:19:49Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/18324680?v=4",
      "events_url" : "https://api.github.com/users/ccdle12/events{/privacy}",
      "followers_url" : "https://api.github.com/users/ccdle12/followers",
      "following_url" : "https://api.github.com/users/ccdle12/following{/other_user}",
      "gists_url" : "https://api.github.com/users/ccdle12/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/ccdle12",
      "id" : 18324680,
      "login" : "ccdle12",
      "node_id" : "MDQ6VXNlcjE4MzI0Njgw",
      "organizations_url" : "https://api.github.com/users/ccdle12/orgs",
      "received_events_url" : "https://api.github.com/users/ccdle12/received_events",
      "repos_url" : "https://api.github.com/users/ccdle12/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/ccdle12/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/ccdle12/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/ccdle12"
   },
   "comments" : 4,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21534/comments",
   "created_at" : "2021-03-27T14:13:44Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21534/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/21534",
   "id" : 842512855,
   "labels" : [
      {
         "color" : "006b75",
         "default" : false,
         "description" : null,
         "id" : 98298007,
         "name" : "P2P",
         "node_id" : "MDU6TGFiZWw5ODI5ODAwNw==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21534/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDExOlB1bGxSZXF1ZXN0NjAyMDcyNTM3",
   "number" : 21534,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/21534.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21534",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/21534.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21534"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "p2p, refactor: Extract logic of announcing a local address into a private method",
   "updated_at" : "2021-03-28T14:19:49Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21534",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/18324680?v=4",
      "events_url" : "https://api.github.com/users/ccdle12/events{/privacy}",
      "followers_url" : "https://api.github.com/users/ccdle12/followers",
      "following_url" : "https://api.github.com/users/ccdle12/following{/other_user}",
      "gists_url" : "https://api.github.com/users/ccdle12/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/ccdle12",
      "id" : 18324680,
      "login" : "ccdle12",
      "node_id" : "MDQ6VXNlcjE4MzI0Njgw",
      "organizations_url" : "https://api.github.com/users/ccdle12/orgs",
      "received_events_url" : "https://api.github.com/users/ccdle12/received_events",
      "repos_url" : "https://api.github.com/users/ccdle12/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/ccdle12/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/ccdle12/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/ccdle12"
   }
}
