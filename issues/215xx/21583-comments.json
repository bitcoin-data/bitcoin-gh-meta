[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #21506 (p2p, refactor: make NetPermissionFlags an enum class by jonatack)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-04-03T19:57:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21583#issuecomment-812917884",
      "id" : 812917884,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21583",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMjkxNzg4NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-03T19:57:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/812917884",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "To completely remove the `-feefilter` option you'll want to remove other uses (grep `-feefilter`), the surrounding unused variables, and the user option in init.cpp.",
      "created_at" : "2021-04-06T18:02:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21583#issuecomment-814325702",
      "id" : 814325702,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21583",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxNDMyNTcwMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-06T18:14:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/814325702",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "In terms of extracting the logic into a separate function, one option you can use is an assert to make sure `cs_main` is held before entering the main function logic e.g. `AssertLockHeld(cs_main)` like [used here](https://github.com/bitcoin/bitcoin/blob/master/src/net_processing.cpp#L3932).",
      "created_at" : "2021-04-06T18:24:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21583#issuecomment-814342103",
      "id" : 814342103,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21583",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxNDM0MjEwMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-06T18:24:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/814342103",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/18324680?v=4",
         "events_url" : "https://api.github.com/users/ccdle12/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ccdle12/followers",
         "following_url" : "https://api.github.com/users/ccdle12/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ccdle12/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ccdle12",
         "id" : 18324680,
         "login" : "ccdle12",
         "node_id" : "MDQ6VXNlcjE4MzI0Njgw",
         "organizations_url" : "https://api.github.com/users/ccdle12/orgs",
         "received_events_url" : "https://api.github.com/users/ccdle12/received_events",
         "repos_url" : "https://api.github.com/users/ccdle12/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ccdle12/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ccdle12/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ccdle12"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Thank you. bro.\n\nÐ²Ñ, 6 Ð°Ð¿Ñ. 2021 Ð³. Ð² 21:26, Christopher Coverdale ***@***.***\n>:\n\n> In terms of extracting the logic into a separate function, one option you\n> can use is an assert to make sure cs_main is held before entering the\n> main function logic e.g. AssertLockHeld(cs_main) like used here\n> <https://github.com/bitcoin/bitcoin/blob/master/src/net_processing.cpp#L3932>\n> .\n>\n> â\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/bitcoin/bitcoin/pull/21583#issuecomment-814342103>,\n> or unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/AODM4FKFMIEXFWI42XLOWCLTHNG6HANCNFSM42KJQRXQ>\n> .\n>\n",
      "created_at" : "2021-04-06T18:36:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21583#issuecomment-814351489",
      "id" : 814351489,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21583",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxNDM1MTQ4OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-06T18:36:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/814351489",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/59166229?v=4",
         "events_url" : "https://api.github.com/users/OxideDevX/events{/privacy}",
         "followers_url" : "https://api.github.com/users/OxideDevX/followers",
         "following_url" : "https://api.github.com/users/OxideDevX/following{/other_user}",
         "gists_url" : "https://api.github.com/users/OxideDevX/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/OxideDevX",
         "id" : 59166229,
         "login" : "OxideDevX",
         "node_id" : "MDQ6VXNlcjU5MTY2MjI5",
         "organizations_url" : "https://api.github.com/users/OxideDevX/orgs",
         "received_events_url" : "https://api.github.com/users/OxideDevX/received_events",
         "repos_url" : "https://api.github.com/users/OxideDevX/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/OxideDevX/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/OxideDevX/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/OxideDevX"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@ccdle12 understood the usage of `AssertLockHeld(cs_main)`. \r\nIn #21509 @jnewbery and @MarcoFalke talk about \r\n\r\n1. removing the `-feefilter` option ( as @glozow mentioned I have looked through all usages of 'feefilter')\r\n2. factoring out the feefilter logic out into its own function (will do so with `AssertLockHeld(cs_main)` ).\r\n\r\nFrom what I understand about the goal of #21545 , was to remove the feefilter check from the message handler loop in `net_processing.cpp`. Wouldn't removing it from the `init.cpp` be problematic as it would entirely remove the option? Or is removing feefilter completely the goal? I would like some clarity on this.\r\n\r\n### Feefilter usage\r\n\r\nLooked around and pulled up files with refrences to feefilter and understood the context of the refrence which was a good exercise that got me familiar with the codebase.\r\n\r\n1. init.cpp - `argsman.AddArg(\"-feefilter\", ...)`\r\n2. net_processing.cpp\r\n3. net.cpp and net.h\r\n```cpp\r\nif (m_tx_relay != nullptr) {\r\n    stats.minFeeFilter = m_tx_relay->minFeeFilter;\r\n} else {\r\n    stats.minFeeFilter = 0;\r\n}\r\n```\r\n4. protocol.cpp and protocol.h\r\n```cpp\r\nconst char *FEEFILTER=\"feefilter\";\r\n...\r\nconst static std::string allNetMessageTypes[] = {\r\n    ...\r\n    NetMsgType::FEEFILTER,\r\n};\r\n```\r\n5. validation.h `static const bool DEFAULT_FEEFILTER = true;`\r\n6. version.h `static const int FEEFILTER_VERSION = 70013;`\r\n7. fees.cpp and fees.h `explicit FeeFilterRounder(const CFeeRate& minIncrementalFee);` (the non-thread safe round function)\r\n8. net.cpp\r\n```cpp\r\nRPCResult::Type::NUM, \"minfeefilter\", \"The minimum fee rate for transactions this peer accepts\"\r\n...\r\nstatic RPCHelpMan getpeerinfo() {\r\n    ...\r\n    obj.pushKV(\"minfeefilter\", ValueFromAmount(stats.minFeeFilter));\r\n}\r\n```\r\n9. policy_fee_tests.cpp `FeeFilterRounder fee_rounder{CFeeRate{1000}};`\r\n10. fees.cpp `FeeFilterRounder fee_filter_rounder{minimal_incremental_fee};`\r\n11. process_message.cpp `FUZZ_TARGET_MSG(feefilter);`\r\n12. Multiple python tests in test/functional\r\n    a. p2p_feefilter.py\r\n    b. p2p_ibd_txrelay.py\r\n    c. p2p_leak.py\r\n    d. rpc_net.py\r\n    e. test_runner.py\r\n    f. messages.py\r\n    g. p2p.py\r\n",
      "created_at" : "2021-04-16T18:59:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21583#issuecomment-821485389",
      "id" : 821485389,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21583",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMTQ4NTM4OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-16T18:59:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/821485389",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8216281?v=4",
         "events_url" : "https://api.github.com/users/AdityaNG/events{/privacy}",
         "followers_url" : "https://api.github.com/users/AdityaNG/followers",
         "following_url" : "https://api.github.com/users/AdityaNG/following{/other_user}",
         "gists_url" : "https://api.github.com/users/AdityaNG/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/AdityaNG",
         "id" : 8216281,
         "login" : "AdityaNG",
         "node_id" : "MDQ6VXNlcjgyMTYyODE=",
         "organizations_url" : "https://api.github.com/users/AdityaNG/orgs",
         "received_events_url" : "https://api.github.com/users/AdityaNG/received_events",
         "repos_url" : "https://api.github.com/users/AdityaNG/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/AdityaNG/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/AdityaNG/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/AdityaNG"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> is removing feefilter completely the goal\r\n\r\nYes. The `-feefilter` config option is not used anywhere else, so it should be removed from the init code.\r\n\r\n> Looked around and pulled up files with refrences to feefilter and understood the context of the refrence which was a good exercise that got me familiar with the codebase...\r\n\r\nAll of these instances of `minFeeFilter`, `FEEFILTER, `FEEFILTER_VERSION`, etc are separate from the `-feefilter` option, which is used to control whether we'll ever send `feefilter` messages to our peer.",
      "created_at" : "2021-04-19T12:59:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21583#issuecomment-822446983",
      "id" : 822446983,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21583",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMjQ0Njk4Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-19T12:59:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/822446983",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Please also add rationale to the commit log. Why is it ok to remove -feefilter?",
      "created_at" : "2021-04-19T13:05:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21583#issuecomment-822451464",
      "id" : 822451464,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21583",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMjQ1MTQ2NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-19T13:05:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/822451464",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Closing for now due to inactivity. Let me know when you want to work on this again.",
      "created_at" : "2021-05-03T09:44:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21583#issuecomment-831148453",
      "id" : 831148453,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21583",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgzMTE0ODQ1Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-03T09:44:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/831148453",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
