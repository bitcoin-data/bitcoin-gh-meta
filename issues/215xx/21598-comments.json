[
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK (in the light of #20272 discussion).",
      "created_at" : "2021-04-04T23:36:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21598#issuecomment-813116824",
      "id" : 813116824,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21598",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMzExNjgyNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-04T23:36:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/813116824",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This change reverts the @ajtowns's [idea](https://github.com/bitcoin/bitcoin/pull/19668#issuecomment-669312538) for `AssertLockNotHeld` but I cannot see the way to save it, unfortunately.",
      "created_at" : "2021-04-05T03:12:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21598#issuecomment-813157624",
      "id" : 813157624,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21598",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMzE1NzYyNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-05T03:12:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/813157624",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Approach ACK, +1 on doc change as well",
      "created_at" : "2021-04-05T06:33:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21598#issuecomment-813219891",
      "id" : 813219891,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21598",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMzIxOTg5MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-05T06:33:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/813219891",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> This change reverts\r\n\r\nCorrect, but the revert is only temporary (until cs_main is removed or a private member)",
      "created_at" : "2021-04-05T06:43:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21598#issuecomment-813224175",
      "id" : 813224175,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21598",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMzIyNDE3NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-05T06:43:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/813224175",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Force pushed to address feedback",
      "created_at" : "2021-04-05T06:43:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21598#issuecomment-813224323",
      "id" : 813224323,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21598",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMzIyNDMyMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-05T06:43:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/813224323",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK fa5eabe72117f6e3704858e8d5b2c57a120258ed",
      "created_at" : "2021-04-05T22:11:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21598#issuecomment-813679650",
      "id" : 813679650,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21598",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMzY3OTY1MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-05T22:11:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/813679650",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ACK fa5eabe72117f6e3704858e8d5b2c57a120258ed",
      "created_at" : "2021-04-06T05:52:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21598#issuecomment-813843223",
      "id" : 813843223,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21598",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMzg0MzIyMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-06T05:52:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/813843223",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This silenced the compiler warnings at the time, so it was ok. I just wonder about the following reasoning, in the light of https://github.com/bitcoin/bitcoin/pull/24931:\r\n\r\n> Remove negative lock annotations from globals ... They only make sense for mutexes that are private members.\r\n\r\nWhy is that? For example:\r\n\r\n```cpp\r\nMutex g_mutex;\r\n\r\nvoid f1()\r\n{\r\n    LOCK(g_mutex);\r\n}\r\n\r\nvoid f2()\r\n{\r\n    LOCK(g_mutex);\r\n    f1();\r\n}\r\n```\r\n\r\nThis is undefined behavior that would be detected if `f1()` is annotated with `EXCLUSIVE_LOCKS_REQUIRED(!g_mutex)`.\r\n\r\nTo me it looks like that negative lock annotations \"make sense\" regardless of the scope of the mutex, no? ",
      "created_at" : "2022-06-07T11:55:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21598#issuecomment-1148566865",
      "id" : 1148566865,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21598",
      "node_id" : "IC_kwDOABII585Edb1R",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1148566865/reactions"
      },
      "updated_at" : "2022-06-07T11:55:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1148566865",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This pull was done in light of https://github.com/bitcoin/bitcoin/pull/20272#discussion_r515215137 . If https://github.com/bitcoin/bitcoin/pull/24931 fixes the mentioned issues, then that is fine.",
      "created_at" : "2022-06-07T12:11:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21598#issuecomment-1148582172",
      "id" : 1148582172,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21598",
      "node_id" : "IC_kwDOABII585Edfkc",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1148582172/reactions"
      },
      "updated_at" : "2022-06-07T12:11:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1148582172",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@vasild The problem is when you call `f1` -- the negative annotation needs to keep getting propogated up the call stack:\r\n\r\n```c++\r\n\r\nMutex g_mutex;\r\nvoid f1() EXCLUSIVE_LOCKS_REQUIRED(!g_mutex)\r\n{\r\n    LOCK(g_mutex);\r\n}\r\n\r\nclass X {\r\nprivate:\r\n    Mutex m_mut;\r\npublic:\r\n    void f1() EXCLUSIVE_LOCKS_REQUIRED(!m_mut)\r\n    {\r\n        LOCK(m_mut);\r\n    }\r\n};\r\nX g_x;\r\n\r\nvoid caller() EXCLUSIVE_LOCKS_REQUIRED(!g_mutex)\r\n{\r\n    f1();\r\n    g_x.f1();\r\n}\r\n```",
      "created_at" : "2022-06-13T02:21:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21598#issuecomment-1153391508",
      "id" : 1153391508,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21598",
      "node_id" : "IC_kwDOABII585Ev1uU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1153391508/reactions"
      },
      "updated_at" : "2022-06-13T02:21:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1153391508",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, it has to be propagated, but I wouldn't call it a \"problem\" though because it works exactly as intended. True that it creates inconvenience with code isolation (like this code should not know about that mutex), but after all a global mutex is not isolated, so IMO it is ok and even desirable to propagate its negative annotation.",
      "created_at" : "2022-06-13T13:30:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21598#issuecomment-1153917703",
      "id" : 1153917703,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21598",
      "node_id" : "IC_kwDOABII585Ex2MH",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1153917703/reactions"
      },
      "updated_at" : "2022-06-13T13:30:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1153917703",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   }
]
