[
   {
      "author_association" : "NONE",
      "body" : "I restarted the controller proxy several times, onion-grater is consistent with its replies or ServiceID, but bitcoind is not, it says authentication not supported even when the reply contained the ServiceID. Each of the spaced lines are a time I restarted the tor controller's proxy:\r\n```\r\ntor: Got service ID OLDONION, advertising service OLDONION.onion:8333\r\nAddLocal(OLDONION.onion:8333,4)\r\n\r\nRemoveLocal(OLDONION.onion:8333)\r\ntor: No supported authentication method \r\n\r\ntor: No supported authentication method\r\n\r\ntor: No supported authentication method\r\n\r\ntor: Got service ID ANOTHERONION, advertising service ANOTHERONION.onion:8333\r\nAddLocal(ANOTHERONION.onion:8333,4)\r\n```\r\n\r\nAnd for some reason, on the last it did work.\r\nI was solely restarting onion-grater, sometimes bitcoind can't authenticate, sometimes it can, which is very strange.",
      "created_at" : "2022-10-03T11:52:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/26228#issuecomment-1265328913",
      "id" : 1265328913,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26228",
      "node_id" : "IC_kwDOABII585La2MR",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1265328913/reactions"
      },
      "updated_at" : "2022-10-03T11:52:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1265328913",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69700936?v=4",
         "events_url" : "https://api.github.com/users/nyxnor/events{/privacy}",
         "followers_url" : "https://api.github.com/users/nyxnor/followers",
         "following_url" : "https://api.github.com/users/nyxnor/following{/other_user}",
         "gists_url" : "https://api.github.com/users/nyxnor/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/nyxnor",
         "id" : 69700936,
         "login" : "nyxnor",
         "node_id" : "MDQ6VXNlcjY5NzAwOTM2",
         "organizations_url" : "https://api.github.com/users/nyxnor/orgs",
         "received_events_url" : "https://api.github.com/users/nyxnor/received_events",
         "repos_url" : "https://api.github.com/users/nyxnor/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/nyxnor/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/nyxnor/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/nyxnor"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Enabled tor debugging for bitcoind:\r\n```\r\ntor: Connected to Tor version 0.4.7.10\r\ntor: Supported authentication method: NULL\r\ntor: Using NULL authentication\r\ntor: Authentication successful\r\ntor: ADD_ONION successful\r\ntor: Got service ID OLDONION, advertising service OLDONION.onion:8333\r\n```\r\nrestarting the controller proxy\r\n```\r\ntor: End of stream\r\nRemoveLocal(OLDONION.onion:8333)\r\ntor: Not connected to Tor control port 127.0.0.1:9051, trying to reconnect\r\ntor: Successfully connected!\r\ntor: End of stream\r\ntor: Not connected to Tor control port 127.0.0.1:9051, trying to reconnect\r\ntor: Successfully connected!\r\ntor: Connected to Tor version 0.4.7.10\r\ntor: Supported authentication method: NULL\r\ntor: Using NULL authentication\r\ntor: No supported authentication method\r\n```\r\nand controller logs:\r\n```\r\n-> PROTOCOLINFO 1\r\n<- 250-PROTOCOLINFO 1\r\n<- 250-AUTH METHODS=NULL\r\n<- 250-VERSION Tor=\"0.4.7.10\"\r\n<- 250 OK\r\n-> AUTHENTICATE\r\n<- 250 OK\r\n```\r\n`->` client commands to the controller\r\n`<-` controller replies to the client\r\n\r\nYou can see bitcoind tries to use the NULL method that doesn't require a pass or cookie, and the controller let's bitcoind authenticate, but bitcoind does not\r\n\r\nSometimes bitcoind understand it can authenticate (`Authentication successful`), but then logs `No supported authentication method`, not creating the onion.\r\n```\r\ntor: Error connecting to Tor control socket\r\ntor: Not connected to Tor control port 127.0.0.1:9051, trying to reconnect\r\ntor: Successfully connected!\r\ntor: Error connecting to Tor control socket\r\ntor: Not connected to Tor control port 127.0.0.1:9051, trying to reconnect\r\ntor: Successfully connected!\r\ntor: Authentication successful\r\ntor: No supported authentication method\r\n```\r\nand by some change (which appear to be random), sometimes bitcoind gets the onion and uses it:\r\n```\r\ntor: Connected to Tor version 0.4.7.10\r\ntor: Supported authentication method: NULL\r\ntor: Using NULL authentication\r\ntor: Authentication successful\r\ntor: ADD_ONION successful\r\ntor: Got service ID NEWONION, advertising service NEWONION.onion:8333\r\n```\r\n\r\nTLDR:\r\n\r\nBitcoind always can get the onion after it is restarted.\r\nIf the onion is no long available because the controller connection closes for a second, then when it is available again, bitcoind can't get the onion hostname (ServiceID) reliably, sometimes it can, sometimes it can't and the controller is always replying, bitcoind doesn't get it sometimes for some reason.",
      "created_at" : "2022-10-03T12:38:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/26228#issuecomment-1265379900",
      "id" : 1265379900,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26228",
      "node_id" : "IC_kwDOABII585LbCo8",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1265379900/reactions"
      },
      "updated_at" : "2022-10-03T12:38:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1265379900",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69700936?v=4",
         "events_url" : "https://api.github.com/users/nyxnor/events{/privacy}",
         "followers_url" : "https://api.github.com/users/nyxnor/followers",
         "following_url" : "https://api.github.com/users/nyxnor/following{/other_user}",
         "gists_url" : "https://api.github.com/users/nyxnor/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/nyxnor",
         "id" : 69700936,
         "login" : "nyxnor",
         "node_id" : "MDQ6VXNlcjY5NzAwOTM2",
         "organizations_url" : "https://api.github.com/users/nyxnor/orgs",
         "received_events_url" : "https://api.github.com/users/nyxnor/received_events",
         "repos_url" : "https://api.github.com/users/nyxnor/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/nyxnor/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/nyxnor/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/nyxnor"
      }
   }
]
