[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased ed457a39ebaa672cce21622d3af422fe50730580 -> b1ac3cff00a51c0b8965b7a85fa489c98409ddff to resolve merge conflicts with bumpfee (#8456).",
      "created_at" : "2017-01-25T18:30:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-275191822",
      "id" : 275191822,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDI3NTE5MTgyMg==",
      "updated_at" : "2017-01-25T18:30:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/275191822",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm thinking of splitting this up into two commits to make it easier to review. First commit would change CreateTransaction to return a CTransactionRef instead of CWalletTx. Second commit would change AddToWallet to accept a CTransactionRef instead of a CWalletTx.\r\n\r\nIf any reviewers would prefer this you can let me know.",
      "created_at" : "2017-01-25T18:48:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-275196684",
      "id" : 275196684,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDI3NTE5NjY4NA==",
      "updated_at" : "2017-01-25T18:48:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/275196684",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Splitting commits into logical breaks is always appreciated.\n\nOn 01/25/17 18:48, Russell Yanofsky wrote:\n> I'm thinking of splitting this up into two commits to make it easier to\n> review. First commit would change CreateTransaction to return a\n> CTransactionRef instead of CWalletTx. Second commit would change\n> AddToWallet to accept a CTransactionRef instead of a CWalletTx.\n> \n> If any reviewers would prefer this you can let me know.\n> \n> Ã¢ÂÂ\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-275196684>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AAnoHu0xZqwtESQp3_rXWoR3OurDnNzgks5rV5kPgaJpZM4LRR4W>.\n> \n",
      "created_at" : "2017-01-25T19:26:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-275207263",
      "id" : 275207263,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDI3NTIwNzI2Mw==",
      "updated_at" : "2017-01-25T19:26:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/275207263",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Hum, reading this (finally) now, I'm not sure if I'm a big fan of this approach. The call-function-which-callsback-to-let-you-fill-in-things-that-really-should-have-been-arguments pattern really sucks. On the flip side, passing in CWalletTxes, and copying those into mapWallet can also lead to issues if you try to do anything to the object you just passed in thinking it is what got stored in the wallet (a mistake I made recently).\r\n\r\nMaybe we should adapt some of these functions (AddToWallet/CommitTransaction/whatever) to just always take an rvalue to a CWalletTx. This leaves only AddToWalletIfInvolvingMe (I think) which has to update-or-add, and that can just use an internal version of AddToWallet which takes the CWalletDB as an argument instead of creating its own.",
      "created_at" : "2017-01-25T22:17:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-275250693",
      "id" : 275250693,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDI3NTI1MDY5Mw==",
      "updated_at" : "2017-01-25T22:17:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/275250693",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> The call-function-which-callsback-to-let-you-fill-in-things-that-really-should-have-been-arguments pattern really sucks.\r\n\r\nIf you are adamant about this, could you say more about why it sucks? I think a callback is exactly the thing you want when you are doing an in-place update to a data structure.\r\n\r\nIn any case, I agree that CommitTransaction shouldn't take a callback, so I changed it to just take a transaction ref. So now there are way fewer callbacks (I think only 3 left in non-test code).\r\n\r\n\r\n",
      "created_at" : "2017-02-02T23:51:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-277122702",
      "id" : 277122702,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDI3NzEyMjcwMg==",
      "updated_at" : "2017-02-02T23:51:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/277122702",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm just generally not a fan of callbacks making ownership models inconsistent. eg this kind of thing is where people always fuck up lockordering (though admittedly less so in this particular case, more the general case of callbacks going in both directions between modules).\r\n\r\nSo I do like this version much better, but still not sure the call back is required to be publicly exposed...Can we just leave MarkReplaced and add a similar function for importpruned funds to use (I dont believe the double-disk-sync in importprunedfunds will make for inconsistent/bad on-disk state?). Then we can make AddToWallet(..., callback) private and use AddToWalletIfInvolvingMe (which should probably also take a CTransactionRef, not a CTransaction, though maybe thats for a separate PR) publicly.",
      "created_at" : "2017-02-03T18:46:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-277328482",
      "id" : 277328482,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDI3NzMyODQ4Mg==",
      "updated_at" : "2017-02-03T18:46:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/277328482",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Can we just leave MarkReplaced and add a similar function for importpruned funds to use\r\n\r\nWill try that. In the meantime I moved the non-AddToWallet cleanup to #9680 so it can be considered separately. By the way #9369 is another PR which significantly simplifies AddToWallet.",
      "created_at" : "2017-02-03T19:10:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-277335035",
      "id" : 277335035,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDI3NzMzNTAzNQ==",
      "updated_at" : "2017-02-03T19:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/277335035",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Can we just leave MarkReplaced and add a similar function for importpruned funds to use\r\n\r\nImplemented this suggestion. (New function is `CWallet::AddTransaction`). I also went ahead and disabled the CWalletTx copy constructor. Interestingly this uncovered a bunch of cases where we were unwittingly copying wallet transactions in loops due to writing:\r\n```c++\r\nfor (const std::pair<uint256, CWalletTx>& pairWtx : pwallet->mapWallet)\r\n```\r\n\r\ninstead of:\r\n```c++\r\nfor (const std::pair<const uint256, CWalletTx>& pairWtx : pwallet->mapWallet)\r\n```",
      "created_at" : "2017-12-01T22:31:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-348631717",
      "id" : 348631717,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM0ODYzMTcxNw==",
      "updated_at" : "2017-12-01T22:31:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/348631717",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r169884033"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169884033"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`CTransactionRef` is itself a pointer, so unless you intend for the caller to be able to modify what it points to, I think simply returning a `CTransactionRef` is better here. Every use case also seems to `*`-dereference it.",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2018-02-22T08:33:12Z",
      "diff_hunk" : "@@ -12,27 +12,21 @@ WalletModelTransaction::WalletModelTransaction(const QList<SendCoinsRecipient> &\n     walletTransaction(0),\n     fee(0)\n {\n-    walletTransaction = new CWalletTx();\n-}\n-\n-WalletModelTransaction::~WalletModelTransaction()\n-{\n-    delete walletTransaction;\n }\n \n QList<SendCoinsRecipient> WalletModelTransaction::getRecipients() const\n {\n     return recipients;\n }\n \n-CWalletTx *WalletModelTransaction::getTransaction() const\n+CTransactionRef* WalletModelTransaction::getTransaction()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r169884033",
      "id" : 169884033,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2OTg4NDAzMw==",
      "original_commit_id" : "8e3dd3be1af06646a65cf2c22384dd156eced1a9",
      "original_line" : 22,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/qt/walletmodeltransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 98480176,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169884033",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Needs rebase to fix travis (sorry)",
      "created_at" : "2018-03-08T15:21:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-371519076",
      "id" : 371519076,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM3MTUxOTA3Ng==",
      "updated_at" : "2018-03-08T15:21:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/371519076",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Needs rebase to fix travis (sorry)\r\n\r\nRebased 71bce6b0f4aee487026afd31ada41a4e6028abd3 -> 31297f007b2424ab5036258ed782aacc70237a7f ([pr/atw-nomerge.33](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.33) -> [pr/atw-nomerge.34](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.34)) for #12607.",
      "created_at" : "2018-03-12T18:55:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-372424339",
      "id" : 372424339,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM3MjQyNDMzOQ==",
      "updated_at" : "2018-03-12T22:12:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/372424339",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r174259437"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174259437"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r169884033\r\n\r\n> CTransactionRef is itself a pointer, so unless you intend for the caller to be able to modify what it points to, I think simply returning a CTransactionRef is better here. Every use case also seems to *-dereference it.\r\n\r\nGood idea, done in 64f182fa587f35081ed8026b44e2a36010364153.",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2018-03-13T19:39:49Z",
      "diff_hunk" : "@@ -12,27 +12,21 @@ WalletModelTransaction::WalletModelTransaction(const QList<SendCoinsRecipient> &\n     walletTransaction(0),\n     fee(0)\n {\n-    walletTransaction = new CWalletTx();\n-}\n-\n-WalletModelTransaction::~WalletModelTransaction()\n-{\n-    delete walletTransaction;\n }\n \n QList<SendCoinsRecipient> WalletModelTransaction::getRecipients() const\n {\n     return recipients;\n }\n \n-CWalletTx *WalletModelTransaction::getTransaction() const\n+CTransactionRef* WalletModelTransaction::getTransaction()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r174259437",
      "id" : 174259437,
      "in_reply_to_id" : 169884033,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3NDI1OTQzNw==",
      "original_commit_id" : "8e3dd3be1af06646a65cf2c22384dd156eced1a9",
      "original_line" : 22,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/qt/walletmodeltransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 103583241,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174259437",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Re-slight-utACK 8a6ec70",
      "created_at" : "2018-03-13T23:27:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-372853226",
      "id" : 372853226,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM3Mjg1MzIyNg==",
      "updated_at" : "2018-03-13T23:27:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/372853226",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased e15246fc310599770332021d14b96ce3f213a82b -> d62357a7c7c8c34a55580a31ddbfd04a9fa72591 ([pr/atw-nomerge.37](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.37) -> [pr/atw-nomerge.38](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.38)) due to conflict with #12681 and after merge of base PR #9680.",
      "created_at" : "2018-03-15T19:41:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-373499190",
      "id" : 373499190,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM3MzQ5OTE5MA==",
      "updated_at" : "2018-03-15T19:41:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/373499190",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r174957667"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174957667"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"Disable CWalletTx copy constructor\",\r\n\r\nCould add an empty constructor (or add default values)? I believe that would allow keeping `vWtx` as vector?",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2018-03-15T22:59:45Z",
      "diff_hunk" : "@@ -668,12 +668,9 @@ DBErrors CWalletDB::FindWalletTx(std::vector<uint256>& vTxHash, std::vector<CWal\n             if (strType == \"tx\") {\n                 uint256 hash;\n                 ssKey >> hash;\n-\n-                CWalletTx wtx(nullptr /* pwallet */, MakeTransactionRef());\n-                ssValue >> wtx;\n-\n                 vTxHash.push_back(hash);\n-                vWtx.push_back(wtx);\n+                vWtx.emplace_back(nullptr /* wallet */, nullptr /* tx */);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r174957667",
      "id" : 174957667,
      "line" : 780,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3NDk1NzY2Nw==",
      "original_commit_id" : "bf59f2135d93bc175f7a1f630285d6479580e291",
      "original_line" : 780,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : 88,
      "pull_request_review_id" : 104409901,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174957667",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r174958125"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174958125"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"Avoid copying CWalletTx in LoadToWallet\",\r\n\r\nThis and the `Init()` change could be in a different (trivial) commit.",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2018-03-15T23:02:38Z",
      "diff_hunk" : "@@ -348,14 +348,13 @@ class CWalletTx : public CMerkleTx\n     mutable CAmount nAvailableWatchCreditCached;\n     mutable CAmount nChangeCached;\n \n-    CWalletTx(const CWallet* pwalletIn, CTransactionRef arg) : CMerkleTx(std::move(arg))\n+    CWalletTx(const CWallet* wallet, CTransactionRef arg) : CMerkleTx(std::move(arg)), pwallet(wallet)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r174958125",
      "id" : 174958125,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3NDk1ODEyNQ==",
      "original_commit_id" : "62afca0ac31ee6db6beab800cc349157809e87da",
      "original_line" : 501,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 104409901,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174958125",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r174960713"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174960713"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"Remove CWalletTx merging logic from AddToWallet\",\r\n\r\nShould stay? Related to #12681.\r\n\r\nLooks like [this code](https://github.com/bitcoin/bitcoin/pull/12681/files#diff-b2bb174788c7409b671c46ccc86034bdR3816) is not hit, otherwise the lock held assertion in `LookupBlockIndex` would cause travis failure here?",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2018-03-15T23:18:14Z",
      "diff_hunk" : "@@ -547,18 +547,11 @@ static int64_t AddTx(CWallet& wallet, uint32_t lockTime, int64_t mockTime, int64\n         block = inserted.first->second;\n         block->nTime = blockTime;\n         block->phashBlock = &hash;\n+        wallet.AddTransaction(MakeTransactionRef(tx), hash, 0);\n+    } else {\n+        wallet.AddTransaction(MakeTransactionRef(tx));\n     }\n-\n-    CWalletTx wtx(&wallet, MakeTransactionRef(tx));\n-    if (block) {\n-        wtx.SetMerkleBranch(block, 0);\n-    }\n-    {\n-        LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r174960713",
      "id" : 174960713,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3NDk2MDcxMw==",
      "original_commit_id" : "98ff78d5a272f9fef0057ebd8a4553cd2bead5ee",
      "original_line" : 288,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/wallet/test/wallet_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 104409901,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174960713",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r175151138"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/175151138"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r174957667\r\n\r\nIn commit \"Disable CWalletTx copy constructor\",\r\n\r\n> Could add an empty constructor (or add default values)? I believe that would allow keeping vWtx as vector?\r\n\r\nIt isn't enough because a vector needs its elements to be copyable or movable (otherwise it couldn't reallocate during expansion).",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2018-03-16T16:49:17Z",
      "diff_hunk" : "@@ -668,12 +668,9 @@ DBErrors CWalletDB::FindWalletTx(std::vector<uint256>& vTxHash, std::vector<CWal\n             if (strType == \"tx\") {\n                 uint256 hash;\n                 ssKey >> hash;\n-\n-                CWalletTx wtx(nullptr /* pwallet */, MakeTransactionRef());\n-                ssValue >> wtx;\n-\n                 vTxHash.push_back(hash);\n-                vWtx.push_back(wtx);\n+                vWtx.emplace_back(nullptr /* wallet */, nullptr /* tx */);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r175151138",
      "id" : 175151138,
      "in_reply_to_id" : 174957667,
      "line" : 780,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3NTE1MTEzOA==",
      "original_commit_id" : "bf59f2135d93bc175f7a1f630285d6479580e291",
      "original_line" : 780,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : 88,
      "pull_request_review_id" : 104640583,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/175151138",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r175151371"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/175151371"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r174958125\r\n\r\nIn commit \"Avoid copying CWalletTx in LoadToWallet\",\r\n\r\n> This and the Init() change could be in a different (trivial) commit.\r\n\r\nGood catch, split 62afca0ac31ee6db6beab800cc349157809e87da into 5f10dfceef542ec19030e02d4954295bc0fa0428 and 9b178932e532bc507bc4e825a404e42deab726f9",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2018-03-16T16:49:52Z",
      "diff_hunk" : "@@ -348,14 +348,13 @@ class CWalletTx : public CMerkleTx\n     mutable CAmount nAvailableWatchCreditCached;\n     mutable CAmount nChangeCached;\n \n-    CWalletTx(const CWallet* pwalletIn, CTransactionRef arg) : CMerkleTx(std::move(arg))\n+    CWalletTx(const CWallet* wallet, CTransactionRef arg) : CMerkleTx(std::move(arg)), pwallet(wallet)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r175151371",
      "id" : 175151371,
      "in_reply_to_id" : 174958125,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3NTE1MTM3MQ==",
      "original_commit_id" : "62afca0ac31ee6db6beab800cc349157809e87da",
      "original_line" : 501,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 104640583,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/175151371",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r175151774"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/175151774"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r174960713\r\n\r\nIn commit \"Remove CWalletTx merging logic from AddToWallet\",\r\n\r\n> Should stay? Related to #12681.\r\n\r\nIt's not needed because of the lock above:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/98ff78d5a272f9fef0057ebd8a4553cd2bead5ee/src/wallet/test/wallet_tests.cpp#L543\r\n\r\nThis is the reason there's no assert failure on travis.",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2018-03-16T16:51:09Z",
      "diff_hunk" : "@@ -547,18 +547,11 @@ static int64_t AddTx(CWallet& wallet, uint32_t lockTime, int64_t mockTime, int64\n         block = inserted.first->second;\n         block->nTime = blockTime;\n         block->phashBlock = &hash;\n+        wallet.AddTransaction(MakeTransactionRef(tx), hash, 0);\n+    } else {\n+        wallet.AddTransaction(MakeTransactionRef(tx));\n     }\n-\n-    CWalletTx wtx(&wallet, MakeTransactionRef(tx));\n-    if (block) {\n-        wtx.SetMerkleBranch(block, 0);\n-    }\n-    {\n-        LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r175151774",
      "id" : 175151774,
      "in_reply_to_id" : 174960713,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3NTE1MTc3NA==",
      "original_commit_id" : "98ff78d5a272f9fef0057ebd8a4553cd2bead5ee",
      "original_line" : 288,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/wallet/test/wallet_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 104640583,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/175151774",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2018-06-15T20:09:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-397729081",
      "id" : 397729081,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5NzcyOTA4MQ==",
      "updated_at" : "2018-06-15T20:09:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/397729081",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Needs rebase \r\n\r\nRebased cad8b14857d8e310ebad8a850c9e6450e13360fc -> a494d2a4472ea63620b1f6cce20cb726590eb75b ([pr/atw-nomerge.42](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.42) -> [pr/atw-nomerge.43](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.43)) due to minor conflict with #13437.\r\nRebased a494d2a4472ea63620b1f6cce20cb726590eb75b -> 497f8a035ca2788564266f426033f52f982075ed ([pr/atw-nomerge.43](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.43) -> [pr/atw-nomerge.44](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.44)) due to conflict with #13622\r\nRebased 497f8a035ca2788564266f426033f52f982075ed -> ba8ade94a4291b761f6a0395a9d6345782388c91 ([pr/atw-nomerge.44](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.44) -> [pr/atw-nomerge.45](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.45)) due to conflict with #13774\r\nRebased ba8ade94a4291b761f6a0395a9d6345782388c91 -> 876d885730e8572e4616b0067595c91f0545dd55 ([pr/atw-nomerge.45](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.45) -> [pr/atw-nomerge.46](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.46)) due to conflict with #12992\r\nRebased 876d885730e8572e4616b0067595c91f0545dd55 -> 9274458aedb68919618b13568432998b35430e6f ([pr/atw-nomerge.46](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.46) -> [pr/atw-nomerge.47](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.47)) due to conflict with #14023\r\nRebased 9274458aedb68919618b13568432998b35430e6f -> a0d1323d7ef977b0ed78ec675d8bb14fa5e672d5 ([pr/atw-nomerge.47](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.47) -> [pr/atw-nomerge.48](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.48)) due to conflict with #13825\r\nRebased a0d1323d7ef977b0ed78ec675d8bb14fa5e672d5 -> 4b077293cec57f0b5f3bc010beb5ce1a9820a9ef ([pr/atw-nomerge.48](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.48) -> [pr/atw-nomerge.49](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.49)) due to conflict with #14287\r\nUpdated 4b077293cec57f0b5f3bc010beb5ce1a9820a9ef -> 15adcd19e49399590b5224a6a5e0a11e003eac53 ([pr/atw-nomerge.49](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.49) -> [pr/atw-nomerge.50](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.50)) with suggested lint fixes\r\nUpdated 15adcd19e49399590b5224a6a5e0a11e003eac53 -> ca7b4e24324464f04053145e58c25bfa5e0c5a51 ([pr/atw-nomerge.50](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.50) -> [pr/atw-nomerge.51](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.51)) with suggested lint fixes\r\nRebased ca7b4e24324464f04053145e58c25bfa5e0c5a51 -> 8cbc44f92f0932c87abadbd7c85e246d5b37b707 ([pr/atw-nomerge.51](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.51) -> [pr/atw-nomerge.52](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.52)) due to conflict with #11634\r\nAdded 1 commits 8cbc44f92f0932c87abadbd7c85e246d5b37b707 -> 845345c70c42411373a480406686b67870a235ad ([pr/atw-nomerge.52](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.52) -> [pr/atw-nomerge.53](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.53), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/atw-nomerge.52...pr/atw-nomerge.53)) with MeshCollider suggestions.\r\nRebased 845345c70c42411373a480406686b67870a235ad -> b35d6cd39f383af5c8d07312e7c7b8d2d3c12641 ([pr/atw-nomerge.53](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.53) -> [pr/atw-nomerge.54](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.54)) due to conflict with #14437\r\nRebased b35d6cd39f383af5c8d07312e7c7b8d2d3c12641 -> da86f39d50de1ca559c96c87e17228f73ee1afef ([pr/atw-nomerge.54](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.54) -> [pr/atw-nomerge.55](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.55)) due to conflict with #14711\r\nRebased da86f39d50de1ca559c96c87e17228f73ee1afef -> 596f85075d21c474f4ae5a98ad5c89da7ace1484 ([pr/atw-nomerge.55](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.55) -> [pr/atw-nomerge.56](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.56)) due to conflict with #15288\r\nRebased 596f85075d21c474f4ae5a98ad5c89da7ace1484 -> ab2bd422f77c37d232467c45cdfa57a581c8008b ([pr/atw-nomerge.56](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.56) -> [pr/atw-nomerge.57](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.57)) due to conflict with #15948",
      "created_at" : "2018-06-19T21:22:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-398550587",
      "id" : 398550587,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5ODU1MDU4Nw==",
      "updated_at" : "2019-05-15T15:35:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/398550587",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK a494d2a4472ea63620b1f6cce20cb726590eb75b. I think the \"callback\" approach is perfectly fine here; they're not actual callbacks (in that they're not invoked at a different time or from a different thread); they're just functions to fill in values at the time the object is created.",
      "created_at" : "2018-06-27T01:24:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-400513131",
      "id" : 400513131,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQwMDUxMzEzMQ==",
      "updated_at" : "2018-06-27T01:25:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/400513131",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2018-07-11T15:07:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-404204207",
      "id" : 404204207,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQwNDIwNDIwNw==",
      "updated_at" : "2018-07-11T15:07:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/404204207",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r214549286"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/214549286"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Typo found by `codespell`: tranaction",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2018-09-02T18:36:06Z",
      "diff_hunk" : "@@ -985,13 +963,23 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransactionRef& ptx, const CBlockI\n                 }\n             }\n \n-            CWalletTx wtx(this, ptx);\n-\n-            // Get merkle branch if transaction was found in a block\n-            if (pIndex != nullptr)\n-                wtx.SetMerkleBranch(pIndex, posInBlock);\n-\n-            return AddToWallet(wtx, false);\n+            auto update_wtx = [&](CWalletTx& wtx, bool new_tx) {\n+                bool updated = false;\n+                // Update block position if transaction was found in a block\n+                if (pIndex && (wtx.nIndex != posInBlock || wtx.hashBlock != pIndex->GetBlockHash())) {\n+                    wtx.nIndex = posInBlock;\n+                    wtx.hashBlock = pIndex->GetBlockHash();\n+                    updated = true;\n+                }\n+                // Clear abandoned state assuming notification means it isn't\n+                // safe to consider the tranaction abandoned (see TODO above).",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r214549286",
      "id" : 214549286,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNDU0OTI4Ng==",
      "original_commit_id" : "a0d1323d7ef977b0ed78ec675d8bb14fa5e672d5",
      "original_line" : 975,
      "original_position" : 128,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 151629344,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/214549286",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r219424559"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219424559"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```\r\n2018-09-20 06:04:29 clang-tidy(pr=9381): src/wallet/wallet.cpp:843:64: warning: the parameter 'update_wtx' is copied for each invocation but only used as a const reference; consider making it a const reference [performance-unnecessary-value-param]\r\n2018-09-20 06:04:29 clang-tidy(pr=9381): src/wallet/wallet.cpp:903:66: warning: the parameter 'update_wtx' is copied for each invocation but only used as a const reference; consider making it a const reference [performance-unnecessary-value-param]\r\n```",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2018-09-21T08:45:08Z",
      "diff_hunk" : "@@ -833,65 +833,41 @@ bool CWallet::MarkReplaced(const uint256& originalHash, const uint256& newHash)\n     return success;\n }\n \n-bool CWallet::AddToWallet(const CWalletTx& wtxIn, bool fFlushOnClose)\n+bool CWallet::AddToWallet(CTransactionRef tx, UpdateWalletTxFn update_wtx, bool fFlushOnClose)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r219424559",
      "id" : 219424559,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTQyNDU1OQ==",
      "original_commit_id" : "a0d1323d7ef977b0ed78ec675d8bb14fa5e672d5",
      "original_line" : 843,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 157596935,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219424559",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r219424779"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219424779"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Seems like `SetMerkleBranch` can be removed.\r\n\r\n```\r\n2018-09-20 06:29:02 cppcheck(pr=9381): [src/wallet/wallet.cpp:4237]: (style) The function 'SetMerkleBranch' is never used.\r\n```",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2018-09-21T08:45:57Z",
      "diff_hunk" : "@@ -211,18 +211,11 @@ static int64_t AddTx(CWallet& wallet, uint32_t lockTime, int64_t mockTime, int64\n         block = inserted.first->second;\n         block->nTime = blockTime;\n         block->phashBlock = &hash;\n+        wallet.AddTransaction(MakeTransactionRef(tx), hash, 0);\n+    } else {\n+        wallet.AddTransaction(MakeTransactionRef(tx));\n     }\n-\n-    CWalletTx wtx(&wallet, MakeTransactionRef(tx));\n-    if (block) {\n-        wtx.SetMerkleBranch(block, 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r219424779",
      "id" : 219424779,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTQyNDc3OQ==",
      "original_commit_id" : "a0d1323d7ef977b0ed78ec675d8bb14fa5e672d5",
      "original_line" : 225,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/wallet/test/wallet_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 157597199,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219424779",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #18592 (rpc: replace raw pointers with shared_ptrs by brakmic)\n* #16910 (wallet: reduce loading time by using unordered maps by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2018-09-21T13:34:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-423532570",
      "id" : 423532570,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyMzUzMjU3MA==",
      "updated_at" : "2020-05-05T07:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/423532570",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r220432539"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220432539"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`new_tx` not used?",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2018-09-26T05:47:44Z",
      "diff_hunk" : "@@ -196,37 +196,41 @@ ReadKeyValue(CWallet* pwallet, CDataStream& ssKey, CDataStream& ssValue,\n         {\n             uint256 hash;\n             ssKey >> hash;\n-            CWalletTx wtx(nullptr /* pwallet */, MakeTransactionRef());\n-            ssValue >> wtx;\n-            CValidationState state;\n-            if (!(CheckTransaction(*wtx.tx, state) && (wtx.GetHash() == hash) && state.IsValid()))\n-                return false;\n+            auto update_wtx = [&](CWalletTx& wtx, bool new_tx) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r220432539",
      "id" : 220432539,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMDQzMjUzOQ==",
      "original_commit_id" : "15adcd19e49399590b5224a6a5e0a11e003eac53",
      "original_line" : 199,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 158838614,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220432539",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r220432586"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220432586"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`new_tx` not used?",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2018-09-26T05:48:07Z",
      "diff_hunk" : "@@ -992,13 +970,23 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransactionRef& ptx, const CBlockI\n                 }\n             }\n \n-            CWalletTx wtx(this, ptx);\n-\n-            // Get merkle branch if transaction was found in a block\n-            if (pIndex != nullptr)\n-                wtx.SetMerkleBranch(pIndex, posInBlock);\n-\n-            return AddToWallet(wtx, false);\n+            auto update_wtx = [&](CWalletTx& wtx, bool new_tx) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r220432586",
      "id" : 220432586,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMDQzMjU4Ng==",
      "original_commit_id" : "15adcd19e49399590b5224a6a5e0a11e003eac53",
      "original_line" : 973,
      "original_position" : 119,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 158838675,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220432586",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r220432616"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220432616"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`new_tx` not used?",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2018-09-26T05:48:23Z",
      "diff_hunk" : "@@ -1076,6 +1064,20 @@ bool CWallet::AbandonTransaction(const uint256& hashTx)\n     return true;\n }\n \n+bool CWallet::AddTransaction(CTransactionRef tx, const uint256& block_hash, int block_position)\n+{\n+    auto update_wtx = [&](CWalletTx& wtx, bool new_tx) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r220432616",
      "id" : 220432616,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMDQzMjYxNg==",
      "original_commit_id" : "15adcd19e49399590b5224a6a5e0a11e003eac53",
      "original_line" : 1069,
      "original_position" : 145,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 158838717,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220432616",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2018-10-24T09:41:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-432587989",
      "id" : 432587989,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMjU4Nzk4OQ==",
      "updated_at" : "2018-10-24T09:41:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/432587989",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2018-11-09T15:17:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-437390474",
      "id" : 437390474,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNzM5MDQ3NA==",
      "updated_at" : "2018-11-09T15:17:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/437390474",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r232517780"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/232517780"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Which TODO is this referring to?",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2018-11-12T01:47:00Z",
      "diff_hunk" : "@@ -992,13 +969,23 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransactionRef& ptx, const CBlockI\n                 }\n             }\n \n-            CWalletTx wtx(this, ptx);\n-\n-            // Get merkle branch if transaction was found in a block\n-            if (pIndex != nullptr)\n-                wtx.SetMerkleBranch(pIndex, posInBlock);\n-\n-            return AddToWallet(wtx, false);\n+            auto update_wtx = [&](CWalletTx& wtx, bool /* new_tx */) {\n+                bool updated = false;\n+                // Update block position if transaction was found in a block\n+                if (pIndex && (wtx.nIndex != posInBlock || wtx.hashBlock != pIndex->GetBlockHash())) {\n+                    wtx.nIndex = posInBlock;\n+                    wtx.hashBlock = pIndex->GetBlockHash();\n+                    updated = true;\n+                }\n+                // Clear abandoned state assuming notification means it isn't\n+                // safe to consider the transaction abandoned (see TODO above).",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r232517780",
      "id" : 232517780,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMjUxNzc4MA==",
      "original_commit_id" : "2c7c443718d525cf6a312eeba2d7331d05b380af",
      "original_line" : 981,
      "original_position" : 102,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 173730418,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/232517780",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/meshcollider/followers",
         "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/meshcollider",
         "id" : 3211283,
         "login" : "meshcollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
         "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
         "repos_url" : "https://api.github.com/users/meshcollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/meshcollider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r232517928"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/232517928"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should this flush on close? Default is true but previously it didn't",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2018-11-12T01:48:54Z",
      "diff_hunk" : "@@ -992,13 +969,23 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransactionRef& ptx, const CBlockI\n                 }\n             }\n \n-            CWalletTx wtx(this, ptx);\n-\n-            // Get merkle branch if transaction was found in a block\n-            if (pIndex != nullptr)\n-                wtx.SetMerkleBranch(pIndex, posInBlock);\n-\n-            return AddToWallet(wtx, false);\n+            auto update_wtx = [&](CWalletTx& wtx, bool /* new_tx */) {\n+                bool updated = false;\n+                // Update block position if transaction was found in a block\n+                if (pIndex && (wtx.nIndex != posInBlock || wtx.hashBlock != pIndex->GetBlockHash())) {\n+                    wtx.nIndex = posInBlock;\n+                    wtx.hashBlock = pIndex->GetBlockHash();\n+                    updated = true;\n+                }\n+                // Clear abandoned state assuming notification means it isn't\n+                // safe to consider the transaction abandoned (see TODO above).\n+                if (wtx.isAbandoned()) {\n+                    wtx.hashBlock.SetNull();\n+                    updated = true;\n+                }\n+                return updated;\n+            };\n+            return AddToWallet(MakeTransactionRef(tx), update_wtx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r232517928",
      "id" : 232517928,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMjUxNzkyOA==",
      "original_commit_id" : "2c7c443718d525cf6a312eeba2d7331d05b380af",
      "original_line" : 988,
      "original_position" : 109,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 173730418,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/232517928",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/meshcollider/followers",
         "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/meshcollider",
         "id" : 3211283,
         "login" : "meshcollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
         "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
         "repos_url" : "https://api.github.com/users/meshcollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/meshcollider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r232743997"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/232743997"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/9381#discussion_r232517780\r\n\r\n> Which TODO is this referring to?\r\n\r\nThis is referring to the abandoned transaction TODO in AddToWalletIfInvolvingMe:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/master/src/wallet/wallet.h#L654-L658\r\n\r\nThe TODO was moved in #13651 to where it doesn't really make a lot of sense, so I'm moving it back here in 845345c70c42411373a480406686b67870a235ad.",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2018-11-12T17:17:35Z",
      "diff_hunk" : "@@ -992,13 +969,23 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransactionRef& ptx, const CBlockI\n                 }\n             }\n \n-            CWalletTx wtx(this, ptx);\n-\n-            // Get merkle branch if transaction was found in a block\n-            if (pIndex != nullptr)\n-                wtx.SetMerkleBranch(pIndex, posInBlock);\n-\n-            return AddToWallet(wtx, false);\n+            auto update_wtx = [&](CWalletTx& wtx, bool /* new_tx */) {\n+                bool updated = false;\n+                // Update block position if transaction was found in a block\n+                if (pIndex && (wtx.nIndex != posInBlock || wtx.hashBlock != pIndex->GetBlockHash())) {\n+                    wtx.nIndex = posInBlock;\n+                    wtx.hashBlock = pIndex->GetBlockHash();\n+                    updated = true;\n+                }\n+                // Clear abandoned state assuming notification means it isn't\n+                // safe to consider the transaction abandoned (see TODO above).",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r232743997",
      "id" : 232743997,
      "in_reply_to_id" : 232517780,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMjc0Mzk5Nw==",
      "original_commit_id" : "2c7c443718d525cf6a312eeba2d7331d05b380af",
      "original_line" : 981,
      "original_position" : 102,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 174008578,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/232743997",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r232744206"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/232744206"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/9381#discussion_r232517928\r\n\r\n> Should this flush on close? Default is true but previously it didn't\r\n\r\nGood catch. It should be safe to flush on close, but this change was not intentional. It's now set back to false in 845345c70c42411373a480406686b67870a235ad.",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2018-11-12T17:18:17Z",
      "diff_hunk" : "@@ -992,13 +969,23 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransactionRef& ptx, const CBlockI\n                 }\n             }\n \n-            CWalletTx wtx(this, ptx);\n-\n-            // Get merkle branch if transaction was found in a block\n-            if (pIndex != nullptr)\n-                wtx.SetMerkleBranch(pIndex, posInBlock);\n-\n-            return AddToWallet(wtx, false);\n+            auto update_wtx = [&](CWalletTx& wtx, bool /* new_tx */) {\n+                bool updated = false;\n+                // Update block position if transaction was found in a block\n+                if (pIndex && (wtx.nIndex != posInBlock || wtx.hashBlock != pIndex->GetBlockHash())) {\n+                    wtx.nIndex = posInBlock;\n+                    wtx.hashBlock = pIndex->GetBlockHash();\n+                    updated = true;\n+                }\n+                // Clear abandoned state assuming notification means it isn't\n+                // safe to consider the transaction abandoned (see TODO above).\n+                if (wtx.isAbandoned()) {\n+                    wtx.hashBlock.SetNull();\n+                    updated = true;\n+                }\n+                return updated;\n+            };\n+            return AddToWallet(MakeTransactionRef(tx), update_wtx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r232744206",
      "id" : 232744206,
      "in_reply_to_id" : 232517928,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMjc0NDIwNg==",
      "original_commit_id" : "2c7c443718d525cf6a312eeba2d7331d05b380af",
      "original_line" : 988,
      "original_position" : 109,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 174008578,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/232744206",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-05-07T16:08:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-490145363",
      "id" : 490145363,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5MDE0NTM2Mw==",
      "updated_at" : "2019-05-07T16:08:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/490145363",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-07-30T05:13:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-516264717",
      "id" : 516264717,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNjI2NDcxNw==",
      "updated_at" : "2019-07-30T05:13:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/516264717",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-08-02T13:22:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-517698608",
      "id" : 517698608,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNzY5ODYwOA==",
      "updated_at" : "2019-08-02T13:22:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/517698608",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-08-12T18:48:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-520548729",
      "id" : 520548729,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMDU0ODcyOQ==",
      "updated_at" : "2019-08-12T18:48:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/520548729",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r314299889"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314299889"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe make `AddToWallet(` private to avoid exposing the `update_wtx` callback stuff?",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2019-08-15T13:10:34Z",
      "diff_hunk" : "@@ -1041,7 +1036,8 @@ class CWallet final : public FillableSigningProvider, private interfaces::Chain:\n     DBErrors ReorderTransactions();\n \n     void MarkDirty();\n-    bool AddToWallet(const CWalletTx& wtxIn, bool fFlushOnClose=true);\n+    typedef std::function<bool(CWalletTx& wtx, bool new_tx)> UpdateWalletTxFn;\n+    bool AddToWallet(CTransactionRef tx, const UpdateWalletTxFn& update_wtx, bool fFlushOnClose=true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r314299889",
      "id" : 314299889,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDI5OTg4OQ==",
      "original_commit_id" : "ea715a26257aa669d7e9577023dbec36dcb64936",
      "original_line" : 1046,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 275417709,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314299889",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r314376966"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314376966"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/9381#discussion_r314299889\r\n\r\n> Maybe make `AddToWallet(` private to avoid exposing the `update_wtx` callback stuff?\r\n\r\nI [added a doxygen comment](https://github.com/ryanofsky/bitcoin/compare/pr/atw-nomerge.61..pr/atw-nomerge.62) to avoid confusion around the update_wtx callback (which is also used in a later commit by LoadToWallet, not just AddWallet).\r\n\r\nI would change AddToWallet from public to private here too, but this is awkward because AddToWallet is called from a static test function which can't be declared as a friend:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/b8f3870c6a46052a80c694c0744a3eb56a9116ac/src/wallet/test/coinselector_tests.cpp#L68\r\n\r\nIn general I think trying to have better encapsulation in the wallet with a CWallet public / private boundary is probably never going to work out too well. Really CWallet needs to get broken up into smaller classes which can't access each others internal state, not just have a single big boundary.",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2019-08-15T15:52:55Z",
      "diff_hunk" : "@@ -1041,7 +1036,8 @@ class CWallet final : public FillableSigningProvider, private interfaces::Chain:\n     DBErrors ReorderTransactions();\n \n     void MarkDirty();\n-    bool AddToWallet(const CWalletTx& wtxIn, bool fFlushOnClose=true);\n+    typedef std::function<bool(CWalletTx& wtx, bool new_tx)> UpdateWalletTxFn;\n+    bool AddToWallet(CTransactionRef tx, const UpdateWalletTxFn& update_wtx, bool fFlushOnClose=true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r314376966",
      "id" : 314376966,
      "in_reply_to_id" : 314299889,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDM3Njk2Ng==",
      "original_commit_id" : "ea715a26257aa669d7e9577023dbec36dcb64936",
      "original_line" : 1046,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 275515359,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314376966",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> @achow101 how does this jive with wallet boxes #16341?\r\n\r\nAFAICT They don't interact at all. The only part of #16341 that touches transactions is a small section in `AddToWalletIfInvolvingMe` which this PR does not touch.",
      "created_at" : "2019-08-15T18:15:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-521741857",
      "id" : 521741857,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMTc0MTg1Nw==",
      "updated_at" : "2019-08-15T18:15:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/521741857",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-ACK 825a514481dd69dc7038c7f4c974a76cb2becd87, but Travis is in a state of despair, perhaps due to #16582 (@MarcoFalke?)",
      "created_at" : "2019-08-15T18:44:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-521751666",
      "id" : 521751666,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMTc1MTY2Ng==",
      "updated_at" : "2019-08-15T18:44:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/521751666",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r314803066"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314803066"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "If tx isn't already in mapWallet, it's going to be a fInsertedNew one, if it's already there we surely want to get them fUpdated on disk, and I think both callback return true, excepts for a transaction being disconnected ? Maybe all this flags could be simplified in a further work.",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2019-08-16T16:49:49Z",
      "diff_hunk" : "@@ -1086,73 +1086,50 @@ bool CWallet::IsUsedDestination(const uint256& hash, unsigned int n) const\n     return srctx && ExtractDestination(srctx->tx->vout[n].scriptPubKey, dst) && IsUsedDestination(dst);\n }\n \n-bool CWallet::AddToWallet(const CWalletTx& wtxIn, bool fFlushOnClose)\n+bool CWallet::AddToWallet(CTransactionRef tx, const UpdateWalletTxFn& update_wtx, bool fFlushOnClose)\n {\n     LOCK(cs_wallet);\n \n     WalletBatch batch(*database, \"r+\", fFlushOnClose);\n \n-    uint256 hash = wtxIn.GetHash();\n+    uint256 hash = tx->GetHash();\n \n     if (IsWalletFlagSet(WALLET_FLAG_AVOID_REUSE)) {\n         // Mark used destinations\n-        for (const CTxIn& txin : wtxIn.tx->vin) {\n+        for (const CTxIn& txin : tx->vin) {\n             const COutPoint& op = txin.prevout;\n             SetUsedDestinationState(op.hash, op.n, true);\n         }\n     }\n \n     // Inserts only if not already there, returns tx inserted or tx found\n-    std::pair<std::map<uint256, CWalletTx>::iterator, bool> ret = mapWallet.insert(std::make_pair(hash, wtxIn));\n+    auto ret = mapWallet.emplace(std::piecewise_construct, std::forward_as_tuple(hash), std::forward_as_tuple(this, tx));\n     CWalletTx& wtx = (*ret.first).second;\n     wtx.BindWallet(this);\n     bool fInsertedNew = ret.second;\n+    bool fUpdated = update_wtx(wtx, fInsertedNew);\n     if (fInsertedNew) {\n         wtx.nTimeReceived = chain().getAdjustedTime();\n         wtx.nOrderPos = IncOrderPosNext(&batch);\n         wtx.m_it_wtxOrdered = wtxOrdered.insert(std::make_pair(wtx.nOrderPos, &wtx));\n         wtx.nTimeSmart = ComputeTimeSmart(wtx);\n         AddToSpends(hash);\n     }\n-\n-    bool fUpdated = false;\n     if (!fInsertedNew)\n     {\n-        // Merge\n-        if (!wtxIn.hashUnset() && wtxIn.hashBlock != wtx.hashBlock)\n-        {\n-            wtx.hashBlock = wtxIn.hashBlock;\n-            fUpdated = true;\n-        }\n-        // If no longer abandoned, update\n-        if (wtxIn.hashBlock.IsNull() && wtx.isAbandoned())\n-        {\n-            wtx.hashBlock = wtxIn.hashBlock;\n-            fUpdated = true;\n-        }\n-        if (wtxIn.nIndex != -1 && (wtxIn.nIndex != wtx.nIndex))\n-        {\n-            wtx.nIndex = wtxIn.nIndex;\n-            fUpdated = true;\n-        }\n-        if (wtxIn.fFromMe && wtxIn.fFromMe != wtx.fFromMe)\n-        {\n-            wtx.fFromMe = wtxIn.fFromMe;\n-            fUpdated = true;\n-        }\n         // If we have a witness-stripped version of this transaction, and we\n         // see a new version with a witness, then we must be upgrading a pre-segwit\n         // wallet.  Store the new version of the transaction with the witness,\n         // as the stripped-version must be invalid.\n         // TODO: Store all versions of the transaction, instead of just one.\n-        if (wtxIn.tx->HasWitness() && !wtx.tx->HasWitness()) {\n-            wtx.SetTx(wtxIn.tx);\n+        if (tx->HasWitness() && !wtx.tx->HasWitness()) {\n+            wtx.SetTx(tx);\n             fUpdated = true;\n         }\n     }\n \n     //// debug print\n-    WalletLogPrintf(\"AddToWallet %s  %s%s\\n\", wtxIn.GetHash().ToString(), (fInsertedNew ? \"new\" : \"\"), (fUpdated ? \"update\" : \"\"));\n+    WalletLogPrintf(\"AddToWallet %s  %s%s\\n\", hash.ToString(), (fInsertedNew ? \"new\" : \"\"), (fUpdated ? \"update\" : \"\"));\n \n     // Write to disk\n     if (fInsertedNew || fUpdated)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r314803066",
      "id" : 314803066,
      "line" : 848,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDgwMzA2Ng==",
      "original_commit_id" : "6731aac44784a4be3f195989549defd0d04d695b",
      "original_line" : 848,
      "original_position" : 81,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 87,
      "pull_request_review_id" : 276057005,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314803066",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r314813155"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314813155"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hmmm new execution flow doesn't make it easier to understand. Maybe mapWallet should be access directly in `ReadKeyValue`, when as you said in another comment wallet components are broken up in smaller classes. I think, but need to test, that `MarkConflicted` and its loop is useless here.",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2019-08-16T17:18:04Z",
      "diff_hunk" : "@@ -1157,12 +1157,13 @@ bool CWallet::AddToWallet(CTransactionRef tx, const UpdateWalletTxFn& update_wtx\n     return true;\n }\n \n-void CWallet::LoadToWallet(const CWalletTx& wtxIn)\n+bool CWallet::LoadToWallet(const uint256& hash, const UpdateWalletTxFn& update_wtx)\n {\n-    uint256 hash = wtxIn.GetHash();\n-    const auto& ins = mapWallet.emplace(hash, wtxIn);\n+    auto ins = mapWallet.emplace(std::piecewise_construct, std::forward_as_tuple(hash), std::forward_as_tuple(this, nullptr));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r314813155",
      "id" : 314813155,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDgxMzE1NQ==",
      "original_commit_id" : "8c4c8cc53896f01ea1fd4a09ba0e01052b4fbad4",
      "original_line" : 1161,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 276057005,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314813155",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-09-05T14:11:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-528383439",
      "id" : 528383439,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyODM4MzQzOQ==",
      "updated_at" : "2019-09-05T14:11:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/528383439",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r322920662"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/322920662"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/9381#discussion_r314803066\r\n\r\n> If tx isn't already in mapWallet, it's going to be a fInsertedNew one, if it's already there we surely want to get them fUpdated on disk, and I think both callback return true, excepts for a transaction being disconnected ? Maybe all this flags could be simplified in a further work.\r\n\r\nI think this is basically never false right now, but it seems reasonable to me that there should be a way to avoid writing transaction metadata to disk when it is unchanged. I'd also be happy to simplify this if you see a way to do that, but for the now the PR isn't really changing anything here.",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2019-09-10T19:24:58Z",
      "diff_hunk" : "@@ -1086,73 +1086,50 @@ bool CWallet::IsUsedDestination(const uint256& hash, unsigned int n) const\n     return srctx && ExtractDestination(srctx->tx->vout[n].scriptPubKey, dst) && IsUsedDestination(dst);\n }\n \n-bool CWallet::AddToWallet(const CWalletTx& wtxIn, bool fFlushOnClose)\n+bool CWallet::AddToWallet(CTransactionRef tx, const UpdateWalletTxFn& update_wtx, bool fFlushOnClose)\n {\n     LOCK(cs_wallet);\n \n     WalletBatch batch(*database, \"r+\", fFlushOnClose);\n \n-    uint256 hash = wtxIn.GetHash();\n+    uint256 hash = tx->GetHash();\n \n     if (IsWalletFlagSet(WALLET_FLAG_AVOID_REUSE)) {\n         // Mark used destinations\n-        for (const CTxIn& txin : wtxIn.tx->vin) {\n+        for (const CTxIn& txin : tx->vin) {\n             const COutPoint& op = txin.prevout;\n             SetUsedDestinationState(op.hash, op.n, true);\n         }\n     }\n \n     // Inserts only if not already there, returns tx inserted or tx found\n-    std::pair<std::map<uint256, CWalletTx>::iterator, bool> ret = mapWallet.insert(std::make_pair(hash, wtxIn));\n+    auto ret = mapWallet.emplace(std::piecewise_construct, std::forward_as_tuple(hash), std::forward_as_tuple(this, tx));\n     CWalletTx& wtx = (*ret.first).second;\n     wtx.BindWallet(this);\n     bool fInsertedNew = ret.second;\n+    bool fUpdated = update_wtx(wtx, fInsertedNew);\n     if (fInsertedNew) {\n         wtx.nTimeReceived = chain().getAdjustedTime();\n         wtx.nOrderPos = IncOrderPosNext(&batch);\n         wtx.m_it_wtxOrdered = wtxOrdered.insert(std::make_pair(wtx.nOrderPos, &wtx));\n         wtx.nTimeSmart = ComputeTimeSmart(wtx);\n         AddToSpends(hash);\n     }\n-\n-    bool fUpdated = false;\n     if (!fInsertedNew)\n     {\n-        // Merge\n-        if (!wtxIn.hashUnset() && wtxIn.hashBlock != wtx.hashBlock)\n-        {\n-            wtx.hashBlock = wtxIn.hashBlock;\n-            fUpdated = true;\n-        }\n-        // If no longer abandoned, update\n-        if (wtxIn.hashBlock.IsNull() && wtx.isAbandoned())\n-        {\n-            wtx.hashBlock = wtxIn.hashBlock;\n-            fUpdated = true;\n-        }\n-        if (wtxIn.nIndex != -1 && (wtxIn.nIndex != wtx.nIndex))\n-        {\n-            wtx.nIndex = wtxIn.nIndex;\n-            fUpdated = true;\n-        }\n-        if (wtxIn.fFromMe && wtxIn.fFromMe != wtx.fFromMe)\n-        {\n-            wtx.fFromMe = wtxIn.fFromMe;\n-            fUpdated = true;\n-        }\n         // If we have a witness-stripped version of this transaction, and we\n         // see a new version with a witness, then we must be upgrading a pre-segwit\n         // wallet.  Store the new version of the transaction with the witness,\n         // as the stripped-version must be invalid.\n         // TODO: Store all versions of the transaction, instead of just one.\n-        if (wtxIn.tx->HasWitness() && !wtx.tx->HasWitness()) {\n-            wtx.SetTx(wtxIn.tx);\n+        if (tx->HasWitness() && !wtx.tx->HasWitness()) {\n+            wtx.SetTx(tx);\n             fUpdated = true;\n         }\n     }\n \n     //// debug print\n-    WalletLogPrintf(\"AddToWallet %s  %s%s\\n\", wtxIn.GetHash().ToString(), (fInsertedNew ? \"new\" : \"\"), (fUpdated ? \"update\" : \"\"));\n+    WalletLogPrintf(\"AddToWallet %s  %s%s\\n\", hash.ToString(), (fInsertedNew ? \"new\" : \"\"), (fUpdated ? \"update\" : \"\"));\n \n     // Write to disk\n     if (fInsertedNew || fUpdated)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r322920662",
      "id" : 322920662,
      "in_reply_to_id" : 314803066,
      "line" : 848,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyMjkyMDY2Mg==",
      "original_commit_id" : "6731aac44784a4be3f195989549defd0d04d695b",
      "original_line" : 848,
      "original_position" : 81,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 87,
      "pull_request_review_id" : 286381381,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/322920662",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r322920715"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/322920715"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/9381#discussion_r314813155\r\n\r\n> Hmmm new execution flow doesn't make it easier to understand. Maybe mapWallet should be access directly in `ReadKeyValue`, when as you said in another comment wallet components are broken up in smaller classes. I think, but need to test, that `MarkConflicted` and its loop is useless here.\r\n\r\nThese improvements seem like good ideas, they're just larger changes than this one is. I agree that the local control flow is a more complicated here, but I think it's a good tradeoff to be able to get rid of the CWalletTx copy constructor, and get rid of all code that is filling a temporary CWalletTx and then merging two CWalletTx's together instead of directly updating a single CWalletTx.\r\n\r\nThis emplace on this line is a good example of how fragile the temporary CWalletTx merging logic can be. If the hash already exists the data in wtxIn is just silently discarded in a different part of the code from where the data was loaded. In the new flow there is no temporary CWalletTx, and the code responsible for loading data can directly control what goes into the final CWalletTx.",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2019-09-10T19:25:05Z",
      "diff_hunk" : "@@ -1157,12 +1157,13 @@ bool CWallet::AddToWallet(CTransactionRef tx, const UpdateWalletTxFn& update_wtx\n     return true;\n }\n \n-void CWallet::LoadToWallet(const CWalletTx& wtxIn)\n+bool CWallet::LoadToWallet(const uint256& hash, const UpdateWalletTxFn& update_wtx)\n {\n-    uint256 hash = wtxIn.GetHash();\n-    const auto& ins = mapWallet.emplace(hash, wtxIn);\n+    auto ins = mapWallet.emplace(std::piecewise_construct, std::forward_as_tuple(hash), std::forward_as_tuple(this, nullptr));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r322920715",
      "id" : 322920715,
      "in_reply_to_id" : 314813155,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyMjkyMDcxNQ==",
      "original_commit_id" : "8c4c8cc53896f01ea1fd4a09ba0e01052b4fbad4",
      "original_line" : 1161,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 286381381,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/322920715",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-10-23T10:50:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-545385662",
      "id" : 545385662,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NTM4NTY2Mg==",
      "updated_at" : "2019-10-23T10:50:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/545385662",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-10-24T11:41:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-545878919",
      "id" : 545878919,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NTg3ODkxOQ==",
      "updated_at" : "2019-10-24T11:41:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/545878919",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-11-08T11:06:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-551591602",
      "id" : 551591602,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1MTU5MTYwMg==",
      "updated_at" : "2019-11-08T11:06:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/551591602",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-11-22T20:04:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-557674762",
      "id" : 557674762,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1NzY3NDc2Mg==",
      "updated_at" : "2019-11-22T20:04:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/557674762",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Sorry about all the rebases, Concept ACK",
      "created_at" : "2019-11-22T21:15:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-557697310",
      "id" : 557697310,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1NzY5NzMxMA==",
      "updated_at" : "2019-11-22T21:15:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/557697310",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/meshcollider/followers",
         "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/meshcollider",
         "id" : 3211283,
         "login" : "meshcollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
         "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
         "repos_url" : "https://api.github.com/users/meshcollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/meshcollider"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-12-04T11:30:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-561604440",
      "id" : 561604440,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU2MTYwNDQ0MA==",
      "updated_at" : "2019-12-04T11:30:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/561604440",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2019-12-04T13:17:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-561640984",
      "id" : 561640984,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU2MTY0MDk4NA==",
      "updated_at" : "2019-12-04T13:17:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/561640984",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2020-01-15T10:14:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-574590984",
      "id" : 574590984,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NDU5MDk4NA==",
      "updated_at" : "2020-01-15T10:14:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/574590984",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2020-02-17T12:23:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-586970036",
      "id" : 586970036,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4Njk3MDAzNg==",
      "updated_at" : "2020-02-17T12:23:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/586970036",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased dff3c12515773bef07756bb2420da5a1ac8e1438 -> 93510bcfe80385203880d1211cb94f621411839e ([`pr/atw-nomerge.74`](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.74) -> [`pr/atw-nomerge.75`](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.75), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/atw-nomerge.74-rebase..pr/atw-nomerge.75)) due to minor conflict with #13339\r\n",
      "created_at" : "2020-02-25T17:40:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-590983096",
      "id" : 590983096,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MDk4MzA5Ng==",
      "updated_at" : "2020-02-25T17:40:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/590983096",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r384365942"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384365942"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 03c5ac045f94ab965d79300712a70a0357397d5e `Remove CWalletTx merging logic from AddToWallet`: it might make sense to have a seperate commit that adds the `confirm` argument.\r\n(maybe not worth confusing existing reviewers)",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2020-02-26T09:23:30Z",
      "diff_hunk" : "@@ -763,19 +763,19 @@ bool CWallet::IsSpentKey(const uint256& hash, unsigned int n) const\n     return false;\n }\n \n-bool CWallet::AddToWallet(const CWalletTx& wtxIn, bool fFlushOnClose)\n+bool CWallet::AddToWallet(CTransactionRef tx, const CWalletTx::Confirmation& confirm, const UpdateWalletTxFn& update_wtx, bool fFlushOnClose)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r384365942",
      "id" : 384365942,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDM2NTk0Mg==",
      "original_commit_id" : "03c5ac045f94ab965d79300712a70a0357397d5e",
      "original_line" : 766,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 364736597,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384365942",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r384374046"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384374046"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: \"false _if_ it\"",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2020-02-26T09:37:39Z",
      "diff_hunk" : "@@ -871,7 +871,16 @@ class CWallet final : public WalletStorage, private interfaces::Chain::Notificat\n     DBErrors ReorderTransactions();\n \n     void MarkDirty();\n-    bool AddToWallet(const CWalletTx& wtxIn, bool fFlushOnClose=true);\n+\n+    //! Callback for updating transaction metadata in mapWallet.\n+    //!\n+    //! @param wtx - reference to mapWallet transaction to update\n+    //! @param new_tx - true if wtx is newly inserted, false it it previously existed",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r384374046",
      "id" : 384374046,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDM3NDA0Ng==",
      "original_commit_id" : "03c5ac045f94ab965d79300712a70a0357397d5e",
      "original_line" : 878,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 364736597,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384374046",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r384384050"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384384050"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why the `/* Continued */` comment?",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2020-02-26T09:54:32Z",
      "diff_hunk" : "@@ -2951,37 +2942,38 @@ void CWallet::CommitTransaction(CTransactionRef tx, mapValue_t mapValue, std::ve\n {\n     auto locked_chain = chain().lock();\n     LOCK(cs_wallet);\n+    WalletLogPrintf(\"CommitTransaction:\\n%s\", tx->ToString()); /* Continued */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r384384050",
      "id" : 384384050,
      "line" : 3003,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDM4NDA1MA==",
      "original_commit_id" : "03c5ac045f94ab965d79300712a70a0357397d5e",
      "original_line" : 3003,
      "original_position" : 116,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 188,
      "pull_request_review_id" : 364736597,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384384050",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r384391256"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384391256"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Make this a runtime exception? Perhaps there's some weird edge case, I haven't tried, where a user restores their wallet from a backup on a node with a fresh mempool. The user then recreates the same* transaction in the UI and as they look at the confirmation screen, the transaction re-enters the mempool. Once they click OK this assert should be hit.\r\n\r\n`*` = IIUC it's only a duplicate if they use the same inputs, outputs, fee,  if we shuffle them the same way and if the block height hasn't changed",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2020-02-26T10:06:34Z",
      "diff_hunk" : "@@ -2951,37 +2942,38 @@ void CWallet::CommitTransaction(CTransactionRef tx, mapValue_t mapValue, std::ve\n {\n     auto locked_chain = chain().lock();\n     LOCK(cs_wallet);\n+    WalletLogPrintf(\"CommitTransaction:\\n%s\", tx->ToString()); /* Continued */\n \n-    CWalletTx wtxNew(this, std::move(tx));\n-    wtxNew.mapValue = std::move(mapValue);\n-    wtxNew.vOrderForm = std::move(orderForm);\n-    wtxNew.fTimeReceivedIsTxTime = true;\n-    wtxNew.fFromMe = true;\n-\n-    WalletLogPrintf(\"CommitTransaction:\\n%s\", wtxNew.tx->ToString()); /* Continued */\n+    // Get the inserted-CWalletTx from mapWallet so that the\n+    // fInMempool flag is cached properly\n+    CWalletTx* wtx = nullptr;\n \n     // Add tx to wallet, because if it has change it's also ours,\n     // otherwise just for transaction history.\n-    AddToWallet(wtxNew);\n+    AddToWallet(std::move(tx), {}, [&](CWalletTx& new_wtx, bool new_tx) {\n+        assert(new_tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r384391256",
      "id" : 384391256,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDM5MTI1Ng==",
      "original_commit_id" : "03c5ac045f94ab965d79300712a70a0357397d5e",
      "original_line" : 2954,
      "original_position" : 133,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 364736597,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384391256",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r384419297"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384419297"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 754eb2112aac4729805dcc547bef1de956c3c14d `Avoid copying CWalletTx in LoadToWallet`\r\n\r\nThe \"result\" of (formerly `void`) `LoadToWallet` has always been ignored. Perhaps that's because before https://github.com/bitcoin/bitcoin/pull/3671/files#diff-3b5a9b7d780ff672241548edf2888fcdL385 we just updated the transaction map directly.\r\n\r\nCan you think of any silent failures that would now result in `ReadKeyValue` failing, and IIUC trigger a rescan? (cc @achow101)\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/2d6e76af240969aa284cd4c3d376493988e218c2/src/wallet/walletdb.cpp#L469-L483",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2020-02-26T10:57:18Z",
      "diff_hunk" : "@@ -214,36 +214,40 @@ ReadKeyValue(CWallet* pwallet, CDataStream& ssKey, CDataStream& ssValue,\n         } else if (strType == DBKeys::TX) {\n             uint256 hash;\n             ssKey >> hash;\n-            CWalletTx wtx(nullptr /* pwallet */, MakeTransactionRef());\n-            ssValue >> wtx;\n-            if (wtx.GetHash() != hash)\n-                return false;\n+            auto update_wtx = [&](CWalletTx& wtx, bool /* new_tx */) {\n+                ssValue >> wtx;\n+                if (wtx.GetHash() != hash)\n+                    return false;\n \n-            // Undo serialize changes in 31600\n-            if (31404 <= wtx.fTimeReceivedIsTxTime && wtx.fTimeReceivedIsTxTime <= 31703)\n-            {\n-                if (!ssValue.empty())\n+                // Undo serialize changes in 31600\n+                if (31404 <= wtx.fTimeReceivedIsTxTime && wtx.fTimeReceivedIsTxTime <= 31703)\n                 {\n-                    char fTmp;\n-                    char fUnused;\n-                    std::string unused_string;\n-                    ssValue >> fTmp >> fUnused >> unused_string;\n-                    strErr = strprintf(\"LoadWallet() upgrading tx ver=%d %d %s\",\n-                                       wtx.fTimeReceivedIsTxTime, fTmp, hash.ToString());\n-                    wtx.fTimeReceivedIsTxTime = fTmp;\n+                    if (!ssValue.empty())\n+                    {\n+                        char fTmp;\n+                        char fUnused;\n+                        std::string unused_string;\n+                        ssValue >> fTmp >> fUnused >> unused_string;\n+                        strErr = strprintf(\"LoadWallet() upgrading tx ver=%d %d %s\",\n+                                           wtx.fTimeReceivedIsTxTime, fTmp, hash.ToString());\n+                        wtx.fTimeReceivedIsTxTime = fTmp;\n+                    }\n+                    else\n+                    {\n+                        strErr = strprintf(\"LoadWallet() repairing tx ver=%d %s\", wtx.fTimeReceivedIsTxTime, hash.ToString());\n+                        wtx.fTimeReceivedIsTxTime = 0;\n+                    }\n+                    wss.vWalletUpgrade.push_back(hash);\n                 }\n-                else\n-                {\n-                    strErr = strprintf(\"LoadWallet() repairing tx ver=%d %s\", wtx.fTimeReceivedIsTxTime, hash.ToString());\n-                    wtx.fTimeReceivedIsTxTime = 0;\n-                }\n-                wss.vWalletUpgrade.push_back(hash);\n-            }\n \n-            if (wtx.nOrderPos == -1)\n-                wss.fAnyUnordered = true;\n+                if (wtx.nOrderPos == -1)\n+                    wss.fAnyUnordered = true;\n \n-            pwallet->LoadToWallet(wtx);\n+                return true;\n+            };\n+            if (!pwallet->LoadToWallet(hash, update_wtx)) {\n+                return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r384419297",
      "id" : 384419297,
      "line" : 310,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDQxOTI5Nw==",
      "original_commit_id" : "754eb2112aac4729805dcc547bef1de956c3c14d",
      "original_line" : 310,
      "original_position" : 61,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : 64,
      "pull_request_review_id" : 364736597,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384419297",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r384430073"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384430073"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 754eb2112aac4729805dcc547bef1de956c3c14d `Avoid copying CWalletTx in LoadToWallet`\r\n\r\nMaybe add a comment here that `LoadToWallet` creates a fresh `CWalletTx` and that we fill it with `ssValue` (hence my rename to `fill_wtx` suggestion above).\r\n\r\nSince a wallet doesn't (shouldn't? otherwise add `assert(new_tx)`) have duplicate transactions `new_tx` should be `true`, but if some reason a wallet entry does exists it will be overridden.",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2020-02-26T11:19:12Z",
      "diff_hunk" : "@@ -214,36 +214,40 @@ ReadKeyValue(CWallet* pwallet, CDataStream& ssKey, CDataStream& ssValue,\n         } else if (strType == DBKeys::TX) {\n             uint256 hash;\n             ssKey >> hash;\n-            CWalletTx wtx(nullptr /* pwallet */, MakeTransactionRef());\n-            ssValue >> wtx;\n-            if (wtx.GetHash() != hash)\n-                return false;\n+            auto update_wtx = [&](CWalletTx& wtx, bool /* new_tx */) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r384430073",
      "id" : 384430073,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDQzMDA3Mw==",
      "original_commit_id" : "754eb2112aac4729805dcc547bef1de956c3c14d",
      "original_line" : 217,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 364736597,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384430073",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r384433800"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384433800"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe rename `update_wtx` to `fill_wtx `.",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2020-02-26T11:27:10Z",
      "diff_hunk" : "@@ -858,33 +858,34 @@ bool CWallet::AddToWallet(CTransactionRef tx, const CWalletTx::Confirmation& con\n     return true;\n }\n \n-void CWallet::LoadToWallet(CWalletTx& wtxIn)\n+bool CWallet::LoadToWallet(const uint256& hash, const UpdateWalletTxFn& update_wtx)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r384433800",
      "id" : 384433800,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDQzMzgwMA==",
      "original_commit_id" : "754eb2112aac4729805dcc547bef1de956c3c14d",
      "original_line" : 861,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 364736597,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384433800",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r384443528"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384443528"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe briefly mention this in the commit message, as the change from `std::vector` to `std::list` looks a bit out of the blue (until you try compiling without).",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2020-02-26T11:48:52Z",
      "diff_hunk" : "@@ -668,12 +668,9 @@ DBErrors CWalletDB::FindWalletTx(std::vector<uint256>& vTxHash, std::vector<CWal\n             if (strType == \"tx\") {\n                 uint256 hash;\n                 ssKey >> hash;\n-\n-                CWalletTx wtx(nullptr /* pwallet */, MakeTransactionRef());\n-                ssValue >> wtx;\n-\n                 vTxHash.push_back(hash);\n-                vWtx.push_back(wtx);\n+                vWtx.emplace_back(nullptr /* wallet */, nullptr /* tx */);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r384443528",
      "id" : 384443528,
      "in_reply_to_id" : 174957667,
      "line" : 780,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDQ0MzUyOA==",
      "original_commit_id" : "bf59f2135d93bc175f7a1f630285d6479580e291",
      "original_line" : 780,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : 88,
      "pull_request_review_id" : 364736597,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384443528",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r384536100"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384536100"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/9381#discussion_r384365942\r\n\r\n> In [03c5ac0](https://github.com/bitcoin/bitcoin/commit/03c5ac045f94ab965d79300712a70a0357397d5e) `Remove CWalletTx merging logic from AddToWallet`: it might make sense to have a seperate commit that adds the `confirm` argument.\r\n> (maybe not worth confusing existing reviewers)\r\n\r\nThis is a good thought, and I started to implement it, but the problem is if I just make a commit adding the confirm argument, then there are two confirm objects being passed to AddToWallet (the other one embedded in the CWalletTx object), which is confusing because it's unclear which confirmation should take precedence. If I change the CWalletTx argument to a TransactionRef to solve this problem, then there is no way for callers to set to the other CWalletTx fields (mapValue, vOrderForm, etc), and I have to add the update_wtx argument too, which is already the whole current commit",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2020-02-26T14:43:57Z",
      "diff_hunk" : "@@ -763,19 +763,19 @@ bool CWallet::IsSpentKey(const uint256& hash, unsigned int n) const\n     return false;\n }\n \n-bool CWallet::AddToWallet(const CWalletTx& wtxIn, bool fFlushOnClose)\n+bool CWallet::AddToWallet(CTransactionRef tx, const CWalletTx::Confirmation& confirm, const UpdateWalletTxFn& update_wtx, bool fFlushOnClose)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r384536100",
      "id" : 384536100,
      "in_reply_to_id" : 384365942,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDUzNjEwMA==",
      "original_commit_id" : "03c5ac045f94ab965d79300712a70a0357397d5e",
      "original_line" : 766,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 364955330,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384536100",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r384536183"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384536183"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/9381#discussion_r384384050\r\n\r\n> Why the `/* Continued */` comment?\r\n\r\nThis is unchanged from previous code, but it's needed to print a lint error since the log format string doesn't end in `\\n`",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2020-02-26T14:44:04Z",
      "diff_hunk" : "@@ -2951,37 +2942,38 @@ void CWallet::CommitTransaction(CTransactionRef tx, mapValue_t mapValue, std::ve\n {\n     auto locked_chain = chain().lock();\n     LOCK(cs_wallet);\n+    WalletLogPrintf(\"CommitTransaction:\\n%s\", tx->ToString()); /* Continued */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r384536183",
      "id" : 384536183,
      "in_reply_to_id" : 384384050,
      "line" : 3003,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDUzNjE4Mw==",
      "original_commit_id" : "03c5ac045f94ab965d79300712a70a0357397d5e",
      "original_line" : 3003,
      "original_position" : 116,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 188,
      "pull_request_review_id" : 364955330,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384536183",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r384536300"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384536300"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/9381#discussion_r384391256\r\n\r\n> Make this a runtime exception? Perhaps there's some weird edge case, I haven't tried, where a user restores their wallet from a backup on a node with a fresh mempool. The user then recreates the same* transaction in the UI and as they look at the confirmation screen, the transaction re-enters the mempool. Once they click OK this assert should be hit.\r\n\r\nGood point. Since there can be an arbitrary delay before the GUI commits the transaction, it isn't safe to assert assert the transaction is new. I removed the assert and just replaced it with nonfatal checks to make sure there aren't conflicting mapValue and order form values.",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2020-02-26T14:44:14Z",
      "diff_hunk" : "@@ -2951,37 +2942,38 @@ void CWallet::CommitTransaction(CTransactionRef tx, mapValue_t mapValue, std::ve\n {\n     auto locked_chain = chain().lock();\n     LOCK(cs_wallet);\n+    WalletLogPrintf(\"CommitTransaction:\\n%s\", tx->ToString()); /* Continued */\n \n-    CWalletTx wtxNew(this, std::move(tx));\n-    wtxNew.mapValue = std::move(mapValue);\n-    wtxNew.vOrderForm = std::move(orderForm);\n-    wtxNew.fTimeReceivedIsTxTime = true;\n-    wtxNew.fFromMe = true;\n-\n-    WalletLogPrintf(\"CommitTransaction:\\n%s\", wtxNew.tx->ToString()); /* Continued */\n+    // Get the inserted-CWalletTx from mapWallet so that the\n+    // fInMempool flag is cached properly\n+    CWalletTx* wtx = nullptr;\n \n     // Add tx to wallet, because if it has change it's also ours,\n     // otherwise just for transaction history.\n-    AddToWallet(wtxNew);\n+    AddToWallet(std::move(tx), {}, [&](CWalletTx& new_wtx, bool new_tx) {\n+        assert(new_tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r384536300",
      "id" : 384536300,
      "in_reply_to_id" : 384391256,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDUzNjMwMA==",
      "original_commit_id" : "03c5ac045f94ab965d79300712a70a0357397d5e",
      "original_line" : 2954,
      "original_position" : 133,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 364955330,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384536300",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r384536374"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384536374"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/9381#discussion_r384374046\r\n\r\n> Nit: \"false _if_ it\"\r\n\r\nThank you, fixed!",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2020-02-26T14:44:21Z",
      "diff_hunk" : "@@ -871,7 +871,16 @@ class CWallet final : public WalletStorage, private interfaces::Chain::Notificat\n     DBErrors ReorderTransactions();\n \n     void MarkDirty();\n-    bool AddToWallet(const CWalletTx& wtxIn, bool fFlushOnClose=true);\n+\n+    //! Callback for updating transaction metadata in mapWallet.\n+    //!\n+    //! @param wtx - reference to mapWallet transaction to update\n+    //! @param new_tx - true if wtx is newly inserted, false it it previously existed",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r384536374",
      "id" : 384536374,
      "in_reply_to_id" : 384374046,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDUzNjM3NA==",
      "original_commit_id" : "03c5ac045f94ab965d79300712a70a0357397d5e",
      "original_line" : 878,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 364955330,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384536374",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r384536559"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384536559"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/9381#discussion_r384433800\r\n\r\n> Maybe rename `update_wtx` to `fill_wtx `.\r\n\r\nDone",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2020-02-26T14:44:39Z",
      "diff_hunk" : "@@ -858,33 +858,34 @@ bool CWallet::AddToWallet(CTransactionRef tx, const CWalletTx::Confirmation& con\n     return true;\n }\n \n-void CWallet::LoadToWallet(CWalletTx& wtxIn)\n+bool CWallet::LoadToWallet(const uint256& hash, const UpdateWalletTxFn& update_wtx)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r384536559",
      "id" : 384536559,
      "in_reply_to_id" : 384433800,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDUzNjU1OQ==",
      "original_commit_id" : "754eb2112aac4729805dcc547bef1de956c3c14d",
      "original_line" : 861,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 364955330,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384536559",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r384536681"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384536681"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/9381#discussion_r384430073\r\n\r\n> In [754eb21](https://github.com/bitcoin/bitcoin/commit/754eb2112aac4729805dcc547bef1de956c3c14d) `Avoid copying CWalletTx in LoadToWallet`\r\n> \r\n> Maybe add a comment here that `LoadToWallet` creates a fresh `CWalletTx` and that we fill it with `ssValue` (hence my rename to `fill_wtx` suggestion above).\r\n> \r\n> Since a wallet doesn't (shouldn't? otherwise add `assert(new_tx)`) have duplicate transactions `new_tx` should be `true`, but if some reason a wallet entry does exists it will be overridden.\r\n\r\nAdded comment and assert",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2020-02-26T14:44:50Z",
      "diff_hunk" : "@@ -214,36 +214,40 @@ ReadKeyValue(CWallet* pwallet, CDataStream& ssKey, CDataStream& ssValue,\n         } else if (strType == DBKeys::TX) {\n             uint256 hash;\n             ssKey >> hash;\n-            CWalletTx wtx(nullptr /* pwallet */, MakeTransactionRef());\n-            ssValue >> wtx;\n-            if (wtx.GetHash() != hash)\n-                return false;\n+            auto update_wtx = [&](CWalletTx& wtx, bool /* new_tx */) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r384536681",
      "id" : 384536681,
      "in_reply_to_id" : 384430073,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDUzNjY4MQ==",
      "original_commit_id" : "754eb2112aac4729805dcc547bef1de956c3c14d",
      "original_line" : 217,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 364955330,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384536681",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r384536761"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384536761"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/9381#discussion_r384419297\r\n\r\n> In [754eb21](https://github.com/bitcoin/bitcoin/commit/754eb2112aac4729805dcc547bef1de956c3c14d) `Avoid copying CWalletTx in LoadToWallet`\r\n> \r\n> The \"result\" of (formerly `void`) `LoadToWallet` has always been ignored. Perhaps that's because before https://github.com/bitcoin/bitcoin/pull/3671/files#diff-3b5a9b7d780ff672241548edf2888fcdL385 we just updated the transaction map directly.\r\n> \r\n> Can you think of any silent failures that would now result in `ReadKeyValue` failing, and IIUC trigger a rescan? (cc @achow101)\r\n\r\nIt might be worth thinking about how to improve error handling in this code, but behavior shouldn't be changing here. LoadToWallet will only return false if fill_wtx returns false, and fill_wtx only returns false if `wtx.GetHash() != hash`. So ReadKeyValue should be returning true all the times it used to return true and false and the times it used to return false",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2020-02-26T14:44:58Z",
      "diff_hunk" : "@@ -214,36 +214,40 @@ ReadKeyValue(CWallet* pwallet, CDataStream& ssKey, CDataStream& ssValue,\n         } else if (strType == DBKeys::TX) {\n             uint256 hash;\n             ssKey >> hash;\n-            CWalletTx wtx(nullptr /* pwallet */, MakeTransactionRef());\n-            ssValue >> wtx;\n-            if (wtx.GetHash() != hash)\n-                return false;\n+            auto update_wtx = [&](CWalletTx& wtx, bool /* new_tx */) {\n+                ssValue >> wtx;\n+                if (wtx.GetHash() != hash)\n+                    return false;\n \n-            // Undo serialize changes in 31600\n-            if (31404 <= wtx.fTimeReceivedIsTxTime && wtx.fTimeReceivedIsTxTime <= 31703)\n-            {\n-                if (!ssValue.empty())\n+                // Undo serialize changes in 31600\n+                if (31404 <= wtx.fTimeReceivedIsTxTime && wtx.fTimeReceivedIsTxTime <= 31703)\n                 {\n-                    char fTmp;\n-                    char fUnused;\n-                    std::string unused_string;\n-                    ssValue >> fTmp >> fUnused >> unused_string;\n-                    strErr = strprintf(\"LoadWallet() upgrading tx ver=%d %d %s\",\n-                                       wtx.fTimeReceivedIsTxTime, fTmp, hash.ToString());\n-                    wtx.fTimeReceivedIsTxTime = fTmp;\n+                    if (!ssValue.empty())\n+                    {\n+                        char fTmp;\n+                        char fUnused;\n+                        std::string unused_string;\n+                        ssValue >> fTmp >> fUnused >> unused_string;\n+                        strErr = strprintf(\"LoadWallet() upgrading tx ver=%d %d %s\",\n+                                           wtx.fTimeReceivedIsTxTime, fTmp, hash.ToString());\n+                        wtx.fTimeReceivedIsTxTime = fTmp;\n+                    }\n+                    else\n+                    {\n+                        strErr = strprintf(\"LoadWallet() repairing tx ver=%d %s\", wtx.fTimeReceivedIsTxTime, hash.ToString());\n+                        wtx.fTimeReceivedIsTxTime = 0;\n+                    }\n+                    wss.vWalletUpgrade.push_back(hash);\n                 }\n-                else\n-                {\n-                    strErr = strprintf(\"LoadWallet() repairing tx ver=%d %s\", wtx.fTimeReceivedIsTxTime, hash.ToString());\n-                    wtx.fTimeReceivedIsTxTime = 0;\n-                }\n-                wss.vWalletUpgrade.push_back(hash);\n-            }\n \n-            if (wtx.nOrderPos == -1)\n-                wss.fAnyUnordered = true;\n+                if (wtx.nOrderPos == -1)\n+                    wss.fAnyUnordered = true;\n \n-            pwallet->LoadToWallet(wtx);\n+                return true;\n+            };\n+            if (!pwallet->LoadToWallet(hash, update_wtx)) {\n+                return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r384536761",
      "id" : 384536761,
      "in_reply_to_id" : 384419297,
      "line" : 310,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDUzNjc2MQ==",
      "original_commit_id" : "754eb2112aac4729805dcc547bef1de956c3c14d",
      "original_line" : 310,
      "original_position" : 61,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : 64,
      "pull_request_review_id" : 364955330,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384536761",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-03-23T22:04:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-602880942",
      "id" : 602880942,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwMjg4MDk0Mg==",
      "updated_at" : "2020-03-23T22:04:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/602880942",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased fc4df9dc2910c4a57d5e81573faf7952e1c3ee42 -> f1fc7892608fb258da86017c79ffb4b1a477014a ([`pr/atw-nomerge.76`](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.76) -> [`pr/atw-nomerge.77`](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.77), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/atw-nomerge.76-rebase..pr/atw-nomerge.77)) due to conflict with #18278",
      "created_at" : "2020-03-24T20:34:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-603490263",
      "id" : 603490263,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwMzQ5MDI2Mw==",
      "updated_at" : "2020-03-24T20:34:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/603490263",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK f1fc7892608fb258da86017c79ffb4b1a477014a",
      "created_at" : "2020-03-31T15:16:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-606691829",
      "id" : 606691829,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwNjY5MTgyOQ==",
      "updated_at" : "2020-03-31T15:16:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/606691829",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-04-14T12:12:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-613406514",
      "id" : 613406514,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxMzQwNjUxNA==",
      "updated_at" : "2020-04-14T12:12:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/613406514",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased f1fc7892608fb258da86017c79ffb4b1a477014a -> ece5d1cf46cf8c335dee4bb6affe514d7b33f306 ([`pr/atw-nomerge.77`](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.77) -> [`pr/atw-nomerge.78`](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.78), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/atw-nomerge.77-rebase..pr/atw-nomerge.78)) due to conflict with #17954",
      "created_at" : "2020-04-15T21:41:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-614294739",
      "id" : 614294739,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxNDI5NDczOQ==",
      "updated_at" : "2020-04-15T21:41:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/614294739",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-utACK ece5d1c (rebased)",
      "created_at" : "2020-04-19T14:17:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-616145342",
      "id" : 616145342,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxNjE0NTM0Mg==",
      "updated_at" : "2020-04-19T14:17:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/616145342",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-05-01T11:09:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-622347300",
      "id" : 622347300,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMjM0NzMwMA==",
      "updated_at" : "2020-05-01T11:09:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/622347300",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased ece5d1cf46cf8c335dee4bb6affe514d7b33f306 -> f2892d8eb5404a34f3b09d3b9ac65d58c965e362 ([`pr/atw-nomerge.78`](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.78) -> [`pr/atw-nomerge.79`](https://github.com/ryanofsky/bitcoin/commits/pr/atw-nomerge.79), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/atw-nomerge.78-rebase..pr/atw-nomerge.79)) due to conflict with #16426\r\n",
      "created_at" : "2020-05-01T15:00:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-622422795",
      "id" : 622422795,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMjQyMjc5NQ==",
      "updated_at" : "2020-05-01T15:00:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/622422795",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Light re-utACK f2892d8eb5404a34f3b09d3b9ac65d58c965e362, looks like a reasonably straight-forward rebase.",
      "created_at" : "2020-05-04T10:21:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-623381605",
      "id" : 623381605,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMzM4MTYwNQ==",
      "updated_at" : "2020-05-04T10:21:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/623381605",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r420187394"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/420187394"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Does the `std::move` still work after going through a lambda capture by reference?",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2020-05-05T15:12:48Z",
      "diff_hunk" : "@@ -3007,37 +2999,34 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CTransac\n void CWallet::CommitTransaction(CTransactionRef tx, mapValue_t mapValue, std::vector<std::pair<std::string, std::string>> orderForm)\n {\n     LOCK(cs_wallet);\n-\n-    CWalletTx wtxNew(this, std::move(tx));\n-    wtxNew.mapValue = std::move(mapValue);\n-    wtxNew.vOrderForm = std::move(orderForm);\n-    wtxNew.fTimeReceivedIsTxTime = true;\n-    wtxNew.fFromMe = true;\n-\n-    WalletLogPrintf(\"CommitTransaction:\\n%s\", wtxNew.tx->ToString()); /* Continued */\n+    WalletLogPrintf(\"CommitTransaction:\\n%s\", tx->ToString()); /* Continued */\n \n     // Add tx to wallet, because if it has change it's also ours,\n     // otherwise just for transaction history.\n-    AddToWallet(wtxNew);\n+    CWalletTx* wtx = AddToWallet(std::move(tx), {}, [&](CWalletTx& wtx, bool new_tx) {\n+        CHECK_NONFATAL(wtx.mapValue.empty());\n+        CHECK_NONFATAL(wtx.vOrderForm.empty());\n+        wtx.mapValue = std::move(mapValue);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r420187394",
      "id" : 420187394,
      "line" : 3010,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE4NzM5NA==",
      "original_commit_id" : "677e1e0e0e1c7d767f56fc61199b906f7442ac6f",
      "original_line" : 3010,
      "original_position" : 147,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 196,
      "pull_request_review_id" : 405887564,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/420187394",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r420187836"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/420187836"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Doesn't this line crash the node when the wallet can not write the tx to disk?",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2020-05-05T15:13:25Z",
      "diff_hunk" : "@@ -3007,37 +2999,34 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CTransac\n void CWallet::CommitTransaction(CTransactionRef tx, mapValue_t mapValue, std::vector<std::pair<std::string, std::string>> orderForm)\n {\n     LOCK(cs_wallet);\n-\n-    CWalletTx wtxNew(this, std::move(tx));\n-    wtxNew.mapValue = std::move(mapValue);\n-    wtxNew.vOrderForm = std::move(orderForm);\n-    wtxNew.fTimeReceivedIsTxTime = true;\n-    wtxNew.fFromMe = true;\n-\n-    WalletLogPrintf(\"CommitTransaction:\\n%s\", wtxNew.tx->ToString()); /* Continued */\n+    WalletLogPrintf(\"CommitTransaction:\\n%s\", tx->ToString()); /* Continued */\n \n     // Add tx to wallet, because if it has change it's also ours,\n     // otherwise just for transaction history.\n-    AddToWallet(wtxNew);\n+    CWalletTx* wtx = AddToWallet(std::move(tx), {}, [&](CWalletTx& wtx, bool new_tx) {\n+        CHECK_NONFATAL(wtx.mapValue.empty());\n+        CHECK_NONFATAL(wtx.vOrderForm.empty());\n+        wtx.mapValue = std::move(mapValue);\n+        wtx.vOrderForm = std::move(orderForm);\n+        wtx.fTimeReceivedIsTxTime = true;\n+        wtx.fFromMe = true;\n+        return true;\n+    });\n \n     // Notify that old coins are spent\n-    for (const CTxIn& txin : wtxNew.tx->vin) {\n+    for (const CTxIn& txin : wtx->tx->vin) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r420187836",
      "id" : 420187836,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE4NzgzNg==",
      "original_commit_id" : "677e1e0e0e1c7d767f56fc61199b906f7442ac6f",
      "original_line" : 3017,
      "original_position" : 156,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 405887564,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/420187836",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r420238473"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/420238473"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes. mapValue is a reference to the same thing it was outside of the lambda. std::move casts it to an rvalue reference.",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2020-05-05T16:22:51Z",
      "diff_hunk" : "@@ -3007,37 +2999,34 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CTransac\n void CWallet::CommitTransaction(CTransactionRef tx, mapValue_t mapValue, std::vector<std::pair<std::string, std::string>> orderForm)\n {\n     LOCK(cs_wallet);\n-\n-    CWalletTx wtxNew(this, std::move(tx));\n-    wtxNew.mapValue = std::move(mapValue);\n-    wtxNew.vOrderForm = std::move(orderForm);\n-    wtxNew.fTimeReceivedIsTxTime = true;\n-    wtxNew.fFromMe = true;\n-\n-    WalletLogPrintf(\"CommitTransaction:\\n%s\", wtxNew.tx->ToString()); /* Continued */\n+    WalletLogPrintf(\"CommitTransaction:\\n%s\", tx->ToString()); /* Continued */\n \n     // Add tx to wallet, because if it has change it's also ours,\n     // otherwise just for transaction history.\n-    AddToWallet(wtxNew);\n+    CWalletTx* wtx = AddToWallet(std::move(tx), {}, [&](CWalletTx& wtx, bool new_tx) {\n+        CHECK_NONFATAL(wtx.mapValue.empty());\n+        CHECK_NONFATAL(wtx.vOrderForm.empty());\n+        wtx.mapValue = std::move(mapValue);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r420238473",
      "id" : 420238473,
      "in_reply_to_id" : 420187394,
      "line" : 3010,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIzODQ3Mw==",
      "original_commit_id" : "677e1e0e0e1c7d767f56fc61199b906f7442ac6f",
      "original_line" : 3010,
      "original_position" : 147,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 196,
      "pull_request_review_id" : 405951099,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/420238473",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r420243391"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/420243391"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/9381#discussion_r420187836\r\n\r\n> Doesn't this line crash the node when the wallet can not write the tx to disk?\r\n\r\nWow, good catch! I'm not sure current behavior is ideal either but it wasn't my intention to change it. Updated PR",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2020-05-05T16:30:13Z",
      "diff_hunk" : "@@ -3007,37 +2999,34 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CTransac\n void CWallet::CommitTransaction(CTransactionRef tx, mapValue_t mapValue, std::vector<std::pair<std::string, std::string>> orderForm)\n {\n     LOCK(cs_wallet);\n-\n-    CWalletTx wtxNew(this, std::move(tx));\n-    wtxNew.mapValue = std::move(mapValue);\n-    wtxNew.vOrderForm = std::move(orderForm);\n-    wtxNew.fTimeReceivedIsTxTime = true;\n-    wtxNew.fFromMe = true;\n-\n-    WalletLogPrintf(\"CommitTransaction:\\n%s\", wtxNew.tx->ToString()); /* Continued */\n+    WalletLogPrintf(\"CommitTransaction:\\n%s\", tx->ToString()); /* Continued */\n \n     // Add tx to wallet, because if it has change it's also ours,\n     // otherwise just for transaction history.\n-    AddToWallet(wtxNew);\n+    CWalletTx* wtx = AddToWallet(std::move(tx), {}, [&](CWalletTx& wtx, bool new_tx) {\n+        CHECK_NONFATAL(wtx.mapValue.empty());\n+        CHECK_NONFATAL(wtx.vOrderForm.empty());\n+        wtx.mapValue = std::move(mapValue);\n+        wtx.vOrderForm = std::move(orderForm);\n+        wtx.fTimeReceivedIsTxTime = true;\n+        wtx.fFromMe = true;\n+        return true;\n+    });\n \n     // Notify that old coins are spent\n-    for (const CTxIn& txin : wtxNew.tx->vin) {\n+    for (const CTxIn& txin : wtx->tx->vin) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r420243391",
      "id" : 420243391,
      "in_reply_to_id" : 420187836,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI0MzM5MQ==",
      "original_commit_id" : "677e1e0e0e1c7d767f56fc61199b906f7442ac6f",
      "original_line" : 3017,
      "original_position" : 156,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 405948073,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:51:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/420243391",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r420245998"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/420245998"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oh, this has nothing to do with lambdas. I didn't know that references (as long as they are not const) can be moved.",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2020-05-05T16:33:50Z",
      "diff_hunk" : "@@ -3007,37 +2999,34 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CTransac\n void CWallet::CommitTransaction(CTransactionRef tx, mapValue_t mapValue, std::vector<std::pair<std::string, std::string>> orderForm)\n {\n     LOCK(cs_wallet);\n-\n-    CWalletTx wtxNew(this, std::move(tx));\n-    wtxNew.mapValue = std::move(mapValue);\n-    wtxNew.vOrderForm = std::move(orderForm);\n-    wtxNew.fTimeReceivedIsTxTime = true;\n-    wtxNew.fFromMe = true;\n-\n-    WalletLogPrintf(\"CommitTransaction:\\n%s\", wtxNew.tx->ToString()); /* Continued */\n+    WalletLogPrintf(\"CommitTransaction:\\n%s\", tx->ToString()); /* Continued */\n \n     // Add tx to wallet, because if it has change it's also ours,\n     // otherwise just for transaction history.\n-    AddToWallet(wtxNew);\n+    CWalletTx* wtx = AddToWallet(std::move(tx), {}, [&](CWalletTx& wtx, bool new_tx) {\n+        CHECK_NONFATAL(wtx.mapValue.empty());\n+        CHECK_NONFATAL(wtx.vOrderForm.empty());\n+        wtx.mapValue = std::move(mapValue);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r420245998",
      "id" : 420245998,
      "in_reply_to_id" : 420187394,
      "line" : 3010,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI0NTk5OA==",
      "original_commit_id" : "677e1e0e0e1c7d767f56fc61199b906f7442ac6f",
      "original_line" : 3010,
      "original_position" : 147,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 196,
      "pull_request_review_id" : 405960320,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/420245998",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r420249813"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/420249813"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/9381#discussion_r420187394\r\n\r\n> Oh, this has nothing to do with lambdas. I didn't know that references (as long as they are not const) can be moved.\r\n\r\nYep, `std::move` isn't affected by outside things like this. `std::move(mapValue)` is only a type cast from `mapValue_t&` to `mapValue_t&&` that makes the compiler favor the `operator=(mapValue_t&&)` assignment overload instead of the `operator=(const mapValue_t&)` one for `wtx.mapValue =`",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2020-05-05T16:39:28Z",
      "diff_hunk" : "@@ -3007,37 +2999,34 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CTransac\n void CWallet::CommitTransaction(CTransactionRef tx, mapValue_t mapValue, std::vector<std::pair<std::string, std::string>> orderForm)\n {\n     LOCK(cs_wallet);\n-\n-    CWalletTx wtxNew(this, std::move(tx));\n-    wtxNew.mapValue = std::move(mapValue);\n-    wtxNew.vOrderForm = std::move(orderForm);\n-    wtxNew.fTimeReceivedIsTxTime = true;\n-    wtxNew.fFromMe = true;\n-\n-    WalletLogPrintf(\"CommitTransaction:\\n%s\", wtxNew.tx->ToString()); /* Continued */\n+    WalletLogPrintf(\"CommitTransaction:\\n%s\", tx->ToString()); /* Continued */\n \n     // Add tx to wallet, because if it has change it's also ours,\n     // otherwise just for transaction history.\n-    AddToWallet(wtxNew);\n+    CWalletTx* wtx = AddToWallet(std::move(tx), {}, [&](CWalletTx& wtx, bool new_tx) {\n+        CHECK_NONFATAL(wtx.mapValue.empty());\n+        CHECK_NONFATAL(wtx.vOrderForm.empty());\n+        wtx.mapValue = std::move(mapValue);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r420249813",
      "id" : 420249813,
      "in_reply_to_id" : 420187394,
      "line" : 3010,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI0OTgxMw==",
      "original_commit_id" : "677e1e0e0e1c7d767f56fc61199b906f7442ac6f",
      "original_line" : 3010,
      "original_position" : 147,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 196,
      "pull_request_review_id" : 405948073,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:51:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/420249813",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r420251260"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/420251260"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Even const ones, actually - though unless they have mutable fields, there is no effect.",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2020-05-05T16:41:39Z",
      "diff_hunk" : "@@ -3007,37 +2999,34 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CTransac\n void CWallet::CommitTransaction(CTransactionRef tx, mapValue_t mapValue, std::vector<std::pair<std::string, std::string>> orderForm)\n {\n     LOCK(cs_wallet);\n-\n-    CWalletTx wtxNew(this, std::move(tx));\n-    wtxNew.mapValue = std::move(mapValue);\n-    wtxNew.vOrderForm = std::move(orderForm);\n-    wtxNew.fTimeReceivedIsTxTime = true;\n-    wtxNew.fFromMe = true;\n-\n-    WalletLogPrintf(\"CommitTransaction:\\n%s\", wtxNew.tx->ToString()); /* Continued */\n+    WalletLogPrintf(\"CommitTransaction:\\n%s\", tx->ToString()); /* Continued */\n \n     // Add tx to wallet, because if it has change it's also ours,\n     // otherwise just for transaction history.\n-    AddToWallet(wtxNew);\n+    CWalletTx* wtx = AddToWallet(std::move(tx), {}, [&](CWalletTx& wtx, bool new_tx) {\n+        CHECK_NONFATAL(wtx.mapValue.empty());\n+        CHECK_NONFATAL(wtx.vOrderForm.empty());\n+        wtx.mapValue = std::move(mapValue);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r420251260",
      "id" : 420251260,
      "in_reply_to_id" : 420187394,
      "line" : 3010,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI1MTI2MA==",
      "original_commit_id" : "677e1e0e0e1c7d767f56fc61199b906f7442ac6f",
      "original_line" : 3010,
      "original_position" : 147,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 196,
      "pull_request_review_id" : 405966737,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T16:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/420251260",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Ah sorry, no need to revert your changes. If the wallet can't write to disk, a simple `CHECK_NONFATAL(wtx)` should be sufficient",
      "created_at" : "2020-05-05T17:29:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-624197882",
      "id" : 624197882,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyNDE5Nzg4Mg==",
      "updated_at" : "2020-05-05T17:29:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/624197882",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r420286577"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/420286577"
         }
      },
      "author_association" : "MEMBER",
      "body" : "With \"no effect\" you mean `const&` will stay `const&`, right? See also the example, which does not compile, because the `const&` copy constructor is deleted:\r\n\r\n```cpp\r\n#include <memory>\r\n\r\nstruct Test{\r\n    const std::unique_ptr<int>b;\r\n    Test(const std::unique_ptr<int>& a):b{std::move(a)}{}\r\n};",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2020-05-05T17:34:27Z",
      "diff_hunk" : "@@ -3007,37 +2999,34 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CTransac\n void CWallet::CommitTransaction(CTransactionRef tx, mapValue_t mapValue, std::vector<std::pair<std::string, std::string>> orderForm)\n {\n     LOCK(cs_wallet);\n-\n-    CWalletTx wtxNew(this, std::move(tx));\n-    wtxNew.mapValue = std::move(mapValue);\n-    wtxNew.vOrderForm = std::move(orderForm);\n-    wtxNew.fTimeReceivedIsTxTime = true;\n-    wtxNew.fFromMe = true;\n-\n-    WalletLogPrintf(\"CommitTransaction:\\n%s\", wtxNew.tx->ToString()); /* Continued */\n+    WalletLogPrintf(\"CommitTransaction:\\n%s\", tx->ToString()); /* Continued */\n \n     // Add tx to wallet, because if it has change it's also ours,\n     // otherwise just for transaction history.\n-    AddToWallet(wtxNew);\n+    CWalletTx* wtx = AddToWallet(std::move(tx), {}, [&](CWalletTx& wtx, bool new_tx) {\n+        CHECK_NONFATAL(wtx.mapValue.empty());\n+        CHECK_NONFATAL(wtx.vOrderForm.empty());\n+        wtx.mapValue = std::move(mapValue);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r420286577",
      "id" : 420286577,
      "in_reply_to_id" : 420187394,
      "line" : 3010,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI4NjU3Nw==",
      "original_commit_id" : "677e1e0e0e1c7d767f56fc61199b906f7442ac6f",
      "original_line" : 3010,
      "original_position" : 147,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 196,
      "pull_request_review_id" : 406008742,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T17:34:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/420286577",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r420288613"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/420288613"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`std::move(a)` where a is `const T&`, returns something of type `const T&&`. If T has for example a `operator=(const T&&)`, then that one would be selected in assignment. If there is no such operator, `operator=(const T&)` will be selected instead. In general a `const T&&` assignment/constructor operator only makes sense if a class has mutable fields.",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2020-05-05T17:37:56Z",
      "diff_hunk" : "@@ -3007,37 +2999,34 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CTransac\n void CWallet::CommitTransaction(CTransactionRef tx, mapValue_t mapValue, std::vector<std::pair<std::string, std::string>> orderForm)\n {\n     LOCK(cs_wallet);\n-\n-    CWalletTx wtxNew(this, std::move(tx));\n-    wtxNew.mapValue = std::move(mapValue);\n-    wtxNew.vOrderForm = std::move(orderForm);\n-    wtxNew.fTimeReceivedIsTxTime = true;\n-    wtxNew.fFromMe = true;\n-\n-    WalletLogPrintf(\"CommitTransaction:\\n%s\", wtxNew.tx->ToString()); /* Continued */\n+    WalletLogPrintf(\"CommitTransaction:\\n%s\", tx->ToString()); /* Continued */\n \n     // Add tx to wallet, because if it has change it's also ours,\n     // otherwise just for transaction history.\n-    AddToWallet(wtxNew);\n+    CWalletTx* wtx = AddToWallet(std::move(tx), {}, [&](CWalletTx& wtx, bool new_tx) {\n+        CHECK_NONFATAL(wtx.mapValue.empty());\n+        CHECK_NONFATAL(wtx.vOrderForm.empty());\n+        wtx.mapValue = std::move(mapValue);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r420288613",
      "id" : 420288613,
      "in_reply_to_id" : 420187394,
      "line" : 3010,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI4ODYxMw==",
      "original_commit_id" : "677e1e0e0e1c7d767f56fc61199b906f7442ac6f",
      "original_line" : 3010,
      "original_position" : 147,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 196,
      "pull_request_review_id" : 406011317,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T17:38:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/420288613",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r420291853"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/420291853"
         }
      },
      "author_association" : "MEMBER",
      "body" : "TIL that `const T&&` exists.",
      "commit_id" : "28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2020-05-05T17:43:18Z",
      "diff_hunk" : "@@ -3007,37 +2999,34 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CTransac\n void CWallet::CommitTransaction(CTransactionRef tx, mapValue_t mapValue, std::vector<std::pair<std::string, std::string>> orderForm)\n {\n     LOCK(cs_wallet);\n-\n-    CWalletTx wtxNew(this, std::move(tx));\n-    wtxNew.mapValue = std::move(mapValue);\n-    wtxNew.vOrderForm = std::move(orderForm);\n-    wtxNew.fTimeReceivedIsTxTime = true;\n-    wtxNew.fFromMe = true;\n-\n-    WalletLogPrintf(\"CommitTransaction:\\n%s\", wtxNew.tx->ToString()); /* Continued */\n+    WalletLogPrintf(\"CommitTransaction:\\n%s\", tx->ToString()); /* Continued */\n \n     // Add tx to wallet, because if it has change it's also ours,\n     // otherwise just for transaction history.\n-    AddToWallet(wtxNew);\n+    CWalletTx* wtx = AddToWallet(std::move(tx), {}, [&](CWalletTx& wtx, bool new_tx) {\n+        CHECK_NONFATAL(wtx.mapValue.empty());\n+        CHECK_NONFATAL(wtx.vOrderForm.empty());\n+        wtx.mapValue = std::move(mapValue);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#discussion_r420291853",
      "id" : 420291853,
      "in_reply_to_id" : 420187394,
      "line" : 3010,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI5MTg1Mw==",
      "original_commit_id" : "677e1e0e0e1c7d767f56fc61199b906f7442ac6f",
      "original_line" : 3010,
      "original_position" : 147,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 196,
      "pull_request_review_id" : 406015325,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9381",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T17:43:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/420291853",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Ah sorry, no need to revert your changes. If the wallet can't write to disk, a simple `CHECK_NONFATAL(wtx)` should be sufficient\r\n\r\nI don't think CHECK_NONFATAL would be right, because this is checking a runtime error, not an internal assertion about how code works. I can go back to the earlier version and add this if that's your preference. But actually I like the update better because it makes the overall diff smaller and avoids changing behavior in a refactoring PR. I think ideally if different error handling is needed here, it would be handled in a standalone PR with a unit test.",
      "created_at" : "2020-05-05T17:54:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-624210794",
      "id" : 624210794,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyNDIxMDc5NA==",
      "updated_at" : "2020-05-05T17:54:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/624210794",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Well, our assumption in the code is that the wallet can write to disk. If that assumption is violated it seems fine to assert or do that `CHECK` thingy. But I also see your point to make it a separate runtime error.\r\n\r\nAnyway, re-ACK 28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2020-05-05T17:58:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-624212989",
      "id" : 624212989,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyNDIxMjk4OQ==",
      "updated_at" : "2020-05-05T17:58:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/624212989",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-utACK 28b112e9bd3fd1181c0720306051ba7efca8b436",
      "created_at" : "2020-05-05T23:37:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9381#issuecomment-624361292",
      "id" : 624361292,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyNDM2MTI5Mg==",
      "updated_at" : "2020-05-05T23:37:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/624361292",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/meshcollider/followers",
         "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/meshcollider",
         "id" : 3211283,
         "login" : "meshcollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
         "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
         "repos_url" : "https://api.github.com/users/meshcollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/meshcollider"
      }
   }
]
