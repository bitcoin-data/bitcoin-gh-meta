[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9384#discussion_r95610292"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9384"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/95610292"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Explanation of this change: Calling CCoinsViewCache::AccessCoins when no cache entry exists and the base entry is pruned no longer creates a cache entry.\r\n\r\nThe changed behavior in this case is better than the current behavior because now this case is consistent with the case in line 606 above where no cache entry exists and no base entry exists. It doesn't make any sense for the cache to behave differently just because a base entry is pruned instead of nonexistent.",
      "commit_id" : "ed037857dad102f0829ab16cce0bb9acf11892ff",
      "created_at" : "2017-01-11T16:07:07Z",
      "diff_hunk" : "@@ -612,7 +612,7 @@ BOOST_AUTO_TEST_CASE(ccoins_access)\n     CheckAccessCoins(ABSENT, VALUE2, VALUE2, FRESH      , FRESH      );\n     CheckAccessCoins(ABSENT, VALUE2, VALUE2, DIRTY      , DIRTY      );\n     CheckAccessCoins(ABSENT, VALUE2, VALUE2, DIRTY|FRESH, DIRTY|FRESH);\n-    CheckAccessCoins(PRUNED, ABSENT, PRUNED, NO_ENTRY   , FRESH      );\n+    CheckAccessCoins(PRUNED, ABSENT, ABSENT, NO_ENTRY   , NO_ENTRY   );",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9384#discussion_r95610292",
      "id" : 95610292,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDk1NjEwMjky",
      "original_commit_id" : "c72de76bf803254454a5dc4618bde85d1d992b7d",
      "original_line" : null,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/coins_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 16171111,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9384",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/95610292/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2021-03-29T14:10:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/95610292",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9384#discussion_r95611169"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9384"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/95611169"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Explanation of this change: Overwriting a non-dirty pruned cache entry with a fresh pruned cache entry now deletes the cache entry instead of leaving behind a dirty pruned entry that will trigger an unnecessary database write later.\r\n",
      "commit_id" : "ed037857dad102f0829ab16cce0bb9acf11892ff",
      "created_at" : "2017-01-11T16:10:36Z",
      "diff_hunk" : "@@ -826,15 +826,15 @@ BOOST_AUTO_TEST_CASE(ccoins_write)\n     CheckWriteCoins(PRUNED, ABSENT, PRUNED, DIRTY      , NO_ENTRY   , DIRTY      );\n     CheckWriteCoins(PRUNED, ABSENT, PRUNED, DIRTY|FRESH, NO_ENTRY   , DIRTY|FRESH);\n     CheckWriteCoins(PRUNED, PRUNED, PRUNED, 0          , DIRTY      , DIRTY      );\n-    CheckWriteCoins(PRUNED, PRUNED, PRUNED, 0          , DIRTY|FRESH, DIRTY      );\n+    CheckWriteCoins(PRUNED, PRUNED, ABSENT, 0          , DIRTY|FRESH, NO_ENTRY   );",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9384#discussion_r95611169",
      "id" : 95611169,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDk1NjExMTY5",
      "original_commit_id" : "c72de76bf803254454a5dc4618bde85d1d992b7d",
      "original_line" : null,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/test/coins_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 16171111,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9384",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/95611169/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2021-03-29T14:10:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/95611169",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9384#discussion_r95611376"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9384"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/95611376"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Explanation of this change: Overwriting a dirty pruned fresh cache entry with a nonpruned entry updates the entry without dropping the fresh flag. There's no reason to drop the fresh flag in this case because the flag accurately describes the state of the base view and could prevent unnecessary database writes in the future if the utxo is spent later.\r\n",
      "commit_id" : "ed037857dad102f0829ab16cce0bb9acf11892ff",
      "created_at" : "2017-01-11T16:11:37Z",
      "diff_hunk" : "@@ -826,15 +826,15 @@ BOOST_AUTO_TEST_CASE(ccoins_write)\n     CheckWriteCoins(PRUNED, ABSENT, PRUNED, DIRTY      , NO_ENTRY   , DIRTY      );\n     CheckWriteCoins(PRUNED, ABSENT, PRUNED, DIRTY|FRESH, NO_ENTRY   , DIRTY|FRESH);\n     CheckWriteCoins(PRUNED, PRUNED, PRUNED, 0          , DIRTY      , DIRTY      );\n-    CheckWriteCoins(PRUNED, PRUNED, PRUNED, 0          , DIRTY|FRESH, DIRTY      );\n+    CheckWriteCoins(PRUNED, PRUNED, ABSENT, 0          , DIRTY|FRESH, NO_ENTRY   );\n     CheckWriteCoins(PRUNED, PRUNED, ABSENT, FRESH      , DIRTY      , NO_ENTRY   );\n     CheckWriteCoins(PRUNED, PRUNED, ABSENT, FRESH      , DIRTY|FRESH, NO_ENTRY   );\n     CheckWriteCoins(PRUNED, PRUNED, PRUNED, DIRTY      , DIRTY      , DIRTY      );\n     CheckWriteCoins(PRUNED, PRUNED, PRUNED, DIRTY      , DIRTY|FRESH, DIRTY      );\n     CheckWriteCoins(PRUNED, PRUNED, ABSENT, DIRTY|FRESH, DIRTY      , NO_ENTRY   );\n     CheckWriteCoins(PRUNED, PRUNED, ABSENT, DIRTY|FRESH, DIRTY|FRESH, NO_ENTRY   );\n     CheckWriteCoins(PRUNED, VALUE2, VALUE2, 0          , DIRTY      , DIRTY      );\n-    CheckWriteCoins(PRUNED, VALUE2, VALUE2, 0          , DIRTY|FRESH, DIRTY      );\n+    CheckWriteCoins(PRUNED, VALUE2, VALUE2, 0          , DIRTY|FRESH, DIRTY|FRESH);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9384#discussion_r95611376",
      "id" : 95611376,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDk1NjExMzc2",
      "original_commit_id" : "c72de76bf803254454a5dc4618bde85d1d992b7d",
      "original_line" : null,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/test/coins_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 16171111,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9384",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/95611376/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2021-03-29T14:10:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/95611376",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sipa, this is the PR I mentioned other day. It does move code to the modifier object, but the code could be moved if the modifier object is going away.",
      "created_at" : "2017-01-11T16:26:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9384#issuecomment-271916098",
      "id" : 271916098,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9384",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDI3MTkxNjA5OA==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/271916098/reactions"
      },
      "updated_at" : "2017-01-11T16:26:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/271916098",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sipa, I posted a version of your [pertxoutcache](https://github.com/sipa/bitcoin/commits/pertxoutcache) branch rebased on top of this PR here: \r\nhttps://github.com/ryanofsky/bitcoin/commits/pr/pertxoutcache\r\n\r\nIt might be useful to you even if you aren't interested in this PR because it also updates coins_tests to be compatible with your change.\r\n\r\nRelevant commits:\r\n\r\n- 6b547c287e63a48d24547f48ac8108d83dcc7266 `WIP per-txout chainstate` â rebased version of your main commit on top of this PR.\r\n- 5853aed217e4fd7f4a02790491ef1ea01821a2d5 `Re-enable and fix coins_test.cpp` â coins_test fixes that you can incorporate (regardless of the code refactoring in this PR)\r\n- 1b8425fce6498be757e663d202be025730f86725 `Fix wallet CCoinsViewCache::GetCoins call` â fix for compile error in wallet caused by ccoins changes\r\n ",
      "created_at" : "2017-03-01T22:30:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9384#issuecomment-283492374",
      "id" : 283492374,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9384",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDI4MzQ5MjM3NA==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/283492374/reactions"
      },
      "updated_at" : "2017-03-01T22:30:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/283492374",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased c72de76bf803254454a5dc4618bde85d1d992b7d -> 2f2d3c856520da6fcdcb82b2330515136be3f028 ([pr/ccoins-cleanup.6](https://github.com/ryanofsky/bitcoin/commits/pr/ccoins-cleanup.6) -> [pr/ccoins-cleanup.7](https://github.com/ryanofsky/bitcoin/commits/pr/ccoins-cleanup.7)) after #10195 merge.",
      "created_at" : "2017-06-02T20:03:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9384#issuecomment-305895810",
      "id" : 305895810,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9384",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDMwNTg5NTgxMA==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/305895810/reactions"
      },
      "updated_at" : "2017-06-02T20:03:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/305895810",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2018-03-06T17:15:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9384#issuecomment-370856624",
      "id" : 370856624,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9384",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM3MDg1NjYyNA==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370856624/reactions"
      },
      "updated_at" : "2018-03-06T17:15:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370856624",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9384#discussion_r219851897"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9384"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219851897"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this change (after #10537) would have prevented the inflation bug caused by #9049 + #10195, discussed in\r\nthe [CVE-2018-17144](https://bitcoincore.org/en/2018/09/20/notice/) full disclosure.",
      "commit_id" : "ed037857dad102f0829ab16cce0bb9acf11892ff",
      "created_at" : "2018-09-24T14:15:20Z",
      "diff_hunk" : "@@ -96,19 +93,14 @@ void AddCoins(CCoinsViewCache& cache, const CTransaction &tx, int nHeight, bool\n }\n \n bool CCoinsViewCache::SpendCoin(const COutPoint &outpoint, Coin* moveout) {\n-    CCoinsMap::iterator it = FetchCoin(outpoint);\n-    if (it == cacheCoins.end()) return false;\n-    cachedCoinsUsage -= it->second.coin.DynamicMemoryUsage();\n+    Modifier modifier(*this, outpoint);\n+    Coin& coin = modifier.Modify();\n+    bool already_spent = coin.IsSpent();\n     if (moveout) {\n-        *moveout = std::move(it->second.coin);\n-    }\n-    if (it->second.flags & CCoinsCacheEntry::FRESH) {\n-        cacheCoins.erase(it);\n-    } else {\n-        it->second.flags |= CCoinsCacheEntry::DIRTY;\n-        it->second.coin.Clear();\n+        *moveout = std::move(coin);\n     }\n-    return true;\n+    coin.Clear();\n+    return !already_spent;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9384#discussion_r219851897",
      "id" : 219851897,
      "line" : 124,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTg1MTg5Nw==",
      "original_commit_id" : "2279ff50b74a4fd11379f4b22a41ace453df07d7",
      "original_line" : 124,
      "original_position" : 101,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 135,
      "pull_request_review_id" : 158123897,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9384",
      "reactions" : {
         "+1" : 5,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 5,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219851897/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2021-03-29T14:10:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219851897",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [sipa](https://github.com/bitcoin/bitcoin/pull/9384#issuecomment-370856624), [jonatack](https://github.com/bitcoin/bitcoin/pull/9384#issuecomment-1409010161) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#26593](https://github.com/bitcoin/bitcoin/pull/26593) (tracing: Only prepare tracepoint arguments when actually tracing by 0xB10C)\n* [#26331](https://github.com/bitcoin/bitcoin/pull/26331) (Implement `CCoinsViewErrorCatcher::HaveCoin` and check disk space periodically by aureleoules)\n* [#17487](https://github.com/bitcoin/bitcoin/pull/17487) (coins: allow write to disk without cache drop by jamesob)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2019-03-15T18:10:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9384#issuecomment-473390121",
      "id" : 473390121,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9384",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3MzM5MDEyMQ==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/473390121/reactions"
      },
      "updated_at" : "2023-01-30T17:16:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/473390121",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "<!--5d09a71f8925f3f132321140b44b946d-->The last travis run for this pull request was 281 days ago and is thus outdated. To trigger a fresh travis build, this pull request should be closed and re-opened.",
      "created_at" : "2019-04-28T19:12:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9384#issuecomment-487407255",
      "id" : 487407255,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9384",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4NzQwNzI1NQ==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/487407255/reactions"
      },
      "updated_at" : "2019-04-28T19:12:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/487407255",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased 8c743919935f628e27fd24e8809c9cee273f3930 -> b837952bfac658aa868b9299f7cf6f8ffe248620 ([`pr/ccoins-cleanup.13`](https://github.com/ryanofsky/bitcoin/commits/pr/ccoins-cleanup.13) -> [`pr/ccoins-cleanup.14`](https://github.com/ryanofsky/bitcoin/commits/pr/ccoins-cleanup.14), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/ccoins-cleanup.13-rebase..pr/ccoins-cleanup.14)) after #18752 to avoid mempool_reorg sync timeout https://travis-ci.org/github/bitcoin/bitcoin/jobs/678462266#L681\r\nRebased b837952bfac658aa868b9299f7cf6f8ffe248620 -> 0c33bd2efa48d276e3475d458f12cba863c83448 ([`pr/ccoins-cleanup.14`](https://github.com/ryanofsky/bitcoin/commits/pr/ccoins-cleanup.14) -> [`pr/ccoins-cleanup.15`](https://github.com/ryanofsky/bitcoin/commits/pr/ccoins-cleanup.15), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/ccoins-cleanup.14-rebase..pr/ccoins-cleanup.15)) due to conflict with #19806\r\nUpdated 0c33bd2efa48d276e3475d458f12cba863c83448 -> a40f7e5ed7e55a22ecd604f5632c5c83f0eb0781 ([`pr/ccoins-cleanup.15`](https://github.com/ryanofsky/bitcoin/commits/pr/ccoins-cleanup.15) -> [`pr/ccoins-cleanup.16`](https://github.com/ryanofsky/bitcoin/commits/pr/ccoins-cleanup.16), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/ccoins-cleanup.15..pr/ccoins-cleanup.16)) to fix fuzz and appveyor CI errors https://cirrus-ci.com/task/5569196852510720?command=ci#L2831 and https://ci.appveyor.com/project/DrahtBot/bitcoin/builds/38155594#L31\r\nRebased a40f7e5ed7e55a22ecd604f5632c5c83f0eb0781 -> ed037857dad102f0829ab16cce0bb9acf11892ff ([`pr/ccoins-cleanup.16`](https://github.com/ryanofsky/bitcoin/commits/pr/ccoins-cleanup.16) -> [`pr/ccoins-cleanup.17`](https://github.com/ryanofsky/bitcoin/commits/pr/ccoins-cleanup.17), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/ccoins-cleanup.16-rebase..pr/ccoins-cleanup.17)) due to conflict with #22902",
      "created_at" : "2020-04-27T20:33:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9384#issuecomment-620218918",
      "id" : 620218918,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9384",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMDIxODkxOA==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/620218918/reactions"
      },
      "updated_at" : "2021-11-29T21:03:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/620218918",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "```\r\nfuzz: test/fuzz/coins_view.cpp:140: auto coins_view_fuzz_target(FuzzBufferType)::(anonymous class)::operator()() const: Assertion `expected_code_path' failed.",
      "created_at" : "2022-02-22T12:01:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9384#issuecomment-1047725635",
      "id" : 1047725635,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9384",
      "node_id" : "IC_kwDOABII584-cwZD",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1047725635/reactions"
      },
      "updated_at" : "2022-02-22T12:01:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1047725635",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-01-30T17:06:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9384#issuecomment-1408994757",
      "id" : 1408994757,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9384",
      "node_id" : "IC_kwDOABII585T-43F",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1408994757/reactions"
      },
      "updated_at" : "2023-01-30T17:06:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1408994757",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, please ping me to review when you rebase.",
      "created_at" : "2023-01-30T17:16:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9384#issuecomment-1409010161",
      "id" : 1409010161,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9384",
      "node_id" : "IC_kwDOABII585T-8nx",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1409010161/reactions"
      },
      "updated_at" : "2023-01-30T17:16:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1409010161",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   }
]
