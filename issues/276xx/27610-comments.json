[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [darosior](https://github.com/bitcoin/bitcoin/pull/27610#pullrequestreview-1419935557), [willcl-ark](https://github.com/bitcoin/bitcoin/pull/27610#issuecomment-1542181711), [instagibbs](https://github.com/bitcoin/bitcoin/pull/27610#issuecomment-1542201540), [glozow](https://github.com/bitcoin/bitcoin/pull/27610#pullrequestreview-1422536495), [dergoegge](https://github.com/bitcoin/bitcoin/pull/27610#pullrequestreview-1422347722) |\n| Concept ACK | [0xB10C](https://github.com/bitcoin/bitcoin/pull/27610#issuecomment-1542178451), [pinheadmz](https://github.com/bitcoin/bitcoin/pull/27610#pullrequestreview-1420860416) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n",
      "created_at" : "2023-05-10T00:11:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27610#issuecomment-1541044934",
      "id" : 1541044934,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27610",
      "node_id" : "IC_kwDOABII585b2nrG",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1541044934/reactions"
      },
      "updated_at" : "2023-05-11T12:55:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1541044934",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2023-05-10T13:04:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27610#issuecomment-1542178451",
      "id" : 1542178451,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27610",
      "node_id" : "IC_kwDOABII585b68aT",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1542178451/reactions"
      },
      "updated_at" : "2023-05-10T13:04:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1542178451",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ACK 5b34060\r\n\r\nCurrently running this cherry-picked on top of v24.0.1 on mainnet and seeing reduced resource usage.",
      "created_at" : "2023-05-10T13:05:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27610#issuecomment-1542181711",
      "id" : 1542181711,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27610",
      "node_id" : "IC_kwDOABII585b69NP",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1542181711/reactions"
      },
      "updated_at" : "2023-05-10T13:05:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1542181711",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK https://github.com/bitcoin/bitcoin/pull/27610/commits/5b3406094f2679dfb3763de4414257268565b943\r\n\r\nSignificant reduction in CPU usage when influx of transactions is high and sustained. Allows an additional INV to trickle per additional 200 INV backlog, capped at 1k.",
      "created_at" : "2023-05-10T13:19:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27610#issuecomment-1542201540",
      "id" : 1542201540,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27610",
      "node_id" : "IC_kwDOABII585b7CDE",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1542201540/reactions"
      },
      "updated_at" : "2023-05-10T13:20:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1542201540",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Compared where the time is spent in the `b-msghand` thread on a mainnet `master` and a mainnet 5b3406094f2679dfb3763de4414257268565b943 node that were both running for a while. Followed [eklitzke's flamegraph.md](https://github.com/eklitzke/bitcoin/blob/flamegraphs/doc/flamegraphs.md#generating-a-profile) to create the flamegraphs below. This seems to be indeed a nice performance improvement. The second flamegraph looks _healthier_. \r\n\r\n`master`:\r\n\r\n![flamegraph-master](https://github.com/bitcoin/bitcoin/assets/19157360/7e31c262-648f-4168-9a9a-5cc93b4a9da0)\r\n\r\n\r\n5b3406094f2679dfb3763de4414257268565b943:\r\n\r\n![flamegraph-202305-invtosend](https://github.com/bitcoin/bitcoin/assets/19157360/36f2ee57-b017-4ffe-8099-970b20998d0a)\r\n",
      "created_at" : "2023-05-10T14:48:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27610#issuecomment-1542339344",
      "id" : 1542339344,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27610",
      "node_id" : "IC_kwDOABII585b7jsQ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 2,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 2,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1542339344/reactions"
      },
      "updated_at" : "2023-05-10T14:48:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1542339344",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1190049503"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1190049503"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why stop at 1000? If it's the same rationale could you use this constant?\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/104eed116614996d9724f82d47e373ef420cd372/src/net_processing.cpp#L109-L110",
      "commit_id" : "5b3406094f2679dfb3763de4414257268565b943",
      "created_at" : "2023-05-10T15:05:20Z",
      "diff_hunk" : "@@ -5666,7 +5666,9 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n                     // especially since we have many peers and some will draw much shorter delays.\n                     unsigned int nRelayedTransactions = 0;\n                     LOCK(tx_relay->m_bloom_filter_mutex);\n-                    while (!vInvTx.empty() && nRelayedTransactions < INVENTORY_BROADCAST_MAX) {\n+                    size_t broadcast_max{INVENTORY_BROADCAST_MAX + (tx_relay->m_tx_inventory_to_send.size()/1000)*5};\n+                    broadcast_max = std::min<size_t>(1000, broadcast_max);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1190049503",
      "id" : 1190049503,
      "line" : 5670,
      "node_id" : "PRRC_kwDOABII585G7rbf",
      "original_commit_id" : "5b3406094f2679dfb3763de4414257268565b943",
      "original_line" : 5670,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 6,
      "pull_request_review_id" : 1420860416,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1190049503/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-10T15:29:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1190049503",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1190081684"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1190081684"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Could this increase the number of transactions we're announcing beyond `INVENTORY_MAX_RECENT_RELAY = 3500` so things fall out of `m_recently_announced_invs` (essentially what you said in https://github.com/bitcoin/bitcoin/pull/27602#discussion_r1189250200)?\r\n\r\nMaybe we want to increase `INVENTORY_MAX_RECENT_RELAY`, e.g. equal to `MAX_PEER_TX_ANNOUNCEMENTS = 5000` (the max requesting coming from the receiver end if they're Bitcoin Core - imo it could make sense for these to be symmetrical)?",
      "commit_id" : "5b3406094f2679dfb3763de4414257268565b943",
      "created_at" : "2023-05-10T15:28:31Z",
      "diff_hunk" : "@@ -5666,7 +5666,9 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n                     // especially since we have many peers and some will draw much shorter delays.\n                     unsigned int nRelayedTransactions = 0;\n                     LOCK(tx_relay->m_bloom_filter_mutex);\n-                    while (!vInvTx.empty() && nRelayedTransactions < INVENTORY_BROADCAST_MAX) {\n+                    size_t broadcast_max{INVENTORY_BROADCAST_MAX + (tx_relay->m_tx_inventory_to_send.size()/1000)*5};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1190081684",
      "id" : 1190081684,
      "line" : 5669,
      "node_id" : "PRRC_kwDOABII585G7zSU",
      "original_commit_id" : "5b3406094f2679dfb3763de4414257268565b943",
      "original_line" : 5669,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 5,
      "pull_request_review_id" : 1420907694,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1190081684/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-10T15:28:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1190081684",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1190081977"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1190081977"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is there a reason why we can't ignore not-in-mempool txs before we even get to this point?\r\n\r\ni.e. here:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/104eed116614996d9724f82d47e373ef420cd372/src/net_processing.cpp#L5671-L5673",
      "commit_id" : "5b3406094f2679dfb3763de4414257268565b943",
      "created_at" : "2023-05-10T15:28:45Z",
      "diff_hunk" : "@@ -755,11 +755,16 @@ void CTxMemPool::check(const CCoinsViewCache& active_coins_tip, int64_t spendhei\n \n bool CTxMemPool::CompareDepthAndScore(const uint256& hasha, const uint256& hashb, bool wtxid)\n {\n+    /* Return `true` if hasha should be considered sooner than hashb. Namely when:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1190081977",
      "id" : 1190081977,
      "line" : 758,
      "node_id" : "PRRC_kwDOABII585G7zW5",
      "original_commit_id" : "5b3406094f2679dfb3763de4414257268565b943",
      "original_line" : 758,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 4,
      "pull_request_review_id" : 1420860416,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1190081977/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-10T15:29:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1190081977",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1190528963"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1190528963"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The `3500` figure is calculated based on outbound peers, which already have 2.5x the INV rate of inbound peers. An inbound peer would need to be at 65 or 70 txids per INV message to have the same 1-in-a-million chance of a problem, implying a tx rate of 13 or 14 tx/s. To get to a 1-in-100 chance of a problem, you'd need to hit 90-to-95 txids per INV (and sustain that for ~40 INVs, and hit the 1-in-100 chance of sending those 40 INVs in a 2 minute period). Those seem okay to me.",
      "commit_id" : "5b3406094f2679dfb3763de4414257268565b943",
      "created_at" : "2023-05-11T01:02:45Z",
      "diff_hunk" : "@@ -5666,7 +5666,9 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n                     // especially since we have many peers and some will draw much shorter delays.\n                     unsigned int nRelayedTransactions = 0;\n                     LOCK(tx_relay->m_bloom_filter_mutex);\n-                    while (!vInvTx.empty() && nRelayedTransactions < INVENTORY_BROADCAST_MAX) {\n+                    size_t broadcast_max{INVENTORY_BROADCAST_MAX + (tx_relay->m_tx_inventory_to_send.size()/1000)*5};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1190528963",
      "id" : 1190528963,
      "in_reply_to_id" : 1190081684,
      "line" : 5669,
      "node_id" : "PRRC_kwDOABII585G9gfD",
      "original_commit_id" : "5b3406094f2679dfb3763de4414257268565b943",
      "original_line" : 5669,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 5,
      "pull_request_review_id" : 1421561828,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1190528963/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-11T01:02:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1190528963",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1190533182"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1190533182"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Just seems like more code to do it that way, since that is just dealing with txids and `CompareDepthAndScore` already has access to the mempool info.",
      "commit_id" : "5b3406094f2679dfb3763de4414257268565b943",
      "created_at" : "2023-05-11T01:07:38Z",
      "diff_hunk" : "@@ -755,11 +755,16 @@ void CTxMemPool::check(const CCoinsViewCache& active_coins_tip, int64_t spendhei\n \n bool CTxMemPool::CompareDepthAndScore(const uint256& hasha, const uint256& hashb, bool wtxid)\n {\n+    /* Return `true` if hasha should be considered sooner than hashb. Namely when:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1190533182",
      "id" : 1190533182,
      "in_reply_to_id" : 1190081977,
      "line" : 758,
      "node_id" : "PRRC_kwDOABII585G9hg-",
      "original_commit_id" : "5b3406094f2679dfb3763de4414257268565b943",
      "original_line" : 758,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 4,
      "pull_request_review_id" : 1421569015,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1190533182/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-11T01:07:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1190533182",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1190574243"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1190574243"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It's more related to `MAX_PEER_TX_ANNOUNCEMENTS=5000` (we don't want to send more than we would be willing to receive) and `INVENTORY_MAX_RECENT_RELAY=3500` (we don't want to advertise txids and then refuse to relay them because we've forgotten that we advertised them).\r\n\r\n(Could make sense to limit it to 90 for inbounds and 45 for outbounds as (if sustained for two minutes) those values would hit roughly a 1-in-100 chance of overflowing `INVENTORY_MAX_RECENT_RELAY`)",
      "commit_id" : "5b3406094f2679dfb3763de4414257268565b943",
      "created_at" : "2023-05-11T02:28:32Z",
      "diff_hunk" : "@@ -5666,7 +5666,9 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n                     // especially since we have many peers and some will draw much shorter delays.\n                     unsigned int nRelayedTransactions = 0;\n                     LOCK(tx_relay->m_bloom_filter_mutex);\n-                    while (!vInvTx.empty() && nRelayedTransactions < INVENTORY_BROADCAST_MAX) {\n+                    size_t broadcast_max{INVENTORY_BROADCAST_MAX + (tx_relay->m_tx_inventory_to_send.size()/1000)*5};\n+                    broadcast_max = std::min<size_t>(1000, broadcast_max);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1190574243",
      "id" : 1190574243,
      "in_reply_to_id" : 1190049503,
      "line" : 5670,
      "node_id" : "PRRC_kwDOABII585G9rij",
      "original_commit_id" : "5b3406094f2679dfb3763de4414257268565b943",
      "original_line" : 5670,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 6,
      "pull_request_review_id" : 1421647409,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1190574243/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-11T02:28:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1190574243",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1190938459"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1190938459"
         }
      },
      "author_association" : "MEMBER",
      "body" : "question (feel free to ignore): I tried to figure out if there was a reason why this was re-ordered, but couldn't find one. An equivalent patch of simply changing the literals `false` to `true` and `true` to `false` in this function should have achieved the same, right?",
      "commit_id" : "5b3406094f2679dfb3763de4414257268565b943",
      "created_at" : "2023-05-11T10:03:08Z",
      "diff_hunk" : "@@ -755,11 +755,16 @@ void CTxMemPool::check(const CCoinsViewCache& active_coins_tip, int64_t spendhei\n \n bool CTxMemPool::CompareDepthAndScore(const uint256& hasha, const uint256& hashb, bool wtxid)\n {\n+    /* Return `true` if hasha should be considered sooner than hashb. Namely when:\n+     *   a is not in the mempool, but b is\n+     *   both are in the mempool and a has fewer ancestors than b\n+     *   both are in the mempool and a has a higher score than b\n+     */\n     LOCK(cs);\n-    indexed_transaction_set::const_iterator i = wtxid ? get_iter_from_wtxid(hasha) : mapTx.find(hasha);\n-    if (i == mapTx.end()) return false;\n     indexed_transaction_set::const_iterator j = wtxid ? get_iter_from_wtxid(hashb) : mapTx.find(hashb);\n-    if (j == mapTx.end()) return true;\n+    if (j == mapTx.end()) return false;\n+    indexed_transaction_set::const_iterator i = wtxid ? get_iter_from_wtxid(hasha) : mapTx.find(hasha);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1190938459",
      "id" : 1190938459,
      "line" : 766,
      "node_id" : "PRRC_kwDOABII585G_Edb",
      "original_commit_id" : "228e9201efb5574b1b96bb924de1d2e8dd1317f3",
      "original_line" : 766,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 15,
      "pull_request_review_id" : 1422225046,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1190938459/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-11T13:59:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1190938459",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1191017253"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191017253"
         }
      },
      "author_association" : "MEMBER",
      "body" : "* `INVENTORY_BROADCAST_MAX` should be renamed or have its comment amended\r\n* clang-format?\r\n* Maybe add the commit description as a comment here\r\n",
      "commit_id" : "5b3406094f2679dfb3763de4414257268565b943",
      "created_at" : "2023-05-11T11:20:01Z",
      "diff_hunk" : "@@ -5666,7 +5666,9 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n                     // especially since we have many peers and some will draw much shorter delays.\n                     unsigned int nRelayedTransactions = 0;\n                     LOCK(tx_relay->m_bloom_filter_mutex);\n-                    while (!vInvTx.empty() && nRelayedTransactions < INVENTORY_BROADCAST_MAX) {\n+                    size_t broadcast_max{INVENTORY_BROADCAST_MAX + (tx_relay->m_tx_inventory_to_send.size()/1000)*5};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1191017253",
      "id" : 1191017253,
      "line" : 5669,
      "node_id" : "PRRC_kwDOABII585G_Xsl",
      "original_commit_id" : "5b3406094f2679dfb3763de4414257268565b943",
      "original_line" : 5669,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 5,
      "pull_request_review_id" : 1422347722,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191017253/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-11T12:55:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191017253",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1191018175"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191018175"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Explaining that in a comment would be nice",
      "commit_id" : "5b3406094f2679dfb3763de4414257268565b943",
      "created_at" : "2023-05-11T11:20:53Z",
      "diff_hunk" : "@@ -5666,7 +5666,9 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n                     // especially since we have many peers and some will draw much shorter delays.\n                     unsigned int nRelayedTransactions = 0;\n                     LOCK(tx_relay->m_bloom_filter_mutex);\n-                    while (!vInvTx.empty() && nRelayedTransactions < INVENTORY_BROADCAST_MAX) {\n+                    size_t broadcast_max{INVENTORY_BROADCAST_MAX + (tx_relay->m_tx_inventory_to_send.size()/1000)*5};\n+                    broadcast_max = std::min<size_t>(1000, broadcast_max);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1191018175",
      "id" : 1191018175,
      "in_reply_to_id" : 1190049503,
      "line" : 5670,
      "node_id" : "PRRC_kwDOABII585G_X6_",
      "original_commit_id" : "5b3406094f2679dfb3763de4414257268565b943",
      "original_line" : 5670,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 6,
      "pull_request_review_id" : 1422347722,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191018175/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-11T12:55:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191018175",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1191140520"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191140520"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n                    size_t broadcast_max{INVENTORY_BROADCAST_MAX + (tx_relay->m_tx_inventory_to_send.size() / 1000) * count_seconds(INBOUND_INVENTORY_BROADCAST_INTERVAL)};\r\n```",
      "commit_id" : "5b3406094f2679dfb3763de4414257268565b943",
      "created_at" : "2023-05-11T12:54:12Z",
      "diff_hunk" : "@@ -5666,7 +5666,9 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n                     // especially since we have many peers and some will draw much shorter delays.\n                     unsigned int nRelayedTransactions = 0;\n                     LOCK(tx_relay->m_bloom_filter_mutex);\n-                    while (!vInvTx.empty() && nRelayedTransactions < INVENTORY_BROADCAST_MAX) {\n+                    size_t broadcast_max{INVENTORY_BROADCAST_MAX + (tx_relay->m_tx_inventory_to_send.size()/1000)*5};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1191140520",
      "id" : 1191140520,
      "line" : 5669,
      "node_id" : "PRRC_kwDOABII585G_1yo",
      "original_commit_id" : "5b3406094f2679dfb3763de4414257268565b943",
      "original_line" : 5669,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 5,
      "pull_request_review_id" : 1422347722,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191140520/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-11T12:55:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191140520",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1191169420"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191169420"
         }
      },
      "author_association" : "MEMBER",
      "body" : "static asserts or something would be even better",
      "commit_id" : "5b3406094f2679dfb3763de4414257268565b943",
      "created_at" : "2023-05-11T13:16:38Z",
      "diff_hunk" : "@@ -5666,7 +5666,9 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n                     // especially since we have many peers and some will draw much shorter delays.\n                     unsigned int nRelayedTransactions = 0;\n                     LOCK(tx_relay->m_bloom_filter_mutex);\n-                    while (!vInvTx.empty() && nRelayedTransactions < INVENTORY_BROADCAST_MAX) {\n+                    size_t broadcast_max{INVENTORY_BROADCAST_MAX + (tx_relay->m_tx_inventory_to_send.size()/1000)*5};\n+                    broadcast_max = std::min<size_t>(1000, broadcast_max);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1191169420",
      "id" : 1191169420,
      "in_reply_to_id" : 1190049503,
      "line" : 5670,
      "node_id" : "PRRC_kwDOABII585G_82M",
      "original_commit_id" : "5b3406094f2679dfb3763de4414257268565b943",
      "original_line" : 5670,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 6,
      "pull_request_review_id" : 1422592953,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191169420/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-11T13:16:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191169420",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1191178712"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191178712"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Could we have these cases covered by a unit test?",
      "commit_id" : "5b3406094f2679dfb3763de4414257268565b943",
      "created_at" : "2023-05-11T13:23:11Z",
      "diff_hunk" : "@@ -755,11 +755,16 @@ void CTxMemPool::check(const CCoinsViewCache& active_coins_tip, int64_t spendhei\n \n bool CTxMemPool::CompareDepthAndScore(const uint256& hasha, const uint256& hashb, bool wtxid)\n {\n+    /* Return `true` if hasha should be considered sooner than hashb. Namely when:\n+     *   a is not in the mempool, but b is",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1191178712",
      "id" : 1191178712,
      "line" : 759,
      "node_id" : "PRRC_kwDOABII585G__HY",
      "original_commit_id" : "5b3406094f2679dfb3763de4414257268565b943",
      "original_line" : 759,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 5,
      "pull_request_review_id" : 1422607073,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191178712/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-11T13:23:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191178712",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1191209626"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191209626"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've written a unit test here: https://github.com/glozow/bitcoin/commits/2023-05-comparedepthandscore-test\r\n",
      "commit_id" : "5b3406094f2679dfb3763de4414257268565b943",
      "created_at" : "2023-05-11T13:57:36Z",
      "diff_hunk" : "@@ -755,11 +755,16 @@ void CTxMemPool::check(const CCoinsViewCache& active_coins_tip, int64_t spendhei\n \n bool CTxMemPool::CompareDepthAndScore(const uint256& hasha, const uint256& hashb, bool wtxid)\n {\n+    /* Return `true` if hasha should be considered sooner than hashb. Namely when:\n+     *   a is not in the mempool, but b is",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1191209626",
      "id" : 1191209626,
      "in_reply_to_id" : 1191178712,
      "line" : 759,
      "node_id" : "PRRC_kwDOABII585HAGqa",
      "original_commit_id" : "5b3406094f2679dfb3763de4414257268565b943",
      "original_line" : 759,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 5,
      "pull_request_review_id" : 1422657603,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191209626/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-11T13:57:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191209626",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1191235815"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191235815"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The `CompareTxMemPoolEntryByScore` comparator returns `false` on equality (ie, it's \"less than\" not \"less than or equal\"), so this preserves that behaviour.",
      "commit_id" : "5b3406094f2679dfb3763de4414257268565b943",
      "created_at" : "2023-05-11T14:13:28Z",
      "diff_hunk" : "@@ -755,11 +755,16 @@ void CTxMemPool::check(const CCoinsViewCache& active_coins_tip, int64_t spendhei\n \n bool CTxMemPool::CompareDepthAndScore(const uint256& hasha, const uint256& hashb, bool wtxid)\n {\n+    /* Return `true` if hasha should be considered sooner than hashb. Namely when:\n+     *   a is not in the mempool, but b is\n+     *   both are in the mempool and a has fewer ancestors than b\n+     *   both are in the mempool and a has a higher score than b\n+     */\n     LOCK(cs);\n-    indexed_transaction_set::const_iterator i = wtxid ? get_iter_from_wtxid(hasha) : mapTx.find(hasha);\n-    if (i == mapTx.end()) return false;\n     indexed_transaction_set::const_iterator j = wtxid ? get_iter_from_wtxid(hashb) : mapTx.find(hashb);\n-    if (j == mapTx.end()) return true;\n+    if (j == mapTx.end()) return false;\n+    indexed_transaction_set::const_iterator i = wtxid ? get_iter_from_wtxid(hasha) : mapTx.find(hasha);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1191235815",
      "id" : 1191235815,
      "in_reply_to_id" : 1190938459,
      "line" : 766,
      "node_id" : "PRRC_kwDOABII585HANDn",
      "original_commit_id" : "228e9201efb5574b1b96bb924de1d2e8dd1317f3",
      "original_line" : 766,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 15,
      "pull_request_review_id" : 1422696057,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191235815/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-11T14:13:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191235815",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1191369870"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191369870"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, I should have just read the documentation: https://en.cppreference.com/w/cpp/named_req/Compare , which would have answered this.",
      "commit_id" : "5b3406094f2679dfb3763de4414257268565b943",
      "created_at" : "2023-05-11T15:39:38Z",
      "diff_hunk" : "@@ -755,11 +755,16 @@ void CTxMemPool::check(const CCoinsViewCache& active_coins_tip, int64_t spendhei\n \n bool CTxMemPool::CompareDepthAndScore(const uint256& hasha, const uint256& hashb, bool wtxid)\n {\n+    /* Return `true` if hasha should be considered sooner than hashb. Namely when:\n+     *   a is not in the mempool, but b is\n+     *   both are in the mempool and a has fewer ancestors than b\n+     *   both are in the mempool and a has a higher score than b\n+     */\n     LOCK(cs);\n-    indexed_transaction_set::const_iterator i = wtxid ? get_iter_from_wtxid(hasha) : mapTx.find(hasha);\n-    if (i == mapTx.end()) return false;\n     indexed_transaction_set::const_iterator j = wtxid ? get_iter_from_wtxid(hashb) : mapTx.find(hashb);\n-    if (j == mapTx.end()) return true;\n+    if (j == mapTx.end()) return false;\n+    indexed_transaction_set::const_iterator i = wtxid ? get_iter_from_wtxid(hasha) : mapTx.find(hasha);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1191369870",
      "id" : 1191369870,
      "in_reply_to_id" : 1190938459,
      "line" : 766,
      "node_id" : "PRRC_kwDOABII585HAtyO",
      "original_commit_id" : "228e9201efb5574b1b96bb924de1d2e8dd1317f3",
      "original_line" : 766,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 15,
      "pull_request_review_id" : 1422907953,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191369870/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-11T15:39:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191369870",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1191512898"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191512898"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Cool, @glozow. ",
      "commit_id" : "5b3406094f2679dfb3763de4414257268565b943",
      "created_at" : "2023-05-11T17:50:14Z",
      "diff_hunk" : "@@ -755,11 +755,16 @@ void CTxMemPool::check(const CCoinsViewCache& active_coins_tip, int64_t spendhei\n \n bool CTxMemPool::CompareDepthAndScore(const uint256& hasha, const uint256& hashb, bool wtxid)\n {\n+    /* Return `true` if hasha should be considered sooner than hashb. Namely when:\n+     *   a is not in the mempool, but b is",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1191512898",
      "id" : 1191512898,
      "in_reply_to_id" : 1191178712,
      "line" : 759,
      "node_id" : "PRRC_kwDOABII585HBQtC",
      "original_commit_id" : "5b3406094f2679dfb3763de4414257268565b943",
      "original_line" : 759,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 5,
      "pull_request_review_id" : 1423143085,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191512898/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-11T17:50:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191512898",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1192111163"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1192111163"
         }
      },
      "author_association" : "MEMBER",
      "body" : "For a followup it would be could to clarify \"should be considered\" _for what_. It's somewhat confusing to reason about because the call site reverses a and b.\r\n\r\nThe first case in the comment is \"a is not in the mempool, but b is\", but the line of code checks if b is not in the mempool.",
      "commit_id" : "5b3406094f2679dfb3763de4414257268565b943",
      "created_at" : "2023-05-12T09:04:10Z",
      "diff_hunk" : "@@ -755,11 +755,16 @@ void CTxMemPool::check(const CCoinsViewCache& active_coins_tip, int64_t spendhei\n \n bool CTxMemPool::CompareDepthAndScore(const uint256& hasha, const uint256& hashb, bool wtxid)\n {\n+    /* Return `true` if hasha should be considered sooner than hashb. Namely when:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1192111163",
      "id" : 1192111163,
      "line" : 758,
      "node_id" : "PRRC_kwDOABII585HDiw7",
      "original_commit_id" : "228e9201efb5574b1b96bb924de1d2e8dd1317f3",
      "original_line" : 758,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 4,
      "pull_request_review_id" : 1424084239,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1192111163/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-12T09:04:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1192111163",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1192123432"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1192123432"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> The first case in the comment is \"a is not in the mempool, but b is\", but the line of code checks if b is not in the mempool.\r\n\r\nIf b is not in the mempool, the function must return false, see https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1191235815\r\n\r\nIf b is in the mempool, the function will continue over the early return `false`, and checks to see if a is missing, in which case it should be considered sooner.",
      "commit_id" : "5b3406094f2679dfb3763de4414257268565b943",
      "created_at" : "2023-05-12T09:15:40Z",
      "diff_hunk" : "@@ -755,11 +755,16 @@ void CTxMemPool::check(const CCoinsViewCache& active_coins_tip, int64_t spendhei\n \n bool CTxMemPool::CompareDepthAndScore(const uint256& hasha, const uint256& hashb, bool wtxid)\n {\n+    /* Return `true` if hasha should be considered sooner than hashb. Namely when:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1192123432",
      "id" : 1192123432,
      "in_reply_to_id" : 1192111163,
      "line" : 758,
      "node_id" : "PRRC_kwDOABII585HDlwo",
      "original_commit_id" : "228e9201efb5574b1b96bb924de1d2e8dd1317f3",
      "original_line" : 758,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 4,
      "pull_request_review_id" : 1424105297,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1192123432/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-12T09:15:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1192123432",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Partial utACK for the changes in `CompareDepthAndScore`. Took me a while to wrap my head around it.",
      "created_at" : "2023-05-12T13:21:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27610#issuecomment-1545737922",
      "id" : 1545737922,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27610",
      "node_id" : "IC_kwDOABII585cIhbC",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1545737922/reactions"
      },
      "updated_at" : "2023-05-12T13:21:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1545737922",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1192393157"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1192393157"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> \"should be considered\" for what\r\n\r\nFor processing, which begins by dropping a transaction from `m_tx_inventory_to_send` before deciding whether to send it. Since we stop processing after having sent `broadcast_max` transactions, it makes sense to do the cleaning first.\r\n\r\nA return value of `true` means hasha is lower, i.e. would be at the bottom of the (max)heap and processed last. But because we swap a and b when calling this, it works. That was introduced in the second commit of #7840.\r\n\r\n\r\nWe could prune non-mempool transactions even before making a heap, but that would double the mempool lookups, and the [flame graph](https://github.com/bitcoin/bitcoin/pull/27610#issuecomment-1542339344) suggests that `make_heap` is plenty fast already now.",
      "commit_id" : "5b3406094f2679dfb3763de4414257268565b943",
      "created_at" : "2023-05-12T13:39:31Z",
      "diff_hunk" : "@@ -755,11 +755,16 @@ void CTxMemPool::check(const CCoinsViewCache& active_coins_tip, int64_t spendhei\n \n bool CTxMemPool::CompareDepthAndScore(const uint256& hasha, const uint256& hashb, bool wtxid)\n {\n+    /* Return `true` if hasha should be considered sooner than hashb. Namely when:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27610#discussion_r1192393157",
      "id" : 1192393157,
      "in_reply_to_id" : 1192111163,
      "line" : 758,
      "node_id" : "PRRC_kwDOABII585HEnnF",
      "original_commit_id" : "228e9201efb5574b1b96bb924de1d2e8dd1317f3",
      "original_line" : 758,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 4,
      "pull_request_review_id" : 1424537358,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27610",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1192393157/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-12T13:40:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1192393157",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   }
]
