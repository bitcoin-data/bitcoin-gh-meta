[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r132848026"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/132848026"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "!pblockindex",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2017-08-13T17:39:50Z",
      "diff_hunk" : "@@ -212,10 +211,11 @@ static bool rest_block(HTTPRequest* req,\n     CBlockIndex* pblockindex = NULL;\n     {\n         LOCK(cs_main);\n-        if (mapBlockIndex.count(hash) == 0)\n+        pblockindex = LookupBlockIndex(hash);\n+        if (pblockindex) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r132848026",
      "id" : 132848026,
      "original_commit_id" : "171213cb323e85630087e42e60967b56724d229a",
      "original_position" : 16,
      "path" : "src/rest.cpp",
      "position" : null,
      "pull_request_review_id" : 55971450,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/132848026",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r132848037"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/132848037"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Same as above.",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2017-08-13T17:40:23Z",
      "diff_hunk" : "@@ -669,10 +669,10 @@ UniValue getblockheader(const JSONRPCRequest& request)\n     if (!request.params[1].isNull())\n         fVerbose = request.params[1].get_bool();\n \n-    if (mapBlockIndex.count(hash) == 0)\n+    CBlockIndex* pblockindex = LookupBlockIndex(hash);\n+    if (pblockindex == nullptr) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r132848037",
      "id" : 132848037,
      "original_commit_id" : "171213cb323e85630087e42e60967b56724d229a",
      "original_position" : 6,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 55971450,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/132848037",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r132848061"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/132848061"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Remove assert.",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2017-08-13T17:40:52Z",
      "diff_hunk" : "@@ -817,7 +816,9 @@ static bool GetUTXOStats(CCoinsView *view, CCoinsStats &stats)\n     stats.hashBlock = pcursor->GetBestBlock();\n     {\n         LOCK(cs_main);\n-        stats.nHeight = mapBlockIndex.find(stats.hashBlock)->second->nHeight;\n+        const CBlockIndex* pindex = LookupBlockIndex(stats.hashBlock);\n+        assert(pindex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r132848061",
      "id" : 132848061,
      "original_commit_id" : "171213cb323e85630087e42e60967b56724d229a",
      "original_position" : 35,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 55971450,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/132848061",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "body" : "Concept ACK",
      "created_at" : "2017-08-14T10:27:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#issuecomment-322155803",
      "id" : 322155803,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11041",
      "updated_at" : "2017-08-14T10:27:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/322155803",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "This may make #10692 a bit simpler, though I'm not sure it matters what order they come in.",
      "created_at" : "2017-08-14T14:45:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#issuecomment-322210067",
      "id" : 322210067,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11041",
      "updated_at" : "2017-08-14T14:45:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/322210067",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "Fixed bug and rebased.",
      "created_at" : "2017-08-15T15:37:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#issuecomment-322503789",
      "id" : 322503789,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11041",
      "updated_at" : "2017-08-15T15:37:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/322503789",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "body" : "@laanwj I believe it's ready.",
      "created_at" : "2017-08-22T14:56:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#issuecomment-324052747",
      "id" : 324052747,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11041",
      "updated_at" : "2017-08-22T14:56:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/324052747",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "body" : "Concept ACK",
      "created_at" : "2017-08-22T15:49:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#issuecomment-324069155",
      "id" : 324069155,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11041",
      "updated_at" : "2017-08-22T15:49:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/324069155",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r134638513"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/134638513"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe explicit cast to bool here for clarity",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2017-08-23T01:20:42Z",
      "diff_hunk" : "@@ -904,7 +906,7 @@ bool static AlreadyHave(const CInv& inv) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n         }\n     case MSG_BLOCK:\n     case MSG_WITNESS_BLOCK:\n-        return mapBlockIndex.count(inv.hash);\n+        return LookupBlockIndex(inv.hash);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r134638513",
      "id" : 134638513,
      "original_commit_id" : "c5153911f5f3c97f26b7dab29e779889aa4cee3b",
      "original_position" : 38,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 57952795,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/134638513",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r134649948"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/134649948"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Prefer this?\r\n```cpp\r\nreturn LookupBlockIndex(inv.hash) != nullptr;\r\n```",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2017-08-23T03:26:10Z",
      "diff_hunk" : "@@ -904,7 +906,7 @@ bool static AlreadyHave(const CInv& inv) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n         }\n     case MSG_BLOCK:\n     case MSG_WITNESS_BLOCK:\n-        return mapBlockIndex.count(inv.hash);\n+        return LookupBlockIndex(inv.hash);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r134649948",
      "id" : 134649948,
      "in_reply_to_id" : 134638513,
      "original_commit_id" : "c5153911f5f3c97f26b7dab29e779889aa4cee3b",
      "original_position" : 38,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 57965458,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/134649948",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r134655245"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/134655245"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah or a ternary or even an if statement would be a lot clearer",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2017-08-23T04:33:37Z",
      "diff_hunk" : "@@ -904,7 +906,7 @@ bool static AlreadyHave(const CInv& inv) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n         }\n     case MSG_BLOCK:\n     case MSG_WITNESS_BLOCK:\n-        return mapBlockIndex.count(inv.hash);\n+        return LookupBlockIndex(inv.hash);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r134655245",
      "id" : 134655245,
      "in_reply_to_id" : 134638513,
      "original_commit_id" : "c5153911f5f3c97f26b7dab29e779889aa4cee3b",
      "original_position" : 38,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 57971275,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/134655245",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "body" : "Rebased and fixed @MeshCollider comment.",
      "created_at" : "2017-08-25T14:38:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#issuecomment-324939734",
      "id" : 324939734,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11041",
      "updated_at" : "2017-08-25T14:38:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/324939734",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r147724360"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/147724360"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Missing assert lock is held.",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2017-10-30T14:45:15Z",
      "diff_hunk" : "@@ -425,6 +425,12 @@ class CVerifyDB {\n /** Replay blocks that aren't fully applied to the database. */\n bool ReplayBlocks(const CChainParams& params, CCoinsView* view);\n \n+inline CBlockIndex* LookupBlockIndex(const uint256& hash)\n+{\n+    BlockMap::const_iterator it = mapBlockIndex.find(hash);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r147724360",
      "id" : 147724360,
      "original_commit_id" : "1d1768f2978bafaf166bfa218c899ddaeeccad2d",
      "original_position" : 6,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 72860048,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/147724360",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r147808975"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/147808975"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Missing `EXCLUSIVE_LOCKS_REQUIRED(cs_main)` too :-)",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2017-10-30T19:25:44Z",
      "diff_hunk" : "@@ -425,6 +425,12 @@ class CVerifyDB {\n /** Replay blocks that aren't fully applied to the database. */\n bool ReplayBlocks(const CChainParams& params, CCoinsView* view);\n \n+inline CBlockIndex* LookupBlockIndex(const uint256& hash)\n+{\n+    BlockMap::const_iterator it = mapBlockIndex.find(hash);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r147808975",
      "id" : 147808975,
      "in_reply_to_id" : 147724360,
      "original_commit_id" : "1d1768f2978bafaf166bfa218c899ddaeeccad2d",
      "original_position" : 6,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 72957447,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/147808975",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r148586107"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/148586107"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In some of these places you could do \r\n\r\n```c++\r\nif (const CBlockIndex* pindex = LookupBlockIndex(wtx.hashBlock))\r\n```\r\n\r\nto reduce the scope of the pindex variables.",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2017-11-02T16:25:59Z",
      "diff_hunk" : "@@ -3793,7 +3791,8 @@ unsigned int CWallet::ComputeTimeSmart(const CWalletTx& wtx) const\n {\n     unsigned int nTimeSmart = wtx.nTimeReceived;\n     if (!wtx.hashUnset()) {\n-        if (mapBlockIndex.count(wtx.hashBlock)) {\n+        const CBlockIndex* pindex = LookupBlockIndex(wtx.hashBlock);\n+        if (pindex) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r148586107",
      "id" : 148586107,
      "original_commit_id" : "1d1768f2978bafaf166bfa218c899ddaeeccad2d",
      "original_position" : 44,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 73852544,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/148586107",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks @ryanofsky, I have to rebase and then I'll take into account your comment above.",
      "created_at" : "2017-11-02T16:39:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#issuecomment-341482401",
      "id" : 341482401,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11041",
      "updated_at" : "2017-11-02T16:39:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/341482401",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r155389796"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155389796"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Need to keep the `!mapBlockIndex.empty()`.",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2017-12-06T23:13:36Z",
      "diff_hunk" : "@@ -1434,8 +1434,9 @@ bool AppInitMain(boost::thread_group& threadGroup, CScheduler& scheduler)\n \n                 // If the loaded chain has a wrong genesis, bail out immediately\n                 // (we're likely using a testnet datadir, or the other way around).\n-                if (!mapBlockIndex.empty() && mapBlockIndex.count(chainparams.GetConsensus().hashGenesisBlock) == 0)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r155389796",
      "id" : 155389796,
      "original_commit_id" : "a029cd4093d821677588846cb3cbd577acace440",
      "original_position" : 4,
      "path" : "src/init.cpp",
      "position" : 13,
      "pull_request_review_id" : 81701671,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155389796",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r155390546"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155390546"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Needs a `!`",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2017-12-06T23:17:43Z",
      "diff_hunk" : "@@ -2272,14 +2272,14 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n         {\n         LOCK(cs_main);\n \n-        if (mapBlockIndex.find(cmpctblock.header.hashPrevBlock) == mapBlockIndex.end()) {\n+        if (!LookupBlockIndex(cmpctblock.header.hashPrevBlock)) {\n             // Doesn't connect (or is genesis), instead of DoSing in AcceptBlockHeader, request deeper headers\n             if (!IsInitialBlockDownload())\n                 connman->PushMessage(pfrom, msgMaker.Make(NetMsgType::GETHEADERS, chainActive.GetLocator(pindexBestHeader), uint256()));\n             return true;\n         }\n \n-        if (mapBlockIndex.find(cmpctblock.header.GetHash()) == mapBlockIndex.end()) {\n+        if (LookupBlockIndex(cmpctblock.header.GetHash())) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r155390546",
      "id" : 155390546,
      "original_commit_id" : "a029cd4093d821677588846cb3cbd577acace440",
      "original_position" : 202,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 81701671,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155390546",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This needs rebase. I can do it and adapt the new code if there is interest in merging it quick.\r\n\r\nMaybe it should also make `BlockMap mapBlockIndex` static?\r\n\r\ncc @MarcoFalke @laanwj",
      "created_at" : "2017-12-06T23:39:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#issuecomment-349811860",
      "id" : 349811860,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11041",
      "updated_at" : "2017-12-06T23:39:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/349811860",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK. Would like to see this rebased sooner rather than later.",
      "created_at" : "2017-12-12T15:42:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#issuecomment-351089901",
      "id" : 351089901,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11041",
      "updated_at" : "2017-12-12T15:42:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/351089901",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Forgot to tackle @ryanofsky [comment](https://github.com/bitcoin/bitcoin/pull/11041#discussion_r148586107) above..",
      "created_at" : "2017-12-13T15:42:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#issuecomment-351429645",
      "id" : 351429645,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11041",
      "updated_at" : "2017-12-13T15:42:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/351429645",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "travis failure:\r\n\r\n```\r\nAssertion failed: lock cs_main not held in ./validation.h:433; locks held:\r\n\r\n```",
      "created_at" : "2017-12-13T19:00:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#issuecomment-351488544",
      "id" : 351488544,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11041",
      "updated_at" : "2017-12-13T19:00:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/351488544",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r156909940"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156909940"
         }
      },
      "author_association" : "OWNER",
      "body" : "const?",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2017-12-14T10:46:02Z",
      "diff_hunk" : "@@ -167,10 +167,7 @@ void TransactionRecord::updateStatus(const CWalletTx &wtx)\n     // Determine transaction status\n \n     // Find the block the tx is in\n-    CBlockIndex* pindex = nullptr;\n-    BlockMap::iterator mi = mapBlockIndex.find(wtx.hashBlock);\n-    if (mi != mapBlockIndex.end())\n-        pindex = (*mi).second;\n+    CBlockIndex* pindex = LookupBlockIndex(wtx.hashBlock);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r156909940",
      "id" : 156909940,
      "original_commit_id" : "cbff072b60cbf1d092c166fd5cf9d3fe233ed3d0",
      "original_position" : 8,
      "path" : "src/qt/transactionrecord.cpp",
      "position" : null,
      "pull_request_review_id" : 83462031,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156909940",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r156910767"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156910767"
         }
      },
      "author_association" : "OWNER",
      "body" : "`const CBlockIndex*`?",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2017-12-14T10:49:31Z",
      "diff_hunk" : "@@ -674,10 +674,10 @@ UniValue getblockheader(const JSONRPCRequest& request)\n     if (!request.params[1].isNull())\n         fVerbose = request.params[1].get_bool();\n \n-    if (mapBlockIndex.count(hash) == 0)\n+    CBlockIndex* pblockindex = LookupBlockIndex(hash);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r156910767",
      "id" : 156910767,
      "original_commit_id" : "cbff072b60cbf1d092c166fd5cf9d3fe233ed3d0",
      "original_position" : 5,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 83462031,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156910767",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r156910997"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156910997"
         }
      },
      "author_association" : "OWNER",
      "body" : "Another one that could be const. There are more, but I'll stop commenting every one.",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2017-12-14T10:50:39Z",
      "diff_hunk" : "@@ -753,12 +753,12 @@ UniValue getblock(const JSONRPCRequest& request)\n             verbosity = request.params[1].get_bool() ? 1 : 0;\n     }\n \n-    if (mapBlockIndex.count(hash) == 0)\n+    CBlockIndex* pblockindex = LookupBlockIndex(hash);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r156910997",
      "id" : 156910997,
      "original_commit_id" : "cbff072b60cbf1d092c166fd5cf9d3fe233ed3d0",
      "original_position" : 19,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 83462031,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156910997",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I think it would be preferable to use const CBlockIndex* where it's possible\r\n\r\nAgree.\r\n\r\n> There are some cs_main locking changes; can you please explain them? Were locks missing there before, making this a bugfix as well as refactor?\r\n\r\nYes, for instance `FindForkInGlobalIndex`.\r\n\r\nI'll check if adding annotations helps identifying more missing locks. I'll update accordingly.",
      "created_at" : "2017-12-14T11:30:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#issuecomment-351685379",
      "id" : 351685379,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11041",
      "updated_at" : "2017-12-14T11:30:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/351685379",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "re: const CBlockIndex (and associated things): see #10692.",
      "created_at" : "2017-12-14T15:52:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#issuecomment-351750863",
      "id" : 351750863,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11041",
      "updated_at" : "2017-12-14T15:52:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/351750863",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r156985799"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156985799"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I dont think that is the type of const you meant. Probably just leave it non-const for now and I'll fix it up in #10692 (or you can start pulling stuff out of there into this PR if you prefer, but that probably just ends up taking more time).",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2017-12-14T16:04:56Z",
      "diff_hunk" : "@@ -21,9 +21,9 @@ namespace Checkpoints {\n         for (const MapCheckpoints::value_type& i : reverse_iterate(checkpoints))\n         {\n             const uint256& hash = i.second;\n-            BlockMap::const_iterator t = mapBlockIndex.find(hash);\n-            if (t != mapBlockIndex.end())\n-                return t->second;\n+            if (CBlockIndex* const pindex = LookupBlockIndex(hash)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r156985799",
      "id" : 156985799,
      "original_commit_id" : "cbff072b60cbf1d092c166fd5cf9d3fe233ed3d0",
      "original_position" : 7,
      "path" : "src/checkpoints.cpp",
      "position" : null,
      "pull_request_review_id" : 83553623,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156985799",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r156986317"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156986317"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This seems unrelated. Maybe leave it for #11596 instead? Or just do as I suggested at https://github.com/bitcoin/bitcoin/pull/11596#discussion_r155811677 and put a cs_main at the top of the load-chain-data block here.",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2017-12-14T16:06:34Z",
      "diff_hunk" : "@@ -1487,6 +1492,8 @@ bool AppInitMain(boost::thread_group& threadGroup, CScheduler& scheduler)\n \n                 bool is_coinsview_empty = fReset || fReindexChainState || pcoinsTip->GetBestBlock().IsNull();\n                 if (!is_coinsview_empty) {\n+                    LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r156986317",
      "id" : 156986317,
      "original_commit_id" : "cbff072b60cbf1d092c166fd5cf9d3fe233ed3d0",
      "original_position" : 24,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 83553623,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156986317",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r156992080"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156992080"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Looks like you're just adding this for CreateWalletFromFile, which already needs cs_main (and is missing it there). This should be an AssertLockHeld.",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2017-12-14T16:25:24Z",
      "diff_hunk" : "@@ -259,12 +259,12 @@ namespace {\n \n CBlockIndex* FindForkInGlobalIndex(const CChain& chain, const CBlockLocator& locator)\n {\n+    LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r156992080",
      "id" : 156992080,
      "original_commit_id" : "cbff072b60cbf1d092c166fd5cf9d3fe233ed3d0",
      "original_position" : 4,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 83553623,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156992080",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r156992400"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156992400"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Dunno if its worth bothering for things in CChainState. The whole goal here is to make mapBlockIndex a private in CChainState and expose LookupBlockIndex externally.",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2017-12-14T16:26:29Z",
      "diff_hunk" : "@@ -1813,9 +1813,9 @@ bool CChainState::ConnectBlock(const CBlock& block, CValidationState& state, CBl\n         //  relative to a piece of software is an objective fact these defaults can be easily reviewed.\n         // This setting doesn't force the selection of any particular chain but makes validating some faster by\n         //  effectively caching the result of part of the verification.\n-        BlockMap::const_iterator  it = mapBlockIndex.find(hashAssumeValid);\n-        if (it != mapBlockIndex.end()) {\n-            if (it->second->GetAncestor(pindex->nHeight) == pindex &&\n+        const CBlockIndex* pindex_valid = LookupBlockIndex(hashAssumeValid);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r156992400",
      "id" : 156992400,
      "original_commit_id" : "cbff072b60cbf1d092c166fd5cf9d3fe233ed3d0",
      "original_position" : 42,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 83553623,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156992400",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r156995634"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156995634"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This should absolutely be an AssertLockHeld, if anything. If you add the LOCK(cs_main) in the block-index-loading code in init.cpp this should be able to go away.",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2017-12-14T16:36:38Z",
      "diff_hunk" : "@@ -3641,17 +3640,20 @@ CBlockIndex * CChainState::InsertBlockIndex(const uint256& hash)\n     if (hash.IsNull())\n         return nullptr;\n \n+    LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r156995634",
      "id" : 156995634,
      "original_commit_id" : "cbff072b60cbf1d092c166fd5cf9d3fe233ed3d0",
      "original_position" : 115,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 83553623,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156995634",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r156995817"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156995817"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Same here. Can go away with an init.cpp LOCK(cs_main).",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2017-12-14T16:37:18Z",
      "diff_hunk" : "@@ -4230,24 +4236,31 @@ bool LoadExternalBlockFile(const CChainParams& chainparams, FILE* fileIn, CDiskB\n \n                 // detect out of order blocks, and store them for later\n                 uint256 hash = block.GetHash();\n-                if (hash != chainparams.GetConsensus().hashGenesisBlock && mapBlockIndex.find(block.hashPrevBlock) == mapBlockIndex.end()) {\n-                    LogPrint(BCLog::REINDEX, \"%s: Out of order block %s, parent %s not known\\n\", __func__, hash.ToString(),\n-                            block.hashPrevBlock.ToString());\n-                    if (dbp)\n-                        mapBlocksUnknownParent.insert(std::make_pair(block.hashPrevBlock, *dbp));\n-                    continue;\n-                }\n \n-                // process in case the block isn't known yet\n-                if (mapBlockIndex.count(hash) == 0 || (mapBlockIndex[hash]->nStatus & BLOCK_HAVE_DATA) == 0) {\n+                {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r156995817",
      "id" : 156995817,
      "original_commit_id" : "cbff072b60cbf1d092c166fd5cf9d3fe233ed3d0",
      "original_position" : 209,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 83553623,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156995817",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r157355249"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157355249"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Do we want to lock that long?",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2017-12-17T00:55:00Z",
      "diff_hunk" : "@@ -3641,17 +3640,20 @@ CBlockIndex * CChainState::InsertBlockIndex(const uint256& hash)\n     if (hash.IsNull())\n         return nullptr;\n \n+    LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r157355249",
      "id" : 157355249,
      "in_reply_to_id" : 156995634,
      "original_commit_id" : "cbff072b60cbf1d092c166fd5cf9d3fe233ed3d0",
      "original_position" : 115,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 83987578,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157355249",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r157355270"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157355270"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "And why does `CreateWalletFromFile` needs `cs_main`?",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2017-12-17T00:56:47Z",
      "diff_hunk" : "@@ -259,12 +259,12 @@ namespace {\n \n CBlockIndex* FindForkInGlobalIndex(const CChain& chain, const CBlockLocator& locator)\n {\n+    LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r157355270",
      "id" : 157355270,
      "in_reply_to_id" : 156992080,
      "original_commit_id" : "cbff072b60cbf1d092c166fd5cf9d3fe233ed3d0",
      "original_position" : 4,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 83987599,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157355270",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r157357731"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157357731"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hmm, there was some discussion of this in some other PR recently, maybe a @practicalswift PR? In any case, there are a number of things in CreateWalletFromFile that need cs_main (though possibly we want to avoid it and just take it for parts to avoid cs_main during the rescan after #11281), eg chainActive.GetLocator(), chainActive.Genesis (maybe not technically, but probably), FindForkInGlobalIndex, chainActive.Tip(), etc. So definitely worth just taking cs_main there and making this an AssertLockHeld.",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2017-12-17T05:15:36Z",
      "diff_hunk" : "@@ -259,12 +259,12 @@ namespace {\n \n CBlockIndex* FindForkInGlobalIndex(const CChain& chain, const CBlockLocator& locator)\n {\n+    LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r157357731",
      "id" : 157357731,
      "in_reply_to_id" : 156992080,
      "original_commit_id" : "cbff072b60cbf1d092c166fd5cf9d3fe233ed3d0",
      "original_position" : 4,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 83990121,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157357731",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r157357753"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157357753"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It doesnt matter, its early in init long before anything else is going to take cs_main, so taking it should have no impact.",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2017-12-17T05:17:29Z",
      "diff_hunk" : "@@ -3641,17 +3640,20 @@ CBlockIndex * CChainState::InsertBlockIndex(const uint256& hash)\n     if (hash.IsNull())\n         return nullptr;\n \n+    LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r157357753",
      "id" : 157357753,
      "in_reply_to_id" : 156995634,
      "original_commit_id" : "cbff072b60cbf1d092c166fd5cf9d3fe233ed3d0",
      "original_position" : 115,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 83990150,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157357753",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r157363805"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157363805"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It's needed for the assert below (L1502).",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2017-12-17T10:04:33Z",
      "diff_hunk" : "@@ -1487,6 +1492,8 @@ bool AppInitMain(boost::thread_group& threadGroup, CScheduler& scheduler)\n \n                 bool is_coinsview_empty = fReset || fReindexChainState || pcoinsTip->GetBestBlock().IsNull();\n                 if (!is_coinsview_empty) {\n+                    LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r157363805",
      "id" : 157363805,
      "in_reply_to_id" : 156986317,
      "original_commit_id" : "cbff072b60cbf1d092c166fd5cf9d3fe233ed3d0",
      "original_position" : 24,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 83996057,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157363805",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r157363935"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157363935"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'd prefer to avoid special cases for now. Eventually `LookupBlockIndex` will loose `inline`, so do it then?",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2017-12-17T10:11:09Z",
      "diff_hunk" : "@@ -1813,9 +1813,9 @@ bool CChainState::ConnectBlock(const CBlock& block, CValidationState& state, CBl\n         //  relative to a piece of software is an objective fact these defaults can be easily reviewed.\n         // This setting doesn't force the selection of any particular chain but makes validating some faster by\n         //  effectively caching the result of part of the verification.\n-        BlockMap::const_iterator  it = mapBlockIndex.find(hashAssumeValid);\n-        if (it != mapBlockIndex.end()) {\n-            if (it->second->GetAncestor(pindex->nHeight) == pindex &&\n+        const CBlockIndex* pindex_valid = LookupBlockIndex(hashAssumeValid);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r157363935",
      "id" : 157363935,
      "in_reply_to_id" : 156992400,
      "original_commit_id" : "cbff072b60cbf1d092c166fd5cf9d3fe233ed3d0",
      "original_position" : 42,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 83996196,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157363935",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r157364039"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157364039"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't think so, this can be called from RPC. Also, below there is  `ReadBlockFromDisk` and we want to avoid cs_main lock there right?",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2017-12-17T10:16:32Z",
      "diff_hunk" : "@@ -4230,24 +4236,31 @@ bool LoadExternalBlockFile(const CChainParams& chainparams, FILE* fileIn, CDiskB\n \n                 // detect out of order blocks, and store them for later\n                 uint256 hash = block.GetHash();\n-                if (hash != chainparams.GetConsensus().hashGenesisBlock && mapBlockIndex.find(block.hashPrevBlock) == mapBlockIndex.end()) {\n-                    LogPrint(BCLog::REINDEX, \"%s: Out of order block %s, parent %s not known\\n\", __func__, hash.ToString(),\n-                            block.hashPrevBlock.ToString());\n-                    if (dbp)\n-                        mapBlocksUnknownParent.insert(std::make_pair(block.hashPrevBlock, *dbp));\n-                    continue;\n-                }\n \n-                // process in case the block isn't known yet\n-                if (mapBlockIndex.count(hash) == 0 || (mapBlockIndex[hash]->nStatus & BLOCK_HAVE_DATA) == 0) {\n+                {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r157364039",
      "id" : 157364039,
      "in_reply_to_id" : 156995817,
      "original_commit_id" : "cbff072b60cbf1d092c166fd5cf9d3fe233ed3d0",
      "original_position" : 209,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 83996298,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157364039",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r157377812"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157377812"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Looks like you can remove this line now?",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2017-12-17T19:41:00Z",
      "diff_hunk" : "@@ -1487,6 +1492,8 @@ bool AppInitMain(boost::thread_group& threadGroup, CScheduler& scheduler)\n \n                 bool is_coinsview_empty = fReset || fReindexChainState || pcoinsTip->GetBestBlock().IsNull();\n                 if (!is_coinsview_empty) {\n+                    LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r157377812",
      "id" : 157377812,
      "in_reply_to_id" : 156986317,
      "original_commit_id" : "cbff072b60cbf1d092c166fd5cf9d3fe233ed3d0",
      "original_position" : 24,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 84009115,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157377812",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r157378108"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157378108"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: bad spacing here.",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2017-12-17T19:54:05Z",
      "diff_hunk" : "@@ -2762,11 +2762,14 @@ bool ResetBlockFailureFlags(CBlockIndex *pindex) {\n \n CBlockIndex* CChainState::AddToBlockIndex(const CBlockHeader& block)\n {\n+    AssertLockHeld(cs_main);\n+\n     // Check for duplicate\n     uint256 hash = block.GetHash();\n-    BlockMap::iterator it = mapBlockIndex.find(hash);\n-    if (it != mapBlockIndex.end())\n-        return it->second;\n+    CBlockIndex* pindex = LookupBlockIndex(hash);\n+    if (pindex) {\n+      return pindex;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r157378108",
      "id" : 157378108,
      "original_commit_id" : "69bfe5b4356902e1ad76af73158e46f53f8313c2",
      "original_position" : 61,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 84009411,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157378108",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r157378131"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157378131"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "For cases where we are fine with a const CBlockIndex* result, I dont think it matters much, but I'd kinda like to have LookupBlockIndex only return const CBlockIndex*es, so for things like CChainState::AddToBlockIndex, we'd have to partially revert this change then, easier to not do it in the first place IMO.",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2017-12-17T19:55:21Z",
      "diff_hunk" : "@@ -1813,9 +1813,9 @@ bool CChainState::ConnectBlock(const CBlock& block, CValidationState& state, CBl\n         //  relative to a piece of software is an objective fact these defaults can be easily reviewed.\n         // This setting doesn't force the selection of any particular chain but makes validating some faster by\n         //  effectively caching the result of part of the verification.\n-        BlockMap::const_iterator  it = mapBlockIndex.find(hashAssumeValid);\n-        if (it != mapBlockIndex.end()) {\n-            if (it->second->GetAncestor(pindex->nHeight) == pindex &&\n+        const CBlockIndex* pindex_valid = LookupBlockIndex(hashAssumeValid);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r157378131",
      "id" : 157378131,
      "in_reply_to_id" : 156992400,
      "original_commit_id" : "cbff072b60cbf1d092c166fd5cf9d3fe233ed3d0",
      "original_position" : 42,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 84009411,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157378131",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r157378244"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157378244"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hmm, this is gonna conflict partially with #11281. The neccessary refactors seem somewhat unrelated, so I'd be fine with pushing the conflict resolution onto #11281, but if #11281 lands first this is gonna need a bit of tweaking...up to you if you want to do it now.",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2017-12-17T19:59:49Z",
      "diff_hunk" : "@@ -3960,6 +3963,8 @@ CWallet* CWallet::CreateWalletFromFile(const std::string walletFile)\n     // Try to top up keypool. No-op if the wallet is locked.\n     walletInstance->TopUpKeyPool();\n \n+    LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r157378244",
      "id" : 157378244,
      "original_commit_id" : "69bfe5b4356902e1ad76af73158e46f53f8313c2",
      "original_position" : 65,
      "path" : "src/wallet/wallet.cpp",
      "position" : 65,
      "pull_request_review_id" : 84009411,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157378244",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r159353223"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/159353223"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> have LookupBlockIndex only return const CBlockIndex*es\r\n\r\nIf you look closely you will see that a lot of function signatures require non-const `CBlockIndex*`, although a const should do the work (almost?) everywhere. I'm happy to do that in a follow up and deal with the non-const cases there. At least this PR is *complete*.",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2018-01-03T02:13:55Z",
      "diff_hunk" : "@@ -1813,9 +1813,9 @@ bool CChainState::ConnectBlock(const CBlock& block, CValidationState& state, CBl\n         //  relative to a piece of software is an objective fact these defaults can be easily reviewed.\n         // This setting doesn't force the selection of any particular chain but makes validating some faster by\n         //  effectively caching the result of part of the verification.\n-        BlockMap::const_iterator  it = mapBlockIndex.find(hashAssumeValid);\n-        if (it != mapBlockIndex.end()) {\n-            if (it->second->GetAncestor(pindex->nHeight) == pindex &&\n+        const CBlockIndex* pindex_valid = LookupBlockIndex(hashAssumeValid);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r159353223",
      "id" : 159353223,
      "in_reply_to_id" : 156992400,
      "original_commit_id" : "cbff072b60cbf1d092c166fd5cf9d3fe233ed3d0",
      "original_position" : 42,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 86287519,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/159353223",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "THANK YOU!!!!\r\n\r\nOn Jan 2, 2018 8:14 PM, JoÃÂ£o Barbosa <notifications@github.com> wrote:\r\n\r\n@promag commented on this pull request.\r\n\r\n________________________________\r\n\r\nIn src/validation.cpp<https://eur03.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fbitcoin%2Fbitcoin%2Fpull%2F11041%23discussion_r159353223&data=02%7C01%7C%7C07969f713b7c4a64bf1c08d5524fc83b%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C636505424966541060&sdata=uFeOBfvlIXBm%2FB6rVQAizqsjsaBYjNjTFasd0O1t9fM%3D&reserved=0>:\r\n\r\n> @@ -1813,9 +1813,9 @@ bool CChainState::ConnectBlock(const CBlock& block, CValidationState& state, CBl\r\n         //  relative to a piece of software is an objective fact these defaults can be easily reviewed.\r\n         // This setting doesn't force the selection of any particular chain but makes validating some faster by\r\n         //  effectively caching the result of part of the verification.\r\n-        BlockMap::const_iterator  it = mapBlockIndex.find(hashAssumeValid);\r\n-        if (it != mapBlockIndex.end()) {\r\n-            if (it->second->GetAncestor(pindex->nHeight) == pindex &&\r\n+        const CBlockIndex* pindex_valid = LookupBlockIndex(hashAssumeValid);\r\n\r\n\r\nhave LookupBlockIndex only return const CBlockIndex*es\r\n\r\nIf you look closely you will see that a lot of function signatures require non-const CBlockIndex*, although a const should do the work (almost?) everywhere. I'm happy to do that in a follow up and deal with the non-const cases there. At least this PR is complete.\r\n\r\nÃ¢ÂÂ\r\nYou are receiving this because you are subscribed to this thread.\r\nReply to this email directly, view it on GitHub<https://eur03.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fbitcoin%2Fbitcoin%2Fpull%2F11041%23discussion_r159353223&data=02%7C01%7C%7C07969f713b7c4a64bf1c08d5524fc83b%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C636505424966541060&sdata=uFeOBfvlIXBm%2FB6rVQAizqsjsaBYjNjTFasd0O1t9fM%3D&reserved=0>, or mute the thread<https://eur03.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fnotifications%2Funsubscribe-auth%2FAcUokexod85ks_VwyfWFwJb-CWtwp6Yzks5tGuKdgaJpZM4O1uuo&data=02%7C01%7C%7C07969f713b7c4a64bf1c08d5524fc83b%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C636505424966541060&sdata=4vqTQBaLyCkFc%2B%2FyGffW7dO2nTt%2Bf%2Bid1UT5TAdm93U%3D&reserved=0>.\r\n\r\n",
      "created_at" : "2018-01-03T02:38:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#issuecomment-354926682",
      "id" : 354926682,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11041",
      "updated_at" : "2018-01-03T02:38:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/354926682",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/29698193?v=4",
         "events_url" : "https://api.github.com/users/markaw67/events{/privacy}",
         "followers_url" : "https://api.github.com/users/markaw67/followers",
         "following_url" : "https://api.github.com/users/markaw67/following{/other_user}",
         "gists_url" : "https://api.github.com/users/markaw67/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/markaw67",
         "id" : 29698193,
         "login" : "markaw67",
         "organizations_url" : "https://api.github.com/users/markaw67/orgs",
         "received_events_url" : "https://api.github.com/users/markaw67/received_events",
         "repos_url" : "https://api.github.com/users/markaw67/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/markaw67/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/markaw67/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/markaw67"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r161032172"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161032172"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This should be in a separate commit.",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2018-01-11T18:08:10Z",
      "diff_hunk" : "@@ -1408,6 +1408,8 @@ bool AppInitMain(boost::thread_group& threadGroup, CScheduler& scheduler)\n \n         uiInterface.InitMessage(_(\"Loading block index...\"));\n \n+        LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r161032172",
      "id" : 161032172,
      "original_commit_id" : "77cc5b7f3dd1c663d6a16946563c7b59d0b3184a",
      "original_position" : 4,
      "path" : "src/init.cpp",
      "position" : 4,
      "pull_request_review_id" : 88255338,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161032172",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r161036192"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161036192"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This could go in a separate commit.",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2018-01-11T18:24:33Z",
      "diff_hunk" : "@@ -260,12 +260,12 @@ namespace {\n \n CBlockIndex* FindForkInGlobalIndex(const CChain& chain, const CBlockLocator& locator)\n {\n+    AssertLockHeld(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r161036192",
      "id" : 161036192,
      "original_commit_id" : "77cc5b7f3dd1c663d6a16946563c7b59d0b3184a",
      "original_position" : 4,
      "path" : "src/validation.cpp",
      "position" : 4,
      "pull_request_review_id" : 88255338,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161036192",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r161036661"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161036661"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Making everything const isnt so hard, see #10692, which did it mostly in scripted-diffs.",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2018-01-11T18:26:17Z",
      "diff_hunk" : "@@ -1813,9 +1813,9 @@ bool CChainState::ConnectBlock(const CBlock& block, CValidationState& state, CBl\n         //  relative to a piece of software is an objective fact these defaults can be easily reviewed.\n         // This setting doesn't force the selection of any particular chain but makes validating some faster by\n         //  effectively caching the result of part of the verification.\n-        BlockMap::const_iterator  it = mapBlockIndex.find(hashAssumeValid);\n-        if (it != mapBlockIndex.end()) {\n-            if (it->second->GetAncestor(pindex->nHeight) == pindex &&\n+        const CBlockIndex* pindex_valid = LookupBlockIndex(hashAssumeValid);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r161036661",
      "id" : 161036661,
      "in_reply_to_id" : 156992400,
      "original_commit_id" : "cbff072b60cbf1d092c166fd5cf9d3fe233ed3d0",
      "original_position" : 42,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 88255338,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161036661",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r161036940"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161036940"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Again, please do not use LookupBlockIndex here (and a few other places). If the next step is to make LookupBlockIndex return a const CBlockIndex* (which I think it clearly is), this part of the patch just has to get reverted. There is no reason to avoid using mapBlockIndex in CChainState members, that's what CChainState is there for :).",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2018-01-11T18:27:19Z",
      "diff_hunk" : "@@ -2772,11 +2772,14 @@ bool ResetBlockFailureFlags(CBlockIndex *pindex) {\n \n CBlockIndex* CChainState::AddToBlockIndex(const CBlockHeader& block)\n {\n+    AssertLockHeld(cs_main);\n+\n     // Check for duplicate\n     uint256 hash = block.GetHash();\n-    BlockMap::iterator it = mapBlockIndex.find(hash);\n-    if (it != mapBlockIndex.end())\n-        return it->second;\n+    CBlockIndex* pindex = LookupBlockIndex(hash);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r161036940",
      "id" : 161036940,
      "original_commit_id" : "77cc5b7f3dd1c663d6a16946563c7b59d0b3184a",
      "original_position" : 59,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 88255338,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161036940",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r161108308"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161108308"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> There is no reason to avoid using mapBlockIndex in CChainState members, that's what CChainState is there for\r\n\r\nAt that point there can be `CBlockIndex* CChainState::LookupBlockIndex()`?",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2018-01-11T23:50:14Z",
      "diff_hunk" : "@@ -2772,11 +2772,14 @@ bool ResetBlockFailureFlags(CBlockIndex *pindex) {\n \n CBlockIndex* CChainState::AddToBlockIndex(const CBlockHeader& block)\n {\n+    AssertLockHeld(cs_main);\n+\n     // Check for duplicate\n     uint256 hash = block.GetHash();\n-    BlockMap::iterator it = mapBlockIndex.find(hash);\n-    if (it != mapBlockIndex.end())\n-        return it->second;\n+    CBlockIndex* pindex = LookupBlockIndex(hash);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r161108308",
      "id" : 161108308,
      "in_reply_to_id" : 161036940,
      "original_commit_id" : "77cc5b7f3dd1c663d6a16946563c7b59d0b3184a",
      "original_position" : 59,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 88344653,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161108308",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r161117840"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161117840"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2018-01-12T01:00:20Z",
      "diff_hunk" : "@@ -1408,6 +1408,8 @@ bool AppInitMain(boost::thread_group& threadGroup, CScheduler& scheduler)\n \n         uiInterface.InitMessage(_(\"Loading block index...\"));\n \n+        LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r161117840",
      "id" : 161117840,
      "in_reply_to_id" : 161032172,
      "original_commit_id" : "77cc5b7f3dd1c663d6a16946563c7b59d0b3184a",
      "original_position" : 4,
      "path" : "src/init.cpp",
      "position" : 4,
      "pull_request_review_id" : 88355502,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161117840",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r161117847"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161117847"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2018-01-12T01:00:23Z",
      "diff_hunk" : "@@ -260,12 +260,12 @@ namespace {\n \n CBlockIndex* FindForkInGlobalIndex(const CChain& chain, const CBlockLocator& locator)\n {\n+    AssertLockHeld(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r161117847",
      "id" : 161117847,
      "in_reply_to_id" : 161036192,
      "original_commit_id" : "77cc5b7f3dd1c663d6a16946563c7b59d0b3184a",
      "original_position" : 4,
      "path" : "src/validation.cpp",
      "position" : 4,
      "pull_request_review_id" : 88355511,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161117847",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r161406243"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161406243"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why? I see no reason to have a LookupBlockIndex at all *except* to avoid exposing mapBlockIndex/non-const CBlockIndexes outside of CChainState/validation.cpp. If we're inside of CChainState, doing a LookupBlockIndex only serves to add needless indirection.",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2018-01-14T18:42:14Z",
      "diff_hunk" : "@@ -2772,11 +2772,14 @@ bool ResetBlockFailureFlags(CBlockIndex *pindex) {\n \n CBlockIndex* CChainState::AddToBlockIndex(const CBlockHeader& block)\n {\n+    AssertLockHeld(cs_main);\n+\n     // Check for duplicate\n     uint256 hash = block.GetHash();\n-    BlockMap::iterator it = mapBlockIndex.find(hash);\n-    if (it != mapBlockIndex.end())\n-        return it->second;\n+    CBlockIndex* pindex = LookupBlockIndex(hash);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r161406243",
      "id" : 161406243,
      "in_reply_to_id" : 161036940,
      "original_commit_id" : "77cc5b7f3dd1c663d6a16946563c7b59d0b3184a",
      "original_position" : 59,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 88690866,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/161406243",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Again, please do not use LookupBlockIndex here (and a few other places).\r\n\r\nAs requested, last commit reverts changes to `CChainState`. Please review.",
      "created_at" : "2018-01-15T15:30:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#issuecomment-357714509",
      "id" : 357714509,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11041",
      "updated_at" : "2018-01-15T15:30:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/357714509",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks @ryanofsky.",
      "created_at" : "2018-02-05T22:30:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#issuecomment-363243529",
      "id" : 363243529,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11041",
      "updated_at" : "2018-02-05T22:30:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/363243529",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r172623597"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172623597"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: `CBlockIndex* pindex`",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2018-03-06T18:59:01Z",
      "diff_hunk" : "@@ -401,9 +401,8 @@ UniValue getblocktemplate(const JSONRPCRequest& request)\n                 throw JSONRPCError(RPC_DESERIALIZATION_ERROR, \"Block decode failed\");\n \n             uint256 hash = block.GetHash();\n-            BlockMap::iterator mi = mapBlockIndex.find(hash);\n-            if (mi != mapBlockIndex.end()) {\n-                CBlockIndex *pindex = mi->second;\n+            const CBlockIndex *pindex = LookupBlockIndex(hash);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r172623597",
      "id" : 172623597,
      "original_commit_id" : "18144408b67debb5c276c3f3f4a3fff05e881f35",
      "original_position" : 7,
      "path" : "src/rpc/mining.cpp",
      "position" : null,
      "pull_request_review_id" : 101672770,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172623597",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r172623642"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172623642"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: `CBlockIndex* pindex`",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2018-03-06T18:59:08Z",
      "diff_hunk" : "@@ -732,9 +731,8 @@ UniValue submitblock(const JSONRPCRequest& request)\n     bool fBlockPresent = false;\n     {\n         LOCK(cs_main);\n-        BlockMap::iterator mi = mapBlockIndex.find(hash);\n-        if (mi != mapBlockIndex.end()) {\n-            CBlockIndex *pindex = mi->second;\n+        const CBlockIndex *pindex = LookupBlockIndex(hash);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r172623642",
      "id" : 172623642,
      "original_commit_id" : "18144408b67debb5c276c3f3f4a3fff05e881f35",
      "original_position" : 19,
      "path" : "src/rpc/mining.cpp",
      "position" : null,
      "pull_request_review_id" : 101672770,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172623642",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r172623750"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172623750"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: `CBlockIndex* pindex`",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2018-03-06T18:59:33Z",
      "diff_hunk" : "@@ -748,9 +746,9 @@ UniValue submitblock(const JSONRPCRequest& request)\n \n     {\n         LOCK(cs_main);\n-        BlockMap::iterator mi = mapBlockIndex.find(block.hashPrevBlock);\n-        if (mi != mapBlockIndex.end()) {\n-            UpdateUncommittedBlockStructures(block, mi->second, Params().GetConsensus());\n+        const CBlockIndex *pindex = LookupBlockIndex(block.hashPrevBlock);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r172623750",
      "id" : 172623750,
      "original_commit_id" : "18144408b67debb5c276c3f3f4a3fff05e881f35",
      "original_position" : 31,
      "path" : "src/rpc/mining.cpp",
      "position" : null,
      "pull_request_review_id" : 101672770,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172623750",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r172625597"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172625597"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I didn't know you could declare inside an if statement. Cool.",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2018-03-06T19:05:38Z",
      "diff_hunk" : "@@ -3793,7 +3791,8 @@ unsigned int CWallet::ComputeTimeSmart(const CWalletTx& wtx) const\n {\n     unsigned int nTimeSmart = wtx.nTimeReceived;\n     if (!wtx.hashUnset()) {\n-        if (mapBlockIndex.count(wtx.hashBlock)) {\n+        const CBlockIndex* pindex = LookupBlockIndex(wtx.hashBlock);\n+        if (pindex) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r172625597",
      "id" : 172625597,
      "in_reply_to_id" : 148586107,
      "original_commit_id" : "1d1768f2978bafaf166bfa218c899ddaeeccad2d",
      "original_position" : 44,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 101672770,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-06T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172625597",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased.\r\n\r\n@kallewoof why drop `const` qualifier?",
      "created_at" : "2018-03-06T19:30:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#issuecomment-370899472",
      "id" : 370899472,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11041",
      "updated_at" : "2018-03-06T19:30:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370899472",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@promag Sorry, I only meant \"move the `*`\"",
      "created_at" : "2018-03-06T19:41:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#issuecomment-370903133",
      "id" : 370903133,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11041",
      "updated_at" : "2018-03-06T19:41:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370903133",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@kallewoof no problem, done.",
      "created_at" : "2018-03-06T19:52:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#issuecomment-370906413",
      "id" : 370906413,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11041",
      "updated_at" : "2018-03-06T19:52:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370906413",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 92fabcd",
      "created_at" : "2018-03-06T19:57:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#issuecomment-370907962",
      "id" : 370907962,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11041",
      "updated_at" : "2018-03-06T19:57:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370907962",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "utACK 92fabcd443322dcfdf2b3477515fae79e8647d86. No changes since last review except rebase and squash.\r\n",
      "created_at" : "2018-03-12T21:29:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#issuecomment-372468972",
      "id" : 372468972,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11041",
      "updated_at" : "2018-03-12T21:29:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/372468972",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r174305214"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174305214"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think this new lock is causing test failures on master. If I run\r\n\r\n```\r\n./configure --enable-debug\r\nmake -j12 -C src test/test_bitcoin && src/test/test_bitcoin --log_level=test_suite --run_test=wallet_tests/ComputeTimeSmart\r\n```\r\n\r\nI see:\r\n\r\n```\r\nEntering test case \"ComputeTimeSmart\"\r\ntest_bitcoin: sync.cpp:100: void potential_deadlock_detected(const std::pair<void*, void*>&, const LockStack&, const LockStack&): Assertion `false' failed.\r\nunknown location(0): fatal error in \"ComputeTimeSmart\": signal: SIGABRT (application abort requested)\r\nwallet/test/wallet_tests.cpp(566): last checkpoint\r\n```\r\n\r\nThe problem is that ComputeTimeSmart is called by CWallet::AddToWallet, which only acquires cs_wallet, so cs_main will wind up being acquired after cs_wallet during the test.",
      "commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "created_at" : "2018-03-13T22:29:32Z",
      "diff_hunk" : "@@ -3816,7 +3814,12 @@ unsigned int CWallet::ComputeTimeSmart(const CWalletTx& wtx) const\n {\n     unsigned int nTimeSmart = wtx.nTimeReceived;\n     if (!wtx.hashUnset()) {\n-        if (mapBlockIndex.count(wtx.hashBlock)) {\n+        const CBlockIndex* pindex = nullptr;\n+        {\n+            LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#discussion_r174305214",
      "id" : 174305214,
      "original_commit_id" : "92fabcd443322dcfdf2b3477515fae79e8647d86",
      "original_position" : 45,
      "path" : "src/wallet/wallet.cpp",
      "position" : 45,
      "pull_request_review_id" : 103637481,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11041",
      "updated_at" : "2018-03-13T22:43:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174305214",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@promag What's the reason for avoiding mapBlockIndex lookups?",
      "created_at" : "2021-05-11T10:23:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#issuecomment-838225751",
      "id" : 838225751,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11041",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgzODIyNTc1MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-11T10:23:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/838225751",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=4",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "node_id" : "MDQ6VXNlcjE1MzAyODM=",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@rebroad it avoids duplicate lookups - its unnecessary work.",
      "created_at" : "2021-05-11T12:05:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11041#issuecomment-838355450",
      "id" : 838355450,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11041",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgzODM1NTQ1MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-11T12:05:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/838355450",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   }
]
