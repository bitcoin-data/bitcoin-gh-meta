[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This builds on top of #19031, adding one more commit to complete the [TORv3 puzzle](https://github.com/bitcoin/bitcoin/issues/18884). The dependency to #19031 is because if we create a TORv3 hidden service before #19031 is merged we will not be able to advertise it by gossiping. So, this PR is draft until all of #19031 is merged. Available for early review and testing.",
      "created_at" : "2020-09-14T13:46:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-692063434",
      "id" : 692063434,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5MjA2MzQzNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-14T13:49:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/692063434",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r488028133"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/488028133"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Linter fails on missing newline here.\r\n```\r\n$ test/lint/lint-logs.sh\r\nAll calls to LogPrintf() and LogPrint() should be terminated with \\n\r\n```",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-09-14T15:33:21Z",
      "diff_hunk" : "@@ -464,10 +466,23 @@ TorController::TorController(struct event_base* _base, const std::string& _targe\n         LogPrintf(\"tor: Initiating connection to Tor control port %s failed\\n\", _target);\n     }\n     // Read service private key if cached\n-    std::pair<bool,std::string> pkf = ReadBinaryFile(GetPrivateKeyFile());\n-    if (pkf.first) {\n-        LogPrint(BCLog::TOR, \"tor: Reading cached private key from %s\\n\", GetPrivateKeyFile().string());\n-        private_key = pkf.second;\n+    bool read_ok;\n+    std::tie(read_ok, private_key) = ReadBinaryFile(GetPrivateKeyFile());\n+    if (!read_ok) {\n+        return;\n+    }\n+    LogPrint(BCLog::TOR, \"tor: Read cached private key from %s\\n\", GetPrivateKeyFile().string());\n+\n+    // Check if we have an old TORv2 (RSA1024) private key cached and if so move it\n+    // away and assume empty key so that TorController::auth_cb() can create a new\n+    // TORv3 (ED25519-V3) one.\n+    static const char torv2_key_prefix[] = \"RSA1024:\";\n+    if (private_key.substr(0, strlen(torv2_key_prefix)) == torv2_key_prefix) {\n+        auto obsolete_key_file = GetPrivateKeyFile().string() + \"_obsolete_torv2\";\n+        LogPrint(BCLog::TOR, \"tor: Detected an obsolete TORv2 private key, will move it \"\n+                             \"to %s and will create new TORv3 one\\n\", obsolete_key_file);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r488028133",
      "id" : 488028133,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODAyODEzMw==",
      "original_commit_id" : "9c9ff0a8c40421b43922a6b211f99b6aaf94a798",
      "original_line" : 483,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/torcontrol.cpp",
      "position" : null,
      "pull_request_review_id" : 487897429,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/488028133",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r488055752"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/488055752"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: gossiping",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-09-14T16:13:17Z",
      "diff_hunk" : "@@ -76,6 +76,19 @@ extern const char* VERACK;\n  * network.\n  */\n extern const char* ADDR;\n+/**\n+ * The addrv2 message relays connection information for peers on the network just\n+ * like the addr message, but is extended to allow gossipping of longer node",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r488055752",
      "id" : 488055752,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA1NTc1Mg==",
      "original_commit_id" : "a1b067e0896d5f8a639364494a5707bd536b99f1",
      "original_line" : 81,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/protocol.h",
      "position" : null,
      "pull_request_review_id" : 487933729,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/488055752",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r488057593"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/488057593"
         }
      },
      "author_association" : "MEMBER",
      "body" : "s/who has indicated ADDRv2 support (has sent SENDADDRV2 himself)/that has signaled ADDRv2 support by sending SENDADDRv2./",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-09-14T16:15:57Z",
      "diff_hunk" : "@@ -76,6 +76,19 @@ extern const char* VERACK;\n  * network.\n  */\n extern const char* ADDR;\n+/**\n+ * The addrv2 message relays connection information for peers on the network just\n+ * like the addr message, but is extended to allow gossipping of longer node\n+ * addresses (see BIP155).\n+ */\n+extern const char *ADDRv2;\n+/**\n+ * The sendaddrv2 message signals support for receiving ADDRv2 messages (BIP155).\n+ * It also implies that its sender can encode as ADDRv2 and would send ADDRv2\n+ * instead of ADDR to a peer who has indicated ADDRv2 support (has sent\n+ * SENDADDRv2 himself).",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r488057593",
      "id" : 488057593,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA1NzU5Mw==",
      "original_commit_id" : "a1b067e0896d5f8a639364494a5707bd536b99f1",
      "original_line" : 89,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/protocol.h",
      "position" : null,
      "pull_request_review_id" : 487933729,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/488057593",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Can we also add the option to delete `onion_private_key` and `onion_private_key_obsolete_torv2`automatically every time bitcoind is restarted? So that it gets new address each time.\r\n\r\nOr is it something out of scope for this PR and will need a new issue or PR to discuss?",
      "created_at" : "2020-09-14T17:45:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-692210055",
      "id" : 692210055,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5MjIxMDA1NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-14T17:45:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/692210055",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@prayank23 It can take a (very) long time for a node's rumoured address to be picked up, especially Tor ones. Getting a new one every time you restart your node is probably a good way to never get any incoming connections at all.\n\nIt may be useful as an optional feature, but seems out of scope here.",
      "created_at" : "2020-09-14T17:47:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-692211498",
      "id" : 692211498,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5MjIxMTQ5OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-14T17:48:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/692211498",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@prayank23\r\n>  Can we also add the option to delete `onion_private_key` and `onion_private_key_obsolete_torv2`automatically every time bitcoind is restarted? So that it gets new address each time.\r\n\r\n> \r\ntyi; #19635 we probably will need that in some form for v3 anyway.  \r\n\r\n\r\n",
      "created_at" : "2020-09-14T18:32:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-692235271",
      "id" : 692235271,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5MjIzNTI3MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-14T18:32:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/692235271",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/34917548?v=4",
         "events_url" : "https://api.github.com/users/Saibato/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Saibato/followers",
         "following_url" : "https://api.github.com/users/Saibato/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Saibato/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Saibato",
         "id" : 34917548,
         "login" : "Saibato",
         "node_id" : "MDQ6VXNlcjM0OTE3NTQ4",
         "organizations_url" : "https://api.github.com/users/Saibato/orgs",
         "received_events_url" : "https://api.github.com/users/Saibato/received_events",
         "repos_url" : "https://api.github.com/users/Saibato/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Saibato/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Saibato/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Saibato"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thinking about migration, as a follow-up before release we may need a temporary configuration option to use tor v2/v3. \n\nPerhaps begin with v3 as opt-in, then in the following release look at making it the default.",
      "created_at" : "2020-09-15T06:06:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-692487080",
      "id" : 692487080,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5MjQ4NzA4MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-15T06:06:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/692487080",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r488870384"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/488870384"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'd slightly prefer creating a new file for v3 instead of moving the old one. This makes it easier to go back and forth to test this (as well as downgrade, when this becomes part of a release).\r\n\r\nIt also makes for amore straightforward path to both v2 and v3 hidden services (as @jonatack suggests).",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-09-15T18:16:30Z",
      "diff_hunk" : "@@ -57,6 +57,7 @@ Subdirectory       | File(s)               | Description\n `./`               | `guisettings.ini.bak` | Backup of former [GUI settings](#gui-settings) after `-resetguisettings` option is used\n `./`               | `mempool.dat`         | Dump of the mempool's transactions\n `./`               | `onion_private_key`   | Cached Tor onion service private key for `-listenonion` option\n+`./`               | `onion_private_key_obsolete_torv2` | Obsolete Tor onion service private key used to create TORv2 hidden services. This file is automatically created as a backup when new TORv3 private key is generated and saved into `onion_private_key`. Bitcoin Core does not need it and will never attempt to read it. Remove if you do not need the old TORv2 hidden service.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r488870384",
      "id" : 488870384,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg3MDM4NA==",
      "original_commit_id" : "9c9ff0a8c40421b43922a6b211f99b6aaf94a798",
      "original_line" : 60,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "doc/files.md",
      "position" : null,
      "pull_request_review_id" : 488944513,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/488870384",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@prayank23 \r\n\r\n> Can we also add the option to delete onion_private_key and onion_private_key_obsolete_torv2automatically every time bitcoind is restarted? So that it gets new address each time.\r\n\r\nYes, but out of scope here. There's an issue for this already: #17491.",
      "created_at" : "2020-09-15T18:18:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-692889834",
      "id" : 692889834,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5Mjg4OTgzNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-15T21:30:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/692889834",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@laanwj \r\n> I'd slightly prefer creating a new file for v3 instead \r\n\r\n@vasild \r\nFeel free to grab there, then i can close that PR \r\n\r\nhttps://github.com/bitcoin/bitcoin/pull/19485\r\n\r\n ",
      "created_at" : "2020-09-15T19:29:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-692929925",
      "id" : 692929925,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5MjkyOTkyNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-15T19:31:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/692929925",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/34917548?v=4",
         "events_url" : "https://api.github.com/users/Saibato/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Saibato/followers",
         "following_url" : "https://api.github.com/users/Saibato/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Saibato/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Saibato",
         "id" : 34917548,
         "login" : "Saibato",
         "node_id" : "MDQ6VXNlcjM0OTE3NTQ4",
         "organizations_url" : "https://api.github.com/users/Saibato/orgs",
         "received_events_url" : "https://api.github.com/users/Saibato/received_events",
         "repos_url" : "https://api.github.com/users/Saibato/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Saibato/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Saibato/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Saibato"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "utACK 9c9ff0a8c40421b43922a6b211f99b6aaf94a798. Light code review, code looks great, apart from several uses of `char name[1025]` which seem a bit clunky (oops, just noticed this nit was a refactor and not an addition, am okay with no change). Will need to fire up a test build. Nice work!",
      "created_at" : "2020-09-16T07:05:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-693216828",
      "id" : 693216828,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5MzIxNjgyOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-16T07:08:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/693216828",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/8435003?v=4",
         "events_url" : "https://api.github.com/users/tryphe/events{/privacy}",
         "followers_url" : "https://api.github.com/users/tryphe/followers",
         "following_url" : "https://api.github.com/users/tryphe/following{/other_user}",
         "gists_url" : "https://api.github.com/users/tryphe/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/tryphe",
         "id" : 8435003,
         "login" : "tryphe",
         "node_id" : "MDQ6VXNlcjg0MzUwMDM=",
         "organizations_url" : "https://api.github.com/users/tryphe/orgs",
         "received_events_url" : "https://api.github.com/users/tryphe/received_events",
         "repos_url" : "https://api.github.com/users/tryphe/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/tryphe/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/tryphe/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/tryphe"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, I share Wladimir's preference for \"creating a new file for v3 instead of moving the old one\". Plus it'll make this change even smaller.\r\n\r\n> Perhaps begin with v3 as opt-in, then in the following release look at making it the default.\r\n\r\nGiven that v2 is deprecated I don't think v3 needs to be opt-in, at least not for new users.\r\n\r\nExisting users might rely on a static v2 address, e.g. because they have another node connected to it, or they paired it with some remote control software. Afaik this only applies to bitcoind users, not QT (unless @luke-jr implemented pairing in Knots?). So this change needs some emphasis in the release notes.\r\n\r\nWe could add an (instantly deprecated) option `-listenonion_v2`.",
      "created_at" : "2020-09-17T11:52:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-694180511",
      "id" : 694180511,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5NDE4MDUxMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-17T11:54:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/694180511",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r490922645"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/490922645"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-09-18T12:44:01Z",
      "diff_hunk" : "@@ -76,6 +76,19 @@ extern const char* VERACK;\n  * network.\n  */\n extern const char* ADDR;\n+/**\n+ * The addrv2 message relays connection information for peers on the network just\n+ * like the addr message, but is extended to allow gossipping of longer node",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r490922645",
      "id" : 490922645,
      "in_reply_to_id" : 488055752,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDkyMjY0NQ==",
      "original_commit_id" : "a1b067e0896d5f8a639364494a5707bd536b99f1",
      "original_line" : 81,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/protocol.h",
      "position" : null,
      "pull_request_review_id" : 491429443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/490922645",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r490922857"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/490922857"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Changed.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-09-18T12:44:23Z",
      "diff_hunk" : "@@ -76,6 +76,19 @@ extern const char* VERACK;\n  * network.\n  */\n extern const char* ADDR;\n+/**\n+ * The addrv2 message relays connection information for peers on the network just\n+ * like the addr message, but is extended to allow gossipping of longer node\n+ * addresses (see BIP155).\n+ */\n+extern const char *ADDRv2;\n+/**\n+ * The sendaddrv2 message signals support for receiving ADDRv2 messages (BIP155).\n+ * It also implies that its sender can encode as ADDRv2 and would send ADDRv2\n+ * instead of ADDR to a peer who has indicated ADDRv2 support (has sent\n+ * SENDADDRv2 himself).",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r490922857",
      "id" : 490922857,
      "in_reply_to_id" : 488057593,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDkyMjg1Nw==",
      "original_commit_id" : "a1b067e0896d5f8a639364494a5707bd536b99f1",
      "original_line" : 89,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/protocol.h",
      "position" : null,
      "pull_request_review_id" : 491429688,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/490922857",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r490923255"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/490923255"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Deleted this code altogether.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-09-18T12:45:03Z",
      "diff_hunk" : "@@ -464,10 +466,23 @@ TorController::TorController(struct event_base* _base, const std::string& _targe\n         LogPrintf(\"tor: Initiating connection to Tor control port %s failed\\n\", _target);\n     }\n     // Read service private key if cached\n-    std::pair<bool,std::string> pkf = ReadBinaryFile(GetPrivateKeyFile());\n-    if (pkf.first) {\n-        LogPrint(BCLog::TOR, \"tor: Reading cached private key from %s\\n\", GetPrivateKeyFile().string());\n-        private_key = pkf.second;\n+    bool read_ok;\n+    std::tie(read_ok, private_key) = ReadBinaryFile(GetPrivateKeyFile());\n+    if (!read_ok) {\n+        return;\n+    }\n+    LogPrint(BCLog::TOR, \"tor: Read cached private key from %s\\n\", GetPrivateKeyFile().string());\n+\n+    // Check if we have an old TORv2 (RSA1024) private key cached and if so move it\n+    // away and assume empty key so that TorController::auth_cb() can create a new\n+    // TORv3 (ED25519-V3) one.\n+    static const char torv2_key_prefix[] = \"RSA1024:\";\n+    if (private_key.substr(0, strlen(torv2_key_prefix)) == torv2_key_prefix) {\n+        auto obsolete_key_file = GetPrivateKeyFile().string() + \"_obsolete_torv2\";\n+        LogPrint(BCLog::TOR, \"tor: Detected an obsolete TORv2 private key, will move it \"\n+                             \"to %s and will create new TORv3 one\\n\", obsolete_key_file);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r490923255",
      "id" : 490923255,
      "in_reply_to_id" : 488028133,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDkyMzI1NQ==",
      "original_commit_id" : "9c9ff0a8c40421b43922a6b211f99b6aaf94a798",
      "original_line" : 483,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/torcontrol.cpp",
      "position" : null,
      "pull_request_review_id" : 491430132,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/490923255",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r490923656"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/490923656"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Indeed. Done!",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-09-18T12:45:45Z",
      "diff_hunk" : "@@ -57,6 +57,7 @@ Subdirectory       | File(s)               | Description\n `./`               | `guisettings.ini.bak` | Backup of former [GUI settings](#gui-settings) after `-resetguisettings` option is used\n `./`               | `mempool.dat`         | Dump of the mempool's transactions\n `./`               | `onion_private_key`   | Cached Tor onion service private key for `-listenonion` option\n+`./`               | `onion_private_key_obsolete_torv2` | Obsolete Tor onion service private key used to create TORv2 hidden services. This file is automatically created as a backup when new TORv3 private key is generated and saved into `onion_private_key`. Bitcoin Core does not need it and will never attempt to read it. Remove if you do not need the old TORv2 hidden service.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r490923656",
      "id" : 490923656,
      "in_reply_to_id" : 488870384,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDkyMzY1Ng==",
      "original_commit_id" : "9c9ff0a8c40421b43922a6b211f99b6aaf94a798",
      "original_line" : 60,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "doc/files.md",
      "position" : null,
      "pull_request_review_id" : 491430653,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/490923656",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased on latest #19031 and addressed suggestions.\r\n\r\nIndeed creating a new file for the new TORv3 private key seems like a better idea. It also opens up a possibility for the users to continue using the old TORv2 service if needed by copying the contents of the old file to the new file.\r\n\r\nI think Bitcoin Core automatically creating just one Tor service is enough (that will be v3). If more complicated setup is needed, then the users can create static services in the Tor daemon - e.g. it is possible to create 5 TORv2 services and 7 TORv3 services all pointing to the same Bitcoin Core.",
      "created_at" : "2020-09-18T12:59:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-694852846",
      "id" : 694852846,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5NDg1Mjg0Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-18T12:59:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/694852846",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Practical testing of this PR with various Tor configuration options by and between @vasild and I today. Will review this weekend.",
      "created_at" : "2020-09-18T18:15:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-695014269",
      "id" : 695014269,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5NTAxNDI2OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-18T18:17:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/695014269",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19889 (test: Add consistent formatting for messages.py repr methods by adaminsky)\n* #19315 ([tests] Allow outbound & block-relay-only connections in functional tests. by amitiuttarwar)\n* #19238 (refactor: Replace RecursiveMutex with Mutex in CAddrMan by hebasto)\n* #18788 (tests: Update more tests to work with descriptor wallets by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-09-19T13:33:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-695214133",
      "id" : 695214133,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5NTIxNDEzMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-02T20:13:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/695214133",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r492108245"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/492108245"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: add `{`",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-09-21T14:49:11Z",
      "diff_hunk" : "@@ -533,7 +533,7 @@ void TorController::auth_cb(TorControlConnection& _conn, const TorControlReply&\n \n         // Finally - now create the service\n         if (private_key.empty()) // No private key, generate one",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r492108245",
      "id" : 492108245,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjEwODI0NQ==",
      "original_commit_id" : "1550aa82659506ef89db67e482d01f014f6a1977",
      "original_line" : 535,
      "original_position" : 3,
      "original_start_line" : null,
      "path" : "src/torcontrol.cpp",
      "position" : null,
      "pull_request_review_id" : 492690290,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/492108245",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I think Bitcoin Core automatically creating just one Tor service is enough (that will be v3). \r\n\r\nThe only worry here would be that old nodes will run out of Tor nodes to connect to. But I don't know. I'm okay with this, it seems there's enough hurry to transition here that backwards compatibility concerns like that are mostly moot.\r\n\r\nEdit: a related concern is that we should start hardcoding TorV3 peers. No need to do so in this PR though. Made a note about this in #17020.",
      "created_at" : "2020-09-23T12:11:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-697322694",
      "id" : 697322694,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5NzMyMjY5NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-23T12:14:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/697322694",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r493521433"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/493521433"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe move this line to `## Legacy subdirectories and files`, if we're no longer going to spin up a v2 service.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-09-23T12:19:32Z",
      "diff_hunk" : "@@ -56,7 +56,8 @@ Subdirectory       | File(s)               | Description\n `./`               | `fee_estimates.dat`   | Stores statistics used to estimate minimum transaction fees and priorities required for confirmation\n `./`               | `guisettings.ini.bak` | Backup of former [GUI settings](#gui-settings) after `-resetguisettings` option is used\n `./`               | `mempool.dat`         | Dump of the mempool's transactions\n-`./`               | `onion_private_key`   | Cached Tor onion service private key for `-listenonion` option\n+`./`               | `onion_private_key`   | Obsolete: cached Tor onion service private key for `-listenonion` option. Was used for TORv2 services. Bitcoin Core does not need this file and ignores it starting from version 0.21.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r493521433",
      "id" : 493521433,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUyMTQzMw==",
      "original_commit_id" : "1550aa82659506ef89db67e482d01f014f6a1977",
      "original_line" : 59,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "doc/files.md",
      "position" : null,
      "pull_request_review_id" : 494597269,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/493521433",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r493535027"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/493535027"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good, looks ilke we already have an implementation of `be16toh` in `src/compat/endian.h`, so it doesn't need to be added.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-09-23T12:34:08Z",
      "diff_hunk" : "@@ -53,6 +53,13 @@ void static inline WriteLE64(unsigned char* ptr, uint64_t x)\n     memcpy(ptr, (char*)&v, 8);\n }\n \n+uint16_t static inline ReadBE16(const unsigned char* ptr)\n+{\n+    uint16_t x;\n+    memcpy((char*)&x, ptr, 2);\n+    return be16toh(x);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r493535027",
      "id" : 493535027,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUzNTAyNw==",
      "original_commit_id" : "1550aa82659506ef89db67e482d01f014f6a1977",
      "original_line" : 60,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/crypto/common.h",
      "position" : null,
      "pull_request_review_id" : 494609645,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/493535027",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r494932190"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/494932190"
         }
      },
      "author_association" : "MEMBER",
      "body" : "1550aa8 suggestions\r\n\r\n- s/TOR/Tor / throughout, e.g. TORv2 -> Tor v2 -- the Tor project even tweeted recently to the community to please write \"Tor\" rather than \"TOR\"\r\n\r\n- s/will be now/will now be/\r\n\r\n- s/Bitcoin Core will not attempt to read it anymore/Bitcoin Core will no longer attempt to read it/ (or \"will henceforth ignore it\")\r\n\r\n- s/If using the old TORv2 service is desirable/To use the deprecated Tor v2 service/ (prefer active voice to passive voice)\r\n\r\n- maybe mention that these cookie auth files are located in the `.bitcoin` directory\r\n\r\n- \"can be copied over\" is unclear (to me)\r\n",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-09-25T11:44:42Z",
      "diff_hunk" : "@@ -74,6 +74,14 @@ P2P and network changes\n   node using P2P relay. This version reduces the initial broadcast guarantees\n   for wallet transactions submitted via P2P to a node running the wallet. (#18038)\n \n+- The TOR hidden service that is automatically created (`-listenonion`) will be\n+  now created as a TORv3 service instead of TORv2. The private key that was used\n+  for TORv2 (if any) will be left untouched in `onion_private_key` and can be\n+  removed if not needed. Bitcoin Core will not attempt to read it anymore. The\n+  private key for the TORv3 service will be saved in `onion_private_key_torv3`.\n+  If using the old TORv2 service is desirable (not recommended), then\n+  `onion_private_key` can be copied over `onion_private_key_torv3`.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r494932190",
      "id" : 494932190,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDkzMjE5MA==",
      "original_commit_id" : "1550aa82659506ef89db67e482d01f014f6a1977",
      "original_line" : 83,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "doc/release-notes.md",
      "position" : null,
      "pull_request_review_id" : 496345797,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/494932190",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r494934753"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/494934753"
         }
      },
      "author_association" : "MEMBER",
      "body" : "896a5af style nit, `Format::V3` having the meaning of \"want addrv2\" is somewhat confusing, maybe create a boolean helper function `IsAddrV2Format()` to use both here and line 405 below for the code to be self-explanatory, or use more descriptive enum `Format` names, not sure here.\r\n\r\nIdem for `m_format > Format::V0`, `m_format > Format::V1`,and `m_format >= Format::V2`",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-09-25T11:50:16Z",
      "diff_hunk" : "@@ -318,8 +329,15 @@ friend class CAddrManTest;\n     {\n         LOCK(cs);\n \n-        unsigned char nVersion = 2;\n-        s << nVersion;\n+        const auto stream_version_orig = s.GetVersion();\n+\n+        if (m_format >= Format::V3) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r494934753",
      "id" : 494934753,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDkzNDc1Mw==",
      "original_commit_id" : "1550aa82659506ef89db67e482d01f014f6a1977",
      "original_line" : 334,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 496345797,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/494934753",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r494964219"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/494964219"
         }
      },
      "author_association" : "MEMBER",
      "body" : "99047b077 is there test coverage for this new try/catch/Misbehaving/logging unparseable address code? has there been discussion on how much to add to the misbehavior score for this?",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-09-25T12:49:08Z",
      "diff_hunk" : "@@ -2584,9 +2587,29 @@ void PeerManager::ProcessMessage(CNode& pfrom, const std::string& msg_type, CDat\n         return;\n     }\n \n-    if (msg_type == NetMsgType::ADDR) {\n+    if (msg_type == NetMsgType::ADDR || msg_type == NetMsgType::ADDRv2) {\n+        const auto version_orig = vRecv.GetVersion();\n+        if (msg_type == NetMsgType::ADDRv2) {\n+            // Add ADDRV2_FORMAT to the version so that the CNetAddr and CAddress\n+            // unserialize methods know that an address in v2 format is coming.\n+            vRecv.SetVersion(version_orig | ADDRV2_FORMAT);\n+        }\n         std::vector<CAddress> vAddr;\n-        vRecv >> vAddr;\n+\n+        try {\n+            vRecv >> vAddr;\n+        } catch (const std::exception& e) {\n+            vRecv.SetVersion(version_orig);\n+\n+            LOCK(cs_main);\n+            Misbehaving(pfrom.GetId(), 20,\n+                strprintf(\n+                    \"Supplied us with a message that contains an unparsable address: %s\",\n+                    e.what()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r494964219",
      "id" : 494964219,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk2NDIxOQ==",
      "original_commit_id" : "1550aa82659506ef89db67e482d01f014f6a1977",
      "original_line" : 2609,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 496345797,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/494964219",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r494966330"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/494966330"
         }
      },
      "author_association" : "MEMBER",
      "body" : "99047b0 covered by a test? ",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-09-25T12:52:51Z",
      "diff_hunk" : "@@ -2612,6 +2635,11 @@ void PeerManager::ProcessMessage(CNode& pfrom, const std::string& msg_type, CDat\n             if (!MayHaveUsefulAddressDB(addr.nServices) && !HasAllDesirableServiceFlags(addr.nServices))\n                 continue;\n \n+            // Skip invalid addresses, maybe a new BIP155 network id from the future.\n+            if (!addr.IsValid()) {\n+                continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r494966330",
      "id" : 494966330,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk2NjMzMA==",
      "original_commit_id" : "1550aa82659506ef89db67e482d01f014f6a1977",
      "original_line" : 2640,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 496345797,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/494966330",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r494976240"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/494976240"
         }
      },
      "author_association" : "MEMBER",
      "body" : "99047b07 nit, maybe \"gossiping of longer node addresses up to 512 bytes\"",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-09-25T13:10:37Z",
      "diff_hunk" : "@@ -76,6 +76,18 @@ extern const char* VERACK;\n  * network.\n  */\n extern const char* ADDR;\n+/**\n+ * The addrv2 message relays connection information for peers on the network just\n+ * like the addr message, but is extended to allow gossiping of longer node",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r494976240",
      "id" : 494976240,
      "line" : 81,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk3NjI0MA==",
      "original_commit_id" : "1550aa82659506ef89db67e482d01f014f6a1977",
      "original_line" : 81,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/protocol.h",
      "position" : 6,
      "pull_request_review_id" : 496345797,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/494976240",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r494978423"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/494978423"
         }
      },
      "author_association" : "MEMBER",
      "body" : "1550aa8 nits, s/TORv2/Tor v2/ and s/does not need/no longer needs/ (though if you move it to the legacy section, use the \"replaced by\" format instead)",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-09-25T13:14:22Z",
      "diff_hunk" : "@@ -56,7 +56,8 @@ Subdirectory       | File(s)               | Description\n `./`               | `fee_estimates.dat`   | Stores statistics used to estimate minimum transaction fees and priorities required for confirmation\n `./`               | `guisettings.ini.bak` | Backup of former [GUI settings](#gui-settings) after `-resetguisettings` option is used\n `./`               | `mempool.dat`         | Dump of the mempool's transactions\n-`./`               | `onion_private_key`   | Cached Tor onion service private key for `-listenonion` option\n+`./`               | `onion_private_key`   | Obsolete: cached Tor onion service private key for `-listenonion` option. Was used for TORv2 services. Bitcoin Core does not need this file and ignores it starting from version 0.21.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r494978423",
      "id" : 494978423,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk3ODQyMw==",
      "original_commit_id" : "1550aa82659506ef89db67e482d01f014f6a1977",
      "original_line" : 59,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "doc/files.md",
      "position" : null,
      "pull_request_review_id" : 496345797,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/494978423",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r495115151"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495115151"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Had a look at if this needs a lock; it doesn't seem so.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-09-25T16:55:53Z",
      "diff_hunk" : "@@ -2637,6 +2665,11 @@ void PeerManager::ProcessMessage(CNode& pfrom, const std::string& msg_type, CDat\n         return;\n     }\n \n+    if (msg_type == NetMsgType::SENDADDRv2) {\n+        pfrom.m_wants_addrv2 = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r495115151",
      "id" : 495115151,
      "line" : 2654,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTExNTE1MQ==",
      "original_commit_id" : "1550aa82659506ef89db67e482d01f014f6a1977",
      "original_line" : 2654,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 61,
      "pull_request_review_id" : 496591006,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495115151",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> The only worry here would be that old nodes will run out of Tor nodes to connect to. But I don't know. I'm okay with this, it seems there's enough hurry to transition here that backwards compatibility concerns like that are mostly moot.\r\n\r\nMaybe it would be good for the release notes to describe the situation with the planned full removal of v2 by the Tor Project and warn users running older nodes with an onion service that they will have to upgrade within less than a year after the release to v0.21+. It might not need to be in this PR though.",
      "created_at" : "2020-09-25T17:08:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-699045896",
      "id" : 699045896,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5OTA0NTg5Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-25T17:08:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/699045896",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> > I think Bitcoin Core automatically creating just one Tor service is enough (that will be v3).\r\n> \r\n> ... old nodes will run out of Tor nodes to connect to ...\r\n\r\nIf there are `N` old nodes each one of them will be able to connect to the other `N-1`. Only the very last one (when `N=1`) will have nobody to connect to. Also, statically configured Tor v2 services (via `torrc`) will keep operating as long as the Tor network supports them.\r\n\r\nAccording to https://bitnodes.io/nodes/ 37% are running the latest version (0.20.0 or 0.20.1), now, about 2 months before the release of 0.21.",
      "created_at" : "2020-09-28T08:07:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-699850959",
      "id" : 699850959,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5OTg1MDk1OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-28T08:07:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/699850959",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebase on latest #19031",
      "created_at" : "2020-09-28T15:09:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-700068840",
      "id" : 700068840,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwMDA2ODg0MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-28T15:09:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/700068840",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Address review suggestions.",
      "created_at" : "2020-09-28T15:10:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-700069599",
      "id" : 700069599,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwMDA2OTU5OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-28T15:10:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/700069599",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r496024495"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496024495"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-09-28T15:12:43Z",
      "diff_hunk" : "@@ -533,7 +533,7 @@ void TorController::auth_cb(TorControlConnection& _conn, const TorControlReply&\n \n         // Finally - now create the service\n         if (private_key.empty()) // No private key, generate one",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r496024495",
      "id" : 496024495,
      "in_reply_to_id" : 492108245,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjAyNDQ5NQ==",
      "original_commit_id" : "1550aa82659506ef89db67e482d01f014f6a1977",
      "original_line" : 535,
      "original_position" : 3,
      "original_start_line" : null,
      "path" : "src/torcontrol.cpp",
      "position" : null,
      "pull_request_review_id" : 497632542,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496024495",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Address review suggestion.",
      "created_at" : "2020-09-28T15:13:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-700070980",
      "id" : 700070980,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwMDA3MDk4MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-28T15:13:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/700070980",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r496025807"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496025807"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-09-28T15:13:51Z",
      "diff_hunk" : "@@ -56,7 +56,8 @@ Subdirectory       | File(s)               | Description\n `./`               | `fee_estimates.dat`   | Stores statistics used to estimate minimum transaction fees and priorities required for confirmation\n `./`               | `guisettings.ini.bak` | Backup of former [GUI settings](#gui-settings) after `-resetguisettings` option is used\n `./`               | `mempool.dat`         | Dump of the mempool's transactions\n-`./`               | `onion_private_key`   | Cached Tor onion service private key for `-listenonion` option\n+`./`               | `onion_private_key`   | Obsolete: cached Tor onion service private key for `-listenonion` option. Was used for TORv2 services. Bitcoin Core does not need this file and ignores it starting from version 0.21.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r496025807",
      "id" : 496025807,
      "in_reply_to_id" : 493521433,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjAyNTgwNw==",
      "original_commit_id" : "1550aa82659506ef89db67e482d01f014f6a1977",
      "original_line" : 59,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "doc/files.md",
      "position" : null,
      "pull_request_review_id" : 497633590,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496025807",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r496027199"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496027199"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.\r\n\r\n`cp -f onion_private_key onion_private_key_torv3` is clearer? :)",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-09-28T15:15:02Z",
      "diff_hunk" : "@@ -74,6 +74,14 @@ P2P and network changes\n   node using P2P relay. This version reduces the initial broadcast guarantees\n   for wallet transactions submitted via P2P to a node running the wallet. (#18038)\n \n+- The TOR hidden service that is automatically created (`-listenonion`) will be\n+  now created as a TORv3 service instead of TORv2. The private key that was used\n+  for TORv2 (if any) will be left untouched in `onion_private_key` and can be\n+  removed if not needed. Bitcoin Core will not attempt to read it anymore. The\n+  private key for the TORv3 service will be saved in `onion_private_key_torv3`.\n+  If using the old TORv2 service is desirable (not recommended), then\n+  `onion_private_key` can be copied over `onion_private_key_torv3`.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r496027199",
      "id" : 496027199,
      "in_reply_to_id" : 494932190,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjAyNzE5OQ==",
      "original_commit_id" : "1550aa82659506ef89db67e482d01f014f6a1977",
      "original_line" : 83,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "doc/release-notes.md",
      "position" : null,
      "pull_request_review_id" : 497634785,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496027199",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r496030562"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496030562"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "AddrMan already had versions on its on-disk database with numbers. So I left the convention as is and just added new version \"3\" since the last one used was \"2\". This has nothing to do with \"addrv2\" or \"torv3\" :)\r\n\r\n`IsAddrV2Format()` would spoil the strict ordering of the AddrMan on-disk versions.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-09-28T15:18:06Z",
      "diff_hunk" : "@@ -318,8 +329,15 @@ friend class CAddrManTest;\n     {\n         LOCK(cs);\n \n-        unsigned char nVersion = 2;\n-        s << nVersion;\n+        const auto stream_version_orig = s.GetVersion();\n+\n+        if (m_format >= Format::V3) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r496030562",
      "id" : 496030562,
      "in_reply_to_id" : 494934753,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjAzMDU2Mg==",
      "original_commit_id" : "1550aa82659506ef89db67e482d01f014f6a1977",
      "original_line" : 334,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 497637674,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496030562",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r496032822"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496032822"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes! (since the last push with updated tests)\r\n\r\n> has there been discussion on how much to add to the misbehavior score for this?\r\n\r\nI don't think so. It is currently punishing the peer as much as if he sent us an addr message with >1000 addresses. I do not insist on that.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-09-28T15:20:08Z",
      "diff_hunk" : "@@ -2584,9 +2587,29 @@ void PeerManager::ProcessMessage(CNode& pfrom, const std::string& msg_type, CDat\n         return;\n     }\n \n-    if (msg_type == NetMsgType::ADDR) {\n+    if (msg_type == NetMsgType::ADDR || msg_type == NetMsgType::ADDRv2) {\n+        const auto version_orig = vRecv.GetVersion();\n+        if (msg_type == NetMsgType::ADDRv2) {\n+            // Add ADDRV2_FORMAT to the version so that the CNetAddr and CAddress\n+            // unserialize methods know that an address in v2 format is coming.\n+            vRecv.SetVersion(version_orig | ADDRV2_FORMAT);\n+        }\n         std::vector<CAddress> vAddr;\n-        vRecv >> vAddr;\n+\n+        try {\n+            vRecv >> vAddr;\n+        } catch (const std::exception& e) {\n+            vRecv.SetVersion(version_orig);\n+\n+            LOCK(cs_main);\n+            Misbehaving(pfrom.GetId(), 20,\n+                strprintf(\n+                    \"Supplied us with a message that contains an unparsable address: %s\",\n+                    e.what()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r496032822",
      "id" : 496032822,
      "in_reply_to_id" : 494964219,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjAzMjgyMg==",
      "original_commit_id" : "1550aa82659506ef89db67e482d01f014f6a1977",
      "original_line" : 2609,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 497639580,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496032822",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r496033072"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496033072"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes! (since the last push with updated tests)",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-09-28T15:20:21Z",
      "diff_hunk" : "@@ -2612,6 +2635,11 @@ void PeerManager::ProcessMessage(CNode& pfrom, const std::string& msg_type, CDat\n             if (!MayHaveUsefulAddressDB(addr.nServices) && !HasAllDesirableServiceFlags(addr.nServices))\n                 continue;\n \n+            // Skip invalid addresses, maybe a new BIP155 network id from the future.\n+            if (!addr.IsValid()) {\n+                continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r496033072",
      "id" : 496033072,
      "in_reply_to_id" : 494966330,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjAzMzA3Mg==",
      "original_commit_id" : "1550aa82659506ef89db67e482d01f014f6a1977",
      "original_line" : 2640,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 497639774,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496033072",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r496034538"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496034538"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I deliberately leave numbers outside of comments - as too much unnecessary details and also could go out of sync if the code is updated and the comment not.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-09-28T15:21:37Z",
      "diff_hunk" : "@@ -76,6 +76,18 @@ extern const char* VERACK;\n  * network.\n  */\n extern const char* ADDR;\n+/**\n+ * The addrv2 message relays connection information for peers on the network just\n+ * like the addr message, but is extended to allow gossiping of longer node",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r496034538",
      "id" : 496034538,
      "in_reply_to_id" : 494976240,
      "line" : 81,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjAzNDUzOA==",
      "original_commit_id" : "1550aa82659506ef89db67e482d01f014f6a1977",
      "original_line" : 81,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/protocol.h",
      "position" : 6,
      "pull_request_review_id" : 497640946,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496034538",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r496034952"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496034952"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done - \"replaced by ...\"",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-09-28T15:21:58Z",
      "diff_hunk" : "@@ -56,7 +56,8 @@ Subdirectory       | File(s)               | Description\n `./`               | `fee_estimates.dat`   | Stores statistics used to estimate minimum transaction fees and priorities required for confirmation\n `./`               | `guisettings.ini.bak` | Backup of former [GUI settings](#gui-settings) after `-resetguisettings` option is used\n `./`               | `mempool.dat`         | Dump of the mempool's transactions\n-`./`               | `onion_private_key`   | Cached Tor onion service private key for `-listenonion` option\n+`./`               | `onion_private_key`   | Obsolete: cached Tor onion service private key for `-listenonion` option. Was used for TORv2 services. Bitcoin Core does not need this file and ignores it starting from version 0.21.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r496034952",
      "id" : 496034952,
      "in_reply_to_id" : 494978423,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjAzNDk1Mg==",
      "original_commit_id" : "1550aa82659506ef89db67e482d01f014f6a1977",
      "original_line" : 59,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "doc/files.md",
      "position" : null,
      "pull_request_review_id" : 497641322,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496034952",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Ready to move this PR out of Draft status? ð Edit: snap!",
      "created_at" : "2020-09-29T08:56:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-700565667",
      "id" : 700565667,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwMDU2NTY2Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-29T08:57:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/700565667",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Opened for review. This PR supersedes #19031 and completes the TORv3 support.",
      "created_at" : "2020-09-29T08:58:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-700566816",
      "id" : 700566816,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwMDU2NjgxNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-29T08:58:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/700566816",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK.",
      "created_at" : "2020-09-29T09:00:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-700567804",
      "id" : 700567804,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwMDU2NzgwNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-29T09:00:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/700567804",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r496575638"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496575638"
         }
      },
      "author_association" : "MEMBER",
      "body" : "e025121c1ca4b86296c6b36386786522bd79a6e1\r\n\r\n```suggestion\r\n        s << static_cast<uint8_t>(m_format);\r\n```",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-09-29T09:31:35Z",
      "diff_hunk" : "@@ -318,8 +329,15 @@ friend class CAddrManTest;\n     {\n         LOCK(cs);\n \n-        unsigned char nVersion = 2;\n-        s << nVersion;\n+        const auto stream_version_orig = s.GetVersion();\n+\n+        if (m_format >= Format::V3) {\n+            // Add ADDRV2_FORMAT to the version so that the CNetAddr and CAddress\n+            // serialize methods produce an address in v2 format.\n+            s.SetVersion(stream_version_orig | ADDRV2_FORMAT);\n+        }\n+\n+        s << (uint8_t)m_format;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r496575638",
      "id" : 496575638,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjU3NTYzOA==",
      "original_commit_id" : "e025121c1ca4b86296c6b36386786522bd79a6e1",
      "original_line" : 340,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 498284069,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496575638",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r496579158"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496579158"
         }
      },
      "author_association" : "MEMBER",
      "body" : "e025121c1ca4b86296c6b36386786522bd79a6e1\r\n```suggestion\r\n        m_format = static_cast<Format>(format_tmp);\r\n```",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-09-29T09:36:47Z",
      "diff_hunk" : "@@ -376,8 +396,17 @@ friend class CAddrManTest;\n         LOCK(cs);\n \n         Clear();\n-        unsigned char nVersion;\n-        s >> nVersion;\n+\n+        const auto stream_version_orig = s.GetVersion();\n+\n+        uint8_t format_tmp;\n+        s >> format_tmp;\n+        m_format = (Format)format_tmp;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r496579158",
      "id" : 496579158,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjU3OTE1OA==",
      "original_commit_id" : "e025121c1ca4b86296c6b36386786522bd79a6e1",
      "original_line" : 404,
      "original_position" : 67,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 498284069,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/496579158",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Addressed suggestions by @hebasto - always compare `m_format` with `>=` and use `static_cast` instead of C-style cast.",
      "created_at" : "2020-09-30T07:49:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-701224311",
      "id" : 701224311,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwMTIyNDMxMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-30T07:49:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/701224311",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r497309187"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/497309187"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-09-30T07:49:33Z",
      "diff_hunk" : "@@ -376,8 +396,17 @@ friend class CAddrManTest;\n         LOCK(cs);\n \n         Clear();\n-        unsigned char nVersion;\n-        s >> nVersion;\n+\n+        const auto stream_version_orig = s.GetVersion();\n+\n+        uint8_t format_tmp;\n+        s >> format_tmp;\n+        m_format = (Format)format_tmp;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r497309187",
      "id" : 497309187,
      "in_reply_to_id" : 496579158,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzMwOTE4Nw==",
      "original_commit_id" : "e025121c1ca4b86296c6b36386786522bd79a6e1",
      "original_line" : 404,
      "original_position" : 67,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 499167608,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/497309187",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r497309288"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/497309288"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-09-30T07:49:45Z",
      "diff_hunk" : "@@ -318,8 +329,15 @@ friend class CAddrManTest;\n     {\n         LOCK(cs);\n \n-        unsigned char nVersion = 2;\n-        s << nVersion;\n+        const auto stream_version_orig = s.GetVersion();\n+\n+        if (m_format >= Format::V3) {\n+            // Add ADDRV2_FORMAT to the version so that the CNetAddr and CAddress\n+            // serialize methods produce an address in v2 format.\n+            s.SetVersion(stream_version_orig | ADDRV2_FORMAT);\n+        }\n+\n+        s << (uint8_t)m_format;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r497309288",
      "id" : 497309288,
      "in_reply_to_id" : 496575638,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzMwOTI4OA==",
      "original_commit_id" : "e025121c1ca4b86296c6b36386786522bd79a6e1",
      "original_line" : 340,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 499167734,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/497309288",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "#### Addresses with length > 512 or addresses from one of the BIP155 founding networks (1..6) with wrong length (e.g. IPv4 address with length 5):\r\n\r\nWe throw an exception during unserialize which means that subsequent addresses in the same addrv2 message will not be read and the peer is `Misbehaving()`ed.\r\n\r\n#### Addresses from unknown network id (0 or >= 7), with address length <= 512:\r\n\r\nThose are possibly legit addresses from a future extension of BIP155. We consume the address from the stream and keep parsing subsequent addresses in the same addrv2 message. The unknown address will however not be relayed or added to addrman (it is unserialized as all-0s IPv6 address which is `!IsValid()`).\r\n\r\n#### I2P and CJDNS addresses (BIP155 network ids 5 and 6):\r\n\r\n[Relevant IRC discussion on how to handle those](https://bitcoincore.reviews/19845#l-319). There are concerns whether we should relay or add them to addrman because we can't further verify their validity or check if a node actually exists at that address.\r\n\r\nThe current code actually would [not add such addresses to addrman](https://github.com/bitcoin/bitcoin/blob/1769828684f16b53e5fbf65173f508b9ea1b4b9c/src/net_processing.cpp#L2626-L2628) because they are `!IsReachable()`, so we would not get \"garbage\" in addrman.\r\n\r\nThe current code would however relay such addresses (to 1.5 peers like other `!IsReachable()` addresses).\r\n* This has the downside of garbage gossip traffic. Is it any worse than somebody gossiping garbage IPv6 addresses? Honest nodes don't have a way to verify if there is a node listening on a I2P address (yet). But even now we don't verify if there is a node listening on an address before relaying it.\r\n* The benefit is that once I2P support is added in version 0.2X then older nodes, e.g. 0.21 will relay I2P addresses and help with propagation.\r\n\r\n<details>\r\n<summary>The change to not relay I2P and CJDNS addresses is easy, click here.</summary>\r\n\r\n```diff\r\n--- i/src/net_processing.cpp\r\n+++ w/src/net_processing.cpp\r\n@@ -2643,14 +2643,14 @@ void PeerManager::ProcessMessage(CNode& pfrom, const std::string& msg_type, CDat\r\n             pfrom.AddAddressKnown(addr);\r\n             if (m_banman && (m_banman->IsDiscouraged(addr) || m_banman->IsBanned(addr))) {\r\n                 // Do not process banned/discouraged addresses beyond remembering we received them\r\n                 continue;\r\n             }\r\n             bool fReachable = IsReachable(addr);\r\n-            if (addr.nTime > nSince && !pfrom.fGetAddr && vAddr.size() <= 10 && addr.IsRoutable())\r\n-            {\r\n+            if (addr.nTime > nSince && !pfrom.fGetAddr && vAddr.size() <= 10 &&\r\n+                addr.IsRoutable() && !addr.IsI2P() && !addr.IsCJDNS()) {\r\n                 // Relay to a limited number of other nodes\r\n                 RelayAddress(addr, fReachable, m_connman);\r\n             }\r\n             // Do not store addresses outside our network\r\n             if (fReachable)\r\n                 vAddrOk.push_back(addr);\r\n```\r\n</details>\r\n\r\nWhat are your thoughts?\r\n",
      "created_at" : "2020-09-30T10:34:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-701307791",
      "id" : 701307791,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwMTMwNzc5MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-30T10:34:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/701307791",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@vasild \r\n\r\n> Addresses with length > 512 or addresses from one of the BIP155 founding networks (1..6) with wrong length (e.g. IPv4 address with length 5):\r\n> We throw an exception during unserialize which means that subsequent addresses in the same addrv2 message will not be read and the peer is Misbehaving()ed.\r\n\r\nSounds like correct behavior to me. Larger addresses are explicitly forbidden, and can be seen as an indication that the entire message is malformed.\r\n\r\n> Addresses from unknown network id (0 or >= 7), with address length <= 512:\r\n> We consume the address from the stream and keep parsing subsequent addresses in the same addrv2 message. The unknown address will however not be relayed or added to addrman\r\n\r\nSeems good  to me too.\r\n\r\n> The current code would however relay such addresses (to 1.5 peers like other !IsReachable() addresses).\r\n\r\nI'm not sure about this. I'm not sure we should do anything (store, relay) with addresses that we cannot connect to ourselves.\r\nBut as you say this is a broader scope decision. Staying (at least in this PR) with the current behaviour for valid but unreachable addresses doesn't sound unreasonable to me.",
      "created_at" : "2020-09-30T11:40:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-701336262",
      "id" : 701336262,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwMTMzNjI2Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-30T14:14:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/701336262",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r497572479"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/497572479"
         }
      },
      "author_association" : "MEMBER",
      "body" : "LGTM",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-09-30T14:50:00Z",
      "diff_hunk" : "@@ -74,6 +74,14 @@ P2P and network changes\n   node using P2P relay. This version reduces the initial broadcast guarantees\n   for wallet transactions submitted via P2P to a node running the wallet. (#18038)\n \n+- The TOR hidden service that is automatically created (`-listenonion`) will be\n+  now created as a TORv3 service instead of TORv2. The private key that was used\n+  for TORv2 (if any) will be left untouched in `onion_private_key` and can be\n+  removed if not needed. Bitcoin Core will not attempt to read it anymore. The\n+  private key for the TORv3 service will be saved in `onion_private_key_torv3`.\n+  If using the old TORv2 service is desirable (not recommended), then\n+  `onion_private_key` can be copied over `onion_private_key_torv3`.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r497572479",
      "id" : 497572479,
      "in_reply_to_id" : 494932190,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU3MjQ3OQ==",
      "original_commit_id" : "1550aa82659506ef89db67e482d01f014f6a1977",
      "original_line" : 83,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "doc/release-notes.md",
      "position" : null,
      "pull_request_review_id" : 499515650,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/497572479",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r497573433"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/497573433"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, I understand. Helper functions that replace the various `m_format >= Format::V<n>` may possibly be nice, but opinions can vary and it isn't a blocker.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-09-30T14:51:12Z",
      "diff_hunk" : "@@ -318,8 +329,15 @@ friend class CAddrManTest;\n     {\n         LOCK(cs);\n \n-        unsigned char nVersion = 2;\n-        s << nVersion;\n+        const auto stream_version_orig = s.GetVersion();\n+\n+        if (m_format >= Format::V3) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r497573433",
      "id" : 497573433,
      "in_reply_to_id" : 494934753,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU3MzQzMw==",
      "original_commit_id" : "1550aa82659506ef89db67e482d01f014f6a1977",
      "original_line" : 334,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 499516932,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/497573433",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r497574106"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/497574106"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Per https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#es49-if-you-must-use-a-cast-use-a-named-cast and *C++ Programming Language 4th Edition*, section 11.5, it might be good to update the next line as well if you retouch.\r\n```diff\r\n         s << static_cast<uint8_t>(m_format);\r\n-        s << ((unsigned char)32);\r\n+        s << static_cast<unsigned char>(32);\r\n```",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-09-30T14:52:05Z",
      "diff_hunk" : "@@ -318,8 +329,15 @@ friend class CAddrManTest;\n     {\n         LOCK(cs);\n \n-        unsigned char nVersion = 2;\n-        s << nVersion;\n+        const auto stream_version_orig = s.GetVersion();\n+\n+        if (m_format >= Format::V3) {\n+            // Add ADDRV2_FORMAT to the version so that the CNetAddr and CAddress\n+            // serialize methods produce an address in v2 format.\n+            s.SetVersion(stream_version_orig | ADDRV2_FORMAT);\n+        }\n+\n+        s << (uint8_t)m_format;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r497574106",
      "id" : 497574106,
      "in_reply_to_id" : 496575638,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU3NDEwNg==",
      "original_commit_id" : "e025121c1ca4b86296c6b36386786522bd79a6e1",
      "original_line" : 340,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 499517872,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/497574106",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r497578644"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/497578644"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Missing column separator `|`?\r\n```suggestion\r\n`onion_private_key` | Cached Tor onion service private key for `-listenonion` option. Was used for Tor v2 services; replaced by `onion_private_key_torv3` in [0.21.0](https://github.com/bitcoin/bitcoin/blob/master/doc/release-notes/release-notes-0.21.0.md) | [PR #19954](https://github.com/bitcoin/bitcoin/pull/19954)\r\n```",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-09-30T14:57:33Z",
      "diff_hunk" : "@@ -98,6 +98,7 @@ Path           | Description | Repository notes\n `blkindex.dat` | Blockchain index BDB database; replaced by {`chainstate/`, `blocks/index/`, `blocks/revNNNNN.dat`<sup>[\\[2\\]](#note2)</sup>} in 0.8.0 | [PR #1677](https://github.com/bitcoin/bitcoin/pull/1677)\n `blk000?.dat`  | Block data (custom format, 2 GiB per file); replaced by `blocks/blkNNNNN.dat`<sup>[\\[2\\]](#note2)</sup> in 0.8.0 | [PR #1677](https://github.com/bitcoin/bitcoin/pull/1677)\n `addr.dat`     | Peer IP address BDB database; replaced by `peers.dat` in [0.7.0](https://github.com/bitcoin/bitcoin/blob/master/doc/release-notes/release-notes-0.7.0.md) | [PR #1198](https://github.com/bitcoin/bitcoin/pull/1198), [`928d3a01`](https://github.com/bitcoin/bitcoin/commit/928d3a011cc66c7f907c4d053f674ea77dc611cc)\n+`onion_private_key` | Cached Tor onion service private key for `-listenonion` option. Was used for Tor v2 services; replaced by `onion_private_key_torv3` in [0.21.0](https://github.com/bitcoin/bitcoin/blob/master/doc/release-notes/release-notes-0.21.0.md) [PR #19954](https://github.com/bitcoin/bitcoin/pull/19954)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r497578644",
      "id" : 497578644,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU3ODY0NA==",
      "original_commit_id" : "bb01c77865a565764e4e2f86265afef45506d7d7",
      "original_line" : 101,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "doc/files.md",
      "position" : null,
      "pull_request_review_id" : 499523621,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/497578644",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r497581232"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/497581232"
         }
      },
      "author_association" : "MEMBER",
      "body" : "(`code`) markup inside parentheses; maybe easier to read as: \r\n```suggestion\r\n  , e.g. `cp -f onion_private_key onion_private_key_torv3`.\r\n```",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-09-30T15:00:39Z",
      "diff_hunk" : "@@ -74,6 +74,15 @@ P2P and network changes\n   node using P2P relay. This version reduces the initial broadcast guarantees\n   for wallet transactions submitted via P2P to a node running the wallet. (#18038)\n \n+- The Tor hidden service that is automatically created (`-listenonion`) will now\n+  be created as a Tor v3 service instead of Tor v2. The private key that was used\n+  for Tor v2 (if any) will be left untouched in `onion_private_key` in `-datadir`\n+  and can be removed if not needed. Bitcoin Core will no longer attempt to read it.\n+  The private key for the Tor v3 service will be saved in `onion_private_key_torv3`.\n+  To use the deprecated Tor v2 service (not recommended), then `onion_private_key`\n+  can be copied over `onion_private_key_torv3`\n+  (`cp -f onion_private_key onion_private_key_torv3`).",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r497581232",
      "id" : 497581232,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU4MTIzMg==",
      "original_commit_id" : "bb01c77865a565764e4e2f86265afef45506d7d7",
      "original_line" : 84,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "doc/release-notes.md",
      "position" : null,
      "pull_request_review_id" : 499527127,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/497581232",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r497583701"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/497583701"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should we test for both `msg_addr` and `msg_addrv2`?",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-09-30T15:03:53Z",
      "diff_hunk" : "@@ -10,7 +10,7 @@\n     CAddress,\n     NODE_NETWORK,\n     NODE_WITNESS,\n-    msg_addr,\n+    msg_addrv2,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r497583701",
      "id" : 497583701,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU4MzcwMQ==",
      "original_commit_id" : "bb01c77865a565764e4e2f86265afef45506d7d7",
      "original_line" : 13,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/p2p_addr_relay.py",
      "position" : null,
      "pull_request_review_id" : 499530501,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/497583701",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r497588719"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/497588719"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nice work on the tests!",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-09-30T15:10:25Z",
      "diff_hunk" : "@@ -2584,9 +2587,29 @@ void PeerManager::ProcessMessage(CNode& pfrom, const std::string& msg_type, CDat\n         return;\n     }\n \n-    if (msg_type == NetMsgType::ADDR) {\n+    if (msg_type == NetMsgType::ADDR || msg_type == NetMsgType::ADDRv2) {\n+        const auto version_orig = vRecv.GetVersion();\n+        if (msg_type == NetMsgType::ADDRv2) {\n+            // Add ADDRV2_FORMAT to the version so that the CNetAddr and CAddress\n+            // unserialize methods know that an address in v2 format is coming.\n+            vRecv.SetVersion(version_orig | ADDRV2_FORMAT);\n+        }\n         std::vector<CAddress> vAddr;\n-        vRecv >> vAddr;\n+\n+        try {\n+            vRecv >> vAddr;\n+        } catch (const std::exception& e) {\n+            vRecv.SetVersion(version_orig);\n+\n+            LOCK(cs_main);\n+            Misbehaving(pfrom.GetId(), 20,\n+                strprintf(\n+                    \"Supplied us with a message that contains an unparsable address: %s\",\n+                    e.what()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r497588719",
      "id" : 497588719,
      "in_reply_to_id" : 494964219,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU4ODcxOQ==",
      "original_commit_id" : "1550aa82659506ef89db67e482d01f014f6a1977",
      "original_line" : 2609,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 499537188,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/497588719",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Tested re-ACK bb01c77865a565764e4e2f86265afef45506d7d7\r\n\r\nReviewed the diff since my last review per `git range-diff 301959f 1550aa8 bb01c77`, re-reviewed the changeset, rebuilt, deleted the `onion_private_key_torv3` file from previous testing and relaunched; node seems to be running nominally. The additional tests are great. A few comments above to take or leave; none are blockers.",
      "created_at" : "2020-09-30T15:16:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-701457565",
      "id" : 701457565,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwMTQ1NzU2NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-30T15:16:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/701457565",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "~Does `addrv2` code follows https://github.com/bitcoin/bips/pull/967 ?~\r\n\r\nUPDATE: I'v verified that this PR follows BIP 155 with (yet unmerged) https://github.com/bitcoin/bips/pull/967\r\n\r\nUPDATE-2: https://github.com/bitcoin/bips/pull/967 just merged.",
      "created_at" : "2020-10-01T13:20:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-702129772",
      "id" : 702129772,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwMjEyOTc3Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-01T14:25:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/702129772",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r498327611"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/498327611"
         }
      },
      "author_association" : "MEMBER",
      "body" : "76afce803bb5309a69517df5eac68529b7af2d29\r\n```suggestion\r\n        m_connman.PushMessage(&pfrom, CNetMsgMaker(greatest_common_version).Make(NetMsgType::SENDADDRv2));\r\n```",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-01T15:20:26Z",
      "diff_hunk" : "@@ -2414,6 +2414,9 @@ void PeerManager::ProcessMessage(CNode& pfrom, const std::string& msg_type, CDat\n \n         m_connman.PushMessage(&pfrom, CNetMsgMaker(greatest_common_version).Make(NetMsgType::VERACK));\n \n+        // Signal ADDRv2 support (BIP155).\n+        m_connman.PushMessage(&pfrom, CNetMsgMaker(INIT_PROTO_VERSION).Make(NetMsgType::SENDADDRv2));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r498327611",
      "id" : 498327611,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODMyNzYxMQ==",
      "original_commit_id" : "76afce803bb5309a69517df5eac68529b7af2d29",
      "original_line" : 2418,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 500460244,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/498327611",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r498336765"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/498336765"
         }
      },
      "author_association" : "MEMBER",
      "body" : "bb01c77865a565764e4e2f86265afef45506d7d7\r\n\r\nThe comment about #9214 seems outdated now:\r\n```suggestion\r\n        if (private_key.empty()) {\r\n            // No private key, generate one.\r\n            private_key = \"NEW:ED25519-V3\";\r\n        }\r\n```\r\n",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-01T15:32:59Z",
      "diff_hunk" : "@@ -532,8 +532,9 @@ void TorController::auth_cb(TorControlConnection& _conn, const TorControlReply&\n         }\n \n         // Finally - now create the service\n-        if (private_key.empty()) // No private key, generate one\n-            private_key = \"NEW:RSA1024\"; // Explicitly request RSA1024 - see issue #9214\n+        if (private_key.empty()) { // No private key, generate one\n+            private_key = \"NEW:ED25519-V3\"; // Explicitly request key type - see issue #9214\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r498336765",
      "id" : 498336765,
      "line" : 537,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODMzNjc2NQ==",
      "original_commit_id" : "bb01c77865a565764e4e2f86265afef45506d7d7",
      "original_line" : 537,
      "original_position" : 8,
      "original_start_line" : 535,
      "path" : "src/torcontrol.cpp",
      "position" : 8,
      "pull_request_review_id" : 500460244,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : 535,
      "start_side" : "RIGHT",
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/498336765",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r498338888"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/498338888"
         }
      },
      "author_association" : "MEMBER",
      "body" : "bb01c77865a565764e4e2f86265afef45506d7d7\r\n\r\nSee #19638:\r\n```suggestion\r\n- The Tor onion service that is automatically created (`-listenonion`) will now\r\n```",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-01T15:35:57Z",
      "diff_hunk" : "@@ -74,6 +74,15 @@ P2P and network changes\n   node using P2P relay. This version reduces the initial broadcast guarantees\n   for wallet transactions submitted via P2P to a node running the wallet. (#18038)\n \n+- The Tor hidden service that is automatically created (`-listenonion`) will now",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r498338888",
      "id" : 498338888,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODMzODg4OA==",
      "original_commit_id" : "bb01c77865a565764e4e2f86265afef45506d7d7",
      "original_line" : 77,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "doc/release-notes.md",
      "position" : null,
      "pull_request_review_id" : 500460244,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/498338888",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> May I suggest to replace s/\"onion_private_key_torv3\"/\"onion_private_key_v3\"/ as \"tor\" substring seems redundant here?\r\n\r\nKind of agree, the same came to mind for me but didn't bother to comment it initially. But a shorter filename that still contains the same information is good I suppose.",
      "created_at" : "2020-10-02T11:47:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-702688812",
      "id" : 702688812,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwMjY4ODgxMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-02T11:47:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/702688812",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r498799536"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/498799536"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-02T12:48:24Z",
      "diff_hunk" : "@@ -98,6 +98,7 @@ Path           | Description | Repository notes\n `blkindex.dat` | Blockchain index BDB database; replaced by {`chainstate/`, `blocks/index/`, `blocks/revNNNNN.dat`<sup>[\\[2\\]](#note2)</sup>} in 0.8.0 | [PR #1677](https://github.com/bitcoin/bitcoin/pull/1677)\n `blk000?.dat`  | Block data (custom format, 2 GiB per file); replaced by `blocks/blkNNNNN.dat`<sup>[\\[2\\]](#note2)</sup> in 0.8.0 | [PR #1677](https://github.com/bitcoin/bitcoin/pull/1677)\n `addr.dat`     | Peer IP address BDB database; replaced by `peers.dat` in [0.7.0](https://github.com/bitcoin/bitcoin/blob/master/doc/release-notes/release-notes-0.7.0.md) | [PR #1198](https://github.com/bitcoin/bitcoin/pull/1198), [`928d3a01`](https://github.com/bitcoin/bitcoin/commit/928d3a011cc66c7f907c4d053f674ea77dc611cc)\n+`onion_private_key` | Cached Tor onion service private key for `-listenonion` option. Was used for Tor v2 services; replaced by `onion_private_key_torv3` in [0.21.0](https://github.com/bitcoin/bitcoin/blob/master/doc/release-notes/release-notes-0.21.0.md) [PR #19954](https://github.com/bitcoin/bitcoin/pull/19954)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r498799536",
      "id" : 498799536,
      "in_reply_to_id" : 497578644,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODc5OTUzNg==",
      "original_commit_id" : "bb01c77865a565764e4e2f86265afef45506d7d7",
      "original_line" : 101,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "doc/files.md",
      "position" : null,
      "pull_request_review_id" : 501103868,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/498799536",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r498799651"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/498799651"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-02T12:48:38Z",
      "diff_hunk" : "@@ -74,6 +74,15 @@ P2P and network changes\n   node using P2P relay. This version reduces the initial broadcast guarantees\n   for wallet transactions submitted via P2P to a node running the wallet. (#18038)\n \n+- The Tor hidden service that is automatically created (`-listenonion`) will now\n+  be created as a Tor v3 service instead of Tor v2. The private key that was used\n+  for Tor v2 (if any) will be left untouched in `onion_private_key` in `-datadir`\n+  and can be removed if not needed. Bitcoin Core will no longer attempt to read it.\n+  The private key for the Tor v3 service will be saved in `onion_private_key_torv3`.\n+  To use the deprecated Tor v2 service (not recommended), then `onion_private_key`\n+  can be copied over `onion_private_key_torv3`\n+  (`cp -f onion_private_key onion_private_key_torv3`).",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r498799651",
      "id" : 498799651,
      "in_reply_to_id" : 497581232,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODc5OTY1MQ==",
      "original_commit_id" : "bb01c77865a565764e4e2f86265afef45506d7d7",
      "original_line" : 84,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "doc/release-notes.md",
      "position" : null,
      "pull_request_review_id" : 501104027,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/498799651",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r498801055"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/498801055"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Right, `p2p_addr_relay.py` is the only test that exercises `msg_addr` and if we flip it to test `msg_addrv2` then `msg_addr` will be untested.\r\n\r\nI tried to combine both in one test, but it became too convoluted and so I copied the new test to `p2p_addrv2_relay.py` and restored the original `p2p_addr_relay.py`.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-02T12:51:15Z",
      "diff_hunk" : "@@ -10,7 +10,7 @@\n     CAddress,\n     NODE_NETWORK,\n     NODE_WITNESS,\n-    msg_addr,\n+    msg_addrv2,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r498801055",
      "id" : 498801055,
      "in_reply_to_id" : 497583701,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODgwMTA1NQ==",
      "original_commit_id" : "bb01c77865a565764e4e2f86265afef45506d7d7",
      "original_line" : 13,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/p2p_addr_relay.py",
      "position" : null,
      "pull_request_review_id" : 501105863,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/498801055",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r498801234"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/498801234"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-02T12:51:36Z",
      "diff_hunk" : "@@ -2414,6 +2414,9 @@ void PeerManager::ProcessMessage(CNode& pfrom, const std::string& msg_type, CDat\n \n         m_connman.PushMessage(&pfrom, CNetMsgMaker(greatest_common_version).Make(NetMsgType::VERACK));\n \n+        // Signal ADDRv2 support (BIP155).\n+        m_connman.PushMessage(&pfrom, CNetMsgMaker(INIT_PROTO_VERSION).Make(NetMsgType::SENDADDRv2));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r498801234",
      "id" : 498801234,
      "in_reply_to_id" : 498327611,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODgwMTIzNA==",
      "original_commit_id" : "76afce803bb5309a69517df5eac68529b7af2d29",
      "original_line" : 2418,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 501106136,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/498801234",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r498801401"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/498801401"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Changed",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-02T12:51:55Z",
      "diff_hunk" : "@@ -74,6 +74,15 @@ P2P and network changes\n   node using P2P relay. This version reduces the initial broadcast guarantees\n   for wallet transactions submitted via P2P to a node running the wallet. (#18038)\n \n+- The Tor hidden service that is automatically created (`-listenonion`) will now",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r498801401",
      "id" : 498801401,
      "in_reply_to_id" : 498338888,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODgwMTQwMQ==",
      "original_commit_id" : "bb01c77865a565764e4e2f86265afef45506d7d7",
      "original_line" : 77,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "doc/release-notes.md",
      "position" : null,
      "pull_request_review_id" : 501106347,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/498801401",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r498803183"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/498803183"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The comment is still relevant - we want to explicitly request the key type in order to avoid problems like #9214 in the future.\r\n\r\nIn other words - we don't want somebody to change this to `NEW:BEST` because if/when Tor upgrades to v4 then we may have #9214 again.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-02T12:55:32Z",
      "diff_hunk" : "@@ -532,8 +532,9 @@ void TorController::auth_cb(TorControlConnection& _conn, const TorControlReply&\n         }\n \n         // Finally - now create the service\n-        if (private_key.empty()) // No private key, generate one\n-            private_key = \"NEW:RSA1024\"; // Explicitly request RSA1024 - see issue #9214\n+        if (private_key.empty()) { // No private key, generate one\n+            private_key = \"NEW:ED25519-V3\"; // Explicitly request key type - see issue #9214\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r498803183",
      "id" : 498803183,
      "in_reply_to_id" : 498336765,
      "line" : 537,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODgwMzE4Mw==",
      "original_commit_id" : "bb01c77865a565764e4e2f86265afef45506d7d7",
      "original_line" : 537,
      "original_position" : 8,
      "original_start_line" : 535,
      "path" : "src/torcontrol.cpp",
      "position" : 8,
      "pull_request_review_id" : 501108829,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : 535,
      "start_side" : "RIGHT",
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/498803183",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Addressed review suggestions. Notice - I [restored](https://github.com/bitcoin/bitcoin/pull/19954#discussion_r498801055) the original version of `p2p_addr_relay.py` and the test for addrv2 is now in a new test `p2p_addrv2_relay.py`.",
      "created_at" : "2020-10-02T13:00:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-702720508",
      "id" : 702720508,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwMjcyMDUwOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-02T13:00:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/702720508",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r498807007"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/498807007"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "That line is unmodified by the patch. I try to avoid sneaking unrelated improvements to surrounding code in order to ease reviewers and future history observers.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-02T13:03:02Z",
      "diff_hunk" : "@@ -318,8 +329,15 @@ friend class CAddrManTest;\n     {\n         LOCK(cs);\n \n-        unsigned char nVersion = 2;\n-        s << nVersion;\n+        const auto stream_version_orig = s.GetVersion();\n+\n+        if (m_format >= Format::V3) {\n+            // Add ADDRV2_FORMAT to the version so that the CNetAddr and CAddress\n+            // serialize methods produce an address in v2 format.\n+            s.SetVersion(stream_version_orig | ADDRV2_FORMAT);\n+        }\n+\n+        s << (uint8_t)m_format;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r498807007",
      "id" : 498807007,
      "in_reply_to_id" : 496575638,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODgwNzAwNw==",
      "original_commit_id" : "e025121c1ca4b86296c6b36386786522bd79a6e1",
      "original_line" : 340,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 501114927,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/498807007",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r498812638"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/498812638"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That's fair.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-02T13:13:41Z",
      "diff_hunk" : "@@ -318,8 +329,15 @@ friend class CAddrManTest;\n     {\n         LOCK(cs);\n \n-        unsigned char nVersion = 2;\n-        s << nVersion;\n+        const auto stream_version_orig = s.GetVersion();\n+\n+        if (m_format >= Format::V3) {\n+            // Add ADDRV2_FORMAT to the version so that the CNetAddr and CAddress\n+            // serialize methods produce an address in v2 format.\n+            s.SetVersion(stream_version_orig | ADDRV2_FORMAT);\n+        }\n+\n+        s << (uint8_t)m_format;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r498812638",
      "id" : 498812638,
      "in_reply_to_id" : 496575638,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODgxMjYzOA==",
      "original_commit_id" : "e025121c1ca4b86296c6b36386786522bd79a6e1",
      "original_line" : 340,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 501122763,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/498812638",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I [restored](https://github.com/bitcoin/bitcoin/pull/19954#discussion_r498801055) the original version of `p2p_addr_relay.py` and the test for addrv2 is now in a new test `p2p_addrv2_relay.py`.\r\n\r\nNice!",
      "created_at" : "2020-10-02T13:15:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-702727412",
      "id" : 702727412,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwMjcyNzQxMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-02T13:15:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/702727412",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r498825564"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/498825564"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Correct.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-02T13:36:12Z",
      "diff_hunk" : "@@ -532,8 +532,9 @@ void TorController::auth_cb(TorControlConnection& _conn, const TorControlReply&\n         }\n \n         // Finally - now create the service\n-        if (private_key.empty()) // No private key, generate one\n-            private_key = \"NEW:RSA1024\"; // Explicitly request RSA1024 - see issue #9214\n+        if (private_key.empty()) { // No private key, generate one\n+            private_key = \"NEW:ED25519-V3\"; // Explicitly request key type - see issue #9214\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r498825564",
      "id" : 498825564,
      "in_reply_to_id" : 498336765,
      "line" : 537,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODgyNTU2NA==",
      "original_commit_id" : "bb01c77865a565764e4e2f86265afef45506d7d7",
      "original_line" : 537,
      "original_position" : 8,
      "original_start_line" : 535,
      "path" : "src/torcontrol.cpp",
      "position" : 8,
      "pull_request_review_id" : 501140722,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : 535,
      "start_side" : "RIGHT",
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/498825564",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@vasild in the latest push, the `p2p_addr_relay.py` file perms were changed from 755 to 644; could you please revert that?\r\n\r\n<details><summary>a few suggestions for <code>p2p_addrv2_relay.py</code></summary><p>\r\n\r\n```diff\r\ndiff --git a/test/functional/p2p_addrv2_relay.py b/test/functional/p2p_addrv2_relay.py\r\nindex 19cfd0eadb..ca593148cc 100755\r\n--- a/test/functional/p2p_addrv2_relay.py\r\n+++ b/test/functional/p2p_addrv2_relay.py\r\n@@ -6,18 +6,17 @@\r\n@@ -6,18 +6,17 @@\r\n Test addrv2 relay\r\n \"\"\"\r\n \r\n+import time\r\n+\r\n from test_framework.messages import (\r\n     CAddress,\r\n+    msg_addrv2,\r\n     NODE_NETWORK,\r\n     NODE_WITNESS,\r\n-    msg_addrv2,\r\n )\r\n from test_framework.p2p import P2PInterface\r\n from test_framework.test_framework import BitcoinTestFramework\r\n-from test_framework.util import (\r\n-    assert_equal,\r\n-)\r\n-import time\r\n+from test_framework.util import assert_equal\r\n \r\n ADDRS = []\r\n for i in range(10):\r\n@@ -48,11 +47,11 @@ class AddrReceiver(P2PInterface):\r\n \r\n class AddrTest(BitcoinTestFramework):\r\n     def set_test_params(self):\r\n-        self.setup_clean_chain = False\r\n+        self.setup_clean_chain = True\r\n         self.num_nodes = 1\r\n \r\n     def run_test(self):\r\n-        self.log.info('Create connection that sends addr messages')\r\n+        self.log.info('Create connection that sends addrv2 messages')\r\n         addr_source = self.nodes[0].add_p2p_connection(P2PInterface())\r\n         msg = msg_addrv2()\r\n \r\n@@ -61,7 +60,7 @@ class AddrTest(BitcoinTestFramework):\r\n         with self.nodes[0].assert_debug_log(['addr message size = 1010']):\r\n             addr_source.send_and_ping(msg)\r\n \r\n-        self.log.info('Check that addr message content is relayed and added to addrman')\r\n+        self.log.info('Check that addrv2 message content is relayed and added to addrman')\r\n         addr_receiver = self.nodes[0].add_p2p_connection(AddrReceiver())\r\n         msg.addrs = ADDRS\r\n         with self.nodes[0].assert_debug_log([\r\n```\r\n</p></details>\r\n",
      "created_at" : "2020-10-03T11:07:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-703086391",
      "id" : 703086391,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwMzA4NjM5MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-03T11:07:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/703086391",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499139208"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499139208"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    return GetDataDir() / \"onion_v3_private_key\";\r\n```",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-03T11:16:44Z",
      "diff_hunk" : "@@ -718,7 +719,7 @@ void TorController::Reconnect()\n \n fs::path TorController::GetPrivateKeyFile()\n {\n-    return GetDataDir() / \"onion_private_key\";\n+    return GetDataDir() / \"onion_private_key_v3\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499139208",
      "id" : 499139208,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTEzOTIwOA==",
      "original_commit_id" : "c212c7eea6c0f67d7c65467c6c93f188aaeb02f3",
      "original_line" : 722,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/torcontrol.cpp",
      "position" : null,
      "pull_request_review_id" : 501539039,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499139208",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499139283"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499139283"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: IIRC, per PEP8, OS-level and stdlib imports go at the top. ",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-03T11:18:10Z",
      "diff_hunk" : "@@ -22,7 +22,12 @@\n     P2PInterface,\n )\n from test_framework.test_framework import BitcoinTestFramework\n-from test_framework.util import assert_equal\n+from test_framework.util import (\n+    assert_equal,\n+    hex_str_to_bytes,\n+)\n+import struct\n+import time",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499139283",
      "id" : 499139283,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTEzOTI4Mw==",
      "original_commit_id" : "c212c7eea6c0f67d7c65467c6c93f188aaeb02f3",
      "original_line" : 30,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "test/functional/p2p_invalid_messages.py",
      "position" : null,
      "pull_request_review_id" : 501539039,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499139283",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499140417"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499140417"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should skipping invalid BIP155 addresses be applied only for `addrv2` messages?\r\n```cpp\r\nif (!addr.IsValid() && msg_type == NetMsgType::ADDRv2) {\r\n    continue;\r\n}\r\n```",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-03T11:35:27Z",
      "diff_hunk" : "@@ -2610,6 +2635,11 @@ void PeerManager::ProcessMessage(CNode& pfrom, const std::string& msg_type, CDat\n             if (!MayHaveUsefulAddressDB(addr.nServices) && !HasAllDesirableServiceFlags(addr.nServices))\n                 continue;\n \n+            // Skip invalid addresses, maybe a new BIP155 network id from the future.\n+            if (!addr.IsValid()) {\n+                continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499140417",
      "id" : 499140417,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE0MDQxNw==",
      "original_commit_id" : "c212c7eea6c0f67d7c65467c6c93f188aaeb02f3",
      "original_line" : 2640,
      "original_position" : 57,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 501539911,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499140417",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499295620"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499295620"
         }
      },
      "author_association" : "MEMBER",
      "body" : "How about giving these a bit more descriptive names, like `V0_HISTORICAL`, `V1_DETERMINISTIC`, `V2_ASMAP`, `V3_BIP155`?",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-04T22:29:13Z",
      "diff_hunk" : "@@ -264,6 +264,17 @@ friend class CAddrManTest;\n     void SetServices_(const CService &addr, ServiceFlags nServices) EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n public:\n+    //! Serialization versions.\n+    enum class Format : uint8_t {\n+        V0 = 0, //!< historic format, before commit e6b343d88",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499295620",
      "id" : 499295620,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI5NTYyMA==",
      "original_commit_id" : "31876b33894a48f20a8835126faac8f9f4a8aa00",
      "original_line" : 269,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 501664990,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499295620",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499295803"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499295803"
         }
      },
      "author_association" : "MEMBER",
      "body" : "A cleaner approach is using `OverrideStream` here (and elsewhere), which removes the need to undo the version change, or having a mutable version in CHashWriter.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-04T22:31:45Z",
      "diff_hunk" : "@@ -318,8 +329,15 @@ friend class CAddrManTest;\n     {\n         LOCK(cs);\n \n-        unsigned char nVersion = 2;\n-        s << nVersion;\n+        const auto stream_version_orig = s.GetVersion();\n+\n+        if (m_format >= Format::V3) {\n+            // Add ADDRV2_FORMAT to the version so that the CNetAddr and CAddress\n+            // serialize methods produce an address in v2 format.\n+            s.SetVersion(stream_version_orig | ADDRV2_FORMAT);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499295803",
      "id" : 499295803,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI5NTgwMw==",
      "original_commit_id" : "31876b33894a48f20a8835126faac8f9f4a8aa00",
      "original_line" : 337,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 501664990,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499295803",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499586890"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499586890"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-05T13:12:01Z",
      "diff_hunk" : "@@ -718,7 +719,7 @@ void TorController::Reconnect()\n \n fs::path TorController::GetPrivateKeyFile()\n {\n-    return GetDataDir() / \"onion_private_key\";\n+    return GetDataDir() / \"onion_private_key_v3\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499586890",
      "id" : 499586890,
      "in_reply_to_id" : 499139208,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU4Njg5MA==",
      "original_commit_id" : "c212c7eea6c0f67d7c65467c6c93f188aaeb02f3",
      "original_line" : 722,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/torcontrol.cpp",
      "position" : null,
      "pull_request_review_id" : 502039808,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499586890",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499586991"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499586991"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-05T13:12:11Z",
      "diff_hunk" : "@@ -22,7 +22,12 @@\n     P2PInterface,\n )\n from test_framework.test_framework import BitcoinTestFramework\n-from test_framework.util import assert_equal\n+from test_framework.util import (\n+    assert_equal,\n+    hex_str_to_bytes,\n+)\n+import struct\n+import time",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499586991",
      "id" : 499586991,
      "in_reply_to_id" : 499139283,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU4Njk5MQ==",
      "original_commit_id" : "c212c7eea6c0f67d7c65467c6c93f188aaeb02f3",
      "original_line" : 30,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "test/functional/p2p_invalid_messages.py",
      "position" : null,
      "pull_request_review_id" : 502039960,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499586991",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499588933"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499588933"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I realized that this code is not necessary so I dropped it altogether - an invalid address is not routable and is not reachable, so we are not going to do anything with it.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-05T13:15:04Z",
      "diff_hunk" : "@@ -2610,6 +2635,11 @@ void PeerManager::ProcessMessage(CNode& pfrom, const std::string& msg_type, CDat\n             if (!MayHaveUsefulAddressDB(addr.nServices) && !HasAllDesirableServiceFlags(addr.nServices))\n                 continue;\n \n+            // Skip invalid addresses, maybe a new BIP155 network id from the future.\n+            if (!addr.IsValid()) {\n+                continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499588933",
      "id" : 499588933,
      "in_reply_to_id" : 499140417,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU4ODkzMw==",
      "original_commit_id" : "c212c7eea6c0f67d7c65467c6c93f188aaeb02f3",
      "original_line" : 2640,
      "original_position" : 57,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 502042603,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499588933",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499589759"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499589759"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Renamed",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-05T13:16:19Z",
      "diff_hunk" : "@@ -264,6 +264,17 @@ friend class CAddrManTest;\n     void SetServices_(const CService &addr, ServiceFlags nServices) EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n public:\n+    //! Serialization versions.\n+    enum class Format : uint8_t {\n+        V0 = 0, //!< historic format, before commit e6b343d88",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499589759",
      "id" : 499589759,
      "in_reply_to_id" : 499295620,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU4OTc1OQ==",
      "original_commit_id" : "31876b33894a48f20a8835126faac8f9f4a8aa00",
      "original_line" : 269,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 502043799,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499589759",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499590590"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499590590"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Right, changed to `OverrideStream`.\r\n\r\nhttps://github.com/bitcoin/bitcoin/pull/19503 is also an alternative if/when it gets merged.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-05T13:17:31Z",
      "diff_hunk" : "@@ -318,8 +329,15 @@ friend class CAddrManTest;\n     {\n         LOCK(cs);\n \n-        unsigned char nVersion = 2;\n-        s << nVersion;\n+        const auto stream_version_orig = s.GetVersion();\n+\n+        if (m_format >= Format::V3) {\n+            // Add ADDRV2_FORMAT to the version so that the CNetAddr and CAddress\n+            // serialize methods produce an address in v2 format.\n+            s.SetVersion(stream_version_orig | ADDRV2_FORMAT);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499590590",
      "id" : 499590590,
      "in_reply_to_id" : 499295803,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU5MDU5MA==",
      "original_commit_id" : "31876b33894a48f20a8835126faac8f9f4a8aa00",
      "original_line" : 337,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 502044946,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499590590",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Addressed review suggestions.",
      "created_at" : "2020-10-05T13:20:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-703627129",
      "id" : 703627129,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwMzYyNzEyOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-05T13:20:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/703627129",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499623542"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499623542"
         }
      },
      "author_association" : "MEMBER",
      "body" : "pico-nit:\r\n```suggestion\r\n    template <typename Stream>\r\n```",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-05T14:04:34Z",
      "diff_hunk" : "@@ -371,13 +390,25 @@ friend class CAddrManTest;\n     }\n \n     template<typename Stream>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499623542",
      "id" : 499623542,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYyMzU0Mg==",
      "original_commit_id" : "bbbc8e4c657e8ea81edb6aca2b1870cd3b7459ad",
      "original_line" : 392,
      "original_position" : 58,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 502090310,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499623542",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499625806"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499625806"
         }
      },
      "author_association" : "MEMBER",
      "body" : "pico-nit, as `clang-format` suggests, and s/V2/V2_ASMAP/ in comment:\r\n```suggestion\r\n        V0_HISTORICAL = 0,    //!< historic format, before commit e6b343d88\r\n        V1_DETERMINISTIC = 1, //!< for pre-asmap files\r\n        V2_ASMAP = 2,         //!< for files including asmap version\r\n        V3_BIP155 = 3,        //!< same as V2_ASMAP plus addresses are in BIP155 format\r\n```",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-05T14:07:54Z",
      "diff_hunk" : "@@ -264,6 +264,17 @@ friend class CAddrManTest;\n     void SetServices_(const CService &addr, ServiceFlags nServices) EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n public:\n+    //! Serialization versions.\n+    enum class Format : uint8_t {\n+        V0_HISTORICAL = 0, //!< historic format, before commit e6b343d88\n+        V1_DETERMINISTIC = 1, //!< for pre-asmap files\n+        V2_ASMAP = 2, //!< for files including asmap version\n+        V3_BIP155 = 3, //!< same as V2 plus addresses are in BIP155 format",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499625806",
      "id" : 499625806,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYyNTgwNg==",
      "original_commit_id" : "bbbc8e4c657e8ea81edb6aca2b1870cd3b7459ad",
      "original_line" : 272,
      "original_position" : 9,
      "original_start_line" : 269,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 502090310,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499625806",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499626217"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499626217"
         }
      },
      "author_association" : "MEMBER",
      "body" : "pico-nit:\r\n```suggestion\r\n    int nVersion;\r\n\r\npublic:\r\n```",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-05T14:08:33Z",
      "diff_hunk" : "@@ -102,13 +102,14 @@ class CHashWriter\n     CSHA256 ctx;\n \n     const int nType;\n-    const int nVersion;\n+    int nVersion;\n public:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499626217",
      "id" : 499626217,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYyNjIxNw==",
      "original_commit_id" : "bbbc8e4c657e8ea81edb6aca2b1870cd3b7459ad",
      "original_line" : 106,
      "original_position" : 6,
      "original_start_line" : 105,
      "path" : "src/hash.h",
      "position" : null,
      "pull_request_review_id" : 502090310,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499626217",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I'd like that `s` and `s_` objects of the `Stream` class were named more descriptive, but I have no particular suggestion.",
      "created_at" : "2020-10-05T14:17:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-703662561",
      "id" : 703662561,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwMzY2MjU2MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-05T14:17:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/703662561",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Addressed review suggestions.",
      "created_at" : "2020-10-05T14:41:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-703677160",
      "id" : 703677160,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwMzY3NzE2MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-05T14:41:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/703677160",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499650613"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499650613"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-05T14:41:19Z",
      "diff_hunk" : "@@ -102,13 +102,14 @@ class CHashWriter\n     CSHA256 ctx;\n \n     const int nType;\n-    const int nVersion;\n+    int nVersion;\n public:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499650613",
      "id" : 499650613,
      "in_reply_to_id" : 499626217,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTY1MDYxMw==",
      "original_commit_id" : "bbbc8e4c657e8ea81edb6aca2b1870cd3b7459ad",
      "original_line" : 106,
      "original_position" : 6,
      "original_start_line" : 105,
      "path" : "src/hash.h",
      "position" : null,
      "pull_request_review_id" : 502127617,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499650613",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499650706"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499650706"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-05T14:41:28Z",
      "diff_hunk" : "@@ -264,6 +264,17 @@ friend class CAddrManTest;\n     void SetServices_(const CService &addr, ServiceFlags nServices) EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n public:\n+    //! Serialization versions.\n+    enum class Format : uint8_t {\n+        V0_HISTORICAL = 0, //!< historic format, before commit e6b343d88\n+        V1_DETERMINISTIC = 1, //!< for pre-asmap files\n+        V2_ASMAP = 2, //!< for files including asmap version\n+        V3_BIP155 = 3, //!< same as V2 plus addresses are in BIP155 format",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499650706",
      "id" : 499650706,
      "in_reply_to_id" : 499625806,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTY1MDcwNg==",
      "original_commit_id" : "bbbc8e4c657e8ea81edb6aca2b1870cd3b7459ad",
      "original_line" : 272,
      "original_position" : 9,
      "original_start_line" : 269,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 502127760,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499650706",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499650830"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499650830"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-05T14:41:38Z",
      "diff_hunk" : "@@ -371,13 +390,25 @@ friend class CAddrManTest;\n     }\n \n     template<typename Stream>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499650830",
      "id" : 499650830,
      "in_reply_to_id" : 499623542,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTY1MDgzMA==",
      "original_commit_id" : "bbbc8e4c657e8ea81edb6aca2b1870cd3b7459ad",
      "original_line" : 392,
      "original_position" : 58,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 502127927,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499650830",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499714046"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499714046"
         }
      },
      "author_association" : "MEMBER",
      "body" : "03572e9 After `git diff c212c7e 703db15` using `OverrideStream`, it looks like we can now revert these changes in `hash.h` and `streams.h`.\r\n```diff\r\n+++ b/src/hash.h\r\n@@ -102,7 +102,7 @@ private:\r\n     const int nType;\r\n-    int nVersion;\r\n+    const int nVersion;\r\n@@ -110,7 +110,6 @@ public:\r\n     int GetVersion() const { return nVersion; }\r\n-    void SetVersion(int n) { nVersion = n; }\r\n\r\n+++ b/src/streams.h\r\n@@ -603,7 +603,7 @@ class CAutoFile\r\n     const int nType;\r\n-    int nVersion;\r\n+    const int nVersion; \r\n@@ -651,7 +651,6 @@ public:\r\n     int GetVersion() const       { return nVersion; }\r\n-    void SetVersion(int n)       { nVersion = n; }\r\n```",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-05T16:11:14Z",
      "diff_hunk" : "@@ -102,13 +102,15 @@ class CHashWriter\n     CSHA256 ctx;\n \n     const int nType;\n-    const int nVersion;\n+    int nVersion;\n+\n public:\n \n     CHashWriter(int nTypeIn, int nVersionIn) : nType(nTypeIn), nVersion(nVersionIn) {}\n \n     int GetType() const { return nType; }\n     int GetVersion() const { return nVersion; }\n+    void SetVersion(int n) { nVersion = n; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499714046",
      "id" : 499714046,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTcxNDA0Ng==",
      "original_commit_id" : "703db15ae197c6b2e9489c14af441c5d796ff082",
      "original_line" : 113,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/hash.h",
      "position" : null,
      "pull_request_review_id" : 502211628,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499714046",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499926937"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499926937"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You could use `s_ >> Using<CustomUintFormatter<1>>(m_format)` here (and possibly also in `Serialize`, for consistency, though it isn't really a gain there).",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-05T23:32:56Z",
      "diff_hunk" : "@@ -370,14 +389,26 @@ friend class CAddrManTest;\n         s << asmap_version;\n     }\n \n-    template<typename Stream>\n-    void Unserialize(Stream& s)\n+    template <typename Stream>\n+    void Unserialize(Stream& s_)\n     {\n         LOCK(cs);\n \n         Clear();\n-        unsigned char nVersion;\n-        s >> nVersion;\n+\n+        uint8_t format_tmp;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499926937",
      "id" : 499926937,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkyNjkzNw==",
      "original_commit_id" : "03572e94cb7249165cc5333c0785e2694c620785",
      "original_line" : 399,
      "original_position" : 70,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 502489557,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499926937",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499929630"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499929630"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This should be unnecessary as well.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-05T23:43:10Z",
      "diff_hunk" : "@@ -650,6 +651,7 @@ class CAutoFile\n     //\n     int GetType() const          { return nType; }\n     int GetVersion() const       { return nVersion; }\n+    void SetVersion(int n)       { nVersion = n; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499929630",
      "id" : 499929630,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkyOTYzMA==",
      "original_commit_id" : "03572e94cb7249165cc5333c0785e2694c620785",
      "original_line" : 654,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/streams.h",
      "position" : null,
      "pull_request_review_id" : 502489557,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499929630",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499932221"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499932221"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's a bit ugly to make the choice of how addrman is serialized on disk dependent on external code properly setting this m_format variable.\r\n\r\nI think it's fine to just always serialize in the latest format. In that case the `format` variable can be just be local to the deserialization code.\r\n\r\nAlternatively, if you want to focus on retaining backward compatibility as long as no BIP155 has been used, you could make the format decision at serialization depend on whether or not IsAddrV1Compatible() is true for all addresses in it.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-05T23:50:58Z",
      "diff_hunk" : "@@ -264,6 +264,17 @@ friend class CAddrManTest;\n     void SetServices_(const CService &addr, ServiceFlags nServices) EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n public:\n+    //! Serialization versions.\n+    enum class Format : uint8_t {\n+        V0_HISTORICAL = 0,    //!< historic format, before commit e6b343d88\n+        V1_DETERMINISTIC = 1, //!< for pre-asmap files\n+        V2_ASMAP = 2,         //!< for files including asmap version\n+        V3_BIP155 = 3,        //!< same as V2_ASMAP plus addresses are in BIP155 format\n+    };\n+\n+    //! Serialization / unserialization format.\n+    Format m_format = Format::V3_BIP155;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499932221",
      "id" : 499932221,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkzMjIyMQ==",
      "original_commit_id" : "03572e94cb7249165cc5333c0785e2694c620785",
      "original_line" : 276,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 502489557,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499932221",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499952970"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499952970"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If you use the `CNetMsgMaker:: Make(int nFlags, std::string msg_type, Args&&... args)` variant here, you can control the serialization flags, without needing the special casing for ADDRV2 inside `Make`.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-06T01:11:25Z",
      "diff_hunk" : "@@ -4104,14 +4137,14 @@ bool PeerManager::SendMessages(CNode* pto)\n                     // receiver rejects addr messages larger than MAX_ADDR_TO_SEND\n                     if (vAddr.size() >= MAX_ADDR_TO_SEND)\n                     {\n-                        m_connman.PushMessage(pto, msgMaker.Make(NetMsgType::ADDR, vAddr));\n+                        m_connman.PushMessage(pto, msgMaker.Make(msg_type, vAddr));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r499952970",
      "id" : 499952970,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTk1Mjk3MA==",
      "original_commit_id" : "44364147d739cc4566cd1b202f1effd6f81539d8",
      "original_line" : 4140,
      "original_position" : 93,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 502489557,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499952970",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r500134583"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500134583"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good catch! Removed.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-06T09:28:14Z",
      "diff_hunk" : "@@ -102,13 +102,15 @@ class CHashWriter\n     CSHA256 ctx;\n \n     const int nType;\n-    const int nVersion;\n+    int nVersion;\n+\n public:\n \n     CHashWriter(int nTypeIn, int nVersionIn) : nType(nTypeIn), nVersion(nVersionIn) {}\n \n     int GetType() const { return nType; }\n     int GetVersion() const { return nVersion; }\n+    void SetVersion(int n) { nVersion = n; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r500134583",
      "id" : 500134583,
      "in_reply_to_id" : 499714046,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEzNDU4Mw==",
      "original_commit_id" : "703db15ae197c6b2e9489c14af441c5d796ff082",
      "original_line" : 113,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/hash.h",
      "position" : null,
      "pull_request_review_id" : 502751215,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500134583",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r500135370"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500135370"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Used `CustomUintFormatter` here, but in `Serialize` it did not compile:\r\n```\r\nsrc/serialize.h:504:15: error: invalid operands to binary expression ('CAddrMan::Format' and 'int')\r\n        if (v < 0 || v > MAX) throw std::ios_base::failure(\"CustomUintFormatter value out of range\");\r\n            ~ ^ ~\r\n```\r\nso I left the `static_cast` there.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-06T09:29:31Z",
      "diff_hunk" : "@@ -370,14 +389,26 @@ friend class CAddrManTest;\n         s << asmap_version;\n     }\n \n-    template<typename Stream>\n-    void Unserialize(Stream& s)\n+    template <typename Stream>\n+    void Unserialize(Stream& s_)\n     {\n         LOCK(cs);\n \n         Clear();\n-        unsigned char nVersion;\n-        s >> nVersion;\n+\n+        uint8_t format_tmp;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r500135370",
      "id" : 500135370,
      "in_reply_to_id" : 499926937,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEzNTM3MA==",
      "original_commit_id" : "03572e94cb7249165cc5333c0785e2694c620785",
      "original_line" : 399,
      "original_position" : 70,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 502752290,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500135370",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r500135658"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500135658"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Removed",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-06T09:29:56Z",
      "diff_hunk" : "@@ -650,6 +651,7 @@ class CAutoFile\n     //\n     int GetType() const          { return nType; }\n     int GetVersion() const       { return nVersion; }\n+    void SetVersion(int n)       { nVersion = n; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r500135658",
      "id" : 500135658,
      "in_reply_to_id" : 499929630,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEzNTY1OA==",
      "original_commit_id" : "03572e94cb7249165cc5333c0785e2694c620785",
      "original_line" : 654,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/streams.h",
      "position" : null,
      "pull_request_review_id" : 502752629,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500135658",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r500137462"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500137462"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I agree \"it's fine to just always serialize in the latest format\", changed the code accordingly - now the format variable is a local one in `Unserialize()` while `Serialize()` just serializes the constant `Format::V3_BIP155`.\r\n\r\nThis is also closer to the behavior before this PR (it always serialized in version 2, the latest at the time).",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-06T09:32:53Z",
      "diff_hunk" : "@@ -264,6 +264,17 @@ friend class CAddrManTest;\n     void SetServices_(const CService &addr, ServiceFlags nServices) EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n public:\n+    //! Serialization versions.\n+    enum class Format : uint8_t {\n+        V0_HISTORICAL = 0,    //!< historic format, before commit e6b343d88\n+        V1_DETERMINISTIC = 1, //!< for pre-asmap files\n+        V2_ASMAP = 2,         //!< for files including asmap version\n+        V3_BIP155 = 3,        //!< same as V2_ASMAP plus addresses are in BIP155 format\n+    };\n+\n+    //! Serialization / unserialization format.\n+    Format m_format = Format::V3_BIP155;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r500137462",
      "id" : 500137462,
      "in_reply_to_id" : 499932221,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEzNzQ2Mg==",
      "original_commit_id" : "03572e94cb7249165cc5333c0785e2694c620785",
      "original_line" : 276,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 502754928,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500137462",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r500137760"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500137760"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Does this mean that `peers.dat` becomes unreadable if a user choose to downgrade his node at some point in the future?",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-06T09:33:26Z",
      "diff_hunk" : "@@ -264,6 +264,17 @@ friend class CAddrManTest;\n     void SetServices_(const CService &addr, ServiceFlags nServices) EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n public:\n+    //! Serialization versions.\n+    enum class Format : uint8_t {\n+        V0_HISTORICAL = 0,    //!< historic format, before commit e6b343d88\n+        V1_DETERMINISTIC = 1, //!< for pre-asmap files\n+        V2_ASMAP = 2,         //!< for files including asmap version\n+        V3_BIP155 = 3,        //!< same as V2_ASMAP plus addresses are in BIP155 format\n+    };\n+\n+    //! Serialization / unserialization format.\n+    Format m_format = Format::V3_BIP155;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r500137760",
      "id" : 500137760,
      "in_reply_to_id" : 499932221,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEzNzc2MA==",
      "original_commit_id" : "03572e94cb7249165cc5333c0785e2694c620785",
      "original_line" : 276,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 502755354,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500137760",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r500144970"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500144970"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "A good interface is [hard or impossible to misuse](https://testing.googleblog.com/2018/07/code-health-make-interfaces-hard-to.html). If we add `ADDRV2_FORMAT` to `nFlags` inside `Make()` that makes it impossible for the caller to misuse it like:\r\n\r\n```cpp\r\nmsgMaker.Make(0, NetMsgType::ADDRv2, vAddr); // huh!?\r\n```\r\n\r\nI think it is not good to impose on the caller: \"whenever you pass `NetMsgType::ADDRv2` for `msg_type` you must also pass `ADDRV2_FORMAT` in `nFlags`\".",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-06T09:45:27Z",
      "diff_hunk" : "@@ -4104,14 +4137,14 @@ bool PeerManager::SendMessages(CNode* pto)\n                     // receiver rejects addr messages larger than MAX_ADDR_TO_SEND\n                     if (vAddr.size() >= MAX_ADDR_TO_SEND)\n                     {\n-                        m_connman.PushMessage(pto, msgMaker.Make(NetMsgType::ADDR, vAddr));\n+                        m_connman.PushMessage(pto, msgMaker.Make(msg_type, vAddr));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r500144970",
      "id" : 500144970,
      "in_reply_to_id" : 499952970,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDE0NDk3MA==",
      "original_commit_id" : "44364147d739cc4566cd1b202f1effd6f81539d8",
      "original_line" : 4140,
      "original_position" : 93,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 502764808,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500144970",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Addressed review suggestions and extended some tests.",
      "created_at" : "2020-10-06T09:47:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-704157591",
      "id" : 704157591,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwNDE1NzU5MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-06T09:47:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/704157591",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "[Filtered code coverage report](https://people.freebsd.org/~vd/pr19954_946b79a9d_coverage/) (files not modified by this PR are omitted and not modified lines in files that are otherwise modified are dimmed).\r\n\r\n[List of modified and not covered lines](https://people.freebsd.org/~vd/pr19954_946b79a9d_coverage/modified_and_not_covered.html).",
      "created_at" : "2020-10-06T09:53:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-704160646",
      "id" : 704160646,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwNDE2MDY0Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-06T09:53:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/704160646",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r500464672"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500464672"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@vasild I agree with the notion, but this is just the wrong layer to deal with that. The serialization framework (which I'd consider netmessagemaker to be a thin wrapper around) shouldn't have knowledge about the data being serialized, or even about which message types exist.\r\n\r\n> I think it is not good to impose on the caller: \"whenever you pass `NetMsgType::ADDRv2` for `msg_type` you must also pass `ADDRV2_FORMAT` in `nFlags`\".\r\n\r\nI think that's the wrong way to think about it. `CNetMsgMaker` should do as it's told: serializing the object passed with the specified flags, and nothing else. Knowledge about what message types exist, and how data is serialized in them belongs in net_processing.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-06T17:15:12Z",
      "diff_hunk" : "@@ -4104,14 +4137,14 @@ bool PeerManager::SendMessages(CNode* pto)\n                     // receiver rejects addr messages larger than MAX_ADDR_TO_SEND\n                     if (vAddr.size() >= MAX_ADDR_TO_SEND)\n                     {\n-                        m_connman.PushMessage(pto, msgMaker.Make(NetMsgType::ADDR, vAddr));\n+                        m_connman.PushMessage(pto, msgMaker.Make(msg_type, vAddr));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r500464672",
      "id" : 500464672,
      "in_reply_to_id" : 499952970,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ2NDY3Mg==",
      "original_commit_id" : "44364147d739cc4566cd1b202f1effd6f81539d8",
      "original_line" : 4140,
      "original_position" : 93,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 503188633,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500464672",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r500470051"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500470051"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Testing this branch:\r\n\r\nOne or two restarts (always the first, sometimes a second one as well) after `cp onion_private_key onion_v3_private_key` to run a v2 service\r\n\r\n```\r\nERROR: DeserializeDB: Deserialize or I/O error - ReadCompactSize(): size too large: iostream error \r\nInvalid or missing peers.dat; recreating\r\n```\r\n\r\nOne, and sometimes two, restarts after `rm onion_v3_private_key` to return to v3\r\n\r\n```\r\nERROR: DeserializeDB: Deserialize or I/O error - ReadCompactSize(): size too large: iostream error \r\nInvalid or missing peers.dat; recreating\r\n```\r\n\r\n\r\nEdit: verified that these messages are new in the debug log and were absent from testing of previous versions.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-06T17:24:01Z",
      "diff_hunk" : "@@ -264,6 +264,17 @@ friend class CAddrManTest;\n     void SetServices_(const CService &addr, ServiceFlags nServices) EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n public:\n+    //! Serialization versions.\n+    enum class Format : uint8_t {\n+        V0_HISTORICAL = 0,    //!< historic format, before commit e6b343d88\n+        V1_DETERMINISTIC = 1, //!< for pre-asmap files\n+        V2_ASMAP = 2,         //!< for files including asmap version\n+        V3_BIP155 = 3,        //!< same as V2_ASMAP plus addresses are in BIP155 format\n+    };\n+\n+    //! Serialization / unserialization format.\n+    Format m_format = Format::V3_BIP155;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r500470051",
      "id" : 500470051,
      "in_reply_to_id" : 499932221,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ3MDA1MQ==",
      "original_commit_id" : "03572e94cb7249165cc5333c0785e2694c620785",
      "original_line" : 276,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 503195650,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500470051",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r500642162"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500642162"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This block shouldn't be needed, `PeerManager::ProcessMessages` will catch exceptions thrown during message processing, and skip to the next message. That doesn't trigger any `Misbehaving`, but whether deserialization failure should have a misbehavior score (and the future of misbehavior scores at all...) seems like an orthogonal issue that needn't be addressed here.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-06T22:57:27Z",
      "diff_hunk" : "@@ -2582,16 +2588,37 @@ void PeerManager::ProcessMessage(CNode& pfrom, const std::string& msg_type, CDat\n         return;\n     }\n \n-    if (msg_type == NetMsgType::ADDR) {\n+    if (msg_type == NetMsgType::ADDR || msg_type == NetMsgType::ADDRv2) {\n+        int stream_version = vRecv.GetVersion();\n+        if (msg_type == NetMsgType::ADDRv2) {\n+            // Add ADDRV2_FORMAT to the version so that the CNetAddr and CAddress\n+            // unserialize methods know that an address in v2 format is coming.\n+            stream_version |= ADDRV2_FORMAT;\n+        }\n+\n+        OverrideStream<CDataStream> s(&vRecv, vRecv.GetType(), stream_version);\n         std::vector<CAddress> vAddr;\n-        vRecv >> vAddr;\n+\n+        try {\n+            s >> vAddr;\n+        } catch (const std::exception& e) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r500642162",
      "id" : 500642162,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY0MjE2Mg==",
      "original_commit_id" : "9502ad10020778722652e41188ae9cdb11e78cf2",
      "original_line" : 2604,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 503416183,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500642162",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r500643659"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500643659"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This can instead be:\r\n\r\n```c++\r\nMisbehaving(pfrom.GetId(), 20, strprintf(\"%s message size = %u\", msg_type, vAddr.size()));\r\n```\r\n\r\nAs msg_type is just `const char*`.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-06T23:02:11Z",
      "diff_hunk" : "@@ -2582,16 +2588,37 @@ void PeerManager::ProcessMessage(CNode& pfrom, const std::string& msg_type, CDat\n         return;\n     }\n \n-    if (msg_type == NetMsgType::ADDR) {\n+    if (msg_type == NetMsgType::ADDR || msg_type == NetMsgType::ADDRv2) {\n+        int stream_version = vRecv.GetVersion();\n+        if (msg_type == NetMsgType::ADDRv2) {\n+            // Add ADDRV2_FORMAT to the version so that the CNetAddr and CAddress\n+            // unserialize methods know that an address in v2 format is coming.\n+            stream_version |= ADDRV2_FORMAT;\n+        }\n+\n+        OverrideStream<CDataStream> s(&vRecv, vRecv.GetType(), stream_version);\n         std::vector<CAddress> vAddr;\n-        vRecv >> vAddr;\n+\n+        try {\n+            s >> vAddr;\n+        } catch (const std::exception& e) {\n+            LOCK(cs_main);\n+            Misbehaving(pfrom.GetId(), 20,\n+                strprintf(\n+                    \"Supplied us with a message that contains an unparsable address: %s\",\n+                    e.what()));\n+            return;\n+        }\n \n         if (!pfrom.RelayAddrsWithConn()) {\n             return;\n         }\n         if (vAddr.size() > MAX_ADDR_TO_SEND)\n         {\n-            Misbehaving(pfrom.GetId(), 20, strprintf(\"addr message size = %u\", vAddr.size()));\n+            Misbehaving(pfrom.GetId(), 20,\n+                        strprintf(\"%s message size = %u\",\n+                                  msg_type == NetMsgType::ADDR ? \"addr\" : \"addrv2\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r500643659",
      "id" : 500643659,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY0MzY1OQ==",
      "original_commit_id" : "9502ad10020778722652e41188ae9cdb11e78cf2",
      "original_line" : 2620,
      "original_position" : 63,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 503416183,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500643659",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r500644138"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500644138"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Style nit: constants are all caps, so `ADDRV2`",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-06T23:03:51Z",
      "diff_hunk" : "@@ -76,6 +76,18 @@ extern const char* VERACK;\n  * network.\n  */\n extern const char* ADDR;\n+/**\n+ * The addrv2 message relays connection information for peers on the network just\n+ * like the addr message, but is extended to allow gossiping of longer node\n+ * addresses (see BIP155).\n+ */\n+extern const char *ADDRv2;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r500644138",
      "id" : 500644138,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY0NDEzOA==",
      "original_commit_id" : "9502ad10020778722652e41188ae9cdb11e78cf2",
      "original_line" : 84,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/protocol.h",
      "position" : null,
      "pull_request_review_id" : 503416183,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500644138",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r500644218"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500644218"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Style nit: constants are all caps, so `SENDADDRV2`.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-06T23:04:07Z",
      "diff_hunk" : "@@ -76,6 +76,18 @@ extern const char* VERACK;\n  * network.\n  */\n extern const char* ADDR;\n+/**\n+ * The addrv2 message relays connection information for peers on the network just\n+ * like the addr message, but is extended to allow gossiping of longer node\n+ * addresses (see BIP155).\n+ */\n+extern const char *ADDRv2;\n+/**\n+ * The sendaddrv2 message signals support for receiving ADDRv2 messages (BIP155).\n+ * It also implies that its sender can encode as ADDRv2 and would send ADDRv2\n+ * instead of ADDR to a peer that has signaled ADDRv2 support by sending SENDADDRv2.\n+ */\n+extern const char *SENDADDRv2;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r500644218",
      "id" : 500644218,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY0NDIxOA==",
      "original_commit_id" : "9502ad10020778722652e41188ae9cdb11e78cf2",
      "original_line" : 90,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/protocol.h",
      "position" : null,
      "pull_request_review_id" : 503416183,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500644218",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK modulo nits.\r\n\r\nI tested:\r\n* `externalip=` with torv3 address, and saw it reported in logs\r\n* upgrading a automatically generated torv2 address to a v3 one\r\n* automatically creating a torv3 address\r\n* connecting two nodes with this patch to each other, and seeing `addrv2` reported in `getpeerinfo` output\r\n",
      "created_at" : "2020-10-07T01:36:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-704641206",
      "id" : 704641206,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwNDY0MTIwNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-07T01:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/704641206",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r500862471"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500862471"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "That is also a valid point. Changed.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-07T09:18:00Z",
      "diff_hunk" : "@@ -4104,14 +4137,14 @@ bool PeerManager::SendMessages(CNode* pto)\n                     // receiver rejects addr messages larger than MAX_ADDR_TO_SEND\n                     if (vAddr.size() >= MAX_ADDR_TO_SEND)\n                     {\n-                        m_connman.PushMessage(pto, msgMaker.Make(NetMsgType::ADDR, vAddr));\n+                        m_connman.PushMessage(pto, msgMaker.Make(msg_type, vAddr));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r500862471",
      "id" : 500862471,
      "in_reply_to_id" : 499952970,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDg2MjQ3MQ==",
      "original_commit_id" : "44364147d739cc4566cd1b202f1effd6f81539d8",
      "original_line" : 4140,
      "original_position" : 93,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 503682738,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500862471",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r500863644"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500863644"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I agree, removed the `try/catch`.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-07T09:19:56Z",
      "diff_hunk" : "@@ -2582,16 +2588,37 @@ void PeerManager::ProcessMessage(CNode& pfrom, const std::string& msg_type, CDat\n         return;\n     }\n \n-    if (msg_type == NetMsgType::ADDR) {\n+    if (msg_type == NetMsgType::ADDR || msg_type == NetMsgType::ADDRv2) {\n+        int stream_version = vRecv.GetVersion();\n+        if (msg_type == NetMsgType::ADDRv2) {\n+            // Add ADDRV2_FORMAT to the version so that the CNetAddr and CAddress\n+            // unserialize methods know that an address in v2 format is coming.\n+            stream_version |= ADDRV2_FORMAT;\n+        }\n+\n+        OverrideStream<CDataStream> s(&vRecv, vRecv.GetType(), stream_version);\n         std::vector<CAddress> vAddr;\n-        vRecv >> vAddr;\n+\n+        try {\n+            s >> vAddr;\n+        } catch (const std::exception& e) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r500863644",
      "id" : 500863644,
      "in_reply_to_id" : 500642162,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDg2MzY0NA==",
      "original_commit_id" : "9502ad10020778722652e41188ae9cdb11e78cf2",
      "original_line" : 2604,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 503684364,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500863644",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r500864365"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500864365"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Changed. Btw `msg_type` is `std::string` (not `const char*`). `strprintf()` takes it either way.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-07T09:21:04Z",
      "diff_hunk" : "@@ -2582,16 +2588,37 @@ void PeerManager::ProcessMessage(CNode& pfrom, const std::string& msg_type, CDat\n         return;\n     }\n \n-    if (msg_type == NetMsgType::ADDR) {\n+    if (msg_type == NetMsgType::ADDR || msg_type == NetMsgType::ADDRv2) {\n+        int stream_version = vRecv.GetVersion();\n+        if (msg_type == NetMsgType::ADDRv2) {\n+            // Add ADDRV2_FORMAT to the version so that the CNetAddr and CAddress\n+            // unserialize methods know that an address in v2 format is coming.\n+            stream_version |= ADDRV2_FORMAT;\n+        }\n+\n+        OverrideStream<CDataStream> s(&vRecv, vRecv.GetType(), stream_version);\n         std::vector<CAddress> vAddr;\n-        vRecv >> vAddr;\n+\n+        try {\n+            s >> vAddr;\n+        } catch (const std::exception& e) {\n+            LOCK(cs_main);\n+            Misbehaving(pfrom.GetId(), 20,\n+                strprintf(\n+                    \"Supplied us with a message that contains an unparsable address: %s\",\n+                    e.what()));\n+            return;\n+        }\n \n         if (!pfrom.RelayAddrsWithConn()) {\n             return;\n         }\n         if (vAddr.size() > MAX_ADDR_TO_SEND)\n         {\n-            Misbehaving(pfrom.GetId(), 20, strprintf(\"addr message size = %u\", vAddr.size()));\n+            Misbehaving(pfrom.GetId(), 20,\n+                        strprintf(\"%s message size = %u\",\n+                                  msg_type == NetMsgType::ADDR ? \"addr\" : \"addrv2\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r500864365",
      "id" : 500864365,
      "in_reply_to_id" : 500643659,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDg2NDM2NQ==",
      "original_commit_id" : "9502ad10020778722652e41188ae9cdb11e78cf2",
      "original_line" : 2620,
      "original_position" : 63,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 503685342,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500864365",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r500864492"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500864492"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Renamed",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-07T09:21:16Z",
      "diff_hunk" : "@@ -76,6 +76,18 @@ extern const char* VERACK;\n  * network.\n  */\n extern const char* ADDR;\n+/**\n+ * The addrv2 message relays connection information for peers on the network just\n+ * like the addr message, but is extended to allow gossiping of longer node\n+ * addresses (see BIP155).\n+ */\n+extern const char *ADDRv2;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r500864492",
      "id" : 500864492,
      "in_reply_to_id" : 500644138,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDg2NDQ5Mg==",
      "original_commit_id" : "9502ad10020778722652e41188ae9cdb11e78cf2",
      "original_line" : 84,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/protocol.h",
      "position" : null,
      "pull_request_review_id" : 503685515,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500864492",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r500864676"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500864676"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Renamed",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-07T09:21:33Z",
      "diff_hunk" : "@@ -76,6 +76,18 @@ extern const char* VERACK;\n  * network.\n  */\n extern const char* ADDR;\n+/**\n+ * The addrv2 message relays connection information for peers on the network just\n+ * like the addr message, but is extended to allow gossiping of longer node\n+ * addresses (see BIP155).\n+ */\n+extern const char *ADDRv2;\n+/**\n+ * The sendaddrv2 message signals support for receiving ADDRv2 messages (BIP155).\n+ * It also implies that its sender can encode as ADDRv2 and would send ADDRv2\n+ * instead of ADDR to a peer that has signaled ADDRv2 support by sending SENDADDRv2.\n+ */\n+extern const char *SENDADDRv2;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r500864676",
      "id" : 500864676,
      "in_reply_to_id" : 500644218,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDg2NDY3Ng==",
      "original_commit_id" : "9502ad10020778722652e41188ae9cdb11e78cf2",
      "original_line" : 90,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/protocol.h",
      "position" : null,
      "pull_request_review_id" : 503685743,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500864676",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Addressed review suggestions.",
      "created_at" : "2020-10-07T09:22:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-704809252",
      "id" : 704809252,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwNDgwOTI1Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-07T09:22:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/704809252",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r501572509"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/501572509"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Does this mean that peers.dat becomes unreadable if a user choose to downgrade his node at some point in the future?\r\n\r\nYes. We can't have bitcoind-before-this-PR to read e.g. torv3 addresses from `peers.dat`.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-08T09:21:22Z",
      "diff_hunk" : "@@ -264,6 +264,17 @@ friend class CAddrManTest;\n     void SetServices_(const CService &addr, ServiceFlags nServices) EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n public:\n+    //! Serialization versions.\n+    enum class Format : uint8_t {\n+        V0_HISTORICAL = 0,    //!< historic format, before commit e6b343d88\n+        V1_DETERMINISTIC = 1, //!< for pre-asmap files\n+        V2_ASMAP = 2,         //!< for files including asmap version\n+        V3_BIP155 = 3,        //!< same as V2_ASMAP plus addresses are in BIP155 format\n+    };\n+\n+    //! Serialization / unserialization format.\n+    Format m_format = Format::V3_BIP155;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r501572509",
      "id" : 501572509,
      "in_reply_to_id" : 499932221,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTU3MjUwOQ==",
      "original_commit_id" : "03572e94cb7249165cc5333c0785e2694c620785",
      "original_line" : 276,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 504588708,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/501572509",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "~~re-ACK 1f06a2901d1ee924b95f482e8693842ee07863de~~\r\n~~Updated my nodes with the old version of this patch to the current one (and renamed the key file, the new name is good), it still works as expected.~~\r\n\r\nEdit: I have to retract this ACK for now, I'm having some problems with this PR on a FreeBSD node. It drops all outgoing connections with this dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5 merged on master (12a1c3ad1a43634d2a98717e49e3f02c4acea2fe).\r\n\r\nEdit.2: I cannot reproduce this issue in any way. I have a binary that reproduces the problem, but building the same commit doesn't reproduce it. It seems to have been a miscompile?!? In any case I doubt this is related to your specific code.\r\n\r\nEdit.3: Okay, I dived deeper in my problem here and it **100% sure** was a local miscompile issue.\r\nWhile debugging the broken binary using gdb and putting a `watch` on a node's `fDisconnect` field, I noticed something really strange: the address of the field was changing between files. The line `pfrom.fSuccessfullyConnected = true;` was setting the `fDisconnect` to true, an off-by-one error. So some incompatible/stale files were being linked when switching between branches. These had a different conception of the `CNode` structure.\r\nThe root cause is likely the `--disable-dependency-tracking` configure flag which is (or used to be) necessary to make `configure` pass on FreeBSD..\r\n\r\nSorry for the distraction. Will re-ACK.",
      "created_at" : "2020-10-08T11:22:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-705504702",
      "id" : 705504702,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwNTUwNDcwMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-10T09:11:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/705504702",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Re-reviewing and testing. I wonder if we need to warn or explain to users about the \"ERROR: DeserializeDB: Deserialize or I/O error\" and \"Invalid or missing peers.dat\" messages in the debug log if they go back to a v2 service.",
      "created_at" : "2020-10-08T15:00:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-705629597",
      "id" : 705629597,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwNTYyOTU5Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-08T15:23:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/705629597",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r501812570"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/501812570"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Does this require mention in release notes?",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-08T15:28:24Z",
      "diff_hunk" : "@@ -264,6 +264,17 @@ friend class CAddrManTest;\n     void SetServices_(const CService &addr, ServiceFlags nServices) EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n public:\n+    //! Serialization versions.\n+    enum class Format : uint8_t {\n+        V0_HISTORICAL = 0,    //!< historic format, before commit e6b343d88\n+        V1_DETERMINISTIC = 1, //!< for pre-asmap files\n+        V2_ASMAP = 2,         //!< for files including asmap version\n+        V3_BIP155 = 3,        //!< same as V2_ASMAP plus addresses are in BIP155 format\n+    };\n+\n+    //! Serialization / unserialization format.\n+    Format m_format = Format::V3_BIP155;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r501812570",
      "id" : 501812570,
      "in_reply_to_id" : 499932221,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTgxMjU3MA==",
      "original_commit_id" : "03572e94cb7249165cc5333c0785e2694c620785",
      "original_line" : 276,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 504906013,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/501812570",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r501826865"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/501826865"
         }
      },
      "author_association" : "MEMBER",
      "body" : "0e05e14\r\n```suggestion\r\n    void ignore(size_t size) const { return stream->ignore(size); }\r\n```",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-08T15:48:29Z",
      "diff_hunk" : "@@ -60,6 +60,7 @@ class OverrideStream\n     int GetVersion() const { return nVersion; }\n     int GetType() const { return nType; }\n     size_t size() const { return stream->size(); }\n+    void ignore(size_t size) { return stream->ignore(size); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r501826865",
      "id" : 501826865,
      "line" : 63,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTgyNjg2NQ==",
      "original_commit_id" : "1f06a2901d1ee924b95f482e8693842ee07863de",
      "original_line" : 63,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/streams.h",
      "position" : 4,
      "pull_request_review_id" : 504925137,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/501826865",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r501828537"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/501828537"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This seems like a possible source of user error, but I'm not sure how best to resolve it...\r\nPerhaps we could allow for `-listenonion=v2` and `-listenonion=v3`? Somehow that doesn't seem the most satisfying to me either... ",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-08T15:50:46Z",
      "diff_hunk" : "@@ -74,6 +74,15 @@ P2P and network changes\n   node using P2P relay. This version reduces the initial broadcast guarantees\n   for wallet transactions submitted via P2P to a node running the wallet. (#18038)\n \n+- The Tor onion service that is automatically created (`-listenonion`) will now\n+  be created as a Tor v3 service instead of Tor v2. The private key that was used\n+  for Tor v2 (if any) will be left untouched in `onion_private_key` in `-datadir`\n+  and can be removed if not needed. Bitcoin Core will no longer attempt to read it.\n+  The private key for the Tor v3 service will be saved in `onion_v3_private_key`.\n+  To use the deprecated Tor v2 service (not recommended), then `onion_private_key`\n+  can be copied over `onion_v3_private_key`, e.g.\n+  `cp -f onion_private_key onion_v3_private_key`.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r501828537",
      "id" : 501828537,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTgyODUzNw==",
      "original_commit_id" : "1f06a2901d1ee924b95f482e8693842ee07863de",
      "original_line" : 92,
      "original_position" : 11,
      "original_start_line" : 82,
      "path" : "doc/release-notes.md",
      "position" : null,
      "pull_request_review_id" : 504927305,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/501828537",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r501834717"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/501834717"
         }
      },
      "author_association" : "MEMBER",
      "body" : "93c8f0ea suggestion (like `GetBIP155Network`)\r\n```diff\r\n-    }\r\n-\r\n-    return false;\r\n+    } // no default case, so the compiler can warn about missing cases\r\n+    assert(false);\r\n }\r\n```\r\n",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-08T15:59:36Z",
      "diff_hunk" : "@@ -474,6 +474,26 @@ bool CNetAddr::IsInternal() const\n    return m_net == NET_INTERNAL;\n }\n \n+bool CNetAddr::IsAddrV1Compatible() const\n+{\n+    switch (m_net) {\n+    case NET_IPV4:\n+    case NET_IPV6:\n+    case NET_INTERNAL:\n+        return true;\n+    case NET_ONION:\n+        return m_addr.size() == ADDR_TORV2_SIZE;\n+    case NET_I2P:\n+    case NET_CJDNS:\n+        return false;\n+    case NET_UNROUTABLE: // m_net is never and should not be set to NET_UNROUTABLE\n+    case NET_MAX:        // m_net is never and should not be set to NET_MAX\n+        assert(false);\n+    }\n+\n+    return false;\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r501834717",
      "id" : 501834717,
      "line" : 495,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTgzNDcxNw==",
      "original_commit_id" : "1f06a2901d1ee924b95f482e8693842ee07863de",
      "original_line" : 495,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/netaddress.cpp",
      "position" : 22,
      "pull_request_review_id" : 504925137,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/501834717",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Just to clarify (assuming this PR goes in 0.21): the format of `peers.dat` is changed in a backwards-incompatible way. Meaning that 0.20 and older will be unable to read `peers.dat` written by 0.21 or newer. This boils down to the fact that 0.20 and older cannot read e.g. torv3 addresses encoded in BIP155-addrv2 format.\r\n\r\nThis is not related in any way to the `onion_private_key` and `onion_v3_private_key` files and whether the node creates an onion service or not.",
      "created_at" : "2020-10-08T16:05:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-705669756",
      "id" : 705669756,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwNTY2OTc1Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-08T16:05:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/705669756",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r501840169"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/501840169"
         }
      },
      "author_association" : "MEMBER",
      "body" : "1f06a2901d1ee924b95f482e8693842ee07863de Perhaps inform users of the debug log messages, e.g. `ERROR: DeserializeDB: Deserialize or I/O error` and `Invalid or missing peers.dat`, that they may see if they use tor v2 henceforth, at least per my testing.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-08T16:07:43Z",
      "diff_hunk" : "@@ -74,6 +74,15 @@ P2P and network changes\n   node using P2P relay. This version reduces the initial broadcast guarantees\n   for wallet transactions submitted via P2P to a node running the wallet. (#18038)\n \n+- The Tor onion service that is automatically created (`-listenonion`) will now\n+  be created as a Tor v3 service instead of Tor v2. The private key that was used\n+  for Tor v2 (if any) will be left untouched in `onion_private_key` in `-datadir`\n+  and can be removed if not needed. Bitcoin Core will no longer attempt to read it.\n+  The private key for the Tor v3 service will be saved in `onion_v3_private_key`.\n+  To use the deprecated Tor v2 service (not recommended), then `onion_private_key`\n+  can be copied over `onion_v3_private_key`, e.g.\n+  `cp -f onion_private_key onion_v3_private_key`.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r501840169",
      "id" : 501840169,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg0MDE2OQ==",
      "original_commit_id" : "1f06a2901d1ee924b95f482e8693842ee07863de",
      "original_line" : 92,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "doc/release-notes.md",
      "position" : null,
      "pull_request_review_id" : 504925137,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/501840169",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Just to clarify (assuming this PR goes in 0.21): the format of `peers.dat` is changed in a backwards-incompatible way. Meaning that 0.20 and older will be unable to read `peers.dat` written by 0.21 or newer. This boils down to the fact that 0.20 and older cannot read e.g. torv3 addresses encoded in BIP155-addrv2 format.\r\n\r\nIndeed, it seems we need to be clear about informing people of this backward incompatibility with regards to peers.dat. Empirically, it looks like it's related to using the v2 private key but it may not be the actual case.",
      "created_at" : "2020-10-08T16:53:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-705696713",
      "id" : 705696713,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwNTY5NjcxMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-08T16:53:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/705696713",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502227966"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502227966"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Personally, I think it would be ok to not support v2 addresses at all anymore. Given the short time they have left. But that there's a workaround (even if clunky) might help for some people.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-09T07:04:34Z",
      "diff_hunk" : "@@ -74,6 +74,15 @@ P2P and network changes\n   node using P2P relay. This version reduces the initial broadcast guarantees\n   for wallet transactions submitted via P2P to a node running the wallet. (#18038)\n \n+- The Tor onion service that is automatically created (`-listenonion`) will now\n+  be created as a Tor v3 service instead of Tor v2. The private key that was used\n+  for Tor v2 (if any) will be left untouched in `onion_private_key` in `-datadir`\n+  and can be removed if not needed. Bitcoin Core will no longer attempt to read it.\n+  The private key for the Tor v3 service will be saved in `onion_v3_private_key`.\n+  To use the deprecated Tor v2 service (not recommended), then `onion_private_key`\n+  can be copied over `onion_v3_private_key`, e.g.\n+  `cp -f onion_private_key onion_v3_private_key`.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502227966",
      "id" : 502227966,
      "in_reply_to_id" : 501828537,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjIyNzk2Ng==",
      "original_commit_id" : "1f06a2901d1ee924b95f482e8693842ee07863de",
      "original_line" : 92,
      "original_position" : 11,
      "original_start_line" : 82,
      "path" : "doc/release-notes.md",
      "position" : null,
      "pull_request_review_id" : 505410868,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502227966",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Just to clarify (assuming this PR goes in 0.21): the format of peers.dat is changed in a backwards-incompatible way. Meaning that 0.20 and older will be unable to read peers.dat written by 0.21 or newer. This boils down to the fact that 0.20 and older cannot read e.g. torv3 addresses encoded in BIP155-addrv2 format.\r\n\r\nThis only means starting with (effectively) an empty peers.dat if you downgrade to a pre-0.21 version, right? That's okay. Loss of peers.dat is not a big deal to most users. As long as it doesn't result in the program *not starting at all*. That would be kind of unfriendly.\r\n\r\n(Nevertheless, it does make sense to mention the `peers.dat` format change and consequences in the release notes)",
      "created_at" : "2020-10-09T07:06:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-706011334",
      "id" : 706011334,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwNjAxMTMzNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-09T07:12:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/706011334",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Earlier today on IRC:\r\n\r\n```\r\n13:39:37 < vasild> CAddress::unser: time=1601829922, services=134218813, addr=62.107.200.30:8333\r\n13:39:56 < vasild> CAddress::unser: time=1600339981, services=134217741, addr=akinbo7tlegsnsxn.onion:8333\r\n13:40:31 < vasild> jonatack: wumpus: so...\r\n13:41:05 < vasild> in the network there are some peers with services=unusually high value\r\n13:42:07 < sipa> that's 0x0800000d\r\n13:42:14 < vasild> they get in via p2p gossip into addrman without causing problems\r\n13:42:16 < vasild> sipa: right\r\n13:43:18 < vasild> using addrv1\r\n13:44:03 < vasild> then addrman saves it on disk just fine in V3_BIP155 format using READWRITE(COMPACTSIZE(services_tmp))\r\n13:44:44 < vasild> however, on read back from disk it bricks because ReadCompactSize() contains this at the end:\r\n13:44:53 < vasild>     if (nSizeRet > (uint64_t)MAX_SIZE)\r\n13:44:54 < vasild>         throw std::ios_base::failure(\"ReadCompactSize(): size too large\");\r\n13:45:18 < vasild> and MAX_SIZE is quite low value 0x02000000\r\n13:45:48 < vasild> I wondered before wtf is that limit but decided it is harmless\r\n13:46:14 < sipa> vasild: ehhhh\r\n13:46:27 < sipa> this means we need to bypass that limit when deserializing addrv2\r\n13:46:46 < vasild> so WriteCompactSize() can write >0x02000000 but ReadCompactSize() cannot read it back :-X\r\n```\r\n\r\nI wrote a small patch that allows bypassing the range check in ReadCompactSize: https://github.com/sipa/bitcoin/commits/202010_compactsize_bound. Feel free to cherry-pick or squash. It allows using without range check using `Using<CompactSizeFormatter<false>>(obj)` instead of `COMPACTSIZE(obj)`.",
      "created_at" : "2020-10-09T07:08:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-706012255",
      "id" : 706012255,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwNjAxMjI1NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-09T07:08:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/706012255",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> 13:46:46 < vasild> so WriteCompactSize() can write >0x02000000 but ReadCompactSize() cannot read it back :-X\r\n\r\nOuch, good catch! This makes me doubt the choice to use a `CompactSize` for anything else than a size a little. It seems like misuse of a typed value. @sipa's patch to allow to bypass the check would solve the immediate issue, I just hope it won't cause problems for maintainers in the future again if other sanity checks are added, with people thinking they'll be size specific.",
      "created_at" : "2020-10-09T07:22:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-706017747",
      "id" : 706017747,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwNjAxNzc0Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-09T07:22:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/706017747",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@laanwj Well, they're already used as non-size values in BIP152, though luckily they're restricted to 16-bit values there, so the range limit was not an issue.\n\nI think it's fine to use it in BIP155 as well. The code is a bit confusing but perhaps we should just rename CompactSize to something else at some point. It's already known under other names outside Bitcoin Core anyway.",
      "created_at" : "2020-10-09T07:26:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-706019630",
      "id" : 706019630,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwNjAxOTYzMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-09T07:26:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/706019630",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> This only means starting with (effectively) an empty peers.dat if you downgrade to a pre-0.21 version, right?\r\n\r\nYes, that's what I'm seeing.\r\n\r\n> (Nevertheless, it does make sense to mention the `peers.dat` format change and consequences in the release notes)\r\n\r\n:+1: ",
      "created_at" : "2020-10-09T07:33:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-706022112",
      "id" : 706022112,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwNjAyMjExMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-09T07:34:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/706022112",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502257883"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502257883"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "@laanwj, I agree, given torv2 addresses will cease in less than a year - no need to add new config options (or extend existent ones) only to deprecate them immediately.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-09T08:06:27Z",
      "diff_hunk" : "@@ -74,6 +74,15 @@ P2P and network changes\n   node using P2P relay. This version reduces the initial broadcast guarantees\n   for wallet transactions submitted via P2P to a node running the wallet. (#18038)\n \n+- The Tor onion service that is automatically created (`-listenonion`) will now\n+  be created as a Tor v3 service instead of Tor v2. The private key that was used\n+  for Tor v2 (if any) will be left untouched in `onion_private_key` in `-datadir`\n+  and can be removed if not needed. Bitcoin Core will no longer attempt to read it.\n+  The private key for the Tor v3 service will be saved in `onion_v3_private_key`.\n+  To use the deprecated Tor v2 service (not recommended), then `onion_private_key`\n+  can be copied over `onion_v3_private_key`, e.g.\n+  `cp -f onion_private_key onion_v3_private_key`.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502257883",
      "id" : 502257883,
      "in_reply_to_id" : 501828537,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjI1Nzg4Mw==",
      "original_commit_id" : "1f06a2901d1ee924b95f482e8693842ee07863de",
      "original_line" : 92,
      "original_position" : 11,
      "original_start_line" : 82,
      "path" : "doc/release-notes.md",
      "position" : null,
      "pull_request_review_id" : 505449321,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502257883",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502261017"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502261017"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`ignore()` modifies the state of the stream. It is not `const` in `CDataStream` and `CAutoFile` so this would not compile.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-09T08:12:07Z",
      "diff_hunk" : "@@ -60,6 +60,7 @@ class OverrideStream\n     int GetVersion() const { return nVersion; }\n     int GetType() const { return nType; }\n     size_t size() const { return stream->size(); }\n+    void ignore(size_t size) { return stream->ignore(size); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502261017",
      "id" : 502261017,
      "in_reply_to_id" : 501826865,
      "line" : 63,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjI2MTAxNw==",
      "original_commit_id" : "1f06a2901d1ee924b95f482e8693842ee07863de",
      "original_line" : 63,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/streams.h",
      "position" : 4,
      "pull_request_review_id" : 505454458,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502261017",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502280047"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502280047"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It does compile (I test if my suggestions compile before making them), though arguably const on a void function may not make sense. Consider this suggestion a question.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-09T08:45:19Z",
      "diff_hunk" : "@@ -60,6 +60,7 @@ class OverrideStream\n     int GetVersion() const { return nVersion; }\n     int GetType() const { return nType; }\n     size_t size() const { return stream->size(); }\n+    void ignore(size_t size) { return stream->ignore(size); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502280047",
      "id" : 502280047,
      "in_reply_to_id" : 501826865,
      "line" : 63,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjI4MDA0Nw==",
      "original_commit_id" : "1f06a2901d1ee924b95f482e8693842ee07863de",
      "original_line" : 63,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/streams.h",
      "position" : 4,
      "pull_request_review_id" : 505478415,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502280047",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502292684"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502292684"
         }
      },
      "author_association" : "MEMBER",
      "body" : "\"void f() const makes the function itself const. This only really has meaning for member functions. Making a member function const means that it cannot call any non-const member functions, nor can it change any member variables. It also means that the function can be called via a const object of the class.\" http://www.cplusplus.com/forum/general/12087/ (reply in 2009)\r\n\r\nalso: https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#con2-by-default-make-member-functions-const",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-09T09:07:08Z",
      "diff_hunk" : "@@ -60,6 +60,7 @@ class OverrideStream\n     int GetVersion() const { return nVersion; }\n     int GetType() const { return nType; }\n     size_t size() const { return stream->size(); }\n+    void ignore(size_t size) { return stream->ignore(size); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502292684",
      "id" : 502292684,
      "in_reply_to_id" : 501826865,
      "line" : 63,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjI5MjY4NA==",
      "original_commit_id" : "1f06a2901d1ee924b95f482e8693842ee07863de",
      "original_line" : 63,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/streams.h",
      "position" : 4,
      "pull_request_review_id" : 505494557,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502292684",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502295708"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502295708"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Added a release notes mention.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-09T09:12:35Z",
      "diff_hunk" : "@@ -74,6 +74,15 @@ P2P and network changes\n   node using P2P relay. This version reduces the initial broadcast guarantees\n   for wallet transactions submitted via P2P to a node running the wallet. (#18038)\n \n+- The Tor onion service that is automatically created (`-listenonion`) will now\n+  be created as a Tor v3 service instead of Tor v2. The private key that was used\n+  for Tor v2 (if any) will be left untouched in `onion_private_key` in `-datadir`\n+  and can be removed if not needed. Bitcoin Core will no longer attempt to read it.\n+  The private key for the Tor v3 service will be saved in `onion_v3_private_key`.\n+  To use the deprecated Tor v2 service (not recommended), then `onion_private_key`\n+  can be copied over `onion_v3_private_key`, e.g.\n+  `cp -f onion_private_key onion_v3_private_key`.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502295708",
      "id" : 502295708,
      "in_reply_to_id" : 501840169,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjI5NTcwOA==",
      "original_commit_id" : "1f06a2901d1ee924b95f482e8693842ee07863de",
      "original_line" : 92,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "doc/release-notes.md",
      "position" : null,
      "pull_request_review_id" : 505498483,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502295708",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502295809"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502295809"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-09T09:12:45Z",
      "diff_hunk" : "@@ -474,6 +474,26 @@ bool CNetAddr::IsInternal() const\n    return m_net == NET_INTERNAL;\n }\n \n+bool CNetAddr::IsAddrV1Compatible() const\n+{\n+    switch (m_net) {\n+    case NET_IPV4:\n+    case NET_IPV6:\n+    case NET_INTERNAL:\n+        return true;\n+    case NET_ONION:\n+        return m_addr.size() == ADDR_TORV2_SIZE;\n+    case NET_I2P:\n+    case NET_CJDNS:\n+        return false;\n+    case NET_UNROUTABLE: // m_net is never and should not be set to NET_UNROUTABLE\n+    case NET_MAX:        // m_net is never and should not be set to NET_MAX\n+        assert(false);\n+    }\n+\n+    return false;\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502295809",
      "id" : 502295809,
      "in_reply_to_id" : 501834717,
      "line" : 495,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjI5NTgwOQ==",
      "original_commit_id" : "1f06a2901d1ee924b95f482e8693842ee07863de",
      "original_line" : 495,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/netaddress.cpp",
      "position" : 22,
      "pull_request_review_id" : 505498591,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502295809",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502296690"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502296690"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think it should not be `const` because it modifies the state of the stream. I guess it is not `const` for the same reason in the other stream classes.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-09T09:14:21Z",
      "diff_hunk" : "@@ -60,6 +60,7 @@ class OverrideStream\n     int GetVersion() const { return nVersion; }\n     int GetType() const { return nType; }\n     size_t size() const { return stream->size(); }\n+    void ignore(size_t size) { return stream->ignore(size); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502296690",
      "id" : 502296690,
      "in_reply_to_id" : 501826865,
      "line" : 63,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjI5NjY5MA==",
      "original_commit_id" : "1f06a2901d1ee924b95f482e8693842ee07863de",
      "original_line" : 63,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/streams.h",
      "position" : 4,
      "pull_request_review_id" : 505499825,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502296690",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Addressed review suggestions plus\r\n\r\n* Added release notes on the `peers.dat` format change\r\n* Made it possible to read big compact-size numbers (thanks to @sipa for the patch) this will enable addrman to read arbitrary big service flags from its database and also for the p2p layer to receive them when in `addrv2` encoding (the old `addr` encoding uses fixed 8-byte representation)\r\n* Added a human-readable error message if addrman detects a future format of `peers.dat`",
      "created_at" : "2020-10-09T09:20:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-706071612",
      "id" : 706071612,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwNjA3MTYxMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-09T09:20:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/706071612",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502301880"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502301880"
         }
      },
      "author_association" : "MEMBER",
      "body" : "1d3ec2a nit\r\n```suggestion\r\n * (e.g. for vectors) when the size is encoded as CompactSize.\r\n```",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-09T09:23:20Z",
      "diff_hunk" : "@@ -24,7 +24,11 @@\n #include <prevector.h>\n #include <span.h>\n \n-static const unsigned int MAX_SIZE = 0x02000000;\n+/**\n+ * The maximum size of a serialized object in bytes or number of elements\n+ * (for eg vectors) when the size is encoded as CompactSize.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502301880",
      "id" : 502301880,
      "line" : 29,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjMwMTg4MA==",
      "original_commit_id" : "9b56a68a85ce32b13d3db605ac56bb9743437d2f",
      "original_line" : 29,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/serialize.h",
      "position" : 7,
      "pull_request_review_id" : 505506381,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502301880",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Initial updated suggestion for the release notes, though I am sure it can be improved further (pinging @harding). It may need to be edited by hand in the wiki if the notes have already been merged and branched off.\r\n\r\n```\r\nMigration from deprecated Tor v2 to Tor v3\r\n-----------------------\r\nThe Tor onion service that is automatically created (`-listenonion`) will now be\r\ncreated as a Tor v3 service instead of Tor v2. The private key that was used for\r\nTor v2 (if any) will be left untouched in `onion_private_key` in `-datadir` and\r\ncan be removed if not needed. Bitcoin Core will no longer attempt to read it.\r\nThe private key for the Tor v3 service will be saved in `onion_v3_private_key`.\r\nTo use the deprecated Tor v2 service (not recommended), the `onion_private_key` file\r\ncan be copied over `onion_v3_private_key`, e.g. `cp -f onion_private_key\r\nonion_v3_private_key`. (#19954)\r\n\r\nPeers.dat file format change\r\n-----------------------\r\nThe node's known peers are persisted to disk in a file called `peers.dat`. Starting\r\nwith this v0.21.0 release, the `peers.dat` file format is changed in a backwards-incompatible\r\nway to accommodate the storage of large BIP155 addresses, such as Tor v3 addresses.\r\nPre-0.21 Bitcoin Core software will not be able to read this new `peers.dat` format. In the\r\nevent of downgrading to pre-0.21 after running 0.21, the debug log may print an error that\r\ndeserialization has failed and a message that peers.dat is invalid or missing and is being\r\nrecreated, and bitcoind will continue normal operation with a new `peers.dat` file. (#19954)\r\n```\r\n",
      "created_at" : "2020-10-09T09:55:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-706087447",
      "id" : 706087447,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwNjA4NzQ0Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-09T12:34:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/706087447",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502333178"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502333178"
         }
      },
      "author_association" : "MEMBER",
      "body" : "6fce3ce maybe\r\n```suggestion\r\n                \"Continuing operation by creating a new peers.dat file in the maximum supported format\",\r\n```\r\ncurrently (for me on debian) it would print\r\n\r\n`ERROR: DeserializeDB: Deserialize or I/O error - Unsupported format of addrman database: 4. Maximum supported is 3. Continuing operation without using the saved list of peers.: iostream error`",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-09T10:22:46Z",
      "diff_hunk" : "@@ -370,14 +382,34 @@ friend class CAddrManTest;\n         s << asmap_version;\n     }\n \n-    template<typename Stream>\n-    void Unserialize(Stream& s)\n+    template <typename Stream>\n+    void Unserialize(Stream& s_)\n     {\n         LOCK(cs);\n \n         Clear();\n-        unsigned char nVersion;\n-        s >> nVersion;\n+\n+        Format format;\n+        s_ >> Using<CustomUintFormatter<1>>(format);\n+\n+        static constexpr Format maximum_supported_format = Format::V3_BIP155;\n+        if (format > maximum_supported_format) {\n+            throw std::ios_base::failure(strprintf(\n+                \"Unsupported format of addrman database: %u. Maximum supported is %u. \"\n+                \"Continuing operation without using the saved list of peers.\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502333178",
      "id" : 502333178,
      "line" : 399,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjMzMzE3OA==",
      "original_commit_id" : "9b56a68a85ce32b13d3db605ac56bb9743437d2f",
      "original_line" : 399,
      "original_position" : 77,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 77,
      "pull_request_review_id" : 505506381,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502333178",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502350905"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502350905"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The dot terminates the doxygen title.\r\n![dox1](https://user-images.githubusercontent.com/266751/95575574-3abae680-0a2f-11eb-91e7-8b39ef12e317.jpg)\r\n![dox2](https://user-images.githubusercontent.com/266751/95575577-3b537d00-0a2f-11eb-98df-659dd55565dc.jpg)\r\n",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-09T11:00:08Z",
      "diff_hunk" : "@@ -24,7 +24,11 @@\n #include <prevector.h>\n #include <span.h>\n \n-static const unsigned int MAX_SIZE = 0x02000000;\n+/**\n+ * The maximum size of a serialized object in bytes or number of elements\n+ * (for eg vectors) when the size is encoded as CompactSize.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502350905",
      "id" : 502350905,
      "in_reply_to_id" : 502301880,
      "line" : 29,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjM1MDkwNQ==",
      "original_commit_id" : "9b56a68a85ce32b13d3db605ac56bb9743437d2f",
      "original_line" : 29,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/serialize.h",
      "position" : 7,
      "pull_request_review_id" : 505571377,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502350905",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502355359"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502355359"
         }
      },
      "author_association" : "MEMBER",
      "body" : "TIL, thanks. Apparently, per https://www.doxygen.nl/manual/docblocks.html#docexamples: \"To enable this behavior you should set JAVADOC_AUTOBRIEF to YES in the configuration file. If you enable this option and want to put a dot in the middle of a sentence without ending it, you should put a backslash and a space after it. Here is an example: `/** Brief description (e.g.\\ using only a few words). Details follow. */`\"\r\n\r\nIndeed, doesn't seem worth it.\r\n",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-09T11:10:11Z",
      "diff_hunk" : "@@ -24,7 +24,11 @@\n #include <prevector.h>\n #include <span.h>\n \n-static const unsigned int MAX_SIZE = 0x02000000;\n+/**\n+ * The maximum size of a serialized object in bytes or number of elements\n+ * (for eg vectors) when the size is encoded as CompactSize.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502355359",
      "id" : 502355359,
      "in_reply_to_id" : 502301880,
      "line" : 29,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjM1NTM1OQ==",
      "original_commit_id" : "9b56a68a85ce32b13d3db605ac56bb9743437d2f",
      "original_line" : 29,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/serialize.h",
      "position" : 7,
      "pull_request_review_id" : 505577316,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502355359",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jonatack The peers.dat text looks fine to me.  Here's a few suggestions for the v3 onion service text, but I also think that was fine.\r\n\r\n```diff\r\n-The Tor onion service that is automatically created (`-listenonion`) will now be\r\n+The Tor onion service that is automatically created by setting the `-listenonion` configuration parameter will now be\r\n created as a Tor v3 service instead of Tor v2. The private key that was used for\r\n-Tor v2 (if any) will be left untouched in `onion_private_key` in `-datadir` and\r\n+Tor v2 (if any) will be left untouched in the `onion_private_key` file in the data directory (see `-datadir`)  and\r\n can be removed if not needed. Bitcoin Core will no longer attempt to read it.\r\n-The private key for the Tor v3 service will be saved in `onion_v3_private_key`.\r\n+The private key for the Tor v3 service will be saved in a file named `onion_v3_private_key`.\r\n To use the deprecated Tor v2 service (not recommended), then `onion_private_key`\r\n can be copied over `onion_v3_private_key`, e.g. `cp -f onion_private_key\r\n onion_v3_private_key`. (#19954)\r\n```",
      "created_at" : "2020-10-09T12:27:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-706151636",
      "id" : 706151636,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwNjE1MTYzNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-09T12:27:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/706151636",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/61096?v=4",
         "events_url" : "https://api.github.com/users/harding/events{/privacy}",
         "followers_url" : "https://api.github.com/users/harding/followers",
         "following_url" : "https://api.github.com/users/harding/following{/other_user}",
         "gists_url" : "https://api.github.com/users/harding/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/harding",
         "id" : 61096,
         "login" : "harding",
         "node_id" : "MDQ6VXNlcjYxMDk2",
         "organizations_url" : "https://api.github.com/users/harding/orgs",
         "received_events_url" : "https://api.github.com/users/harding/received_events",
         "repos_url" : "https://api.github.com/users/harding/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/harding/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/harding/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/harding"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks @harding!",
      "created_at" : "2020-10-09T12:32:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-706153861",
      "id" : 706153861,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwNjE1Mzg2MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-09T12:32:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/706153861",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Did some rewording of the release notes, mostly as suggested.",
      "created_at" : "2020-10-09T14:46:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-706224142",
      "id" : 706224142,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwNjIyNDE0Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-09T14:50:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/706224142",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502482433"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502482433"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "\"Continuing operation by creating a new peers.dat\" is, strictly speaking, not true because the new `peers.dat` will not be created at the time this message is printed. It will be created later during shutdown or during one of the periodic dumps to disk.\r\n\r\nI left it as is.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-09T14:49:12Z",
      "diff_hunk" : "@@ -370,14 +382,34 @@ friend class CAddrManTest;\n         s << asmap_version;\n     }\n \n-    template<typename Stream>\n-    void Unserialize(Stream& s)\n+    template <typename Stream>\n+    void Unserialize(Stream& s_)\n     {\n         LOCK(cs);\n \n         Clear();\n-        unsigned char nVersion;\n-        s >> nVersion;\n+\n+        Format format;\n+        s_ >> Using<CustomUintFormatter<1>>(format);\n+\n+        static constexpr Format maximum_supported_format = Format::V3_BIP155;\n+        if (format > maximum_supported_format) {\n+            throw std::ios_base::failure(strprintf(\n+                \"Unsupported format of addrman database: %u. Maximum supported is %u. \"\n+                \"Continuing operation without using the saved list of peers.\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502482433",
      "id" : 502482433,
      "in_reply_to_id" : 502333178,
      "line" : 399,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQ4MjQzMw==",
      "original_commit_id" : "9b56a68a85ce32b13d3db605ac56bb9743437d2f",
      "original_line" : 399,
      "original_position" : 77,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 77,
      "pull_request_review_id" : 505745488,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-09T14:49:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502482433",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Tested that spinning up a v3 onion and connecting to it still works as of dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5. The PR title should probably mention that we start using `sendaddrv2` here, with TorV3 just being the cherry on top.",
      "created_at" : "2020-10-09T17:43:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-706316340",
      "id" : 706316340,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwNjMxNjM0MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-09T17:43:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/706316340",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502715960"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502715960"
         }
      },
      "author_association" : "MEMBER",
      "body" : "As `maximum_supported_format` is currently V3_BIP155, the format should never be superior otherwise it would have throw L397. Did this is an attempt to future-proof  bump of the serialization format ? A future serialization format may override ADDRV2_FORMAT.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-09T23:54:07Z",
      "diff_hunk" : "@@ -370,14 +382,34 @@ friend class CAddrManTest;\n         s << asmap_version;\n     }\n \n-    template<typename Stream>\n-    void Unserialize(Stream& s)\n+    template <typename Stream>\n+    void Unserialize(Stream& s_)\n     {\n         LOCK(cs);\n \n         Clear();\n-        unsigned char nVersion;\n-        s >> nVersion;\n+\n+        Format format;\n+        s_ >> Using<CustomUintFormatter<1>>(format);\n+\n+        static constexpr Format maximum_supported_format = Format::V3_BIP155;\n+        if (format > maximum_supported_format) {\n+            throw std::ios_base::failure(strprintf(\n+                \"Unsupported format of addrman database: %u. Maximum supported is %u. \"\n+                \"Continuing operation without using the saved list of peers.\",\n+                static_cast<uint8_t>(format),\n+                static_cast<uint8_t>(maximum_supported_format)));\n+        }\n+\n+        int stream_version = s_.GetVersion();\n+        if (format >= Format::V3_BIP155) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502715960",
      "id" : 502715960,
      "line" : 405,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjcxNTk2MA==",
      "original_commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "original_line" : 405,
      "original_position" : 83,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 83,
      "pull_request_review_id" : 506041004,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-10T01:10:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502715960",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502719748"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502719748"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think the BIP could be clearer on `addr/addrv2` processing responsibility once a `sendaddrv2` is received. \r\n\r\nOnce a `sendaddrv2` is received from a peer, a node :\r\n* MUST use `addrv2` messages to gossip addresses\r\n* MUST accept `addrv2`messages\r\n* MAY accept `addr` messages\r\n\r\nI guess it's better to be liberal with acceptance of legacy `addr` messages from `addrv2`-signaling peers (AFAICT what this PR does) to avoid loosing a potentially good block/tx-relay peer, even if it's a clear hint of a buggy BIP155 implementation.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-10T00:17:26Z",
      "diff_hunk" : "@@ -868,6 +868,11 @@ class CNode\n     bool m_legacyWhitelisted{false};\n     bool fClient{false}; // set by version message\n     bool m_limited_node{false}; //after BIP159, set by version message\n+    /**\n+     * Whether the peer has signaled support for receiving ADDRv2 (BIP155)\n+     * messages, implying a preference to receive ADDRv2 instead of ADDR ones.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502719748",
      "id" : 502719748,
      "line" : 873,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjcxOTc0OA==",
      "original_commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "original_line" : 873,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 6,
      "pull_request_review_id" : 506041004,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-10T01:10:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502719748",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502722714"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502722714"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this check could be part of the net_processing layer, thus saving a function call in case of not-supported address as nothing is done otherwise. Further, it avoids having `m_wants_addrv2` in `CNode` which may contradict @jnewbery 's #19398, especially this PoC cleaning branch : https://github.com/jnewbery/bitcoin/commit/6fb753520787e13b5fdcbf835be781506537841b\r\n\r\nThat said, gathering the check here likely avoids duplicating checks in net_processing, and it can be clean-up later if it considered as worthy.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-10T00:40:30Z",
      "diff_hunk" : "@@ -1115,11 +1120,16 @@ class CNode\n \n     void PushAddress(const CAddress& _addr, FastRandomContext &insecure_rand)\n     {\n+        // Whether the peer supports the address in `_addr`. For example,\n+        // nodes that do not implement BIP155 cannot receive Tor v3 addresses\n+        // because they require ADDRv2 (BIP155) encoding.\n+        const bool addr_format_supported = m_wants_addrv2 || _addr.IsAddrV1Compatible();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502722714",
      "id" : 502722714,
      "line" : 1126,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjcyMjcxNA==",
      "original_commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "original_line" : 1126,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 19,
      "pull_request_review_id" : 506041004,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-10T01:10:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502722714",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502724858"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502724858"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It might be interesting to underscore in comment that an address discovered from a BIP155 upgraded peer will be relayed further (`RelayAddress`) to non-upgraded ones through legacy `addr` message if the contained address is understood. \r\n\r\nI think it should even be part of the BIP to make a best-effort of BIP155 implementations filtering and relaying forward to non-upgraded peers addresses initially discovered through `addrv2`. What you want to avoid is a node failing to relay a whole ADDRV2 blob to non-upgraded peers, without extracting the peer-understood addresses.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-10T00:58:42Z",
      "diff_hunk" : "@@ -2582,16 +2588,25 @@ void PeerManager::ProcessMessage(CNode& pfrom, const std::string& msg_type, CDat\n         return;\n     }\n \n-    if (msg_type == NetMsgType::ADDR) {\n+    if (msg_type == NetMsgType::ADDR || msg_type == NetMsgType::ADDRV2) {\n+        int stream_version = vRecv.GetVersion();\n+        if (msg_type == NetMsgType::ADDRV2) {\n+            // Add ADDRV2_FORMAT to the version so that the CNetAddr and CAddress\n+            // unserialize methods know that an address in v2 format is coming.\n+            stream_version |= ADDRV2_FORMAT;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502724858",
      "id" : 502724858,
      "line" : 2596,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjcyNDg1OA==",
      "original_commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "original_line" : 2596,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 37,
      "pull_request_review_id" : 506041004,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-10T01:10:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502724858",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502783796"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502783796"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, this code will now only be reached if `format == V3_BIP155`. In the future `format` may be higher. By using `>=` we assume that a future format `V4_FOO` will also use `addrv2` encoding in which case this code will not have to be changed. If a future `V4_FOO` does not use `addrv2`, then this line will have to be changed to `==`.\r\n\r\nNotice however that if we use `==` now and a future `V4_FOO` still uses `addrv2`, then this line will have to be changed from `==` to `>=`.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-10T12:07:59Z",
      "diff_hunk" : "@@ -370,14 +382,34 @@ friend class CAddrManTest;\n         s << asmap_version;\n     }\n \n-    template<typename Stream>\n-    void Unserialize(Stream& s)\n+    template <typename Stream>\n+    void Unserialize(Stream& s_)\n     {\n         LOCK(cs);\n \n         Clear();\n-        unsigned char nVersion;\n-        s >> nVersion;\n+\n+        Format format;\n+        s_ >> Using<CustomUintFormatter<1>>(format);\n+\n+        static constexpr Format maximum_supported_format = Format::V3_BIP155;\n+        if (format > maximum_supported_format) {\n+            throw std::ios_base::failure(strprintf(\n+                \"Unsupported format of addrman database: %u. Maximum supported is %u. \"\n+                \"Continuing operation without using the saved list of peers.\",\n+                static_cast<uint8_t>(format),\n+                static_cast<uint8_t>(maximum_supported_format)));\n+        }\n+\n+        int stream_version = s_.GetVersion();\n+        if (format >= Format::V3_BIP155) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502783796",
      "id" : 502783796,
      "in_reply_to_id" : 502715960,
      "line" : 405,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc4Mzc5Ng==",
      "original_commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "original_line" : 405,
      "original_position" : 83,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 83,
      "pull_request_review_id" : 506092744,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-10T12:07:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502783796",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502785105"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502785105"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Do you mean this?\r\n\r\n> Once `B` receives `sendaddrv2` from `A`:\r\n>\r\n> * `B` MUST use `addrv2` messages to gossip addresses to `A`\r\n> * `B` MUST accept `addrv2` messages from `A`\r\n> * `B` MAY accept `addr` messages from `A`\r\n\r\nThe current PR accepts both `addr` and `addrv2` no matter whether `sendaddrv2` has been sent or received.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-10T12:23:38Z",
      "diff_hunk" : "@@ -868,6 +868,11 @@ class CNode\n     bool m_legacyWhitelisted{false};\n     bool fClient{false}; // set by version message\n     bool m_limited_node{false}; //after BIP159, set by version message\n+    /**\n+     * Whether the peer has signaled support for receiving ADDRv2 (BIP155)\n+     * messages, implying a preference to receive ADDRv2 instead of ADDR ones.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502785105",
      "id" : 502785105,
      "in_reply_to_id" : 502719748,
      "line" : 873,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc4NTEwNQ==",
      "original_commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "original_line" : 873,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 6,
      "pull_request_review_id" : 506093649,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-10T12:23:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502785105",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502787260"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502787260"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`addr` and `addrv2` are just a transport encodings. Once received, the address is not in any particular encoding, it is a `CAddress` object in the memory of the node, not in `addr` nor in `addrv2` encoding.\r\n\r\nSo, when we further relay a `CAddress` object we don't care in what encoding we received it.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-10T12:48:28Z",
      "diff_hunk" : "@@ -2582,16 +2588,25 @@ void PeerManager::ProcessMessage(CNode& pfrom, const std::string& msg_type, CDat\n         return;\n     }\n \n-    if (msg_type == NetMsgType::ADDR) {\n+    if (msg_type == NetMsgType::ADDR || msg_type == NetMsgType::ADDRV2) {\n+        int stream_version = vRecv.GetVersion();\n+        if (msg_type == NetMsgType::ADDRV2) {\n+            // Add ADDRV2_FORMAT to the version so that the CNetAddr and CAddress\n+            // unserialize methods know that an address in v2 format is coming.\n+            stream_version |= ADDRV2_FORMAT;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502787260",
      "id" : 502787260,
      "in_reply_to_id" : 502724858,
      "line" : 2596,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc4NzI2MA==",
      "original_commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "original_line" : 2596,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 37,
      "pull_request_review_id" : 506094085,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-10T12:48:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502787260",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502787620"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502787620"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`PushAddress()` is called from 5 places. We don't want to duplicate the same code in 5 places.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-10T12:52:39Z",
      "diff_hunk" : "@@ -1115,11 +1120,16 @@ class CNode\n \n     void PushAddress(const CAddress& _addr, FastRandomContext &insecure_rand)\n     {\n+        // Whether the peer supports the address in `_addr`. For example,\n+        // nodes that do not implement BIP155 cannot receive Tor v3 addresses\n+        // because they require ADDRv2 (BIP155) encoding.\n+        const bool addr_format_supported = m_wants_addrv2 || _addr.IsAddrV1Compatible();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502787620",
      "id" : 502787620,
      "in_reply_to_id" : 502722714,
      "line" : 1126,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc4NzYyMA==",
      "original_commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "original_line" : 1126,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 19,
      "pull_request_review_id" : 506095393,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-10T12:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502787620",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502797250"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502797250"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Well another alternative is a new method `IsAddrUnderstood` on `CNode` making the call to `PushAddress()` conditional on it results. It can be done later, not a real concern.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-10T14:38:17Z",
      "diff_hunk" : "@@ -1115,11 +1120,16 @@ class CNode\n \n     void PushAddress(const CAddress& _addr, FastRandomContext &insecure_rand)\n     {\n+        // Whether the peer supports the address in `_addr`. For example,\n+        // nodes that do not implement BIP155 cannot receive Tor v3 addresses\n+        // because they require ADDRv2 (BIP155) encoding.\n+        const bool addr_format_supported = m_wants_addrv2 || _addr.IsAddrV1Compatible();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502797250",
      "id" : 502797250,
      "in_reply_to_id" : 502722714,
      "line" : 1126,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc5NzI1MA==",
      "original_commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "original_line" : 1126,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 19,
      "pull_request_review_id" : 506102144,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-10T14:38:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502797250",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502797362"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502797362"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Do you mean this?\r\n\r\nYes, I think the BIP should state this clearly to hint other implementations. The current PR code is correct.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-10T14:39:22Z",
      "diff_hunk" : "@@ -868,6 +868,11 @@ class CNode\n     bool m_legacyWhitelisted{false};\n     bool fClient{false}; // set by version message\n     bool m_limited_node{false}; //after BIP159, set by version message\n+    /**\n+     * Whether the peer has signaled support for receiving ADDRv2 (BIP155)\n+     * messages, implying a preference to receive ADDRv2 instead of ADDR ones.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502797362",
      "id" : 502797362,
      "in_reply_to_id" : 502719748,
      "line" : 873,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc5NzM2Mg==",
      "original_commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "original_line" : 873,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 6,
      "pull_request_review_id" : 506102226,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-10T14:39:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502797362",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502797750"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502797750"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> So, when we further relay a CAddress object we don't care in what encoding we received it.\r\n\r\nRight, it's a just a matter of stating this in the BIP to avoid other implementations not propagating addresses due to receiving transport encoding A but forgetting to relay the decoded addr stream to peers speaking transport encoding B.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-10T14:43:17Z",
      "diff_hunk" : "@@ -2582,16 +2588,25 @@ void PeerManager::ProcessMessage(CNode& pfrom, const std::string& msg_type, CDat\n         return;\n     }\n \n-    if (msg_type == NetMsgType::ADDR) {\n+    if (msg_type == NetMsgType::ADDR || msg_type == NetMsgType::ADDRV2) {\n+        int stream_version = vRecv.GetVersion();\n+        if (msg_type == NetMsgType::ADDRV2) {\n+            // Add ADDRV2_FORMAT to the version so that the CNetAddr and CAddress\n+            // unserialize methods know that an address in v2 format is coming.\n+            stream_version |= ADDRV2_FORMAT;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502797750",
      "id" : 502797750,
      "in_reply_to_id" : 502724858,
      "line" : 2596,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc5Nzc1MA==",
      "original_commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "original_line" : 2596,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 37,
      "pull_request_review_id" : 506102496,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-10T14:43:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502797750",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502809727"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502809727"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think we should aim to specify relay behavior in BIPs. There is no requirement that all software behaves the same, and best practices around it are constant changing in response to attacks and observed network conditions.\r\n\r\nThe BIP specifies what means of communicating addresses are available. What that gets used for is local node policy.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-10T16:53:59Z",
      "diff_hunk" : "@@ -2582,16 +2588,25 @@ void PeerManager::ProcessMessage(CNode& pfrom, const std::string& msg_type, CDat\n         return;\n     }\n \n-    if (msg_type == NetMsgType::ADDR) {\n+    if (msg_type == NetMsgType::ADDR || msg_type == NetMsgType::ADDRV2) {\n+        int stream_version = vRecv.GetVersion();\n+        if (msg_type == NetMsgType::ADDRV2) {\n+            // Add ADDRV2_FORMAT to the version so that the CNetAddr and CAddress\n+            // unserialize methods know that an address in v2 format is coming.\n+            stream_version |= ADDRV2_FORMAT;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r502809727",
      "id" : 502809727,
      "in_reply_to_id" : 502724858,
      "line" : 2596,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjgwOTcyNw==",
      "original_commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "original_line" : 2596,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 37,
      "pull_request_review_id" : 506111359,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-10T16:53:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/502809727",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5\r\n\r\nTwo small follow-ups (not blockers here):\r\n* Mention BIP155 support in `doc/bips.md`\r\n* Don't relay I2P/CJDNS in `RelayAddress` (until there is a sizable network that actually supports it)\r\n",
      "created_at" : "2020-10-10T17:36:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-706585308",
      "id" : 706585308,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwNjU4NTMwOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-10T17:41:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/706585308",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-ACK dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5 per `git diff 9b56a68 dcf0cb4` only change since last review is an update to the release notes which partially picked up the suggested text. Running a node on this branch and addnode-ing to 6 other Tor v3 nodes, I see \"addrv2\" and \"sendaddrv2\" messages in getpeerinfo in both the \"bytesrecv_per_msg\" and \"bytessent_per_msg\" JSON objects.\r\n\r\n```\r\n    \"bytessent_per_msg\": {\r\n      \"addrv2\": 132,\r\n      \"feefilter\": 32,\r\n      \"getaddr\": 24,\r\n      \"getdata\": 3918,\r\n      \"getheaders\": 1053,\r\n      \"headers\": 25,\r\n      \"inv\": 30017,\r\n      \"ping\": 96,\r\n      \"pong\": 96,\r\n      \"sendaddrv2\": 24,\r\n      \"sendcmpct\": 66,\r\n      \"sendheaders\": 24,\r\n      \"verack\": 24,\r\n      \"version\": 127,\r\n      \"wtxidrelay\": 24\r\n    },\r\n    \"bytesrecv_per_msg\": {\r\n      \"addrv2\": 17444,\r\n      \"feefilter\": 32,\r\n      \"getheaders\": 1053,\r\n      \"headers\": 106,\r\n      \"inv\": 16996,\r\n      \"notfound\": 61,\r\n      \"ping\": 96,\r\n      \"pong\": 96,\r\n      \"sendaddrv2\": 24,\r\n      \"sendcmpct\": 66,\r\n      \"sendheaders\": 24,\r\n      \"tx\": 39740,\r\n      \"verack\": 24,\r\n      \"version\": 127,\r\n      \"wtxidrelay\": 24\r\n    },\r\n```\r\n",
      "created_at" : "2020-10-10T18:14:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-706590084",
      "id" : 706590084,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwNjU5MDA4NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-12T12:30:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/706590084",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code Review ACK dcf0cb4",
      "created_at" : "2020-10-11T00:04:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-706628217",
      "id" : 706628217,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwNjYyODIxNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-11T00:04:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/706628217",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r503075378"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/503075378"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```\r\n+ make -C src --jobs=1 check-security V=1\r\nmake: Entering directory '/bitcoin/distsrc-x86_64-linux-gnu/src'\r\nChecking binary security...\r\nREADELF=/gnu/store/pzq9s5ldl90h72p26jkdakyccdg9ib3k-profile/bin/x86_64-linux-gnu-readelf OBJDUMP=x86_64-linux-gnu-objdump OTOOL= /gnu/store/pzq9s5ldl90h72p26jkdakyccdg9ib3k-profile/bin/python3.7 ../contrib/devtools/security-check.py bitcoind  bitcoin-cli bitcoin-tx bitcoin-wallet test/test_bitcoin bench/bench_bitcoin qt/bitcoin-qt  \r\nmake: Leaving directory '/bitcoin/distsrc-x86_64-linux-gnu/src'\r\n+ case \"$HOST\" in\r\n+ make -C src --jobs=1 check-symbols V=1\r\nmake: Entering directory '/bitcoin/distsrc-x86_64-linux-gnu/src'\r\nChecking glibc back compat...\r\nREADELF=/gnu/store/pzq9s5ldl90h72p26jkdakyccdg9ib3k-profile/bin/x86_64-linux-gnu-readelf CPPFILT=/gnu/store/pzq9s5ldl90h72p26jkdakyccdg9ib3k-profile/bin/x86_64-linux-gnu-c++filt /gnu/store/pzq9s5ldl90h72p26jkdakyccdg9ib3k-profile/bin/python3.7 ../contrib/devtools/symbol-check.py bitcoind  bitcoin-cli bitcoin-tx bitcoin-wallet test/test_bitcoin bench/bench_bitcoin qt/bitcoin-qt  \r\ntest/test_bitcoin: export of symbol in6addr_loopback not allowed\r\ntest/test_bitcoin: failed EXPORTED_SYMBOLS\r\nmake: *** [Makefile:20952: check-symbols] Error 1\r\nmake: Leaving directory '/bitcoin/distsrc-x86_64-linux-gnu/src'\r\n",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-12T06:56:46Z",
      "diff_hunk" : "@@ -443,4 +447,105 @@ BOOST_AUTO_TEST_CASE(netbase_dont_resolve_strings_with_embedded_nul_characters)\n     BOOST_CHECK(!LookupSubNet(std::string(\"5wyqrzbvrdsumnok.onion\\0example.com\\0\", 35), ret));\n }\n \n+// Since CNetAddr (un)ser is tested separately in net_tests.cpp here we only\n+// try a few edge cases for port, service flags and time.\n+\n+static const std::vector<CAddress> fixture_addresses({\n+    CAddress(\n+        CService(CNetAddr(in6addr_loopback), 0 /* port */),\n+        NODE_NONE,\n+        0x4966bc61U /* Fri Jan  9 02:54:25 UTC 2009 */\n+    ),\n+    CAddress(\n+        CService(CNetAddr(in6addr_loopback), 0x00f1 /* port */),\n+        NODE_NETWORK,\n+        0x83766279U /* Tue Nov 22 11:22:33 UTC 2039 */\n+    ),\n+    CAddress(\n+        CService(CNetAddr(in6addr_loopback), 0xf1f2 /* port */),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r503075378",
      "id" : 503075378,
      "line" : 465,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA3NTM3OA==",
      "original_commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "original_line" : 465,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/test/netbase_tests.cpp",
      "position" : 33,
      "pull_request_review_id" : 506337899,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-12T06:56:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/503075378",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r503075539"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/503075539"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This breaks the guix/gitian build. cc @fanquake ",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-12T06:57:05Z",
      "diff_hunk" : "@@ -443,4 +447,105 @@ BOOST_AUTO_TEST_CASE(netbase_dont_resolve_strings_with_embedded_nul_characters)\n     BOOST_CHECK(!LookupSubNet(std::string(\"5wyqrzbvrdsumnok.onion\\0example.com\\0\", 35), ret));\n }\n \n+// Since CNetAddr (un)ser is tested separately in net_tests.cpp here we only\n+// try a few edge cases for port, service flags and time.\n+\n+static const std::vector<CAddress> fixture_addresses({\n+    CAddress(\n+        CService(CNetAddr(in6addr_loopback), 0 /* port */),\n+        NODE_NONE,\n+        0x4966bc61U /* Fri Jan  9 02:54:25 UTC 2009 */\n+    ),\n+    CAddress(\n+        CService(CNetAddr(in6addr_loopback), 0x00f1 /* port */),\n+        NODE_NETWORK,\n+        0x83766279U /* Tue Nov 22 11:22:33 UTC 2039 */\n+    ),\n+    CAddress(\n+        CService(CNetAddr(in6addr_loopback), 0xf1f2 /* port */),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r503075539",
      "id" : 503075539,
      "in_reply_to_id" : 503075378,
      "line" : 465,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA3NTUzOQ==",
      "original_commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "original_line" : 465,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/test/netbase_tests.cpp",
      "position" : 33,
      "pull_request_review_id" : 506338096,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-12T06:57:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/503075539",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r503093949"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/503093949"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The patch below may fix it, but I can't confirm because on my machine `contrib/devtools/symbol-check.py` is happy with `src/test/test_bitcoin` which contains:\r\n\r\n```sh\r\nnm src/test/test_bitcoin |grep in6addr_loopback\r\n                 U in6addr_loopback\r\n```\r\n\r\n<details>\r\n<summary>possible workaround symbol-check.py in6addr_loopback</summary>\r\n\r\n```diff\r\ndiff --git i/src/test/netbase_tests.cpp w/src/test/netbase_tests.cpp\r\nindex eb0d95a37..f473c092a 100644\r\n--- i/src/test/netbase_tests.cpp\r\n+++ w/src/test/netbase_tests.cpp\r\n@@ -447,25 +447,27 @@ BOOST_AUTO_TEST_CASE(netbase_dont_resolve_strings_with_embedded_nul_characters)\r\n     BOOST_CHECK(!LookupSubNet(std::string(\"5wyqrzbvrdsumnok.onion\\0example.com\\0\", 35), ret));\r\n }\r\n \r\n // Since CNetAddr (un)ser is tested separately in net_tests.cpp here we only\r\n // try a few edge cases for port, service flags and time.\r\n \r\n+static const struct in6_addr in6addr_loopback_ = IN6ADDR_LOOPBACK_INIT;\r\n+\r\n static const std::vector<CAddress> fixture_addresses({\r\n     CAddress(\r\n-        CService(CNetAddr(in6addr_loopback), 0 /* port */),\r\n+        CService(CNetAddr(in6addr_loopback_), 0 /* port */),\r\n         NODE_NONE,\r\n         0x4966bc61U /* Fri Jan  9 02:54:25 UTC 2009 */\r\n     ),\r\n     CAddress(\r\n-        CService(CNetAddr(in6addr_loopback), 0x00f1 /* port */),\r\n+        CService(CNetAddr(in6addr_loopback_), 0x00f1 /* port */),\r\n         NODE_NETWORK,\r\n         0x83766279U /* Tue Nov 22 11:22:33 UTC 2039 */\r\n     ),\r\n     CAddress(\r\n-        CService(CNetAddr(in6addr_loopback), 0xf1f2 /* port */),\r\n+        CService(CNetAddr(in6addr_loopback_), 0xf1f2 /* port */),\r\n         static_cast<ServiceFlags>(NODE_WITNESS | NODE_COMPACT_FILTERS | NODE_NETWORK_LIMITED),\r\n         0xffffffffU /* Sun Feb  7 06:28:15 UTC 2106 */\r\n     )\r\n });\r\n \r\n // fixture_addresses should equal to this when serialized in V1 format.\r\n```",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-12T07:35:46Z",
      "diff_hunk" : "@@ -443,4 +447,105 @@ BOOST_AUTO_TEST_CASE(netbase_dont_resolve_strings_with_embedded_nul_characters)\n     BOOST_CHECK(!LookupSubNet(std::string(\"5wyqrzbvrdsumnok.onion\\0example.com\\0\", 35), ret));\n }\n \n+// Since CNetAddr (un)ser is tested separately in net_tests.cpp here we only\n+// try a few edge cases for port, service flags and time.\n+\n+static const std::vector<CAddress> fixture_addresses({\n+    CAddress(\n+        CService(CNetAddr(in6addr_loopback), 0 /* port */),\n+        NODE_NONE,\n+        0x4966bc61U /* Fri Jan  9 02:54:25 UTC 2009 */\n+    ),\n+    CAddress(\n+        CService(CNetAddr(in6addr_loopback), 0x00f1 /* port */),\n+        NODE_NETWORK,\n+        0x83766279U /* Tue Nov 22 11:22:33 UTC 2039 */\n+    ),\n+    CAddress(\n+        CService(CNetAddr(in6addr_loopback), 0xf1f2 /* port */),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r503093949",
      "id" : 503093949,
      "in_reply_to_id" : 503075378,
      "line" : 465,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA5Mzk0OQ==",
      "original_commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "original_line" : 465,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/test/netbase_tests.cpp",
      "position" : 33,
      "pull_request_review_id" : 506362017,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-12T07:35:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/503093949",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r503094701"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/503094701"
         }
      },
      "author_association" : "MEMBER",
      "body" : "See #20127.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-12T07:37:21Z",
      "diff_hunk" : "@@ -443,4 +447,105 @@ BOOST_AUTO_TEST_CASE(netbase_dont_resolve_strings_with_embedded_nul_characters)\n     BOOST_CHECK(!LookupSubNet(std::string(\"5wyqrzbvrdsumnok.onion\\0example.com\\0\", 35), ret));\n }\n \n+// Since CNetAddr (un)ser is tested separately in net_tests.cpp here we only\n+// try a few edge cases for port, service flags and time.\n+\n+static const std::vector<CAddress> fixture_addresses({\n+    CAddress(\n+        CService(CNetAddr(in6addr_loopback), 0 /* port */),\n+        NODE_NONE,\n+        0x4966bc61U /* Fri Jan  9 02:54:25 UTC 2009 */\n+    ),\n+    CAddress(\n+        CService(CNetAddr(in6addr_loopback), 0x00f1 /* port */),\n+        NODE_NETWORK,\n+        0x83766279U /* Tue Nov 22 11:22:33 UTC 2039 */\n+    ),\n+    CAddress(\n+        CService(CNetAddr(in6addr_loopback), 0xf1f2 /* port */),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r503094701",
      "id" : 503094701,
      "in_reply_to_id" : 503075378,
      "line" : 465,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA5NDcwMQ==",
      "original_commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "original_line" : 465,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/test/netbase_tests.cpp",
      "position" : 33,
      "pull_request_review_id" : 506363102,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-12T07:37:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/503094701",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r503240292"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/503240292"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`PushAddress()` and all of the addr relay data will eventually move into net processing. See the commits in https://github.com/jnewbery/bitcoin/commits/2020-06-cs-main-split. That work obviously shouldn't hold up new features like BIP 155 and I'll continue to rebase those commits on master as things change. #19829 and #19910 are the next PRs to review if you'd like to help.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-10-12T11:48:00Z",
      "diff_hunk" : "@@ -1115,11 +1120,16 @@ class CNode\n \n     void PushAddress(const CAddress& _addr, FastRandomContext &insecure_rand)\n     {\n+        // Whether the peer supports the address in `_addr`. For example,\n+        // nodes that do not implement BIP155 cannot receive Tor v3 addresses\n+        // because they require ADDRv2 (BIP155) encoding.\n+        const bool addr_format_supported = m_wants_addrv2 || _addr.IsAddrV1Compatible();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r503240292",
      "id" : 503240292,
      "in_reply_to_id" : 502722714,
      "line" : 1126,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzI0MDI5Mg==",
      "original_commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "original_line" : 1126,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 19,
      "pull_request_review_id" : 506547210,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-12T11:48:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/503240292",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Congratulations to everybody involved :tada: \r\n\r\nNotice - I did not write the BIP, did not write the code initially, did not do the reviews nor did I test it much or nag people to prioritize it. Yet, this got a clean specification, solid code, thorough reviews and testing and was merged in time for 0.21. A true team effort!\r\n\r\nJust Epic!",
      "created_at" : "2020-10-12T12:04:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#issuecomment-707078873",
      "id" : 707078873,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19954",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwNzA3ODg3Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-12T12:04:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/707078873",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r515607619"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515607619"
         }
      },
      "author_association" : "MEMBER",
      "body" : "\"if the file is modified by 0.21.0 or newer then older versions will not be able to read it. Those old versions, in the event of a downgrade, will log an error message that deserialization has failed and will continue normal operation\"\r\n\r\nI don't see where this is enforced in 0.20 or earlier versions. If I'm understanding the v0.20 code correctly, then it'll try to unserialize the file, read garbage for the CAddress objects because the format has changed, but then not necessarily fail.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-11-01T11:06:29Z",
      "diff_hunk" : "@@ -60,6 +60,14 @@ From Bitcoin Core 0.20.0 onwards, macOS versions earlier than 10.12 are no\n longer supported. Additionally, Bitcoin Core does not yet change appearance\n when macOS \"dark mode\" is activated.\n \n+The node's known peers are persisted to disk in a file called `peers.dat`. The\n+format of this file has been changed in a backwards-incompatible way in order to\n+accommodate the storage of Tor v3 and other BIP155 addresses. This means that if\n+the file is modified by 0.21.0 or newer then older versions will not be able to\n+read it. Those old versions, in the event of a downgrade, will log an error\n+message that deserialization has failed and will continue normal operation\n+as if the file was missing, creating a new empty one. (#19954)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r515607619",
      "id" : 515607619,
      "line" : 69,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTYwNzYxOQ==",
      "original_commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "original_line" : 69,
      "original_position" : 10,
      "original_start_line" : 65,
      "path" : "doc/release-notes.md",
      "position" : 10,
      "pull_request_review_id" : 521213719,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : 65,
      "start_side" : "RIGHT",
      "updated_at" : "2020-11-01T11:06:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515607619",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r515630531"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515630531"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "You are right!\r\n\r\nA dirty hack like the following would trick `<=0.20.1` to always fail deserialization of files in format `>=Format::V3_BIP155` with `Incorrect keysize in addrman deserialization`\r\n\r\n```diff\r\ndiff --git i/src/addrman.h w/src/addrman.h\r\nindex b4089dc89..9f6614cd1 100644\r\n--- i/src/addrman.h\r\n+++ w/src/addrman.h\r\n@@ -326,19 +326,19 @@ public:\r\n     void Serialize(Stream& s_) const\r\n     {\r\n         LOCK(cs);\r\n \r\n         // Always serialize in the latest version (currently Format::V3_BIP155).\r\n \r\n         OverrideStream<Stream> s(&s_, s_.GetType(), s_.GetVersion() | ADDRV2_FORMAT);\r\n \r\n         s << static_cast<uint8_t>(Format::V3_BIP155);\r\n-        s << ((unsigned char)32);\r\n+        s << ((unsigned char)33);\r\n         s << nKey;\r\n         s << nNew;\r\n         s << nTried;\r\n \r\n         int nUBuckets = ADDRMAN_NEW_BUCKET_COUNT ^ (1 << 30);\r\n         s << nUBuckets;\r\n         std::map<int, int> mapUnkIds;\r\n         int nIds = 0;\r\n         for (const auto& entry : mapInfo) {\r\n@@ -406,18 +406,21 @@ public:\r\n             // Add ADDRV2_FORMAT to the version so that the CNetAddr and CAddress\r\n             // unserialize methods know that an address in addrv2 format is coming.\r\n             stream_version |= ADDRV2_FORMAT;\r\n         }\r\n \r\n         OverrideStream<Stream> s(&s_, s_.GetType(), stream_version);\r\n \r\n         unsigned char nKeySize;\r\n         s >> nKeySize;\r\n+        if (format >= Format::V3_BIP155) {\r\n+            --nKeySize;\r\n+        }\r\n         if (nKeySize != 32) throw std::ios_base::failure(\"Incorrect keysize in addrman deserialization\");\r\n         s >> nKey;\r\n         s >> nNew;\r\n         s >> nTried;\r\n         int nUBuckets = 0;\r\n         s >> nUBuckets;\r\n         if (format >= Format::V1_DETERMINISTIC) {\r\n             nUBuckets ^= (1 << 30);\r\n         }\r\n```",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-11-01T14:42:50Z",
      "diff_hunk" : "@@ -60,6 +60,14 @@ From Bitcoin Core 0.20.0 onwards, macOS versions earlier than 10.12 are no\n longer supported. Additionally, Bitcoin Core does not yet change appearance\n when macOS \"dark mode\" is activated.\n \n+The node's known peers are persisted to disk in a file called `peers.dat`. The\n+format of this file has been changed in a backwards-incompatible way in order to\n+accommodate the storage of Tor v3 and other BIP155 addresses. This means that if\n+the file is modified by 0.21.0 or newer then older versions will not be able to\n+read it. Those old versions, in the event of a downgrade, will log an error\n+message that deserialization has failed and will continue normal operation\n+as if the file was missing, creating a new empty one. (#19954)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r515630531",
      "id" : 515630531,
      "in_reply_to_id" : 515607619,
      "line" : 69,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTYzMDUzMQ==",
      "original_commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "original_line" : 69,
      "original_position" : 10,
      "original_start_line" : 65,
      "path" : "doc/release-notes.md",
      "position" : 10,
      "pull_request_review_id" : 521230876,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : 65,
      "start_side" : "RIGHT",
      "updated_at" : "2020-11-01T14:42:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515630531",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r515635869"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515635869"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, that would work. It's essentially repurposing the keysize field in the peers.dat file as a \"non forward-compatible version number\" (i.e. if a newer version of the software writes a higher number here, then an older version of the software wouldn't be able to read that file).\r\n\r\nI believe that's what you wanted to achieve with the code here: https://github.com/bitcoin/bitcoin/pull/19954/files#diff-164bd9e2e30f54d0a79eb7cc372309e2f2155edc6c3f051290ab078f03f6a771R396, but of course that only applies for v0.21 onwards, for file versions higher than `Format::V3_BIP155`. That code means that we now have no way to make a downgrade-safe change to the peers.dat file version. Any bump to the format number means that older software versions can't read the file. Note that we have made downgrade-safe version changes before (I think both v0-v1 and v1-v2 were both downgrade-safe), and it would be nice to keep this as a possibility.\r\n\r\nRepurposing the keysize field and reverting the change to the format field seems ok and would almost be turning them into major (non-forward-compatible) and minor (forward-compatible) version numbers. It should go without saying that we always want to have backward-compatibility, so peers.dat files written by old versions are readable by new versions.\r\n\r\nObviously we should get any changes made before the 0.21 release.",
      "commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "created_at" : "2020-11-01T15:31:30Z",
      "diff_hunk" : "@@ -60,6 +60,14 @@ From Bitcoin Core 0.20.0 onwards, macOS versions earlier than 10.12 are no\n longer supported. Additionally, Bitcoin Core does not yet change appearance\n when macOS \"dark mode\" is activated.\n \n+The node's known peers are persisted to disk in a file called `peers.dat`. The\n+format of this file has been changed in a backwards-incompatible way in order to\n+accommodate the storage of Tor v3 and other BIP155 addresses. This means that if\n+the file is modified by 0.21.0 or newer then older versions will not be able to\n+read it. Those old versions, in the event of a downgrade, will log an error\n+message that deserialization has failed and will continue normal operation\n+as if the file was missing, creating a new empty one. (#19954)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19954#discussion_r515635869",
      "id" : 515635869,
      "in_reply_to_id" : 515607619,
      "line" : 69,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTYzNTg2OQ==",
      "original_commit_id" : "dcf0cb477699d11afd0ff37c8bfb2b1b4f7f1ee5",
      "original_line" : 69,
      "original_position" : 10,
      "original_start_line" : 65,
      "path" : "doc/release-notes.md",
      "position" : 10,
      "pull_request_review_id" : 521234889,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19954",
      "side" : "RIGHT",
      "start_line" : 65,
      "start_side" : "RIGHT",
      "updated_at" : "2020-11-01T15:31:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515635869",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   }
]
