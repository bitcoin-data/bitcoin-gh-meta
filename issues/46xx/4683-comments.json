[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/4683#discussion_r16108919"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/4683"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16108919"
         }
      },
      "author_association" : "MEMBER",
      "body" : "As this iterates over the full `mapCoins`, a clear() at the end may be faster than erasing the entries one by one.\n",
      "commit_id" : "fff7455deda80bf483422dd7d7c2446e93522f2d",
      "created_at" : "2014-08-12T12:08:52Z",
      "diff_hunk" : "@@ -130,17 +130,19 @@ bool CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n     return true;\n }\n \n-bool CCoinsViewCache::BatchWrite(const CCoinsMap &mapCoins, const uint256 &hashBlockIn) {\n-    for (CCoinsMap::const_iterator it = mapCoins.begin(); it != mapCoins.end(); it++)\n-        cacheCoins[it->first] = it->second;\n+bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn) {\n+    for (CCoinsMap::iterator it = mapCoins.begin(); it != mapCoins.end();) {\n+        cacheCoins[it->first].swap(it->second);\n+        CCoinsMap::iterator itOld = it++;\n+        mapCoins.erase(itOld);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4683#discussion_r16108919",
      "id" : 16108919,
      "line" : 137,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2MTA4OTE5",
      "original_commit_id" : "b8763384b47428e3195ab2d25f848853d37f14fa",
      "original_line" : null,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 29,
      "pull_request_review_id" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/4683",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16108919/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2014-08-24T00:08:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16108919",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/4683#discussion_r16109270"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/4683"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16109270"
         }
      },
      "author_association" : "MEMBER",
      "body" : "map.clear() still has to iterate over all entries, while they're already in the CPU cache when we're doing this. Also, it means more memory being freed early while increasing memory in the destination, in theory reducing peak usage.\n",
      "commit_id" : "fff7455deda80bf483422dd7d7c2446e93522f2d",
      "created_at" : "2014-08-12T12:18:48Z",
      "diff_hunk" : "@@ -130,17 +130,19 @@ bool CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n     return true;\n }\n \n-bool CCoinsViewCache::BatchWrite(const CCoinsMap &mapCoins, const uint256 &hashBlockIn) {\n-    for (CCoinsMap::const_iterator it = mapCoins.begin(); it != mapCoins.end(); it++)\n-        cacheCoins[it->first] = it->second;\n+bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn) {\n+    for (CCoinsMap::iterator it = mapCoins.begin(); it != mapCoins.end();) {\n+        cacheCoins[it->first].swap(it->second);\n+        CCoinsMap::iterator itOld = it++;\n+        mapCoins.erase(itOld);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4683#discussion_r16109270",
      "id" : 16109270,
      "line" : 137,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2MTA5Mjcw",
      "original_commit_id" : "b8763384b47428e3195ab2d25f848853d37f14fa",
      "original_line" : null,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 29,
      "pull_request_review_id" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/4683",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16109270/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2014-08-24T00:08:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16109270",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/4683#discussion_r16109814"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/4683"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16109814"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That's true.\n",
      "commit_id" : "fff7455deda80bf483422dd7d7c2446e93522f2d",
      "created_at" : "2014-08-12T12:33:47Z",
      "diff_hunk" : "@@ -130,17 +130,19 @@ bool CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n     return true;\n }\n \n-bool CCoinsViewCache::BatchWrite(const CCoinsMap &mapCoins, const uint256 &hashBlockIn) {\n-    for (CCoinsMap::const_iterator it = mapCoins.begin(); it != mapCoins.end(); it++)\n-        cacheCoins[it->first] = it->second;\n+bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn) {\n+    for (CCoinsMap::iterator it = mapCoins.begin(); it != mapCoins.end();) {\n+        cacheCoins[it->first].swap(it->second);\n+        CCoinsMap::iterator itOld = it++;\n+        mapCoins.erase(itOld);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4683#discussion_r16109814",
      "id" : 16109814,
      "line" : 137,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2MTA5ODE0",
      "original_commit_id" : "b8763384b47428e3195ab2d25f848853d37f14fa",
      "original_line" : null,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 29,
      "pull_request_review_id" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/4683",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16109814/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2014-08-24T00:08:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16109814",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/4683#discussion_r16109927"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/4683"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16109927"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Hmm, I was reasoning in terms of a treemap, but it's a hashmap now. Just erasing all entries will not cause its hash table to be freed, and clear() afterwards will still iterate over all entries (to potentially erase them), so I'm not sure whether this weighs up against the slightly better peak memory usage.\n",
      "commit_id" : "fff7455deda80bf483422dd7d7c2446e93522f2d",
      "created_at" : "2014-08-12T12:37:05Z",
      "diff_hunk" : "@@ -130,17 +130,19 @@ bool CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n     return true;\n }\n \n-bool CCoinsViewCache::BatchWrite(const CCoinsMap &mapCoins, const uint256 &hashBlockIn) {\n-    for (CCoinsMap::const_iterator it = mapCoins.begin(); it != mapCoins.end(); it++)\n-        cacheCoins[it->first] = it->second;\n+bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn) {\n+    for (CCoinsMap::iterator it = mapCoins.begin(); it != mapCoins.end();) {\n+        cacheCoins[it->first].swap(it->second);\n+        CCoinsMap::iterator itOld = it++;\n+        mapCoins.erase(itOld);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4683#discussion_r16109927",
      "id" : 16109927,
      "line" : 137,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2MTA5OTI3",
      "original_commit_id" : "b8763384b47428e3195ab2d25f848853d37f14fa",
      "original_line" : null,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 29,
      "pull_request_review_id" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/4683",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16109927/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2014-08-24T00:08:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16109927",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/4683#discussion_r16110429"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/4683"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16110429"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It probably makes a minimal difference, if at all - let's prioritize the peak memory usage and keep it like this.\n",
      "commit_id" : "fff7455deda80bf483422dd7d7c2446e93522f2d",
      "created_at" : "2014-08-12T12:50:48Z",
      "diff_hunk" : "@@ -130,17 +130,19 @@ bool CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n     return true;\n }\n \n-bool CCoinsViewCache::BatchWrite(const CCoinsMap &mapCoins, const uint256 &hashBlockIn) {\n-    for (CCoinsMap::const_iterator it = mapCoins.begin(); it != mapCoins.end(); it++)\n-        cacheCoins[it->first] = it->second;\n+bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn) {\n+    for (CCoinsMap::iterator it = mapCoins.begin(); it != mapCoins.end();) {\n+        cacheCoins[it->first].swap(it->second);\n+        CCoinsMap::iterator itOld = it++;\n+        mapCoins.erase(itOld);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4683#discussion_r16110429",
      "id" : 16110429,
      "line" : 137,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2MTEwNDI5",
      "original_commit_id" : "b8763384b47428e3195ab2d25f848853d37f14fa",
      "original_line" : null,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 29,
      "pull_request_review_id" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/4683",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16110429/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2014-08-24T00:08:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16110429",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@laanwj How do you feel about this and its conflicting with #4700?\n",
      "created_at" : "2014-08-17T12:30:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4683#issuecomment-52420639",
      "id" : 52420639,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4683",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyNDIwNjM5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/52420639/reactions"
      },
      "updated_at" : "2014-08-17T12:30:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/52420639",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The only serious conflict with #4700 is caused by CCoinsViewCache::BatchWrite now taking a mutable CCoinsView.\n\nBut I'm not sure about the #4700 yet. In my experiments since, I've noticed that tweaking with the cache doesn't seem to have noticable influence on performance at all in syncing/reindexing. The cache mostly acts as a 'write buffer'. The read cache component is less important. Even though it gets lots of hits it doesn't figure into what actually consumes time.\n\nSo - reducing memory usage while keeping the current functionality seems fine to me. ACK.\n",
      "created_at" : "2014-08-18T09:59:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4683#issuecomment-52472513",
      "id" : 52472513,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4683",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyNDcyNTEz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/52472513/reactions"
      },
      "updated_at" : "2014-08-18T09:59:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/52472513",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Benchmarked: did a full testnet reindex using:\n\n```\n$ /usr/bin/time -f \"user:%U elapsed:%E maxmem:%M\" ./bitcoind -testnet -reindex -nodaemon -stopafterblockimport -debug=benchmark -dbcache=3000\n```\n\nResulting peak memory usage: 1041 MiB without this patch, 922 MiB with. No difference in speed.\n\nNote that this peak is during the final batch write to LevelDB.\n",
      "created_at" : "2014-08-18T18:55:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4683#issuecomment-52537998",
      "id" : 52537998,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4683",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyNTM3OTk4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/52537998/reactions"
      },
      "updated_at" : "2014-08-18T18:55:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/52537998",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Looks reasonable to me, I hadn't commented because I'd moved most of my testing to 0.9.3rc1.\n",
      "created_at" : "2014-08-23T23:59:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4683#issuecomment-53171233",
      "id" : 53171233,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4683",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzMTcxMjMz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53171233/reactions"
      },
      "updated_at" : "2014-08-23T23:59:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53171233",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ut ACK, though I would have preferred that the script change be in a separate commit.\n",
      "created_at" : "2014-08-24T00:04:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4683#issuecomment-53171382",
      "id" : 53171382,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4683",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzMTcxMzgy",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53171382/reactions"
      },
      "updated_at" : "2014-08-24T00:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53171382",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=4",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "node_id" : "MDQ6VXNlcjQ5NDQxMQ==",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jgarzik Done.\n",
      "created_at" : "2014-08-24T00:08:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4683#issuecomment-53171495",
      "id" : 53171495,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4683",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzMTcxNDk1",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53171495/reactions"
      },
      "updated_at" : "2014-08-24T00:08:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53171495",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/p4683_fff7455deda80bf483422dd7d7c2446e93522f2d/ for binaries and test log.\nThis test script verifies pulls every time they are updated. It, however, dies sometimes and fails to test properly.  If you are waiting on a test, please check timestamps to verify that the test.log is moving at http://jenkins.bluematt.me/pull-tester/current/\nContact BlueMatt on freenode if something looks broken.\n",
      "created_at" : "2014-08-24T01:25:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4683#issuecomment-53173473",
      "id" : 53173473,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4683",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzMTczNDcz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53173473/reactions"
      },
      "updated_at" : "2014-08-24T01:25:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53173473",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2110907?v=4",
         "events_url" : "https://api.github.com/users/BitcoinPullTester/events{/privacy}",
         "followers_url" : "https://api.github.com/users/BitcoinPullTester/followers",
         "following_url" : "https://api.github.com/users/BitcoinPullTester/following{/other_user}",
         "gists_url" : "https://api.github.com/users/BitcoinPullTester/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/BitcoinPullTester",
         "id" : 2110907,
         "login" : "BitcoinPullTester",
         "node_id" : "MDQ6VXNlcjIxMTA5MDc=",
         "organizations_url" : "https://api.github.com/users/BitcoinPullTester/orgs",
         "received_events_url" : "https://api.github.com/users/BitcoinPullTester/received_events",
         "repos_url" : "https://api.github.com/users/BitcoinPullTester/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/BitcoinPullTester/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/BitcoinPullTester/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/BitcoinPullTester"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I didnt do a full reindex, but it does continue to sync,\nACK.\n",
      "created_at" : "2014-08-24T08:41:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4683#issuecomment-53184203",
      "id" : 53184203,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4683",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzMTg0MjAz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53184203/reactions"
      },
      "updated_at" : "2014-08-24T08:41:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53184203",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   }
]
