[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [john-moffett](https://github.com/bitcoin/bitcoin/pull/26910#issuecomment-1387624289), [achow101](https://github.com/bitcoin/bitcoin/pull/26910#issuecomment-1402478196) |\n| Concept ACK | [theStack](https://github.com/bitcoin/bitcoin/pull/26910#pullrequestreview-1253979698) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#26596](https://github.com/bitcoin/bitcoin/pull/26596) (wallet: Migrate legacy wallets to descriptor wallets without requiring BDB by achow101)\n* [#26595](https://github.com/bitcoin/bitcoin/pull/26595) (wallet: be able to specify a wallet name and passphrase to migratewallet by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-01-17T19:00:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26910#issuecomment-1385908048",
      "id" : 1385908048,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26910",
      "node_id" : "IC_kwDOABII585Sm0dQ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1385908048/reactions"
      },
      "updated_at" : "2023-01-24T19:27:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1385908048",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26910#discussion_r1072813726"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26910"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072813726"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I wonder if the message is consistent with how the migration code actually works. For instance, the error returned before this change is \"`This wallet already uses SQLite`\":\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/fbe5e1220a35c35a668ec965c66508a7839aa7dd/src/wallet/wallet.cpp#L3765-L3774\r\n\r\nEven if it passed that check (which I believe is impossible in this situation), it does the same check as in this PR and reads \"`This wallet is already a descriptor wallet`\":\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/fbe5e1220a35c35a668ec965c66508a7839aa7dd/src/wallet/wallet.cpp#L3837-L3845\r\n\r\n\r\nMinor additional nit: I think the RPC error messages typically start with a capital letter after the `Error: ` unless it's an RPC command (as in line 745 above).",
      "commit_id" : "412a9aa6f05396999057a9fd16684b590a09b9b7",
      "created_at" : "2023-01-17T21:01:59Z",
      "diff_hunk" : "@@ -745,6 +745,10 @@ static RPCHelpMan migratewallet()\n                 throw JSONRPCError(RPC_WALLET_WRONG_ENC_STATE, \"Error: migratewallet on encrypted wallets is currently unsupported.\");\n             }\n \n+            if (!wallet->GetLegacyScriptPubKeyMan()) {\n+                throw JSONRPCError(RPC_INVALID_PARAMETER, strprintf(\"Error: nothing to migrate, no legacy data contained in wallet \\\"%s\\\"\", wallet->GetName()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26910#discussion_r1072813726",
      "id" : 1072813726,
      "line" : 749,
      "node_id" : "PRRC_kwDOABII584_8dae",
      "original_commit_id" : "412a9aa6f05396999057a9fd16684b590a09b9b7",
      "original_line" : 749,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/wallet.cpp",
      "position" : 5,
      "pull_request_review_id" : 1252450155,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26910",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072813726/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-17T21:06:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072813726",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/116917595?v=4",
         "events_url" : "https://api.github.com/users/john-moffett/events{/privacy}",
         "followers_url" : "https://api.github.com/users/john-moffett/followers",
         "following_url" : "https://api.github.com/users/john-moffett/following{/other_user}",
         "gists_url" : "https://api.github.com/users/john-moffett/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/john-moffett",
         "id" : 116917595,
         "login" : "john-moffett",
         "node_id" : "U_kgDOBvgFWw",
         "organizations_url" : "https://api.github.com/users/john-moffett/orgs",
         "received_events_url" : "https://api.github.com/users/john-moffett/received_events",
         "repos_url" : "https://api.github.com/users/john-moffett/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/john-moffett/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/john-moffett/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/john-moffett"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26910#discussion_r1073617130"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26910"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1073617130"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> I wonder if the message is consistent with how the migration code actually works. For instance, the error returned before this change is \"This wallet already uses SQLite\"\r\n\r\nwell, think about the command purpose. If there is no legacy data to migrate then why the command should be executed at all? Doesn't really care if the db is sqlite, bdb or anything else.\r\n\r\n> Minor additional nit: I think the RPC error messages typically start with a capital letter after the Error:  unless it's an RPC command (as in line 745 above).\r\n\r\nSeems that we have a mix of them, some errors start with a capital letter, some others not (like the encrypt.cpp file). I'm more aligned to this second form but have no real preference for any. Maybe the best move would be to open an issue an align all of them, in one way or another, at once.",
      "commit_id" : "412a9aa6f05396999057a9fd16684b590a09b9b7",
      "created_at" : "2023-01-18T14:34:39Z",
      "diff_hunk" : "@@ -745,6 +745,10 @@ static RPCHelpMan migratewallet()\n                 throw JSONRPCError(RPC_WALLET_WRONG_ENC_STATE, \"Error: migratewallet on encrypted wallets is currently unsupported.\");\n             }\n \n+            if (!wallet->GetLegacyScriptPubKeyMan()) {\n+                throw JSONRPCError(RPC_INVALID_PARAMETER, strprintf(\"Error: nothing to migrate, no legacy data contained in wallet \\\"%s\\\"\", wallet->GetName()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26910#discussion_r1073617130",
      "id" : 1073617130,
      "in_reply_to_id" : 1072813726,
      "line" : 749,
      "node_id" : "PRRC_kwDOABII584__hjq",
      "original_commit_id" : "412a9aa6f05396999057a9fd16684b590a09b9b7",
      "original_line" : 749,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/wallet.cpp",
      "position" : 5,
      "pull_request_review_id" : 1253604801,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26910",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1073617130/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-18T14:34:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1073617130",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26910#discussion_r1073677199"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26910"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1073677199"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> If there is no legacy data to migrate then why the command should be executed at all?\r\n\r\nRight, I agree that the message makes logical sense, though I do worry that it suggests that someone can have a descriptor wallet with legacy data, or they may think that \"legacy\" addresses are \"legacy data\", like `getnewaddress -addresstype legacy`.\r\n\r\nMy personal preference is to copy the `Error: This wallet is already a descriptor wallet` message, since that better matches the `help migratewallet` message: `Migrate the wallet to a descriptor wallet.` \r\n\r\nThat said, it's not a strong preference. Maybe @achow101 could weigh in?",
      "commit_id" : "6d31900e52efa2c7c7a220d8c8ad6353c412a2aa",
      "created_at" : "2023-01-18T15:20:39Z",
      "diff_hunk" : "@@ -745,6 +745,10 @@ static RPCHelpMan migratewallet()\n                 throw JSONRPCError(RPC_WALLET_WRONG_ENC_STATE, \"Error: migratewallet on encrypted wallets is currently unsupported.\");\n             }\n \n+            if (!wallet->GetLegacyScriptPubKeyMan()) {\n+                throw JSONRPCError(RPC_INVALID_PARAMETER, strprintf(\"Error: nothing to migrate, no legacy data contained in wallet \\\"%s\\\"\", wallet->GetName()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26910#discussion_r1073677199",
      "id" : 1073677199,
      "in_reply_to_id" : 1072813726,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584__wOP",
      "original_commit_id" : "412a9aa6f05396999057a9fd16684b590a09b9b7",
      "original_line" : 749,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1253694905,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26910",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1073677199/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-18T15:20:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1073677199",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/116917595?v=4",
         "events_url" : "https://api.github.com/users/john-moffett/events{/privacy}",
         "followers_url" : "https://api.github.com/users/john-moffett/followers",
         "following_url" : "https://api.github.com/users/john-moffett/following{/other_user}",
         "gists_url" : "https://api.github.com/users/john-moffett/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/john-moffett",
         "id" : 116917595,
         "login" : "john-moffett",
         "node_id" : "U_kgDOBvgFWw",
         "organizations_url" : "https://api.github.com/users/john-moffett/orgs",
         "received_events_url" : "https://api.github.com/users/john-moffett/received_events",
         "repos_url" : "https://api.github.com/users/john-moffett/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/john-moffett/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/john-moffett/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/john-moffett"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26910#discussion_r1073780048"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26910"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1073780048"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Right, I agree that the message makes logical sense, though I do worry that it suggests that someone can have a descriptor wallet with legacy data\r\n\r\nIt's theoretically possible to have a descriptor wallet using BDB for the database as well as a legacy wallet using sqlite. These are unsupported configurations, but are allowed and possible to achieve using the wallettool. That being said, they are unsupported so I think it's fine, and the number of people who would have such wallets should be limited to a very small number of developers.\r\n\r\nRegarding the error message, I would also prefer the \"already a descriptor wallet\" wording.",
      "commit_id" : "6d31900e52efa2c7c7a220d8c8ad6353c412a2aa",
      "created_at" : "2023-01-18T16:38:39Z",
      "diff_hunk" : "@@ -745,6 +745,10 @@ static RPCHelpMan migratewallet()\n                 throw JSONRPCError(RPC_WALLET_WRONG_ENC_STATE, \"Error: migratewallet on encrypted wallets is currently unsupported.\");\n             }\n \n+            if (!wallet->GetLegacyScriptPubKeyMan()) {\n+                throw JSONRPCError(RPC_INVALID_PARAMETER, strprintf(\"Error: nothing to migrate, no legacy data contained in wallet \\\"%s\\\"\", wallet->GetName()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26910#discussion_r1073780048",
      "id" : 1073780048,
      "in_reply_to_id" : 1072813726,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585AAJVQ",
      "original_commit_id" : "412a9aa6f05396999057a9fd16684b590a09b9b7",
      "original_line" : 749,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1253869843,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26910",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1073780048/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-18T16:38:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1073780048",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ACK 6d31900e52efa2c7c7a220d8c8ad6353c412a2aa\r\n\r\nTested and code review.",
      "created_at" : "2023-01-18T19:12:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26910#issuecomment-1387624289",
      "id" : 1387624289,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26910",
      "node_id" : "IC_kwDOABII585StXdh",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1387624289/reactions"
      },
      "updated_at" : "2023-01-18T19:12:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1387624289",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/116917595?v=4",
         "events_url" : "https://api.github.com/users/john-moffett/events{/privacy}",
         "followers_url" : "https://api.github.com/users/john-moffett/followers",
         "following_url" : "https://api.github.com/users/john-moffett/following{/other_user}",
         "gists_url" : "https://api.github.com/users/john-moffett/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/john-moffett",
         "id" : 116917595,
         "login" : "john-moffett",
         "node_id" : "U_kgDOBvgFWw",
         "organizations_url" : "https://api.github.com/users/john-moffett/orgs",
         "received_events_url" : "https://api.github.com/users/john-moffett/received_events",
         "repos_url" : "https://api.github.com/users/john-moffett/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/john-moffett/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/john-moffett/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/john-moffett"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 6d31900e52efa2c7c7a220d8c8ad6353c412a2aa",
      "created_at" : "2023-01-24T19:27:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26910#issuecomment-1402478196",
      "id" : 1402478196,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26910",
      "node_id" : "IC_kwDOABII585TmB50",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1402478196/reactions"
      },
      "updated_at" : "2023-01-24T19:27:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1402478196",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   }
]
