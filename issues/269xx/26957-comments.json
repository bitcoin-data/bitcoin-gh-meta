[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [LarryRuane](https://github.com/bitcoin/bitcoin/pull/26957#issuecomment-1458622474) |\n| Concept ACK | [kouloumos](https://github.com/bitcoin/bitcoin/pull/26957#pullrequestreview-1272729023), [martinus](https://github.com/bitcoin/bitcoin/pull/26957#issuecomment-1474761651) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#27231](https://github.com/bitcoin/bitcoin/pull/27231) (Fix logging RPC and -debugexclude with 0/none values, add test coverage, improve docs by jonatack)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-01-23T17:16:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26957#issuecomment-1400700700",
      "id" : 1400700700,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26957",
      "node_id" : "IC_kwDOABII585TfP8c",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1400700700/reactions"
      },
      "updated_at" : "2023-03-18T07:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1400700700",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1084351946"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1084351946"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The way this benchmark is implemented, we can identify a regression between code changes. But if we wanted to get a sense of how logging without a a debug.log file compares to logging with a debug.log file, this doesn't help, right? It should only log with one of {LogPrintLevel, LogPrint, LogPrintfCategory} in order to compare the result with one of the other benchmarks.",
      "commit_id" : "eddf2d21eeea2a37b303b11f08ed8f01e561e1b3",
      "created_at" : "2023-01-23T17:35:27Z",
      "diff_hunk" : "@@ -17,32 +17,62 @@ static void Logging(benchmark::Bench& bench, const std::vector<const char*>& ext\n     bench.run([&] { log(); });\n }\n \n-static void LoggingYoThreadNames(benchmark::Bench& bench)\n+static void LogPrintLevelWithThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintLevel(BCLog::VALIDATION, BCLog::Level::Error, \"%s\\n\", \"test\"); });\n }\n-static void LoggingNoThreadNames(benchmark::Bench& bench)\n+\n+static void LogPrintLevelWithoutThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintLevel(BCLog::VALIDATION, BCLog::Level::Error, \"%s\\n\", \"test\"); });\n+}\n+\n+static void LogPrintWithCategory(benchmark::Bench& bench)\n+{\n+    Logging(bench, {\"-logthreadnames=0\", \"-debug=net\"}, [] { LogPrint(BCLog::VALIDATION, \"%s\\n\", \"test\"); });\n+}\n+\n+static void LogPrintWithoutCategory(benchmark::Bench& bench)\n+{\n+    Logging(bench, {\"-logthreadnames=0\", \"-debug=0\"}, [] { LogPrint(BCLog::VALIDATION, \"%s\\n\", \"test\"); });\n+}\n+\n+static void LogPrintfCategoryWithThreadNames(benchmark::Bench& bench)\n+{\n+    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintfCategory(BCLog::VALIDATION, \"%s\\n\", \"test\"); });\n+}\n+\n+static void LogPrintfCategoryWithoutThreadNames(benchmark::Bench& bench)\n+{\n+    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintfCategory(BCLog::VALIDATION, \"%s\\n\", \"test\"); });\n }\n-static void LoggingYoCategory(benchmark::Bench& bench)\n+\n+static void LogPrintfWithThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=0\", \"-debug=net\"}, [] { LogPrint(BCLog::NET, \"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n }\n-static void LoggingNoCategory(benchmark::Bench& bench)\n+\n+static void LogPrintfWithoutThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=0\", \"-debug=0\"}, [] { LogPrint(BCLog::NET, \"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n }\n-static void LoggingNoFile(benchmark::Bench& bench)\n+\n+static void LogWithoutDebugLogFile(benchmark::Bench& bench)\n {\n     Logging(bench, {\"-nodebuglogfile\", \"-debug=1\"}, [] {\n+        LogPrintLevel(BCLog::VALIDATION, BCLog::Level::Error, \"%s\\n\", \"test\");\n+        LogPrint(BCLog::VALIDATION, \"%s\\n\", \"test\");\n+        LogPrintfCategory(BCLog::VALIDATION, \"%s\\n\", \"test\");\n         LogPrintf(\"%s\\n\", \"test\");\n-        LogPrint(BCLog::NET, \"%s\\n\", \"test\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1084351946",
      "id" : 1084351946,
      "line" : 40,
      "node_id" : "PRRC_kwDOABII585AoeXK",
      "original_commit_id" : "eddf2d21eeea2a37b303b11f08ed8f01e561e1b3",
      "original_line" : 40,
      "original_position" : 60,
      "original_start_line" : 63,
      "path" : "src/bench/logging.cpp",
      "position" : 60,
      "pull_request_review_id" : 1266044025,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1084351946/reactions"
      },
      "side" : "LEFT",
      "start_line" : 63,
      "start_side" : "RIGHT",
      "updated_at" : "2023-01-23T17:35:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1084351946",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/18506343?v=4",
         "events_url" : "https://api.github.com/users/kouloumos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kouloumos/followers",
         "following_url" : "https://api.github.com/users/kouloumos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kouloumos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kouloumos",
         "id" : 18506343,
         "login" : "kouloumos",
         "node_id" : "MDQ6VXNlcjE4NTA2MzQz",
         "organizations_url" : "https://api.github.com/users/kouloumos/orgs",
         "received_events_url" : "https://api.github.com/users/kouloumos/received_events",
         "repos_url" : "https://api.github.com/users/kouloumos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kouloumos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kouloumos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kouloumos"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1084394512"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1084394512"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That benchmark was added in fa31dc9b714 with the intention expressed in https://github.com/bitcoin/bitcoin/pull/18815#issuecomment-621404493, i.e. to test this code currently in `setup_common`:\r\n\r\n```cpp\r\n/**\r\n * Make a test setup that has disk access to the debug.log file disabled. Can\r\n * be used in \"hot loops\", for example fuzzing or benchmarking.\r\n */\r\ntemplate <class T = const BasicTestingSetup>\r\nstd::unique_ptr<T> MakeNoLogFileContext(const std::string& chain_name = CBaseChainParams::REGTEST, const std::vector<const char*>& extra_args = {})\r\n{\r\n    const std::vector<const char*> arguments = Cat(\r\n        {\r\n            \"-nodebuglogfile\",\r\n            \"-nodebug\",\r\n        },\r\n        extra_args);\r\n\r\n    return std::make_unique<T>(chain_name, arguments);\r\n}\r\n```\r\n",
      "commit_id" : "9d708dbe598d096f277ee7ee3078423f416ece1b",
      "created_at" : "2023-01-23T18:18:13Z",
      "diff_hunk" : "@@ -17,32 +17,62 @@ static void Logging(benchmark::Bench& bench, const std::vector<const char*>& ext\n     bench.run([&] { log(); });\n }\n \n-static void LoggingYoThreadNames(benchmark::Bench& bench)\n+static void LogPrintLevelWithThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintLevel(BCLog::VALIDATION, BCLog::Level::Error, \"%s\\n\", \"test\"); });\n }\n-static void LoggingNoThreadNames(benchmark::Bench& bench)\n+\n+static void LogPrintLevelWithoutThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintLevel(BCLog::VALIDATION, BCLog::Level::Error, \"%s\\n\", \"test\"); });\n+}\n+\n+static void LogPrintWithCategory(benchmark::Bench& bench)\n+{\n+    Logging(bench, {\"-logthreadnames=0\", \"-debug=net\"}, [] { LogPrint(BCLog::VALIDATION, \"%s\\n\", \"test\"); });\n+}\n+\n+static void LogPrintWithoutCategory(benchmark::Bench& bench)\n+{\n+    Logging(bench, {\"-logthreadnames=0\", \"-debug=0\"}, [] { LogPrint(BCLog::VALIDATION, \"%s\\n\", \"test\"); });\n+}\n+\n+static void LogPrintfCategoryWithThreadNames(benchmark::Bench& bench)\n+{\n+    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintfCategory(BCLog::VALIDATION, \"%s\\n\", \"test\"); });\n+}\n+\n+static void LogPrintfCategoryWithoutThreadNames(benchmark::Bench& bench)\n+{\n+    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintfCategory(BCLog::VALIDATION, \"%s\\n\", \"test\"); });\n }\n-static void LoggingYoCategory(benchmark::Bench& bench)\n+\n+static void LogPrintfWithThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=0\", \"-debug=net\"}, [] { LogPrint(BCLog::NET, \"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n }\n-static void LoggingNoCategory(benchmark::Bench& bench)\n+\n+static void LogPrintfWithoutThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=0\", \"-debug=0\"}, [] { LogPrint(BCLog::NET, \"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n }\n-static void LoggingNoFile(benchmark::Bench& bench)\n+\n+static void LogWithoutDebugLogFile(benchmark::Bench& bench)\n {\n     Logging(bench, {\"-nodebuglogfile\", \"-debug=1\"}, [] {\n+        LogPrintLevel(BCLog::VALIDATION, BCLog::Level::Error, \"%s\\n\", \"test\");\n+        LogPrint(BCLog::VALIDATION, \"%s\\n\", \"test\");\n+        LogPrintfCategory(BCLog::VALIDATION, \"%s\\n\", \"test\");\n         LogPrintf(\"%s\\n\", \"test\");\n-        LogPrint(BCLog::NET, \"%s\\n\", \"test\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1084394512",
      "id" : 1084394512,
      "in_reply_to_id" : 1084351946,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585AoowQ",
      "original_commit_id" : "eddf2d21eeea2a37b303b11f08ed8f01e561e1b3",
      "original_line" : 40,
      "original_position" : 60,
      "original_start_line" : 63,
      "path" : "src/bench/logging.cpp",
      "position" : null,
      "pull_request_review_id" : 1266104090,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1084394512/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2023-01-23T19:03:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1084394512",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1084439926"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1084439926"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks @kouloumos. Decided to add a comment to clarify the intention behind that -nodebuglogfile bench, and not add macros to it per your suggestion.",
      "commit_id" : "9d708dbe598d096f277ee7ee3078423f416ece1b",
      "created_at" : "2023-01-23T19:06:27Z",
      "diff_hunk" : "@@ -17,32 +17,62 @@ static void Logging(benchmark::Bench& bench, const std::vector<const char*>& ext\n     bench.run([&] { log(); });\n }\n \n-static void LoggingYoThreadNames(benchmark::Bench& bench)\n+static void LogPrintLevelWithThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintLevel(BCLog::VALIDATION, BCLog::Level::Error, \"%s\\n\", \"test\"); });\n }\n-static void LoggingNoThreadNames(benchmark::Bench& bench)\n+\n+static void LogPrintLevelWithoutThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintLevel(BCLog::VALIDATION, BCLog::Level::Error, \"%s\\n\", \"test\"); });\n+}\n+\n+static void LogPrintWithCategory(benchmark::Bench& bench)\n+{\n+    Logging(bench, {\"-logthreadnames=0\", \"-debug=net\"}, [] { LogPrint(BCLog::VALIDATION, \"%s\\n\", \"test\"); });\n+}\n+\n+static void LogPrintWithoutCategory(benchmark::Bench& bench)\n+{\n+    Logging(bench, {\"-logthreadnames=0\", \"-debug=0\"}, [] { LogPrint(BCLog::VALIDATION, \"%s\\n\", \"test\"); });\n+}\n+\n+static void LogPrintfCategoryWithThreadNames(benchmark::Bench& bench)\n+{\n+    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintfCategory(BCLog::VALIDATION, \"%s\\n\", \"test\"); });\n+}\n+\n+static void LogPrintfCategoryWithoutThreadNames(benchmark::Bench& bench)\n+{\n+    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintfCategory(BCLog::VALIDATION, \"%s\\n\", \"test\"); });\n }\n-static void LoggingYoCategory(benchmark::Bench& bench)\n+\n+static void LogPrintfWithThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=0\", \"-debug=net\"}, [] { LogPrint(BCLog::NET, \"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n }\n-static void LoggingNoCategory(benchmark::Bench& bench)\n+\n+static void LogPrintfWithoutThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=0\", \"-debug=0\"}, [] { LogPrint(BCLog::NET, \"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n }\n-static void LoggingNoFile(benchmark::Bench& bench)\n+\n+static void LogWithoutDebugLogFile(benchmark::Bench& bench)\n {\n     Logging(bench, {\"-nodebuglogfile\", \"-debug=1\"}, [] {\n+        LogPrintLevel(BCLog::VALIDATION, BCLog::Level::Error, \"%s\\n\", \"test\");\n+        LogPrint(BCLog::VALIDATION, \"%s\\n\", \"test\");\n+        LogPrintfCategory(BCLog::VALIDATION, \"%s\\n\", \"test\");\n         LogPrintf(\"%s\\n\", \"test\");\n-        LogPrint(BCLog::NET, \"%s\\n\", \"test\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1084439926",
      "id" : 1084439926,
      "in_reply_to_id" : 1084351946,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Aoz12",
      "original_commit_id" : "eddf2d21eeea2a37b303b11f08ed8f01e561e1b3",
      "original_line" : 40,
      "original_position" : 60,
      "original_start_line" : 63,
      "path" : "src/bench/logging.cpp",
      "position" : null,
      "pull_request_review_id" : 1266173090,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1084439926/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2023-01-23T19:06:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1084439926",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1088985030"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1088985030"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I did not realize the purpose of this benchmark at first, and having a comment there makes sense. \r\nMay I suggest something more direct? Like: \r\n\"This benchmarks the logging configuration used by the testing setup, see `MakeNoLogFileContext`\"\r\n",
      "commit_id" : "9d708dbe598d096f277ee7ee3078423f416ece1b",
      "created_at" : "2023-01-27T13:52:33Z",
      "diff_hunk" : "@@ -17,32 +17,61 @@ static void Logging(benchmark::Bench& bench, const std::vector<const char*>& ext\n     bench.run([&] { log(); });\n }\n \n-static void LoggingYoThreadNames(benchmark::Bench& bench)\n+static void LogPrintLevelWithThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintLevel(BCLog::VALIDATION, BCLog::Level::Error, \"%s\\n\", \"test\"); });\n }\n-static void LoggingNoThreadNames(benchmark::Bench& bench)\n+\n+static void LogPrintLevelWithoutThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintLevel(BCLog::VALIDATION, BCLog::Level::Error, \"%s\\n\", \"test\"); });\n+}\n+\n+static void LogPrintWithCategory(benchmark::Bench& bench)\n+{\n+    Logging(bench, {\"-logthreadnames=0\", \"-debug=net\"}, [] { LogPrint(BCLog::VALIDATION, \"%s\\n\", \"test\"); });\n+}\n+\n+static void LogPrintWithoutCategory(benchmark::Bench& bench)\n+{\n+    Logging(bench, {\"-logthreadnames=0\", \"-debug=0\"}, [] { LogPrint(BCLog::VALIDATION, \"%s\\n\", \"test\"); });\n+}\n+\n+static void LogPrintfCategoryWithThreadNames(benchmark::Bench& bench)\n+{\n+    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintfCategory(BCLog::VALIDATION, \"%s\\n\", \"test\"); });\n+}\n+\n+static void LogPrintfCategoryWithoutThreadNames(benchmark::Bench& bench)\n+{\n+    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintfCategory(BCLog::VALIDATION, \"%s\\n\", \"test\"); });\n }\n-static void LoggingYoCategory(benchmark::Bench& bench)\n+\n+static void LogPrintfWithThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=0\", \"-debug=net\"}, [] { LogPrint(BCLog::NET, \"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n }\n-static void LoggingNoCategory(benchmark::Bench& bench)\n+\n+static void LogPrintfWithoutThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=0\", \"-debug=0\"}, [] { LogPrint(BCLog::NET, \"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n }\n-static void LoggingNoFile(benchmark::Bench& bench)\n+\n+static void LogWithoutWriteToFile(benchmark::Bench& bench)\n {\n+    // Disable writing the log to a file, e.g. for unit tests or fuzzing.\n     Logging(bench, {\"-nodebuglogfile\", \"-debug=1\"}, [] {\n         LogPrintf(\"%s\\n\", \"test\");\n-        LogPrint(BCLog::NET, \"%s\\n\", \"test\");\n+        LogPrint(BCLog::VALIDATION, \"%s\\n\", \"test\");\n     });",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1088985030",
      "id" : 1088985030,
      "line" : 66,
      "node_id" : "PRRC_kwDOABII585A6JfG",
      "original_commit_id" : "9d708dbe598d096f277ee7ee3078423f416ece1b",
      "original_line" : 66,
      "original_position" : 60,
      "original_start_line" : 60,
      "path" : "src/bench/logging.cpp",
      "position" : 60,
      "pull_request_review_id" : 1272729023,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1088985030/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 60,
      "start_side" : "RIGHT",
      "updated_at" : "2023-01-27T16:04:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1088985030",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/18506343?v=4",
         "events_url" : "https://api.github.com/users/kouloumos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kouloumos/followers",
         "following_url" : "https://api.github.com/users/kouloumos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kouloumos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kouloumos",
         "id" : 18506343,
         "login" : "kouloumos",
         "node_id" : "MDQ6VXNlcjE4NTA2MzQz",
         "organizations_url" : "https://api.github.com/users/kouloumos/orgs",
         "received_events_url" : "https://api.github.com/users/kouloumos/received_events",
         "repos_url" : "https://api.github.com/users/kouloumos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kouloumos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kouloumos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kouloumos"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1089082037"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1089082037"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Before this PR, the logging benchmarks were only using the `LogPrintf` and `LogPrint` macros. Those have been renamed:\r\n- `LoggingYoThreadNames` -> `LogPrintfWithThreadNames`\r\n- `LoggingNoThreadNames` -> `LogPrintfWithoutThreadNames`\r\n- `LoggingYoCategory` -> `LogPrintWithCategory `\r\n- `LoggingNoCategory` -> `LogPrintWithoutCategory`\r\n- `LoggingNoFile` -> `LogWithoutWriteToFile`\r\n\r\nThere is something that puzzles me. \r\n\r\nThis is the result I get when running the new benchmarks with `src/bench/bench_bitcoin -filter=LogP.* -min-time=5000`:\r\n\r\nPR branch (9d708dbe598d096f277ee7ee3078423f416ece1b)\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|            6,695.43 |          149,355.54 |    0.2% |       22,379.28 |        9,404.03 |  2.380 |       4,522.98 |    0.2% |      5.50 | `LogPrintLevelWithThreadNames`\r\n|            6,472.74 |          154,494.18 |    0.2% |       21,721.01 |        8,977.58 |  2.419 |       4,357.01 |    0.1% |      5.45 | `LogPrintLevelWithoutThreadNames`\r\n|            6,426.44 |          155,607.13 |    0.1% |       21,447.01 |        8,893.94 |  2.411 |       4,292.01 |    0.1% |      5.37 | `LogPrintWithCategory`\r\n|            6,413.88 |          155,911.77 |    0.1% |       21,447.01 |        8,874.71 |  2.417 |       4,292.01 |    0.1% |      5.34 | `LogPrintWithoutCategory`\r\n|            6,554.13 |          152,575.56 |    0.2% |       21,905.78 |        9,140.18 |  2.397 |       4,407.96 |    0.1% |      5.42 | `LogPrintfCategoryWithThreadNames`\r\n|            6,383.81 |          156,646.25 |    0.2% |       21,320.76 |        8,819.82 |  2.417 |       4,259.87 |    0.1% |      5.37 | `LogPrintfCategoryWithoutThreadNames`\r\n|            6,493.25 |          154,006.16 |    0.2% |       21,697.01 |        9,026.45 |  2.404 |       4,349.01 |    0.1% |      5.48 | `LogPrintfWithThreadNames`\r\n|            6,401.44 |          156,214.93 |    0.1% |       21,143.74 |        8,857.86 |  2.387 |       4,207.97 |    0.2% |      5.36 | `LogPrintfWithoutThreadNames`\r\n\r\nBut if you compare `LogPrintWithoutCategory` with the results of its previous results (under the name `LoggingNoCategory`) in https://github.com/bitcoin/bitcoin/pull/26697#pullrequestreview-1253717862 you see a different result, which is the correct cause logging without category should be fast.\r\n\r\nNow, if you just run that benchmark by itself with `src/bench/bench_bitcoin -filter=LogPrintWithoutCategory -min-time=5000` you get the correct result\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|               11.89 |       84,122,117.23 |    0.2% |           78.00 |           23.59 |  3.307 |          14.00 |    0.0% |      5.49 | `LogPrintWithoutCategory\r\n\r\nThis \"wrong\" behavior is also observed when all the benchmarks are run with `src/bench/bench_bitcoin`\r\nShould we consider this an issue? It might result to confusion in the future. I am looking to understand why this is happening but haven't found anything yet.\r\n\r\nedit: @LarryRuane you [mentioned](https://github.com/bitcoin/bitcoin/pull/26697#issuecomment-1407028580) that you also ran those update benchmarks. Can you confirm that you also observe this behavior?",
      "commit_id" : "9d708dbe598d096f277ee7ee3078423f416ece1b",
      "created_at" : "2023-01-27T15:19:59Z",
      "diff_hunk" : "@@ -17,32 +17,61 @@ static void Logging(benchmark::Bench& bench, const std::vector<const char*>& ext\n     bench.run([&] { log(); });\n }\n \n-static void LoggingYoThreadNames(benchmark::Bench& bench)\n+static void LogPrintLevelWithThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintLevel(BCLog::VALIDATION, BCLog::Level::Error, \"%s\\n\", \"test\"); });\n }\n-static void LoggingNoThreadNames(benchmark::Bench& bench)\n+\n+static void LogPrintLevelWithoutThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintLevel(BCLog::VALIDATION, BCLog::Level::Error, \"%s\\n\", \"test\"); });\n+}\n+\n+static void LogPrintWithCategory(benchmark::Bench& bench)\n+{\n+    Logging(bench, {\"-logthreadnames=0\", \"-debug=net\"}, [] { LogPrint(BCLog::VALIDATION, \"%s\\n\", \"test\"); });\n+}\n+\n+static void LogPrintWithoutCategory(benchmark::Bench& bench)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1089082037",
      "id" : 1089082037,
      "line" : 35,
      "node_id" : "PRRC_kwDOABII585A6hK1",
      "original_commit_id" : "9d708dbe598d096f277ee7ee3078423f416ece1b",
      "original_line" : 35,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/bench/logging.cpp",
      "position" : 23,
      "pull_request_review_id" : 1272729023,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 1,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1089082037/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-28T08:40:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1089082037",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/18506343?v=4",
         "events_url" : "https://api.github.com/users/kouloumos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kouloumos/followers",
         "following_url" : "https://api.github.com/users/kouloumos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kouloumos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kouloumos",
         "id" : 18506343,
         "login" : "kouloumos",
         "node_id" : "MDQ6VXNlcjE4NTA2MzQz",
         "organizations_url" : "https://api.github.com/users/kouloumos/orgs",
         "received_events_url" : "https://api.github.com/users/kouloumos/received_events",
         "repos_url" : "https://api.github.com/users/kouloumos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kouloumos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kouloumos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kouloumos"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1089132283"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1089132283"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "What's the expected behavior when logging with a category that is not specified in `-debug=`?\r\n\r\nDoes logging with `BCLog::VALIDATION` but with `-debug=net` means that `BCLog::Logger::WillLogCategoryLevel` will return `false`? Therefore `LogPrint()` will not actually log?",
      "commit_id" : "9d708dbe598d096f277ee7ee3078423f416ece1b",
      "created_at" : "2023-01-27T16:02:26Z",
      "diff_hunk" : "@@ -17,32 +17,61 @@ static void Logging(benchmark::Bench& bench, const std::vector<const char*>& ext\n     bench.run([&] { log(); });\n }\n \n-static void LoggingYoThreadNames(benchmark::Bench& bench)\n+static void LogPrintLevelWithThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintLevel(BCLog::VALIDATION, BCLog::Level::Error, \"%s\\n\", \"test\"); });\n }\n-static void LoggingNoThreadNames(benchmark::Bench& bench)\n+\n+static void LogPrintLevelWithoutThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintLevel(BCLog::VALIDATION, BCLog::Level::Error, \"%s\\n\", \"test\"); });\n+}\n+\n+static void LogPrintWithCategory(benchmark::Bench& bench)\n+{\n+    Logging(bench, {\"-logthreadnames=0\", \"-debug=net\"}, [] { LogPrint(BCLog::VALIDATION, \"%s\\n\", \"test\"); });",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1089132283",
      "id" : 1089132283,
      "line" : 32,
      "node_id" : "PRRC_kwDOABII585A6tb7",
      "original_commit_id" : "9d708dbe598d096f277ee7ee3078423f416ece1b",
      "original_line" : 32,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/bench/logging.cpp",
      "position" : 20,
      "pull_request_review_id" : 1272729023,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1089132283/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-27T16:04:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1089132283",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/18506343?v=4",
         "events_url" : "https://api.github.com/users/kouloumos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kouloumos/followers",
         "following_url" : "https://api.github.com/users/kouloumos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kouloumos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kouloumos",
         "id" : 18506343,
         "login" : "kouloumos",
         "node_id" : "MDQ6VXNlcjE4NTA2MzQz",
         "organizations_url" : "https://api.github.com/users/kouloumos/orgs",
         "received_events_url" : "https://api.github.com/users/kouloumos/received_events",
         "repos_url" : "https://api.github.com/users/kouloumos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kouloumos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kouloumos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kouloumos"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1089790402"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1089790402"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "@kouloumos I'm seeing the same thing. After investigation, I found that the problem is that the global logging object instance is not re-created for each run. When `LogPrintWithoutCategory` runs, it still has logging categories enabled from the previous benchmark runs.\r\n\r\nThis patch fixes the problem for me, give it a try. The change to `LogInstance()` looks racy (i.e. what if two threads both see `g_logger` is null, and they both create a new object), but this change is safe because `LogInstance()` first runs as part of the [global static initialization](https://en.cppreference.com/w/cpp/language/initialization), before `main()` is called, so there's only one thread. But if there's concern about this, `std::call_once()` can be used (it's used in a few places already).\r\n\r\n<details>\r\n<summary>patch</summary>\r\n\r\n```diff\r\ndiff --git a/src/bench/logging.cpp b/src/bench/logging.cpp\r\nindex d5c78932bc..434d1c58d4 100644\r\n--- a/src/bench/logging.cpp\r\n+++ b/src/bench/logging.cpp\r\n@@ -9,6 +9,7 @@\r\n \r\n static void Logging(benchmark::Bench& bench, const std::vector<const char*>& extra_args, const std::function<void()>& log)\r\n {\r\n+    LogReset();\r\n     TestingSetup test_setup{\r\n         CBaseChainParams::REGTEST,\r\n         extra_args,\r\ndiff --git a/src/logging.cpp b/src/logging.cpp\r\nindex 8bf60169b0..24f3338368 100644\r\n--- a/src/logging.cpp\r\n+++ b/src/logging.cpp\r\n@@ -18,6 +18,8 @@\r\n const char * const DEFAULT_DEBUGLOGFILE = \"debug.log\";\r\n constexpr auto MAX_USER_SETABLE_SEVERITY_LEVEL{BCLog::Level::Info};\r\n \r\n+static BCLog::Logger* g_logger;\r\n+\r\n BCLog::Logger& LogInstance()\r\n {\r\n /**\r\n@@ -35,10 +37,16 @@ BCLog::Logger& LogInstance()\r\n  * This method of initialization was originally introduced in\r\n  * ee3374234c60aba2cc4c5cd5cac1c0aefc2d817c.\r\n  */\r\n-    static BCLog::Logger* g_logger{new BCLog::Logger()};\r\n+    if (g_logger == nullptr) g_logger = new BCLog::Logger();\r\n     return *g_logger;\r\n }\r\n \r\n+void LogReset()\r\n+{\r\n+    delete g_logger;\r\n+    g_logger = new BCLog::Logger();\r\n+}\r\n+\r\n bool fLogIPs = DEFAULT_LOGIPS;\r\n \r\n static int FileWriteStr(const std::string &str, FILE *fp)\r\ndiff --git a/src/logging.h b/src/logging.h\r\nindex 16f23a19e8..522923c000 100644\r\n--- a/src/logging.h\r\n+++ b/src/logging.h\r\n@@ -266,6 +266,7 @@ namespace BCLog {\r\n } // namespace BCLog\r\n \r\n BCLog::Logger& LogInstance();\r\n+void LogReset(); // testing only\r\n \r\n /** Return true if log accepts specified category, at the specified level. */\r\n static inline bool LogAcceptCategory(BCLog::LogFlags category, BCLog::Level level)\r\n```\r\n</details>",
      "commit_id" : "9d708dbe598d096f277ee7ee3078423f416ece1b",
      "created_at" : "2023-01-28T18:38:32Z",
      "diff_hunk" : "@@ -17,32 +17,61 @@ static void Logging(benchmark::Bench& bench, const std::vector<const char*>& ext\n     bench.run([&] { log(); });\n }\n \n-static void LoggingYoThreadNames(benchmark::Bench& bench)\n+static void LogPrintLevelWithThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintLevel(BCLog::VALIDATION, BCLog::Level::Error, \"%s\\n\", \"test\"); });\n }\n-static void LoggingNoThreadNames(benchmark::Bench& bench)\n+\n+static void LogPrintLevelWithoutThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintLevel(BCLog::VALIDATION, BCLog::Level::Error, \"%s\\n\", \"test\"); });\n+}\n+\n+static void LogPrintWithCategory(benchmark::Bench& bench)\n+{\n+    Logging(bench, {\"-logthreadnames=0\", \"-debug=net\"}, [] { LogPrint(BCLog::VALIDATION, \"%s\\n\", \"test\"); });\n+}\n+\n+static void LogPrintWithoutCategory(benchmark::Bench& bench)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1089790402",
      "id" : 1089790402,
      "in_reply_to_id" : 1089082037,
      "line" : 35,
      "node_id" : "PRRC_kwDOABII585A9OHC",
      "original_commit_id" : "9d708dbe598d096f277ee7ee3078423f416ece1b",
      "original_line" : 35,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/bench/logging.cpp",
      "position" : 23,
      "pull_request_review_id" : 1273992199,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1089790402/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-28T18:38:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1089790402",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1089790857"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1089790857"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> What's the expected behavior when logging with a category that is not specified in -debug=?\r\n\r\nIt should not log. Note that the `LogPrintWithoutCategory` benchmark specifies `-debug=0` which disables all categories, although this has a problem that I mentioned in my other comment.\r\n\r\n> Does logging with BCLog::VALIDATION but with -debug=net means that BCLog::Logger::WillLogCategoryLevel will return false? Therefore LogPrint() will not actually log?\r\n\r\nThat's correct.",
      "commit_id" : "9d708dbe598d096f277ee7ee3078423f416ece1b",
      "created_at" : "2023-01-28T18:42:40Z",
      "diff_hunk" : "@@ -17,32 +17,61 @@ static void Logging(benchmark::Bench& bench, const std::vector<const char*>& ext\n     bench.run([&] { log(); });\n }\n \n-static void LoggingYoThreadNames(benchmark::Bench& bench)\n+static void LogPrintLevelWithThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintLevel(BCLog::VALIDATION, BCLog::Level::Error, \"%s\\n\", \"test\"); });\n }\n-static void LoggingNoThreadNames(benchmark::Bench& bench)\n+\n+static void LogPrintLevelWithoutThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintLevel(BCLog::VALIDATION, BCLog::Level::Error, \"%s\\n\", \"test\"); });\n+}\n+\n+static void LogPrintWithCategory(benchmark::Bench& bench)\n+{\n+    Logging(bench, {\"-logthreadnames=0\", \"-debug=net\"}, [] { LogPrint(BCLog::VALIDATION, \"%s\\n\", \"test\"); });",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1089790857",
      "id" : 1089790857,
      "in_reply_to_id" : 1089132283,
      "line" : 32,
      "node_id" : "PRRC_kwDOABII585A9OOJ",
      "original_commit_id" : "9d708dbe598d096f277ee7ee3078423f416ece1b",
      "original_line" : 32,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/bench/logging.cpp",
      "position" : 20,
      "pull_request_review_id" : 1273992551,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1089790857/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-28T18:42:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1089790857",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1089919417"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1089919417"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This is different from what I observe running this benchmark.\r\n\r\nWhen `BCLog::NET` was replaced with `BCLog::VALIDATION` it seems that changing `-debug=net` to `-debug=validation` was overlooked. Which per my understanding, means that `LogPrintWithCategory` should not actually benchmark what is supposed to, but rather be comparable to `LogPrintWithoutCategory`. This is not true and I only see the expected behavior when I change `-debug=net` to `-debugexclude=validation`.\r\n\r\nI will investigate this further.",
      "commit_id" : "9d708dbe598d096f277ee7ee3078423f416ece1b",
      "created_at" : "2023-01-29T10:06:00Z",
      "diff_hunk" : "@@ -17,32 +17,61 @@ static void Logging(benchmark::Bench& bench, const std::vector<const char*>& ext\n     bench.run([&] { log(); });\n }\n \n-static void LoggingYoThreadNames(benchmark::Bench& bench)\n+static void LogPrintLevelWithThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintLevel(BCLog::VALIDATION, BCLog::Level::Error, \"%s\\n\", \"test\"); });\n }\n-static void LoggingNoThreadNames(benchmark::Bench& bench)\n+\n+static void LogPrintLevelWithoutThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintLevel(BCLog::VALIDATION, BCLog::Level::Error, \"%s\\n\", \"test\"); });\n+}\n+\n+static void LogPrintWithCategory(benchmark::Bench& bench)\n+{\n+    Logging(bench, {\"-logthreadnames=0\", \"-debug=net\"}, [] { LogPrint(BCLog::VALIDATION, \"%s\\n\", \"test\"); });",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1089919417",
      "id" : 1089919417,
      "in_reply_to_id" : 1089132283,
      "line" : 32,
      "node_id" : "PRRC_kwDOABII585A9tm5",
      "original_commit_id" : "9d708dbe598d096f277ee7ee3078423f416ece1b",
      "original_line" : 32,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/bench/logging.cpp",
      "position" : 20,
      "pull_request_review_id" : 1274141714,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1089919417/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-29T10:06:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1089919417",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/18506343?v=4",
         "events_url" : "https://api.github.com/users/kouloumos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kouloumos/followers",
         "following_url" : "https://api.github.com/users/kouloumos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kouloumos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kouloumos",
         "id" : 18506343,
         "login" : "kouloumos",
         "node_id" : "MDQ6VXNlcjE4NTA2MzQz",
         "organizations_url" : "https://api.github.com/users/kouloumos/orgs",
         "received_events_url" : "https://api.github.com/users/kouloumos/received_events",
         "repos_url" : "https://api.github.com/users/kouloumos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kouloumos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kouloumos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kouloumos"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1091107254"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1091107254"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think I figured out this mystery. I'm almost certain you're right that the test has a mistake in it:\r\n```\r\nLogging(bench, {\"-logthreadnames=0\", \"-debug=net\"}, [] { LogPrint(BCLog::VALIDATION, \"%s\\n\", \"test\"); });\r\n```\r\nThis is meant to specify the _same_ category (not the different categories, \"net\" and `VALIDATION`). But the confusion is that with this mistake, the benchmark still shows a large `ns/op`, as if it's actually logging. I ran this code with the debugger, which shows that it is indeed logging the message. The reason, I just figured out, is that the test framework [enables _all_ logging](https://github.com/bitcoin/bitcoin/blob/7241b936c5b4d004cdbdc7dc4d0b586856f6716b/src/test/util/setup_common.cpp#L113), so when the test specifies `-debug=net`, that has no effect because all categories are enabled anyway. \r\n\r\nI tried changing that line of benchmark code to:\r\n```\r\nLogging(bench, {\"-logthreadnames=0\", \"-debug=0\", \"-debug=net\"}, [] { LogPrint(BCLog::VALIDATION, \"%s\\n\", \"test\"); });\r\n```\r\nNote the addition of `-debug=0` which should disable all logging. So now what should happen is, the test framework specifies `-debug` which enables all categories (the test framework arguments occur before the ones we specify here), but then we specify `-debug=0` which _disables_ all categories, then add back just the one we want. Now, no logging should actually happen, since we haven't enabled `\"validation\"`. And this was the case, no logging occurred (the `ns/op` was a low number).\r\n\r\nNow, let's just fix the bug in the test:\r\n```\r\nLogging(bench, {\"-logthreadnames=0\", \"-debug=0\", \"-debug=validation\"}, [] { LogPrint(BCLog::VALIDATION, \"%s\\n\", \"test\"); });\r\n```\r\nTo my surprise, this also had a low `ns/op`, meaning that it was not logging! How could that be, when we're explicitly specifying `-debug=validation` and we're doing a `VALIDATION` print?\r\n\r\nFurther investigation revealed that when the command line includes `-debug=0`, then we [_do not_ enable](https://github.com/bitcoin/bitcoin/blob/7241b936c5b4d004cdbdc7dc4d0b586856f6716b/src/init/common.cpp#L86) _any categories_ specified on the command line! That is, the `-debug=0` causes even later `-debug=category` arguments to be ignored!\r\n\r\nAnyway, I believe this is the fix we want, this gives the expected results (actual logging, a high `ns/op`):\r\n```diff\r\n static void LogPrintWithCategory(benchmark::Bench& bench)\r\n {\r\n-    Logging(bench, {\"-logthreadnames=0\", \"-debug=net\"}, [] { LogPrint(BCLog::VALIDATION, \"%s\\n\", \"test\"); });\r\n+     // the test framework enables all categories by default\r\n+    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrint(BCLog::VALIDATION, \"%s\\n\", \"test\"); });\r\n }\r\n```",
      "commit_id" : "a0e092e1af6f8903568d48ebb04ef654a6b71d53",
      "created_at" : "2023-01-30T20:26:49Z",
      "diff_hunk" : "@@ -17,32 +17,61 @@ static void Logging(benchmark::Bench& bench, const std::vector<const char*>& ext\n     bench.run([&] { log(); });\n }\n \n-static void LoggingYoThreadNames(benchmark::Bench& bench)\n+static void LogPrintLevelWithThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintLevel(BCLog::VALIDATION, BCLog::Level::Error, \"%s\\n\", \"test\"); });\n }\n-static void LoggingNoThreadNames(benchmark::Bench& bench)\n+\n+static void LogPrintLevelWithoutThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintLevel(BCLog::VALIDATION, BCLog::Level::Error, \"%s\\n\", \"test\"); });\n+}\n+\n+static void LogPrintWithCategory(benchmark::Bench& bench)\n+{\n+    Logging(bench, {\"-logthreadnames=0\", \"-debug=net\"}, [] { LogPrint(BCLog::VALIDATION, \"%s\\n\", \"test\"); });",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1091107254",
      "id" : 1091107254,
      "in_reply_to_id" : 1089132283,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585BCPm2",
      "original_commit_id" : "9d708dbe598d096f277ee7ee3078423f416ece1b",
      "original_line" : 32,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/bench/logging.cpp",
      "position" : null,
      "pull_request_review_id" : 1275977507,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 1,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1091107254/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-30T22:29:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1091107254",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1117702466"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1117702466"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks @kouloumos -- updated to \"Disable writing the log to a file, as used for unit tests and fuzzing in `MakeNoLogFileContext`.\"",
      "commit_id" : "a0e092e1af6f8903568d48ebb04ef654a6b71d53",
      "created_at" : "2023-02-24T21:47:40Z",
      "diff_hunk" : "@@ -17,32 +17,61 @@ static void Logging(benchmark::Bench& bench, const std::vector<const char*>& ext\n     bench.run([&] { log(); });\n }\n \n-static void LoggingYoThreadNames(benchmark::Bench& bench)\n+static void LogPrintLevelWithThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintLevel(BCLog::VALIDATION, BCLog::Level::Error, \"%s\\n\", \"test\"); });\n }\n-static void LoggingNoThreadNames(benchmark::Bench& bench)\n+\n+static void LogPrintLevelWithoutThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintLevel(BCLog::VALIDATION, BCLog::Level::Error, \"%s\\n\", \"test\"); });\n+}\n+\n+static void LogPrintWithCategory(benchmark::Bench& bench)\n+{\n+    Logging(bench, {\"-logthreadnames=0\", \"-debug=net\"}, [] { LogPrint(BCLog::VALIDATION, \"%s\\n\", \"test\"); });\n+}\n+\n+static void LogPrintWithoutCategory(benchmark::Bench& bench)\n+{\n+    Logging(bench, {\"-logthreadnames=0\", \"-debug=0\"}, [] { LogPrint(BCLog::VALIDATION, \"%s\\n\", \"test\"); });\n+}\n+\n+static void LogPrintfCategoryWithThreadNames(benchmark::Bench& bench)\n+{\n+    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintfCategory(BCLog::VALIDATION, \"%s\\n\", \"test\"); });\n+}\n+\n+static void LogPrintfCategoryWithoutThreadNames(benchmark::Bench& bench)\n+{\n+    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintfCategory(BCLog::VALIDATION, \"%s\\n\", \"test\"); });\n }\n-static void LoggingYoCategory(benchmark::Bench& bench)\n+\n+static void LogPrintfWithThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=0\", \"-debug=net\"}, [] { LogPrint(BCLog::NET, \"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n }\n-static void LoggingNoCategory(benchmark::Bench& bench)\n+\n+static void LogPrintfWithoutThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=0\", \"-debug=0\"}, [] { LogPrint(BCLog::NET, \"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n }\n-static void LoggingNoFile(benchmark::Bench& bench)\n+\n+static void LogWithoutWriteToFile(benchmark::Bench& bench)\n {\n+    // Disable writing the log to a file, e.g. for unit tests or fuzzing.\n     Logging(bench, {\"-nodebuglogfile\", \"-debug=1\"}, [] {\n         LogPrintf(\"%s\\n\", \"test\");\n-        LogPrint(BCLog::NET, \"%s\\n\", \"test\");\n+        LogPrint(BCLog::VALIDATION, \"%s\\n\", \"test\");\n     });",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1117702466",
      "id" : 1117702466,
      "in_reply_to_id" : 1088985030,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585CnslC",
      "original_commit_id" : "9d708dbe598d096f277ee7ee3078423f416ece1b",
      "original_line" : 84,
      "original_position" : 60,
      "original_start_line" : 60,
      "path" : "src/bench/logging.cpp",
      "position" : null,
      "pull_request_review_id" : 1314300211,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1117702466/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2023-02-24T21:47:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1117702466",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1117704951"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1117704951"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for the issue @kouloumos and for finding a fix, @LarryRuane! Added a commit by you at the start of the changes here to fix the order dependency.",
      "commit_id" : "a0e092e1af6f8903568d48ebb04ef654a6b71d53",
      "created_at" : "2023-02-24T21:49:45Z",
      "diff_hunk" : "@@ -17,32 +17,61 @@ static void Logging(benchmark::Bench& bench, const std::vector<const char*>& ext\n     bench.run([&] { log(); });\n }\n \n-static void LoggingYoThreadNames(benchmark::Bench& bench)\n+static void LogPrintLevelWithThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintLevel(BCLog::VALIDATION, BCLog::Level::Error, \"%s\\n\", \"test\"); });\n }\n-static void LoggingNoThreadNames(benchmark::Bench& bench)\n+\n+static void LogPrintLevelWithoutThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintLevel(BCLog::VALIDATION, BCLog::Level::Error, \"%s\\n\", \"test\"); });\n+}\n+\n+static void LogPrintWithCategory(benchmark::Bench& bench)\n+{\n+    Logging(bench, {\"-logthreadnames=0\", \"-debug=net\"}, [] { LogPrint(BCLog::VALIDATION, \"%s\\n\", \"test\"); });\n+}\n+\n+static void LogPrintWithoutCategory(benchmark::Bench& bench)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1117704951",
      "id" : 1117704951,
      "in_reply_to_id" : 1089082037,
      "line" : 47,
      "node_id" : "PRRC_kwDOABII585CntL3",
      "original_commit_id" : "9d708dbe598d096f277ee7ee3078423f416ece1b",
      "original_line" : 47,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/bench/logging.cpp",
      "position" : 42,
      "pull_request_review_id" : 1314302066,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1117704951/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-24T22:04:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1117704951",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1117709540"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1117709540"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Great points.  Fixed the -debug, ensured that we do it where needed, and added this comment at the top of the benchmarks, along with co-author to both of you in this commit (LMK if a name/email is incorrect).\r\n\r\n```diff\r\n+// The test framework currently enables all categories by default, but in case\r\n+// that changes, we set -debug=category in the benchmarks below when we expect a\r\n+// category to be logged.\r\n```\r\n",
      "commit_id" : "a0e092e1af6f8903568d48ebb04ef654a6b71d53",
      "created_at" : "2023-02-24T21:53:47Z",
      "diff_hunk" : "@@ -17,32 +17,61 @@ static void Logging(benchmark::Bench& bench, const std::vector<const char*>& ext\n     bench.run([&] { log(); });\n }\n \n-static void LoggingYoThreadNames(benchmark::Bench& bench)\n+static void LogPrintLevelWithThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintLevel(BCLog::VALIDATION, BCLog::Level::Error, \"%s\\n\", \"test\"); });\n }\n-static void LoggingNoThreadNames(benchmark::Bench& bench)\n+\n+static void LogPrintLevelWithoutThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintLevel(BCLog::VALIDATION, BCLog::Level::Error, \"%s\\n\", \"test\"); });\n+}\n+\n+static void LogPrintWithCategory(benchmark::Bench& bench)\n+{\n+    Logging(bench, {\"-logthreadnames=0\", \"-debug=net\"}, [] { LogPrint(BCLog::VALIDATION, \"%s\\n\", \"test\"); });",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1117709540",
      "id" : 1117709540,
      "in_reply_to_id" : 1089132283,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585CnuTk",
      "original_commit_id" : "9d708dbe598d096f277ee7ee3078423f416ece1b",
      "original_line" : 32,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/bench/logging.cpp",
      "position" : null,
      "pull_request_review_id" : 1314305470,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1117709540/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-24T21:53:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1117709540",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thank you @kouloumos and @LarryRuane for the excellent reviewing. Updated per `git diff 9d708db a0e092e`",
      "created_at" : "2023-02-24T22:03:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26957#issuecomment-1444580916",
      "id" : 1444580916,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26957",
      "node_id" : "IC_kwDOABII585WGo40",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1444580916/reactions"
      },
      "updated_at" : "2023-02-24T22:03:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1444580916",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1118563747"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1118563747"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Not sure about leaking test-only code into real code. Have you tried to reset the categories instead?",
      "commit_id" : "a0e092e1af6f8903568d48ebb04ef654a6b71d53",
      "created_at" : "2023-02-27T10:38:46Z",
      "diff_hunk" : "@@ -201,6 +201,7 @@ namespace BCLog {\n } // namespace BCLog\n \n BCLog::Logger& LogInstance();\n+void LogReset(); // for benchmarks and testing",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1118563747",
      "id" : 1118563747,
      "line" : 204,
      "node_id" : "PRRC_kwDOABII585Cq-2j",
      "original_commit_id" : "439b31c3a4847fdfa6c4189cbc1158ba580ee3b1",
      "original_line" : 204,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/logging.h",
      "position" : 4,
      "pull_request_review_id" : 1315319487,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1118563747/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-27T10:38:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1118563747",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1118885979"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1118885979"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 4db9dc8ac3baa9751702ca575965661e63384692:\r\n\r\nLooks like you're introducing these benchmarks, with `BCLog::NET`, only to change them in a later commit (dfb40748911b9553a6e10c8376b032dac36bf938) to `BCLog::VALIDATION`? It's not obvious to me why the category needs changing, but this can probably be re-ordered so we aren't changing the same (newly introduced) lines of code, multiple times in the same PR.",
      "commit_id" : "a0e092e1af6f8903568d48ebb04ef654a6b71d53",
      "created_at" : "2023-02-27T15:14:26Z",
      "diff_hunk" : "@@ -17,32 +19,77 @@ static void Logging(benchmark::Bench& bench, const std::vector<const char*>& ext\n     bench.run([&] { log(); });\n }\n \n-static void LoggingYoThreadNames(benchmark::Bench& bench)\n+// The test framework currently enables all categories by default, but in case\n+// that changes, we set -debug=category in the benchmarks below when we expect a\n+// category to be logged.\n+\n+static void LogPrintLevelWithThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=1\", \"-debug=validation\"}, [] {\n+        LogPrintLevel(BCLog::VALIDATION, BCLog::Level::Error, \"%s\\n\", \"test\");\n+    });\n }\n-static void LoggingNoThreadNames(benchmark::Bench& bench)\n+\n+static void LogPrintLevelWithoutThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=0\", \"-debug=validation\"}, [] {\n+        LogPrintLevel(BCLog::VALIDATION, BCLog::Level::Error, \"%s\\n\", \"test\");\n+    });\n+}\n+\n+static void LogPrintWithCategory(benchmark::Bench& bench)\n+{\n+    Logging(bench, {\"-logthreadnames=0\", \"-debug=validation\"}, [] {\n+        LogPrint(BCLog::VALIDATION, \"%s\\n\", \"test\");\n+    });\n+}\n+\n+static void LogPrintWithoutCategory(benchmark::Bench& bench)\n+{\n+    Logging(bench, {\"-logthreadnames=0\", \"-debug=0\"}, [] {\n+        LogPrint(BCLog::VALIDATION, \"%s\\n\", \"test\");\n+    });\n+}\n+\n+static void LogPrintfCategoryWithThreadNames(benchmark::Bench& bench)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1118885979",
      "id" : 1118885979,
      "line" : 54,
      "node_id" : "PRRC_kwDOABII585CsNhb",
      "original_commit_id" : "a0e092e1af6f8903568d48ebb04ef654a6b71d53",
      "original_line" : 54,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "src/bench/logging.cpp",
      "position" : 49,
      "pull_request_review_id" : 1315801628,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1118885979/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-27T15:14:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1118885979",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1119061620"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1119061620"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Resetting categories would also touch real code, wouldn't it?",
      "commit_id" : "a0e092e1af6f8903568d48ebb04ef654a6b71d53",
      "created_at" : "2023-02-27T17:29:30Z",
      "diff_hunk" : "@@ -201,6 +201,7 @@ namespace BCLog {\n } // namespace BCLog\n \n BCLog::Logger& LogInstance();\n+void LogReset(); // for benchmarks and testing",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1119061620",
      "id" : 1119061620,
      "in_reply_to_id" : 1118563747,
      "line" : 204,
      "node_id" : "PRRC_kwDOABII585Cs4Z0",
      "original_commit_id" : "439b31c3a4847fdfa6c4189cbc1158ba580ee3b1",
      "original_line" : 204,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/logging.h",
      "position" : 4,
      "pull_request_review_id" : 1316067750,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1119061620/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-27T17:29:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1119061620",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1120305388"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1120305388"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is it not possible to call the existing `EnableCategory` and disable functions?",
      "commit_id" : "a0e092e1af6f8903568d48ebb04ef654a6b71d53",
      "created_at" : "2023-02-28T15:57:38Z",
      "diff_hunk" : "@@ -201,6 +201,7 @@ namespace BCLog {\n } // namespace BCLog\n \n BCLog::Logger& LogInstance();\n+void LogReset(); // for benchmarks and testing",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1120305388",
      "id" : 1120305388,
      "in_reply_to_id" : 1118563747,
      "line" : 204,
      "node_id" : "PRRC_kwDOABII585CxoDs",
      "original_commit_id" : "439b31c3a4847fdfa6c4189cbc1158ba580ee3b1",
      "original_line" : 204,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/logging.h",
      "position" : 4,
      "pull_request_review_id" : 1317940593,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1120305388/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-28T15:57:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1120305388",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1125575680"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1125575680"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks, @MarcoFalke, good suggestion, [this branch](https://github.com/LarryRuane/bitcoin/commits/pr26957-1) changes that commit to not touch production code ([individual commit](https://github.com/LarryRuane/bitcoin/commit/a1cd3cc17b9fdce1d60d662c447f845a12063d81)) @jonatack, feel free to cherry-pick.",
      "commit_id" : "a0e092e1af6f8903568d48ebb04ef654a6b71d53",
      "created_at" : "2023-03-05T00:01:55Z",
      "diff_hunk" : "@@ -201,6 +201,7 @@ namespace BCLog {\n } // namespace BCLog\n \n BCLog::Logger& LogInstance();\n+void LogReset(); // for benchmarks and testing",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1125575680",
      "id" : 1125575680,
      "in_reply_to_id" : 1118563747,
      "line" : 204,
      "node_id" : "PRRC_kwDOABII585DFuwA",
      "original_commit_id" : "439b31c3a4847fdfa6c4189cbc1158ba580ee3b1",
      "original_line" : 204,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/logging.h",
      "position" : 4,
      "pull_request_review_id" : 1325137920,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1125575680/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-03-05T00:01:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1125575680",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1128257451"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1128257451"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done, thank you @MarcoFalke and @LarryRuane.",
      "commit_id" : "8c47d599b87d6b2d43e7d37ce0aaf4f541535bb9",
      "created_at" : "2023-03-07T17:20:50Z",
      "diff_hunk" : "@@ -201,6 +201,7 @@ namespace BCLog {\n } // namespace BCLog\n \n BCLog::Logger& LogInstance();\n+void LogReset(); // for benchmarks and testing",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1128257451",
      "id" : 1128257451,
      "in_reply_to_id" : 1118563747,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585DP9er",
      "original_commit_id" : "439b31c3a4847fdfa6c4189cbc1158ba580ee3b1",
      "original_line" : 204,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/logging.h",
      "position" : null,
      "pull_request_review_id" : 1329131777,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1128257451/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-03-07T17:20:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1128257451",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1128257756"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1128257756"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done, thank you @fanquake, the diffs are much smaller now.\r\n\r\n(Also dropped the category change, as it didn't make sense with an unordered map.)",
      "commit_id" : "8c47d599b87d6b2d43e7d37ce0aaf4f541535bb9",
      "created_at" : "2023-03-07T17:21:02Z",
      "diff_hunk" : "@@ -17,32 +19,77 @@ static void Logging(benchmark::Bench& bench, const std::vector<const char*>& ext\n     bench.run([&] { log(); });\n }\n \n-static void LoggingYoThreadNames(benchmark::Bench& bench)\n+// The test framework currently enables all categories by default, but in case\n+// that changes, we set -debug=category in the benchmarks below when we expect a\n+// category to be logged.\n+\n+static void LogPrintLevelWithThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=1\", \"-debug=validation\"}, [] {\n+        LogPrintLevel(BCLog::VALIDATION, BCLog::Level::Error, \"%s\\n\", \"test\");\n+    });\n }\n-static void LoggingNoThreadNames(benchmark::Bench& bench)\n+\n+static void LogPrintLevelWithoutThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=0\", \"-debug=validation\"}, [] {\n+        LogPrintLevel(BCLog::VALIDATION, BCLog::Level::Error, \"%s\\n\", \"test\");\n+    });\n+}\n+\n+static void LogPrintWithCategory(benchmark::Bench& bench)\n+{\n+    Logging(bench, {\"-logthreadnames=0\", \"-debug=validation\"}, [] {\n+        LogPrint(BCLog::VALIDATION, \"%s\\n\", \"test\");\n+    });\n+}\n+\n+static void LogPrintWithoutCategory(benchmark::Bench& bench)\n+{\n+    Logging(bench, {\"-logthreadnames=0\", \"-debug=0\"}, [] {\n+        LogPrint(BCLog::VALIDATION, \"%s\\n\", \"test\");\n+    });\n+}\n+\n+static void LogPrintfCategoryWithThreadNames(benchmark::Bench& bench)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1128257756",
      "id" : 1128257756,
      "in_reply_to_id" : 1118885979,
      "line" : 50,
      "node_id" : "PRRC_kwDOABII585DP9jc",
      "original_commit_id" : "a0e092e1af6f8903568d48ebb04ef654a6b71d53",
      "original_line" : 50,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "src/bench/logging.cpp",
      "position" : 51,
      "pull_request_review_id" : 1329132347,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1128257756/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-03-07T17:21:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1128257756",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> consider adding a comment at the top of the file probably, stating the expected results\r\n\r\nGood idea @LarryRuane (thanks!). Done.",
      "created_at" : "2023-03-07T17:22:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26957#issuecomment-1458550061",
      "id" : 1458550061,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26957",
      "node_id" : "IC_kwDOABII585W77Ut",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1458550061/reactions"
      },
      "updated_at" : "2023-03-07T17:22:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1458550061",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ACK 8c47d599b87d6b2d43e7d37ce0aaf4f541535bb9\r\nThe commits are very clean.",
      "created_at" : "2023-03-07T18:17:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26957#issuecomment-1458622474",
      "id" : 1458622474,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26957",
      "node_id" : "IC_kwDOABII585W8NAK",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1458622474/reactions"
      },
      "updated_at" : "2023-03-07T18:17:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1458622474",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1129269455"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1129269455"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 102b2033493f0d61e9763d094cb8a0017f7e3a10 bench: order the logging benchmark code by output: \r\n\r\nGiven that the code-movement, and re-ordering the `BENCHMARK(` calls doesn't change the output, this seems like a no-op?\r\n\r\nIn general, is (re-)ordering code in a `.cpp` file based on the order functions are called something we do?",
      "commit_id" : "8c47d599b87d6b2d43e7d37ce0aaf4f541535bb9",
      "created_at" : "2023-03-08T11:07:04Z",
      "diff_hunk" : "@@ -17,32 +25,67 @@ static void Logging(benchmark::Bench& bench, const std::vector<const char*>& ext\n     bench.run([&] { log(); });\n }\n \n-static void LoggingYoThreadNames(benchmark::Bench& bench)\n+static void LogPrintLevelWithThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=1\", \"-debug=net\"}, [] {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Error, \"%s\\n\", \"test\"); });\n }\n-static void LoggingNoThreadNames(benchmark::Bench& bench)\n+\n+static void LogPrintLevelWithoutThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=0\", \"-debug=net\"}, [] {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Error, \"%s\\n\", \"test\"); });\n }\n-static void LoggingYoCategory(benchmark::Bench& bench)\n+\n+static void LogPrintWithCategory(benchmark::Bench& bench)\n {\n     Logging(bench, {\"-logthreadnames=0\", \"-debug=net\"}, [] { LogPrint(BCLog::NET, \"%s\\n\", \"test\"); });\n }\n-static void LoggingNoCategory(benchmark::Bench& bench)\n+\n+static void LogPrintWithoutCategory(benchmark::Bench& bench)\n {\n     Logging(bench, {\"-logthreadnames=0\", \"-debug=0\"}, [] { LogPrint(BCLog::NET, \"%s\\n\", \"test\"); });\n }\n-static void LoggingNoFile(benchmark::Bench& bench)\n+\n+static void LogPrintfCategoryWithThreadNames(benchmark::Bench& bench)\n+{\n+    Logging(bench, {\"-logthreadnames=1\", \"-debug=net\"}, [] {\n+        LogPrintfCategory(BCLog::NET, \"%s\\n\", \"test\");\n+    });\n+}\n+\n+static void LogPrintfCategoryWithoutThreadNames(benchmark::Bench& bench)\n+{\n+    Logging(bench, {\"-logthreadnames=0\", \"-debug=net\"}, [] {\n+        LogPrintfCategory(BCLog::NET, \"%s\\n\", \"test\");\n+    });\n+}\n+\n+static void LogPrintfWithThreadNames(benchmark::Bench& bench)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1129269455",
      "id" : 1129269455,
      "line" : 64,
      "node_id" : "PRRC_kwDOABII585DT0jP",
      "original_commit_id" : "8c47d599b87d6b2d43e7d37ce0aaf4f541535bb9",
      "original_line" : 64,
      "original_position" : 65,
      "original_start_line" : null,
      "path" : "src/bench/logging.cpp",
      "position" : 65,
      "pull_request_review_id" : 1330436296,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1129269455/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-03-08T11:07:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1129269455",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1140953637"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140953637"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Benchmarks are registered into a `std::map` so they are alphabetically sorted anyways https://github.com/bitcoin/bitcoin/blob/master/src/bench/bench.h#L68",
      "commit_id" : "8c47d599b87d6b2d43e7d37ce0aaf4f541535bb9",
      "created_at" : "2023-03-18T06:37:50Z",
      "diff_hunk" : "@@ -17,32 +25,67 @@ static void Logging(benchmark::Bench& bench, const std::vector<const char*>& ext\n     bench.run([&] { log(); });\n }\n \n-static void LoggingYoThreadNames(benchmark::Bench& bench)\n+static void LogPrintLevelWithThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=1\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=1\", \"-debug=net\"}, [] {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Error, \"%s\\n\", \"test\"); });\n }\n-static void LoggingNoThreadNames(benchmark::Bench& bench)\n+\n+static void LogPrintLevelWithoutThreadNames(benchmark::Bench& bench)\n {\n-    Logging(bench, {\"-logthreadnames=0\"}, [] { LogPrintf(\"%s\\n\", \"test\"); });\n+    Logging(bench, {\"-logthreadnames=0\", \"-debug=net\"}, [] {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Error, \"%s\\n\", \"test\"); });\n }\n-static void LoggingYoCategory(benchmark::Bench& bench)\n+\n+static void LogPrintWithCategory(benchmark::Bench& bench)\n {\n     Logging(bench, {\"-logthreadnames=0\", \"-debug=net\"}, [] { LogPrint(BCLog::NET, \"%s\\n\", \"test\"); });\n }\n-static void LoggingNoCategory(benchmark::Bench& bench)\n+\n+static void LogPrintWithoutCategory(benchmark::Bench& bench)\n {\n     Logging(bench, {\"-logthreadnames=0\", \"-debug=0\"}, [] { LogPrint(BCLog::NET, \"%s\\n\", \"test\"); });\n }\n-static void LoggingNoFile(benchmark::Bench& bench)\n+\n+static void LogPrintfCategoryWithThreadNames(benchmark::Bench& bench)\n+{\n+    Logging(bench, {\"-logthreadnames=1\", \"-debug=net\"}, [] {\n+        LogPrintfCategory(BCLog::NET, \"%s\\n\", \"test\");\n+    });\n+}\n+\n+static void LogPrintfCategoryWithoutThreadNames(benchmark::Bench& bench)\n+{\n+    Logging(bench, {\"-logthreadnames=0\", \"-debug=net\"}, [] {\n+        LogPrintfCategory(BCLog::NET, \"%s\\n\", \"test\");\n+    });\n+}\n+\n+static void LogPrintfWithThreadNames(benchmark::Bench& bench)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26957#discussion_r1140953637",
      "id" : 1140953637,
      "in_reply_to_id" : 1129269455,
      "line" : 64,
      "node_id" : "PRRC_kwDOABII585EAZIl",
      "original_commit_id" : "8c47d599b87d6b2d43e7d37ce0aaf4f541535bb9",
      "original_line" : 64,
      "original_position" : 65,
      "original_start_line" : null,
      "path" : "src/bench/logging.cpp",
      "position" : 65,
      "pull_request_review_id" : 1346935930,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26957",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140953637/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-18T06:37:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140953637",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "code review & tested ACK, here are my benchmark results: \r\n\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|            3,822.12 |          261,634.61 |    0.3% |       22,931.00 |        8,536.02 |  2.686 |       4,512.00 |    0.1% |      0.53 | `LogPrintLevelWithThreadNames`\r\n|            3,776.34 |          264,807.01 |    0.4% |       22,494.01 |        8,370.09 |  2.687 |       4,403.00 |    0.1% |      0.48 | `LogPrintLevelWithoutThreadNames`\r\n|            3,733.48 |          267,846.56 |    0.5% |       22,252.00 |        8,272.50 |  2.690 |       4,351.00 |    0.1% |      0.54 | `LogPrintWithCategory`\r\n|                7.25 |      137,992,883.01 |    0.5% |           71.00 |           23.04 |  3.081 |          16.00 |    0.0% |      0.67 | `LogPrintWithoutCategory`\r\n|            3,779.40 |          264,592.05 |    0.3% |       22,773.01 |        8,416.90 |  2.706 |       4,473.00 |    0.1% |      0.54 | `LogPrintfCategoryWithThreadNames`\r\n|            3,709.16 |          269,602.50 |    0.4% |       22,122.00 |        8,208.57 |  2.695 |       4,318.00 |    0.1% |      0.53 | `LogPrintfCategoryWithoutThreadNames`\r\n|            3,737.44 |          267,562.59 |    0.4% |       22,495.01 |        8,290.13 |  2.713 |       4,399.00 |    0.1% |      0.53 | `LogPrintfWithThreadNames`\r\n|            3,630.74 |          275,425.89 |    0.1% |       21,844.00 |        7,989.23 |  2.734 |       4,244.00 |    0.1% |      0.53 | `LogPrintfWithoutThreadNames`\r\n|              100.84 |        9,916,479.93 |    0.0% |          802.00 |          320.90 |  2.499 |         186.00 |    0.0% |      0.55 | `LogWithoutWriteToFile`\r\n\r\nBy the way, here is a nice way to create & share detailed benchmark results, see the results here: https://share.firefox.dev/3Z02boN\r\n\r\nHow to do this:\r\n\r\n1. Run a benchmark for a few seconds and record data with perf\r\n   ```sh\r\n   perf record --call-graph lbr ./src/bench/bench_bitcoin -filter=\"LogPrintLevelWithoutThreadNames\" -min-time=5000\r\n   ```\r\n2. Convert into data readable with https://profiler.firefox.com/\r\n   ```sh\r\n   perf script -F +pid > /tmp/test.perf\r\n   ```\r\n3. Drag & drop `test.perf` into https://profiler.firefox.com/, upload the data, and create a permalink to it\r\n",
      "created_at" : "2023-03-18T07:36:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26957#issuecomment-1474761651",
      "id" : 1474761651,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26957",
      "node_id" : "IC_kwDOABII585X5xOz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1474761651/reactions"
      },
      "updated_at" : "2023-03-18T07:36:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1474761651",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Here's a suggestion about benchmarking in general, wonder what you think. The idea is a kind of performance regression testing.\r\n\r\nIf there are a set of related benchmarks, as there are here, there may be some expected performance relationship between them. (Above I [suggested](https://github.com/bitcoin/bitcoin/pull/26957#pullrequestreview-1314607947) that Jon add a comment describing this relationship, and he [did](https://github.com/bitcoin/bitcoin/pull/26957/files#diff-b65a90c310b14b523533c724ac297ed970168e01e9589352700c7c52353609f3R9-R13).) It would be cool if this could somehow be specified in the code and checked automatically, and a failure raised if the runtime ratio between the sub-benchmarks exceeded some threshold. So for example, if a bug was introduced that made `LogPrintWithoutCategory` run at about the same speed as the other types of logging, flag an error.\r\n\r\nWhat do you think? (Obviously not for this PR, but as a separate PR.)",
      "created_at" : "2023-03-18T15:10:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26957#issuecomment-1474874821",
      "id" : 1474874821,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26957",
      "node_id" : "IC_kwDOABII585X6M3F",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1474874821/reactions"
      },
      "updated_at" : "2023-03-18T15:10:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1474874821",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   }
]
