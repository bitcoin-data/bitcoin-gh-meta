[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#27419](https://github.com/bitcoin/bitcoin/pull/27419) (move-only: Extract common/args from util/system by TheCharlatan)\n* [#26728](https://github.com/bitcoin/bitcoin/pull/26728) (wallet: Have the wallet store the key for automatically generated descriptors by achow101)\n* [#25907](https://github.com/bitcoin/bitcoin/pull/25907) (wallet: rpc to add automatically generated descriptors by achow101)\n* [#24539](https://github.com/bitcoin/bitcoin/pull/24539) (Add a \"tx output spender\" index by sstone)\n* [#22341](https://github.com/bitcoin/bitcoin/pull/22341) (rpc: add getxpub by Sjors)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-01-23T12:38:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26951#issuecomment-1400275862",
      "id" : 1400275862,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26951",
      "node_id" : "IC_kwDOABII585TdoOW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1400275862/reactions"
      },
      "updated_at" : "2023-04-19T20:16:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1400275862",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "While a 640% performance improvement is nice, a PR of this size could probably include a bit more details explaining what you've changed and why you've changed it in the OP and the commit messages. This makes it easier for reviewers to approach and review your PR.",
      "created_at" : "2023-01-24T14:43:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26951#issuecomment-1402062107",
      "id" : 1402062107,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26951",
      "node_id" : "IC_kwDOABII585TkcUb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1402062107/reactions"
      },
      "updated_at" : "2023-01-24T14:43:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1402062107",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> which will also take time and consume permanent disk space (how much?).\r\n\r\nOn mainnet it takes 8.4G currently.",
      "created_at" : "2023-01-24T16:35:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26951#issuecomment-1402241440",
      "id" : 1402241440,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26951",
      "node_id" : "IC_kwDOABII585TlIGg",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1402241440/reactions"
      },
      "updated_at" : "2023-01-24T16:35:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1402241440",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@0xB10C I've reorganized the commits to be easier to understand and written a small explanation.\r\n@mzumsande Building the wallet filter index is optional, user with many keys and/or many wallets would greatly benefit from the performance improvement.\r\n@theStack I did a benchmark against no filters and bip158 filters on the mainnet chain specifically because it's really the only benchmark that matters.",
      "created_at" : "2023-01-26T09:43:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26951#issuecomment-1404759024",
      "id" : 1404759024,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26951",
      "node_id" : "IC_kwDOABII585Tuuvw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1404759024/reactions"
      },
      "updated_at" : "2023-01-26T09:43:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1404759024",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=4",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "node_id" : "MDQ6VXNlcjYyMDYxMQ==",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@theStack a more useful performance benchmark is that im looking into improving the filter decoder since that's about 50% of the cpu time",
      "created_at" : "2023-01-26T10:29:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26951#issuecomment-1404811495",
      "id" : 1404811495,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26951",
      "node_id" : "IC_kwDOABII585Tu7jn",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1404811495/reactions"
      },
      "updated_at" : "2023-01-26T10:29:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1404811495",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=4",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "node_id" : "MDQ6VXNlcjYyMDYxMQ==",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@pstratem: The main idea of the benchmark would be to determine the performance dependent of the wallet's keypool size. It's rather unlikely that a freshly created wallet (creating 8000 keys with default settings) shows the same speed-up as one that is in heavily in use daily and has hundreds of thousands keys in the pool, e.g. an exchange. At the very least, it would be interesting to know the keypool size of the wallet you used for the results shown in the PR description.",
      "created_at" : "2023-01-26T11:30:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26951#issuecomment-1404876853",
      "id" : 1404876853,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26951",
      "node_id" : "IC_kwDOABII585TvLg1",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1404876853/reactions"
      },
      "updated_at" : "2023-01-26T11:30:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1404876853",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@theStack the wallet I used had 10k keys, with more keys it will be slower since it does till have to do some processing for each key for each block.\r\n\r\nedit: with 0 keys it's 5.4 minutes",
      "created_at" : "2023-01-26T11:42:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26951#issuecomment-1404887542",
      "id" : 1404887542,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26951",
      "node_id" : "IC_kwDOABII585TvOH2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1404887542/reactions"
      },
      "updated_at" : "2023-01-26T12:34:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1404887542",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=4",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "node_id" : "MDQ6VXNlcjYyMDYxMQ==",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Is it possible to see this performance improvement in any functional test?",
      "created_at" : "2023-01-27T09:52:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26951#issuecomment-1406268596",
      "id" : 1406268596,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26951",
      "node_id" : "IC_kwDOABII585T0fS0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1406268596/reactions"
      },
      "updated_at" : "2023-01-27T09:52:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1406268596",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I agree with others above that this pull requests needs more explanation. The name \"wallet\" is also a bit confusing, since the `basic` block filter also used for wallets.\r\n\r\nCan this be implemented with a new type of block filter, e.g. call it `FAST`, so that adding the index is a matter of `-blockfilterindex=fast`? That would probably make this PR smaller.",
      "created_at" : "2023-01-27T14:36:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26951#issuecomment-1406589364",
      "id" : 1406589364,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26951",
      "node_id" : "IC_kwDOABII585T1tm0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1406589364/reactions"
      },
      "updated_at" : "2023-01-27T14:37:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1406589364",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@Sjors no it cannot\r\n> Can this be implemented with a new type of block filter, e.g. call it FAST, so that adding the index is a matter of -blockfilterindex=fast? That would probably make this PR smaller.\r\n\r\nedit: to be clear that was the way i tried to do this initially a long time ago, it was a huge headache changing the disk format and storing the siphash keys",
      "created_at" : "2023-01-28T15:26:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26951#issuecomment-1407422151",
      "id" : 1407422151,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26951",
      "node_id" : "IC_kwDOABII585T447H",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1407422151/reactions"
      },
      "updated_at" : "2023-01-28T16:04:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1407422151",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=4",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "node_id" : "MDQ6VXNlcjYyMDYxMQ==",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@Sjors I'm not sure what else needs explaining, but I'm happy to explain things if i know what's confusing.",
      "created_at" : "2023-01-28T16:10:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26951#issuecomment-1407429918",
      "id" : 1407429918,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26951",
      "node_id" : "IC_kwDOABII585T460e",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1407429918/reactions"
      },
      "updated_at" : "2023-01-28T16:10:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1407429918",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=4",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "node_id" : "MDQ6VXNlcjYyMDYxMQ==",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Let me clarify some, basically I don't think the BlockFilter/BlockFilterIndex interface can be reasonably changed to be fast. There's a few issues (at least one of which is my fault).\r\n\r\nThe BlockFilter and BlockFilterIndex interfaces assume that the GCSFilter::Params can be generated just from the filter type and the block_hash.  I previously tried changing these interfaces so that they didn't make this assumption, but I found that to involve a lot of changes that were frankly just confusing.\r\n\r\nThe BlockFilter serialization matches the BIP157/158 serialization, but isn't the serialization that I want for the wallet rescan index.  Specifically the index ends up writing the block_hash twice and the filter_type to the flat file, both of which are implied when looking up the filter in the first place. (They waste disk space and decode time).\r\n\r\nLastly the BlockFilterIndex appends a sha256 hash to the end to check for disk corruption, this would be a significant cost (indeed the siphash that I'm using now is 10% of the total runtime, I'm going to replace it with a crc32c).",
      "created_at" : "2023-01-29T07:41:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26951#issuecomment-1407589090",
      "id" : 1407589090,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26951",
      "node_id" : "IC_kwDOABII585T5hri",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1407589090/reactions"
      },
      "updated_at" : "2023-01-29T07:41:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1407589090",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=4",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "node_id" : "MDQ6VXNlcjYyMDYxMQ==",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26951#discussion_r1091050574"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26951"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1091050574"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 9035eb95b286f0c28d402778118ac9eb10a840d5 \"Introduce GCSFilter::QuerySet a cached hash query set for GCSFilter::MatchAny\"\r\n\r\nShould `m_hashed_elements` be sorted first, or `ranged_elements` be sorted afterwards? `m_hashed_elements` may not be sorted depending on which variation of `insert` was called earlier.",
      "commit_id" : "389d12f8566639b06cbdcd1b5edd92a29283cba8",
      "created_at" : "2023-01-30T19:23:59Z",
      "diff_hunk" : "@@ -24,6 +24,32 @@ static const std::map<BlockFilterType, std::string> g_filter_types = {\n     {BlockFilterType::BASIC, \"basic\"},\n };\n \n+GCSFilter::QuerySet::QuerySet(const Params& params, const ElementSet& elements)\n+    : m_params(params)\n+{\n+    for (const Element& element : elements)\n+        insert(element, false);\n+    std::sort(m_hashed_elements.begin(), m_hashed_elements.end());\n+}\n+\n+void GCSFilter::QuerySet::insert(const Element& element, bool sort)\n+{\n+    uint64_t hashed_element = HashElement(element, m_params.m_siphash_k0, m_params.m_siphash_k1);\n+    m_hashed_elements.push_back(hashed_element);\n+    if (sort)\n+        std::sort(m_hashed_elements.begin(), m_hashed_elements.end());\n+}\n+\n+std::vector<uint64_t> GCSFilter::QuerySet::sorted_and_ranged(const uint64_t& F) const\n+{\n+    std::vector<uint64_t> ranged_elements;\n+    ranged_elements.reserve(m_hashed_elements.size());\n+    for (const uint64_t& hashed_element : m_hashed_elements) {\n+        ranged_elements.push_back(RangeHashedElement(hashed_element, F));\n+    }\n+    return ranged_elements;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26951#discussion_r1091050574",
      "id" : 1091050574,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585BCBxO",
      "original_commit_id" : "9035eb95b286f0c28d402778118ac9eb10a840d5",
      "original_line" : 50,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/blockfilter.cpp",
      "position" : 27,
      "pull_request_review_id" : 1275832382,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26951",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1091050574/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-30T21:29:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1091050574",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26951#discussion_r1091070957"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26951"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1091070957"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In d7a50ae6a64c15190781c40d34146d1a3eb01934 \"Implement WalletFilterIndex.\"\r\n\r\nThese already exist in `src/blockfilter.h`, I don't think they need to be redefined.",
      "commit_id" : "389d12f8566639b06cbdcd1b5edd92a29283cba8",
      "created_at" : "2023-01-30T19:46:26Z",
      "diff_hunk" : "@@ -0,0 +1,265 @@\n+// Copyright (c) 2018-2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <map>\n+#include <cmath>\n+\n+#include <dbwrapper.h>\n+#include <hash.h>\n+#include <index/walletfilterindex.h>\n+#include <node/blockstorage.h>\n+#include <util/system.h>\n+#include <validation.h>\n+\n+std::unique_ptr<WalletFilterIndex> g_wallet_filter_index;\n+\n+using node::UndoReadFromDisk;\n+\n+constexpr uint8_t DB_BLOCK_HASH{'s'};\n+constexpr uint8_t DB_FILTER_POS{'P'};\n+constexpr uint8_t DB_SIPHASH_K0{'k'};\n+constexpr uint8_t DB_SIPHASH_K1{'K'};\n+\n+constexpr unsigned int MAX_FLTR_FILE_SIZE = 0x1000000; // 16 MiB\n+/** The pre-allocation chunk size for fltr?????.dat files */\n+constexpr unsigned int FLTR_FILE_CHUNK_SIZE = 0x100000; // 1 MiB\n+\n+// value for M explained https://github.com/sipa/writeups/tree/main/minimizing-golomb-filters\n+constexpr uint8_t WALLET_FILTER_P = 19;\n+constexpr uint32_t WALLET_FILTER_M = 784931; // 1.497137 * pow(2,WALLET_FILTER_P);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26951#discussion_r1091070957",
      "id" : 1091070957,
      "line" : 30,
      "node_id" : "PRRC_kwDOABII585BCGvt",
      "original_commit_id" : "d7a50ae6a64c15190781c40d34146d1a3eb01934",
      "original_line" : 30,
      "original_position" : 30,
      "original_start_line" : 28,
      "path" : "src/index/walletfilterindex.cpp",
      "position" : 30,
      "pull_request_review_id" : 1275832382,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26951",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1091070957/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 28,
      "start_side" : "RIGHT",
      "updated_at" : "2023-01-30T21:29:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1091070957",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26951#discussion_r1091079158"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26951"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1091079158"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In d7a50ae6a64c15190781c40d34146d1a3eb01934 \"Implement WalletFilterIndex.\"\r\n\r\nSeveral of these functions are identical between `WalletFilterIndex` and `BlockFilterIndex`. Could these be refactored and deduplicated?",
      "commit_id" : "389d12f8566639b06cbdcd1b5edd92a29283cba8",
      "created_at" : "2023-01-30T19:55:30Z",
      "diff_hunk" : "@@ -0,0 +1,54 @@\n+// Copyright (c) 2018-2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_INDEX_WALLETFILTERINDEX_H\n+#define BITCOIN_INDEX_WALLETFILTERINDEX_H\n+\n+#include <attributes.h>\n+#include <blockfilter.h>\n+#include <chain.h>\n+#include <flatfile.h>\n+#include <index/base.h>\n+#include <util/hasher.h>\n+\n+static constexpr bool DEFAULT_WALLETFILTERINDEX{false};\n+\n+class WalletFilterIndex final : public BaseIndex",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26951#discussion_r1091079158",
      "id" : 1091079158,
      "line" : 17,
      "node_id" : "PRRC_kwDOABII585BCIv2",
      "original_commit_id" : "d7a50ae6a64c15190781c40d34146d1a3eb01934",
      "original_line" : 17,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/index/walletfilterindex.h",
      "position" : 17,
      "pull_request_review_id" : 1275832382,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26951",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1091079158/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-30T21:29:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1091079158",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26951#discussion_r1091080820"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26951"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1091080820"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 523b7095462c7aa8e2ba2b1110938ac9a2aa3c4d \" test: add test for faster rescan using block filters (top-up detection)\"\r\n\r\nThis test is a literally a copy of `wallet_fast_rescan.py`. I think it would be better to just extend `wallet_fast_rescan.py` to run its tests twice, once with `-blockfilterindex` and a second time with `-walletfilterindex`. If we want parallelism in the test runner, could also add a CLI option to the test to run it with either of those indexes.",
      "commit_id" : "389d12f8566639b06cbdcd1b5edd92a29283cba8",
      "created_at" : "2023-01-30T19:57:17Z",
      "diff_hunk" : "@@ -0,0 +1,104 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that fast rescan using block filters for descriptor wallets detects\n+   top-ups correctly and finds the same transactions than the slow variant.\"\"\"\n+import os\n+from typing import List\n+\n+from test_framework.descriptors import descsum_create\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.test_node import TestNode\n+from test_framework.util import assert_equal\n+from test_framework.wallet import MiniWallet\n+from test_framework.wallet_util import get_generate_key\n+\n+\n+KEYPOOL_SIZE = 100   # smaller than default size to speed-up test\n+NUM_DESCRIPTORS = 9  # number of descriptors (8 default ranged ones + 1 fixed non-ranged one)\n+NUM_BLOCKS = 6       # number of blocks to mine\n+\n+\n+class WalletFasterRescanTest(BitcoinTestFramework):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26951#discussion_r1091080820",
      "id" : 1091080820,
      "line" : 23,
      "node_id" : "PRRC_kwDOABII585BCJJ0",
      "original_commit_id" : "523b7095462c7aa8e2ba2b1110938ac9a2aa3c4d",
      "original_line" : 23,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "test/functional/wallet_faster_rescan.py",
      "position" : 23,
      "pull_request_review_id" : 1275832382,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26951",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1091080820/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-30T21:29:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1091080820",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26951#discussion_r1091100452"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26951"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1091100452"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In ec165ea9412bd2ac2b524209512fe248ce45cf07 \"Truncate the hashed elements into range inside MatchInternal\"\r\n\r\nIs it possible for the sort order after the truncation to be different from the order before?",
      "commit_id" : "389d12f8566639b06cbdcd1b5edd92a29283cba8",
      "created_at" : "2023-01-30T20:19:36Z",
      "diff_hunk" : "@@ -158,9 +153,9 @@ bool GCSFilter::MatchInternal(const uint64_t* element_hashes, size_t size) const\n         while (true) {\n             if (hashes_index == size) {\n                 return false;\n-            } else if (element_hashes[hashes_index] == value) {\n+            } else if (RangeHashedElement(element_hashes[hashes_index]) == value) {\n                 return true;\n-            } else if (element_hashes[hashes_index] > value) {\n+            } else if (RangeHashedElement(element_hashes[hashes_index]) > value) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26951#discussion_r1091100452",
      "id" : 1091100452,
      "line" : 161,
      "node_id" : "PRRC_kwDOABII585BCN8k",
      "original_commit_id" : "ec165ea9412bd2ac2b524209512fe248ce45cf07",
      "original_line" : 158,
      "original_position" : 25,
      "original_start_line" : 161,
      "path" : "src/blockfilter.cpp",
      "position" : 25,
      "pull_request_review_id" : 1275832382,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26951",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1091100452/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 124,
      "start_side" : "LEFT",
      "updated_at" : "2023-01-30T21:29:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1091100452",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26951#discussion_r1091189335"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26951"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1091189335"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 050716c48d703424dc94fde9d7f987b55cbff6a9 \"Use wallet filter during rescan if available.\"\r\n\r\nI feel like there's a better way to do this, but I'm not familiar enough with build systems to suggest one. Perhaps @fanquake might have an idea?",
      "commit_id" : "389d12f8566639b06cbdcd1b5edd92a29283cba8",
      "created_at" : "2023-01-30T21:38:52Z",
      "diff_hunk" : "@@ -463,6 +463,7 @@ endif\n libbitcoin_wallet_a_CPPFLAGS = $(AM_CPPFLAGS) $(BITCOIN_INCLUDES) $(BOOST_CPPFLAGS) $(BDB_CPPFLAGS) $(SQLITE_CFLAGS)\n libbitcoin_wallet_a_CXXFLAGS = $(AM_CXXFLAGS) $(PIE_FLAGS)\n libbitcoin_wallet_a_SOURCES = \\\n+  blockfilter.cpp \\",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26951#discussion_r1091189335",
      "id" : 1091189335,
      "line" : 466,
      "node_id" : "PRRC_kwDOABII585BCjpX",
      "original_commit_id" : "050716c48d703424dc94fde9d7f987b55cbff6a9",
      "original_line" : 466,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/Makefile.am",
      "position" : 4,
      "pull_request_review_id" : 1276077850,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26951",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1091189335/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-30T21:38:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1091189335",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@achow101 These filters can be used for everything we use the other block filters for, I've only implemented the wallet query because that's the biggest win I see, but there's no reason they couldn't be used everywhere else (where there might be similar speed ups available).\r\n\r\nmaybe I should change the name of the index, FixedBlockFilterIndex ?",
      "created_at" : "2023-02-01T07:06:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26951#issuecomment-1411561487",
      "id" : 1411561487,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26951",
      "node_id" : "IC_kwDOABII585UIrgP",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1411561487/reactions"
      },
      "updated_at" : "2023-02-01T07:06:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1411561487",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=4",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "node_id" : "MDQ6VXNlcjYyMDYxMQ==",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26951#discussion_r1092834198"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26951"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1092834198"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "m_hashed_elements needs to be sorted before it's used in the comparison, whether it's before or after being ranged doesn't change the result, but does change the runtime (the range function doesn't change the sort order of the list).\r\n\r\nby doing the sort before ranging we only have to do it once per unique set of elements, which is a performance win.\r\n\r\nit looks like i did mess up the initial commit, it's fixed in the later commit that makes sorting explicit, I can squash most of that into the initial commit.",
      "commit_id" : "389d12f8566639b06cbdcd1b5edd92a29283cba8",
      "created_at" : "2023-02-01T07:08:46Z",
      "diff_hunk" : "@@ -24,6 +24,32 @@ static const std::map<BlockFilterType, std::string> g_filter_types = {\n     {BlockFilterType::BASIC, \"basic\"},\n };\n \n+GCSFilter::QuerySet::QuerySet(const Params& params, const ElementSet& elements)\n+    : m_params(params)\n+{\n+    for (const Element& element : elements)\n+        insert(element, false);\n+    std::sort(m_hashed_elements.begin(), m_hashed_elements.end());\n+}\n+\n+void GCSFilter::QuerySet::insert(const Element& element, bool sort)\n+{\n+    uint64_t hashed_element = HashElement(element, m_params.m_siphash_k0, m_params.m_siphash_k1);\n+    m_hashed_elements.push_back(hashed_element);\n+    if (sort)\n+        std::sort(m_hashed_elements.begin(), m_hashed_elements.end());\n+}\n+\n+std::vector<uint64_t> GCSFilter::QuerySet::sorted_and_ranged(const uint64_t& F) const\n+{\n+    std::vector<uint64_t> ranged_elements;\n+    ranged_elements.reserve(m_hashed_elements.size());\n+    for (const uint64_t& hashed_element : m_hashed_elements) {\n+        ranged_elements.push_back(RangeHashedElement(hashed_element, F));\n+    }\n+    return ranged_elements;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26951#discussion_r1092834198",
      "id" : 1092834198,
      "in_reply_to_id" : 1091050574,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585BI1OW",
      "original_commit_id" : "9035eb95b286f0c28d402778118ac9eb10a840d5",
      "original_line" : 50,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/blockfilter.cpp",
      "position" : 27,
      "pull_request_review_id" : 1278533920,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26951",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1092834198/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-01T07:08:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1092834198",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=4",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "node_id" : "MDQ6VXNlcjYyMDYxMQ==",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26951#discussion_r1092835926"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26951"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1092835926"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It might make sense to change these values from the BASIC filter values, changing P =32 improves the false positive rate from 1 in 784,931 to 1 in 6,430,154,452 for a trade off of 68% larger filters.\r\n\r\nIt also might make sense to make it a configuration option when the filters are generated, the value could easily be stored in the index leveldb instead of being a constant.",
      "commit_id" : "389d12f8566639b06cbdcd1b5edd92a29283cba8",
      "created_at" : "2023-02-01T07:11:28Z",
      "diff_hunk" : "@@ -0,0 +1,265 @@\n+// Copyright (c) 2018-2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <map>\n+#include <cmath>\n+\n+#include <dbwrapper.h>\n+#include <hash.h>\n+#include <index/walletfilterindex.h>\n+#include <node/blockstorage.h>\n+#include <util/system.h>\n+#include <validation.h>\n+\n+std::unique_ptr<WalletFilterIndex> g_wallet_filter_index;\n+\n+using node::UndoReadFromDisk;\n+\n+constexpr uint8_t DB_BLOCK_HASH{'s'};\n+constexpr uint8_t DB_FILTER_POS{'P'};\n+constexpr uint8_t DB_SIPHASH_K0{'k'};\n+constexpr uint8_t DB_SIPHASH_K1{'K'};\n+\n+constexpr unsigned int MAX_FLTR_FILE_SIZE = 0x1000000; // 16 MiB\n+/** The pre-allocation chunk size for fltr?????.dat files */\n+constexpr unsigned int FLTR_FILE_CHUNK_SIZE = 0x100000; // 1 MiB\n+\n+// value for M explained https://github.com/sipa/writeups/tree/main/minimizing-golomb-filters\n+constexpr uint8_t WALLET_FILTER_P = 19;\n+constexpr uint32_t WALLET_FILTER_M = 784931; // 1.497137 * pow(2,WALLET_FILTER_P);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26951#discussion_r1092835926",
      "id" : 1092835926,
      "in_reply_to_id" : 1091070957,
      "line" : 30,
      "node_id" : "PRRC_kwDOABII585BI1pW",
      "original_commit_id" : "d7a50ae6a64c15190781c40d34146d1a3eb01934",
      "original_line" : 30,
      "original_position" : 30,
      "original_start_line" : 28,
      "path" : "src/index/walletfilterindex.cpp",
      "position" : 30,
      "pull_request_review_id" : 1278536473,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26951",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1092835926/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 28,
      "start_side" : "RIGHT",
      "updated_at" : "2023-02-01T07:11:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1092835926",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=4",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "node_id" : "MDQ6VXNlcjYyMDYxMQ==",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26951#discussion_r1092842295"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26951"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1092842295"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "WalletFilterIndex::CustomCommit, WalletFilterElements, and DBHashKey are all candidates.\r\n\r\nWalletFilterElements and DBHashKey I can certainly refactor to consolidate the logic.\r\n\r\nThe CustomCommit method though seems like it would end up adding a bunch of complexity to reuse with very little benefit.",
      "commit_id" : "389d12f8566639b06cbdcd1b5edd92a29283cba8",
      "created_at" : "2023-02-01T07:21:03Z",
      "diff_hunk" : "@@ -0,0 +1,54 @@\n+// Copyright (c) 2018-2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_INDEX_WALLETFILTERINDEX_H\n+#define BITCOIN_INDEX_WALLETFILTERINDEX_H\n+\n+#include <attributes.h>\n+#include <blockfilter.h>\n+#include <chain.h>\n+#include <flatfile.h>\n+#include <index/base.h>\n+#include <util/hasher.h>\n+\n+static constexpr bool DEFAULT_WALLETFILTERINDEX{false};\n+\n+class WalletFilterIndex final : public BaseIndex",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26951#discussion_r1092842295",
      "id" : 1092842295,
      "in_reply_to_id" : 1091079158,
      "line" : 17,
      "node_id" : "PRRC_kwDOABII585BI3M3",
      "original_commit_id" : "d7a50ae6a64c15190781c40d34146d1a3eb01934",
      "original_line" : 17,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/index/walletfilterindex.h",
      "position" : 17,
      "pull_request_review_id" : 1278545816,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26951",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1092842295/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-01T07:21:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1092842295",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=4",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "node_id" : "MDQ6VXNlcjYyMDYxMQ==",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26951#discussion_r1092844580"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26951"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1092844580"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think I can do that, but I haven't written many of the functional tests so that might take some trial and error.",
      "commit_id" : "389d12f8566639b06cbdcd1b5edd92a29283cba8",
      "created_at" : "2023-02-01T07:24:05Z",
      "diff_hunk" : "@@ -0,0 +1,104 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that fast rescan using block filters for descriptor wallets detects\n+   top-ups correctly and finds the same transactions than the slow variant.\"\"\"\n+import os\n+from typing import List\n+\n+from test_framework.descriptors import descsum_create\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.test_node import TestNode\n+from test_framework.util import assert_equal\n+from test_framework.wallet import MiniWallet\n+from test_framework.wallet_util import get_generate_key\n+\n+\n+KEYPOOL_SIZE = 100   # smaller than default size to speed-up test\n+NUM_DESCRIPTORS = 9  # number of descriptors (8 default ranged ones + 1 fixed non-ranged one)\n+NUM_BLOCKS = 6       # number of blocks to mine\n+\n+\n+class WalletFasterRescanTest(BitcoinTestFramework):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26951#discussion_r1092844580",
      "id" : 1092844580,
      "in_reply_to_id" : 1091080820,
      "line" : 23,
      "node_id" : "PRRC_kwDOABII585BI3wk",
      "original_commit_id" : "523b7095462c7aa8e2ba2b1110938ac9a2aa3c4d",
      "original_line" : 23,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "test/functional/wallet_faster_rescan.py",
      "position" : 23,
      "pull_request_review_id" : 1278548824,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26951",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1092844580/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-01T07:24:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1092844580",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=4",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "node_id" : "MDQ6VXNlcjYyMDYxMQ==",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26951#discussion_r1092853365"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26951"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1092853365"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "No the truncation doesn't change the sort order, the fast range function is just (x*n) >> 64, the order of which is always going to be the same as the order of x.\r\n\r\nDoing the Range inside the MatchInternal means we don't have to make a copy of the array.",
      "commit_id" : "389d12f8566639b06cbdcd1b5edd92a29283cba8",
      "created_at" : "2023-02-01T07:36:11Z",
      "diff_hunk" : "@@ -158,9 +153,9 @@ bool GCSFilter::MatchInternal(const uint64_t* element_hashes, size_t size) const\n         while (true) {\n             if (hashes_index == size) {\n                 return false;\n-            } else if (element_hashes[hashes_index] == value) {\n+            } else if (RangeHashedElement(element_hashes[hashes_index]) == value) {\n                 return true;\n-            } else if (element_hashes[hashes_index] > value) {\n+            } else if (RangeHashedElement(element_hashes[hashes_index]) > value) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26951#discussion_r1092853365",
      "id" : 1092853365,
      "in_reply_to_id" : 1091100452,
      "line" : 161,
      "node_id" : "PRRC_kwDOABII585BI551",
      "original_commit_id" : "ec165ea9412bd2ac2b524209512fe248ce45cf07",
      "original_line" : 158,
      "original_position" : 25,
      "original_start_line" : 161,
      "path" : "src/blockfilter.cpp",
      "position" : 25,
      "pull_request_review_id" : 1278561413,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26951",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1092853365/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 124,
      "start_side" : "LEFT",
      "updated_at" : "2023-02-01T07:37:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1092853365",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=4",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "node_id" : "MDQ6VXNlcjYyMDYxMQ==",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26951#discussion_r1092854768"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26951"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1092854768"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "yes this felt kind of wrong but I didn't see another way to achieve the result. suggestions definitely wanted.",
      "commit_id" : "389d12f8566639b06cbdcd1b5edd92a29283cba8",
      "created_at" : "2023-02-01T07:38:02Z",
      "diff_hunk" : "@@ -463,6 +463,7 @@ endif\n libbitcoin_wallet_a_CPPFLAGS = $(AM_CPPFLAGS) $(BITCOIN_INCLUDES) $(BOOST_CPPFLAGS) $(BDB_CPPFLAGS) $(SQLITE_CFLAGS)\n libbitcoin_wallet_a_CXXFLAGS = $(AM_CXXFLAGS) $(PIE_FLAGS)\n libbitcoin_wallet_a_SOURCES = \\\n+  blockfilter.cpp \\",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26951#discussion_r1092854768",
      "id" : 1092854768,
      "in_reply_to_id" : 1091189335,
      "line" : 466,
      "node_id" : "PRRC_kwDOABII585BI6Pw",
      "original_commit_id" : "050716c48d703424dc94fde9d7f987b55cbff6a9",
      "original_line" : 466,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/Makefile.am",
      "position" : 4,
      "pull_request_review_id" : 1278563501,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26951",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1092854768/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-01T07:38:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1092854768",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=4",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "node_id" : "MDQ6VXNlcjYyMDYxMQ==",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26951#discussion_r1095318121"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26951"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1095318121"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I've broken out this change into it's own commit with an explanation.",
      "commit_id" : "5db12449936ee6361a21be4b657a22735a67b0d9",
      "created_at" : "2023-02-03T03:19:36Z",
      "diff_hunk" : "@@ -24,6 +24,32 @@ static const std::map<BlockFilterType, std::string> g_filter_types = {\n     {BlockFilterType::BASIC, \"basic\"},\n };\n \n+GCSFilter::QuerySet::QuerySet(const Params& params, const ElementSet& elements)\n+    : m_params(params)\n+{\n+    for (const Element& element : elements)\n+        insert(element, false);\n+    std::sort(m_hashed_elements.begin(), m_hashed_elements.end());\n+}\n+\n+void GCSFilter::QuerySet::insert(const Element& element, bool sort)\n+{\n+    uint64_t hashed_element = HashElement(element, m_params.m_siphash_k0, m_params.m_siphash_k1);\n+    m_hashed_elements.push_back(hashed_element);\n+    if (sort)\n+        std::sort(m_hashed_elements.begin(), m_hashed_elements.end());\n+}\n+\n+std::vector<uint64_t> GCSFilter::QuerySet::sorted_and_ranged(const uint64_t& F) const\n+{\n+    std::vector<uint64_t> ranged_elements;\n+    ranged_elements.reserve(m_hashed_elements.size());\n+    for (const uint64_t& hashed_element : m_hashed_elements) {\n+        ranged_elements.push_back(RangeHashedElement(hashed_element, F));\n+    }\n+    return ranged_elements;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26951#discussion_r1095318121",
      "id" : 1095318121,
      "in_reply_to_id" : 1091050574,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585BSTpp",
      "original_commit_id" : "9035eb95b286f0c28d402778118ac9eb10a840d5",
      "original_line" : 50,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 1282231055,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26951",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1095318121/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-03T03:19:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1095318121",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=4",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "node_id" : "MDQ6VXNlcjYyMDYxMQ==",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-04-21T10:28:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26951#issuecomment-1517621335",
      "id" : 1517621335,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26951",
      "node_id" : "IC_kwDOABII585adRBX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1517621335/reactions"
      },
      "updated_at" : "2023-04-21T10:28:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1517621335",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept -0\r\n\r\nWhile this may be very useful for certain wallet usage patterns, this doesn't seem generally useful for _all_ wallets, which makes it hard to justify the review/complexity/maintenance burden.\r\n\r\n\r\n> @achow101 These filters can be used for everything we use the other block filters for, I've only implemented the wallet query because that's the biggest win I see, but there's no reason they couldn't be used everywhere else (where there might be similar speed ups available).\r\n\r\nWallet rescans and serving BIP158 filters are the only use cases for the block filter index that I'm aware of. If you have other examples, it would be great to enumerate them.\r\n\r\n> maybe I should change the name of the index, FixedBlockFilterIndex ?\r\n\r\nRather than make a new index, if there are ways to improve the existing `BlockFilter` index, I think that would be much better as we would be improving two existing use cases without needing to maintain a new index.\r\n\r\nOverall, while there is clearly an improvement over using the existing `BlockFilter` index for wallet rescans, I think wallet rescans with the existing index are \"good enough\" and adding an extra index provides diminishing returns.",
      "created_at" : "2023-05-01T12:37:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26951#issuecomment-1529672330",
      "id" : 1529672330,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26951",
      "node_id" : "IC_kwDOABII585bLPKK",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1529672330/reactions"
      },
      "updated_at" : "2023-05-01T12:37:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1529672330",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Rather than make a new index, if there are ways to improve the existing BlockFilter index, I think that would be much better as we would be improving two existing use cases without needing to maintain a new index.\r\n\r\n@josibake, orthogonal topic but check #26966 and #27006 :).",
      "created_at" : "2023-05-01T12:42:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26951#issuecomment-1529674779",
      "id" : 1529674779,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26951",
      "node_id" : "IC_kwDOABII585bLPwb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1529674779/reactions"
      },
      "updated_at" : "2023-05-01T12:42:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1529674779",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   }
]
