[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Here's a more concrete proposal:  We already have `fSyncStarted` in the node state of `main.cpp`.  This is set to true when we start requesting headers from a particular node, so we can use it to _not_ request headers from this node also following an inv message.  In addition, we have to reset the flag to false once we receive a headers message that does not have the maximum size - currently, it is never reset.\n\nAre there any problems with this approach or is it ok?  This is straight-forward to implement and fixes, as far as my preliminary testing goes, the issue.\n",
      "created_at" : "2015-10-04T15:53:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6755#issuecomment-145361183",
      "id" : 145361183,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6755",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDE0NTM2MTE4Mw==",
      "updated_at" : "2015-10-04T15:53:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/145361183",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/4943644?v=4",
         "events_url" : "https://api.github.com/users/domob1812/events{/privacy}",
         "followers_url" : "https://api.github.com/users/domob1812/followers",
         "following_url" : "https://api.github.com/users/domob1812/following{/other_user}",
         "gists_url" : "https://api.github.com/users/domob1812/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/domob1812",
         "id" : 4943644,
         "login" : "domob1812",
         "node_id" : "MDQ6VXNlcjQ5NDM2NDQ=",
         "organizations_url" : "https://api.github.com/users/domob1812/orgs",
         "received_events_url" : "https://api.github.com/users/domob1812/received_events",
         "repos_url" : "https://api.github.com/users/domob1812/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/domob1812/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/domob1812/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/domob1812"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "My proposed patch is at https://github.com/bitcoin/bitcoin/pull/6821.  I tried various things to avoid the issue and in the end, the approach implemented in the patch seemed to be the best to me.\n",
      "created_at" : "2015-10-13T17:59:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6755#issuecomment-147796419",
      "id" : 147796419,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6755",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDE0Nzc5NjQxOQ==",
      "updated_at" : "2015-10-13T17:59:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/147796419",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/4943644?v=4",
         "events_url" : "https://api.github.com/users/domob1812/events{/privacy}",
         "followers_url" : "https://api.github.com/users/domob1812/followers",
         "following_url" : "https://api.github.com/users/domob1812/following{/other_user}",
         "gists_url" : "https://api.github.com/users/domob1812/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/domob1812",
         "id" : 4943644,
         "login" : "domob1812",
         "node_id" : "MDQ6VXNlcjQ5NDM2NDQ=",
         "organizations_url" : "https://api.github.com/users/domob1812/orgs",
         "received_events_url" : "https://api.github.com/users/domob1812/received_events",
         "repos_url" : "https://api.github.com/users/domob1812/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/domob1812/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/domob1812/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/domob1812"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@domob1812 I've just read through this issue and the 2 PRs you made and I've also seen that #8054 was later reverted again. Did you do any further investigation into this issue after the revert?\r\n\r\nI'm currently facing the problem of duplicate headers download while working on Dash. The amount of received data while doing the initial headers-only sync is approx. 10 times as much as I would expect, resulting in a pretty bad delay until actual block download starts. My debugging sessions have shown that there are alot of duplicate headers received, so it must be this same issue.",
      "created_at" : "2017-08-21T10:09:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6755#issuecomment-323704029",
      "id" : 323704029,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6755",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDMyMzcwNDAyOQ==",
      "updated_at" : "2017-08-21T10:09:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/323704029",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1884269?v=4",
         "events_url" : "https://api.github.com/users/codablock/events{/privacy}",
         "followers_url" : "https://api.github.com/users/codablock/followers",
         "following_url" : "https://api.github.com/users/codablock/following{/other_user}",
         "gists_url" : "https://api.github.com/users/codablock/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/codablock",
         "id" : 1884269,
         "login" : "codablock",
         "node_id" : "MDQ6VXNlcjE4ODQyNjk=",
         "organizations_url" : "https://api.github.com/users/codablock/orgs",
         "received_events_url" : "https://api.github.com/users/codablock/received_events",
         "repos_url" : "https://api.github.com/users/codablock/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/codablock/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/codablock/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/codablock"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@codablock No, I've not spent any more effort on this after my commit got reverted.  For Huntercoin, where this issue was most severe in the projects I'm interested in, I just didn't revert the upstream commit and it works fine for that purpose so far.\r\n\r\nBut if you have any ideas for how to properly fix the issue or would like to give it a shot, I'd still be very happy to have this fixed properly in upstream Bitcoin.",
      "created_at" : "2017-08-21T15:35:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6755#issuecomment-323777405",
      "id" : 323777405,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6755",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDMyMzc3NzQwNQ==",
      "updated_at" : "2017-08-21T15:35:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/323777405",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/4943644?v=4",
         "events_url" : "https://api.github.com/users/domob1812/events{/privacy}",
         "followers_url" : "https://api.github.com/users/domob1812/followers",
         "following_url" : "https://api.github.com/users/domob1812/following{/other_user}",
         "gists_url" : "https://api.github.com/users/domob1812/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/domob1812",
         "id" : 4943644,
         "login" : "domob1812",
         "node_id" : "MDQ6VXNlcjQ5NDM2NDQ=",
         "organizations_url" : "https://api.github.com/users/domob1812/orgs",
         "received_events_url" : "https://api.github.com/users/domob1812/received_events",
         "repos_url" : "https://api.github.com/users/domob1812/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/domob1812/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/domob1812/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/domob1812"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I found 76f74811c44b5119d5c19364b0594d423248ac0e which was merged in the mean time. It adds a timeout to headers sync. As I understood your first attempt (https://github.com/bitcoin/bitcoin/pull/6821) to fix the duplicate headers issues, it was rejected because at that time, a node did not get another chance to do a full sync in case he got a bad node for the initial sync. Now that timeouts are implemented for headers sync, shouldn't your first PR be fine today?",
      "created_at" : "2017-08-21T16:31:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6755#issuecomment-323792476",
      "id" : 323792476,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6755",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDMyMzc5MjQ3Ng==",
      "updated_at" : "2017-08-21T16:31:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/323792476",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1884269?v=4",
         "events_url" : "https://api.github.com/users/codablock/events{/privacy}",
         "followers_url" : "https://api.github.com/users/codablock/followers",
         "following_url" : "https://api.github.com/users/codablock/following{/other_user}",
         "gists_url" : "https://api.github.com/users/codablock/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/codablock",
         "id" : 1884269,
         "login" : "codablock",
         "node_id" : "MDQ6VXNlcjE4ODQyNjk=",
         "organizations_url" : "https://api.github.com/users/codablock/orgs",
         "received_events_url" : "https://api.github.com/users/codablock/received_events",
         "repos_url" : "https://api.github.com/users/codablock/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/codablock/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/codablock/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/codablock"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Linking the [comment](https://github.com/bitcoin/bitcoin/pull/8306#issuecomment-614916454) on #8306 from @DeckerSU here for those interested in continuing the discussion on this issue.",
      "created_at" : "2020-05-02T12:42:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6755#issuecomment-622947840",
      "id" : 622947840,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6755",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMjk0Nzg0MA==",
      "updated_at" : "2020-05-02T12:42:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/622947840",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/755825?v=4",
         "events_url" : "https://api.github.com/users/adamjonas/events{/privacy}",
         "followers_url" : "https://api.github.com/users/adamjonas/followers",
         "following_url" : "https://api.github.com/users/adamjonas/following{/other_user}",
         "gists_url" : "https://api.github.com/users/adamjonas/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/adamjonas",
         "id" : 755825,
         "login" : "adamjonas",
         "node_id" : "MDQ6VXNlcjc1NTgyNQ==",
         "organizations_url" : "https://api.github.com/users/adamjonas/orgs",
         "received_events_url" : "https://api.github.com/users/adamjonas/received_events",
         "repos_url" : "https://api.github.com/users/adamjonas/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/adamjonas/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/adamjonas/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/adamjonas"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Linking [comment](https://github.com/bitcoin/bitcoin/issues/6861#issuecomment-149660411) on #6861 with a possible idea on how to mitigate.",
      "created_at" : "2022-08-01T17:24:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6755#issuecomment-1201495877",
      "id" : 1201495877,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6755",
      "node_id" : "IC_kwDOABII585HnV9F",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1201495877/reactions"
      },
      "updated_at" : "2022-08-01T17:24:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1201495877",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/755825?v=4",
         "events_url" : "https://api.github.com/users/adamjonas/events{/privacy}",
         "followers_url" : "https://api.github.com/users/adamjonas/followers",
         "following_url" : "https://api.github.com/users/adamjonas/following{/other_user}",
         "gists_url" : "https://api.github.com/users/adamjonas/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/adamjonas",
         "id" : 755825,
         "login" : "adamjonas",
         "node_id" : "MDQ6VXNlcjc1NTgyNQ==",
         "organizations_url" : "https://api.github.com/users/adamjonas/orgs",
         "received_events_url" : "https://api.github.com/users/adamjonas/received_events",
         "repos_url" : "https://api.github.com/users/adamjonas/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/adamjonas/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/adamjonas/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/adamjonas"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "The problem with multiple getheaders with the same peer was recently fixed by #25454, so maybe this can be closed now?\r\n\r\nIt is still possible to do multiple getheaders with _different_ peers if a block is found during headerssync, and this is desirable to some degree (the original peer might be very slow or on an old chain), but the phenomenon where we'd start syncing headers with _all of our peers_ when a block is found will be mitigated by #25720 - but If I understand this issue correctly, it's not really about that anyway.",
      "created_at" : "2022-08-01T22:45:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6755#issuecomment-1201807207",
      "id" : 1201807207,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6755",
      "node_id" : "IC_kwDOABII585Hoh9n",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1201807207/reactions"
      },
      "updated_at" : "2022-08-01T22:45:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1201807207",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   }
]
