[
   {
      "body" : "> but no longer breaks off requests in progress.\r\n\r\nPossible attack vector by denying the service the ability to shut down / restart by keeping a connection open? ",
      "created_at" : "2015-09-25T06:49:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6719#issuecomment-143144087",
      "id" : 143144087,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6719",
      "updated_at" : "2015-09-25T06:49:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/143144087",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "body" : "After `-rpcservertimeout` current connections will get booted, unless there is activity. If they do any requests they get a `server unavailable` error. But yes, if your application software is truly malicious they could keep the server busy by sending e.g. one header at a time, every timeout-1 seconds.\r\n\r\nNote that this solution is cleaner in any case, it doesn't rule out queuing a `event_base_loopbreak(eventBase);`, say, 30 seconds in the future to force a shutdown.\r\n",
      "created_at" : "2015-09-25T07:40:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6719#issuecomment-143150361",
      "id" : 143150361,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6719",
      "updated_at" : "2015-09-25T07:40:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/143150361",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "utACK.\r\n\r\nI agree that the attack vectors are out of scope for this PR maybe for the whole http-json-rpc-daemon (it's not hardened enough to expose to potential malicious environments).",
      "created_at" : "2015-09-25T09:17:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6719#issuecomment-143167577",
      "id" : 143167577,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6719",
      "updated_at" : "2015-09-25T09:17:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/143167577",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "utACK,  just thought I'd mention it.",
      "created_at" : "2015-09-25T10:00:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6719#issuecomment-143177072",
      "id" : 143177072,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6719",
      "updated_at" : "2015-09-25T10:00:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/143177072",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "body" : "@dcousens It's great that you mentioned it. It reminded me of potential issue of this: what happens if a timer is stilll running, will it block the event queue exit until it triggers?\r\nWill test this scenario by stopping with an unlocked wallet.\r\n\r\nPushed another related fix:\r\n\r\n### http: Wait for worker threads to exit\r\n\r\nAdd a WaitExit() call to http's WorkQueue to make StopHTTPServer delete the work queue only when all worker threads stopped.\r\n\r\nThis fixes a problem that was reproducable by pressing Ctrl-C during AppInit2:\r\n```\r\n/usr/include/boost/thread/pthread/condition_variable_fwd.hpp:81: boost::condition_variable::~condition_variable(): Assertion `!ret' failed.\r\n/usr/include/boost/thread/pthread/mutex.hpp:108: boost::mutex::~mutex(): Assertion `!posix::pthread_mutex_destroy(&m)' failed.\r\n```\r\n\r\nI was assuming that `threadGroup->join_all();` would always have been called when entering the Shutdown(). However this is not the case in bitcoind's AppInit2-non-zero-exit case \"was left out intentionally here\".\r\n(now that the http module takes care of waiting for its own worker threads, we could even make it stop using threadGroup completely, but I leave that for a future refactor)",
      "created_at" : "2015-09-25T12:00:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6719#issuecomment-143196130",
      "id" : 143196130,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6719",
      "updated_at" : "2015-09-25T12:17:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/143196130",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Pushed another commit to force-exit the event loop after a predefined time after interruption. This addresses @dcousens 's issue, as well as the case that other events are still lingering (such as a wallet unlock timer).\r\n",
      "created_at" : "2015-09-25T13:39:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6719#issuecomment-143226808",
      "id" : 143226808,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6719",
      "updated_at" : "2015-09-25T13:44:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/143226808",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "utACK, well done @laanwj ",
      "created_at" : "2015-09-25T14:19:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6719#issuecomment-143236326",
      "id" : 143236326,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6719",
      "updated_at" : "2015-09-25T14:19:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/143236326",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "body" : "Concept ACK, btw. Definitely an improvement.",
      "created_at" : "2015-09-25T21:35:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6719#issuecomment-143359734",
      "id" : 143359734,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6719",
      "updated_at" : "2015-09-25T21:35:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/143359734",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "Processed @theuni 's comments. WIll merge as soon as Travis passes.",
      "created_at" : "2015-09-28T13:09:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6719#issuecomment-143739098",
      "id" : 143739098,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6719",
      "updated_at" : "2015-09-28T13:09:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/143739098",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Thanks. ut ACK.",
      "created_at" : "2015-09-28T13:35:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6719#issuecomment-143745288",
      "id" : 143745288,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6719",
      "updated_at" : "2015-09-28T13:35:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/143745288",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   }
]
