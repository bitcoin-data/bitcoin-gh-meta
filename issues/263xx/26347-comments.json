[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Changes look good, is there a reason it's in draft?\n> \n> Also, is there a way to add a test for this?\n\nI made it a draft because I haven't written a test yet. I'll mark it as ready for review after I add some tests. ",
      "created_at" : "2022-10-21T13:29:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26347#issuecomment-1286963633",
      "id" : 1286963633,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26347",
      "node_id" : "IC_kwDOABII585MtYGx",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1286963633/reactions"
      },
      "updated_at" : "2022-10-21T13:29:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1286963633",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [achow101](https://github.com/bitcoin/bitcoin/pull/26347#issuecomment-1431798939) |\n| Concept ACK | [pablomartin4btc](https://github.com/bitcoin/bitcoin/pull/26347#pullrequestreview-1155366008), [theStack](https://github.com/bitcoin/bitcoin/pull/26347#issuecomment-1369751837) |\n| Stale ACK | [hernanmarino](https://github.com/bitcoin/bitcoin/pull/26347#pullrequestreview-1269723820) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#27068](https://github.com/bitcoin/bitcoin/pull/27068) (wallet: SecureString to allow null characters by john-moffett)\n* [#22838](https://github.com/bitcoin/bitcoin/pull/22838) (descriptors: Be able to specify change and receiving in a single descriptor string by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2022-10-23T22:57:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26347#issuecomment-1288221666",
      "id" : 1288221666,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26347",
      "node_id" : "IC_kwDOABII585MyLPi",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1288221666/reactions"
      },
      "updated_at" : "2023-02-15T18:10:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1288221666",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The test seems to create intermittent failures. I also cherry-picked the test on master and the results seem to be the same.\r\n`seq 100 | xargs -i -P 5 python test/functional/wallet_importdescriptors.py --descriptors` will execute the test in parallel batches of 5.",
      "created_at" : "2022-10-24T09:31:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26347#issuecomment-1288729227",
      "id" : 1288729227,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26347",
      "node_id" : "IC_kwDOABII585M0HKL",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1288729227/reactions"
      },
      "updated_at" : "2022-10-24T09:31:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1288729227",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> The test seems to create intermittent failures. I also cherry-picked the test on master and the results seem to be the same. `seq 100 | xargs -i -P 5 python test/functional/wallet_importdescriptors.py --descriptors` will execute the test in parallel batches of 5.\r\n\r\nThanks for taking a look at this, that should be fixed now. There is still a problem of the passphrase timing out on certain systems before `importdescriptors` is even run, but I'm not sure how to fix that.",
      "created_at" : "2022-10-24T18:34:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26347#issuecomment-1289436203",
      "id" : 1289436203,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26347",
      "node_id" : "IC_kwDOABII585M2zwr",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1289436203/reactions"
      },
      "updated_at" : "2022-10-24T18:34:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1289436203",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1003661127"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003661127"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In b8952bd7d3b3f745109506223f829c5dd91e638f \"wallet: ensure that the passphrase is not deleted from memory when being used to rescan\"\r\n\r\nI think this is the wrong place to grab this mutex. I think it would be better to put it `CWallet::Lock` (in addition to the `LOCK(cs_wallet)` already there) as that is the underlying locking function that is called in a variety of places and so would offer stronger protection.",
      "commit_id" : "25b8736431677f9e24fc0bbf93a7f2fc1de55502",
      "created_at" : "2022-10-24T19:12:40Z",
      "diff_hunk" : "@@ -90,6 +90,7 @@ RPCHelpMan walletpassphrase()\n     std::weak_ptr<CWallet> weak_wallet = wallet;\n     pwallet->chain().rpcRunLater(strprintf(\"lockwallet(%s)\", pwallet->GetName()), [weak_wallet, relock_time] {\n         if (auto shared_wallet = weak_wallet.lock()) {\n+            LOCK(shared_wallet->m_relock_mutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1003661127",
      "id" : 1003661127,
      "line" : 93,
      "node_id" : "PRRC_kwDOABII58470qdH",
      "original_commit_id" : "b8952bd7d3b3f745109506223f829c5dd91e638f",
      "original_line" : 93,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/encrypt.cpp",
      "position" : 4,
      "pull_request_review_id" : 1153640639,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003661127/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-24T19:41:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003661127",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1003662424"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003662424"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In b8952bd7d3b3f745109506223f829c5dd91e638f \"wallet: ensure that the passphrase is not deleted from memory when being used to rescan\"\r\n\r\nThe mutex should be grabbed before ensuring the wallet is unlocked. There could be a race condition where the wallet is locked by the scheduler in between checking that the wallet is unlocked, and grabbing `m_relock_mutex`. By grabbing the mutex first, we can be sure that the scheduler will not be able to lock the wallet before we check that the wallet is unlocked.\r\n\r\nAlso, use `LOCK2` to grab 2 locks at the same time.",
      "commit_id" : "25b8736431677f9e24fc0bbf93a7f2fc1de55502",
      "created_at" : "2022-10-24T19:14:18Z",
      "diff_hunk" : "@@ -875,6 +875,7 @@ RPCHelpMan rescanblockchain()\n     uint256 start_block;\n \n     EnsureWalletIsUnlocked(*pwallet);\n+    LOCK(pwallet->m_relock_mutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1003662424",
      "id" : 1003662424,
      "line" : 878,
      "node_id" : "PRRC_kwDOABII58470qxY",
      "original_commit_id" : "b8952bd7d3b3f745109506223f829c5dd91e638f",
      "original_line" : 878,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/transactions.cpp",
      "position" : 4,
      "pull_request_review_id" : 1153640639,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003662424/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-24T19:41:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003662424",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1003683930"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003683930"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In ad8d139d6237ffa556e90d2d87ec43c209c89dc9 \"test: test rescanning encrypted wallets\"\r\n\r\n10000 is running into the rpc timeout for me for the `importdescriptors` calls. I think this could be reduced to 4000. That seems to not hit the rpc timeout, but still consistently fails this test on master.",
      "commit_id" : "25b8736431677f9e24fc0bbf93a7f2fc1de55502",
      "created_at" : "2022-10-24T19:40:42Z",
      "diff_hunk" : "@@ -666,5 +666,28 @@ def run_test(self):\n                               success=True,\n                               warnings=[\"Unknown output type, cannot set descriptor to active.\"])\n \n+        self.log.info(\"Test importing a descriptor to an encrypted wallet\")\n+\n+        descriptor = {\"desc\": descsum_create(\"pkh(\" + xpriv + \"/1h/*h)\"),\n+                              \"timestamp\": \"now\",\n+                              \"active\": True,\n+                              \"range\": [0,10000],\n+                              \"next_index\": 10000}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1003683930",
      "id" : 1003683930,
      "line" : 675,
      "node_id" : "PRRC_kwDOABII58470wBa",
      "original_commit_id" : "25b8736431677f9e24fc0bbf93a7f2fc1de55502",
      "original_line" : 675,
      "original_position" : 10,
      "original_start_line" : 674,
      "path" : "test/functional/wallet_importdescriptors.py",
      "position" : 10,
      "pull_request_review_id" : 1153640639,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003683930/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 674,
      "start_side" : "RIGHT",
      "updated_at" : "2022-10-24T19:41:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003683930",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1003938284"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003938284"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "How would using `LOCK2` work for grabbing `cs_wallet` and `m_relock_mutex` at the same time if the whole point of having `m_relock_mutex` is that we don't want to be holding `cs_wallet` during the time of the rescan since it can be time consuming?",
      "commit_id" : "25b8736431677f9e24fc0bbf93a7f2fc1de55502",
      "created_at" : "2022-10-25T02:32:04Z",
      "diff_hunk" : "@@ -875,6 +875,7 @@ RPCHelpMan rescanblockchain()\n     uint256 start_block;\n \n     EnsureWalletIsUnlocked(*pwallet);\n+    LOCK(pwallet->m_relock_mutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1003938284",
      "id" : 1003938284,
      "in_reply_to_id" : 1003662424,
      "line" : 878,
      "node_id" : "PRRC_kwDOABII58471uHs",
      "original_commit_id" : "b8952bd7d3b3f745109506223f829c5dd91e638f",
      "original_line" : 878,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/transactions.cpp",
      "position" : 4,
      "pull_request_review_id" : 1154044419,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003938284/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-25T02:32:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003938284",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1004878542"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004878542"
         }
      },
      "author_association" : "NONE",
      "body" : "10000 runs fine for me, but I agree with lowering it to 4000.",
      "commit_id" : "25b8736431677f9e24fc0bbf93a7f2fc1de55502",
      "created_at" : "2022-10-25T19:19:36Z",
      "diff_hunk" : "@@ -666,5 +666,28 @@ def run_test(self):\n                               success=True,\n                               warnings=[\"Unknown output type, cannot set descriptor to active.\"])\n \n+        self.log.info(\"Test importing a descriptor to an encrypted wallet\")\n+\n+        descriptor = {\"desc\": descsum_create(\"pkh(\" + xpriv + \"/1h/*h)\"),\n+                              \"timestamp\": \"now\",\n+                              \"active\": True,\n+                              \"range\": [0,10000],\n+                              \"next_index\": 10000}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1004878542",
      "id" : 1004878542,
      "in_reply_to_id" : 1003683930,
      "line" : 675,
      "node_id" : "PRRC_kwDOABII58475TrO",
      "original_commit_id" : "25b8736431677f9e24fc0bbf93a7f2fc1de55502",
      "original_line" : 675,
      "original_position" : 10,
      "original_start_line" : 674,
      "path" : "test/functional/wallet_importdescriptors.py",
      "position" : 10,
      "pull_request_review_id" : 1155372541,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004878542/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 674,
      "start_side" : "RIGHT",
      "updated_at" : "2022-10-25T19:31:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004878542",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/87907936?v=4",
         "events_url" : "https://api.github.com/users/hernanmarino/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hernanmarino/followers",
         "following_url" : "https://api.github.com/users/hernanmarino/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hernanmarino/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hernanmarino",
         "id" : 87907936,
         "login" : "hernanmarino",
         "node_id" : "MDQ6VXNlcjg3OTA3OTM2",
         "organizations_url" : "https://api.github.com/users/hernanmarino/orgs",
         "received_events_url" : "https://api.github.com/users/hernanmarino/received_events",
         "repos_url" : "https://api.github.com/users/hernanmarino/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hernanmarino/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hernanmarino/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hernanmarino"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1004879850"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004879850"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`LOCK2` only needs to be used in the places when both locks are being acquired, e.g. in `CWallet::Lock`.",
      "commit_id" : "25b8736431677f9e24fc0bbf93a7f2fc1de55502",
      "created_at" : "2022-10-25T19:21:10Z",
      "diff_hunk" : "@@ -875,6 +875,7 @@ RPCHelpMan rescanblockchain()\n     uint256 start_block;\n \n     EnsureWalletIsUnlocked(*pwallet);\n+    LOCK(pwallet->m_relock_mutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1004879850",
      "id" : 1004879850,
      "in_reply_to_id" : 1003662424,
      "line" : 878,
      "node_id" : "PRRC_kwDOABII58475T_q",
      "original_commit_id" : "b8952bd7d3b3f745109506223f829c5dd91e638f",
      "original_line" : 878,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/transactions.cpp",
      "position" : 4,
      "pull_request_review_id" : 1155374313,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004879850/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-25T19:21:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004879850",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1004887893"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004887893"
         }
      },
      "author_association" : "NONE",
      "body" : "I have some doubts about the proper location for grabbing the mutex, but I am not an expert in wallet code, some take my ideas with care. @achow101 's suggestion seems like a nice \"natural\" way to lock mutexes, and initially I agreed with it. But since this pr creates a new mutex, I see no conflict on grabbing it elsewhere, like here. Also I'm a little bit concerned that other calls to `CWallet::Lock` might unnecessarily lock this unrelated mutex, blocking execution.",
      "commit_id" : "25b8736431677f9e24fc0bbf93a7f2fc1de55502",
      "created_at" : "2022-10-25T19:31:08Z",
      "diff_hunk" : "@@ -90,6 +90,7 @@ RPCHelpMan walletpassphrase()\n     std::weak_ptr<CWallet> weak_wallet = wallet;\n     pwallet->chain().rpcRunLater(strprintf(\"lockwallet(%s)\", pwallet->GetName()), [weak_wallet, relock_time] {\n         if (auto shared_wallet = weak_wallet.lock()) {\n+            LOCK(shared_wallet->m_relock_mutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1004887893",
      "id" : 1004887893,
      "in_reply_to_id" : 1003661127,
      "line" : 93,
      "node_id" : "PRRC_kwDOABII58475V9V",
      "original_commit_id" : "b8952bd7d3b3f745109506223f829c5dd91e638f",
      "original_line" : 93,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/encrypt.cpp",
      "position" : 4,
      "pull_request_review_id" : 1155372541,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004887893/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-25T19:31:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004887893",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/87907936?v=4",
         "events_url" : "https://api.github.com/users/hernanmarino/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hernanmarino/followers",
         "following_url" : "https://api.github.com/users/hernanmarino/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hernanmarino/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hernanmarino",
         "id" : 87907936,
         "login" : "hernanmarino",
         "node_id" : "MDQ6VXNlcjg3OTA3OTM2",
         "organizations_url" : "https://api.github.com/users/hernanmarino/orgs",
         "received_events_url" : "https://api.github.com/users/hernanmarino/received_events",
         "repos_url" : "https://api.github.com/users/hernanmarino/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hernanmarino/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hernanmarino/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hernanmarino"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1006348443"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1006348443"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "4741e686f1930fda30e7fb692e85a207513f53e1",
      "created_at" : "2022-10-27T02:35:26Z",
      "diff_hunk" : "@@ -666,5 +666,28 @@ def run_test(self):\n                               success=True,\n                               warnings=[\"Unknown output type, cannot set descriptor to active.\"])\n \n+        self.log.info(\"Test importing a descriptor to an encrypted wallet\")\n+\n+        descriptor = {\"desc\": descsum_create(\"pkh(\" + xpriv + \"/1h/*h)\"),\n+                              \"timestamp\": \"now\",\n+                              \"active\": True,\n+                              \"range\": [0,10000],\n+                              \"next_index\": 10000}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1006348443",
      "id" : 1006348443,
      "in_reply_to_id" : 1003683930,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5847-6ib",
      "original_commit_id" : "25b8736431677f9e24fc0bbf93a7f2fc1de55502",
      "original_line" : 675,
      "original_position" : 10,
      "original_start_line" : 674,
      "path" : "test/functional/wallet_importdescriptors.py",
      "position" : null,
      "pull_request_review_id" : 1157519326,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1006348443/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-10-27T02:35:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1006348443",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1006349989"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1006349989"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I have made it so that `m_relock_mutex` is grabbed before ensuring the wallet is unlocked.\r\n> LOCK2 only needs to be used in the places when both locks are being acquired, e.g. in CWallet::Lock.\r\n\r\nRight, I thought you meant this location specifically.",
      "commit_id" : "4741e686f1930fda30e7fb692e85a207513f53e1",
      "created_at" : "2022-10-27T02:39:15Z",
      "diff_hunk" : "@@ -875,6 +875,7 @@ RPCHelpMan rescanblockchain()\n     uint256 start_block;\n \n     EnsureWalletIsUnlocked(*pwallet);\n+    LOCK(pwallet->m_relock_mutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1006349989",
      "id" : 1006349989,
      "in_reply_to_id" : 1003662424,
      "line" : 877,
      "node_id" : "PRRC_kwDOABII5847-66l",
      "original_commit_id" : "b8952bd7d3b3f745109506223f829c5dd91e638f",
      "original_line" : 877,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/transactions.cpp",
      "position" : 13,
      "pull_request_review_id" : 1157521363,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1006349989/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-27T02:39:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1006349989",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1006353769"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1006353769"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The new mutex is now grabbed in `CWallet::Lock` and also in locations where `cs_wallet` would have been grabbed first in order to prevent a deadlock.",
      "commit_id" : "4741e686f1930fda30e7fb692e85a207513f53e1",
      "created_at" : "2022-10-27T02:48:48Z",
      "diff_hunk" : "@@ -90,6 +90,7 @@ RPCHelpMan walletpassphrase()\n     std::weak_ptr<CWallet> weak_wallet = wallet;\n     pwallet->chain().rpcRunLater(strprintf(\"lockwallet(%s)\", pwallet->GetName()), [weak_wallet, relock_time] {\n         if (auto shared_wallet = weak_wallet.lock()) {\n+            LOCK(shared_wallet->m_relock_mutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1006353769",
      "id" : 1006353769,
      "in_reply_to_id" : 1003661127,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5847-71p",
      "original_commit_id" : "b8952bd7d3b3f745109506223f829c5dd91e638f",
      "original_line" : 93,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/encrypt.cpp",
      "position" : null,
      "pull_request_review_id" : 1157528443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1006353769/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-27T02:48:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1006353769",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for the review @achow101, I have implemented your suggestions. I also made some slight modifications to the error messages in 8c16fdb73dd323245642d2710b5f81776db40396.\r\n> This could have a similar test for rescanblockchain as well.\r\n\r\nYes, I will add one shortly.",
      "created_at" : "2022-10-27T02:50:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26347#issuecomment-1292897834",
      "id" : 1292897834,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26347",
      "node_id" : "IC_kwDOABII585NEA4q",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1292897834/reactions"
      },
      "updated_at" : "2022-10-27T02:50:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1292897834",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1008917871"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008917871"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Using `Mutex` is preferable to `RecursiveMutex`.",
      "commit_id" : "fdc794d3a18f0f17a241063032280684cb485b71",
      "created_at" : "2022-10-30T19:55:26Z",
      "diff_hunk" : "@@ -487,6 +487,9 @@ class CWallet final : public WalletStorage, public interfaces::Chain::Notificati\n \n     // Used to prevent concurrent calls to walletpassphrase RPC.\n     Mutex m_unlock_mutex;\n+    // Used to prevent deleting the passphrase from memory when it is still in use.\n+    RecursiveMutex m_relock_mutex;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1008917871",
      "id" : 1008917871,
      "line" : 491,
      "node_id" : "PRRC_kwDOABII5848It1v",
      "original_commit_id" : "4724f0b82c5077b48da79d6358081b5b761a467c",
      "original_line" : 491,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : 5,
      "pull_request_review_id" : 1161184273,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008917871/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-30T19:55:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008917871",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/94266259?v=4",
         "events_url" : "https://api.github.com/users/w0xlt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/w0xlt/followers",
         "following_url" : "https://api.github.com/users/w0xlt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/w0xlt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/w0xlt",
         "id" : 94266259,
         "login" : "w0xlt",
         "node_id" : "U_kgDOBZ5jkw",
         "organizations_url" : "https://api.github.com/users/w0xlt/orgs",
         "received_events_url" : "https://api.github.com/users/w0xlt/received_events",
         "repos_url" : "https://api.github.com/users/w0xlt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/w0xlt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/w0xlt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/w0xlt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1008926687"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008926687"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`Mutex` isn't used here because sometimes `m_relock_mutex` has to be locked multiple time within a scope to prevent deadlocks. See: https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1006353769\r\n\r\n> The new mutex is now grabbed in CWallet::Lock and also in locations where cs_wallet would have been grabbed first in order to prevent a deadlock.",
      "commit_id" : "f9b41b916d05166700f091ee51837d38dd161ec4",
      "created_at" : "2022-10-30T21:08:26Z",
      "diff_hunk" : "@@ -487,6 +487,9 @@ class CWallet final : public WalletStorage, public interfaces::Chain::Notificati\n \n     // Used to prevent concurrent calls to walletpassphrase RPC.\n     Mutex m_unlock_mutex;\n+    // Used to prevent deleting the passphrase from memory when it is still in use.\n+    RecursiveMutex m_relock_mutex;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1008926687",
      "id" : 1008926687,
      "in_reply_to_id" : 1008917871,
      "line" : 491,
      "node_id" : "PRRC_kwDOABII5848Iv_f",
      "original_commit_id" : "4724f0b82c5077b48da79d6358081b5b761a467c",
      "original_line" : 491,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : 21,
      "pull_request_review_id" : 1161192344,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008926687/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-30T21:08:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008926687",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Added a test for `rescanblockchain`\r\n",
      "created_at" : "2022-10-31T00:09:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26347#issuecomment-1296388449",
      "id" : 1296388449,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26347",
      "node_id" : "IC_kwDOABII585NRVFh",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1296388449/reactions"
      },
      "updated_at" : "2022-10-31T00:09:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1296388449",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2023-01-03T13:11:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26347#issuecomment-1369751837",
      "id" : 1369751837,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26347",
      "node_id" : "IC_kwDOABII585RpMEd",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1369751837/reactions"
      },
      "updated_at" : "2023-01-03T13:11:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1369751837",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1082710583"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1082710583"
         }
      },
      "author_association" : "MEMBER",
      "body" : "if the wallet is a watch-only wallet, do we need to ensure this?",
      "commit_id" : "b2e2829014c5c9a3dc02eab7fcd77dd907228c78",
      "created_at" : "2023-01-20T15:38:04Z",
      "diff_hunk" : "@@ -866,15 +866,17 @@ RPCHelpMan rescanblockchain()\n     wallet.BlockUntilSyncedToCurrentChain();\n \n     WalletRescanReserver reserver(*pwallet);\n-    if (!reserver.reserve()) {\n+    if (!reserver.reserve(/*with_passphrase=*/true)) {\n         throw JSONRPCError(RPC_WALLET_ERROR, \"Wallet is currently rescanning. Abort existing rescan or wait.\");\n     }\n \n     int start_height = 0;\n     std::optional<int> stop_height;\n     uint256 start_block;\n+\n     {\n         LOCK(pwallet->cs_wallet);\n+        EnsureWalletIsUnlocked(*pwallet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1082710583",
      "id" : 1082710583,
      "line" : 880,
      "node_id" : "PRRC_kwDOABII585AiNo3",
      "original_commit_id" : "8c16fdb73dd323245642d2710b5f81776db40396",
      "original_line" : 879,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/transactions.cpp",
      "position" : 15,
      "pull_request_review_id" : 1263830250,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1082710583/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-20T15:38:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1082710583",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1086841884"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1086841884"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "No, I will make it so that here and in the other RPCs `EnsureWalletIsUnlocked` is only called if the wallet is not watch-only. Additionally, in that case `m_relock_mutex` doesn't need to be held, as long as it is not grabbed later in the RPC. ",
      "commit_id" : "b2e2829014c5c9a3dc02eab7fcd77dd907228c78",
      "created_at" : "2023-01-25T16:09:45Z",
      "diff_hunk" : "@@ -866,15 +866,17 @@ RPCHelpMan rescanblockchain()\n     wallet.BlockUntilSyncedToCurrentChain();\n \n     WalletRescanReserver reserver(*pwallet);\n-    if (!reserver.reserve()) {\n+    if (!reserver.reserve(/*with_passphrase=*/true)) {\n         throw JSONRPCError(RPC_WALLET_ERROR, \"Wallet is currently rescanning. Abort existing rescan or wait.\");\n     }\n \n     int start_height = 0;\n     std::optional<int> stop_height;\n     uint256 start_block;\n+\n     {\n         LOCK(pwallet->cs_wallet);\n+        EnsureWalletIsUnlocked(*pwallet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1086841884",
      "id" : 1086841884,
      "in_reply_to_id" : 1082710583,
      "line" : 880,
      "node_id" : "PRRC_kwDOABII585Ax-Qc",
      "original_commit_id" : "8c16fdb73dd323245642d2710b5f81776db40396",
      "original_line" : 879,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/transactions.cpp",
      "position" : 15,
      "pull_request_review_id" : 1269652687,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1086841884/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-25T16:09:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1086841884",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1089842577"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1089842577"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Actually, the wallet will always be unlocked if private keys are disabled, because wallet encryption is not allowed in a watch-only wallet. See: https://github.com/bitcoin/bitcoin/blob/master/src/wallet/rpc/encrypt.cpp#L224",
      "commit_id" : "b2e2829014c5c9a3dc02eab7fcd77dd907228c78",
      "created_at" : "2023-01-29T01:05:10Z",
      "diff_hunk" : "@@ -866,15 +866,17 @@ RPCHelpMan rescanblockchain()\n     wallet.BlockUntilSyncedToCurrentChain();\n \n     WalletRescanReserver reserver(*pwallet);\n-    if (!reserver.reserve()) {\n+    if (!reserver.reserve(/*with_passphrase=*/true)) {\n         throw JSONRPCError(RPC_WALLET_ERROR, \"Wallet is currently rescanning. Abort existing rescan or wait.\");\n     }\n \n     int start_height = 0;\n     std::optional<int> stop_height;\n     uint256 start_block;\n+\n     {\n         LOCK(pwallet->cs_wallet);\n+        EnsureWalletIsUnlocked(*pwallet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1089842577",
      "id" : 1089842577,
      "in_reply_to_id" : 1082710583,
      "line" : 880,
      "node_id" : "PRRC_kwDOABII585A9a2R",
      "original_commit_id" : "8c16fdb73dd323245642d2710b5f81776db40396",
      "original_line" : 879,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/transactions.cpp",
      "position" : 15,
      "pull_request_review_id" : 1274050911,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1089842577/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-29T01:05:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1089842577",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1096543519"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1096543519"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Was surprised to see that this wasn't causing any lock ordering deadlock. Because, for example, `ChangeWalletPassphrase` locks `cs_wallet` and then call `Lock()` (which locks `m_relock_mutex` first, which is the opposite lock ordering direction).\r\n\r\nSo, got deeper over it and was able to trigger the deadlock detection on the GUI \"change wallet passphrase\" workflow.\r\nCan be replicated by enabling the debug mode (--enable-debug at configure time) and try to change the wallet passphrase there (soft will abort right away).\r\n\r\nThis does not happen on the RPC command because this two recursive locks are acquired at the `ChangeWalletPassphrase` caller, which locks them in the proper order (unlike the GUI's `changeWalletPassphrase` interface method).",
      "commit_id" : "fcaaa5fd905a21298bd69343c9756e32a70870e6",
      "created_at" : "2023-02-04T14:27:16Z",
      "diff_hunk" : "@@ -3284,7 +3285,7 @@ bool CWallet::Lock()\n         return false;\n \n     {\n-        LOCK(cs_wallet);\n+        LOCK2(m_relock_mutex, cs_wallet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1096543519",
      "id" : 1096543519,
      "line" : 3287,
      "node_id" : "PRRC_kwDOABII585BW-0f",
      "original_commit_id" : "4724f0b82c5077b48da79d6358081b5b761a467c",
      "original_line" : 3287,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 23,
      "pull_request_review_id" : 1284074704,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1096543519/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-06T15:19:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1096543519",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1097509177"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1097509177"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good catch, I was able to replicate this locally. Should be fixed now.",
      "commit_id" : "fcaaa5fd905a21298bd69343c9756e32a70870e6",
      "created_at" : "2023-02-06T15:08:10Z",
      "diff_hunk" : "@@ -3284,7 +3285,7 @@ bool CWallet::Lock()\n         return false;\n \n     {\n-        LOCK(cs_wallet);\n+        LOCK2(m_relock_mutex, cs_wallet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1097509177",
      "id" : 1097509177,
      "in_reply_to_id" : 1096543519,
      "line" : 3287,
      "node_id" : "PRRC_kwDOABII585Baqk5",
      "original_commit_id" : "4724f0b82c5077b48da79d6358081b5b761a467c",
      "original_line" : 3287,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 23,
      "pull_request_review_id" : 1285393797,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1097509177/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-06T15:08:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1097509177",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1097975292"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1097975292"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In fcaaa5fd905a21298bd69343c9756e32a70870e6 \"test: test rescanning encrypted wallets\"\r\n\r\nI suspect that this test is going to be the source of many intermittent failures in the future. We already observe a failure in CI for this test. Since this is testing a race condition, the speed of the machine executing the test becomes a significant factor, and having sanitizers being run can cause the test to fail.\r\n\r\nI think we might be able to workaround this by using a batched RPC request as IIRC those are run in a single thread sequentially.",
      "commit_id" : "fcaaa5fd905a21298bd69343c9756e32a70870e6",
      "created_at" : "2023-02-06T22:14:07Z",
      "diff_hunk" : "@@ -666,5 +666,28 @@ def run_test(self):\n                               success=True,\n                               warnings=[\"Unknown output type, cannot set descriptor to active.\"])\n \n+        self.log.info(\"Test importing a descriptor to an encrypted wallet\")\n+\n+        descriptor = {\"desc\": descsum_create(\"pkh(\" + xpriv + \"/1h/*h)\"),\n+                              \"timestamp\": \"now\",\n+                              \"active\": True,\n+                              \"range\": [0,4000],\n+                              \"next_index\": 4000}\n+\n+        self.nodes[0].createwallet(\"temp_wallet\", blank=True, descriptors=True)\n+        temp_wallet = self.nodes[0].get_wallet_rpc(\"temp_wallet\")\n+        temp_wallet.importdescriptors([descriptor])\n+        self.generatetoaddress(self.nodes[0], COINBASE_MATURITY + 1, temp_wallet.getnewaddress())\n+        self.generatetoaddress(self.nodes[0], COINBASE_MATURITY + 1, temp_wallet.getnewaddress())\n+\n+        self.nodes[0].createwallet(\"encrypted_wallet\", blank=True, descriptors=True, passphrase=\"passphrase\")\n+        encrypted_wallet = self.nodes[0].get_wallet_rpc(\"encrypted_wallet\")\n+        encrypted_wallet.walletpassphrase(\"passphrase\", 1)\n+\n+        descriptor[\"timestamp\"] = 0\n+        descriptor[\"next_index\"] = 0\n+        encrypted_wallet.importdescriptors([descriptor])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1097975292",
      "id" : 1097975292,
      "line" : 689,
      "node_id" : "PRRC_kwDOABII585BccX8",
      "original_commit_id" : "fcaaa5fd905a21298bd69343c9756e32a70870e6",
      "original_line" : 689,
      "original_position" : 24,
      "original_start_line" : 685,
      "path" : "test/functional/wallet_importdescriptors.py",
      "position" : 24,
      "pull_request_review_id" : 1286102814,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1097975292/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 685,
      "start_side" : "RIGHT",
      "updated_at" : "2023-02-06T22:14:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1097975292",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1098176498"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1098176498"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I agree that this test would have been problematic. I have changed the `importdescriptors` and `rescanblockchain` tests added in this PR to use a batched RPC request.",
      "commit_id" : "dcda4fb96d1f035580934e998f5d7058c1531779",
      "created_at" : "2023-02-07T04:55:15Z",
      "diff_hunk" : "@@ -666,5 +666,28 @@ def run_test(self):\n                               success=True,\n                               warnings=[\"Unknown output type, cannot set descriptor to active.\"])\n \n+        self.log.info(\"Test importing a descriptor to an encrypted wallet\")\n+\n+        descriptor = {\"desc\": descsum_create(\"pkh(\" + xpriv + \"/1h/*h)\"),\n+                              \"timestamp\": \"now\",\n+                              \"active\": True,\n+                              \"range\": [0,4000],\n+                              \"next_index\": 4000}\n+\n+        self.nodes[0].createwallet(\"temp_wallet\", blank=True, descriptors=True)\n+        temp_wallet = self.nodes[0].get_wallet_rpc(\"temp_wallet\")\n+        temp_wallet.importdescriptors([descriptor])\n+        self.generatetoaddress(self.nodes[0], COINBASE_MATURITY + 1, temp_wallet.getnewaddress())\n+        self.generatetoaddress(self.nodes[0], COINBASE_MATURITY + 1, temp_wallet.getnewaddress())\n+\n+        self.nodes[0].createwallet(\"encrypted_wallet\", blank=True, descriptors=True, passphrase=\"passphrase\")\n+        encrypted_wallet = self.nodes[0].get_wallet_rpc(\"encrypted_wallet\")\n+        encrypted_wallet.walletpassphrase(\"passphrase\", 1)\n+\n+        descriptor[\"timestamp\"] = 0\n+        descriptor[\"next_index\"] = 0\n+        encrypted_wallet.importdescriptors([descriptor])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1098176498",
      "id" : 1098176498,
      "in_reply_to_id" : 1097975292,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585BdNfy",
      "original_commit_id" : "fcaaa5fd905a21298bd69343c9756e32a70870e6",
      "original_line" : 689,
      "original_position" : 24,
      "original_start_line" : 685,
      "path" : "test/functional/wallet_importdescriptors.py",
      "position" : null,
      "pull_request_review_id" : 1286394153,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1098176498/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2023-02-07T04:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1098176498",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-02-13T22:22:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26347#issuecomment-1428776595",
      "id" : 1428776595,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26347",
      "node_id" : "IC_kwDOABII585VKWaT",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1428776595/reactions"
      },
      "updated_at" : "2023-02-13T22:22:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1428776595",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased, I also increased the `walletpassphrase` timeout in both of the tests.",
      "created_at" : "2023-02-15T13:55:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26347#issuecomment-1431407746",
      "id" : 1431407746,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26347",
      "node_id" : "IC_kwDOABII585VUYyC",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1431407746/reactions"
      },
      "updated_at" : "2023-02-15T13:55:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1431407746",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 6a5b348f2e526f048d0b448b01f6c4ab608569af",
      "created_at" : "2023-02-15T18:10:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26347#issuecomment-1431798939",
      "id" : 1431798939,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26347",
      "node_id" : "IC_kwDOABII585VV4Sb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1431798939/reactions"
      },
      "updated_at" : "2023-02-15T18:10:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1431798939",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1123340738"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1123340738"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This fails for me when running in valgrind:\r\n\r\n```\r\n node0 2023-02-28T19:50:00.090808Z (mocktime: 2023-03-30T19:35:09Z) [httpworker.1] [rpc/request.cpp:179] [parse] [rpc] ThreadRPCServer method=walletpassphrase user=__cookie__ \r\n node0 2023-02-28T19:50:08.966047Z (mocktime: 2023-03-30T19:35:09Z) [httpworker.1] [rpc/server.cpp:560] [RPCRunLater] [rpc] queue run of timer lockwallet(encrypted_wallet) in 1 seconds (using HTTP) \r\n node0 2023-02-28T19:50:08.995457Z (mocktime: 2023-03-30T19:35:09Z) [http] [httpserver.cpp:239] [http_request_cb] [http] Received a POST request for /wallet/encrypted_wallet from 127.0.0.1:42774 \r\n node0 2023-02-28T19:50:08.998881Z (mocktime: 2023-03-30T19:35:09Z) [httpworker.2] [rpc/request.cpp:179] [parse] [rpc] ThreadRPCServer method=sethdseed user=__cookie__ \r\n node0 2023-02-28T19:51:12.893784Z (mocktime: 2023-03-30T19:35:09Z) [httpworker.2] [wallet/scriptpubkeyman.h:251] [WalletLogPrintf] [encrypted_wallet] keypool added 800 keys (400 internal), size=800 (400 internal) \r\n node0 2023-02-28T19:51:12.953236Z (mocktime: 2023-03-30T19:35:09Z) [httpworker.2] [wallet/scriptpubkeyman.h:251] [WalletLogPrintf] [encrypted_wallet] LegacyScriptPubKeyMan::NewKeyPool rewrote keypool \r\n node0 2023-02-28T19:51:12.964195Z (mocktime: 2023-03-30T19:35:09Z) [http] [httpserver.cpp:239] [http_request_cb] [http] Received a POST request for /wallet/encrypted_wallet from 127.0.0.1:53062 \r\n node0 2023-02-28T19:51:12.966738Z (mocktime: 2023-03-30T19:35:09Z) [httpworker.3] [rpc/request.cpp:179] [parse] [rpc] ThreadRPCServer method=sethdseed user=__cookie__ \r\n test  2023-02-28T19:51:12.976000Z TestFramework (ERROR): JSONRPC error \r\n                                   Traceback (most recent call last):\r\n                                     File \"/root/bitcoin-core/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/test/functional/test_framework/test_framework.py\", line 134, in main\r\n                                       self.run_test()\r\n                                     File \"/root/bitcoin-core/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/test/functional/wallet_transactiontime_rescan.py\", line 200, in run_test\r\n                                       encrypted_wallet.sethdseed(seed=hd_seed)\r\n                                     File \"/root/bitcoin-core/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/test/functional/test_framework/coverage.py\", line 49, in __call__\r\n                                       return_val = self.auth_service_proxy_instance.__call__(*args, **kwargs)\r\n                                     File \"/root/bitcoin-core/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/test/functional/test_framework/authproxy.py\", line 149, in __call__\r\n                                       raise JSONRPCException(response['error'], status)\r\n                                   test_framework.authproxy.JSONRPCException: Error: Please enter the wallet passphrase with walletpassphrase first. (-13)\r\n```\r\n\r\n\r\nMaybe the timeout can be increased to 999999?\r\n\r\n\r\nAlso I wonder why you picked a timeout of `3` below, or why `walletpassphrase` needs to be called at all twice in a row?\r\n\r\nIf you want to confirm that the wallet can't be relocked while the rescan is in progress, wouldn't it be better to call `walletlock` rpc right after the rescan rpc?",
      "commit_id" : "6a5b348f2e526f048d0b448b01f6c4ab608569af",
      "created_at" : "2023-03-02T16:03:29Z",
      "diff_hunk" : "@@ -167,6 +174,38 @@ def run_test(self):\n         assert_raises_rpc_error(-8, \"Invalid stop_height\", restorewo_wallet.rescanblockchain, 1, -1)\n         assert_raises_rpc_error(-8, \"stop_height must be greater than start_height\", restorewo_wallet.rescanblockchain, 20, 10)\n \n+        self.log.info(\"Test `rescanblockchain` fails when wallet is encrypted and locked\")\n+        usernode.createwallet(wallet_name=\"enc_wallet\", passphrase=\"passphrase\")\n+        enc_wallet = usernode.get_wallet_rpc(\"enc_wallet\")\n+        assert_raises_rpc_error(-13, \"Error: Please enter the wallet passphrase with walletpassphrase first.\", enc_wallet.rescanblockchain)\n+\n+        if not self.options.descriptors:\n+            self.log.info(\"Test rescanning an encrypted wallet\")\n+            hd_seed = get_generate_key().privkey\n+\n+            usernode.createwallet(wallet_name=\"temp_wallet\", blank=True, descriptors=False)\n+            temp_wallet = usernode.get_wallet_rpc(\"temp_wallet\")\n+            temp_wallet.sethdseed(seed=hd_seed)\n+\n+            for i in range(399):\n+                temp_wallet.getnewaddress()\n+\n+            self.generatetoaddress(usernode, COINBASE_MATURITY + 1, temp_wallet.getnewaddress())\n+            self.generatetoaddress(usernode, COINBASE_MATURITY + 1, temp_wallet.getnewaddress())\n+\n+            minernode.createwallet(\"encrypted_wallet\", blank=True, passphrase=\"passphrase\", descriptors=False)\n+            encrypted_wallet = minernode.get_wallet_rpc(\"encrypted_wallet\")\n+\n+            encrypted_wallet.walletpassphrase(\"passphrase\", 1)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1123340738",
      "id" : 1123340738,
      "line" : 199,
      "node_id" : "PRRC_kwDOABII585C9NHC",
      "original_commit_id" : "6a5b348f2e526f048d0b448b01f6c4ab608569af",
      "original_line" : 199,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "test/functional/wallet_transactiontime_rescan.py",
      "position" : 47,
      "pull_request_review_id" : 1322129518,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1123340738/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-03-02T16:03:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1123340738",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1123601921"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1123601921"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Maybe the timeout can be increased to 999999?\r\n\r\nYes, the timeout before `sethdseed` can be increased to 999999, followed by running `walletlock`. I can open a follow-up PR for this.\r\n> Also I wonder why you picked a timeout of 3 below, or why walletpassphrase needs to be called at all twice in a row?\r\n\r\n3 was used because it needed to be a number that was large enough so that the scan would begin, but small enough so that the timeout would occur while the rescan is in progress. However, this number can be too large or too small depending on the speed of the machine.\r\n> If you want to confirm that the wallet can't be relocked while the rescan is in progress, wouldn't it be better to call walletlock rpc right after the rescan rpc?\r\n\r\nI don't completely understand this suggestion. Do you mean calling `walletlock` to ensure that the wallet is still unlocked? If so, I think there are two problems with that:\r\n\r\n- `walletlock` doesn't throw an error if the wallet is already locked\r\n- The wallet is supposed to re-lock immediately after the rescan, so the wallet might already be locked by the time `walletlock` is called, even if it did not lock during the rescan. However, using a batched RPC request might help with this.",
      "commit_id" : "6a5b348f2e526f048d0b448b01f6c4ab608569af",
      "created_at" : "2023-03-02T19:22:22Z",
      "diff_hunk" : "@@ -167,6 +174,38 @@ def run_test(self):\n         assert_raises_rpc_error(-8, \"Invalid stop_height\", restorewo_wallet.rescanblockchain, 1, -1)\n         assert_raises_rpc_error(-8, \"stop_height must be greater than start_height\", restorewo_wallet.rescanblockchain, 20, 10)\n \n+        self.log.info(\"Test `rescanblockchain` fails when wallet is encrypted and locked\")\n+        usernode.createwallet(wallet_name=\"enc_wallet\", passphrase=\"passphrase\")\n+        enc_wallet = usernode.get_wallet_rpc(\"enc_wallet\")\n+        assert_raises_rpc_error(-13, \"Error: Please enter the wallet passphrase with walletpassphrase first.\", enc_wallet.rescanblockchain)\n+\n+        if not self.options.descriptors:\n+            self.log.info(\"Test rescanning an encrypted wallet\")\n+            hd_seed = get_generate_key().privkey\n+\n+            usernode.createwallet(wallet_name=\"temp_wallet\", blank=True, descriptors=False)\n+            temp_wallet = usernode.get_wallet_rpc(\"temp_wallet\")\n+            temp_wallet.sethdseed(seed=hd_seed)\n+\n+            for i in range(399):\n+                temp_wallet.getnewaddress()\n+\n+            self.generatetoaddress(usernode, COINBASE_MATURITY + 1, temp_wallet.getnewaddress())\n+            self.generatetoaddress(usernode, COINBASE_MATURITY + 1, temp_wallet.getnewaddress())\n+\n+            minernode.createwallet(\"encrypted_wallet\", blank=True, passphrase=\"passphrase\", descriptors=False)\n+            encrypted_wallet = minernode.get_wallet_rpc(\"encrypted_wallet\")\n+\n+            encrypted_wallet.walletpassphrase(\"passphrase\", 1)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1123601921",
      "id" : 1123601921,
      "in_reply_to_id" : 1123340738,
      "line" : 199,
      "node_id" : "PRRC_kwDOABII585C-M4B",
      "original_commit_id" : "6a5b348f2e526f048d0b448b01f6c4ab608569af",
      "original_line" : 199,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "test/functional/wallet_transactiontime_rescan.py",
      "position" : 47,
      "pull_request_review_id" : 1322476565,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1123601921/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-03-02T19:22:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1123601921",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1124232090"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1124232090"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Do you mean calling walletlock to ensure that the wallet is still unlocked?\r\n\r\nNo, I mean calling `walletlock` to lock the wallet. So the execution would look like:\r\n\r\n```\r\n-> walletpassphrase 99999 (start)\r\n<- walletpassphrase (end)\r\n-> rescanblockchain (start)\r\n-> walletlock (start)\r\n<- rescanblockchain (finish, release mutex)\r\n<- walletlock (take mutex, end)\r\n```\r\n\r\nWithout the fix in this pull, `walletlock` might lock immediately and then likely cause `rescanblockchain` to fail?",
      "commit_id" : "6a5b348f2e526f048d0b448b01f6c4ab608569af",
      "created_at" : "2023-03-03T09:45:43Z",
      "diff_hunk" : "@@ -167,6 +174,38 @@ def run_test(self):\n         assert_raises_rpc_error(-8, \"Invalid stop_height\", restorewo_wallet.rescanblockchain, 1, -1)\n         assert_raises_rpc_error(-8, \"stop_height must be greater than start_height\", restorewo_wallet.rescanblockchain, 20, 10)\n \n+        self.log.info(\"Test `rescanblockchain` fails when wallet is encrypted and locked\")\n+        usernode.createwallet(wallet_name=\"enc_wallet\", passphrase=\"passphrase\")\n+        enc_wallet = usernode.get_wallet_rpc(\"enc_wallet\")\n+        assert_raises_rpc_error(-13, \"Error: Please enter the wallet passphrase with walletpassphrase first.\", enc_wallet.rescanblockchain)\n+\n+        if not self.options.descriptors:\n+            self.log.info(\"Test rescanning an encrypted wallet\")\n+            hd_seed = get_generate_key().privkey\n+\n+            usernode.createwallet(wallet_name=\"temp_wallet\", blank=True, descriptors=False)\n+            temp_wallet = usernode.get_wallet_rpc(\"temp_wallet\")\n+            temp_wallet.sethdseed(seed=hd_seed)\n+\n+            for i in range(399):\n+                temp_wallet.getnewaddress()\n+\n+            self.generatetoaddress(usernode, COINBASE_MATURITY + 1, temp_wallet.getnewaddress())\n+            self.generatetoaddress(usernode, COINBASE_MATURITY + 1, temp_wallet.getnewaddress())\n+\n+            minernode.createwallet(\"encrypted_wallet\", blank=True, passphrase=\"passphrase\", descriptors=False)\n+            encrypted_wallet = minernode.get_wallet_rpc(\"encrypted_wallet\")\n+\n+            encrypted_wallet.walletpassphrase(\"passphrase\", 1)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1124232090",
      "id" : 1124232090,
      "in_reply_to_id" : 1123340738,
      "line" : 199,
      "node_id" : "PRRC_kwDOABII585DAmua",
      "original_commit_id" : "6a5b348f2e526f048d0b448b01f6c4ab608569af",
      "original_line" : 199,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "test/functional/wallet_transactiontime_rescan.py",
      "position" : 47,
      "pull_request_review_id" : 1323405450,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1124232090/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-03-03T09:45:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1124232090",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1125568137"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1125568137"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ok, I think I understand what you mean now. I have implemented this using multi-threading in #27199. However, for me this no longer fails without the fix.",
      "commit_id" : "6a5b348f2e526f048d0b448b01f6c4ab608569af",
      "created_at" : "2023-03-04T22:33:20Z",
      "diff_hunk" : "@@ -167,6 +174,38 @@ def run_test(self):\n         assert_raises_rpc_error(-8, \"Invalid stop_height\", restorewo_wallet.rescanblockchain, 1, -1)\n         assert_raises_rpc_error(-8, \"stop_height must be greater than start_height\", restorewo_wallet.rescanblockchain, 20, 10)\n \n+        self.log.info(\"Test `rescanblockchain` fails when wallet is encrypted and locked\")\n+        usernode.createwallet(wallet_name=\"enc_wallet\", passphrase=\"passphrase\")\n+        enc_wallet = usernode.get_wallet_rpc(\"enc_wallet\")\n+        assert_raises_rpc_error(-13, \"Error: Please enter the wallet passphrase with walletpassphrase first.\", enc_wallet.rescanblockchain)\n+\n+        if not self.options.descriptors:\n+            self.log.info(\"Test rescanning an encrypted wallet\")\n+            hd_seed = get_generate_key().privkey\n+\n+            usernode.createwallet(wallet_name=\"temp_wallet\", blank=True, descriptors=False)\n+            temp_wallet = usernode.get_wallet_rpc(\"temp_wallet\")\n+            temp_wallet.sethdseed(seed=hd_seed)\n+\n+            for i in range(399):\n+                temp_wallet.getnewaddress()\n+\n+            self.generatetoaddress(usernode, COINBASE_MATURITY + 1, temp_wallet.getnewaddress())\n+            self.generatetoaddress(usernode, COINBASE_MATURITY + 1, temp_wallet.getnewaddress())\n+\n+            minernode.createwallet(\"encrypted_wallet\", blank=True, passphrase=\"passphrase\", descriptors=False)\n+            encrypted_wallet = minernode.get_wallet_rpc(\"encrypted_wallet\")\n+\n+            encrypted_wallet.walletpassphrase(\"passphrase\", 1)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26347#discussion_r1125568137",
      "id" : 1125568137,
      "in_reply_to_id" : 1123340738,
      "line" : 199,
      "node_id" : "PRRC_kwDOABII585DFs6J",
      "original_commit_id" : "6a5b348f2e526f048d0b448b01f6c4ab608569af",
      "original_line" : 199,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "test/functional/wallet_transactiontime_rescan.py",
      "position" : 47,
      "pull_request_review_id" : 1325132277,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26347",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1125568137/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-03-04T22:33:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1125568137",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   }
]
