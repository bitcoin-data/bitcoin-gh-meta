[
   {
      "author_association" : "MEMBER",
      "body" : "This may happen when one of the blocks in the main chain is marked invalid (for example due to corruption)",
      "created_at" : "2022-10-26T08:34:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/26391#issuecomment-1291688405",
      "id" : 1291688405,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26391",
      "node_id" : "IC_kwDOABII585M_ZnV",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1291688405/reactions"
      },
      "updated_at" : "2022-10-26T08:34:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1291688405",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Your `debug.log` shows that before seeing this behavior you were doing IBD up until `height=224854` were this happened, which I think matches what MarcoFalke said.\r\n```\r\n2022-10-26T07:24:30Z UpdateTip: new best=00000000000000cd7d1c3d5137423c00e6a221d5492ace06d8fb9d990f2d7c96 height=224854 version=0x00000002 log2_work=69.513761 tx=14063312 date='2013-03-08T15:46:54Z' progress=0.018147 cache=356.2MiB(2733513txo)\r\n2022-10-26T07:24:30Z ERROR: ConnectBlock: Consensus::CheckTxInputs: 878d6685666400b75a1947ccfc676249ecdf52678b2dc0d83e0328f8c24a951a, bad-txns-inputs-missingorspent, CheckTxInputs: inputs missing/spent\r\n2022-10-26T07:24:30Z InvalidChainFound: invalid block=000000000000032021a6d18011d202df36cf07822a657b47390ab90568bb14e2  height=224855  log2_work=69.513793  date=2013-03-08T15:58:52Z\r\n2022-10-26T07:24:30Z InvalidChainFound:  current best=00000000000000cd7d1c3d5137423c00e6a221d5492ace06d8fb9d990f2d7c96  height=224854  log2_work=69.513761  date=2013-03-08T15:46:54Z\r\n2022-10-26T07:24:30Z ERROR: ConnectTip: ConnectBlock 000000000000032021a6d18011d202df36cf07822a657b47390ab90568bb14e2 failed, bad-txns-inputs-missingorspent, CheckTxInputs: inputs missing/spent\r\n```\r\n\r\nOn the next run it started the pre-sync phase from that height, and that's the point it restarts every time.\r\n\r\nI've tried to reproduce using the backup of your directory, but I couldn't. Probably because using it requires a `-reindex`.",
      "created_at" : "2022-10-26T09:13:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/26391#issuecomment-1291737018",
      "id" : 1291737018,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26391",
      "node_id" : "IC_kwDOABII585M_le6",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1291737018/reactions"
      },
      "updated_at" : "2022-10-26T09:13:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1291737018",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/18506343?v=4",
         "events_url" : "https://api.github.com/users/kouloumos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kouloumos/followers",
         "following_url" : "https://api.github.com/users/kouloumos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kouloumos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kouloumos",
         "id" : 18506343,
         "login" : "kouloumos",
         "node_id" : "MDQ6VXNlcjE4NTA2MzQz",
         "organizations_url" : "https://api.github.com/users/kouloumos/orgs",
         "received_events_url" : "https://api.github.com/users/kouloumos/received_events",
         "repos_url" : "https://api.github.com/users/kouloumos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kouloumos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kouloumos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kouloumos"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Steps to reproduce (with a diff to force corruption):\r\n\r\n\r\n```diff\r\ndiff --git a/src/validation.cpp b/src/validation.cpp\r\nindex 37e68cfe4a..811ff2f9eb 100644\r\n--- a/src/validation.cpp\r\n+++ b/src/validation.cpp\r\n@@ -2201,7 +2201,7 @@ bool Chainstate::ConnectBlock(const CBlock& block, BlockValidationState& state,\r\n         {\r\n             CAmount txfee = 0;\r\n             TxValidationState tx_state;\r\n-            if (!Consensus::CheckTxInputs(tx, tx_state, view, pindex->nHeight, txfee)) {\r\n+            if (Consensus::CheckTxInputs(tx, tx_state, view, pindex->nHeight, txfee)) {\r\n                 // Any transaction validation failure in ConnectBlock is a block consensus failure\r\n                 state.Invalid(BlockValidationResult::BLOCK_CONSENSUS,\r\n                             tx_state.GetRejectReason(), tx_state.GetDebugMessage());\r\n```\r\n\r\nthen call `./src/qt/bitcoin-qt -datadir=/tmp -signet -printtoconsole=1`  ",
      "created_at" : "2022-10-26T09:35:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/26391#issuecomment-1291765534",
      "id" : 1291765534,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26391",
      "node_id" : "IC_kwDOABII585M_sce",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1291765534/reactions"
      },
      "updated_at" : "2022-10-26T09:35:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1291765534",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "cc @sdaftuar @sipa @dergoegge ",
      "created_at" : "2022-10-26T10:16:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/26391#issuecomment-1291812162",
      "id" : 1291812162,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26391",
      "node_id" : "IC_kwDOABII585M_31C",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1291812162/reactions"
      },
      "updated_at" : "2022-10-26T10:16:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1291812162",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@kouloumos\r\n> I've tried to reproduce using the backup of your directory, but I couldn't. Probably because using it requires a `-reindex`.\r\n\r\nThe files before `blk00047.dat` and `rev00047.dat` are omitted, and need to be copied in from another source.\r\n\r\n",
      "created_at" : "2022-10-26T16:32:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/26391#issuecomment-1292309175",
      "id" : 1292309175,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26391",
      "node_id" : "IC_kwDOABII585NBxK3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1292309175/reactions"
      },
      "updated_at" : "2022-10-26T16:32:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1292309175",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/691439?v=4",
         "events_url" : "https://api.github.com/users/da2ce7/events{/privacy}",
         "followers_url" : "https://api.github.com/users/da2ce7/followers",
         "following_url" : "https://api.github.com/users/da2ce7/following{/other_user}",
         "gists_url" : "https://api.github.com/users/da2ce7/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/da2ce7",
         "id" : 691439,
         "login" : "da2ce7",
         "node_id" : "MDQ6VXNlcjY5MTQzOQ==",
         "organizations_url" : "https://api.github.com/users/da2ce7/orgs",
         "received_events_url" : "https://api.github.com/users/da2ce7/received_events",
         "repos_url" : "https://api.github.com/users/da2ce7/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/da2ce7/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/da2ce7/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/da2ce7"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@da2ce7 The contents of those files is not deterministic, as it depends on the order you received blocks in. It's not necessarily possible for someone to reconstruct your state without those files (as some blocks may be before/after the cut off differently).",
      "created_at" : "2022-10-26T16:49:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/26391#issuecomment-1292328134",
      "id" : 1292328134,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26391",
      "node_id" : "IC_kwDOABII585NB1zG",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1292328134/reactions"
      },
      "updated_at" : "2022-10-26T16:49:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1292328134",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Discussed this a bit with @sdaftuar.\r\n\r\nWhat's going on here is actually expected: your node believes that the chain other nodes are offering it is invalid, thus it's correct behavior that it doesn't actually manage to synchronize and accept that chain. This invalidity is only detected during the headers sync phase, and not during the new pre-sync phase that precedes it. The result is that your node goes through peers one by one, attempting to synchronize headers with them, by performing a full pre-sync phase, and only after that completes noticing they're giving us a known invalid chain.\r\n\r\nA question is whether we could detect this during the pre-sync phase instead, which wouldn't stop the lack of progress, but would avoid the bandwidth waste on repeated presyncs with everyone. The answer is yes - it wouldn't be hard to check for known-invalid headers in the presync phase as well, however, I don't think we want to do that because of fingerprinting reasons: it would permit an attacker to feed you an invalid, low-PoW, block during IBD, and then later follow you around the network by claiming to have a chain that extends this invalid block. If you stop fetching immediately, they know you're the same node as the one they gave the invalid block to earlier.\r\n\r\nThis fingerprinting is partially solvable: by keeping track of how much work was built on top of an invalid block, and if that work meets our anti-DoS threshold, permit reacting on known-invalid blocks when they're fed to us during presync. This is however a fair bit of complexity and I'm not sure it's worth it for just somewhat improving the situation for essentially broken nodes which will never recover anyway.\r\n\r\nPerhaps time is better spent on better reporting to the user, in the form of targetted warnings in logs (or even failure to start) when there appears to be a long invalid high-PoW chain out there.",
      "created_at" : "2022-10-26T17:22:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/26391#issuecomment-1292366671",
      "id" : 1292366671,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26391",
      "node_id" : "IC_kwDOABII585NB_NP",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1292366671/reactions"
      },
      "updated_at" : "2022-10-26T17:22:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1292366671",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Arguably the fact that this results in corrupted node wasting bandwidth on redownloading headers multiple times is a 24.0 regression. But I don't know if it's worth fixing as it involves some complexity, and would only benefit already broken nodes anyway/",
      "created_at" : "2022-10-26T21:49:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/26391#issuecomment-1292691847",
      "id" : 1292691847,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26391",
      "node_id" : "IC_kwDOABII585NDOmH",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1292691847/reactions"
      },
      "updated_at" : "2022-10-26T21:49:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1292691847",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Same bug here. v24.0.1\r\n[Endless_Pre-synchronizing.txt](https://github.com/bitcoin/bitcoin/files/11483805/Endless_Pre-synchronizing.txt)\r\n",
      "created_at" : "2023-05-16T03:43:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/26391#issuecomment-1548932081",
      "id" : 1548932081,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26391",
      "node_id" : "IC_kwDOABII585cUtPx",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1548932081/reactions"
      },
      "updated_at" : "2023-05-16T03:43:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1548932081",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/26449500?v=4",
         "events_url" : "https://api.github.com/users/Shekelme/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Shekelme/followers",
         "following_url" : "https://api.github.com/users/Shekelme/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Shekelme/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Shekelme",
         "id" : 26449500,
         "login" : "Shekelme",
         "node_id" : "MDQ6VXNlcjI2NDQ5NTAw",
         "organizations_url" : "https://api.github.com/users/Shekelme/orgs",
         "received_events_url" : "https://api.github.com/users/Shekelme/received_events",
         "repos_url" : "https://api.github.com/users/Shekelme/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Shekelme/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Shekelme/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Shekelme"
      }
   }
]
