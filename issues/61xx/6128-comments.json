[
   {
      "body" : "hmmmm.  I think this is a symptom of a different problem.\r\n\r\nWe have a set of messages that appears before the debug log is initialized.  These should be buffered and dumped into the current log.\r\n\r\nMoving messages down just adds code in places where it would not otherwise go, if not for this log issue.\r\n",
      "created_at" : "2015-05-13T16:06:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6128#issuecomment-101726196",
      "id" : 101726196,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6128",
      "updated_at" : "2015-05-13T16:06:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/101726196",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "Is that still true (in light of the params modularization)?  I actually\nimplemented a quick buffer but since came to realize that it might be\ncompletely unnecessary.  At least in the non-exception case, the logs are\ninitialized as soon as the parameter interaction checking begins in\nAppInit2 and nothing really needs to hit the logs before that.  It looks\nlike this may be as simple as just moving the cut and the version string to\nthe start of the parameter interaction checks...\n\nThis might change the ordering of the messages, but it does have the\ndesirable property of keeping locality between messages and related code.\n\nWhat do you think?\n\nOn Wed, May 13, 2015 at 12:06 PM, Jeff Garzik <notifications@github.com>\nwrote:\n\n> hmmmm. I think this is a symptom of a different problem.\n>\n> We have a set of messages that appears before the debug log is\n> initialized. These should be buffered and dumped into the current log.\n>\n> Moving messages down just adds code in places where it would not otherwise\n> go, if not for this log issue.\n>\n> Ã¢ÂÂ\n> Reply to this email directly or view it on GitHub\n> <https://github.com/bitcoin/bitcoin/pull/6128#issuecomment-101726196>.\n>\n",
      "created_at" : "2015-05-14T21:02:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6128#issuecomment-102168920",
      "id" : 102168920,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6128",
      "updated_at" : "2015-05-14T21:02:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/102168920",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/430315?v=3",
         "events_url" : "https://api.github.com/users/ajweiss/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajweiss/followers",
         "following_url" : "https://api.github.com/users/ajweiss/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajweiss/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajweiss",
         "id" : 430315,
         "login" : "ajweiss",
         "organizations_url" : "https://api.github.com/users/ajweiss/orgs",
         "received_events_url" : "https://api.github.com/users/ajweiss/received_events",
         "repos_url" : "https://api.github.com/users/ajweiss/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajweiss/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajweiss/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajweiss"
      }
   },
   {
      "body" : "Can't we move \"the cut\" up instead? I'd personally prefer that to buffering, as buffering logs tends to add complexity for avoiding message loss in crashes. Writing directly to file is nice and robust.",
      "created_at" : "2015-05-15T10:02:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6128#issuecomment-102352217",
      "id" : 102352217,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6128",
      "updated_at" : "2015-05-15T10:02:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/102352217",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@laanwj Not really, no.  This is a familiar problem in many softwares:  You need logging at the earliest instant -- yet the logging itself has dependencies, such as reading the configuration file and determining the log file location.  Logging occurs before this point, no matter where you locate the cut.",
      "created_at" : "2015-05-15T16:19:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6128#issuecomment-102451651",
      "id" : 102451651,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6128",
      "updated_at" : "2015-05-15T16:19:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/102451651",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "Regardless, the cut and version message are going to have to be moved earlier in the init process since they now happen quite late after parameter checking.  I'll push two commits, one that moves the cut earlier in the initialization process.  The second will add buffering.  \r\n\r\nAgain, while playing yesterday, I noted that with the cut and version message moved very nearly to the top of AppInit2, nothing ended up in the buffer.  A cursory glance indicated that nothing really calls LogPrintf() before then either.  I'll push some code and then we can talk. ",
      "created_at" : "2015-05-15T18:13:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6128#issuecomment-102476119",
      "id" : 102476119,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6128",
      "updated_at" : "2015-05-15T18:13:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/102476119",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/430315?v=3",
         "events_url" : "https://api.github.com/users/ajweiss/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajweiss/followers",
         "following_url" : "https://api.github.com/users/ajweiss/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajweiss/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajweiss",
         "id" : 430315,
         "login" : "ajweiss",
         "organizations_url" : "https://api.github.com/users/ajweiss/orgs",
         "received_events_url" : "https://api.github.com/users/ajweiss/received_events",
         "repos_url" : "https://api.github.com/users/ajweiss/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajweiss/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajweiss/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajweiss"
      }
   },
   {
      "body" : "Ok, opened a new very simple PR #6147 that just moves the emission of the log cut to a sensible place.  I'm working on trying to get the code to emit a message before this cut now.  If I succeed, I'll PR the more complex buffering stuff.",
      "created_at" : "2015-05-15T21:42:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6128#issuecomment-102532202",
      "id" : 102532202,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6128",
      "updated_at" : "2015-05-15T21:42:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/102532202",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/430315?v=3",
         "events_url" : "https://api.github.com/users/ajweiss/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajweiss/followers",
         "following_url" : "https://api.github.com/users/ajweiss/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajweiss/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajweiss",
         "id" : 430315,
         "login" : "ajweiss",
         "organizations_url" : "https://api.github.com/users/ajweiss/orgs",
         "received_events_url" : "https://api.github.com/users/ajweiss/received_events",
         "repos_url" : "https://api.github.com/users/ajweiss/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajweiss/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajweiss/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajweiss"
      }
   }
]
