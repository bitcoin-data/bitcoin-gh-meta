[
   {
      "author_association" : "MEMBER",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [MarcoFalke](https://github.com/bitcoin/bitcoin/pull/27300#pullrequestreview-1352661597), [mzumsande](https://github.com/bitcoin/bitcoin/pull/27300#pullrequestreview-1352821536) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n",
      "created_at" : "2023-03-22T13:52:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27300#issuecomment-1479606380",
      "id" : 1479606380,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27300",
      "node_id" : "IC_kwDOABII585YMQBs",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1479606380/reactions"
      },
      "updated_at" : "2023-03-22T15:10:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1479606380",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27300#discussion_r1144866456"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27300"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1144866456"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\nstatic constexpr int32_t DEFAULT_ADDRMAN_CONSISTENCY_CHECKS{\r\n#ifdef DEBUG_ADDRMAN\r\n    1\r\n#else\r\n    0\r\n#endif\r\n};\r\n```\r\n\r\nstyle nit (feel free to ignore, if you don't like it)",
      "commit_id" : "7b326419681e9fa6f77e7b3b5a1047757141f442",
      "created_at" : "2023-03-22T14:02:46Z",
      "diff_hunk" : "@@ -27,7 +27,11 @@ class InvalidAddrManVersionError : public std::ios_base::failure\n class AddrManImpl;\n \n /** Default for -checkaddrman */\n+#ifdef DEBUG_ADDRMAN\n+static constexpr int32_t DEFAULT_ADDRMAN_CONSISTENCY_CHECKS{1};\n+#else\n static constexpr int32_t DEFAULT_ADDRMAN_CONSISTENCY_CHECKS{0};\n+#endif",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27300#discussion_r1144866456",
      "id" : 1144866456,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585EPUaY",
      "original_commit_id" : "61e3f8ab25474e63c835766a7c3655b882f15a58",
      "original_line" : 35,
      "original_position" : 8,
      "original_start_line" : 30,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 1352661597,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27300",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1144866456/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-03-22T14:04:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1144866456",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Maybe there can be a `--enable-debug-symbols` (implied by `--enable-debug`) to set `-g` for the compiler?",
      "created_at" : "2023-03-22T15:25:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27300#issuecomment-1479775571",
      "id" : 1479775571,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27300",
      "node_id" : "IC_kwDOABII585YM5VT",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1479775571/reactions"
      },
      "updated_at" : "2023-03-22T15:25:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1479775571",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@mzumsande FYI this PR is equivalent to running with `-checkaddrman=1` which does use quite some resources as it does a full addrman consistency check on pretty much every addrman operation (Add, Good, Attempt, Get, Select, Connected etc.).\r\n\r\nFor me this manifests as saturating an entire core via a combination of the `b-msghand`, `b-net` and `b-opencon` threads as these all spawn consistency checks. My `bitcoind` process  usually idles at ~5%, so to have one core @ 100% is a pretty big change, but my machine has 8 physical cores so it's also not too terrible...\r\n\r\nI have not profiled with perf as it is so obvious in top.\r\n\r\nI also agree that there are two debug scenarios (which are already mixed) being further mixed by this PR, i) enabling debugging symbols and ii) running the application in \"debug mode\". \r\n\r\nIn a vacuum I would agree with @MarcoFalke in introducing an `--enable-debug-symbols` flag, however in this project, with `--enable-debug` as the encumbent and there being a lot of developer expectation around what it does, perhaps the new flag  should be `--debug-mode` which both implies `--enable-debug` and actually runs with all these debug mode options enabled by default?  \r\n",
      "created_at" : "2023-03-22T16:27:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27300#issuecomment-1479890611",
      "id" : 1479890611,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27300",
      "node_id" : "IC_kwDOABII585YNVaz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1479890611/reactions"
      },
      "updated_at" : "2023-03-22T16:27:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1479890611",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27300#discussion_r1198630607"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27300"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198630607"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If these checks are going to be enabled by default on some builds, shouldn't the default be much higher; eg 100 or 1000? Doing it on every call is useful for live debugging or small scale tests, but seems overkill for a node's runtime default?",
      "commit_id" : "7b326419681e9fa6f77e7b3b5a1047757141f442",
      "created_at" : "2023-05-19T07:20:20Z",
      "diff_hunk" : "@@ -27,7 +27,11 @@ class InvalidAddrManVersionError : public std::ios_base::failure\n class AddrManImpl;\n \n /** Default for -checkaddrman */\n+#ifdef DEBUG_ADDRMAN\n+static constexpr int32_t DEFAULT_ADDRMAN_CONSISTENCY_CHECKS{1};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27300#discussion_r1198630607",
      "id" : 1198630607,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585HcabP",
      "original_commit_id" : "61e3f8ab25474e63c835766a7c3655b882f15a58",
      "original_line" : 31,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 1433911415,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27300",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198630607/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-19T07:20:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198630607",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27300#discussion_r1198635826"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27300"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198635826"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes I agree, the performance hit is too much for any kind of normal operation.\r\n\r\nI updated the branch with @MarcoFalke's suggestion along with a new debug option (which I called `--enable-debug-checks`, and not `--debug-slow`).\r\n\r\nI'll run a few runtime tests on various values for the checks to see if I can find a sweet spot for the frequency, then update the doc commit and push an update here.",
      "commit_id" : "7b326419681e9fa6f77e7b3b5a1047757141f442",
      "created_at" : "2023-05-19T07:26:36Z",
      "diff_hunk" : "@@ -27,7 +27,11 @@ class InvalidAddrManVersionError : public std::ios_base::failure\n class AddrManImpl;\n \n /** Default for -checkaddrman */\n+#ifdef DEBUG_ADDRMAN\n+static constexpr int32_t DEFAULT_ADDRMAN_CONSISTENCY_CHECKS{1};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27300#discussion_r1198635826",
      "id" : 1198635826,
      "in_reply_to_id" : 1198630607,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Hcbsy",
      "original_commit_id" : "61e3f8ab25474e63c835766a7c3655b882f15a58",
      "original_line" : 31,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 1433919168,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27300",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198635826/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-19T07:26:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198635826",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "OK pushed an update based on feedback here, in #24709 and #27586.\r\n\r\n* PR description updated with new details of this pull.\r\n* My opinion is that running these checks at a low enough frequency on mainnet debug builds is desirable and non-intrusive\r\n* Selecting values of `1000` for both consistency checks worked with no noticable overhead for me, and appeared to run once every minute or so, although my test node is not listening so others may see higher frequency in \"production debug\" builds which are listening.\r\n* I am unsure if _mempol_args.h_ is the right place for `DEFAULT_MEMPOOL_DEBUG_CHECKS`, and open to suggestions on that.\r\n* Happy to sqush both doc commits into their respective build commits, or indeed squash all 4 into a single commit, if preferred.",
      "created_at" : "2023-05-22T14:49:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27300#issuecomment-1557357578",
      "id" : 1557357578,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27300",
      "node_id" : "IC_kwDOABII585c02QK",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1557357578/reactions"
      },
      "updated_at" : "2023-05-23T08:17:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1557357578",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   }
]
