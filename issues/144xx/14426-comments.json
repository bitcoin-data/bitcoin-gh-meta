[
   {
      "author_association" : "MEMBER",
      "body" : "For reference, the boost implementation is in https://github.com/boostorg/interprocess/blob/8b3621353017aa527a22124655c9458d0b64b358/include/boost/interprocess/detail/os_file_functions.hpp#L230-L243",
      "created_at" : "2018-10-07T17:04:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14426#issuecomment-427669184",
      "id" : 427669184,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14426",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyNzY2OTE4NA==",
      "updated_at" : "2018-10-07T17:04:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/427669184",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/11154118?v=4",
         "events_url" : "https://api.github.com/users/ken2812221/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ken2812221/followers",
         "following_url" : "https://api.github.com/users/ken2812221/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ken2812221/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ken2812221",
         "id" : 11154118,
         "login" : "ken2812221",
         "node_id" : "MDQ6VXNlcjExMTU0MTE4",
         "organizations_url" : "https://api.github.com/users/ken2812221/orgs",
         "received_events_url" : "https://api.github.com/users/ken2812221/received_events",
         "repos_url" : "https://api.github.com/users/ken2812221/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ken2812221/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ken2812221"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Lgtm, nice test",
      "created_at" : "2018-10-07T20:23:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14426#issuecomment-427684024",
      "id" : 427684024,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14426",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyNzY4NDAyNA==",
      "updated_at" : "2018-10-07T20:23:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/427684024",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/2287825?v=4",
         "events_url" : "https://api.github.com/users/ch4ot1c/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ch4ot1c/followers",
         "following_url" : "https://api.github.com/users/ch4ot1c/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ch4ot1c/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ch4ot1c",
         "id" : 2287825,
         "login" : "ch4ot1c",
         "node_id" : "MDQ6VXNlcjIyODc4MjU=",
         "organizations_url" : "https://api.github.com/users/ch4ot1c/orgs",
         "received_events_url" : "https://api.github.com/users/ch4ot1c/received_events",
         "repos_url" : "https://api.github.com/users/ch4ot1c/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ch4ot1c/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ch4ot1c/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ch4ot1c"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "utACK https://github.com/bitcoin/bitcoin/pull/14426/commits/6d336e39dffb4951f09beedc478ba425c38c60b2",
      "created_at" : "2018-10-08T17:06:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14426#issuecomment-427909683",
      "id" : 427909683,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14426",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyNzkwOTY4Mw==",
      "updated_at" : "2018-10-08T17:06:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/427909683",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6394033?v=4",
         "events_url" : "https://api.github.com/users/donaloconnor/events{/privacy}",
         "followers_url" : "https://api.github.com/users/donaloconnor/followers",
         "following_url" : "https://api.github.com/users/donaloconnor/following{/other_user}",
         "gists_url" : "https://api.github.com/users/donaloconnor/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/donaloconnor",
         "id" : 6394033,
         "login" : "donaloconnor",
         "node_id" : "MDQ6VXNlcjYzOTQwMzM=",
         "organizations_url" : "https://api.github.com/users/donaloconnor/orgs",
         "received_events_url" : "https://api.github.com/users/donaloconnor/received_events",
         "repos_url" : "https://api.github.com/users/donaloconnor/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/donaloconnor/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/donaloconnor/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/donaloconnor"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14426#discussion_r223539001"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14426"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/223539001"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: `std::numeric_limits<DWORD>::max()` or explicitly casting to unsigned might be more clear.",
      "commit_id" : "369244f654c9e36b803e841eb30fd0aa2960087a",
      "created_at" : "2018-10-09T01:30:07Z",
      "diff_hunk" : "@@ -89,7 +89,7 @@ bool FileLock::TryLock()\n         return false;\n     }\n     _OVERLAPPED overlapped = {0};\n-    if (!LockFileEx(hFile, LOCKFILE_EXCLUSIVE_LOCK | LOCKFILE_FAIL_IMMEDIATELY, 0, 0, 0, &overlapped)) {\n+    if (!LockFileEx(hFile, LOCKFILE_EXCLUSIVE_LOCK | LOCKFILE_FAIL_IMMEDIATELY, 0, -1, -1, &overlapped)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14426#discussion_r223539001",
      "id" : 223539001,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMzUzOTAwMQ==",
      "original_commit_id" : "6d336e39dffb4951f09beedc478ba425c38c60b2",
      "original_position" : 5,
      "path" : "src/fs.cpp",
      "position" : null,
      "pull_request_review_id" : 162690612,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14426",
      "updated_at" : "2018-10-18T18:29:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/223539001",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->Reviewers, this pull request conflicts with the following ones:\n\n* #14320 ([bugfix] wallet: Fix duplicate fileid detection by ken2812221)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2018-10-09T08:16:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14426#issuecomment-428102594",
      "id" : 428102594,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14426",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyODEwMjU5NA==",
      "updated_at" : "2018-10-09T08:16:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/428102594",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "utACK https://github.com/bitcoin/bitcoin/pull/14426/commits/474d022036ca2114750fc650f6712a99eda1bad4",
      "created_at" : "2018-10-09T19:40:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14426#issuecomment-428323766",
      "id" : 428323766,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14426",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyODMyMzc2Ng==",
      "updated_at" : "2018-10-09T19:40:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/428323766",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6394033?v=4",
         "events_url" : "https://api.github.com/users/donaloconnor/events{/privacy}",
         "followers_url" : "https://api.github.com/users/donaloconnor/followers",
         "following_url" : "https://api.github.com/users/donaloconnor/following{/other_user}",
         "gists_url" : "https://api.github.com/users/donaloconnor/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/donaloconnor",
         "id" : 6394033,
         "login" : "donaloconnor",
         "node_id" : "MDQ6VXNlcjYzOTQwMzM=",
         "organizations_url" : "https://api.github.com/users/donaloconnor/orgs",
         "received_events_url" : "https://api.github.com/users/donaloconnor/received_events",
         "repos_url" : "https://api.github.com/users/donaloconnor/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/donaloconnor/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/donaloconnor/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/donaloconnor"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14426#discussion_r223909417"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14426"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/223909417"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Move to node class as `get_output`? If that's controversial then extract to a module function for now? Then below:\r\n\r\n```py\r\n_, output = get_node_output(node=self.nodes[1], ret_code_expected=1)\r\n```",
      "commit_id" : "369244f654c9e36b803e841eb30fd0aa2960087a",
      "created_at" : "2018-10-10T01:00:02Z",
      "diff_hunk" : "@@ -0,0 +1,44 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Verify that it could not start two bitcoind in the same datadir\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+import os\n+\n+class FilelockTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+\n+    def get_node_output(self, *, index, ret_code_expected):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14426#discussion_r223909417",
      "id" : 223909417,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMzkwOTQxNw==",
      "original_commit_id" : "474d022036ca2114750fc650f6712a99eda1bad4",
      "original_position" : 17,
      "path" : "test/functional/feature_filelock.py",
      "position" : null,
      "pull_request_review_id" : 163152636,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14426",
      "updated_at" : "2018-10-18T18:29:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/223909417",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14426#discussion_r224492412"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14426"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224492412"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "369244f654c9e36b803e841eb30fd0aa2960087a",
      "created_at" : "2018-10-11T15:22:06Z",
      "diff_hunk" : "@@ -0,0 +1,44 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Verify that it could not start two bitcoind in the same datadir\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+import os\n+\n+class FilelockTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+\n+    def get_node_output(self, *, index, ret_code_expected):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14426#discussion_r224492412",
      "id" : 224492412,
      "in_reply_to_id" : 223909417,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNDQ5MjQxMg==",
      "original_commit_id" : "474d022036ca2114750fc650f6712a99eda1bad4",
      "original_position" : 17,
      "path" : "test/functional/feature_filelock.py",
      "position" : null,
      "pull_request_review_id" : 163874109,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14426",
      "updated_at" : "2018-10-18T18:29:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224492412",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/11154118?v=4",
         "events_url" : "https://api.github.com/users/ken2812221/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ken2812221/followers",
         "following_url" : "https://api.github.com/users/ken2812221/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ken2812221/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ken2812221",
         "id" : 11154118,
         "login" : "ken2812221",
         "node_id" : "MDQ6VXNlcjExMTU0MTE4",
         "organizations_url" : "https://api.github.com/users/ken2812221/orgs",
         "received_events_url" : "https://api.github.com/users/ken2812221/received_events",
         "repos_url" : "https://api.github.com/users/ken2812221/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ken2812221/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ken2812221"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14426#discussion_r225009649"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14426"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/225009649"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Specify string format arguments as logging function parameters to allow for lazy evaluation.",
      "commit_id" : "369244f654c9e36b803e841eb30fd0aa2960087a",
      "created_at" : "2018-10-14T21:25:24Z",
      "diff_hunk" : "@@ -0,0 +1,44 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Verify that it could not start two bitcoind in the same datadir\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+import os\n+\n+def get_node_output(*, node, ret_code_expected):\n+    ret_code = node.process.wait(timeout=5)\n+    assert_equal(ret_code, ret_code_expected)\n+    node.stdout.seek(0)\n+    node.stderr.seek(0)\n+    out = node.stdout.read()\n+    err = node.stderr.read()\n+    node.stdout.close()\n+    node.stderr.close()\n+\n+    # Clean up TestNode state\n+    node.running = False\n+    node.process = None\n+    node.rpc_connected = False\n+    node.rpc = None\n+\n+    return out, err\n+\n+class FilelockTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+\n+    def run_test(self):\n+        self.nodes[1].stop()\n+        self.log.info(\"Using datadir \" + self.nodes[0].datadir)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14426#discussion_r225009649",
      "id" : 225009649,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNTAwOTY0OQ==",
      "original_commit_id" : "851df19a7357bf776bafc7c6a87fa71315b3f247",
      "original_position" : 37,
      "path" : "test/functional/feature_filelock.py",
      "position" : null,
      "pull_request_review_id" : 164515472,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14426",
      "updated_at" : "2018-10-18T18:29:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/225009649",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14426#discussion_r225010682"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14426"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/225010682"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "369244f654c9e36b803e841eb30fd0aa2960087a",
      "created_at" : "2018-10-14T21:56:59Z",
      "diff_hunk" : "@@ -0,0 +1,44 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Verify that it could not start two bitcoind in the same datadir\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+import os\n+\n+def get_node_output(*, node, ret_code_expected):\n+    ret_code = node.process.wait(timeout=5)\n+    assert_equal(ret_code, ret_code_expected)\n+    node.stdout.seek(0)\n+    node.stderr.seek(0)\n+    out = node.stdout.read()\n+    err = node.stderr.read()\n+    node.stdout.close()\n+    node.stderr.close()\n+\n+    # Clean up TestNode state\n+    node.running = False\n+    node.process = None\n+    node.rpc_connected = False\n+    node.rpc = None\n+\n+    return out, err\n+\n+class FilelockTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+\n+    def run_test(self):\n+        self.nodes[1].stop()\n+        self.log.info(\"Using datadir \" + self.nodes[0].datadir)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14426#discussion_r225010682",
      "id" : 225010682,
      "in_reply_to_id" : 225009649,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNTAxMDY4Mg==",
      "original_commit_id" : "851df19a7357bf776bafc7c6a87fa71315b3f247",
      "original_position" : 37,
      "path" : "test/functional/feature_filelock.py",
      "position" : null,
      "pull_request_review_id" : 164516552,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14426",
      "updated_at" : "2018-10-18T18:29:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/225010682",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/11154118?v=4",
         "events_url" : "https://api.github.com/users/ken2812221/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ken2812221/followers",
         "following_url" : "https://api.github.com/users/ken2812221/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ken2812221/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ken2812221",
         "id" : 11154118,
         "login" : "ken2812221",
         "node_id" : "MDQ6VXNlcjExMTU0MTE4",
         "organizations_url" : "https://api.github.com/users/ken2812221/orgs",
         "received_events_url" : "https://api.github.com/users/ken2812221/received_events",
         "repos_url" : "https://api.github.com/users/ken2812221/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ken2812221/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ken2812221"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This seems like a reasonable change (although I know nothing about the windows API). `LockFileEx` documentation is here: https://docs.microsoft.com/en-us/windows/desktop/api/fileapi/nf-fileapi-lockfileex.\r\n\r\nThe test case is good, but it has the wrong file permissions and replicates functionality that is already available in the test framework. I've reimplemented it here: https://github.com/jnewbery/bitcoin/tree/pr14426.1 which uses the `assert_start_raises_init_error()` method. It's more concise, runs faster, also covers trying to open a wallet being used by a different bitcoind process, and I think is clearer. Feel free to take that commit in this PR.",
      "created_at" : "2018-10-18T15:19:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14426#issuecomment-431050370",
      "id" : 431050370,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14426",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMTA1MDM3MA==",
      "updated_at" : "2018-10-18T15:19:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/431050370",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks, I didn't know test framework that much, just trying to do what I want. Your commit looks good to me, I'll take it. The only thing I change is to skip wallet test if it's not compiled.",
      "created_at" : "2018-10-18T16:20:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14426#issuecomment-431072814",
      "id" : 431072814,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14426",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMTA3MjgxNA==",
      "updated_at" : "2018-10-18T16:20:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/431072814",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/11154118?v=4",
         "events_url" : "https://api.github.com/users/ken2812221/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ken2812221/followers",
         "following_url" : "https://api.github.com/users/ken2812221/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ken2812221/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ken2812221",
         "id" : 11154118,
         "login" : "ken2812221",
         "node_id" : "MDQ6VXNlcjExMTU0MTE4",
         "organizations_url" : "https://api.github.com/users/ken2812221/orgs",
         "received_events_url" : "https://api.github.com/users/ken2812221/received_events",
         "repos_url" : "https://api.github.com/users/ken2812221/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ken2812221/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ken2812221"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK c7296a98e56a3a38730575c7aa7f524f10e2a0a9.\r\n\r\nI think the `feature_notifications.py` failure in appveyer is unrelated. The `feature_filelock.py` failure is due to a path slash mismatch: `C:/Users\\appveyor` instead of `C:\\Users\\appveyor`.",
      "created_at" : "2018-10-18T16:30:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14426#issuecomment-431075921",
      "id" : 431075921,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14426",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMTA3NTkyMQ==",
      "updated_at" : "2018-10-18T16:30:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/431075921",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@ken2812221 should we explicitly call UnlockFile before closing the handle. The OS does unlock it but it's not instant potentially. Maybe safer to unlock before closing",
      "created_at" : "2018-10-18T16:40:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14426#issuecomment-431079402",
      "id" : 431079402,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14426",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMTA3OTQwMg==",
      "updated_at" : "2018-10-18T16:40:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/431079402",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6394033?v=4",
         "events_url" : "https://api.github.com/users/donaloconnor/events{/privacy}",
         "followers_url" : "https://api.github.com/users/donaloconnor/followers",
         "following_url" : "https://api.github.com/users/donaloconnor/following{/other_user}",
         "gists_url" : "https://api.github.com/users/donaloconnor/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/donaloconnor",
         "id" : 6394033,
         "login" : "donaloconnor",
         "node_id" : "MDQ6VXNlcjYzOTQwMzM=",
         "organizations_url" : "https://api.github.com/users/donaloconnor/orgs",
         "received_events_url" : "https://api.github.com/users/donaloconnor/received_events",
         "repos_url" : "https://api.github.com/users/donaloconnor/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/donaloconnor/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/donaloconnor/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/donaloconnor"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@donaloconnor I am not sure what condition would be unsafe if we don't unlock the file. Also, the [boost implementation](https://github.com/boostorg/interprocess/blob/b962143350e9af0ec64098911744bd1fff65f31d/include/boost/interprocess/sync/file_lock.hpp#L169) here only close file in deconstructor.",
      "created_at" : "2018-10-18T17:12:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14426#issuecomment-431089567",
      "id" : 431089567,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14426",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMTA4OTU2Nw==",
      "updated_at" : "2018-10-18T17:13:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/431089567",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/11154118?v=4",
         "events_url" : "https://api.github.com/users/ken2812221/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ken2812221/followers",
         "following_url" : "https://api.github.com/users/ken2812221/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ken2812221/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ken2812221",
         "id" : 11154118,
         "login" : "ken2812221",
         "node_id" : "MDQ6VXNlcjExMTU0MTE4",
         "organizations_url" : "https://api.github.com/users/ken2812221/orgs",
         "received_events_url" : "https://api.github.com/users/ken2812221/received_events",
         "repos_url" : "https://api.github.com/users/ken2812221/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ken2812221/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ken2812221"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@ken2812221 I did a test there across 2 processes to see if there's any weird race conditions with not unlocking before  close and there's not. I thought being explicit might be better. Anyway no big deal.\r\n\r\ntested ACK.",
      "created_at" : "2018-10-18T21:51:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14426#issuecomment-431176306",
      "id" : 431176306,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14426",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMTE3NjMwNg==",
      "updated_at" : "2018-10-18T21:51:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/431176306",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6394033?v=4",
         "events_url" : "https://api.github.com/users/donaloconnor/events{/privacy}",
         "followers_url" : "https://api.github.com/users/donaloconnor/followers",
         "following_url" : "https://api.github.com/users/donaloconnor/following{/other_user}",
         "gists_url" : "https://api.github.com/users/donaloconnor/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/donaloconnor",
         "id" : 6394033,
         "login" : "donaloconnor",
         "node_id" : "MDQ6VXNlcjYzOTQwMzM=",
         "organizations_url" : "https://api.github.com/users/donaloconnor/orgs",
         "received_events_url" : "https://api.github.com/users/donaloconnor/received_events",
         "repos_url" : "https://api.github.com/users/donaloconnor/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/donaloconnor/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/donaloconnor/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/donaloconnor"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 369244f654c9e36b803e841eb30fd0aa2960087a",
      "created_at" : "2018-10-19T13:29:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14426#issuecomment-431363372",
      "id" : 431363372,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14426",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMTM2MzM3Mg==",
      "updated_at" : "2018-10-19T13:29:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/431363372",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 369244f654c9e36b803e841eb30fd0aa2960087a",
      "created_at" : "2018-10-20T01:59:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14426#issuecomment-431539796",
      "id" : 431539796,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14426",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMTUzOTc5Ng==",
      "updated_at" : "2018-10-20T01:59:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/431539796",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   }
]
