[
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK I needed that long ago.",
      "created_at" : "2018-10-17T04:47:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14498#issuecomment-430488232",
      "id" : 430488232,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14498",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMDQ4ODIzMg==",
      "updated_at" : "2018-10-17T04:47:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/430488232",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "NACK, transactions don't have from addresses in the model our wallet exposes.\r\n\r\nIt may make sense to have a separate simpler transaction watcher, which is similar to the wallet, but doesn't have all the accounting logic. However, for our current wallet, I believe this is feature creep and confusing.",
      "created_at" : "2018-10-17T07:03:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14498#issuecomment-430513379",
      "id" : 430513379,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14498",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMDUxMzM3OQ==",
      "updated_at" : "2018-10-17T07:03:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/430513379",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Fair point on feature creep:) I opened this more as a continuation of discussion in #10599 than as a new feature to merge, so please close the PR if there are no strong arguments for this.\r\n\r\nBy a separate simpler transaction watcher you mean a part of core or an external tool?",
      "created_at" : "2018-10-17T08:13:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14498#issuecomment-430533065",
      "id" : 430533065,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14498",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMDUzMzA2NQ==",
      "updated_at" : "2018-10-17T08:13:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/430533065",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7646953?v=4",
         "events_url" : "https://api.github.com/users/mrwhythat/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mrwhythat/followers",
         "following_url" : "https://api.github.com/users/mrwhythat/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mrwhythat/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mrwhythat",
         "id" : 7646953,
         "login" : "mrwhythat",
         "node_id" : "MDQ6VXNlcjc2NDY5NTM=",
         "organizations_url" : "https://api.github.com/users/mrwhythat/orgs",
         "received_events_url" : "https://api.github.com/users/mrwhythat/received_events",
         "repos_url" : "https://api.github.com/users/mrwhythat/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mrwhythat/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mrwhythat/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mrwhythat"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14498#discussion_r225981161"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14498"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/225981161"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Are you sure about this?",
      "commit_id" : "afd2f777bdb1ff795396c33382fe5b93ce179594",
      "created_at" : "2018-10-17T15:28:19Z",
      "diff_hunk" : "@@ -1160,26 +1161,55 @@ static UniValue ListReceived(CWallet * const pwallet, const UniValue& params, bo\n         if (nDepth < nMinDepth)\n             continue;\n \n-        for (const CTxOut& txout : wtx.tx->vout)\n+        if (received)\n         {\n-            CTxDestination address;\n-            if (!ExtractDestination(txout.scriptPubKey, address))\n-                continue;\n+            for (const CTxOut& txout : wtx.tx->vout)\n+            {\n+                CTxDestination address;\n+                if (!ExtractDestination(txout.scriptPubKey, address))\n+                    continue;\n+\n+                if (has_filtered_address && !(filtered_address == address)) {\n+                    continue;\n+                }\n+\n+                isminefilter mine = IsMine(*pwallet, address);\n+                if(!(mine & filter))\n+                    continue;\n \n-            if (has_filtered_address && !(filtered_address == address)) {\n-                continue;\n+                tallyitem& item = mapTally[address];\n+                item.nAmount += txout.nValue;\n+                item.nConf = std::min(item.nConf, nDepth);\n+                item.txids.push_back(wtx.GetHash());\n+                if (mine & ISMINE_WATCH_ONLY)\n+                    item.fIsWatchonly = true;\n             }\n+        }\n+        else\n+        {\n+            for (const CTxIn& txin : wtx.tx->vin)\n+            {\n+                const COutPoint& prevout = txin.prevout;\n+                const CTxOut& txout = pwallet->GetWalletTx(prevout.hash)->tx->vout[prevout.n];",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14498#discussion_r225981161",
      "id" : 225981161,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNTk4MTE2MQ==",
      "original_commit_id" : "afd2f777bdb1ff795396c33382fe5b93ce179594",
      "original_position" : 49,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 49,
      "pull_request_review_id" : 165694732,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14498",
      "updated_at" : "2018-10-17T15:28:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/225981161",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14498#discussion_r226023665"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14498"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/226023665"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Well, after @sipa's comment I'm not sure about this PR in general, but I adapted some tests from `rpc_listreceivedby.py` and it seems to be working. I may be missing something deep here though.",
      "commit_id" : "afd2f777bdb1ff795396c33382fe5b93ce179594",
      "created_at" : "2018-10-17T17:24:39Z",
      "diff_hunk" : "@@ -1160,26 +1161,55 @@ static UniValue ListReceived(CWallet * const pwallet, const UniValue& params, bo\n         if (nDepth < nMinDepth)\n             continue;\n \n-        for (const CTxOut& txout : wtx.tx->vout)\n+        if (received)\n         {\n-            CTxDestination address;\n-            if (!ExtractDestination(txout.scriptPubKey, address))\n-                continue;\n+            for (const CTxOut& txout : wtx.tx->vout)\n+            {\n+                CTxDestination address;\n+                if (!ExtractDestination(txout.scriptPubKey, address))\n+                    continue;\n+\n+                if (has_filtered_address && !(filtered_address == address)) {\n+                    continue;\n+                }\n+\n+                isminefilter mine = IsMine(*pwallet, address);\n+                if(!(mine & filter))\n+                    continue;\n \n-            if (has_filtered_address && !(filtered_address == address)) {\n-                continue;\n+                tallyitem& item = mapTally[address];\n+                item.nAmount += txout.nValue;\n+                item.nConf = std::min(item.nConf, nDepth);\n+                item.txids.push_back(wtx.GetHash());\n+                if (mine & ISMINE_WATCH_ONLY)\n+                    item.fIsWatchonly = true;\n             }\n+        }\n+        else\n+        {\n+            for (const CTxIn& txin : wtx.tx->vin)\n+            {\n+                const COutPoint& prevout = txin.prevout;\n+                const CTxOut& txout = pwallet->GetWalletTx(prevout.hash)->tx->vout[prevout.n];",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14498#discussion_r226023665",
      "id" : 226023665,
      "in_reply_to_id" : 225981161,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNjAyMzY2NQ==",
      "original_commit_id" : "afd2f777bdb1ff795396c33382fe5b93ce179594",
      "original_position" : 49,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 49,
      "pull_request_review_id" : 165747519,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14498",
      "updated_at" : "2018-10-17T17:24:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/226023665",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7646953?v=4",
         "events_url" : "https://api.github.com/users/mrwhythat/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mrwhythat/followers",
         "following_url" : "https://api.github.com/users/mrwhythat/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mrwhythat/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mrwhythat",
         "id" : 7646953,
         "login" : "mrwhythat",
         "node_id" : "MDQ6VXNlcjc2NDY5NTM=",
         "organizations_url" : "https://api.github.com/users/mrwhythat/orgs",
         "received_events_url" : "https://api.github.com/users/mrwhythat/received_events",
         "repos_url" : "https://api.github.com/users/mrwhythat/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mrwhythat/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mrwhythat/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mrwhythat"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14498#discussion_r226136385"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14498"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/226136385"
         }
      },
      "author_association" : "MEMBER",
      "body" : "There are no tests here. Anyway `CWallet::GetWalletTx` only returns wallet transactions and so this would fail when `wtx` in an incoming transaction.",
      "commit_id" : "afd2f777bdb1ff795396c33382fe5b93ce179594",
      "created_at" : "2018-10-18T00:26:01Z",
      "diff_hunk" : "@@ -1160,26 +1161,55 @@ static UniValue ListReceived(CWallet * const pwallet, const UniValue& params, bo\n         if (nDepth < nMinDepth)\n             continue;\n \n-        for (const CTxOut& txout : wtx.tx->vout)\n+        if (received)\n         {\n-            CTxDestination address;\n-            if (!ExtractDestination(txout.scriptPubKey, address))\n-                continue;\n+            for (const CTxOut& txout : wtx.tx->vout)\n+            {\n+                CTxDestination address;\n+                if (!ExtractDestination(txout.scriptPubKey, address))\n+                    continue;\n+\n+                if (has_filtered_address && !(filtered_address == address)) {\n+                    continue;\n+                }\n+\n+                isminefilter mine = IsMine(*pwallet, address);\n+                if(!(mine & filter))\n+                    continue;\n \n-            if (has_filtered_address && !(filtered_address == address)) {\n-                continue;\n+                tallyitem& item = mapTally[address];\n+                item.nAmount += txout.nValue;\n+                item.nConf = std::min(item.nConf, nDepth);\n+                item.txids.push_back(wtx.GetHash());\n+                if (mine & ISMINE_WATCH_ONLY)\n+                    item.fIsWatchonly = true;\n             }\n+        }\n+        else\n+        {\n+            for (const CTxIn& txin : wtx.tx->vin)\n+            {\n+                const COutPoint& prevout = txin.prevout;\n+                const CTxOut& txout = pwallet->GetWalletTx(prevout.hash)->tx->vout[prevout.n];",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14498#discussion_r226136385",
      "id" : 226136385,
      "in_reply_to_id" : 225981161,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNjEzNjM4NQ==",
      "original_commit_id" : "afd2f777bdb1ff795396c33382fe5b93ce179594",
      "original_position" : 49,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 49,
      "pull_request_review_id" : 165886832,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14498",
      "updated_at" : "2018-10-18T00:26:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/226136385",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14498#discussion_r226270456"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14498"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/226270456"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I assumed there's no need for tests since this got a NACK.\r\n\r\nI was going to check it with tests, but if I undersand it correctly, since we're interested only in wallet transactions, checking if result of `GetWalletTx` is non-`nullptr`would be enough? \r\n```suggestion\r\n                const CWalletTx* iwtx = pwallet->GetWalletTx(prevout.hash);\r\n                if (!iwtx) continue;\r\n                const CTxOut& txout = iwtx->tx->vout[prevout.n];\r\n```\r\nOr am I missing something again?\r\n",
      "commit_id" : "afd2f777bdb1ff795396c33382fe5b93ce179594",
      "created_at" : "2018-10-18T11:38:29Z",
      "diff_hunk" : "@@ -1160,26 +1161,55 @@ static UniValue ListReceived(CWallet * const pwallet, const UniValue& params, bo\n         if (nDepth < nMinDepth)\n             continue;\n \n-        for (const CTxOut& txout : wtx.tx->vout)\n+        if (received)\n         {\n-            CTxDestination address;\n-            if (!ExtractDestination(txout.scriptPubKey, address))\n-                continue;\n+            for (const CTxOut& txout : wtx.tx->vout)\n+            {\n+                CTxDestination address;\n+                if (!ExtractDestination(txout.scriptPubKey, address))\n+                    continue;\n+\n+                if (has_filtered_address && !(filtered_address == address)) {\n+                    continue;\n+                }\n+\n+                isminefilter mine = IsMine(*pwallet, address);\n+                if(!(mine & filter))\n+                    continue;\n \n-            if (has_filtered_address && !(filtered_address == address)) {\n-                continue;\n+                tallyitem& item = mapTally[address];\n+                item.nAmount += txout.nValue;\n+                item.nConf = std::min(item.nConf, nDepth);\n+                item.txids.push_back(wtx.GetHash());\n+                if (mine & ISMINE_WATCH_ONLY)\n+                    item.fIsWatchonly = true;\n             }\n+        }\n+        else\n+        {\n+            for (const CTxIn& txin : wtx.tx->vin)\n+            {\n+                const COutPoint& prevout = txin.prevout;\n+                const CTxOut& txout = pwallet->GetWalletTx(prevout.hash)->tx->vout[prevout.n];",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14498#discussion_r226270456",
      "id" : 226270456,
      "in_reply_to_id" : 225981161,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNjI3MDQ1Ng==",
      "original_commit_id" : "afd2f777bdb1ff795396c33382fe5b93ce179594",
      "original_position" : 49,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 49,
      "pull_request_review_id" : 166048913,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14498",
      "updated_at" : "2018-10-18T11:38:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/226270456",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7646953?v=4",
         "events_url" : "https://api.github.com/users/mrwhythat/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mrwhythat/followers",
         "following_url" : "https://api.github.com/users/mrwhythat/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mrwhythat/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mrwhythat",
         "id" : 7646953,
         "login" : "mrwhythat",
         "node_id" : "MDQ6VXNlcjc2NDY5NTM=",
         "organizations_url" : "https://api.github.com/users/mrwhythat/orgs",
         "received_events_url" : "https://api.github.com/users/mrwhythat/received_events",
         "repos_url" : "https://api.github.com/users/mrwhythat/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mrwhythat/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mrwhythat/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mrwhythat"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14498#discussion_r226273015"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14498"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/226273015"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think that is correct.",
      "commit_id" : "afd2f777bdb1ff795396c33382fe5b93ce179594",
      "created_at" : "2018-10-18T11:48:57Z",
      "diff_hunk" : "@@ -1160,26 +1161,55 @@ static UniValue ListReceived(CWallet * const pwallet, const UniValue& params, bo\n         if (nDepth < nMinDepth)\n             continue;\n \n-        for (const CTxOut& txout : wtx.tx->vout)\n+        if (received)\n         {\n-            CTxDestination address;\n-            if (!ExtractDestination(txout.scriptPubKey, address))\n-                continue;\n+            for (const CTxOut& txout : wtx.tx->vout)\n+            {\n+                CTxDestination address;\n+                if (!ExtractDestination(txout.scriptPubKey, address))\n+                    continue;\n+\n+                if (has_filtered_address && !(filtered_address == address)) {\n+                    continue;\n+                }\n+\n+                isminefilter mine = IsMine(*pwallet, address);\n+                if(!(mine & filter))\n+                    continue;\n \n-            if (has_filtered_address && !(filtered_address == address)) {\n-                continue;\n+                tallyitem& item = mapTally[address];\n+                item.nAmount += txout.nValue;\n+                item.nConf = std::min(item.nConf, nDepth);\n+                item.txids.push_back(wtx.GetHash());\n+                if (mine & ISMINE_WATCH_ONLY)\n+                    item.fIsWatchonly = true;\n             }\n+        }\n+        else\n+        {\n+            for (const CTxIn& txin : wtx.tx->vin)\n+            {\n+                const COutPoint& prevout = txin.prevout;\n+                const CTxOut& txout = pwallet->GetWalletTx(prevout.hash)->tx->vout[prevout.n];",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14498#discussion_r226273015",
      "id" : 226273015,
      "in_reply_to_id" : 225981161,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNjI3MzAxNQ==",
      "original_commit_id" : "afd2f777bdb1ff795396c33382fe5b93ce179594",
      "original_position" : 49,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 49,
      "pull_request_review_id" : 166052343,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14498",
      "updated_at" : "2018-10-18T12:04:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/226273015",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14498#discussion_r226274784"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14498"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/226274784"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This can be avoided when `has_filtered_address`:\r\n\r\nabove before the loop:\r\n```cpp\r\nconst isminefilter is_mine_filtered_address = has_filtered_address ? IsMine(*pwallet, filtered_address) : ISMINE_NO;\r\n```\r\nand here:\r\n```cpp\r\nisminefilter mine = has_filtered_address ? is_mine_filtered_address : IsMine(*pwallet, address);\r\n```",
      "commit_id" : "afd2f777bdb1ff795396c33382fe5b93ce179594",
      "created_at" : "2018-10-18T11:55:41Z",
      "diff_hunk" : "@@ -1160,26 +1161,55 @@ static UniValue ListReceived(CWallet * const pwallet, const UniValue& params, bo\n         if (nDepth < nMinDepth)\n             continue;\n \n-        for (const CTxOut& txout : wtx.tx->vout)\n+        if (received)\n         {\n-            CTxDestination address;\n-            if (!ExtractDestination(txout.scriptPubKey, address))\n-                continue;\n+            for (const CTxOut& txout : wtx.tx->vout)\n+            {\n+                CTxDestination address;\n+                if (!ExtractDestination(txout.scriptPubKey, address))\n+                    continue;\n+\n+                if (has_filtered_address && !(filtered_address == address)) {\n+                    continue;\n+                }\n+\n+                isminefilter mine = IsMine(*pwallet, address);\n+                if(!(mine & filter))\n+                    continue;\n \n-            if (has_filtered_address && !(filtered_address == address)) {\n-                continue;\n+                tallyitem& item = mapTally[address];\n+                item.nAmount += txout.nValue;\n+                item.nConf = std::min(item.nConf, nDepth);\n+                item.txids.push_back(wtx.GetHash());\n+                if (mine & ISMINE_WATCH_ONLY)\n+                    item.fIsWatchonly = true;\n             }\n+        }\n+        else\n+        {\n+            for (const CTxIn& txin : wtx.tx->vin)\n+            {\n+                const COutPoint& prevout = txin.prevout;\n+                const CTxOut& txout = pwallet->GetWalletTx(prevout.hash)->tx->vout[prevout.n];\n+                CTxDestination address;\n+                if (!ExtractDestination(txout.scriptPubKey, address))\n+                    continue;\n+\n+                if (has_filtered_address && !(filtered_address == address)) {\n+                    continue;\n+                }\n \n-            isminefilter mine = IsMine(*pwallet, address);\n-            if(!(mine & filter))\n-                continue;\n+                isminefilter mine = IsMine(*pwallet, address);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14498#discussion_r226274784",
      "id" : 226274784,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNjI3NDc4NA==",
      "original_commit_id" : "afd2f777bdb1ff795396c33382fe5b93ce179594",
      "original_position" : 61,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 61,
      "pull_request_review_id" : 166052343,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14498",
      "updated_at" : "2018-10-18T12:07:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/226274784",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->Reviewers, this pull request conflicts with the following ones:\n\n* #14437 (Refactor: Start to separate wallet from node by ryanofsky)\n* #11634 (wallet: Add missing cs_wallet/cs_KeyStore locks to wallet by practicalswift)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2018-10-20T09:54:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14498#issuecomment-431566477",
      "id" : 431566477,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14498",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMTU2NjQ3Nw==",
      "updated_at" : "2018-10-20T09:54:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/431566477",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2018-10-24T09:40:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14498#issuecomment-432587640",
      "id" : 432587640,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14498",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMjU4NzY0MA==",
      "updated_at" : "2018-10-24T09:40:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/432587640",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@mrwhythat agree in closing?",
      "created_at" : "2018-11-04T18:18:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14498#issuecomment-435692904",
      "id" : 435692904,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14498",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNTY5MjkwNA==",
      "updated_at" : "2018-11-04T18:18:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/435692904",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@promag, yup, closing.",
      "created_at" : "2018-11-04T18:44:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14498#issuecomment-435694942",
      "id" : 435694942,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14498",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNTY5NDk0Mg==",
      "updated_at" : "2018-11-04T18:44:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/435694942",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7646953?v=4",
         "events_url" : "https://api.github.com/users/mrwhythat/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mrwhythat/followers",
         "following_url" : "https://api.github.com/users/mrwhythat/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mrwhythat/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mrwhythat",
         "id" : 7646953,
         "login" : "mrwhythat",
         "node_id" : "MDQ6VXNlcjc2NDY5NTM=",
         "organizations_url" : "https://api.github.com/users/mrwhythat/orgs",
         "received_events_url" : "https://api.github.com/users/mrwhythat/received_events",
         "repos_url" : "https://api.github.com/users/mrwhythat/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mrwhythat/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mrwhythat/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mrwhythat"
      }
   }
]
