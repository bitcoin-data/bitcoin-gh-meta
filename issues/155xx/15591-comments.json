[
   {
      "author_association" : "NONE",
      "body" : "The issue is no longer happening. I repeated the exact same steps as before and it is working correctly now and unable to replicate it again. I still have the terminal window open to prove it occurred and I'm not going crazy.\r\nThe wallets were originally on Intel hardware and were moved onto a newer OS on AMD hardware. Surely that wouldn't have caused issues?",
      "created_at" : "2019-03-16T11:48:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/15591#issuecomment-473523234",
      "id" : 473523234,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15591",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3MzUyMzIzNA==",
      "updated_at" : "2019-03-16T11:48:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/473523234",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/2773867?v=4",
         "events_url" : "https://api.github.com/users/benwilliams/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benwilliams/followers",
         "following_url" : "https://api.github.com/users/benwilliams/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benwilliams/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benwilliams",
         "id" : 2773867,
         "login" : "benwilliams",
         "node_id" : "MDQ6VXNlcjI3NzM4Njc=",
         "organizations_url" : "https://api.github.com/users/benwilliams/orgs",
         "received_events_url" : "https://api.github.com/users/benwilliams/received_events",
         "repos_url" : "https://api.github.com/users/benwilliams/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benwilliams/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benwilliams/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benwilliams"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've managed to replicate similar inconsistency following your method.\r\nEDIT: I've also managed to achieve this simply by unloading and then loading the wallet:\r\n\r\n```\r\n$ ./bitcoind -regtest -datadir=../datadir &\r\n$ ./bitcoin-cli -regtest -datadir=../datadir -getinfo\r\n{\r\n  \"version\": 189900,\r\n  \"protocolversion\": 70015,\r\n  \"blocks\": 200,\r\n  \"chain\": \"regtest\",\r\n  \"walletversion\": 169900,\r\n  \"balance\": 4999.99996680,\r\n   ...\r\n}\r\n$ ./bitcoin-cli -regtest -datadir=../datadir unloadwallet \"\"\r\n$ ./bitcoin-cli -regtest -datadir=../datadir loadwallet \"\"\r\n$ ./bitcoin-cli -regtest -datadir=../datadir -getinfo\r\n{\r\n  \"version\": 189900,\r\n  \"protocolversion\": 70015,\r\n  \"blocks\": 200,\r\n  \"chain\": \"regtest\",\r\n  \"walletversion\": 169900,\r\n  \"balance\": 4950.00000000,\r\n   ...\r\n}\r\n```\r\n\r\nNotice the second balance is nearly 50 BTC less than the first. I'll look into this.",
      "created_at" : "2019-03-18T08:09:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/15591#issuecomment-473809080",
      "id" : 473809080,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15591",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3MzgwOTA4MA==",
      "updated_at" : "2019-03-18T08:12:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/473809080",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Assigned milestone 0.18.0",
      "created_at" : "2019-03-22T20:22:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/15591#issuecomment-475768648",
      "id" : 475768648,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15591",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3NTc2ODY0OA==",
      "updated_at" : "2019-03-22T20:22:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/475768648",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Is this a regression from 0.17.1?",
      "created_at" : "2019-03-22T20:24:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/15591#issuecomment-475769092",
      "id" : 475769092,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15591",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3NTc2OTA5Mg==",
      "updated_at" : "2019-03-22T20:24:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/475769092",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke the issue exists since `loadwallet` was added, so should also be fixed in 0.17.2 and 0.18 rc3.\r\n\r\nThe problem is that dynamically loaded wallet don't see mempool transactions.\r\n\r\nIt's more clear if you use `getwalletinfo` (instead of `-getinfo`) and observe `unconfirmed_balance`.\r\n\r\nNot sure what should be the right fix. There is\r\nhttps://github.com/bitcoin/bitcoin/blob/68520597ccf8ff3f6e8a7ad6869b06bf2012ae8a/src/wallet/wallet.cpp#L4399-L4404\r\nbut should it also do?\r\n```\r\n     // Add mempool transactions that aren't yet in the wallet\r\n```",
      "created_at" : "2019-03-22T23:38:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/15591#issuecomment-475816270",
      "id" : 475816270,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15591",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3NTgxNjI3MA==",
      "updated_at" : "2019-03-22T23:38:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/475816270",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "To reproduce, use one wallet `test1` to send a transaction to another wallet `test2` while `test2` is unloaded, then load `test2`:\r\n\r\n```\r\n# generate on test1\r\nbitcoind -regtest -wallet=test1 &\r\nbitcoin-cli -regtest getnewaddress\r\nbitcoin-cli -regtest generatetoaddress 101 $(bitcoin-cli -regtest getnewaddress)\r\n\r\n# create test2, get receiving address and unload the wallet\r\nbitcoin-cli -regtest createwallet test2\r\nA=$(bitcoin-cli -regtest -rpcwallet=test2 getnewaddress)\r\nbitcoin-cli -regtest -rpcwallet=test2 unloadwallet\r\n\r\n# send value to the above address and check balance\r\nbitcoin-cli -regtest sendtoaddress $A 1\r\nbitcoin-cli -regtest loadwallet test2\r\nbitcoin-cli -regtest -rpcwallet=test2 getwalletinfo\r\n{\r\n  \"walletname\": \"test2\",\r\n  \"walletversion\": 169900,\r\n  \"balance\": 0.00000000,\r\n  \"unconfirmed_balance\": 0.00000000,\r\n  ...\r\n\r\n# restart now with wallet test2 and check balance\r\nbitcoin-cli -regtest stop\r\nbitcoind -regtest -wallet=test2\r\nbitcoin-cli -regtest getwalletinfo\r\n{\r\n  \"walletname\": \"test2\",\r\n  \"walletversion\": 169900,\r\n  \"balance\": 0.00000000,\r\n  \"unconfirmed_balance\": 1.00000000,\r\n```\r\nNote: I've run the above in branch 0.17.",
      "created_at" : "2019-03-22T23:53:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/15591#issuecomment-475818538",
      "id" : 475818538,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15591",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3NTgxODUzOA==",
      "updated_at" : "2019-03-22T23:54:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/475818538",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   }
]
