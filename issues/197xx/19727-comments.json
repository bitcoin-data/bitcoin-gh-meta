[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@dhruv welcome! Looks like a great first contribution.\r\n\r\nRan tests and everything LGTM, but @jnewbery is probably the guy who you'd want to take a look at this since it was his suggestion.",
      "created_at" : "2020-08-16T00:59:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19727#issuecomment-674463848",
      "id" : 674463848,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19727",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3NDQ2Mzg0OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-16T00:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/674463848",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/755825?v=4",
         "events_url" : "https://api.github.com/users/adamjonas/events{/privacy}",
         "followers_url" : "https://api.github.com/users/adamjonas/followers",
         "following_url" : "https://api.github.com/users/adamjonas/following{/other_user}",
         "gists_url" : "https://api.github.com/users/adamjonas/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/adamjonas",
         "id" : 755825,
         "login" : "adamjonas",
         "node_id" : "MDQ6VXNlcjc1NTgyNQ==",
         "organizations_url" : "https://api.github.com/users/adamjonas/orgs",
         "received_events_url" : "https://api.github.com/users/adamjonas/received_events",
         "repos_url" : "https://api.github.com/users/adamjonas/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/adamjonas/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/adamjonas/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/adamjonas"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. Thanks @dhruv . I'll review soon.",
      "created_at" : "2020-08-16T08:28:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19727#issuecomment-674497791",
      "id" : 674497791,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19727",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3NDQ5Nzc5MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-16T08:28:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/674497791",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> @dhruv welcome! Looks like a great first contribution.\r\n\r\nThank you for the warm welcome and review, @adamjonas. I am excited to be here.\r\n",
      "created_at" : "2020-08-16T16:23:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19727#issuecomment-674546961",
      "id" : 674546961,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19727",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3NDU0Njk2MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-16T16:23:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/674546961",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471156749"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471156749"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Unrelated to this PR, but is there a better way to sync here? `wait_until` RPC shows something that would happen after a block announcement?",
      "commit_id" : "ed5cd12869e0691a785199d2d977ce5879095180",
      "created_at" : "2020-08-16T20:47:18Z",
      "diff_hunk" : "@@ -125,7 +120,7 @@ def run_test(self):\n         wait_until(lambda: no_verack_idlenode.version_received, timeout=10, lock=mininode_lock)\n \n         # Mine a block and make sure that it's not sent to the connected nodes\n-        self.nodes[0].generatetoaddress(1, self.nodes[0].get_deterministic_priv_key().address)\n+        self.nodes[0].generate(nblocks=1)\n \n         #Give the node enough time to possibly leak out a message\n         time.sleep(5)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471156749",
      "id" : 471156749,
      "line" : 125,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTE1Njc0OQ==",
      "original_commit_id" : "43986d9a78d799499b51ca6d743c429faea41ad0",
      "original_line" : 125,
      "original_position" : 83,
      "original_start_line" : null,
      "path" : "test/functional/p2p_leak.py",
      "position" : 103,
      "pull_request_review_id" : 468093555,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-18T20:14:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471156749",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/gzhao408/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gzhao408/followers",
         "following_url" : "https://api.github.com/users/gzhao408/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gzhao408/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gzhao408",
         "id" : 25183001,
         "login" : "gzhao408",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/gzhao408/orgs",
         "received_events_url" : "https://api.github.com/users/gzhao408/received_events",
         "repos_url" : "https://api.github.com/users/gzhao408/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gzhao408/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gzhao408/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gzhao408"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471157548"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471157548"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Should we wait until all the pings are received by the node?\r\ne.g. through \r\n```py\r\n`getpeerinfo` -> peer['bytesrecv_per_msg'].get('ping', 0)\r\n```",
      "commit_id" : "ed5cd12869e0691a785199d2d977ce5879095180",
      "created_at" : "2020-08-16T20:55:02Z",
      "diff_hunk" : "@@ -106,17 +94,24 @@ def set_test_params(self):\n         self.num_nodes = 1\n \n     def run_test(self):\n+        # Peer that never sends a version. We will send a bunch of messages\n+        # from this node anyway and verify eventual disconnection.\n         no_version_disconnect_node = self.nodes[0].add_p2p_connection(\n-            CNodeNoVersionMisbehavior(), send_version=False, wait_for_verack=False)\n-        no_version_idlenode = self.nodes[0].add_p2p_connection(CNodeNoVersionIdle(), send_version=False, wait_for_verack=False)\n+            CLazyNode(), send_version=False, wait_for_verack=False)\n+\n+        # Another peer that never sends a version. Just sits idle and hopes to receive\n+        # any message (it shouldn't!)\n+        no_version_idlenode = self.nodes[0].add_p2p_connection(CLazyNode(), send_version=False, wait_for_verack=False)\n+\n+        # Peer that sends a version but not a verack.\n         no_verack_idlenode = self.nodes[0].add_p2p_connection(CNodeNoVerackIdle(), wait_for_verack=False)\n \n-        # Send enough veracks without a message to reach the peer discouragement\n-        # threshold. This should get us disconnected.\n+        # Send enough ping messages (any non-version message will do) prior to sending\n+        # version to reach the peer discouragement threshold. This should get us disconnected.\n         for _ in range(DISCOURAGEMENT_THRESHOLD):\n-            no_version_disconnect_node.send_message(msg_verack())\n+            no_version_disconnect_node.send_message(msg_ping())\n ",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471157548",
      "id" : 471157548,
      "line" : 112,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTE1NzU0OA==",
      "original_commit_id" : "43986d9a78d799499b51ca6d743c429faea41ad0",
      "original_line" : 112,
      "original_position" : 69,
      "original_start_line" : null,
      "path" : "test/functional/p2p_leak.py",
      "position" : 83,
      "pull_request_review_id" : 468093555,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-18T20:14:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471157548",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/gzhao408/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gzhao408/followers",
         "following_url" : "https://api.github.com/users/gzhao408/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gzhao408/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gzhao408",
         "id" : 25183001,
         "login" : "gzhao408",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/gzhao408/orgs",
         "received_events_url" : "https://api.github.com/users/gzhao408/received_events",
         "repos_url" : "https://api.github.com/users/gzhao408/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gzhao408/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gzhao408/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gzhao408"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471158011"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471158011"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: I think we should take this opportunity to rename the mininodes to \"peers\" instead of nodes, because they aren't actually bitcoind nodes.\r\n(nit but I'm sure jnewbery would agree)\r\n```suggestion\r\n        no_version_disconnect_peer = self.nodes[0].add_p2p_connection(\r\n```",
      "commit_id" : "ed5cd12869e0691a785199d2d977ce5879095180",
      "created_at" : "2020-08-16T20:57:48Z",
      "diff_hunk" : "@@ -106,17 +94,24 @@ def set_test_params(self):\n         self.num_nodes = 1\n \n     def run_test(self):\n+        # Peer that never sends a version. We will send a bunch of messages\n+        # from this node anyway and verify eventual disconnection.\n         no_version_disconnect_node = self.nodes[0].add_p2p_connection(",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471158011",
      "id" : 471158011,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTE1ODAxMQ==",
      "original_commit_id" : "43986d9a78d799499b51ca6d743c429faea41ad0",
      "original_line" : 99,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "test/functional/p2p_leak.py",
      "position" : null,
      "pull_request_review_id" : 468093555,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-18T20:14:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471158011",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/gzhao408/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gzhao408/followers",
         "following_url" : "https://api.github.com/users/gzhao408/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gzhao408/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gzhao408",
         "id" : 25183001,
         "login" : "gzhao408",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/gzhao408/orgs",
         "received_events_url" : "https://api.github.com/users/gzhao408/received_events",
         "repos_url" : "https://api.github.com/users/gzhao408/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gzhao408/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gzhao408/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gzhao408"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471158117"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471158117"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n        # Wait until we got the verack in response to the version. Though, don't wait for the node to receive the\r\n```",
      "commit_id" : "ed5cd12869e0691a785199d2d977ce5879095180",
      "created_at" : "2020-08-16T20:58:33Z",
      "diff_hunk" : "@@ -106,17 +94,24 @@ def set_test_params(self):\n         self.num_nodes = 1\n \n     def run_test(self):\n+        # Peer that never sends a version. We will send a bunch of messages\n+        # from this node anyway and verify eventual disconnection.\n         no_version_disconnect_node = self.nodes[0].add_p2p_connection(\n-            CNodeNoVersionMisbehavior(), send_version=False, wait_for_verack=False)\n-        no_version_idlenode = self.nodes[0].add_p2p_connection(CNodeNoVersionIdle(), send_version=False, wait_for_verack=False)\n+            CLazyNode(), send_version=False, wait_for_verack=False)\n+\n+        # Another peer that never sends a version. Just sits idle and hopes to receive\n+        # any message (it shouldn't!)\n+        no_version_idlenode = self.nodes[0].add_p2p_connection(CLazyNode(), send_version=False, wait_for_verack=False)\n+\n+        # Peer that sends a version but not a verack.\n         no_verack_idlenode = self.nodes[0].add_p2p_connection(CNodeNoVerackIdle(), wait_for_verack=False)\n \n-        # Send enough veracks without a message to reach the peer discouragement\n-        # threshold. This should get us disconnected.\n+        # Send enough ping messages (any non-version message will do) prior to sending\n+        # version to reach the peer discouragement threshold. This should get us disconnected.\n         for _ in range(DISCOURAGEMENT_THRESHOLD):\n-            no_version_disconnect_node.send_message(msg_verack())\n+            no_version_disconnect_node.send_message(msg_ping())\n \n-        # Wait until we got the verack in response to the version. Though, don't wait for the other node to receive the\n+        # Wait until we got the verack in response to the version. Though, don't wait for self.nodes[0] to receive the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471158117",
      "id" : 471158117,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTE1ODExNw==",
      "original_commit_id" : "43986d9a78d799499b51ca6d743c429faea41ad0",
      "original_line" : 114,
      "original_position" : 71,
      "original_start_line" : null,
      "path" : "test/functional/p2p_leak.py",
      "position" : null,
      "pull_request_review_id" : 468093555,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-18T20:14:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471158117",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/gzhao408/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gzhao408/followers",
         "following_url" : "https://api.github.com/users/gzhao408/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gzhao408/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gzhao408",
         "id" : 25183001,
         "login" : "gzhao408",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/gzhao408/orgs",
         "received_events_url" : "https://api.github.com/users/gzhao408/received_events",
         "repos_url" : "https://api.github.com/users/gzhao408/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gzhao408/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gzhao408/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gzhao408"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471158660"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471158660"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: same\r\n```suggestion\r\n        no_version_idle_peer = self.nodes[0].add_p2p_connection(CLazyNode(), send_version=False, wait_for_verack=False)\r\n```",
      "commit_id" : "ed5cd12869e0691a785199d2d977ce5879095180",
      "created_at" : "2020-08-16T21:04:03Z",
      "diff_hunk" : "@@ -106,17 +94,24 @@ def set_test_params(self):\n         self.num_nodes = 1\n \n     def run_test(self):\n+        # Peer that never sends a version. We will send a bunch of messages\n+        # from this node anyway and verify eventual disconnection.\n         no_version_disconnect_node = self.nodes[0].add_p2p_connection(\n-            CNodeNoVersionMisbehavior(), send_version=False, wait_for_verack=False)\n-        no_version_idlenode = self.nodes[0].add_p2p_connection(CNodeNoVersionIdle(), send_version=False, wait_for_verack=False)\n+            CLazyNode(), send_version=False, wait_for_verack=False)\n+\n+        # Another peer that never sends a version. Just sits idle and hopes to receive\n+        # any message (it shouldn't!)\n+        no_version_idlenode = self.nodes[0].add_p2p_connection(CLazyNode(), send_version=False, wait_for_verack=False)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471158660",
      "id" : 471158660,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTE1ODY2MA==",
      "original_commit_id" : "43986d9a78d799499b51ca6d743c429faea41ad0",
      "original_line" : 104,
      "original_position" : 57,
      "original_start_line" : null,
      "path" : "test/functional/p2p_leak.py",
      "position" : null,
      "pull_request_review_id" : 468093555,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-18T20:14:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471158660",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/gzhao408/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gzhao408/followers",
         "following_url" : "https://api.github.com/users/gzhao408/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gzhao408/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gzhao408",
         "id" : 25183001,
         "login" : "gzhao408",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/gzhao408/orgs",
         "received_events_url" : "https://api.github.com/users/gzhao408/received_events",
         "repos_url" : "https://api.github.com/users/gzhao408/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gzhao408/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gzhao408/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gzhao408"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471158709"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471158709"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: same again\r\n```suggestion\r\n        no_verack_idle_peer = self.nodes[0].add_p2p_connection(CNodeNoVerackIdle(), wait_for_verack=False)\r\n```",
      "commit_id" : "ed5cd12869e0691a785199d2d977ce5879095180",
      "created_at" : "2020-08-16T21:04:42Z",
      "diff_hunk" : "@@ -106,17 +94,24 @@ def set_test_params(self):\n         self.num_nodes = 1\n \n     def run_test(self):\n+        # Peer that never sends a version. We will send a bunch of messages\n+        # from this node anyway and verify eventual disconnection.\n         no_version_disconnect_node = self.nodes[0].add_p2p_connection(\n-            CNodeNoVersionMisbehavior(), send_version=False, wait_for_verack=False)\n-        no_version_idlenode = self.nodes[0].add_p2p_connection(CNodeNoVersionIdle(), send_version=False, wait_for_verack=False)\n+            CLazyNode(), send_version=False, wait_for_verack=False)\n+\n+        # Another peer that never sends a version. Just sits idle and hopes to receive\n+        # any message (it shouldn't!)\n+        no_version_idlenode = self.nodes[0].add_p2p_connection(CLazyNode(), send_version=False, wait_for_verack=False)\n+\n+        # Peer that sends a version but not a verack.\n         no_verack_idlenode = self.nodes[0].add_p2p_connection(CNodeNoVerackIdle(), wait_for_verack=False)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471158709",
      "id" : 471158709,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTE1ODcwOQ==",
      "original_commit_id" : "43986d9a78d799499b51ca6d743c429faea41ad0",
      "original_line" : 107,
      "original_position" : 60,
      "original_start_line" : null,
      "path" : "test/functional/p2p_leak.py",
      "position" : null,
      "pull_request_review_id" : 468093555,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-18T20:14:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471158709",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/gzhao408/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gzhao408/followers",
         "following_url" : "https://api.github.com/users/gzhao408/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gzhao408/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gzhao408",
         "id" : 25183001,
         "login" : "gzhao408",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/gzhao408/orgs",
         "received_events_url" : "https://api.github.com/users/gzhao408/received_events",
         "repos_url" : "https://api.github.com/users/gzhao408/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gzhao408/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gzhao408/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gzhao408"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471159498"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471159498"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I like the documentation you've added!\r\nnit: I think \"hopes\" kind of sounds like it's doing something actively\r\n```suggestion\r\n        # Another peer that never sends a version, nor any other messages. It shouldn't receive anything from the node.\r\n```",
      "commit_id" : "ed5cd12869e0691a785199d2d977ce5879095180",
      "created_at" : "2020-08-16T21:12:59Z",
      "diff_hunk" : "@@ -106,17 +94,24 @@ def set_test_params(self):\n         self.num_nodes = 1\n \n     def run_test(self):\n+        # Peer that never sends a version. We will send a bunch of messages\n+        # from this node anyway and verify eventual disconnection.\n         no_version_disconnect_node = self.nodes[0].add_p2p_connection(\n-            CNodeNoVersionMisbehavior(), send_version=False, wait_for_verack=False)\n-        no_version_idlenode = self.nodes[0].add_p2p_connection(CNodeNoVersionIdle(), send_version=False, wait_for_verack=False)\n+            CLazyNode(), send_version=False, wait_for_verack=False)\n+\n+        # Another peer that never sends a version. Just sits idle and hopes to receive",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471159498",
      "id" : 471159498,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTE1OTQ5OA==",
      "original_commit_id" : "43986d9a78d799499b51ca6d743c429faea41ad0",
      "original_line" : 102,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "test/functional/p2p_leak.py",
      "position" : null,
      "pull_request_review_id" : 468093555,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-18T20:14:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471159498",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/gzhao408/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gzhao408/followers",
         "following_url" : "https://api.github.com/users/gzhao408/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gzhao408/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gzhao408",
         "id" : 25183001,
         "login" : "gzhao408",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/gzhao408/orgs",
         "received_events_url" : "https://api.github.com/users/gzhao408/received_events",
         "repos_url" : "https://api.github.com/users/gzhao408/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gzhao408/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gzhao408/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gzhao408"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471178095"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471178095"
         }
      },
      "author_association" : "NONE",
      "body" : "Going to take a look at this and follow-up in a separate PR.",
      "commit_id" : "ed5cd12869e0691a785199d2d977ce5879095180",
      "created_at" : "2020-08-17T00:11:56Z",
      "diff_hunk" : "@@ -125,7 +120,7 @@ def run_test(self):\n         wait_until(lambda: no_verack_idlenode.version_received, timeout=10, lock=mininode_lock)\n \n         # Mine a block and make sure that it's not sent to the connected nodes\n-        self.nodes[0].generatetoaddress(1, self.nodes[0].get_deterministic_priv_key().address)\n+        self.nodes[0].generate(nblocks=1)\n \n         #Give the node enough time to possibly leak out a message\n         time.sleep(5)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471178095",
      "id" : 471178095,
      "in_reply_to_id" : 471156749,
      "line" : 125,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTE3ODA5NQ==",
      "original_commit_id" : "43986d9a78d799499b51ca6d743c429faea41ad0",
      "original_line" : 125,
      "original_position" : 83,
      "original_start_line" : null,
      "path" : "test/functional/p2p_leak.py",
      "position" : 103,
      "pull_request_review_id" : 468108855,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-18T20:14:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471178095",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471178149"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471178149"
         }
      },
      "author_association" : "NONE",
      "body" : "Great suggestion - I did my best but please let me know if there's a better way",
      "commit_id" : "ed5cd12869e0691a785199d2d977ce5879095180",
      "created_at" : "2020-08-17T00:12:26Z",
      "diff_hunk" : "@@ -106,17 +94,24 @@ def set_test_params(self):\n         self.num_nodes = 1\n \n     def run_test(self):\n+        # Peer that never sends a version. We will send a bunch of messages\n+        # from this node anyway and verify eventual disconnection.\n         no_version_disconnect_node = self.nodes[0].add_p2p_connection(\n-            CNodeNoVersionMisbehavior(), send_version=False, wait_for_verack=False)\n-        no_version_idlenode = self.nodes[0].add_p2p_connection(CNodeNoVersionIdle(), send_version=False, wait_for_verack=False)\n+            CLazyNode(), send_version=False, wait_for_verack=False)\n+\n+        # Another peer that never sends a version. Just sits idle and hopes to receive\n+        # any message (it shouldn't!)\n+        no_version_idlenode = self.nodes[0].add_p2p_connection(CLazyNode(), send_version=False, wait_for_verack=False)\n+\n+        # Peer that sends a version but not a verack.\n         no_verack_idlenode = self.nodes[0].add_p2p_connection(CNodeNoVerackIdle(), wait_for_verack=False)\n \n-        # Send enough veracks without a message to reach the peer discouragement\n-        # threshold. This should get us disconnected.\n+        # Send enough ping messages (any non-version message will do) prior to sending\n+        # version to reach the peer discouragement threshold. This should get us disconnected.\n         for _ in range(DISCOURAGEMENT_THRESHOLD):\n-            no_version_disconnect_node.send_message(msg_verack())\n+            no_version_disconnect_node.send_message(msg_ping())\n ",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471178149",
      "id" : 471178149,
      "in_reply_to_id" : 471157548,
      "line" : 112,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTE3ODE0OQ==",
      "original_commit_id" : "43986d9a78d799499b51ca6d743c429faea41ad0",
      "original_line" : 112,
      "original_position" : 69,
      "original_start_line" : null,
      "path" : "test/functional/p2p_leak.py",
      "position" : 83,
      "pull_request_review_id" : 468108920,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-18T20:14:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471178149",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471178204"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471178204"
         }
      },
      "author_association" : "NONE",
      "body" : "Made this change across the test",
      "commit_id" : "ed5cd12869e0691a785199d2d977ce5879095180",
      "created_at" : "2020-08-17T00:12:47Z",
      "diff_hunk" : "@@ -106,17 +94,24 @@ def set_test_params(self):\n         self.num_nodes = 1\n \n     def run_test(self):\n+        # Peer that never sends a version. We will send a bunch of messages\n+        # from this node anyway and verify eventual disconnection.\n         no_version_disconnect_node = self.nodes[0].add_p2p_connection(",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471178204",
      "id" : 471178204,
      "in_reply_to_id" : 471158011,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTE3ODIwNA==",
      "original_commit_id" : "43986d9a78d799499b51ca6d743c429faea41ad0",
      "original_line" : 99,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "test/functional/p2p_leak.py",
      "position" : null,
      "pull_request_review_id" : 468108956,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-18T20:14:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471178204",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Peers = not bitcoind nodes, but \"mininodes\" that just implement the P2P interface\r\n\r\nA node is a peer, a peer can be a node, a peer is not a beer ð» ",
      "created_at" : "2020-08-17T00:28:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19727#issuecomment-674600024",
      "id" : 674600024,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19727",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3NDYwMDAyNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-17T00:28:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/674600024",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> A node is a peer, a peer can be a node\r\n\r\nOops ya that looks wrong out of context. I meant we shouldn't call mininodes nodes, and \"peer\" is what I recommend as a better name. I edited my comment thank you @promag ð¥ ",
      "created_at" : "2020-08-17T01:23:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19727#issuecomment-674609952",
      "id" : 674609952,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19727",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3NDYwOTk1Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-17T01:23:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/674609952",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/gzhao408/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gzhao408/followers",
         "following_url" : "https://api.github.com/users/gzhao408/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gzhao408/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gzhao408",
         "id" : 25183001,
         "login" : "gzhao408",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/gzhao408/orgs",
         "received_events_url" : "https://api.github.com/users/gzhao408/received_events",
         "repos_url" : "https://api.github.com/users/gzhao408/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gzhao408/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gzhao408/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gzhao408"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471318328"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471318328"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is actually waiting to see if the bitcoind node sends an unexpected messaged, so the word 'node' is correct here.",
      "commit_id" : "ed5cd12869e0691a785199d2d977ce5879095180",
      "created_at" : "2020-08-17T08:21:03Z",
      "diff_hunk" : "@@ -64,28 +65,15 @@ def on_getblocktxn(self, message): self.bad_message(message)\n     def on_blocktxn(self, message): self.bad_message(message)\n \n \n-# Node that never sends a version. We'll use this to send a bunch of messages\n-# anyway, and eventually get disconnected.\n-class CNodeNoVersionMisbehavior(CLazyNode):\n-    pass\n-\n-\n-# Node that never sends a version. This one just sits idle and hopes to receive\n-# any message (it shouldn't!)\n-class CNodeNoVersionIdle(CLazyNode):\n-    def __init__(self):\n-        super().__init__()\n-\n-\n-# Node that sends a version but not a verack.\n-class CNodeNoVerackIdle(CLazyNode):\n+# Peer that sends a version but not a verack.\n+class CNoVerackIdlePeer(CLazyPeer):\n     def __init__(self):\n         self.version_received = False\n         super().__init__()\n \n     def on_verack(self, message): pass\n     # When version is received, don't reply with a verack. Instead, see if the\n-    # node will give us a message that it shouldn't. This is not an exhaustive\n+    # peer will give us a message that it shouldn't. This is not an exhaustive",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471318328",
      "id" : 471318328,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTMxODMyOA==",
      "original_commit_id" : "6c5733c796ac02da4c0b45a373007f3e453479e3",
      "original_line" : 76,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "test/functional/p2p_leak.py",
      "position" : null,
      "pull_request_review_id" : 468261023,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-18T20:14:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471318328",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471318931"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471318931"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Since you're renaming these classes, you should drop the `C` prefix, which isn't the current code style.",
      "commit_id" : "ed5cd12869e0691a785199d2d977ce5879095180",
      "created_at" : "2020-08-17T08:22:10Z",
      "diff_hunk" : "@@ -27,9 +26,10 @@\n )\n \n DISCOURAGEMENT_THRESHOLD = 100\n+PING_MESSAGE_SIZE = 32\n \n \n-class CLazyNode(P2PInterface):\n+class CLazyPeer(P2PInterface):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471318931",
      "id" : 471318931,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTMxODkzMQ==",
      "original_commit_id" : "6c5733c796ac02da4c0b45a373007f3e453479e3",
      "original_line" : 32,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "test/functional/p2p_leak.py",
      "position" : null,
      "pull_request_review_id" : 468261023,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-18T20:14:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471318931",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471671787"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471671787"
         }
      },
      "author_association" : "NONE",
      "body" : "Done",
      "commit_id" : "ed5cd12869e0691a785199d2d977ce5879095180",
      "created_at" : "2020-08-17T18:12:07Z",
      "diff_hunk" : "@@ -27,9 +26,10 @@\n )\n \n DISCOURAGEMENT_THRESHOLD = 100\n+PING_MESSAGE_SIZE = 32\n \n \n-class CLazyNode(P2PInterface):\n+class CLazyPeer(P2PInterface):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471671787",
      "id" : 471671787,
      "in_reply_to_id" : 471318931,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY3MTc4Nw==",
      "original_commit_id" : "6c5733c796ac02da4c0b45a373007f3e453479e3",
      "original_line" : 32,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "test/functional/p2p_leak.py",
      "position" : null,
      "pull_request_review_id" : 468708218,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-18T20:14:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471671787",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471671856"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471671856"
         }
      },
      "author_association" : "NONE",
      "body" : "Nice catch. Thank you!",
      "commit_id" : "ed5cd12869e0691a785199d2d977ce5879095180",
      "created_at" : "2020-08-17T18:12:16Z",
      "diff_hunk" : "@@ -64,28 +65,15 @@ def on_getblocktxn(self, message): self.bad_message(message)\n     def on_blocktxn(self, message): self.bad_message(message)\n \n \n-# Node that never sends a version. We'll use this to send a bunch of messages\n-# anyway, and eventually get disconnected.\n-class CNodeNoVersionMisbehavior(CLazyNode):\n-    pass\n-\n-\n-# Node that never sends a version. This one just sits idle and hopes to receive\n-# any message (it shouldn't!)\n-class CNodeNoVersionIdle(CLazyNode):\n-    def __init__(self):\n-        super().__init__()\n-\n-\n-# Node that sends a version but not a verack.\n-class CNodeNoVerackIdle(CLazyNode):\n+# Peer that sends a version but not a verack.\n+class CNoVerackIdlePeer(CLazyPeer):\n     def __init__(self):\n         self.version_received = False\n         super().__init__()\n \n     def on_verack(self, message): pass\n     # When version is received, don't reply with a verack. Instead, see if the\n-    # node will give us a message that it shouldn't. This is not an exhaustive\n+    # peer will give us a message that it shouldn't. This is not an exhaustive",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471671856",
      "id" : 471671856,
      "in_reply_to_id" : 471318328,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY3MTg1Ng==",
      "original_commit_id" : "6c5733c796ac02da4c0b45a373007f3e453479e3",
      "original_line" : 76,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "test/functional/p2p_leak.py",
      "position" : null,
      "pull_request_review_id" : 468708517,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-18T20:14:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471671856",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@jnewbery Comments addressed. I also increased a `wait_until` timeout in [this commit](https://github.com/bitcoin/bitcoin/pull/19727/commits/23d6ccfaafd4b281169072122c2bd04ebea86d8f) to address [this](https://travis-ci.org/github/bitcoin/bitcoin/jobs/718464987). Please let me know if there is a better way.",
      "created_at" : "2020-08-17T18:23:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19727#issuecomment-675038005",
      "id" : 675038005,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19727",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3NTAzODAwNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-17T18:23:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/675038005",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "The test is [now failing](https://travis-ci.org/github/bitcoin/bitcoin/jobs/718718043) on a different architecture but passing on the one it failed at the [last time](https://travis-ci.org/github/bitcoin/bitcoin/builds/718464981) (before raising the timeout) which I think confirms that it's a Travis CI timeout issue. However, I feel uncertain that just continuing to raise the timeout to reduce test fragility is the path forward. I'm looking for guidance from more experienced contributors.",
      "created_at" : "2020-08-17T21:19:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19727#issuecomment-675121446",
      "id" : 675121446,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19727",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3NTEyMTQ0Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-17T21:19:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/675121446",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471791558"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471791558"
         }
      },
      "author_association" : "MEMBER",
      "body" : "is there a reason this is a `wait_until`? won't this peer start with `ever_connected` as false & here we want to check that it is _still_ false? ",
      "commit_id" : "ed5cd12869e0691a785199d2d977ce5879095180",
      "created_at" : "2020-08-17T21:43:24Z",
      "diff_hunk" : "@@ -106,39 +95,51 @@ def set_test_params(self):\n         self.num_nodes = 1\n \n     def run_test(self):\n-        no_version_disconnect_node = self.nodes[0].add_p2p_connection(\n-            CNodeNoVersionMisbehavior(), send_version=False, wait_for_verack=False)\n-        no_version_idlenode = self.nodes[0].add_p2p_connection(CNodeNoVersionIdle(), send_version=False, wait_for_verack=False)\n-        no_verack_idlenode = self.nodes[0].add_p2p_connection(CNodeNoVerackIdle(), wait_for_verack=False)\n+        # Peer that never sends a version. We will send a bunch of messages\n+        # from this peer anyway and verify eventual disconnection.\n+        no_version_disconnect_peer = self.nodes[0].add_p2p_connection(\n+            LazyPeer(), send_version=False, wait_for_verack=False)\n+\n+        # Another peer that never sends a version, nor any other messages. It shouldn't receive anything from the node.\n+        no_version_idle_peer = self.nodes[0].add_p2p_connection(LazyPeer(), send_version=False, wait_for_verack=False)\n+\n+        # Peer that sends a version but not a verack.\n+        no_verack_idle_peer = self.nodes[0].add_p2p_connection(NoVerackIdlePeer(), wait_for_verack=False)\n \n-        # Send enough veracks without a message to reach the peer discouragement\n-        # threshold. This should get us disconnected.\n+        # Send enough ping messages (any non-version message will do) prior to sending\n+        # version to reach the peer discouragement threshold. This should get us disconnected.\n         for _ in range(DISCOURAGEMENT_THRESHOLD):\n-            no_version_disconnect_node.send_message(msg_verack())\n+            no_version_disconnect_peer.send_message(msg_ping())\n \n-        # Wait until we got the verack in response to the version. Though, don't wait for the other node to receive the\n+        # Wait until we got the verack in response to the version. Though, don't wait for the node to receive the\n         # verack, since we never sent one\n-        no_verack_idlenode.wait_for_verack()\n+        no_verack_idle_peer.wait_for_verack()\n+\n+        wait_until(lambda: no_version_disconnect_peer.ever_connected, timeout=10, lock=mininode_lock)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471791558",
      "id" : 471791558,
      "line" : 117,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTc5MTU1OA==",
      "original_commit_id" : "23d6ccfaafd4b281169072122c2bd04ebea86d8f",
      "original_line" : 117,
      "original_position" : 93,
      "original_start_line" : null,
      "path" : "test/functional/p2p_leak.py",
      "position" : 93,
      "pull_request_review_id" : 468852817,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-18T20:14:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471791558",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471793753"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471793753"
         }
      },
      "author_association" : "MEMBER",
      "body" : "what is the intent behind this assertion? wouldn't another way to check if this was successful to be checked they are no long connected? (which you do below). is the purpose of this `wait_until` to allow for sync to occur before checking they are disconnected, or something else? ",
      "commit_id" : "ed5cd12869e0691a785199d2d977ce5879095180",
      "created_at" : "2020-08-17T21:48:37Z",
      "diff_hunk" : "@@ -106,39 +95,51 @@ def set_test_params(self):\n         self.num_nodes = 1\n \n     def run_test(self):\n-        no_version_disconnect_node = self.nodes[0].add_p2p_connection(\n-            CNodeNoVersionMisbehavior(), send_version=False, wait_for_verack=False)\n-        no_version_idlenode = self.nodes[0].add_p2p_connection(CNodeNoVersionIdle(), send_version=False, wait_for_verack=False)\n-        no_verack_idlenode = self.nodes[0].add_p2p_connection(CNodeNoVerackIdle(), wait_for_verack=False)\n+        # Peer that never sends a version. We will send a bunch of messages\n+        # from this peer anyway and verify eventual disconnection.\n+        no_version_disconnect_peer = self.nodes[0].add_p2p_connection(\n+            LazyPeer(), send_version=False, wait_for_verack=False)\n+\n+        # Another peer that never sends a version, nor any other messages. It shouldn't receive anything from the node.\n+        no_version_idle_peer = self.nodes[0].add_p2p_connection(LazyPeer(), send_version=False, wait_for_verack=False)\n+\n+        # Peer that sends a version but not a verack.\n+        no_verack_idle_peer = self.nodes[0].add_p2p_connection(NoVerackIdlePeer(), wait_for_verack=False)\n \n-        # Send enough veracks without a message to reach the peer discouragement\n-        # threshold. This should get us disconnected.\n+        # Send enough ping messages (any non-version message will do) prior to sending\n+        # version to reach the peer discouragement threshold. This should get us disconnected.\n         for _ in range(DISCOURAGEMENT_THRESHOLD):\n-            no_version_disconnect_node.send_message(msg_verack())\n+            no_version_disconnect_peer.send_message(msg_ping())\n \n-        # Wait until we got the verack in response to the version. Though, don't wait for the other node to receive the\n+        # Wait until we got the verack in response to the version. Though, don't wait for the node to receive the\n         # verack, since we never sent one\n-        no_verack_idlenode.wait_for_verack()\n+        no_verack_idle_peer.wait_for_verack()\n+\n+        wait_until(lambda: no_version_disconnect_peer.ever_connected, timeout=10, lock=mininode_lock)\n+\n+        # Wait until the node receives at least as many pings from no_version_disconnect_peer (peer 0)\n+        # as we sent in the test\n+        wait_until(lambda: self.nodes[0].getpeerinfo()[0]['bytesrecv_per_msg'].get('ping', 0) >=",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471793753",
      "id" : 471793753,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTc5Mzc1Mw==",
      "original_commit_id" : "23d6ccfaafd4b281169072122c2bd04ebea86d8f",
      "original_line" : 122,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "test/functional/p2p_leak.py",
      "position" : null,
      "pull_request_review_id" : 468852817,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-18T20:14:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471793753",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471923102"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471923102"
         }
      },
      "author_association" : "NONE",
      "body" : "@gzhao408 After I added this assertion, the test sporadically failed. You and I discussed it and thought it was perhaps the timeout. But increasing it didn't seem to solve the problem. @amitiuttarwar gave me hints [here](https://github.com/bitcoin/bitcoin/pull/19727#pullrequestreview-468852817). It turns out that occasionally, the peer has been dropped prior to the test making `getpeerinfo` RPC. And at that point, the misbehaving peer isn't even in the peer list.\r\n\r\nSince this particular peer does not do anything else (not even a version call) except overwhelm the node with pings, I think the assertion that makes sure the connection is dropped suffices. Would you agree?",
      "commit_id" : "ed5cd12869e0691a785199d2d977ce5879095180",
      "created_at" : "2020-08-18T05:29:23Z",
      "diff_hunk" : "@@ -106,17 +94,24 @@ def set_test_params(self):\n         self.num_nodes = 1\n \n     def run_test(self):\n+        # Peer that never sends a version. We will send a bunch of messages\n+        # from this node anyway and verify eventual disconnection.\n         no_version_disconnect_node = self.nodes[0].add_p2p_connection(\n-            CNodeNoVersionMisbehavior(), send_version=False, wait_for_verack=False)\n-        no_version_idlenode = self.nodes[0].add_p2p_connection(CNodeNoVersionIdle(), send_version=False, wait_for_verack=False)\n+            CLazyNode(), send_version=False, wait_for_verack=False)\n+\n+        # Another peer that never sends a version. Just sits idle and hopes to receive\n+        # any message (it shouldn't!)\n+        no_version_idlenode = self.nodes[0].add_p2p_connection(CLazyNode(), send_version=False, wait_for_verack=False)\n+\n+        # Peer that sends a version but not a verack.\n         no_verack_idlenode = self.nodes[0].add_p2p_connection(CNodeNoVerackIdle(), wait_for_verack=False)\n \n-        # Send enough veracks without a message to reach the peer discouragement\n-        # threshold. This should get us disconnected.\n+        # Send enough ping messages (any non-version message will do) prior to sending\n+        # version to reach the peer discouragement threshold. This should get us disconnected.\n         for _ in range(DISCOURAGEMENT_THRESHOLD):\n-            no_version_disconnect_node.send_message(msg_verack())\n+            no_version_disconnect_node.send_message(msg_ping())\n ",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471923102",
      "id" : 471923102,
      "in_reply_to_id" : 471157548,
      "line" : 112,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTkyMzEwMg==",
      "original_commit_id" : "43986d9a78d799499b51ca6d743c429faea41ad0",
      "original_line" : 112,
      "original_position" : 69,
      "original_start_line" : null,
      "path" : "test/functional/p2p_leak.py",
      "position" : 83,
      "pull_request_review_id" : 469000800,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-18T20:14:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471923102",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471925534"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471925534"
         }
      },
      "author_association" : "NONE",
      "body" : "The peer does start with `ever_connected` set to `False`. Then, if I understand things correctly, when the tcp connection is established, `mininode.py::P2PConnection::connection_made()` will invoke `p2p_leak.py::LazyPeer::on_open()` which will set `no_version_disconnect_peer.ever_connected` to `True`. So I think this `wait_until` is waiting for the transport connection to be established prior to generating a block below. This way it can verify that the peers do not receive leaked information _despite_ an established tcp connection, and not because of connection problems.\r\n\r\nAm I missing something?",
      "commit_id" : "ed5cd12869e0691a785199d2d977ce5879095180",
      "created_at" : "2020-08-18T05:37:27Z",
      "diff_hunk" : "@@ -106,39 +95,51 @@ def set_test_params(self):\n         self.num_nodes = 1\n \n     def run_test(self):\n-        no_version_disconnect_node = self.nodes[0].add_p2p_connection(\n-            CNodeNoVersionMisbehavior(), send_version=False, wait_for_verack=False)\n-        no_version_idlenode = self.nodes[0].add_p2p_connection(CNodeNoVersionIdle(), send_version=False, wait_for_verack=False)\n-        no_verack_idlenode = self.nodes[0].add_p2p_connection(CNodeNoVerackIdle(), wait_for_verack=False)\n+        # Peer that never sends a version. We will send a bunch of messages\n+        # from this peer anyway and verify eventual disconnection.\n+        no_version_disconnect_peer = self.nodes[0].add_p2p_connection(\n+            LazyPeer(), send_version=False, wait_for_verack=False)\n+\n+        # Another peer that never sends a version, nor any other messages. It shouldn't receive anything from the node.\n+        no_version_idle_peer = self.nodes[0].add_p2p_connection(LazyPeer(), send_version=False, wait_for_verack=False)\n+\n+        # Peer that sends a version but not a verack.\n+        no_verack_idle_peer = self.nodes[0].add_p2p_connection(NoVerackIdlePeer(), wait_for_verack=False)\n \n-        # Send enough veracks without a message to reach the peer discouragement\n-        # threshold. This should get us disconnected.\n+        # Send enough ping messages (any non-version message will do) prior to sending\n+        # version to reach the peer discouragement threshold. This should get us disconnected.\n         for _ in range(DISCOURAGEMENT_THRESHOLD):\n-            no_version_disconnect_node.send_message(msg_verack())\n+            no_version_disconnect_peer.send_message(msg_ping())\n \n-        # Wait until we got the verack in response to the version. Though, don't wait for the other node to receive the\n+        # Wait until we got the verack in response to the version. Though, don't wait for the node to receive the\n         # verack, since we never sent one\n-        no_verack_idlenode.wait_for_verack()\n+        no_verack_idle_peer.wait_for_verack()\n+\n+        wait_until(lambda: no_version_disconnect_peer.ever_connected, timeout=10, lock=mininode_lock)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471925534",
      "id" : 471925534,
      "in_reply_to_id" : 471791558,
      "line" : 117,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTkyNTUzNA==",
      "original_commit_id" : "23d6ccfaafd4b281169072122c2bd04ebea86d8f",
      "original_line" : 117,
      "original_position" : 93,
      "original_start_line" : null,
      "path" : "test/functional/p2p_leak.py",
      "position" : 93,
      "pull_request_review_id" : 469003635,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-18T20:14:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471925534",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471926565"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471926565"
         }
      },
      "author_association" : "NONE",
      "body" : "Removed this assertion. Thank you for the hints. I learnt that occasionally the misbehaving peer is removed before this assertion even runs, and so the assertion fails. Since this peer does nothing else except send a 100 pings, i think it suffices to check they are no longer connected (we also check that they did connect at first).",
      "commit_id" : "ed5cd12869e0691a785199d2d977ce5879095180",
      "created_at" : "2020-08-18T05:40:54Z",
      "diff_hunk" : "@@ -106,39 +95,51 @@ def set_test_params(self):\n         self.num_nodes = 1\n \n     def run_test(self):\n-        no_version_disconnect_node = self.nodes[0].add_p2p_connection(\n-            CNodeNoVersionMisbehavior(), send_version=False, wait_for_verack=False)\n-        no_version_idlenode = self.nodes[0].add_p2p_connection(CNodeNoVersionIdle(), send_version=False, wait_for_verack=False)\n-        no_verack_idlenode = self.nodes[0].add_p2p_connection(CNodeNoVerackIdle(), wait_for_verack=False)\n+        # Peer that never sends a version. We will send a bunch of messages\n+        # from this peer anyway and verify eventual disconnection.\n+        no_version_disconnect_peer = self.nodes[0].add_p2p_connection(\n+            LazyPeer(), send_version=False, wait_for_verack=False)\n+\n+        # Another peer that never sends a version, nor any other messages. It shouldn't receive anything from the node.\n+        no_version_idle_peer = self.nodes[0].add_p2p_connection(LazyPeer(), send_version=False, wait_for_verack=False)\n+\n+        # Peer that sends a version but not a verack.\n+        no_verack_idle_peer = self.nodes[0].add_p2p_connection(NoVerackIdlePeer(), wait_for_verack=False)\n \n-        # Send enough veracks without a message to reach the peer discouragement\n-        # threshold. This should get us disconnected.\n+        # Send enough ping messages (any non-version message will do) prior to sending\n+        # version to reach the peer discouragement threshold. This should get us disconnected.\n         for _ in range(DISCOURAGEMENT_THRESHOLD):\n-            no_version_disconnect_node.send_message(msg_verack())\n+            no_version_disconnect_peer.send_message(msg_ping())\n \n-        # Wait until we got the verack in response to the version. Though, don't wait for the other node to receive the\n+        # Wait until we got the verack in response to the version. Though, don't wait for the node to receive the\n         # verack, since we never sent one\n-        no_verack_idlenode.wait_for_verack()\n+        no_verack_idle_peer.wait_for_verack()\n+\n+        wait_until(lambda: no_version_disconnect_peer.ever_connected, timeout=10, lock=mininode_lock)\n+\n+        # Wait until the node receives at least as many pings from no_version_disconnect_peer (peer 0)\n+        # as we sent in the test\n+        wait_until(lambda: self.nodes[0].getpeerinfo()[0]['bytesrecv_per_msg'].get('ping', 0) >=",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r471926565",
      "id" : 471926565,
      "in_reply_to_id" : 471793753,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTkyNjU2NQ==",
      "original_commit_id" : "23d6ccfaafd4b281169072122c2bd04ebea86d8f",
      "original_line" : 122,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "test/functional/p2p_leak.py",
      "position" : null,
      "pull_request_review_id" : 469004923,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-18T20:14:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471926565",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Thanks for the great review, @amitiuttarwar. I appreciate you taking the time to teach me with hints rather than giving out the answer. I've removed the assertion and made the changes to the commit messages. I had some trouble running `test/lint/commit-script-check.sh` locally so I am going to look more into that in the morning.",
      "created_at" : "2020-08-18T05:44:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19727#issuecomment-675265128",
      "id" : 675265128,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19727",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3NTI2NTEyOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-18T05:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/675265128",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK\r\n\r\nWarm welcome as a contributor @dhruv! Hope to see more contributions from you in the future :)",
      "created_at" : "2020-08-18T07:36:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19727#issuecomment-675312044",
      "id" : 675312044,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19727",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3NTMxMjA0NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-18T07:36:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/675312044",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r472088773"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472088773"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No longer used.",
      "commit_id" : "ed5cd12869e0691a785199d2d977ce5879095180",
      "created_at" : "2020-08-18T10:51:09Z",
      "diff_hunk" : "@@ -27,9 +26,10 @@\n )\n \n DISCOURAGEMENT_THRESHOLD = 100\n+PING_MESSAGE_SIZE = 32",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r472088773",
      "id" : 472088773,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjA4ODc3Mw==",
      "original_commit_id" : "54ebddd5471a072dd3bb7129b5df5f0a6fbfa6ce",
      "original_line" : 29,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "test/functional/p2p_leak.py",
      "position" : null,
      "pull_request_review_id" : 469209098,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-18T20:14:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472088773",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r472314244"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472314244"
         }
      },
      "author_association" : "NONE",
      "body" : "Thank you for the catch.",
      "commit_id" : "ed5cd12869e0691a785199d2d977ce5879095180",
      "created_at" : "2020-08-18T16:11:05Z",
      "diff_hunk" : "@@ -27,9 +26,10 @@\n )\n \n DISCOURAGEMENT_THRESHOLD = 100\n+PING_MESSAGE_SIZE = 32",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r472314244",
      "id" : 472314244,
      "in_reply_to_id" : 472088773,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjMxNDI0NA==",
      "original_commit_id" : "54ebddd5471a072dd3bb7129b5df5f0a6fbfa6ce",
      "original_line" : 29,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "test/functional/p2p_leak.py",
      "position" : null,
      "pull_request_review_id" : 469610519,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-18T20:14:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472314244",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@jnewbery commits squashed",
      "created_at" : "2020-08-18T16:11:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19727#issuecomment-675572815",
      "id" : 675572815,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19727",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3NTU3MjgxNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-18T16:11:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/675572815",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r472421498"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472421498"
         }
      },
      "author_association" : "MEMBER",
      "body" : "oops. Something seems to have gone wrong with the rebase here. You've changed these lines in the first commit (_test: remove `CNodeNoVersionMisbehavior` from p2p_leak.py _), but the names are only changed above in the third commit (_test: Distinguish between nodes(bitcoind) and peers(mininodes) in p2p_leak.py_), which means that the test fails for the first two commits. We try to make all of our commits clean so that tools like git bisect work.",
      "commit_id" : "ed5cd12869e0691a785199d2d977ce5879095180",
      "created_at" : "2020-08-18T19:13:06Z",
      "diff_hunk" : "@@ -106,39 +94,45 @@ def set_test_params(self):\n         self.num_nodes = 1\n \n     def run_test(self):\n-        no_version_disconnect_node = self.nodes[0].add_p2p_connection(\n-            CNodeNoVersionMisbehavior(), send_version=False, wait_for_verack=False)\n-        no_version_idlenode = self.nodes[0].add_p2p_connection(CNodeNoVersionIdle(), send_version=False, wait_for_verack=False)\n-        no_verack_idlenode = self.nodes[0].add_p2p_connection(CNodeNoVerackIdle(), wait_for_verack=False)\n+        # Peer that never sends a version. We will send a bunch of messages\n+        # from this peer anyway and verify eventual disconnection.\n+        no_version_disconnect_peer = self.nodes[0].add_p2p_connection(\n+            LazyPeer(), send_version=False, wait_for_verack=False)\n+\n+        # Another peer that never sends a version, nor any other messages. It shouldn't receive anything from the node.\n+        no_version_idle_peer = self.nodes[0].add_p2p_connection(LazyPeer(), send_version=False, wait_for_verack=False)\n+\n+        # Peer that sends a version but not a verack.\n+        no_verack_idle_peer = self.nodes[0].add_p2p_connection(NoVerackIdlePeer(), wait_for_verack=False)\n \n-        # Send enough veracks without a message to reach the peer discouragement\n-        # threshold. This should get us disconnected.\n+        # Send enough ping messages (any non-version message will do) prior to sending\n+        # version to reach the peer discouragement threshold. This should get us disconnected.\n         for _ in range(DISCOURAGEMENT_THRESHOLD):\n-            no_version_disconnect_node.send_message(msg_verack())\n+            no_version_disconnect_peer.send_message(msg_ping())\n \n-        # Wait until we got the verack in response to the version. Though, don't wait for the other node to receive the\n+        # Wait until we got the verack in response to the version. Though, don't wait for the node to receive the\n         # verack, since we never sent one\n-        no_verack_idlenode.wait_for_verack()\n+        no_verack_idle_peer.wait_for_verack()\n \n-        wait_until(lambda: no_version_disconnect_node.ever_connected, timeout=10, lock=mininode_lock)\n-        wait_until(lambda: no_version_idlenode.ever_connected, timeout=10, lock=mininode_lock)\n-        wait_until(lambda: no_verack_idlenode.version_received, timeout=10, lock=mininode_lock)\n+        wait_until(lambda: no_version_disconnect_peer.ever_connected, timeout=10, lock=mininode_lock)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r472421498",
      "id" : 472421498,
      "line" : 117,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQyMTQ5OA==",
      "original_commit_id" : "5187e84784dca2d4e89da513f6444b136d096867",
      "original_line" : 117,
      "original_position" : 93,
      "original_start_line" : null,
      "path" : "test/functional/p2p_leak.py",
      "position" : 93,
      "pull_request_review_id" : 469748231,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-18T20:14:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472421498",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r472435194"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472435194"
         }
      },
      "author_association" : "MEMBER",
      "body" : "oh I'm sorry, I mixed up true and false ð \r\nyes this makes sense- we want to check that `ever_connected` has been switched to true, and allow some buffer time for that to occur.",
      "commit_id" : "ed5cd12869e0691a785199d2d977ce5879095180",
      "created_at" : "2020-08-18T19:38:34Z",
      "diff_hunk" : "@@ -106,39 +95,51 @@ def set_test_params(self):\n         self.num_nodes = 1\n \n     def run_test(self):\n-        no_version_disconnect_node = self.nodes[0].add_p2p_connection(\n-            CNodeNoVersionMisbehavior(), send_version=False, wait_for_verack=False)\n-        no_version_idlenode = self.nodes[0].add_p2p_connection(CNodeNoVersionIdle(), send_version=False, wait_for_verack=False)\n-        no_verack_idlenode = self.nodes[0].add_p2p_connection(CNodeNoVerackIdle(), wait_for_verack=False)\n+        # Peer that never sends a version. We will send a bunch of messages\n+        # from this peer anyway and verify eventual disconnection.\n+        no_version_disconnect_peer = self.nodes[0].add_p2p_connection(\n+            LazyPeer(), send_version=False, wait_for_verack=False)\n+\n+        # Another peer that never sends a version, nor any other messages. It shouldn't receive anything from the node.\n+        no_version_idle_peer = self.nodes[0].add_p2p_connection(LazyPeer(), send_version=False, wait_for_verack=False)\n+\n+        # Peer that sends a version but not a verack.\n+        no_verack_idle_peer = self.nodes[0].add_p2p_connection(NoVerackIdlePeer(), wait_for_verack=False)\n \n-        # Send enough veracks without a message to reach the peer discouragement\n-        # threshold. This should get us disconnected.\n+        # Send enough ping messages (any non-version message will do) prior to sending\n+        # version to reach the peer discouragement threshold. This should get us disconnected.\n         for _ in range(DISCOURAGEMENT_THRESHOLD):\n-            no_version_disconnect_node.send_message(msg_verack())\n+            no_version_disconnect_peer.send_message(msg_ping())\n \n-        # Wait until we got the verack in response to the version. Though, don't wait for the other node to receive the\n+        # Wait until we got the verack in response to the version. Though, don't wait for the node to receive the\n         # verack, since we never sent one\n-        no_verack_idlenode.wait_for_verack()\n+        no_verack_idle_peer.wait_for_verack()\n+\n+        wait_until(lambda: no_version_disconnect_peer.ever_connected, timeout=10, lock=mininode_lock)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r472435194",
      "id" : 472435194,
      "in_reply_to_id" : 471791558,
      "line" : 117,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQzNTE5NA==",
      "original_commit_id" : "23d6ccfaafd4b281169072122c2bd04ebea86d8f",
      "original_line" : 117,
      "original_position" : 93,
      "original_start_line" : null,
      "path" : "test/functional/p2p_leak.py",
      "position" : 93,
      "pull_request_review_id" : 469765503,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-18T20:14:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472435194",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r472454764"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472454764"
         }
      },
      "author_association" : "NONE",
      "body" : "Thank you, @jnewbery. I learnt to:\r\n1. Not rebase latest master every round of review\r\n2. Make sure tests pass on every commit\r\n\r\nI have pushed up fixed commits.\r\n\r\n",
      "commit_id" : "ed5cd12869e0691a785199d2d977ce5879095180",
      "created_at" : "2020-08-18T20:10:42Z",
      "diff_hunk" : "@@ -106,39 +94,45 @@ def set_test_params(self):\n         self.num_nodes = 1\n \n     def run_test(self):\n-        no_version_disconnect_node = self.nodes[0].add_p2p_connection(\n-            CNodeNoVersionMisbehavior(), send_version=False, wait_for_verack=False)\n-        no_version_idlenode = self.nodes[0].add_p2p_connection(CNodeNoVersionIdle(), send_version=False, wait_for_verack=False)\n-        no_verack_idlenode = self.nodes[0].add_p2p_connection(CNodeNoVerackIdle(), wait_for_verack=False)\n+        # Peer that never sends a version. We will send a bunch of messages\n+        # from this peer anyway and verify eventual disconnection.\n+        no_version_disconnect_peer = self.nodes[0].add_p2p_connection(\n+            LazyPeer(), send_version=False, wait_for_verack=False)\n+\n+        # Another peer that never sends a version, nor any other messages. It shouldn't receive anything from the node.\n+        no_version_idle_peer = self.nodes[0].add_p2p_connection(LazyPeer(), send_version=False, wait_for_verack=False)\n+\n+        # Peer that sends a version but not a verack.\n+        no_verack_idle_peer = self.nodes[0].add_p2p_connection(NoVerackIdlePeer(), wait_for_verack=False)\n \n-        # Send enough veracks without a message to reach the peer discouragement\n-        # threshold. This should get us disconnected.\n+        # Send enough ping messages (any non-version message will do) prior to sending\n+        # version to reach the peer discouragement threshold. This should get us disconnected.\n         for _ in range(DISCOURAGEMENT_THRESHOLD):\n-            no_version_disconnect_node.send_message(msg_verack())\n+            no_version_disconnect_peer.send_message(msg_ping())\n \n-        # Wait until we got the verack in response to the version. Though, don't wait for the other node to receive the\n+        # Wait until we got the verack in response to the version. Though, don't wait for the node to receive the\n         # verack, since we never sent one\n-        no_verack_idlenode.wait_for_verack()\n+        no_verack_idle_peer.wait_for_verack()\n \n-        wait_until(lambda: no_version_disconnect_node.ever_connected, timeout=10, lock=mininode_lock)\n-        wait_until(lambda: no_version_idlenode.ever_connected, timeout=10, lock=mininode_lock)\n-        wait_until(lambda: no_verack_idlenode.version_received, timeout=10, lock=mininode_lock)\n+        wait_until(lambda: no_version_disconnect_peer.ever_connected, timeout=10, lock=mininode_lock)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19727#discussion_r472454764",
      "id" : 472454764,
      "in_reply_to_id" : 472421498,
      "line" : 117,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQ1NDc2NA==",
      "original_commit_id" : "5187e84784dca2d4e89da513f6444b136d096867",
      "original_line" : 117,
      "original_position" : 93,
      "original_start_line" : null,
      "path" : "test/functional/p2p_leak.py",
      "position" : 93,
      "pull_request_review_id" : 469795626,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19727",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-18T20:14:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472454764",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "tested ACK ed5cd12869e0691a785199d2d977ce5879095180",
      "created_at" : "2020-08-19T08:46:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19727#issuecomment-675964455",
      "id" : 675964455,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19727",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3NTk2NDQ1NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-19T08:46:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/675964455",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK ed5cd12869",
      "created_at" : "2020-08-19T23:02:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19727#issuecomment-676798566",
      "id" : 676798566,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19727",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3Njc5ODU2Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-19T23:02:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/676798566",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   }
]
