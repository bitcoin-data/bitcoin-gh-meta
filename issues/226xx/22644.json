{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "MEMBER",
   "body" : "#18077 introduced support for [NAT-PMP](https://github.com/miniupnp/libnatpmp), but didn't present any sort of deprecation plan for moving away from UPNP. This means for 22.x we are supporting both. I don't think Bitcoin Core should be actively supporting two different mechanisms (and thus two different dependencies) to essentially achieve the same outcome (NAT traversal); especially given our history with miniupnpc.\r\n\r\nMy suggestion for 23.x, is to atleast mark support for upnp as deprecated, and at the same time, increase the minimum required version to 2.1 (2018, API version 17). This means we can exclude building against older, broken/vulnerable versions of the library, and at the same time, can use pkg-config to check for availability. This will also avoid the need to add more platform specific code for miniupnpc i.e #22397. I am planning to add pkg-config support to upstream libnatpmp.\r\n\r\nAs a result, some system packages of miniupnpc will be unusable (i.e Debian Oldstable, and Ubuntu 18.04 only package 1.9). However, by the time 23.0 is released, oldstable will be months from the end of it's [LTS (June 2022)](https://www.debian.org/releases/stretch/). I also think there is much less of a need for us to continue supporting older system packages when there is a alternative feature available.\r\n\r\nAnyone compiling from source also has the option to use depends, or, if they really want to go out of their way to use an older version of miniupnpc, they could always make some small changes to our source.  Supporting older, potentially broken versions of dependencies that are being deprecated is not something that Bitcoin Core should have to actively do. \r\n\r\nUsing upnp by default has been disabled since [0.11.1](https://bitcoin.org/en/release/v0.11.1), which was released with an updated version of miniupnp, to fix a buffer overflow in its XML parsing. At the same time, using upnp was disabled by default to prevent future vulnerabilities from potentially effecting the network at large. Note that even recent versions of miniupnpc contain (public) bugs that could be used to detrimentally effect a Bitcoin Core node.\r\n\r\nThe readme addition can be expanded when the notes are put together prior to the 23.x release. One thing we could also do, is mention that upnp support is now deprecated, even as part of the 22.x release notes.\r\n\r\nminiupnp - implementation of [UPnP](https://en.wikipedia.org/wiki/Universal_Plug_and_Play) (Universal Plug and Play)\r\n- NAT traversal implemented via [IGD](https://en.wikipedia.org/wiki/Internet_Gateway_Device_Protocol) (Internet Gateway Device Standardised Control Protocol)\r\n- Not only does UPnP in have many issues in general, IGD has some issues of it's own.\r\n\r\nlibnatpmp - implementation of [NAT-PMP](https://datatracker.ietf.org/doc/html/rfc6886) (alternative to IGD)\r\n- NAT traversal\r\n- Maintained by the same author as miniupnp.\r\n\r\nNAT-PMP has been succeeded by PCP ([Port Control Protocol](https://datatracker.ietf.org/doc/html/rfc6887)). However the two protocols share similar semantics, and thus, devices that implement PCP are interoperable with devices using NAT-PMP. See [NAT-PMP Transition](https://datatracker.ietf.org/doc/html/rfc6887#appendix-A).\r\n\r\n\r\nIt's an unfortunate combination of how distros work, and the upstream maintainership of libnatpmp, that most distros are using a version of the source released in 2015, which is missing a number of bug fixes and improvements, and they may actually be using an even earlier version of the source, unknowingly, due to tarball mis-naming (see #21209).",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 0,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22644/comments",
   "created_at" : "2021-08-06T00:06:45Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22644/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/22644",
   "id" : 962283392,
   "labels" : [
      {
         "color" : "5319e7",
         "default" : false,
         "description" : null,
         "id" : 61889416,
         "name" : "Build system",
         "node_id" : "MDU6TGFiZWw2MTg4OTQxNg==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Build%20system"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22644/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDExOlB1bGxSZXF1ZXN0NzA1MDk4NDQ2",
   "number" : 22644,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/22644.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22644",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/22644.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22644"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "Deprecate UPnP support, require 2.1 or later",
   "updated_at" : "2021-08-06T01:06:28Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22644",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
      "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
      "followers_url" : "https://api.github.com/users/fanquake/followers",
      "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/fanquake",
      "id" : 863730,
      "login" : "fanquake",
      "node_id" : "MDQ6VXNlcjg2MzczMA==",
      "organizations_url" : "https://api.github.com/users/fanquake/orgs",
      "received_events_url" : "https://api.github.com/users/fanquake/received_events",
      "repos_url" : "https://api.github.com/users/fanquake/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/fanquake"
   }
}
