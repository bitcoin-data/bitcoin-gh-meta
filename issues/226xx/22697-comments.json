[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK \r\n\r\nThanks for splitting up the changes!",
      "created_at" : "2021-08-13T12:34:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#issuecomment-898427713",
      "id" : 898427713,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22697",
      "node_id" : "IC_kwDOABII5841jOtB",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-13T12:37:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/898427713",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23586626?v=4",
         "events_url" : "https://api.github.com/users/Zero-1729/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Zero-1729/followers",
         "following_url" : "https://api.github.com/users/Zero-1729/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Zero-1729/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Zero-1729",
         "id" : 23586626,
         "login" : "Zero-1729",
         "node_id" : "MDQ6VXNlcjIzNTg2NjI2",
         "organizations_url" : "https://api.github.com/users/Zero-1729/orgs",
         "received_events_url" : "https://api.github.com/users/Zero-1729/received_events",
         "repos_url" : "https://api.github.com/users/Zero-1729/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Zero-1729/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Zero-1729/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Zero-1729"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r688524323"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/688524323"
         }
      },
      "author_association" : "MEMBER",
      "body" : "a8bad2e16ed41c8d9 nit, prefer prefix iterator\r\n```suggestion\r\n    for (size_t i{0}; i < addrman_count; ++i) {\r\n```",
      "commit_id" : "70147fe0e3e65e28049e9c6171758615e4387119",
      "created_at" : "2021-08-13T13:42:55Z",
      "diff_hunk" : "@@ -70,13 +70,22 @@ static void FillAddrMan(CAddrMan& addrman)\n \n static void AddrManAdd(benchmark::Bench& bench)\n {\n-    CreateAddresses();\n+     /* Create many CAddrMan objects - one to be modified at each loop iteration. */\n \n-    CAddrMan addrman(/* deterministic */ false, /* consistency_check_ratio */ 0);\n+    bench.epochs(5).epochIterations(1);\n+    size_t addrman_count = bench.epochs() * bench.epochIterations();\n \n+    std::vector<std::unique_ptr<CAddrMan>> addrmans(addrman_count);\n+    for (size_t i{0}; i < addrman_count; i++) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r688524323",
      "id" : 688524323,
      "line" : 79,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4ODUyNDMyMw==",
      "original_commit_id" : "70147fe0e3e65e28049e9c6171758615e4387119",
      "original_line" : 79,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/bench/addrman.cpp",
      "position" : 12,
      "pull_request_review_id" : 729630877,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-13T14:16:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/688524323",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r688544764"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/688544764"
         }
      },
      "author_association" : "MEMBER",
      "body" : "commas first... :eyes: it has a certain symmetry with the colon though",
      "commit_id" : "70147fe0e3e65e28049e9c6171758615e4387119",
      "created_at" : "2021-08-13T14:10:29Z",
      "diff_hunk" : "@@ -77,6 +77,23 @@ double CAddrInfo::GetChance(int64_t nNow) const\n     return fChance;\n }\n \n+CAddrMan::CAddrMan(bool deterministic, int32_t consistency_check_ratio)\n+    : insecure_rand{deterministic}\n+    , nKey{deterministic ? uint256{1} : insecure_rand.rand256()}\n+    , m_consistency_check_ratio{consistency_check_ratio}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r688544764",
      "id" : 688544764,
      "line" : 83,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4ODU0NDc2NA==",
      "original_commit_id" : "70147fe0e3e65e28049e9c6171758615e4387119",
      "original_line" : 83,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 7,
      "pull_request_review_id" : 729630877,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-13T14:17:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/688544764",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.",
      "created_at" : "2021-08-13T14:15:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#issuecomment-898489060",
      "id" : 898489060,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22697",
      "node_id" : "IC_kwDOABII5841jdrk",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-19T09:00:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/898489060",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2021-08-13T14:19:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#issuecomment-898491499",
      "id" : 898491499,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22697",
      "node_id" : "IC_kwDOABII5841jeRr",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-13T14:19:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/898491499",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "concept ACK ",
      "created_at" : "2021-08-14T00:54:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#issuecomment-898784453",
      "id" : 898784453,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22697",
      "node_id" : "IC_kwDOABII5841klzF",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-14T00:54:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/898784453",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2021-08-15T18:33:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#issuecomment-899092918",
      "id" : 899092918,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22697",
      "node_id" : "IC_kwDOABII5841lxG2",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-15T18:33:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/899092918",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-08-17T03:13:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#issuecomment-899960909",
      "id" : 899960909,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22697",
      "node_id" : "IC_kwDOABII5841pFBN",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-17T03:13:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/899960909",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "rebased on master",
      "created_at" : "2021-08-17T08:48:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#issuecomment-900113407",
      "id" : 900113407,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22697",
      "node_id" : "IC_kwDOABII5841pqP_",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-17T08:48:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/900113407",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-08-18T02:09:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#issuecomment-900757051",
      "id" : 900757051,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22697",
      "node_id" : "IC_kwDOABII5841sHY7",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-18T02:09:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/900757051",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r690921078"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/690921078"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should this message move too?",
      "commit_id" : "fdf05e7d96845ea17213fba0ef39231caa67e329",
      "created_at" : "2021-08-18T05:51:30Z",
      "diff_hunk" : "@@ -2534,18 +2534,6 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n     if (clientInterface) {\n         clientInterface->InitMessage(_(\"Loading P2P addressesâ¦\").translated);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r690921078",
      "id" : 690921078,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MDkyMTA3OA==",
      "original_commit_id" : "74fb306b58e1a6de0746eea6e7e9bc718a08e498",
      "original_line" : 2535,
      "original_position" : 2,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 732456082,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-18T06:00:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/690921078",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r690923912"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/690923912"
         }
      },
      "author_association" : "MEMBER",
      "body" : "What is \"never\"? ",
      "commit_id" : "fdf05e7d96845ea17213fba0ef39231caa67e329",
      "created_at" : "2021-08-18T05:58:24Z",
      "diff_hunk" : "@@ -672,19 +640,19 @@ class CAddrMan\n     mutable std::vector<int> vRandom GUARDED_BY(cs);\n \n     // number of \"tried\" entries\n-    int nTried GUARDED_BY(cs);\n+    int nTried GUARDED_BY(cs){0};\n \n     //! list of \"tried\" buckets\n     int vvTried[ADDRMAN_TRIED_BUCKET_COUNT][ADDRMAN_BUCKET_SIZE] GUARDED_BY(cs);\n \n     //! number of (unique) \"new\" entries\n-    int nNew GUARDED_BY(cs);\n+    int nNew GUARDED_BY(cs){0};\n \n     //! list of \"new\" buckets\n     int vvNew[ADDRMAN_NEW_BUCKET_COUNT][ADDRMAN_BUCKET_SIZE] GUARDED_BY(cs);\n \n-    //! last time Good was called (memory only)\n-    int64_t nLastGood GUARDED_BY(cs);\n+    //! last time Good was called (memory only). Initially set to 1 so that \"never\" is strictly worse.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r690923912",
      "id" : 690923912,
      "line" : 654,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MDkyMzkxMg==",
      "original_commit_id" : "74fb306b58e1a6de0746eea6e7e9bc718a08e498",
      "original_line" : 654,
      "original_position" : 90,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 90,
      "pull_request_review_id" : 732456082,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-18T06:00:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/690923912",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691015313"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691015313"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes! Thanks. Moved.",
      "commit_id" : "fdf05e7d96845ea17213fba0ef39231caa67e329",
      "created_at" : "2021-08-18T08:23:28Z",
      "diff_hunk" : "@@ -2534,18 +2534,6 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n     if (clientInterface) {\n         clientInterface->InitMessage(_(\"Loading P2P addressesâ¦\").translated);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691015313",
      "id" : 691015313,
      "in_reply_to_id" : 690921078,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MTAxNTMxMw==",
      "original_commit_id" : "74fb306b58e1a6de0746eea6e7e9bc718a08e498",
      "original_line" : 2535,
      "original_position" : 2,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 732574413,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-18T08:23:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691015313",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691019487"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691019487"
         }
      },
      "author_association" : "MEMBER",
      "body" : "'never' means that `Good()` has not been called since the CAddrMan object was constructed. I moved this comment from the constructor (where `nLastGood` was previously being set) to the member declaration (which now has a default initialization value).",
      "commit_id" : "fdf05e7d96845ea17213fba0ef39231caa67e329",
      "created_at" : "2021-08-18T08:28:54Z",
      "diff_hunk" : "@@ -672,19 +640,19 @@ class CAddrMan\n     mutable std::vector<int> vRandom GUARDED_BY(cs);\n \n     // number of \"tried\" entries\n-    int nTried GUARDED_BY(cs);\n+    int nTried GUARDED_BY(cs){0};\n \n     //! list of \"tried\" buckets\n     int vvTried[ADDRMAN_TRIED_BUCKET_COUNT][ADDRMAN_BUCKET_SIZE] GUARDED_BY(cs);\n \n     //! number of (unique) \"new\" entries\n-    int nNew GUARDED_BY(cs);\n+    int nNew GUARDED_BY(cs){0};\n \n     //! list of \"new\" buckets\n     int vvNew[ADDRMAN_NEW_BUCKET_COUNT][ADDRMAN_BUCKET_SIZE] GUARDED_BY(cs);\n \n-    //! last time Good was called (memory only)\n-    int64_t nLastGood GUARDED_BY(cs);\n+    //! last time Good was called (memory only). Initially set to 1 so that \"never\" is strictly worse.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691019487",
      "id" : 691019487,
      "in_reply_to_id" : 690923912,
      "line" : 654,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MTAxOTQ4Nw==",
      "original_commit_id" : "74fb306b58e1a6de0746eea6e7e9bc718a08e498",
      "original_line" : 654,
      "original_position" : 90,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 90,
      "pull_request_review_id" : 732579841,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-18T08:28:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691019487",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691020686"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691020686"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "fdf05e7d96845ea17213fba0ef39231caa67e329",
      "created_at" : "2021-08-18T08:30:19Z",
      "diff_hunk" : "@@ -70,13 +70,22 @@ static void FillAddrMan(CAddrMan& addrman)\n \n static void AddrManAdd(benchmark::Bench& bench)\n {\n-    CreateAddresses();\n+     /* Create many CAddrMan objects - one to be modified at each loop iteration. */\n \n-    CAddrMan addrman(/* deterministic */ false, /* consistency_check_ratio */ 0);\n+    bench.epochs(5).epochIterations(1);\n+    size_t addrman_count = bench.epochs() * bench.epochIterations();\n \n+    std::vector<std::unique_ptr<CAddrMan>> addrmans(addrman_count);\n+    for (size_t i{0}; i < addrman_count; i++) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691020686",
      "id" : 691020686,
      "in_reply_to_id" : 688524323,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MTAyMDY4Ng==",
      "original_commit_id" : "70147fe0e3e65e28049e9c6171758615e4387119",
      "original_line" : 79,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/bench/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 732581270,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-18T08:30:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691020686",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased on master and addressed review comments from @jonatack and @fanquake.",
      "created_at" : "2021-08-18T08:30:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#issuecomment-900925684",
      "id" : 900925684,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22697",
      "node_id" : "IC_kwDOABII5841swj0",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-18T08:30:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/900925684",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691029194"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691029194"
         }
      },
      "author_association" : "MEMBER",
      "body" : "is there a reason why you prefer `unique_ptr`? `unique_ptr` will result in a different memory layout, will add an unneeded abstraction and will make the diff larger than needed.\r\n\r\nSimply using a new object worked fine for me:\r\n\r\n```diff\r\ndiff --git a/src/test/addrman_tests.cpp b/src/test/addrman_tests.cpp\r\nindex 3c64461605..67c549689d 100644\r\n--- a/src/test/addrman_tests.cpp\r\n+++ b/src/test/addrman_tests.cpp\r\n@@ -148,18 +148,13 @@ BOOST_AUTO_TEST_CASE(addrman_simple)\r\n     BOOST_CHECK(addrman.Add(CAddress(addr2, NODE_NONE), source));\r\n     BOOST_CHECK(addrman.size() >= 1);\r\n \r\n-    // Test: AddrMan::Clear() should empty the new table.\r\n-    addrman.Clear();\r\n-    BOOST_CHECK_EQUAL(addrman.size(), 0U);\r\n-    CAddrInfo addr_null2 = addrman.Select();\r\n-    BOOST_CHECK_EQUAL(addr_null2.ToString(), \"[::]:0\");\r\n-\r\n     // Test: AddrMan::Add multiple addresses works as expected\r\n+    CAddrManTest addrman2{};\r\n     std::vector<CAddress> vAddr;\r\n     vAddr.push_back(CAddress(ResolveService(\"250.1.1.3\", 8333), NODE_NONE));\r\n     vAddr.push_back(CAddress(ResolveService(\"250.1.1.4\", 8333), NODE_NONE));\r\n-    BOOST_CHECK(addrman.Add(vAddr, source));\r\n-    BOOST_CHECK(addrman.size() >= 1);\r\n+    BOOST_CHECK(addrman2.Add(vAddr, source));\r\n+    BOOST_CHECK(addrman2.size() >= 1);\r\n }\r\n \r\n BOOST_AUTO_TEST_CASE(addrman_ports)\r\n",
      "commit_id" : "fdf05e7d96845ea17213fba0ef39231caa67e329",
      "created_at" : "2021-08-18T08:41:17Z",
      "diff_hunk" : "@@ -205,21 +195,16 @@ BOOST_AUTO_TEST_CASE(addrman_simple)\n     // success.\n \n     CService addr2 = ResolveService(\"250.1.1.2\", 8333);\n-    BOOST_CHECK(addrman.Add({CAddress(addr2, NODE_NONE)}, source));\n-    BOOST_CHECK(addrman.size() >= 1);\n+    BOOST_CHECK(addrman->Add({CAddress(addr2, NODE_NONE)}, source));\n+    BOOST_CHECK(addrman->size() >= 1);\n \n-    // Test: AddrMan::Clear() should empty the new table.\n-    addrman.Clear();\n-    BOOST_CHECK_EQUAL(addrman.size(), 0U);\n-    CAddrInfo addr_null2 = addrman.Select();\n-    BOOST_CHECK_EQUAL(addr_null2.ToString(), \"[::]:0\");\n-\n-    // Test: AddrMan::Add multiple addresses works as expected\n+    // Test: reset addrman and test AddrMan::Add multiple addresses works as expected\n+    addrman = std::make_unique<CAddrManTest>();\n     std::vector<CAddress> vAddr;\n     vAddr.push_back(CAddress(ResolveService(\"250.1.1.3\", 8333), NODE_NONE));\n     vAddr.push_back(CAddress(ResolveService(\"250.1.1.4\", 8333), NODE_NONE));\n-    BOOST_CHECK(addrman.Add(vAddr, source));\n-    BOOST_CHECK(addrman.size() >= 1);\n+    BOOST_CHECK(addrman->Add(vAddr, source));\n+    BOOST_CHECK(addrman->size() >= 1);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691029194",
      "id" : 691029194,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MTAyOTE5NA==",
      "original_commit_id" : "ec132b1f86b19e8a6cc11f6138edeb2655bda80f",
      "original_line" : 207,
      "original_position" : 77,
      "original_start_line" : null,
      "path" : "src/test/addrman_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 732464854,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-18T08:49:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691029194",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691032222"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691032222"
         }
      },
      "author_association" : "MEMBER",
      "body" : "not a huge difference here, but could use `reserve` (optional) and `emplace` to avoid unique_ptr?",
      "commit_id" : "fdf05e7d96845ea17213fba0ef39231caa67e329",
      "created_at" : "2021-08-18T08:45:09Z",
      "diff_hunk" : "@@ -70,13 +70,22 @@ static void FillAddrMan(CAddrMan& addrman)\n \n static void AddrManAdd(benchmark::Bench& bench)\n {\n-    CreateAddresses();\n+     /* Create many CAddrMan objects - one to be modified at each loop iteration. */\n \n-    CAddrMan addrman(/* deterministic */ false, /* consistency_check_ratio */ 0);\n+    bench.epochs(5).epochIterations(1);\n+    size_t addrman_count = bench.epochs() * bench.epochIterations();\n+\n+    std::vector<std::unique_ptr<CAddrMan>> addrmans(addrman_count);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691032222",
      "id" : 691032222,
      "line" : 78,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MTAzMjIyMg==",
      "original_commit_id" : "ec132b1f86b19e8a6cc11f6138edeb2655bda80f",
      "original_line" : 78,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/bench/addrman.cpp",
      "position" : 11,
      "pull_request_review_id" : 732464854,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-18T08:49:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691032222",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691033355"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691033355"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same here? Could use new object with different name or even split the test into two and keep the same name?",
      "commit_id" : "fdf05e7d96845ea17213fba0ef39231caa67e329",
      "created_at" : "2021-08-18T08:46:41Z",
      "diff_hunk" : "@@ -774,63 +759,63 @@ BOOST_AUTO_TEST_CASE(addrman_serialization)\n {\n     std::vector<bool> asmap1 = FromBytes(asmap_raw, sizeof(asmap_raw) * 8);\n \n-    CAddrManTest addrman_asmap1(true, asmap1);\n-    CAddrManTest addrman_asmap1_dup(true, asmap1);\n-    CAddrManTest addrman_noasmap;\n+    auto addrman_asmap1 = std::make_unique<CAddrManTest>(true, asmap1);\n+    auto addrman_asmap1_dup = std::make_unique<CAddrManTest>(true, asmap1);\n+    auto addrman_noasmap = std::make_unique<CAddrManTest>();\n     CDataStream stream(SER_NETWORK, PROTOCOL_VERSION);\n \n     CAddress addr = CAddress(ResolveService(\"250.1.1.1\"), NODE_NONE);\n     CNetAddr default_source;\n \n \n-    addrman_asmap1.Add({addr}, default_source);\n+    addrman_asmap1->Add({addr}, default_source);\n \n-    stream << addrman_asmap1;\n+    stream << *addrman_asmap1;\n     // serizalizing/deserializing addrman with the same asmap\n-    stream >> addrman_asmap1_dup;\n+    stream >> *addrman_asmap1_dup;\n \n-    std::pair<int, int> bucketAndEntry_asmap1 = addrman_asmap1.GetBucketAndEntry(addr);\n-    std::pair<int, int> bucketAndEntry_asmap1_dup = addrman_asmap1_dup.GetBucketAndEntry(addr);\n+    std::pair<int, int> bucketAndEntry_asmap1 = addrman_asmap1->GetBucketAndEntry(addr);\n+    std::pair<int, int> bucketAndEntry_asmap1_dup = addrman_asmap1_dup->GetBucketAndEntry(addr);\n     BOOST_CHECK(bucketAndEntry_asmap1.second != -1);\n     BOOST_CHECK(bucketAndEntry_asmap1_dup.second != -1);\n \n     BOOST_CHECK(bucketAndEntry_asmap1.first == bucketAndEntry_asmap1_dup.first);\n     BOOST_CHECK(bucketAndEntry_asmap1.second == bucketAndEntry_asmap1_dup.second);\n \n     // deserializing asmaped peers.dat to non-asmaped addrman\n-    stream << addrman_asmap1;\n-    stream >> addrman_noasmap;\n-    std::pair<int, int> bucketAndEntry_noasmap = addrman_noasmap.GetBucketAndEntry(addr);\n+    stream << *addrman_asmap1;\n+    stream >> *addrman_noasmap;\n+    std::pair<int, int> bucketAndEntry_noasmap = addrman_noasmap->GetBucketAndEntry(addr);\n     BOOST_CHECK(bucketAndEntry_noasmap.second != -1);\n     BOOST_CHECK(bucketAndEntry_asmap1.first != bucketAndEntry_noasmap.first);\n     BOOST_CHECK(bucketAndEntry_asmap1.second != bucketAndEntry_noasmap.second);\n \n     // deserializing non-asmaped peers.dat to asmaped addrman\n-    addrman_asmap1.Clear();\n-    addrman_noasmap.Clear();\n-    addrman_noasmap.Add({addr}, default_source);\n-    stream << addrman_noasmap;\n-    stream >> addrman_asmap1;\n-    std::pair<int, int> bucketAndEntry_asmap1_deser = addrman_asmap1.GetBucketAndEntry(addr);\n+    addrman_asmap1 = std::make_unique<CAddrManTest>(true, asmap1);\n+    addrman_noasmap = std::make_unique<CAddrManTest>();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691033355",
      "id" : 691033355,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MTAzMzM1NQ==",
      "original_commit_id" : "ec132b1f86b19e8a6cc11f6138edeb2655bda80f",
      "original_line" : 795,
      "original_position" : 135,
      "original_start_line" : null,
      "path" : "src/test/addrman_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 732464854,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-18T08:49:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691033355",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691034731"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691034731"
         }
      },
      "author_association" : "MEMBER",
      "body" : "it might be better to just remove this, as it is equivalent to just starting a fresh fuzz input that fails deser",
      "commit_id" : "fdf05e7d96845ea17213fba0ef39231caa67e329",
      "created_at" : "2021-08-18T08:48:13Z",
      "diff_hunk" : "@@ -228,29 +228,29 @@ FUZZ_TARGET_INIT(addrman, initialize_addrman)\n {\n     FuzzedDataProvider fuzzed_data_provider(buffer.data(), buffer.size());\n     SetMockTime(ConsumeTime(fuzzed_data_provider));\n-    CAddrManDeterministic addr_man{fuzzed_data_provider};\n+    auto addr_man = std::make_unique<CAddrManDeterministic>(fuzzed_data_provider);\n     if (fuzzed_data_provider.ConsumeBool()) {\n         const std::vector<uint8_t> serialized_data{ConsumeRandomLengthByteVector(fuzzed_data_provider)};\n         CDataStream ds(serialized_data, SER_DISK, INIT_PROTO_VERSION);\n         const auto ser_version{fuzzed_data_provider.ConsumeIntegral<int32_t>()};\n         ds.SetVersion(ser_version);\n         try {\n-            ds >> addr_man;\n+            ds >> *addr_man;\n         } catch (const std::ios_base::failure&) {\n-            addr_man.Clear();\n+            addr_man = std::make_unique<CAddrManDeterministic>(fuzzed_data_provider);\n         }\n     }\n     while (fuzzed_data_provider.ConsumeBool()) {\n         CallOneOf(\n             fuzzed_data_provider,\n             [&] {\n-                addr_man.Clear();\n+                addr_man = std::make_unique<CAddrManDeterministic>(fuzzed_data_provider);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691034731",
      "id" : 691034731,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MTAzNDczMQ==",
      "original_commit_id" : "ec132b1f86b19e8a6cc11f6138edeb2655bda80f",
      "original_line" : 247,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/test/fuzz/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 732464854,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-18T08:49:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691034731",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691036749"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691036749"
         }
      },
      "author_association" : "MEMBER",
      "body" : "this line isn't move-only, so could add `{` while touching?",
      "commit_id" : "fdf05e7d96845ea17213fba0ef39231caa67e329",
      "created_at" : "2021-08-18T08:50:54Z",
      "diff_hunk" : "@@ -1167,6 +1167,19 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     assert(!node.addrman);\n     auto check_addrman = std::clamp<int32_t>(args.GetArg(\"-checkaddrman\", DEFAULT_ADDRMAN_CONSISTENCY_CHECKS), 0, 1000000);\n     node.addrman = std::make_unique<CAddrMan>(/* deterministic */ false, /* consistency_check_ratio */ check_addrman);\n+    {\n+        // Load addresses from peers.dat\n+        uiInterface.InitMessage(_(\"Loading P2P addressesâ¦\").translated);\n+        int64_t nStart = GetTimeMillis();\n+        CAddrDB adb;\n+        if (adb.Read(*node.addrman))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691036749",
      "id" : 691036749,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MTAzNjc0OQ==",
      "original_commit_id" : "c4b12a6cbb9add01aa2b2f12c9f21457dc308974",
      "original_line" : 1175,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 732601695,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-18T08:50:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691036749",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691037769"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691037769"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I slightly prefer `{}` constructors (`uint256{1}`) or `uint256::ONE`.",
      "commit_id" : "fdf05e7d96845ea17213fba0ef39231caa67e329",
      "created_at" : "2021-08-18T08:52:13Z",
      "diff_hunk" : "@@ -48,7 +48,7 @@ class CAddrManCorrupted : public CAddrManSerializationMock\n         unsigned char nVersion = 1;\n         s << nVersion;\n         s << ((unsigned char)32);\n-        s << nKey;\n+        s << ((uint256)1);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691037769",
      "id" : 691037769,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MTAzNzc2OQ==",
      "original_commit_id" : "b0befadcc264d9b16419021bc1aabe1ae8161d4b",
      "original_line" : 51,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/addrman_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 732602998,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-18T08:53:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691037769",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691074691"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691074691"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I did try that, but couldn't get it to work. `emplace()` requires the type to be [MoveInsertable](https://en.cppreference.com/w/cpp/named_req/MoveInsertable), which `CAddrMan` isn't since its move constructor is implicitly deleted.\r\n\r\nIf you have a suggestion for how to do this, I'd be happy to incorporate it.",
      "commit_id" : "fdf05e7d96845ea17213fba0ef39231caa67e329",
      "created_at" : "2021-08-18T09:39:50Z",
      "diff_hunk" : "@@ -70,13 +70,22 @@ static void FillAddrMan(CAddrMan& addrman)\n \n static void AddrManAdd(benchmark::Bench& bench)\n {\n-    CreateAddresses();\n+     /* Create many CAddrMan objects - one to be modified at each loop iteration. */\n \n-    CAddrMan addrman(/* deterministic */ false, /* consistency_check_ratio */ 0);\n+    bench.epochs(5).epochIterations(1);\n+    size_t addrman_count = bench.epochs() * bench.epochIterations();\n+\n+    std::vector<std::unique_ptr<CAddrMan>> addrmans(addrman_count);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691074691",
      "id" : 691074691,
      "in_reply_to_id" : 691032222,
      "line" : 78,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MTA3NDY5MQ==",
      "original_commit_id" : "ec132b1f86b19e8a6cc11f6138edeb2655bda80f",
      "original_line" : 78,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/bench/addrman.cpp",
      "position" : 11,
      "pull_request_review_id" : 732650432,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-18T09:39:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691074691",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691083948"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691083948"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Removed",
      "commit_id" : "fdf05e7d96845ea17213fba0ef39231caa67e329",
      "created_at" : "2021-08-18T09:51:52Z",
      "diff_hunk" : "@@ -228,29 +228,29 @@ FUZZ_TARGET_INIT(addrman, initialize_addrman)\n {\n     FuzzedDataProvider fuzzed_data_provider(buffer.data(), buffer.size());\n     SetMockTime(ConsumeTime(fuzzed_data_provider));\n-    CAddrManDeterministic addr_man{fuzzed_data_provider};\n+    auto addr_man = std::make_unique<CAddrManDeterministic>(fuzzed_data_provider);\n     if (fuzzed_data_provider.ConsumeBool()) {\n         const std::vector<uint8_t> serialized_data{ConsumeRandomLengthByteVector(fuzzed_data_provider)};\n         CDataStream ds(serialized_data, SER_DISK, INIT_PROTO_VERSION);\n         const auto ser_version{fuzzed_data_provider.ConsumeIntegral<int32_t>()};\n         ds.SetVersion(ser_version);\n         try {\n-            ds >> addr_man;\n+            ds >> *addr_man;\n         } catch (const std::ios_base::failure&) {\n-            addr_man.Clear();\n+            addr_man = std::make_unique<CAddrManDeterministic>(fuzzed_data_provider);\n         }\n     }\n     while (fuzzed_data_provider.ConsumeBool()) {\n         CallOneOf(\n             fuzzed_data_provider,\n             [&] {\n-                addr_man.Clear();\n+                addr_man = std::make_unique<CAddrManDeterministic>(fuzzed_data_provider);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691083948",
      "id" : 691083948,
      "in_reply_to_id" : 691034731,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MTA4Mzk0OA==",
      "original_commit_id" : "ec132b1f86b19e8a6cc11f6138edeb2655bda80f",
      "original_line" : 247,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/test/fuzz/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 732662270,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-18T09:51:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691083948",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691086453"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691086453"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, I agree that's better. Changed to `uint256::ONE`.",
      "commit_id" : "fdf05e7d96845ea17213fba0ef39231caa67e329",
      "created_at" : "2021-08-18T09:55:18Z",
      "diff_hunk" : "@@ -48,7 +48,7 @@ class CAddrManCorrupted : public CAddrManSerializationMock\n         unsigned char nVersion = 1;\n         s << nVersion;\n         s << ((unsigned char)32);\n-        s << nKey;\n+        s << ((uint256)1);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691086453",
      "id" : 691086453,
      "in_reply_to_id" : 691037769,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MTA4NjQ1Mw==",
      "original_commit_id" : "b0befadcc264d9b16419021bc1aabe1ae8161d4b",
      "original_line" : 51,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/addrman_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 732665552,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-18T09:55:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691086453",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691087818"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691087818"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "fdf05e7d96845ea17213fba0ef39231caa67e329",
      "created_at" : "2021-08-18T09:57:04Z",
      "diff_hunk" : "@@ -1167,6 +1167,19 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     assert(!node.addrman);\n     auto check_addrman = std::clamp<int32_t>(args.GetArg(\"-checkaddrman\", DEFAULT_ADDRMAN_CONSISTENCY_CHECKS), 0, 1000000);\n     node.addrman = std::make_unique<CAddrMan>(/* deterministic */ false, /* consistency_check_ratio */ check_addrman);\n+    {\n+        // Load addresses from peers.dat\n+        uiInterface.InitMessage(_(\"Loading P2P addressesâ¦\").translated);\n+        int64_t nStart = GetTimeMillis();\n+        CAddrDB adb;\n+        if (adb.Read(*node.addrman))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691087818",
      "id" : 691087818,
      "in_reply_to_id" : 691036749,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MTA4NzgxOA==",
      "original_commit_id" : "c4b12a6cbb9add01aa2b2f12c9f21457dc308974",
      "original_line" : 1175,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 732667325,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-18T09:57:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691087818",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691087946"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691087946"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "fdf05e7d96845ea17213fba0ef39231caa67e329",
      "created_at" : "2021-08-18T09:57:16Z",
      "diff_hunk" : "@@ -205,21 +195,16 @@ BOOST_AUTO_TEST_CASE(addrman_simple)\n     // success.\n \n     CService addr2 = ResolveService(\"250.1.1.2\", 8333);\n-    BOOST_CHECK(addrman.Add({CAddress(addr2, NODE_NONE)}, source));\n-    BOOST_CHECK(addrman.size() >= 1);\n+    BOOST_CHECK(addrman->Add({CAddress(addr2, NODE_NONE)}, source));\n+    BOOST_CHECK(addrman->size() >= 1);\n \n-    // Test: AddrMan::Clear() should empty the new table.\n-    addrman.Clear();\n-    BOOST_CHECK_EQUAL(addrman.size(), 0U);\n-    CAddrInfo addr_null2 = addrman.Select();\n-    BOOST_CHECK_EQUAL(addr_null2.ToString(), \"[::]:0\");\n-\n-    // Test: AddrMan::Add multiple addresses works as expected\n+    // Test: reset addrman and test AddrMan::Add multiple addresses works as expected\n+    addrman = std::make_unique<CAddrManTest>();\n     std::vector<CAddress> vAddr;\n     vAddr.push_back(CAddress(ResolveService(\"250.1.1.3\", 8333), NODE_NONE));\n     vAddr.push_back(CAddress(ResolveService(\"250.1.1.4\", 8333), NODE_NONE));\n-    BOOST_CHECK(addrman.Add(vAddr, source));\n-    BOOST_CHECK(addrman.size() >= 1);\n+    BOOST_CHECK(addrman->Add(vAddr, source));\n+    BOOST_CHECK(addrman->size() >= 1);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691087946",
      "id" : 691087946,
      "in_reply_to_id" : 691029194,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MTA4Nzk0Ng==",
      "original_commit_id" : "ec132b1f86b19e8a6cc11f6138edeb2655bda80f",
      "original_line" : 207,
      "original_position" : 77,
      "original_start_line" : null,
      "path" : "src/test/addrman_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 732667506,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-18T09:57:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691087946",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691088019"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691088019"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "fdf05e7d96845ea17213fba0ef39231caa67e329",
      "created_at" : "2021-08-18T09:57:24Z",
      "diff_hunk" : "@@ -774,63 +759,63 @@ BOOST_AUTO_TEST_CASE(addrman_serialization)\n {\n     std::vector<bool> asmap1 = FromBytes(asmap_raw, sizeof(asmap_raw) * 8);\n \n-    CAddrManTest addrman_asmap1(true, asmap1);\n-    CAddrManTest addrman_asmap1_dup(true, asmap1);\n-    CAddrManTest addrman_noasmap;\n+    auto addrman_asmap1 = std::make_unique<CAddrManTest>(true, asmap1);\n+    auto addrman_asmap1_dup = std::make_unique<CAddrManTest>(true, asmap1);\n+    auto addrman_noasmap = std::make_unique<CAddrManTest>();\n     CDataStream stream(SER_NETWORK, PROTOCOL_VERSION);\n \n     CAddress addr = CAddress(ResolveService(\"250.1.1.1\"), NODE_NONE);\n     CNetAddr default_source;\n \n \n-    addrman_asmap1.Add({addr}, default_source);\n+    addrman_asmap1->Add({addr}, default_source);\n \n-    stream << addrman_asmap1;\n+    stream << *addrman_asmap1;\n     // serizalizing/deserializing addrman with the same asmap\n-    stream >> addrman_asmap1_dup;\n+    stream >> *addrman_asmap1_dup;\n \n-    std::pair<int, int> bucketAndEntry_asmap1 = addrman_asmap1.GetBucketAndEntry(addr);\n-    std::pair<int, int> bucketAndEntry_asmap1_dup = addrman_asmap1_dup.GetBucketAndEntry(addr);\n+    std::pair<int, int> bucketAndEntry_asmap1 = addrman_asmap1->GetBucketAndEntry(addr);\n+    std::pair<int, int> bucketAndEntry_asmap1_dup = addrman_asmap1_dup->GetBucketAndEntry(addr);\n     BOOST_CHECK(bucketAndEntry_asmap1.second != -1);\n     BOOST_CHECK(bucketAndEntry_asmap1_dup.second != -1);\n \n     BOOST_CHECK(bucketAndEntry_asmap1.first == bucketAndEntry_asmap1_dup.first);\n     BOOST_CHECK(bucketAndEntry_asmap1.second == bucketAndEntry_asmap1_dup.second);\n \n     // deserializing asmaped peers.dat to non-asmaped addrman\n-    stream << addrman_asmap1;\n-    stream >> addrman_noasmap;\n-    std::pair<int, int> bucketAndEntry_noasmap = addrman_noasmap.GetBucketAndEntry(addr);\n+    stream << *addrman_asmap1;\n+    stream >> *addrman_noasmap;\n+    std::pair<int, int> bucketAndEntry_noasmap = addrman_noasmap->GetBucketAndEntry(addr);\n     BOOST_CHECK(bucketAndEntry_noasmap.second != -1);\n     BOOST_CHECK(bucketAndEntry_asmap1.first != bucketAndEntry_noasmap.first);\n     BOOST_CHECK(bucketAndEntry_asmap1.second != bucketAndEntry_noasmap.second);\n \n     // deserializing non-asmaped peers.dat to asmaped addrman\n-    addrman_asmap1.Clear();\n-    addrman_noasmap.Clear();\n-    addrman_noasmap.Add({addr}, default_source);\n-    stream << addrman_noasmap;\n-    stream >> addrman_asmap1;\n-    std::pair<int, int> bucketAndEntry_asmap1_deser = addrman_asmap1.GetBucketAndEntry(addr);\n+    addrman_asmap1 = std::make_unique<CAddrManTest>(true, asmap1);\n+    addrman_noasmap = std::make_unique<CAddrManTest>();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691088019",
      "id" : 691088019,
      "in_reply_to_id" : 691033355,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MTA4ODAxOQ==",
      "original_commit_id" : "ec132b1f86b19e8a6cc11f6138edeb2655bda80f",
      "original_line" : 795,
      "original_position" : 135,
      "original_start_line" : null,
      "path" : "src/test/addrman_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 732667606,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-18T09:57:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691088019",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the review @MarcoFalke. I've addressed all your comments.",
      "created_at" : "2021-08-18T09:57:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#issuecomment-900982749",
      "id" : 900982749,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22697",
      "node_id" : "IC_kwDOABII5841s-fd",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-18T09:57:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/900982749",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-08-18T12:36:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#issuecomment-901078419",
      "id" : 901078419,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22697",
      "node_id" : "IC_kwDOABII5841tV2T",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-18T12:36:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/901078419",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased",
      "created_at" : "2021-08-18T13:04:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#issuecomment-901097570",
      "id" : 901097570,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22697",
      "node_id" : "IC_kwDOABII5841tahi",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-18T13:04:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/901097570",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691310217"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691310217"
         }
      },
      "author_association" : "MEMBER",
      "body" : "What is the reasoning for moving this to init.cpp? I think this goes in the wrong direction, of having parts take care of their own initialization instead of init.cpp being a hodge-podge of initialization functionality.",
      "commit_id" : "3fe1429a33ef181760fd21df06a4030854418be9",
      "created_at" : "2021-08-18T14:46:07Z",
      "diff_hunk" : "@@ -1167,6 +1167,20 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     assert(!node.addrman);\n     auto check_addrman = std::clamp<int32_t>(args.GetArg(\"-checkaddrman\", DEFAULT_ADDRMAN_CONSISTENCY_CHECKS), 0, 1000000);\n     node.addrman = std::make_unique<CAddrMan>(/* deterministic */ false, /* consistency_check_ratio */ check_addrman);\n+    {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691310217",
      "id" : 691310217,
      "line" : 1170,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MTMxMDIxNw==",
      "original_commit_id" : "3fe1429a33ef181760fd21df06a4030854418be9",
      "original_line" : 1170,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 4,
      "pull_request_review_id" : 732963647,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-18T14:46:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691310217",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK on getting rid of the `Clear()` function, seems more robust this way.",
      "created_at" : "2021-08-18T14:50:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#issuecomment-901180854",
      "id" : 901180854,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22697",
      "node_id" : "IC_kwDOABII5841tu22",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-18T14:50:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/901180854",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691413337"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691413337"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Since #20228, addrman is owned by the `node.context` struct and gets constructed inside the `AppInitMain()` function. That PR includes motivation for why that is.\r\n\r\nSince `AppInitMain()` is responsible for constructing the addrman, it should also be responsible for making sure addrman deserializes from peers.dat (and recovers if there's an error). Before this PR, addrman peers.dat derserialization is happening in `CConnMan::Start()`, which doesn't make a lot of sense.",
      "commit_id" : "3fe1429a33ef181760fd21df06a4030854418be9",
      "created_at" : "2021-08-18T16:22:58Z",
      "diff_hunk" : "@@ -1167,6 +1167,20 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     assert(!node.addrman);\n     auto check_addrman = std::clamp<int32_t>(args.GetArg(\"-checkaddrman\", DEFAULT_ADDRMAN_CONSISTENCY_CHECKS), 0, 1000000);\n     node.addrman = std::make_unique<CAddrMan>(/* deterministic */ false, /* consistency_check_ratio */ check_addrman);\n+    {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691413337",
      "id" : 691413337,
      "in_reply_to_id" : 691310217,
      "line" : 1170,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MTQxMzMzNw==",
      "original_commit_id" : "3fe1429a33ef181760fd21df06a4030854418be9",
      "original_line" : 1170,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 4,
      "pull_request_review_id" : 733105985,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-18T16:22:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691413337",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "looks like both failing builds are failing in `addrman_tests` -> `addrman_serialization`\r\n\r\n[AppVeyor](https://ci.appveyor.com/project/DrahtBot/bitcoin/builds/40428513#L61):\r\n```\r\nC:\\projects\\bitcoin\\src\\test\\addrman_tests.cpp(758): Entering test case \"addrman_serialization\"\r\nunknown location(0): fatal error: in \"addrman_tests/addrman_serialization\": stack overflow\r\n```\r\n\r\n[Win64](https://cirrus-ci.com/task/5728778564403200?logs=ci#L5538):\r\n```\r\ntest/addrman_tests.cpp(758): Entering test case \"addrman_serialization\"\r\nwine: Unhandled stack overflow at address 0000000001180216 (thread 0018), starting debugger...\r\n```",
      "created_at" : "2021-08-18T20:02:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#issuecomment-901392680",
      "id" : 901392680,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22697",
      "node_id" : "IC_kwDOABII5841uiko",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-18T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/901392680",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691866096"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691866096"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hardcoding the number of runs could cripple the test (results vary too much). It is better to avoid that if possible, so that nanobench chooses how many runs to execute based on variance. In this case it is possible to avoid hardcoding, and also shorter:\r\n\r\n```cpp\r\nstatic void AddrManAdd(benchmark::Bench& bench)\r\n{\r\n    CreateAddresses();\r\n\r\n    bench.run([&] { \r\n        auto addrman = std::make_unique<CAddrMan>(/* deterministic */ false, /* consistency_check_ratio */ 0);\r\n        AddAddressesToAddrMan(*addrman);\r\n    }); \r\n}   \r\n```",
      "commit_id" : "3fe1429a33ef181760fd21df06a4030854418be9",
      "created_at" : "2021-08-19T07:42:51Z",
      "diff_hunk" : "@@ -70,13 +70,22 @@ static void FillAddrMan(CAddrMan& addrman)\n \n static void AddrManAdd(benchmark::Bench& bench)\n {\n-    CreateAddresses();\n+     /* Create many CAddrMan objects - one to be modified at each loop iteration. */\n \n-    CAddrMan addrman(/* deterministic */ false, /* consistency_check_ratio */ 0);\n+    bench.epochs(5).epochIterations(1);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691866096",
      "id" : 691866096,
      "line" : 75,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MTg2NjA5Ng==",
      "original_commit_id" : "3fe1429a33ef181760fd21df06a4030854418be9",
      "original_line" : 75,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/bench/addrman.cpp",
      "position" : 8,
      "pull_request_review_id" : 733664406,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-19T08:17:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691866096",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691871131"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691871131"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This would skip the message \"Flushed 0 addresses to peers.dat\" which was previously printed from `CConnman::DumpAddresses()`, is that intentional?",
      "commit_id" : "3fe1429a33ef181760fd21df06a4030854418be9",
      "created_at" : "2021-08-19T07:50:11Z",
      "diff_hunk" : "@@ -1167,6 +1167,20 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     assert(!node.addrman);\n     auto check_addrman = std::clamp<int32_t>(args.GetArg(\"-checkaddrman\", DEFAULT_ADDRMAN_CONSISTENCY_CHECKS), 0, 1000000);\n     node.addrman = std::make_unique<CAddrMan>(/* deterministic */ false, /* consistency_check_ratio */ check_addrman);\n+    {\n+        // Load addresses from peers.dat\n+        uiInterface.InitMessage(_(\"Loading P2P addressesâ¦\").translated);\n+        int64_t nStart = GetTimeMillis();\n+        CAddrDB adb;\n+        if (adb.Read(*node.addrman)) {\n+            LogPrintf(\"Loaded %i addresses from peers.dat  %dms\\n\", node.addrman->size(), GetTimeMillis() - nStart);\n+        } else {\n+            // Addrman can be in an inconsistent state after failure, reset it\n+            node.addrman = std::make_unique<CAddrMan>(/* deterministic */ false, /* consistency_check_ratio */ check_addrman);\n+            LogPrintf(\"Recreating peers.dat\\n\");\n+            adb.Write(*node.addrman);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691871131",
      "id" : 691871131,
      "line" : 1181,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MTg3MTEzMQ==",
      "original_commit_id" : "3fe1429a33ef181760fd21df06a4030854418be9",
      "original_line" : 1181,
      "original_position" : 15,
      "original_start_line" : 1178,
      "path" : "src/init.cpp",
      "position" : 15,
      "pull_request_review_id" : 733664406,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697",
      "side" : "RIGHT",
      "start_line" : 1178,
      "start_side" : "RIGHT",
      "updated_at" : "2021-08-19T08:17:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691871131",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691872884"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691872884"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: I think `{}` is just clutter. Also, few objects below are constructed without it.",
      "commit_id" : "3fe1429a33ef181760fd21df06a4030854418be9",
      "created_at" : "2021-08-19T07:52:40Z",
      "diff_hunk" : "@@ -208,18 +198,13 @@ BOOST_AUTO_TEST_CASE(addrman_simple)\n     BOOST_CHECK(addrman.Add({CAddress(addr2, NODE_NONE)}, source));\n     BOOST_CHECK(addrman.size() >= 1);\n \n-    // Test: AddrMan::Clear() should empty the new table.\n-    addrman.Clear();\n-    BOOST_CHECK_EQUAL(addrman.size(), 0U);\n-    CAddrInfo addr_null2 = addrman.Select();\n-    BOOST_CHECK_EQUAL(addr_null2.ToString(), \"[::]:0\");\n-\n     // Test: AddrMan::Add multiple addresses works as expected\n+    CAddrManTest addrman2{};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691872884",
      "id" : 691872884,
      "line" : 202,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MTg3Mjg4NA==",
      "original_commit_id" : "3fe1429a33ef181760fd21df06a4030854418be9",
      "original_line" : 202,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/test/addrman_tests.cpp",
      "position" : 37,
      "pull_request_review_id" : 733664406,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-19T08:17:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691872884",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691885202"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691885202"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Previously the `Clear()` method would not have consumed anything from `fuzzed_data_provider`. Now, the `CAddrManDeterministic` constructor will consume one `uint256`, one `bool` and maybe one `RandomLengthBitVector`. I guess this is ok (it will invalidate the corpus, but I guess that is ok too).",
      "commit_id" : "3fe1429a33ef181760fd21df06a4030854418be9",
      "created_at" : "2021-08-19T08:09:39Z",
      "diff_hunk" : "@@ -228,24 +228,22 @@ FUZZ_TARGET_INIT(addrman, initialize_addrman)\n {\n     FuzzedDataProvider fuzzed_data_provider(buffer.data(), buffer.size());\n     SetMockTime(ConsumeTime(fuzzed_data_provider));\n-    CAddrManDeterministic addr_man{fuzzed_data_provider};\n+    auto addr_man_ptr = std::make_unique<CAddrManDeterministic>(fuzzed_data_provider);\n     if (fuzzed_data_provider.ConsumeBool()) {\n         const std::vector<uint8_t> serialized_data{ConsumeRandomLengthByteVector(fuzzed_data_provider)};\n         CDataStream ds(serialized_data, SER_DISK, INIT_PROTO_VERSION);\n         const auto ser_version{fuzzed_data_provider.ConsumeIntegral<int32_t>()};\n         ds.SetVersion(ser_version);\n         try {\n-            ds >> addr_man;\n+            ds >> *addr_man_ptr;\n         } catch (const std::ios_base::failure&) {\n-            addr_man.Clear();\n+            addr_man_ptr = std::make_unique<CAddrManDeterministic>(fuzzed_data_provider);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691885202",
      "id" : 691885202,
      "line" : 240,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MTg4NTIwMg==",
      "original_commit_id" : "3fe1429a33ef181760fd21df06a4030854418be9",
      "original_line" : 240,
      "original_position" : 16,
      "original_start_line" : 240,
      "path" : "src/test/fuzz/addrman.cpp",
      "position" : 16,
      "pull_request_review_id" : 733664406,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697",
      "side" : "RIGHT",
      "start_line" : 240,
      "start_side" : "LEFT",
      "updated_at" : "2021-08-19T08:17:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691885202",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691893910"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691893910"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The seeds are already invalidated by removing an item in `CallOneOf` below ;)",
      "commit_id" : "3fe1429a33ef181760fd21df06a4030854418be9",
      "created_at" : "2021-08-19T08:21:24Z",
      "diff_hunk" : "@@ -228,24 +228,22 @@ FUZZ_TARGET_INIT(addrman, initialize_addrman)\n {\n     FuzzedDataProvider fuzzed_data_provider(buffer.data(), buffer.size());\n     SetMockTime(ConsumeTime(fuzzed_data_provider));\n-    CAddrManDeterministic addr_man{fuzzed_data_provider};\n+    auto addr_man_ptr = std::make_unique<CAddrManDeterministic>(fuzzed_data_provider);\n     if (fuzzed_data_provider.ConsumeBool()) {\n         const std::vector<uint8_t> serialized_data{ConsumeRandomLengthByteVector(fuzzed_data_provider)};\n         CDataStream ds(serialized_data, SER_DISK, INIT_PROTO_VERSION);\n         const auto ser_version{fuzzed_data_provider.ConsumeIntegral<int32_t>()};\n         ds.SetVersion(ser_version);\n         try {\n-            ds >> addr_man;\n+            ds >> *addr_man_ptr;\n         } catch (const std::ios_base::failure&) {\n-            addr_man.Clear();\n+            addr_man_ptr = std::make_unique<CAddrManDeterministic>(fuzzed_data_provider);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691893910",
      "id" : 691893910,
      "in_reply_to_id" : 691885202,
      "line" : 240,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MTg5MzkxMA==",
      "original_commit_id" : "3fe1429a33ef181760fd21df06a4030854418be9",
      "original_line" : 240,
      "original_position" : 16,
      "original_start_line" : 240,
      "path" : "src/test/fuzz/addrman.cpp",
      "position" : 16,
      "pull_request_review_id" : 733700858,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697",
      "side" : "RIGHT",
      "start_line" : 240,
      "start_side" : "LEFT",
      "updated_at" : "2021-08-19T08:21:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691893910",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691896788"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691896788"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Could also remove the make_unique and use the beautiful curly brackets?\r\n\r\n```cpp\r\nstatic void AddrManAdd(benchmark::Bench& bench)\r\n{\r\n    CreateAddresses();\r\n\r\n    bench.run([&] { \r\n        CAddrMan addrman{/* deterministic */ false, /* consistency_check_ratio */ 0};\r\n        AddAddressesToAddrMan(addrman);\r\n    }); \r\n}   \r\n",
      "commit_id" : "3fe1429a33ef181760fd21df06a4030854418be9",
      "created_at" : "2021-08-19T08:25:13Z",
      "diff_hunk" : "@@ -70,13 +70,22 @@ static void FillAddrMan(CAddrMan& addrman)\n \n static void AddrManAdd(benchmark::Bench& bench)\n {\n-    CreateAddresses();\n+     /* Create many CAddrMan objects - one to be modified at each loop iteration. */\n \n-    CAddrMan addrman(/* deterministic */ false, /* consistency_check_ratio */ 0);\n+    bench.epochs(5).epochIterations(1);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691896788",
      "id" : 691896788,
      "in_reply_to_id" : 691866096,
      "line" : 75,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MTg5Njc4OA==",
      "original_commit_id" : "3fe1429a33ef181760fd21df06a4030854418be9",
      "original_line" : 75,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/bench/addrman.cpp",
      "position" : 8,
      "pull_request_review_id" : 733704576,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-19T08:25:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691896788",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691979535"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691979535"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've reverted this (and the similar change to the `addrman_serialization` test below). Constructing many large `CAddrMan` objects on the stack causes a stack overflow on some systems: https://github.com/bitcoin/bitcoin/pull/22697#issuecomment-901392680.",
      "commit_id" : "4d2fa97031a6f31da984d4c2c105447ed692c6ed",
      "created_at" : "2021-08-19T10:16:54Z",
      "diff_hunk" : "@@ -205,21 +195,16 @@ BOOST_AUTO_TEST_CASE(addrman_simple)\n     // success.\n \n     CService addr2 = ResolveService(\"250.1.1.2\", 8333);\n-    BOOST_CHECK(addrman.Add({CAddress(addr2, NODE_NONE)}, source));\n-    BOOST_CHECK(addrman.size() >= 1);\n+    BOOST_CHECK(addrman->Add({CAddress(addr2, NODE_NONE)}, source));\n+    BOOST_CHECK(addrman->size() >= 1);\n \n-    // Test: AddrMan::Clear() should empty the new table.\n-    addrman.Clear();\n-    BOOST_CHECK_EQUAL(addrman.size(), 0U);\n-    CAddrInfo addr_null2 = addrman.Select();\n-    BOOST_CHECK_EQUAL(addr_null2.ToString(), \"[::]:0\");\n-\n-    // Test: AddrMan::Add multiple addresses works as expected\n+    // Test: reset addrman and test AddrMan::Add multiple addresses works as expected\n+    addrman = std::make_unique<CAddrManTest>();\n     std::vector<CAddress> vAddr;\n     vAddr.push_back(CAddress(ResolveService(\"250.1.1.3\", 8333), NODE_NONE));\n     vAddr.push_back(CAddress(ResolveService(\"250.1.1.4\", 8333), NODE_NONE));\n-    BOOST_CHECK(addrman.Add(vAddr, source));\n-    BOOST_CHECK(addrman.size() >= 1);\n+    BOOST_CHECK(addrman->Add(vAddr, source));\n+    BOOST_CHECK(addrman->size() >= 1);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691979535",
      "id" : 691979535,
      "in_reply_to_id" : 691029194,
      "line" : 207,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MTk3OTUzNQ==",
      "original_commit_id" : "ec132b1f86b19e8a6cc11f6138edeb2655bda80f",
      "original_line" : 207,
      "original_position" : 77,
      "original_start_line" : null,
      "path" : "src/test/addrman_tests.cpp",
      "position" : 86,
      "pull_request_review_id" : 733813419,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-19T10:16:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691979535",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691979693"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691979693"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Reverted (see https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691979535)",
      "commit_id" : "4d2fa97031a6f31da984d4c2c105447ed692c6ed",
      "created_at" : "2021-08-19T10:17:10Z",
      "diff_hunk" : "@@ -774,63 +759,63 @@ BOOST_AUTO_TEST_CASE(addrman_serialization)\n {\n     std::vector<bool> asmap1 = FromBytes(asmap_raw, sizeof(asmap_raw) * 8);\n \n-    CAddrManTest addrman_asmap1(true, asmap1);\n-    CAddrManTest addrman_asmap1_dup(true, asmap1);\n-    CAddrManTest addrman_noasmap;\n+    auto addrman_asmap1 = std::make_unique<CAddrManTest>(true, asmap1);\n+    auto addrman_asmap1_dup = std::make_unique<CAddrManTest>(true, asmap1);\n+    auto addrman_noasmap = std::make_unique<CAddrManTest>();\n     CDataStream stream(SER_NETWORK, PROTOCOL_VERSION);\n \n     CAddress addr = CAddress(ResolveService(\"250.1.1.1\"), NODE_NONE);\n     CNetAddr default_source;\n \n \n-    addrman_asmap1.Add({addr}, default_source);\n+    addrman_asmap1->Add({addr}, default_source);\n \n-    stream << addrman_asmap1;\n+    stream << *addrman_asmap1;\n     // serizalizing/deserializing addrman with the same asmap\n-    stream >> addrman_asmap1_dup;\n+    stream >> *addrman_asmap1_dup;\n \n-    std::pair<int, int> bucketAndEntry_asmap1 = addrman_asmap1.GetBucketAndEntry(addr);\n-    std::pair<int, int> bucketAndEntry_asmap1_dup = addrman_asmap1_dup.GetBucketAndEntry(addr);\n+    std::pair<int, int> bucketAndEntry_asmap1 = addrman_asmap1->GetBucketAndEntry(addr);\n+    std::pair<int, int> bucketAndEntry_asmap1_dup = addrman_asmap1_dup->GetBucketAndEntry(addr);\n     BOOST_CHECK(bucketAndEntry_asmap1.second != -1);\n     BOOST_CHECK(bucketAndEntry_asmap1_dup.second != -1);\n \n     BOOST_CHECK(bucketAndEntry_asmap1.first == bucketAndEntry_asmap1_dup.first);\n     BOOST_CHECK(bucketAndEntry_asmap1.second == bucketAndEntry_asmap1_dup.second);\n \n     // deserializing asmaped peers.dat to non-asmaped addrman\n-    stream << addrman_asmap1;\n-    stream >> addrman_noasmap;\n-    std::pair<int, int> bucketAndEntry_noasmap = addrman_noasmap.GetBucketAndEntry(addr);\n+    stream << *addrman_asmap1;\n+    stream >> *addrman_noasmap;\n+    std::pair<int, int> bucketAndEntry_noasmap = addrman_noasmap->GetBucketAndEntry(addr);\n     BOOST_CHECK(bucketAndEntry_noasmap.second != -1);\n     BOOST_CHECK(bucketAndEntry_asmap1.first != bucketAndEntry_noasmap.first);\n     BOOST_CHECK(bucketAndEntry_asmap1.second != bucketAndEntry_noasmap.second);\n \n     // deserializing non-asmaped peers.dat to asmaped addrman\n-    addrman_asmap1.Clear();\n-    addrman_noasmap.Clear();\n-    addrman_noasmap.Add({addr}, default_source);\n-    stream << addrman_noasmap;\n-    stream >> addrman_asmap1;\n-    std::pair<int, int> bucketAndEntry_asmap1_deser = addrman_asmap1.GetBucketAndEntry(addr);\n+    addrman_asmap1 = std::make_unique<CAddrManTest>(true, asmap1);\n+    addrman_noasmap = std::make_unique<CAddrManTest>();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691979693",
      "id" : 691979693,
      "in_reply_to_id" : 691033355,
      "line" : 795,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MTk3OTY5Mw==",
      "original_commit_id" : "ec132b1f86b19e8a6cc11f6138edeb2655bda80f",
      "original_line" : 795,
      "original_position" : 135,
      "original_start_line" : null,
      "path" : "src/test/addrman_tests.cpp",
      "position" : 144,
      "pull_request_review_id" : 733813618,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-19T10:17:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691979693",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691987321"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691987321"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This has now been reverted so the `CAddrManTest` objects are constructed using `std::make_unique()`.",
      "commit_id" : "4d2fa97031a6f31da984d4c2c105447ed692c6ed",
      "created_at" : "2021-08-19T10:28:42Z",
      "diff_hunk" : "@@ -208,18 +198,13 @@ BOOST_AUTO_TEST_CASE(addrman_simple)\n     BOOST_CHECK(addrman.Add({CAddress(addr2, NODE_NONE)}, source));\n     BOOST_CHECK(addrman.size() >= 1);\n \n-    // Test: AddrMan::Clear() should empty the new table.\n-    addrman.Clear();\n-    BOOST_CHECK_EQUAL(addrman.size(), 0U);\n-    CAddrInfo addr_null2 = addrman.Select();\n-    BOOST_CHECK_EQUAL(addr_null2.ToString(), \"[::]:0\");\n-\n     // Test: AddrMan::Add multiple addresses works as expected\n+    CAddrManTest addrman2{};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691987321",
      "id" : 691987321,
      "in_reply_to_id" : 691872884,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MTk4NzMyMQ==",
      "original_commit_id" : "3fe1429a33ef181760fd21df06a4030854418be9",
      "original_line" : 202,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/test/addrman_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 733823431,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-19T10:28:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691987321",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691988715"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691988715"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, I don't think that log is necessary or helpful.",
      "commit_id" : "4d2fa97031a6f31da984d4c2c105447ed692c6ed",
      "created_at" : "2021-08-19T10:30:45Z",
      "diff_hunk" : "@@ -1167,6 +1167,20 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     assert(!node.addrman);\n     auto check_addrman = std::clamp<int32_t>(args.GetArg(\"-checkaddrman\", DEFAULT_ADDRMAN_CONSISTENCY_CHECKS), 0, 1000000);\n     node.addrman = std::make_unique<CAddrMan>(/* deterministic */ false, /* consistency_check_ratio */ check_addrman);\n+    {\n+        // Load addresses from peers.dat\n+        uiInterface.InitMessage(_(\"Loading P2P addressesâ¦\").translated);\n+        int64_t nStart = GetTimeMillis();\n+        CAddrDB adb;\n+        if (adb.Read(*node.addrman)) {\n+            LogPrintf(\"Loaded %i addresses from peers.dat  %dms\\n\", node.addrman->size(), GetTimeMillis() - nStart);\n+        } else {\n+            // Addrman can be in an inconsistent state after failure, reset it\n+            node.addrman = std::make_unique<CAddrMan>(/* deterministic */ false, /* consistency_check_ratio */ check_addrman);\n+            LogPrintf(\"Recreating peers.dat\\n\");\n+            adb.Write(*node.addrman);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691988715",
      "id" : 691988715,
      "in_reply_to_id" : 691871131,
      "line" : 1181,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MTk4ODcxNQ==",
      "original_commit_id" : "3fe1429a33ef181760fd21df06a4030854418be9",
      "original_line" : 1181,
      "original_position" : 15,
      "original_start_line" : 1178,
      "path" : "src/init.cpp",
      "position" : 15,
      "pull_request_review_id" : 733825234,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697",
      "side" : "RIGHT",
      "start_line" : 1178,
      "start_side" : "RIGHT",
      "updated_at" : "2021-08-19T10:30:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691988715",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691988738"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691988738"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The reason to construct the addrman objects outside the bench run is to prevent the time spent in constructing the object being included in the bench. I think that would be especially bad and could lead to variance if we're allocating memory for the object by making a unique_ptr.\r\n\r\nI've reverted to Marco's suggested version, which shouldn't be any worse than the current code, which calls `Clear()`.",
      "commit_id" : "4d2fa97031a6f31da984d4c2c105447ed692c6ed",
      "created_at" : "2021-08-19T10:30:48Z",
      "diff_hunk" : "@@ -70,13 +70,22 @@ static void FillAddrMan(CAddrMan& addrman)\n \n static void AddrManAdd(benchmark::Bench& bench)\n {\n-    CreateAddresses();\n+     /* Create many CAddrMan objects - one to be modified at each loop iteration. */\n \n-    CAddrMan addrman(/* deterministic */ false, /* consistency_check_ratio */ 0);\n+    bench.epochs(5).epochIterations(1);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r691988738",
      "id" : 691988738,
      "in_reply_to_id" : 691866096,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MTk4ODczOA==",
      "original_commit_id" : "3fe1429a33ef181760fd21df06a4030854418be9",
      "original_line" : 75,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/bench/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 733825272,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-19T10:30:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691988738",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thank you for the review @laanwj @amitiuttarwar @vasild @MarcoFalke. I believe that I've addressed all of your review comments.",
      "created_at" : "2021-08-19T10:31:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#issuecomment-901801141",
      "id" : 901801141,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22697",
      "node_id" : "IC_kwDOABII5841wGS1",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-19T10:31:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/901801141",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r692102040"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/692102040"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ok, I agree. I hope it can be factored out again at some point to a place that makes sense.",
      "commit_id" : "4d2fa97031a6f31da984d4c2c105447ed692c6ed",
      "created_at" : "2021-08-19T13:18:50Z",
      "diff_hunk" : "@@ -1167,6 +1167,20 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     assert(!node.addrman);\n     auto check_addrman = std::clamp<int32_t>(args.GetArg(\"-checkaddrman\", DEFAULT_ADDRMAN_CONSISTENCY_CHECKS), 0, 1000000);\n     node.addrman = std::make_unique<CAddrMan>(/* deterministic */ false, /* consistency_check_ratio */ check_addrman);\n+    {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r692102040",
      "id" : 692102040,
      "in_reply_to_id" : 691310217,
      "line" : 1170,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MjEwMjA0MA==",
      "original_commit_id" : "3fe1429a33ef181760fd21df06a4030854418be9",
      "original_line" : 1170,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 4,
      "pull_request_review_id" : 733976328,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-19T13:18:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/692102040",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK 4d2fa97031a6f31da984d4c2c105447ed692c6ed",
      "created_at" : "2021-08-19T13:34:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#issuecomment-901920506",
      "id" : 901920506,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22697",
      "node_id" : "IC_kwDOABII5841wjb6",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-19T13:34:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/901920506",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r692857462"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/692857462"
         }
      },
      "author_association" : "MEMBER",
      "body" : "See #22754",
      "commit_id" : "4d2fa97031a6f31da984d4c2c105447ed692c6ed",
      "created_at" : "2021-08-20T10:57:09Z",
      "diff_hunk" : "@@ -1167,6 +1167,20 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     assert(!node.addrman);\n     auto check_addrman = std::clamp<int32_t>(args.GetArg(\"-checkaddrman\", DEFAULT_ADDRMAN_CONSISTENCY_CHECKS), 0, 1000000);\n     node.addrman = std::make_unique<CAddrMan>(/* deterministic */ false, /* consistency_check_ratio */ check_addrman);\n+    {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22697#discussion_r692857462",
      "id" : 692857462,
      "in_reply_to_id" : 691310217,
      "line" : 1170,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5Mjg1NzQ2Mg==",
      "original_commit_id" : "3fe1429a33ef181760fd21df06a4030854418be9",
      "original_line" : 1170,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 4,
      "pull_request_review_id" : 734913101,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22697",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-20T10:57:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/692857462",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
