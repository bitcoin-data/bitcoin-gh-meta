[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#25862](https://github.com/bitcoin/bitcoin/pull/25862) (refactor, kernel: Remove gArgs accesses from dbwrapper and txdb by ryanofsky)\n* [#25740](https://github.com/bitcoin/bitcoin/pull/25740) (assumeutxo: background validation completion by jamesob)\n* [#25667](https://github.com/bitcoin/bitcoin/pull/25667) (assumeutxo: snapshot initialization by jamesob)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-08-08T05:54:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22663#issuecomment-894747743",
      "id" : 894747743,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22663",
      "node_id" : "IC_kwDOABII5841VMRf",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/894747743/reactions"
      },
      "updated_at" : "2022-09-08T04:38:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/894747743",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "One build is failing due to a leak while fuzzing `coins_view` and I cannot see why with the CI.  I am unable to reproduce this on my machine.",
      "created_at" : "2021-08-08T12:48:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22663#issuecomment-894792761",
      "id" : 894792761,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22663",
      "node_id" : "IC_kwDOABII5841VXQ5",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-08T12:48:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/894792761",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15145615?v=4",
         "events_url" : "https://api.github.com/users/Crypt-iQ/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Crypt-iQ/followers",
         "following_url" : "https://api.github.com/users/Crypt-iQ/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Crypt-iQ/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Crypt-iQ",
         "id" : 15145615,
         "login" : "Crypt-iQ",
         "node_id" : "MDQ6VXNlcjE1MTQ1NjE1",
         "organizations_url" : "https://api.github.com/users/Crypt-iQ/orgs",
         "received_events_url" : "https://api.github.com/users/Crypt-iQ/received_events",
         "repos_url" : "https://api.github.com/users/Crypt-iQ/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Crypt-iQ/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Crypt-iQ/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Crypt-iQ"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r686109932"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686109932"
         }
      },
      "author_association" : "NONE",
      "body" : "If `penv` is deleted, then `~CDBWrapper()` gonna delete it again? Missing `= nullptr`?\r\n",
      "commit_id" : "6770f066b69c6c271e7096cc647d5d42762f6b05",
      "created_at" : "2021-08-10T15:06:41Z",
      "diff_hunk" : "@@ -97,46 +97,59 @@ static void SetMaxOpenFiles(leveldb::Options *options) {\n              options->max_open_files, default_open_files);\n }\n \n-static leveldb::Options GetOptions(size_t nCacheSize)\n+static void GetOptions(size_t nCacheSize, leveldb::Options* options)\n {\n-    leveldb::Options options;\n-    options.block_cache = leveldb::NewLRUCache(nCacheSize / 2);\n-    options.write_buffer_size = nCacheSize / 4; // up to two write buffers may be held in memory simultaneously\n-    options.filter_policy = leveldb::NewBloomFilterPolicy(10);\n-    options.compression = leveldb::kNoCompression;\n-    options.info_log = new CBitcoinLevelDBLogger();\n+    options->block_cache = leveldb::NewLRUCache(nCacheSize / 2);\n+    options->write_buffer_size = nCacheSize / 4; // up to two write buffers may be held in memory simultaneously\n+    options->filter_policy = leveldb::NewBloomFilterPolicy(10);\n+    options->compression = leveldb::kNoCompression;\n+    options->info_log = new CBitcoinLevelDBLogger();\n     if (leveldb::kMajorVersion > 1 || (leveldb::kMajorVersion == 1 && leveldb::kMinorVersion >= 16)) {\n         // LevelDB versions before 1.16 consider short writes to be corruption. Only trigger error\n         // on corruption in later versions.\n-        options.paranoid_checks = true;\n+        options->paranoid_checks = true;\n     }\n-    SetMaxOpenFiles(&options);\n-    return options;\n+    SetMaxOpenFiles(options);\n+}\n+\n+// Custom deleter for unique_ptr<leveldb::Options>.\n+static void DeleteOptions(leveldb::Options* options)\n+{\n+    delete options->filter_policy;\n+    options->filter_policy = nullptr;\n+    delete options->info_log;\n+    options->info_log = nullptr;\n+    delete options->block_cache;\n+    options->block_cache = nullptr;\n+    options->env = nullptr;\n }\n \n CDBWrapper::CDBWrapper(const fs::path& path, size_t nCacheSize, bool fMemory, bool fWipe, bool obfuscate)\n-    : m_name{path.stem().string()}\n+    : options(new leveldb::Options, DeleteOptions), m_name{path.stem().string()}\n {\n     penv = nullptr;\n     readoptions.verify_checksums = true;\n     iteroptions.verify_checksums = true;\n     iteroptions.fill_cache = false;\n     syncoptions.sync = true;\n-    options = GetOptions(nCacheSize);\n-    options.create_if_missing = true;\n+    GetOptions(nCacheSize, options.get());\n+    options->create_if_missing = true;\n     if (fMemory) {\n         penv = leveldb::NewMemEnv(leveldb::Env::Default());\n-        options.env = penv;\n+        options->env = penv;\n     } else {\n         if (fWipe) {\n             LogPrintf(\"Wiping LevelDB in %s\\n\", path.string());\n-            leveldb::Status result = leveldb::DestroyDB(path.string(), options);\n+            leveldb::Status result = leveldb::DestroyDB(path.string(), *options);\n             dbwrapper_private::HandleError(result);\n         }\n         TryCreateDirectories(path);\n         LogPrintf(\"Opening LevelDB in %s\\n\", path.string());\n     }\n-    leveldb::Status status = leveldb::DB::Open(options, path.string(), &pdb);\n+    leveldb::Status status = leveldb::DB::Open(*options, path.string(), &pdb);\n+    if (!status.ok()) {\n+        delete penv;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r686109932",
      "id" : 686109932,
      "line" : 151,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NjEwOTkzMg==",
      "original_commit_id" : "6770f066b69c6c271e7096cc647d5d42762f6b05",
      "original_line" : 151,
      "original_position" : 71,
      "original_start_line" : null,
      "path" : "src/dbwrapper.cpp",
      "position" : 71,
      "pull_request_review_id" : 726560453,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-10T15:06:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686109932",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/292191?v=4",
         "events_url" : "https://api.github.com/users/Talkless/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Talkless/followers",
         "following_url" : "https://api.github.com/users/Talkless/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Talkless/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Talkless",
         "id" : 292191,
         "login" : "Talkless",
         "node_id" : "MDQ6VXNlcjI5MjE5MQ==",
         "organizations_url" : "https://api.github.com/users/Talkless/orgs",
         "received_events_url" : "https://api.github.com/users/Talkless/received_events",
         "repos_url" : "https://api.github.com/users/Talkless/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Talkless/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Talkless/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Talkless"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r686115676"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686115676"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "If `!status.ok` then `HandleError` throws and the destructor isn't called",
      "commit_id" : "6770f066b69c6c271e7096cc647d5d42762f6b05",
      "created_at" : "2021-08-10T15:13:27Z",
      "diff_hunk" : "@@ -97,46 +97,59 @@ static void SetMaxOpenFiles(leveldb::Options *options) {\n              options->max_open_files, default_open_files);\n }\n \n-static leveldb::Options GetOptions(size_t nCacheSize)\n+static void GetOptions(size_t nCacheSize, leveldb::Options* options)\n {\n-    leveldb::Options options;\n-    options.block_cache = leveldb::NewLRUCache(nCacheSize / 2);\n-    options.write_buffer_size = nCacheSize / 4; // up to two write buffers may be held in memory simultaneously\n-    options.filter_policy = leveldb::NewBloomFilterPolicy(10);\n-    options.compression = leveldb::kNoCompression;\n-    options.info_log = new CBitcoinLevelDBLogger();\n+    options->block_cache = leveldb::NewLRUCache(nCacheSize / 2);\n+    options->write_buffer_size = nCacheSize / 4; // up to two write buffers may be held in memory simultaneously\n+    options->filter_policy = leveldb::NewBloomFilterPolicy(10);\n+    options->compression = leveldb::kNoCompression;\n+    options->info_log = new CBitcoinLevelDBLogger();\n     if (leveldb::kMajorVersion > 1 || (leveldb::kMajorVersion == 1 && leveldb::kMinorVersion >= 16)) {\n         // LevelDB versions before 1.16 consider short writes to be corruption. Only trigger error\n         // on corruption in later versions.\n-        options.paranoid_checks = true;\n+        options->paranoid_checks = true;\n     }\n-    SetMaxOpenFiles(&options);\n-    return options;\n+    SetMaxOpenFiles(options);\n+}\n+\n+// Custom deleter for unique_ptr<leveldb::Options>.\n+static void DeleteOptions(leveldb::Options* options)\n+{\n+    delete options->filter_policy;\n+    options->filter_policy = nullptr;\n+    delete options->info_log;\n+    options->info_log = nullptr;\n+    delete options->block_cache;\n+    options->block_cache = nullptr;\n+    options->env = nullptr;\n }\n \n CDBWrapper::CDBWrapper(const fs::path& path, size_t nCacheSize, bool fMemory, bool fWipe, bool obfuscate)\n-    : m_name{path.stem().string()}\n+    : options(new leveldb::Options, DeleteOptions), m_name{path.stem().string()}\n {\n     penv = nullptr;\n     readoptions.verify_checksums = true;\n     iteroptions.verify_checksums = true;\n     iteroptions.fill_cache = false;\n     syncoptions.sync = true;\n-    options = GetOptions(nCacheSize);\n-    options.create_if_missing = true;\n+    GetOptions(nCacheSize, options.get());\n+    options->create_if_missing = true;\n     if (fMemory) {\n         penv = leveldb::NewMemEnv(leveldb::Env::Default());\n-        options.env = penv;\n+        options->env = penv;\n     } else {\n         if (fWipe) {\n             LogPrintf(\"Wiping LevelDB in %s\\n\", path.string());\n-            leveldb::Status result = leveldb::DestroyDB(path.string(), options);\n+            leveldb::Status result = leveldb::DestroyDB(path.string(), *options);\n             dbwrapper_private::HandleError(result);\n         }\n         TryCreateDirectories(path);\n         LogPrintf(\"Opening LevelDB in %s\\n\", path.string());\n     }\n-    leveldb::Status status = leveldb::DB::Open(options, path.string(), &pdb);\n+    leveldb::Status status = leveldb::DB::Open(*options, path.string(), &pdb);\n+    if (!status.ok()) {\n+        delete penv;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r686115676",
      "id" : 686115676,
      "in_reply_to_id" : 686109932,
      "line" : 151,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NjExNTY3Ng==",
      "original_commit_id" : "6770f066b69c6c271e7096cc647d5d42762f6b05",
      "original_line" : 151,
      "original_position" : 71,
      "original_start_line" : null,
      "path" : "src/dbwrapper.cpp",
      "position" : 71,
      "pull_request_review_id" : 726568150,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-10T15:13:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686115676",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15145615?v=4",
         "events_url" : "https://api.github.com/users/Crypt-iQ/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Crypt-iQ/followers",
         "following_url" : "https://api.github.com/users/Crypt-iQ/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Crypt-iQ/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Crypt-iQ",
         "id" : 15145615,
         "login" : "Crypt-iQ",
         "node_id" : "MDQ6VXNlcjE1MTQ1NjE1",
         "organizations_url" : "https://api.github.com/users/Crypt-iQ/orgs",
         "received_events_url" : "https://api.github.com/users/Crypt-iQ/received_events",
         "repos_url" : "https://api.github.com/users/Crypt-iQ/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Crypt-iQ/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Crypt-iQ/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Crypt-iQ"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r686783500"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686783500"
         }
      },
      "author_association" : "NONE",
      "body" : "Maybe worth making `penv` a `unique_ptr` too, if we need manual handling with `delete`? Or do you think this would be kinda out of scope for this PR?\r\n\r\nAdding addition `delete` into new code does not seem... \"right\" (https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rr-newdelete).",
      "commit_id" : "6770f066b69c6c271e7096cc647d5d42762f6b05",
      "created_at" : "2021-08-11T12:30:05Z",
      "diff_hunk" : "@@ -97,46 +97,59 @@ static void SetMaxOpenFiles(leveldb::Options *options) {\n              options->max_open_files, default_open_files);\n }\n \n-static leveldb::Options GetOptions(size_t nCacheSize)\n+static void GetOptions(size_t nCacheSize, leveldb::Options* options)\n {\n-    leveldb::Options options;\n-    options.block_cache = leveldb::NewLRUCache(nCacheSize / 2);\n-    options.write_buffer_size = nCacheSize / 4; // up to two write buffers may be held in memory simultaneously\n-    options.filter_policy = leveldb::NewBloomFilterPolicy(10);\n-    options.compression = leveldb::kNoCompression;\n-    options.info_log = new CBitcoinLevelDBLogger();\n+    options->block_cache = leveldb::NewLRUCache(nCacheSize / 2);\n+    options->write_buffer_size = nCacheSize / 4; // up to two write buffers may be held in memory simultaneously\n+    options->filter_policy = leveldb::NewBloomFilterPolicy(10);\n+    options->compression = leveldb::kNoCompression;\n+    options->info_log = new CBitcoinLevelDBLogger();\n     if (leveldb::kMajorVersion > 1 || (leveldb::kMajorVersion == 1 && leveldb::kMinorVersion >= 16)) {\n         // LevelDB versions before 1.16 consider short writes to be corruption. Only trigger error\n         // on corruption in later versions.\n-        options.paranoid_checks = true;\n+        options->paranoid_checks = true;\n     }\n-    SetMaxOpenFiles(&options);\n-    return options;\n+    SetMaxOpenFiles(options);\n+}\n+\n+// Custom deleter for unique_ptr<leveldb::Options>.\n+static void DeleteOptions(leveldb::Options* options)\n+{\n+    delete options->filter_policy;\n+    options->filter_policy = nullptr;\n+    delete options->info_log;\n+    options->info_log = nullptr;\n+    delete options->block_cache;\n+    options->block_cache = nullptr;\n+    options->env = nullptr;\n }\n \n CDBWrapper::CDBWrapper(const fs::path& path, size_t nCacheSize, bool fMemory, bool fWipe, bool obfuscate)\n-    : m_name{path.stem().string()}\n+    : options(new leveldb::Options, DeleteOptions), m_name{path.stem().string()}\n {\n     penv = nullptr;\n     readoptions.verify_checksums = true;\n     iteroptions.verify_checksums = true;\n     iteroptions.fill_cache = false;\n     syncoptions.sync = true;\n-    options = GetOptions(nCacheSize);\n-    options.create_if_missing = true;\n+    GetOptions(nCacheSize, options.get());\n+    options->create_if_missing = true;\n     if (fMemory) {\n         penv = leveldb::NewMemEnv(leveldb::Env::Default());\n-        options.env = penv;\n+        options->env = penv;\n     } else {\n         if (fWipe) {\n             LogPrintf(\"Wiping LevelDB in %s\\n\", path.string());\n-            leveldb::Status result = leveldb::DestroyDB(path.string(), options);\n+            leveldb::Status result = leveldb::DestroyDB(path.string(), *options);\n             dbwrapper_private::HandleError(result);\n         }\n         TryCreateDirectories(path);\n         LogPrintf(\"Opening LevelDB in %s\\n\", path.string());\n     }\n-    leveldb::Status status = leveldb::DB::Open(options, path.string(), &pdb);\n+    leveldb::Status status = leveldb::DB::Open(*options, path.string(), &pdb);\n+    if (!status.ok()) {\n+        delete penv;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r686783500",
      "id" : 686783500,
      "in_reply_to_id" : 686109932,
      "line" : 151,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4Njc4MzUwMA==",
      "original_commit_id" : "6770f066b69c6c271e7096cc647d5d42762f6b05",
      "original_line" : 151,
      "original_position" : 71,
      "original_start_line" : null,
      "path" : "src/dbwrapper.cpp",
      "position" : 71,
      "pull_request_review_id" : 727421712,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-11T12:30:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686783500",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/292191?v=4",
         "events_url" : "https://api.github.com/users/Talkless/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Talkless/followers",
         "following_url" : "https://api.github.com/users/Talkless/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Talkless/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Talkless",
         "id" : 292191,
         "login" : "Talkless",
         "node_id" : "MDQ6VXNlcjI5MjE5MQ==",
         "organizations_url" : "https://api.github.com/users/Talkless/orgs",
         "received_events_url" : "https://api.github.com/users/Talkless/received_events",
         "repos_url" : "https://api.github.com/users/Talkless/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Talkless/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Talkless/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Talkless"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r687097257"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687097257"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "good point, I can look into making it a `unique_ptr`",
      "commit_id" : "6770f066b69c6c271e7096cc647d5d42762f6b05",
      "created_at" : "2021-08-11T19:02:17Z",
      "diff_hunk" : "@@ -97,46 +97,59 @@ static void SetMaxOpenFiles(leveldb::Options *options) {\n              options->max_open_files, default_open_files);\n }\n \n-static leveldb::Options GetOptions(size_t nCacheSize)\n+static void GetOptions(size_t nCacheSize, leveldb::Options* options)\n {\n-    leveldb::Options options;\n-    options.block_cache = leveldb::NewLRUCache(nCacheSize / 2);\n-    options.write_buffer_size = nCacheSize / 4; // up to two write buffers may be held in memory simultaneously\n-    options.filter_policy = leveldb::NewBloomFilterPolicy(10);\n-    options.compression = leveldb::kNoCompression;\n-    options.info_log = new CBitcoinLevelDBLogger();\n+    options->block_cache = leveldb::NewLRUCache(nCacheSize / 2);\n+    options->write_buffer_size = nCacheSize / 4; // up to two write buffers may be held in memory simultaneously\n+    options->filter_policy = leveldb::NewBloomFilterPolicy(10);\n+    options->compression = leveldb::kNoCompression;\n+    options->info_log = new CBitcoinLevelDBLogger();\n     if (leveldb::kMajorVersion > 1 || (leveldb::kMajorVersion == 1 && leveldb::kMinorVersion >= 16)) {\n         // LevelDB versions before 1.16 consider short writes to be corruption. Only trigger error\n         // on corruption in later versions.\n-        options.paranoid_checks = true;\n+        options->paranoid_checks = true;\n     }\n-    SetMaxOpenFiles(&options);\n-    return options;\n+    SetMaxOpenFiles(options);\n+}\n+\n+// Custom deleter for unique_ptr<leveldb::Options>.\n+static void DeleteOptions(leveldb::Options* options)\n+{\n+    delete options->filter_policy;\n+    options->filter_policy = nullptr;\n+    delete options->info_log;\n+    options->info_log = nullptr;\n+    delete options->block_cache;\n+    options->block_cache = nullptr;\n+    options->env = nullptr;\n }\n \n CDBWrapper::CDBWrapper(const fs::path& path, size_t nCacheSize, bool fMemory, bool fWipe, bool obfuscate)\n-    : m_name{path.stem().string()}\n+    : options(new leveldb::Options, DeleteOptions), m_name{path.stem().string()}\n {\n     penv = nullptr;\n     readoptions.verify_checksums = true;\n     iteroptions.verify_checksums = true;\n     iteroptions.fill_cache = false;\n     syncoptions.sync = true;\n-    options = GetOptions(nCacheSize);\n-    options.create_if_missing = true;\n+    GetOptions(nCacheSize, options.get());\n+    options->create_if_missing = true;\n     if (fMemory) {\n         penv = leveldb::NewMemEnv(leveldb::Env::Default());\n-        options.env = penv;\n+        options->env = penv;\n     } else {\n         if (fWipe) {\n             LogPrintf(\"Wiping LevelDB in %s\\n\", path.string());\n-            leveldb::Status result = leveldb::DestroyDB(path.string(), options);\n+            leveldb::Status result = leveldb::DestroyDB(path.string(), *options);\n             dbwrapper_private::HandleError(result);\n         }\n         TryCreateDirectories(path);\n         LogPrintf(\"Opening LevelDB in %s\\n\", path.string());\n     }\n-    leveldb::Status status = leveldb::DB::Open(options, path.string(), &pdb);\n+    leveldb::Status status = leveldb::DB::Open(*options, path.string(), &pdb);\n+    if (!status.ok()) {\n+        delete penv;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r687097257",
      "id" : 687097257,
      "in_reply_to_id" : 686109932,
      "line" : 151,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NzA5NzI1Nw==",
      "original_commit_id" : "6770f066b69c6c271e7096cc647d5d42762f6b05",
      "original_line" : 151,
      "original_position" : 71,
      "original_start_line" : null,
      "path" : "src/dbwrapper.cpp",
      "position" : 71,
      "pull_request_review_id" : 727838725,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-11T19:02:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687097257",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15145615?v=4",
         "events_url" : "https://api.github.com/users/Crypt-iQ/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Crypt-iQ/followers",
         "following_url" : "https://api.github.com/users/Crypt-iQ/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Crypt-iQ/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Crypt-iQ",
         "id" : 15145615,
         "login" : "Crypt-iQ",
         "node_id" : "MDQ6VXNlcjE1MTQ1NjE1",
         "organizations_url" : "https://api.github.com/users/Crypt-iQ/orgs",
         "received_events_url" : "https://api.github.com/users/Crypt-iQ/received_events",
         "repos_url" : "https://api.github.com/users/Crypt-iQ/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Crypt-iQ/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Crypt-iQ/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Crypt-iQ"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-10-15T09:39:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22663#issuecomment-944151438",
      "id" : 944151438,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22663",
      "node_id" : "IC_kwDOABII5844RpuO",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/944151438/reactions"
      },
      "updated_at" : "2021-10-15T09:39:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/944151438",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r739490464"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/739490464"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"dbwrapper: wrap options in unique_ptr and use DeleteOptions\" (6770f066b69c6c271e7096cc647d5d42762f6b05)\r\n\r\nIt's not too important, but I don't think there's an actual need to change this function, and the previous version of this that just returned a struct instead of dereferencing a pointer seemed more straightforward.\r\n\r\nTo keep the previous version, I believe you would just need to write `new leveldb::Options{GetOptions(...)}` below.\r\n\r\nWould be nice to add `[[nodiscard]]` to the previous version, if you did keep it though.\r\n",
      "commit_id" : "6770f066b69c6c271e7096cc647d5d42762f6b05",
      "created_at" : "2021-10-29T19:41:09Z",
      "diff_hunk" : "@@ -97,46 +97,59 @@ static void SetMaxOpenFiles(leveldb::Options *options) {\n              options->max_open_files, default_open_files);\n }\n \n-static leveldb::Options GetOptions(size_t nCacheSize)\n+static void GetOptions(size_t nCacheSize, leveldb::Options* options)\n {\n-    leveldb::Options options;\n-    options.block_cache = leveldb::NewLRUCache(nCacheSize / 2);\n-    options.write_buffer_size = nCacheSize / 4; // up to two write buffers may be held in memory simultaneously\n-    options.filter_policy = leveldb::NewBloomFilterPolicy(10);\n-    options.compression = leveldb::kNoCompression;\n-    options.info_log = new CBitcoinLevelDBLogger();\n+    options->block_cache = leveldb::NewLRUCache(nCacheSize / 2);\n+    options->write_buffer_size = nCacheSize / 4; // up to two write buffers may be held in memory simultaneously\n+    options->filter_policy = leveldb::NewBloomFilterPolicy(10);\n+    options->compression = leveldb::kNoCompression;\n+    options->info_log = new CBitcoinLevelDBLogger();\n     if (leveldb::kMajorVersion > 1 || (leveldb::kMajorVersion == 1 && leveldb::kMinorVersion >= 16)) {\n         // LevelDB versions before 1.16 consider short writes to be corruption. Only trigger error\n         // on corruption in later versions.\n-        options.paranoid_checks = true;\n+        options->paranoid_checks = true;\n     }\n-    SetMaxOpenFiles(&options);\n-    return options;\n+    SetMaxOpenFiles(options);\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r739490464",
      "id" : 739490464,
      "line" : 113,
      "node_id" : "PRRC_kwDOABII584sE7qg",
      "original_commit_id" : "6770f066b69c6c271e7096cc647d5d42762f6b05",
      "original_line" : 113,
      "original_position" : 27,
      "original_start_line" : 100,
      "path" : "src/dbwrapper.cpp",
      "position" : 27,
      "pull_request_review_id" : 793395719,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/739490464/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 100,
      "start_side" : "RIGHT",
      "updated_at" : "2021-10-29T20:14:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/739490464",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r739496546"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/739496546"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"dbwrapper: wrap options in unique_ptr and use DeleteOptions\" (6770f066b69c6c271e7096cc647d5d42762f6b05)\r\n\r\nIt seems dodgy to set env to null without freeing it here. I think it would be better to either:\r\n\r\n- Set this to null immediately in the places where the env is deleted, in which case you could `assert(!options->env)` here\r\n- Or, to just drop this line and treat `env` and `options` lifetimes as more independent\r\n- Or, to add a comment like \"env was previously deleted and should not be freed here\" here to make it clearer the inconsistency here is intentional",
      "commit_id" : "6770f066b69c6c271e7096cc647d5d42762f6b05",
      "created_at" : "2021-10-29T19:51:55Z",
      "diff_hunk" : "@@ -97,46 +97,59 @@ static void SetMaxOpenFiles(leveldb::Options *options) {\n              options->max_open_files, default_open_files);\n }\n \n-static leveldb::Options GetOptions(size_t nCacheSize)\n+static void GetOptions(size_t nCacheSize, leveldb::Options* options)\n {\n-    leveldb::Options options;\n-    options.block_cache = leveldb::NewLRUCache(nCacheSize / 2);\n-    options.write_buffer_size = nCacheSize / 4; // up to two write buffers may be held in memory simultaneously\n-    options.filter_policy = leveldb::NewBloomFilterPolicy(10);\n-    options.compression = leveldb::kNoCompression;\n-    options.info_log = new CBitcoinLevelDBLogger();\n+    options->block_cache = leveldb::NewLRUCache(nCacheSize / 2);\n+    options->write_buffer_size = nCacheSize / 4; // up to two write buffers may be held in memory simultaneously\n+    options->filter_policy = leveldb::NewBloomFilterPolicy(10);\n+    options->compression = leveldb::kNoCompression;\n+    options->info_log = new CBitcoinLevelDBLogger();\n     if (leveldb::kMajorVersion > 1 || (leveldb::kMajorVersion == 1 && leveldb::kMinorVersion >= 16)) {\n         // LevelDB versions before 1.16 consider short writes to be corruption. Only trigger error\n         // on corruption in later versions.\n-        options.paranoid_checks = true;\n+        options->paranoid_checks = true;\n     }\n-    SetMaxOpenFiles(&options);\n-    return options;\n+    SetMaxOpenFiles(options);\n+}\n+\n+// Custom deleter for unique_ptr<leveldb::Options>.\n+static void DeleteOptions(leveldb::Options* options)\n+{\n+    delete options->filter_policy;\n+    options->filter_policy = nullptr;\n+    delete options->info_log;\n+    options->info_log = nullptr;\n+    delete options->block_cache;\n+    options->block_cache = nullptr;\n+    options->env = nullptr;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r739496546",
      "id" : 739496546,
      "line" : 124,
      "node_id" : "PRRC_kwDOABII584sE9Ji",
      "original_commit_id" : "6770f066b69c6c271e7096cc647d5d42762f6b05",
      "original_line" : 124,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/dbwrapper.cpp",
      "position" : 38,
      "pull_request_review_id" : 793395719,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/739496546/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-29T20:14:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/739496546",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r739499514"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/739499514"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/22663#discussion_r686109932\r\n\r\n> If `penv` is deleted, then `~CDBWrapper()` gonna delete it again? Missing `= nullptr`?\r\n\r\nIn commit \"dbwrapper: wrap options in unique_ptr and use DeleteOptions\" (6770f066b69c6c271e7096cc647d5d42762f6b05)\r\n\r\nIt does seem fragile to rely on `HandleError` bypassing the destructor to avoid a double-delete. Would second the suggestion to add `= nullptr` to make the destructor safe if it were called. Or could add a \"// Deleting env here without resetting it is safe because the destructor will never be called\" comment to clarify. Or could make env a unique_ptr, which also seemed like a good suggestion",
      "commit_id" : "6770f066b69c6c271e7096cc647d5d42762f6b05",
      "created_at" : "2021-10-29T19:58:04Z",
      "diff_hunk" : "@@ -97,46 +97,59 @@ static void SetMaxOpenFiles(leveldb::Options *options) {\n              options->max_open_files, default_open_files);\n }\n \n-static leveldb::Options GetOptions(size_t nCacheSize)\n+static void GetOptions(size_t nCacheSize, leveldb::Options* options)\n {\n-    leveldb::Options options;\n-    options.block_cache = leveldb::NewLRUCache(nCacheSize / 2);\n-    options.write_buffer_size = nCacheSize / 4; // up to two write buffers may be held in memory simultaneously\n-    options.filter_policy = leveldb::NewBloomFilterPolicy(10);\n-    options.compression = leveldb::kNoCompression;\n-    options.info_log = new CBitcoinLevelDBLogger();\n+    options->block_cache = leveldb::NewLRUCache(nCacheSize / 2);\n+    options->write_buffer_size = nCacheSize / 4; // up to two write buffers may be held in memory simultaneously\n+    options->filter_policy = leveldb::NewBloomFilterPolicy(10);\n+    options->compression = leveldb::kNoCompression;\n+    options->info_log = new CBitcoinLevelDBLogger();\n     if (leveldb::kMajorVersion > 1 || (leveldb::kMajorVersion == 1 && leveldb::kMinorVersion >= 16)) {\n         // LevelDB versions before 1.16 consider short writes to be corruption. Only trigger error\n         // on corruption in later versions.\n-        options.paranoid_checks = true;\n+        options->paranoid_checks = true;\n     }\n-    SetMaxOpenFiles(&options);\n-    return options;\n+    SetMaxOpenFiles(options);\n+}\n+\n+// Custom deleter for unique_ptr<leveldb::Options>.\n+static void DeleteOptions(leveldb::Options* options)\n+{\n+    delete options->filter_policy;\n+    options->filter_policy = nullptr;\n+    delete options->info_log;\n+    options->info_log = nullptr;\n+    delete options->block_cache;\n+    options->block_cache = nullptr;\n+    options->env = nullptr;\n }\n \n CDBWrapper::CDBWrapper(const fs::path& path, size_t nCacheSize, bool fMemory, bool fWipe, bool obfuscate)\n-    : m_name{path.stem().string()}\n+    : options(new leveldb::Options, DeleteOptions), m_name{path.stem().string()}\n {\n     penv = nullptr;\n     readoptions.verify_checksums = true;\n     iteroptions.verify_checksums = true;\n     iteroptions.fill_cache = false;\n     syncoptions.sync = true;\n-    options = GetOptions(nCacheSize);\n-    options.create_if_missing = true;\n+    GetOptions(nCacheSize, options.get());\n+    options->create_if_missing = true;\n     if (fMemory) {\n         penv = leveldb::NewMemEnv(leveldb::Env::Default());\n-        options.env = penv;\n+        options->env = penv;\n     } else {\n         if (fWipe) {\n             LogPrintf(\"Wiping LevelDB in %s\\n\", path.string());\n-            leveldb::Status result = leveldb::DestroyDB(path.string(), options);\n+            leveldb::Status result = leveldb::DestroyDB(path.string(), *options);\n             dbwrapper_private::HandleError(result);\n         }\n         TryCreateDirectories(path);\n         LogPrintf(\"Opening LevelDB in %s\\n\", path.string());\n     }\n-    leveldb::Status status = leveldb::DB::Open(options, path.string(), &pdb);\n+    leveldb::Status status = leveldb::DB::Open(*options, path.string(), &pdb);\n+    if (!status.ok()) {\n+        delete penv;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r739499514",
      "id" : 739499514,
      "in_reply_to_id" : 686109932,
      "line" : 151,
      "node_id" : "PRRC_kwDOABII584sE936",
      "original_commit_id" : "6770f066b69c6c271e7096cc647d5d42762f6b05",
      "original_line" : 151,
      "original_position" : 71,
      "original_start_line" : null,
      "path" : "src/dbwrapper.cpp",
      "position" : 71,
      "pull_request_review_id" : 793395719,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/739499514/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-29T20:14:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/739499514",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r739500531"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/739500531"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"dbwrapper: wrap options in unique_ptr and use DeleteOptions\" (6770f066b69c6c271e7096cc647d5d42762f6b05)\r\n\r\nI liked the suggestion to make `env` a unique_ptr https://github.com/bitcoin/bitcoin/pull/22663#discussion_r686783500, and maybe `pdb` could be a unique_ptr too?",
      "commit_id" : "6770f066b69c6c271e7096cc647d5d42762f6b05",
      "created_at" : "2021-10-29T20:00:07Z",
      "diff_hunk" : "@@ -170,14 +183,7 @@ CDBWrapper::~CDBWrapper()\n {\n     delete pdb;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r739500531",
      "id" : 739500531,
      "line" : 184,
      "node_id" : "PRRC_kwDOABII584sE-Hz",
      "original_commit_id" : "6770f066b69c6c271e7096cc647d5d42762f6b05",
      "original_line" : 184,
      "original_position" : 78,
      "original_start_line" : null,
      "path" : "src/dbwrapper.cpp",
      "position" : 78,
      "pull_request_review_id" : 793395719,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/739500531/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-29T20:14:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/739500531",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r739504112"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/739504112"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"dbwrapper: wrap options in unique_ptr and use DeleteOptions\" (6770f066b69c6c271e7096cc647d5d42762f6b05)\r\n\r\nCustom deleter seems to be forgetting to `delete options`, which would explain the fuzzing leak? https://github.com/bitcoin/bitcoin/pull/22663#issuecomment-894792761",
      "commit_id" : "6770f066b69c6c271e7096cc647d5d42762f6b05",
      "created_at" : "2021-10-29T20:07:30Z",
      "diff_hunk" : "@@ -97,46 +97,59 @@ static void SetMaxOpenFiles(leveldb::Options *options) {\n              options->max_open_files, default_open_files);\n }\n \n-static leveldb::Options GetOptions(size_t nCacheSize)\n+static void GetOptions(size_t nCacheSize, leveldb::Options* options)\n {\n-    leveldb::Options options;\n-    options.block_cache = leveldb::NewLRUCache(nCacheSize / 2);\n-    options.write_buffer_size = nCacheSize / 4; // up to two write buffers may be held in memory simultaneously\n-    options.filter_policy = leveldb::NewBloomFilterPolicy(10);\n-    options.compression = leveldb::kNoCompression;\n-    options.info_log = new CBitcoinLevelDBLogger();\n+    options->block_cache = leveldb::NewLRUCache(nCacheSize / 2);\n+    options->write_buffer_size = nCacheSize / 4; // up to two write buffers may be held in memory simultaneously\n+    options->filter_policy = leveldb::NewBloomFilterPolicy(10);\n+    options->compression = leveldb::kNoCompression;\n+    options->info_log = new CBitcoinLevelDBLogger();\n     if (leveldb::kMajorVersion > 1 || (leveldb::kMajorVersion == 1 && leveldb::kMinorVersion >= 16)) {\n         // LevelDB versions before 1.16 consider short writes to be corruption. Only trigger error\n         // on corruption in later versions.\n-        options.paranoid_checks = true;\n+        options->paranoid_checks = true;\n     }\n-    SetMaxOpenFiles(&options);\n-    return options;\n+    SetMaxOpenFiles(options);\n+}\n+\n+// Custom deleter for unique_ptr<leveldb::Options>.\n+static void DeleteOptions(leveldb::Options* options)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r739504112",
      "id" : 739504112,
      "line" : 116,
      "node_id" : "PRRC_kwDOABII584sE-_w",
      "original_commit_id" : "6770f066b69c6c271e7096cc647d5d42762f6b05",
      "original_line" : 116,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/dbwrapper.cpp",
      "position" : 30,
      "pull_request_review_id" : 793395719,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/739504112/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-29T20:14:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/739504112",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r746714737"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/746714737"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I agree with @ryanofsky. I don't think there's a strong need to change this function, but if there is, I would prefer it to return the target type `std::unique_ptr<leveldb::Options, void (*)(leveldb::Options*)` directly, instead of using a pointer positional out argument (which, strictly, seems a deterioration of API clarity to me).",
      "commit_id" : "6770f066b69c6c271e7096cc647d5d42762f6b05",
      "created_at" : "2021-11-10T15:41:27Z",
      "diff_hunk" : "@@ -97,46 +97,59 @@ static void SetMaxOpenFiles(leveldb::Options *options) {\n              options->max_open_files, default_open_files);\n }\n \n-static leveldb::Options GetOptions(size_t nCacheSize)\n+static void GetOptions(size_t nCacheSize, leveldb::Options* options)\n {\n-    leveldb::Options options;\n-    options.block_cache = leveldb::NewLRUCache(nCacheSize / 2);\n-    options.write_buffer_size = nCacheSize / 4; // up to two write buffers may be held in memory simultaneously\n-    options.filter_policy = leveldb::NewBloomFilterPolicy(10);\n-    options.compression = leveldb::kNoCompression;\n-    options.info_log = new CBitcoinLevelDBLogger();\n+    options->block_cache = leveldb::NewLRUCache(nCacheSize / 2);\n+    options->write_buffer_size = nCacheSize / 4; // up to two write buffers may be held in memory simultaneously\n+    options->filter_policy = leveldb::NewBloomFilterPolicy(10);\n+    options->compression = leveldb::kNoCompression;\n+    options->info_log = new CBitcoinLevelDBLogger();\n     if (leveldb::kMajorVersion > 1 || (leveldb::kMajorVersion == 1 && leveldb::kMinorVersion >= 16)) {\n         // LevelDB versions before 1.16 consider short writes to be corruption. Only trigger error\n         // on corruption in later versions.\n-        options.paranoid_checks = true;\n+        options->paranoid_checks = true;\n     }\n-    SetMaxOpenFiles(&options);\n-    return options;\n+    SetMaxOpenFiles(options);\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r746714737",
      "id" : 746714737,
      "in_reply_to_id" : 739490464,
      "line" : 113,
      "node_id" : "PRRC_kwDOABII584sgfZx",
      "original_commit_id" : "6770f066b69c6c271e7096cc647d5d42762f6b05",
      "original_line" : 113,
      "original_position" : 27,
      "original_start_line" : 100,
      "path" : "src/dbwrapper.cpp",
      "position" : 27,
      "pull_request_review_id" : 802774453,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/746714737/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 100,
      "start_side" : "RIGHT",
      "updated_at" : "2021-11-10T15:41:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/746714737",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r747142169"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/747142169"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Will work on a patch with this, thanks for the review",
      "commit_id" : "6770f066b69c6c271e7096cc647d5d42762f6b05",
      "created_at" : "2021-11-11T01:49:24Z",
      "diff_hunk" : "@@ -97,46 +97,59 @@ static void SetMaxOpenFiles(leveldb::Options *options) {\n              options->max_open_files, default_open_files);\n }\n \n-static leveldb::Options GetOptions(size_t nCacheSize)\n+static void GetOptions(size_t nCacheSize, leveldb::Options* options)\n {\n-    leveldb::Options options;\n-    options.block_cache = leveldb::NewLRUCache(nCacheSize / 2);\n-    options.write_buffer_size = nCacheSize / 4; // up to two write buffers may be held in memory simultaneously\n-    options.filter_policy = leveldb::NewBloomFilterPolicy(10);\n-    options.compression = leveldb::kNoCompression;\n-    options.info_log = new CBitcoinLevelDBLogger();\n+    options->block_cache = leveldb::NewLRUCache(nCacheSize / 2);\n+    options->write_buffer_size = nCacheSize / 4; // up to two write buffers may be held in memory simultaneously\n+    options->filter_policy = leveldb::NewBloomFilterPolicy(10);\n+    options->compression = leveldb::kNoCompression;\n+    options->info_log = new CBitcoinLevelDBLogger();\n     if (leveldb::kMajorVersion > 1 || (leveldb::kMajorVersion == 1 && leveldb::kMinorVersion >= 16)) {\n         // LevelDB versions before 1.16 consider short writes to be corruption. Only trigger error\n         // on corruption in later versions.\n-        options.paranoid_checks = true;\n+        options->paranoid_checks = true;\n     }\n-    SetMaxOpenFiles(&options);\n-    return options;\n+    SetMaxOpenFiles(options);\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r747142169",
      "id" : 747142169,
      "in_reply_to_id" : 739490464,
      "line" : 113,
      "node_id" : "PRRC_kwDOABII584siHwZ",
      "original_commit_id" : "6770f066b69c6c271e7096cc647d5d42762f6b05",
      "original_line" : 113,
      "original_position" : 27,
      "original_start_line" : 100,
      "path" : "src/dbwrapper.cpp",
      "position" : 27,
      "pull_request_review_id" : 803337984,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/747142169/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 100,
      "start_side" : "RIGHT",
      "updated_at" : "2021-11-11T01:49:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/747142169",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15145615?v=4",
         "events_url" : "https://api.github.com/users/Crypt-iQ/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Crypt-iQ/followers",
         "following_url" : "https://api.github.com/users/Crypt-iQ/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Crypt-iQ/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Crypt-iQ",
         "id" : 15145615,
         "login" : "Crypt-iQ",
         "node_id" : "MDQ6VXNlcjE1MTQ1NjE1",
         "organizations_url" : "https://api.github.com/users/Crypt-iQ/orgs",
         "received_events_url" : "https://api.github.com/users/Crypt-iQ/received_events",
         "repos_url" : "https://api.github.com/users/Crypt-iQ/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Crypt-iQ/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Crypt-iQ/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Crypt-iQ"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@Crypt-iQ can you please respond to @ryanofsky's comments and rebase ?",
      "created_at" : "2021-12-15T19:52:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22663#issuecomment-995164163",
      "id" : 995164163,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22663",
      "node_id" : "IC_kwDOABII5847UQAD",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/995164163/reactions"
      },
      "updated_at" : "2021-12-15T19:52:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/995164163",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Hi yes, I can get to it this weekend",
      "created_at" : "2021-12-15T21:31:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22663#issuecomment-995229505",
      "id" : 995229505,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22663",
      "node_id" : "IC_kwDOABII5847Uf9B",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/995229505/reactions"
      },
      "updated_at" : "2021-12-15T21:31:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/995229505",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15145615?v=4",
         "events_url" : "https://api.github.com/users/Crypt-iQ/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Crypt-iQ/followers",
         "following_url" : "https://api.github.com/users/Crypt-iQ/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Crypt-iQ/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Crypt-iQ",
         "id" : 15145615,
         "login" : "Crypt-iQ",
         "node_id" : "MDQ6VXNlcjE1MTQ1NjE1",
         "organizations_url" : "https://api.github.com/users/Crypt-iQ/orgs",
         "received_events_url" : "https://api.github.com/users/Crypt-iQ/received_events",
         "repos_url" : "https://api.github.com/users/Crypt-iQ/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Crypt-iQ/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Crypt-iQ/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Crypt-iQ"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r772485050"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772485050"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The latest change makes `penv` a unique_ptr",
      "commit_id" : "7ba6aa28c762e0d17230df94a50481acab55e72d",
      "created_at" : "2021-12-20T16:02:32Z",
      "diff_hunk" : "@@ -97,46 +97,59 @@ static void SetMaxOpenFiles(leveldb::Options *options) {\n              options->max_open_files, default_open_files);\n }\n \n-static leveldb::Options GetOptions(size_t nCacheSize)\n+static void GetOptions(size_t nCacheSize, leveldb::Options* options)\n {\n-    leveldb::Options options;\n-    options.block_cache = leveldb::NewLRUCache(nCacheSize / 2);\n-    options.write_buffer_size = nCacheSize / 4; // up to two write buffers may be held in memory simultaneously\n-    options.filter_policy = leveldb::NewBloomFilterPolicy(10);\n-    options.compression = leveldb::kNoCompression;\n-    options.info_log = new CBitcoinLevelDBLogger();\n+    options->block_cache = leveldb::NewLRUCache(nCacheSize / 2);\n+    options->write_buffer_size = nCacheSize / 4; // up to two write buffers may be held in memory simultaneously\n+    options->filter_policy = leveldb::NewBloomFilterPolicy(10);\n+    options->compression = leveldb::kNoCompression;\n+    options->info_log = new CBitcoinLevelDBLogger();\n     if (leveldb::kMajorVersion > 1 || (leveldb::kMajorVersion == 1 && leveldb::kMinorVersion >= 16)) {\n         // LevelDB versions before 1.16 consider short writes to be corruption. Only trigger error\n         // on corruption in later versions.\n-        options.paranoid_checks = true;\n+        options->paranoid_checks = true;\n     }\n-    SetMaxOpenFiles(&options);\n-    return options;\n+    SetMaxOpenFiles(options);\n+}\n+\n+// Custom deleter for unique_ptr<leveldb::Options>.\n+static void DeleteOptions(leveldb::Options* options)\n+{\n+    delete options->filter_policy;\n+    options->filter_policy = nullptr;\n+    delete options->info_log;\n+    options->info_log = nullptr;\n+    delete options->block_cache;\n+    options->block_cache = nullptr;\n+    options->env = nullptr;\n }\n \n CDBWrapper::CDBWrapper(const fs::path& path, size_t nCacheSize, bool fMemory, bool fWipe, bool obfuscate)\n-    : m_name{path.stem().string()}\n+    : options(new leveldb::Options, DeleteOptions), m_name{path.stem().string()}\n {\n     penv = nullptr;\n     readoptions.verify_checksums = true;\n     iteroptions.verify_checksums = true;\n     iteroptions.fill_cache = false;\n     syncoptions.sync = true;\n-    options = GetOptions(nCacheSize);\n-    options.create_if_missing = true;\n+    GetOptions(nCacheSize, options.get());\n+    options->create_if_missing = true;\n     if (fMemory) {\n         penv = leveldb::NewMemEnv(leveldb::Env::Default());\n-        options.env = penv;\n+        options->env = penv;\n     } else {\n         if (fWipe) {\n             LogPrintf(\"Wiping LevelDB in %s\\n\", path.string());\n-            leveldb::Status result = leveldb::DestroyDB(path.string(), options);\n+            leveldb::Status result = leveldb::DestroyDB(path.string(), *options);\n             dbwrapper_private::HandleError(result);\n         }\n         TryCreateDirectories(path);\n         LogPrintf(\"Opening LevelDB in %s\\n\", path.string());\n     }\n-    leveldb::Status status = leveldb::DB::Open(options, path.string(), &pdb);\n+    leveldb::Status status = leveldb::DB::Open(*options, path.string(), &pdb);\n+    if (!status.ok()) {\n+        delete penv;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r772485050",
      "id" : 772485050,
      "in_reply_to_id" : 686109932,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584uCy-6",
      "original_commit_id" : "6770f066b69c6c271e7096cc647d5d42762f6b05",
      "original_line" : 151,
      "original_position" : 71,
      "original_start_line" : null,
      "path" : "src/dbwrapper.cpp",
      "position" : null,
      "pull_request_review_id" : 836559866,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772485050/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-20T16:02:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772485050",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15145615?v=4",
         "events_url" : "https://api.github.com/users/Crypt-iQ/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Crypt-iQ/followers",
         "following_url" : "https://api.github.com/users/Crypt-iQ/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Crypt-iQ/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Crypt-iQ",
         "id" : 15145615,
         "login" : "Crypt-iQ",
         "node_id" : "MDQ6VXNlcjE1MTQ1NjE1",
         "organizations_url" : "https://api.github.com/users/Crypt-iQ/orgs",
         "received_events_url" : "https://api.github.com/users/Crypt-iQ/received_events",
         "repos_url" : "https://api.github.com/users/Crypt-iQ/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Crypt-iQ/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Crypt-iQ/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Crypt-iQ"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r772485535"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772485535"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Latest change lifts the `GetOptions` logic into the ctor of `LevelDbOptions`",
      "commit_id" : "7ba6aa28c762e0d17230df94a50481acab55e72d",
      "created_at" : "2021-12-20T16:03:12Z",
      "diff_hunk" : "@@ -97,46 +97,59 @@ static void SetMaxOpenFiles(leveldb::Options *options) {\n              options->max_open_files, default_open_files);\n }\n \n-static leveldb::Options GetOptions(size_t nCacheSize)\n+static void GetOptions(size_t nCacheSize, leveldb::Options* options)\n {\n-    leveldb::Options options;\n-    options.block_cache = leveldb::NewLRUCache(nCacheSize / 2);\n-    options.write_buffer_size = nCacheSize / 4; // up to two write buffers may be held in memory simultaneously\n-    options.filter_policy = leveldb::NewBloomFilterPolicy(10);\n-    options.compression = leveldb::kNoCompression;\n-    options.info_log = new CBitcoinLevelDBLogger();\n+    options->block_cache = leveldb::NewLRUCache(nCacheSize / 2);\n+    options->write_buffer_size = nCacheSize / 4; // up to two write buffers may be held in memory simultaneously\n+    options->filter_policy = leveldb::NewBloomFilterPolicy(10);\n+    options->compression = leveldb::kNoCompression;\n+    options->info_log = new CBitcoinLevelDBLogger();\n     if (leveldb::kMajorVersion > 1 || (leveldb::kMajorVersion == 1 && leveldb::kMinorVersion >= 16)) {\n         // LevelDB versions before 1.16 consider short writes to be corruption. Only trigger error\n         // on corruption in later versions.\n-        options.paranoid_checks = true;\n+        options->paranoid_checks = true;\n     }\n-    SetMaxOpenFiles(&options);\n-    return options;\n+    SetMaxOpenFiles(options);\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r772485535",
      "id" : 772485535,
      "in_reply_to_id" : 739490464,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584uCzGf",
      "original_commit_id" : "6770f066b69c6c271e7096cc647d5d42762f6b05",
      "original_line" : 109,
      "original_position" : 27,
      "original_start_line" : 100,
      "path" : "src/dbwrapper.cpp",
      "position" : null,
      "pull_request_review_id" : 836560636,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772485535/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-12-20T16:03:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772485535",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15145615?v=4",
         "events_url" : "https://api.github.com/users/Crypt-iQ/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Crypt-iQ/followers",
         "following_url" : "https://api.github.com/users/Crypt-iQ/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Crypt-iQ/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Crypt-iQ",
         "id" : 15145615,
         "login" : "Crypt-iQ",
         "node_id" : "MDQ6VXNlcjE1MTQ1NjE1",
         "organizations_url" : "https://api.github.com/users/Crypt-iQ/orgs",
         "received_events_url" : "https://api.github.com/users/Crypt-iQ/received_events",
         "repos_url" : "https://api.github.com/users/Crypt-iQ/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Crypt-iQ/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Crypt-iQ/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Crypt-iQ"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r772486835"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772486835"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I opted for the second approach and dropped the line",
      "commit_id" : "7ba6aa28c762e0d17230df94a50481acab55e72d",
      "created_at" : "2021-12-20T16:04:51Z",
      "diff_hunk" : "@@ -97,46 +97,59 @@ static void SetMaxOpenFiles(leveldb::Options *options) {\n              options->max_open_files, default_open_files);\n }\n \n-static leveldb::Options GetOptions(size_t nCacheSize)\n+static void GetOptions(size_t nCacheSize, leveldb::Options* options)\n {\n-    leveldb::Options options;\n-    options.block_cache = leveldb::NewLRUCache(nCacheSize / 2);\n-    options.write_buffer_size = nCacheSize / 4; // up to two write buffers may be held in memory simultaneously\n-    options.filter_policy = leveldb::NewBloomFilterPolicy(10);\n-    options.compression = leveldb::kNoCompression;\n-    options.info_log = new CBitcoinLevelDBLogger();\n+    options->block_cache = leveldb::NewLRUCache(nCacheSize / 2);\n+    options->write_buffer_size = nCacheSize / 4; // up to two write buffers may be held in memory simultaneously\n+    options->filter_policy = leveldb::NewBloomFilterPolicy(10);\n+    options->compression = leveldb::kNoCompression;\n+    options->info_log = new CBitcoinLevelDBLogger();\n     if (leveldb::kMajorVersion > 1 || (leveldb::kMajorVersion == 1 && leveldb::kMinorVersion >= 16)) {\n         // LevelDB versions before 1.16 consider short writes to be corruption. Only trigger error\n         // on corruption in later versions.\n-        options.paranoid_checks = true;\n+        options->paranoid_checks = true;\n     }\n-    SetMaxOpenFiles(&options);\n-    return options;\n+    SetMaxOpenFiles(options);\n+}\n+\n+// Custom deleter for unique_ptr<leveldb::Options>.\n+static void DeleteOptions(leveldb::Options* options)\n+{\n+    delete options->filter_policy;\n+    options->filter_policy = nullptr;\n+    delete options->info_log;\n+    options->info_log = nullptr;\n+    delete options->block_cache;\n+    options->block_cache = nullptr;\n+    options->env = nullptr;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r772486835",
      "id" : 772486835,
      "in_reply_to_id" : 739496546,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584uCzaz",
      "original_commit_id" : "6770f066b69c6c271e7096cc647d5d42762f6b05",
      "original_line" : 124,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/dbwrapper.cpp",
      "position" : null,
      "pull_request_review_id" : 836562577,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772486835/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-20T16:04:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772486835",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15145615?v=4",
         "events_url" : "https://api.github.com/users/Crypt-iQ/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Crypt-iQ/followers",
         "following_url" : "https://api.github.com/users/Crypt-iQ/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Crypt-iQ/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Crypt-iQ",
         "id" : 15145615,
         "login" : "Crypt-iQ",
         "node_id" : "MDQ6VXNlcjE1MTQ1NjE1",
         "organizations_url" : "https://api.github.com/users/Crypt-iQ/orgs",
         "received_events_url" : "https://api.github.com/users/Crypt-iQ/received_events",
         "repos_url" : "https://api.github.com/users/Crypt-iQ/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Crypt-iQ/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Crypt-iQ/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Crypt-iQ"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r772488258"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772488258"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I was not sure how to make `pdb` a unique_ptr and also pass it in to `Open` as `leveldb::DB**` when it is `nullptr` at this point. Maybe I am missing something.",
      "commit_id" : "7ba6aa28c762e0d17230df94a50481acab55e72d",
      "created_at" : "2021-12-20T16:06:48Z",
      "diff_hunk" : "@@ -170,14 +183,7 @@ CDBWrapper::~CDBWrapper()\n {\n     delete pdb;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r772488258",
      "id" : 772488258,
      "in_reply_to_id" : 739500531,
      "line" : 183,
      "node_id" : "PRRC_kwDOABII584uCzxC",
      "original_commit_id" : "6770f066b69c6c271e7096cc647d5d42762f6b05",
      "original_line" : 183,
      "original_position" : 78,
      "original_start_line" : null,
      "path" : "src/dbwrapper.cpp",
      "position" : 62,
      "pull_request_review_id" : 836564709,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772488258/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-20T16:06:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772488258",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15145615?v=4",
         "events_url" : "https://api.github.com/users/Crypt-iQ/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Crypt-iQ/followers",
         "following_url" : "https://api.github.com/users/Crypt-iQ/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Crypt-iQ/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Crypt-iQ",
         "id" : 15145615,
         "login" : "Crypt-iQ",
         "node_id" : "MDQ6VXNlcjE1MTQ1NjE1",
         "organizations_url" : "https://api.github.com/users/Crypt-iQ/orgs",
         "received_events_url" : "https://api.github.com/users/Crypt-iQ/received_events",
         "repos_url" : "https://api.github.com/users/Crypt-iQ/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Crypt-iQ/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Crypt-iQ/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Crypt-iQ"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r772488529"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772488529"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "No longer using a custom deleter and instead using `~LevelDbOptions`",
      "commit_id" : "7ba6aa28c762e0d17230df94a50481acab55e72d",
      "created_at" : "2021-12-20T16:07:09Z",
      "diff_hunk" : "@@ -97,46 +97,59 @@ static void SetMaxOpenFiles(leveldb::Options *options) {\n              options->max_open_files, default_open_files);\n }\n \n-static leveldb::Options GetOptions(size_t nCacheSize)\n+static void GetOptions(size_t nCacheSize, leveldb::Options* options)\n {\n-    leveldb::Options options;\n-    options.block_cache = leveldb::NewLRUCache(nCacheSize / 2);\n-    options.write_buffer_size = nCacheSize / 4; // up to two write buffers may be held in memory simultaneously\n-    options.filter_policy = leveldb::NewBloomFilterPolicy(10);\n-    options.compression = leveldb::kNoCompression;\n-    options.info_log = new CBitcoinLevelDBLogger();\n+    options->block_cache = leveldb::NewLRUCache(nCacheSize / 2);\n+    options->write_buffer_size = nCacheSize / 4; // up to two write buffers may be held in memory simultaneously\n+    options->filter_policy = leveldb::NewBloomFilterPolicy(10);\n+    options->compression = leveldb::kNoCompression;\n+    options->info_log = new CBitcoinLevelDBLogger();\n     if (leveldb::kMajorVersion > 1 || (leveldb::kMajorVersion == 1 && leveldb::kMinorVersion >= 16)) {\n         // LevelDB versions before 1.16 consider short writes to be corruption. Only trigger error\n         // on corruption in later versions.\n-        options.paranoid_checks = true;\n+        options->paranoid_checks = true;\n     }\n-    SetMaxOpenFiles(&options);\n-    return options;\n+    SetMaxOpenFiles(options);\n+}\n+\n+// Custom deleter for unique_ptr<leveldb::Options>.\n+static void DeleteOptions(leveldb::Options* options)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r772488529",
      "id" : 772488529,
      "in_reply_to_id" : 739504112,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584uCz1R",
      "original_commit_id" : "6770f066b69c6c271e7096cc647d5d42762f6b05",
      "original_line" : 116,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/dbwrapper.cpp",
      "position" : null,
      "pull_request_review_id" : 836565111,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772488529/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-20T16:07:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772488529",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15145615?v=4",
         "events_url" : "https://api.github.com/users/Crypt-iQ/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Crypt-iQ/followers",
         "following_url" : "https://api.github.com/users/Crypt-iQ/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Crypt-iQ/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Crypt-iQ",
         "id" : 15145615,
         "login" : "Crypt-iQ",
         "node_id" : "MDQ6VXNlcjE1MTQ1NjE1",
         "organizations_url" : "https://api.github.com/users/Crypt-iQ/orgs",
         "received_events_url" : "https://api.github.com/users/Crypt-iQ/received_events",
         "repos_url" : "https://api.github.com/users/Crypt-iQ/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Crypt-iQ/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Crypt-iQ/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Crypt-iQ"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I've rebased and hopefully addressed all of the comments",
      "created_at" : "2021-12-20T16:07:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22663#issuecomment-998061893",
      "id" : 998061893,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22663",
      "node_id" : "IC_kwDOABII5847fTdF",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998061893/reactions"
      },
      "updated_at" : "2021-12-20T16:07:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998061893",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15145615?v=4",
         "events_url" : "https://api.github.com/users/Crypt-iQ/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Crypt-iQ/followers",
         "following_url" : "https://api.github.com/users/Crypt-iQ/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Crypt-iQ/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Crypt-iQ",
         "id" : 15145615,
         "login" : "Crypt-iQ",
         "node_id" : "MDQ6VXNlcjE1MTQ1NjE1",
         "organizations_url" : "https://api.github.com/users/Crypt-iQ/orgs",
         "received_events_url" : "https://api.github.com/users/Crypt-iQ/received_events",
         "repos_url" : "https://api.github.com/users/Crypt-iQ/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Crypt-iQ/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Crypt-iQ/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Crypt-iQ"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r772489105"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772489105"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\nLevelDbOptions::LevelDbOptions()\r\n{\r\n```\r\n\r\nnit: clang-format\r\n\r\n\r\nYou may install `clang-format` and run the https://github.com/bitcoin/bitcoin/tree/master/contrib/devtools#clang-format-diffpy script to preempt whitespace nitpicking.",
      "commit_id" : "7ba6aa28c762e0d17230df94a50481acab55e72d",
      "created_at" : "2021-12-20T16:07:53Z",
      "diff_hunk" : "@@ -97,36 +97,44 @@ static void SetMaxOpenFiles(leveldb::Options *options) {\n              options->max_open_files, default_open_files);\n }\n \n-static leveldb::Options GetOptions(size_t nCacheSize)\n-{\n-    leveldb::Options options;\n-    options.block_cache = leveldb::NewLRUCache(nCacheSize / 2);\n-    options.write_buffer_size = nCacheSize / 4; // up to two write buffers may be held in memory simultaneously\n-    options.filter_policy = leveldb::NewBloomFilterPolicy(10);\n-    options.compression = leveldb::kNoCompression;\n-    options.info_log = new CBitcoinLevelDBLogger();\n+LevelDbOptions::LevelDbOptions() {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r772489105",
      "id" : 772489105,
      "line" : 100,
      "node_id" : "PRRC_kwDOABII584uCz-R",
      "original_commit_id" : "7ba6aa28c762e0d17230df94a50481acab55e72d",
      "original_line" : 100,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/dbwrapper.cpp",
      "position" : 12,
      "pull_request_review_id" : 836565936,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772489105/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-20T16:07:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772489105",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r800095803"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/800095803"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "fixed",
      "commit_id" : "541b66fa0e7bf940aeaae16735712a2460100871",
      "created_at" : "2022-02-05T20:15:16Z",
      "diff_hunk" : "@@ -97,36 +97,44 @@ static void SetMaxOpenFiles(leveldb::Options *options) {\n              options->max_open_files, default_open_files);\n }\n \n-static leveldb::Options GetOptions(size_t nCacheSize)\n-{\n-    leveldb::Options options;\n-    options.block_cache = leveldb::NewLRUCache(nCacheSize / 2);\n-    options.write_buffer_size = nCacheSize / 4; // up to two write buffers may be held in memory simultaneously\n-    options.filter_policy = leveldb::NewBloomFilterPolicy(10);\n-    options.compression = leveldb::kNoCompression;\n-    options.info_log = new CBitcoinLevelDBLogger();\n+LevelDbOptions::LevelDbOptions() {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r800095803",
      "id" : 800095803,
      "in_reply_to_id" : 772489105,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584vsH47",
      "original_commit_id" : "7ba6aa28c762e0d17230df94a50481acab55e72d",
      "original_line" : 100,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/dbwrapper.cpp",
      "position" : null,
      "pull_request_review_id" : 873966779,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/800095803/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-05T20:15:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/800095803",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15145615?v=4",
         "events_url" : "https://api.github.com/users/Crypt-iQ/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Crypt-iQ/followers",
         "following_url" : "https://api.github.com/users/Crypt-iQ/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Crypt-iQ/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Crypt-iQ",
         "id" : 15145615,
         "login" : "Crypt-iQ",
         "node_id" : "MDQ6VXNlcjE1MTQ1NjE1",
         "organizations_url" : "https://api.github.com/users/Crypt-iQ/orgs",
         "received_events_url" : "https://api.github.com/users/Crypt-iQ/received_events",
         "repos_url" : "https://api.github.com/users/Crypt-iQ/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Crypt-iQ/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Crypt-iQ/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Crypt-iQ"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r843896789"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/843896789"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think this is strictly true? Or am I missing something? `nCacheSize` is passed into `CDBWrapper::CDBWrapper`, so it's absolutely known at the beginning, couldn't you pass it in like\r\n```\r\nCDBWrapper::CDBWrapper(const fs::path& path, size_t nCacheSize, bool fMemory, bool fWipe, bool obfuscate)\r\n    : m_name{fs::PathToString(path.stem())},\r\n      options(nCacheSize)\r\nâ®\r\n\r\nstruct LevelDbOptions : public leveldb::Options {\r\n    LevelDbOptions(size_t nCacheSize);\r\n```",
      "commit_id" : "541b66fa0e7bf940aeaae16735712a2460100871",
      "created_at" : "2022-04-06T12:37:21Z",
      "diff_hunk" : "@@ -19,6 +19,17 @@\n static const size_t DBWRAPPER_PREALLOC_KEY_SIZE = 64;\n static const size_t DBWRAPPER_PREALLOC_VALUE_SIZE = 1024;\n \n+struct LevelDbOptions : public leveldb::Options {\n+    LevelDbOptions();\n+\n+    ~LevelDbOptions();\n+\n+    /** Sets block_cache and write_buffer_size since nCacheSize isn't known when\n+     * LevelDbOptions ctor is called.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r843896789",
      "id" : 843896789,
      "line" : 28,
      "node_id" : "PRRC_kwDOABII584yTNfV",
      "original_commit_id" : "541b66fa0e7bf940aeaae16735712a2460100871",
      "original_line" : 28,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/dbwrapper.h",
      "position" : 10,
      "pull_request_review_id" : 933421579,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/843896789/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-06T12:38:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/843896789",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r844177667"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/844177667"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Not sure why I did that, updated to your suggestion",
      "commit_id" : "2a5d230c0fd764004a8c83c022ba71d0ee95d2a3",
      "created_at" : "2022-04-06T16:57:21Z",
      "diff_hunk" : "@@ -19,6 +19,17 @@\n static const size_t DBWRAPPER_PREALLOC_KEY_SIZE = 64;\n static const size_t DBWRAPPER_PREALLOC_VALUE_SIZE = 1024;\n \n+struct LevelDbOptions : public leveldb::Options {\n+    LevelDbOptions();\n+\n+    ~LevelDbOptions();\n+\n+    /** Sets block_cache and write_buffer_size since nCacheSize isn't known when\n+     * LevelDbOptions ctor is called.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r844177667",
      "id" : 844177667,
      "in_reply_to_id" : 843896789,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584yUSED",
      "original_commit_id" : "541b66fa0e7bf940aeaae16735712a2460100871",
      "original_line" : 28,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/dbwrapper.h",
      "position" : null,
      "pull_request_review_id" : 933812526,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/844177667/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-06T16:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/844177667",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15145615?v=4",
         "events_url" : "https://api.github.com/users/Crypt-iQ/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Crypt-iQ/followers",
         "following_url" : "https://api.github.com/users/Crypt-iQ/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Crypt-iQ/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Crypt-iQ",
         "id" : 15145615,
         "login" : "Crypt-iQ",
         "node_id" : "MDQ6VXNlcjE1MTQ1NjE1",
         "organizations_url" : "https://api.github.com/users/Crypt-iQ/orgs",
         "received_events_url" : "https://api.github.com/users/Crypt-iQ/received_events",
         "repos_url" : "https://api.github.com/users/Crypt-iQ/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Crypt-iQ/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Crypt-iQ/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Crypt-iQ"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r859298789"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/859298789"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/22663#discussion_r772488258\r\n\r\n> I was not sure how to make `pdb` a unique_ptr and also pass it in to `Open` as `leveldb::DB**` when it is `nullptr` at this point. Maybe I am missing something.\r\n\r\nNo need to do this, but you would need to pass a temporary pointer to Open, and switch to unique_ptr after it returns:\r\n\r\n```\r\nleveldb::DB* new_db = nullptr;\r\nleveldb::Status status = leveldb::DB::Open(options, fs::PathToString(path), &new_db);\r\npdb.reset(new_db);\r\n```",
      "commit_id" : "2a5d230c0fd764004a8c83c022ba71d0ee95d2a3",
      "created_at" : "2022-04-27T01:30:05Z",
      "diff_hunk" : "@@ -170,14 +183,7 @@ CDBWrapper::~CDBWrapper()\n {\n     delete pdb;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r859298789",
      "id" : 859298789,
      "in_reply_to_id" : 739500531,
      "line" : 178,
      "node_id" : "PRRC_kwDOABII584zN9vl",
      "original_commit_id" : "6770f066b69c6c271e7096cc647d5d42762f6b05",
      "original_line" : 178,
      "original_position" : 78,
      "original_start_line" : null,
      "path" : "src/dbwrapper.cpp",
      "position" : 84,
      "pull_request_review_id" : 954201309,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/859298789/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-27T01:48:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/859298789",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r863588026"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/863588026"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: Maybe rename to m_env while touching all lines? Maybe split the penv change into a separate commit for easier review?",
      "commit_id" : "2a5d230c0fd764004a8c83c022ba71d0ee95d2a3",
      "created_at" : "2022-05-03T08:56:48Z",
      "diff_hunk" : "@@ -178,10 +184,10 @@ class CDBWrapper\n     friend const std::vector<unsigned char>& dbwrapper_private::GetObfuscateKey(const CDBWrapper &w);\n private:\n     //! custom environment this database is using (may be nullptr in case of default environment)\n-    leveldb::Env* penv;\n+    std::unique_ptr<leveldb::Env> penv;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r863588026",
      "id" : 863588026,
      "line" : 187,
      "node_id" : "PRRC_kwDOABII584zeU66",
      "original_commit_id" : "2a5d230c0fd764004a8c83c022ba71d0ee95d2a3",
      "original_line" : 187,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/dbwrapper.h",
      "position" : 18,
      "pull_request_review_id" : 960095289,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/863588026/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-03T08:56:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/863588026",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r866364244"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/866364244"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "renamed and split off into separate commit",
      "commit_id" : "b6a1677a554935736130e791c4272525273904c7",
      "created_at" : "2022-05-05T22:39:38Z",
      "diff_hunk" : "@@ -178,10 +184,10 @@ class CDBWrapper\n     friend const std::vector<unsigned char>& dbwrapper_private::GetObfuscateKey(const CDBWrapper &w);\n private:\n     //! custom environment this database is using (may be nullptr in case of default environment)\n-    leveldb::Env* penv;\n+    std::unique_ptr<leveldb::Env> penv;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r866364244",
      "id" : 866364244,
      "in_reply_to_id" : 863588026,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584zo6tU",
      "original_commit_id" : "2a5d230c0fd764004a8c83c022ba71d0ee95d2a3",
      "original_line" : 187,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/dbwrapper.h",
      "position" : null,
      "pull_request_review_id" : 964023417,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/866364244/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-05T22:39:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/866364244",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15145615?v=4",
         "events_url" : "https://api.github.com/users/Crypt-iQ/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Crypt-iQ/followers",
         "following_url" : "https://api.github.com/users/Crypt-iQ/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Crypt-iQ/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Crypt-iQ",
         "id" : 15145615,
         "login" : "Crypt-iQ",
         "node_id" : "MDQ6VXNlcjE1MTQ1NjE1",
         "organizations_url" : "https://api.github.com/users/Crypt-iQ/orgs",
         "received_events_url" : "https://api.github.com/users/Crypt-iQ/received_events",
         "repos_url" : "https://api.github.com/users/Crypt-iQ/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Crypt-iQ/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Crypt-iQ/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Crypt-iQ"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r866423891"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/866423891"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I didn't functionally change the code and now there is a TSAN failure",
      "commit_id" : "b6a1677a554935736130e791c4272525273904c7",
      "created_at" : "2022-05-06T01:11:38Z",
      "diff_hunk" : "@@ -178,10 +184,10 @@ class CDBWrapper\n     friend const std::vector<unsigned char>& dbwrapper_private::GetObfuscateKey(const CDBWrapper &w);\n private:\n     //! custom environment this database is using (may be nullptr in case of default environment)\n-    leveldb::Env* penv;\n+    std::unique_ptr<leveldb::Env> penv;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r866423891",
      "id" : 866423891,
      "in_reply_to_id" : 863588026,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584zpJRT",
      "original_commit_id" : "2a5d230c0fd764004a8c83c022ba71d0ee95d2a3",
      "original_line" : 187,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/dbwrapper.h",
      "position" : null,
      "pull_request_review_id" : 964096929,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/866423891/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-06T01:11:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/866423891",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15145615?v=4",
         "events_url" : "https://api.github.com/users/Crypt-iQ/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Crypt-iQ/followers",
         "following_url" : "https://api.github.com/users/Crypt-iQ/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Crypt-iQ/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Crypt-iQ",
         "id" : 15145615,
         "login" : "Crypt-iQ",
         "node_id" : "MDQ6VXNlcjE1MTQ1NjE1",
         "organizations_url" : "https://api.github.com/users/Crypt-iQ/orgs",
         "received_events_url" : "https://api.github.com/users/Crypt-iQ/received_events",
         "repos_url" : "https://api.github.com/users/Crypt-iQ/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Crypt-iQ/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Crypt-iQ/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Crypt-iQ"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r866553117"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/866553117"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I couldn't make any sense of it, so reset it, but it is still here for anyone to look at: https://cirrus-ci.com/task/5612886578954240?logs=ci#L4869",
      "commit_id" : "b6a1677a554935736130e791c4272525273904c7",
      "created_at" : "2022-05-06T07:18:47Z",
      "diff_hunk" : "@@ -178,10 +184,10 @@ class CDBWrapper\n     friend const std::vector<unsigned char>& dbwrapper_private::GetObfuscateKey(const CDBWrapper &w);\n private:\n     //! custom environment this database is using (may be nullptr in case of default environment)\n-    leveldb::Env* penv;\n+    std::unique_ptr<leveldb::Env> penv;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r866553117",
      "id" : 866553117,
      "in_reply_to_id" : 863588026,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584zpo0d",
      "original_commit_id" : "2a5d230c0fd764004a8c83c022ba71d0ee95d2a3",
      "original_line" : 187,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/dbwrapper.h",
      "position" : null,
      "pull_request_review_id" : 964263564,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/866553117/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-06T07:18:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/866553117",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r866894374"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/866894374"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think this occurs and is unrelated to this PR because:\r\n```\r\nmain thread:\r\n* AppInitMain\r\n  * ChainstateManager::ActiveTip()\r\n    * CChain::Tip() -- accesses `vChain` without a lock (read)\r\n```\r\n\r\n```\r\nb-loadblk thread:\r\n* ThreadImport\r\n  * ActivateBestChain called (src/node/blockstorage.cpp:883)\r\n    * ActivateBestChainStep\r\n      * ConnectTip\r\n        * SetTip\r\n          * vChain resize (write)\r\n```",
      "commit_id" : "b6a1677a554935736130e791c4272525273904c7",
      "created_at" : "2022-05-06T14:37:39Z",
      "diff_hunk" : "@@ -178,10 +184,10 @@ class CDBWrapper\n     friend const std::vector<unsigned char>& dbwrapper_private::GetObfuscateKey(const CDBWrapper &w);\n private:\n     //! custom environment this database is using (may be nullptr in case of default environment)\n-    leveldb::Env* penv;\n+    std::unique_ptr<leveldb::Env> penv;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r866894374",
      "id" : 866894374,
      "in_reply_to_id" : 863588026,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584zq8Im",
      "original_commit_id" : "2a5d230c0fd764004a8c83c022ba71d0ee95d2a3",
      "original_line" : 187,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/dbwrapper.h",
      "position" : null,
      "pull_request_review_id" : 964752477,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/866894374/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-06T14:37:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/866894374",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15145615?v=4",
         "events_url" : "https://api.github.com/users/Crypt-iQ/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Crypt-iQ/followers",
         "following_url" : "https://api.github.com/users/Crypt-iQ/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Crypt-iQ/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Crypt-iQ",
         "id" : 15145615,
         "login" : "Crypt-iQ",
         "node_id" : "MDQ6VXNlcjE1MTQ1NjE1",
         "organizations_url" : "https://api.github.com/users/Crypt-iQ/orgs",
         "received_events_url" : "https://api.github.com/users/Crypt-iQ/received_events",
         "repos_url" : "https://api.github.com/users/Crypt-iQ/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Crypt-iQ/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Crypt-iQ/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Crypt-iQ"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r870038902"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/870038902"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks!",
      "commit_id" : "b6a1677a554935736130e791c4272525273904c7",
      "created_at" : "2022-05-11T08:49:06Z",
      "diff_hunk" : "@@ -19,6 +19,17 @@\n static const size_t DBWRAPPER_PREALLOC_KEY_SIZE = 64;\n static const size_t DBWRAPPER_PREALLOC_VALUE_SIZE = 1024;\n \n+struct LevelDbOptions : public leveldb::Options {\n+    LevelDbOptions();\n+\n+    ~LevelDbOptions();\n+\n+    /** Sets block_cache and write_buffer_size since nCacheSize isn't known when\n+     * LevelDbOptions ctor is called.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22663#discussion_r870038902",
      "id" : 870038902,
      "in_reply_to_id" : 843896789,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584z2712",
      "original_commit_id" : "541b66fa0e7bf940aeaae16735712a2460100871",
      "original_line" : 28,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/dbwrapper.h",
      "position" : null,
      "pull_request_review_id" : 968920052,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22663",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/870038902/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-11T08:49:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/870038902",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "cc @jamesob ",
      "created_at" : "2022-10-12T18:36:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22663#issuecomment-1276579833",
      "id" : 1276579833,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22663",
      "node_id" : "IC_kwDOABII585MFw_5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1276579833/reactions"
      },
      "updated_at" : "2022-10-12T18:36:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1276579833",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-10-13T16:08:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22663#issuecomment-1277851907",
      "id" : 1277851907,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22663",
      "node_id" : "IC_kwDOABII585MKnkD",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1277851907/reactions"
      },
      "updated_at" : "2022-10-13T16:08:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1277851907",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "unfortunately don't have time to work on this, lmk if i should close it",
      "created_at" : "2022-10-18T16:22:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22663#issuecomment-1282661145",
      "id" : 1282661145,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22663",
      "node_id" : "IC_kwDOABII585Mc9sZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1282661145/reactions"
      },
      "updated_at" : "2022-10-18T16:22:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1282661145",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15145615?v=4",
         "events_url" : "https://api.github.com/users/Crypt-iQ/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Crypt-iQ/followers",
         "following_url" : "https://api.github.com/users/Crypt-iQ/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Crypt-iQ/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Crypt-iQ",
         "id" : 15145615,
         "login" : "Crypt-iQ",
         "node_id" : "MDQ6VXNlcjE1MTQ1NjE1",
         "organizations_url" : "https://api.github.com/users/Crypt-iQ/orgs",
         "received_events_url" : "https://api.github.com/users/Crypt-iQ/received_events",
         "repos_url" : "https://api.github.com/users/Crypt-iQ/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Crypt-iQ/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Crypt-iQ/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Crypt-iQ"
      }
   }
]
