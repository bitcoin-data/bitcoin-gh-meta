[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "See also https://en.wikipedia.org/wiki/Principle_of_least_astonishment",
      "created_at" : "2021-08-06T15:17:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#issuecomment-894331601",
      "id" : 894331601,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22651",
      "node_id" : "IC_kwDOABII5841TmrR",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-06T15:17:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/894331601",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept/Approach ACK. It may be good to have functional test coverage (or make it a separate function with unit tests).\r\n\r\nEdit: updated the -onlynet documentation in bebcf785c080df9273e03b854832ba3dbd4320ec.",
      "created_at" : "2021-08-06T15:32:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#issuecomment-894340417",
      "id" : 894340417,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22651",
      "node_id" : "IC_kwDOABII5841To1B",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-06T23:03:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/894340417",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r684419652"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/684419652"
         }
      },
      "author_association" : "MEMBER",
      "body" : "A function seems nicer than a localvar here (optionally declare in header file for unit testing)\r\n```diff\r\n+bool AllowOutboundOnion()\r\n+{\r\n+    if (!gArgs.IsArgSet(\"-onlynet\")) return true;\r\n+    for (const auto& net : gArgs.GetArgs(\"-onlynet\")) {\r\n+        if (ParseNetwork(net) == NET_ONION) return true;\r\n+    }\r\n+    return false;\r\n+}\r\n          // Now that we know Tor is running, possibly set the proxy for onion addresses.\r\n-        bool allow_outbound_onion{true};\r\n-        if (gArgs.IsArgSet(\"-onlynet\")) {\r\n-            allow_outbound_onion = false;\r\n-            for (const auto& net : gArgs.GetArgs(\"-onlynet\")) {\r\n-                if (ParseNetwork(net) == NET_ONION) {\r\n-                    allow_outbound_onion = true;\r\n-                    break;\r\n-                }\r\n-            }\r\n-        }\r\n-        if (gArgs.GetArg(\"-onion\", \"\") == \"\" && allow_outbound_onion) {\r\n+        if (gArgs.GetArg(\"-onion\", \"\").empty() && AllowOutboundOnion()) {\r\n```\r\n",
      "commit_id" : "4f4c7d8b117e8a9cfb2430d2fc9f420ef48b4f6d",
      "created_at" : "2021-08-06T18:12:03Z",
      "diff_hunk" : "@@ -373,9 +373,18 @@ void TorController::auth_cb(TorControlConnection& _conn, const TorControlReply&\n     if (reply.code == 250) {\n         LogPrint(BCLog::TOR, \"tor: Authentication successful\\n\");\n \n-        // Now that we know Tor is running setup the proxy for onion addresses\n-        // if -onion isn't set to something else.\n-        if (gArgs.GetArg(\"-onion\", \"\") == \"\") {\n+        // Now that we know Tor is running, possibly set the proxy for onion addresses.\n+        bool allow_outbound_onion{true};\n+        if (gArgs.IsArgSet(\"-onlynet\")) {\n+            allow_outbound_onion = false;\n+            for (const auto& net : gArgs.GetArgs(\"-onlynet\")) {\n+                if (ParseNetwork(net) == NET_ONION) {\n+                    allow_outbound_onion = true;\n+                    break;\n+                }\n+            }\n+        }\n+        if (gArgs.GetArg(\"-onion\", \"\") == \"\" && allow_outbound_onion) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r684419652",
      "id" : 684419652,
      "line" : 387,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NDQxOTY1Mg==",
      "original_commit_id" : "4f4c7d8b117e8a9cfb2430d2fc9f420ef48b4f6d",
      "original_line" : 387,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/torcontrol.cpp",
      "position" : 18,
      "pull_request_review_id" : 724602061,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-06T18:43:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/684419652",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r684429929"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/684429929"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Tested with this patch on mainnet:\r\n- `onlynet=i2p`: only I2P outbound connections are made (i2pd 2.23)\r\n- `onlynet=ipv4`: only IPv4 outbound connections are made\r\n- `onlynet=onion`: only onion outbound connections are made (tor 0.4.6)",
      "commit_id" : "4f4c7d8b117e8a9cfb2430d2fc9f420ef48b4f6d",
      "created_at" : "2021-08-06T18:31:42Z",
      "diff_hunk" : "@@ -373,9 +373,18 @@ void TorController::auth_cb(TorControlConnection& _conn, const TorControlReply&\n     if (reply.code == 250) {\n         LogPrint(BCLog::TOR, \"tor: Authentication successful\\n\");\n \n-        // Now that we know Tor is running setup the proxy for onion addresses\n-        // if -onion isn't set to something else.\n-        if (gArgs.GetArg(\"-onion\", \"\") == \"\") {\n+        // Now that we know Tor is running, possibly set the proxy for onion addresses.\n+        bool allow_outbound_onion{true};\n+        if (gArgs.IsArgSet(\"-onlynet\")) {\n+            allow_outbound_onion = false;\n+            for (const auto& net : gArgs.GetArgs(\"-onlynet\")) {\n+                if (ParseNetwork(net) == NET_ONION) {\n+                    allow_outbound_onion = true;\n+                    break;\n+                }\n+            }\n+        }\n+        if (gArgs.GetArg(\"-onion\", \"\") == \"\" && allow_outbound_onion) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r684429929",
      "id" : 684429929,
      "in_reply_to_id" : 684419652,
      "line" : 387,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NDQyOTkyOQ==",
      "original_commit_id" : "4f4c7d8b117e8a9cfb2430d2fc9f420ef48b4f6d",
      "original_line" : 387,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/torcontrol.cpp",
      "position" : 18,
      "pull_request_review_id" : 724615495,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-06T18:31:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/684429929",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> See also https://en.wikipedia.org/wiki/Principle_of_least_astonishment\r\n\r\nThis link says \"The behavior should not astonish or surprise users\"\r\n\r\nI am surprised by lot of things in Bitcoin Core ð\r\n\r\nConcept ACK. Doesn't make sense to create outbound connections with onion peers if `onlynet=i2p` is used.",
      "created_at" : "2021-08-06T18:34:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#issuecomment-894444992",
      "id" : 894444992,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22651",
      "node_id" : "IC_kwDOABII5841UCXA",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-06T18:34:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/894444992",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r684434758"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/684434758"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I did more testing with combinations (all using the proposed function version above ;)\r\n- `onlynet=i2p` and `onlynet=onion`: only I2P and onion outbound connections are made\r\n- `onlynet=ipv4` and `onlynet=onion`: only IPv4 and onion outbound connections are made\r\n- `onlynet=ipv4` and `onlynet=i2p`: only IPv4 and I2P outbound connections are made\r\n\r\n(Test coverage for these cases--single onlynet and combinations--would be great.)",
      "commit_id" : "4f4c7d8b117e8a9cfb2430d2fc9f420ef48b4f6d",
      "created_at" : "2021-08-06T18:40:19Z",
      "diff_hunk" : "@@ -373,9 +373,18 @@ void TorController::auth_cb(TorControlConnection& _conn, const TorControlReply&\n     if (reply.code == 250) {\n         LogPrint(BCLog::TOR, \"tor: Authentication successful\\n\");\n \n-        // Now that we know Tor is running setup the proxy for onion addresses\n-        // if -onion isn't set to something else.\n-        if (gArgs.GetArg(\"-onion\", \"\") == \"\") {\n+        // Now that we know Tor is running, possibly set the proxy for onion addresses.\n+        bool allow_outbound_onion{true};\n+        if (gArgs.IsArgSet(\"-onlynet\")) {\n+            allow_outbound_onion = false;\n+            for (const auto& net : gArgs.GetArgs(\"-onlynet\")) {\n+                if (ParseNetwork(net) == NET_ONION) {\n+                    allow_outbound_onion = true;\n+                    break;\n+                }\n+            }\n+        }\n+        if (gArgs.GetArg(\"-onion\", \"\") == \"\" && allow_outbound_onion) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r684434758",
      "id" : 684434758,
      "in_reply_to_id" : 684419652,
      "line" : 387,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NDQzNDc1OA==",
      "original_commit_id" : "4f4c7d8b117e8a9cfb2430d2fc9f420ef48b4f6d",
      "original_line" : 387,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/torcontrol.cpp",
      "position" : 18,
      "pull_request_review_id" : 724621467,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-06T21:41:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/684434758",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r684460683"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/684460683"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This is normally 9150 on Windows so can we use #ifdef here? Although not sure if it is out of scope for this PR\r\n\r\n```suggestion\r\n#ifdef WIN32 \r\n            CService resolved(LookupNumeric(\"127.0.0.1\", 9150));\r\n#else\r\n            CService resolved(LookupNumeric(\"127.0.0.1\", 9050));\r\n#endif\r\n```",
      "commit_id" : "4f4c7d8b117e8a9cfb2430d2fc9f420ef48b4f6d",
      "created_at" : "2021-08-06T19:30:24Z",
      "diff_hunk" : "@@ -373,9 +373,18 @@ void TorController::auth_cb(TorControlConnection& _conn, const TorControlReply&\n     if (reply.code == 250) {\n         LogPrint(BCLog::TOR, \"tor: Authentication successful\\n\");\n \n-        // Now that we know Tor is running setup the proxy for onion addresses\n-        // if -onion isn't set to something else.\n-        if (gArgs.GetArg(\"-onion\", \"\") == \"\") {\n+        // Now that we know Tor is running, possibly set the proxy for onion addresses.\n+        bool allow_outbound_onion{true};\n+        if (gArgs.IsArgSet(\"-onlynet\")) {\n+            allow_outbound_onion = false;\n+            for (const auto& net : gArgs.GetArgs(\"-onlynet\")) {\n+                if (ParseNetwork(net) == NET_ONION) {\n+                    allow_outbound_onion = true;\n+                    break;\n+                }\n+            }\n+        }\n+        if (gArgs.GetArg(\"-onion\", \"\") == \"\" && allow_outbound_onion) {\n             CService resolved(LookupNumeric(\"127.0.0.1\", 9050));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r684460683",
      "id" : 684460683,
      "line" : 388,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NDQ2MDY4Mw==",
      "original_commit_id" : "4f4c7d8b117e8a9cfb2430d2fc9f420ef48b4f6d",
      "original_line" : 388,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/torcontrol.cpp",
      "position" : 19,
      "pull_request_review_id" : 724654762,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-06T19:34:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/684460683",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r684500821"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/684500821"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Test coverage for these cases--single onlynet and combinations--would be great\r\n\r\nAgree",
      "commit_id" : "4f4c7d8b117e8a9cfb2430d2fc9f420ef48b4f6d",
      "created_at" : "2021-08-06T20:57:43Z",
      "diff_hunk" : "@@ -373,9 +373,18 @@ void TorController::auth_cb(TorControlConnection& _conn, const TorControlReply&\n     if (reply.code == 250) {\n         LogPrint(BCLog::TOR, \"tor: Authentication successful\\n\");\n \n-        // Now that we know Tor is running setup the proxy for onion addresses\n-        // if -onion isn't set to something else.\n-        if (gArgs.GetArg(\"-onion\", \"\") == \"\") {\n+        // Now that we know Tor is running, possibly set the proxy for onion addresses.\n+        bool allow_outbound_onion{true};\n+        if (gArgs.IsArgSet(\"-onlynet\")) {\n+            allow_outbound_onion = false;\n+            for (const auto& net : gArgs.GetArgs(\"-onlynet\")) {\n+                if (ParseNetwork(net) == NET_ONION) {\n+                    allow_outbound_onion = true;\n+                    break;\n+                }\n+            }\n+        }\n+        if (gArgs.GetArg(\"-onion\", \"\") == \"\" && allow_outbound_onion) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r684500821",
      "id" : 684500821,
      "in_reply_to_id" : 684419652,
      "line" : 387,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NDUwMDgyMQ==",
      "original_commit_id" : "4f4c7d8b117e8a9cfb2430d2fc9f420ef48b4f6d",
      "original_line" : 387,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/torcontrol.cpp",
      "position" : 18,
      "pull_request_review_id" : 724706581,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-06T20:57:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/684500821",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> It may be good to have functional test coverage (or make it a separate function with unit tests).\r\n\r\nAgree. Do you think these steps are correct for test?\r\n\r\n1. Run Node 1: \r\n```\r\nbitcoind -port=18333 -rpcport=18222 -datadir=\"/home/user/node1\" -regtest=1 -listen=1 -server=1 -debug=net -rpcuser=user1 -rpcpassword=password1 -torcontrol='127.0.0.1:9051' -proxy='127.0.0.1:9050' -onlynet=onion\r\n```\r\n2. Run Node 2:\r\n```\r\nbitcoind -port=18777 -rpcport=18666 -datadir=\"/home/user/node2\" -regtest=1 -listen=1 -server=1 -debug=net -rpcuser=user2 -rpcpassword=password2 -addnode='127.0.0.1:18333' -torcontrol='127.0.0.1:9051' -proxy='127.0.0.1:9050' -onlynet=onion\r\n```\r\n3. Stop Node 1 and 2:\r\n\r\n```\r\nbitcoin-cli -rpcport=18222 -rpcuser=user1 -rpcpassword=password1 stop\r\nbitcoin-cli -rpcport=18666 -rpcuser=user2 -rpcpassword=password2 stop\r\n```\r\n4. Restart Node 2 with different config (`onlynet=i2p` and no `proxy`):\r\n\r\n```\r\nbitcoind -port=18777 -rpcport=18666 -datadir=\"/home/user/node2\" -regtest=1 -listen=1 -server=1 -debug=net -rpcuser=user2 -rpcpassword=password2 -i2psam=127.0.0.1:7656 -onlynet=i2p\r\n```\r\n5. Check debug.log:\r\n\r\n```\r\ntrying connection 3llpwlxkisrm2iu5oayh2hd6df7q36wdmt6nounenzqcxkasxfk34eid.onion\r\n```\r\nMaster branch should print such connection attempts and PR branch should not\r\n",
      "created_at" : "2021-08-06T21:27:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#issuecomment-894527298",
      "id" : 894527298,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22651",
      "node_id" : "IC_kwDOABII5841UWdC",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-06T21:31:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/894527298",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Checking the debug log output is a bit of a last resort when there's nothing else to assert on... getnetworkinfo limited/reachable (and maybe getpeerinfo) would probably be good.",
      "created_at" : "2021-08-06T21:47:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#issuecomment-894535743",
      "id" : 894535743,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22651",
      "node_id" : "IC_kwDOABII5841UYg_",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-06T21:47:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/894535743",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#19358](https://github.com/bitcoin/bitcoin/pull/19358) (torcontrol : avoid to set wrong outbound proxy and network settings when creating an inbound onion service. by Saibato)\n* [#15423](https://github.com/bitcoin/bitcoin/pull/15423) (torcontrol: Query Tor for correct -onion configuration by luke-jr)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-08-07T05:05:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#issuecomment-894605885",
      "id" : 894605885,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22651",
      "node_id" : "IC_kwDOABII5841Upo9",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-01T11:28:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/894605885",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Would this fix also #13378 ?",
      "created_at" : "2021-08-07T06:37:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#issuecomment-894613967",
      "id" : 894613967,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22651",
      "node_id" : "IC_kwDOABII5841UrnP",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-07T06:37:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/894613967",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8447873?v=4",
         "events_url" : "https://api.github.com/users/wodry/events{/privacy}",
         "followers_url" : "https://api.github.com/users/wodry/followers",
         "following_url" : "https://api.github.com/users/wodry/following{/other_user}",
         "gists_url" : "https://api.github.com/users/wodry/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/wodry",
         "id" : 8447873,
         "login" : "wodry",
         "node_id" : "MDQ6VXNlcjg0NDc4NzM=",
         "organizations_url" : "https://api.github.com/users/wodry/orgs",
         "received_events_url" : "https://api.github.com/users/wodry/received_events",
         "repos_url" : "https://api.github.com/users/wodry/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/wodry/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/wodry/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/wodry"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Checking the debug log output is a bit of a last resort when there's nothing else to assert on... getnetworkinfo limited/reachable (and maybe getpeerinfo) would probably be good.\r\n\r\nAlso the steps I mentioned above don't work. They worked on one of my VMs. Maybe it already had some onion address in peers.dat. I was expecting it will add onion peer in peers.dat but it didn't. `addpeeraddress` with some onion address and port followed by `getpeerinfo` should work.",
      "created_at" : "2021-08-07T21:20:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#issuecomment-894708083",
      "id" : 894708083,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22651",
      "node_id" : "IC_kwDOABII5841VClz",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-07T21:20:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/894708083",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Wrote a PowerShell [script ](https://github.com/prayank23/bitcoin-ps-scripts/blob/main/Scripts/Node/onlynet_i2p.ps1) to test this. Tried on Windows 10 and Pop!_OS. Node 2 is connected to Node 1 on Linux and fails on Windows (Master branch).\r\n\r\nTL;DR\r\n   1. Run Node 1 and get onion URL for it. \r\n   2. Sleep 10 seconds\r\n   3. Get onion address for Node 1 from `getnetworkinfo` -> localaddresses -> address ending with .onion and its port\r\n   4. Run Node 2 with `onlynet=i2p` (No Tor proxy)\r\n   5. Sleep 10 seconds\r\n   6.  Add Node 1 in peers.dat for Node 2 using hidden RPC `addpeeraddress`\r\n   7. Sleep 30 seconds\r\n   8. Check if Node 2 is connected to Node 1 with `getpeerinfo`\r\n\r\n```\r\nPeer info:\r\n\r\nxejoddwvi35krze3546qtx6dfmednjs2ccsociyezkyhzdxtemp5v5ad.onion:18444\r\noutbound-full-relay\r\n```",
      "created_at" : "2021-08-08T08:12:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#issuecomment-894761007",
      "id" : 894761007,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22651",
      "node_id" : "IC_kwDOABII5841VPgv",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-08T08:19:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/894761007",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r685023941"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/685023941"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, ouf of scope of this PR. This belongs to https://github.com/bitcoin/bitcoin/pull/15423, I hope that PR moves forward.",
      "commit_id" : "4f4c7d8b117e8a9cfb2430d2fc9f420ef48b4f6d",
      "created_at" : "2021-08-09T09:01:12Z",
      "diff_hunk" : "@@ -373,9 +373,18 @@ void TorController::auth_cb(TorControlConnection& _conn, const TorControlReply&\n     if (reply.code == 250) {\n         LogPrint(BCLog::TOR, \"tor: Authentication successful\\n\");\n \n-        // Now that we know Tor is running setup the proxy for onion addresses\n-        // if -onion isn't set to something else.\n-        if (gArgs.GetArg(\"-onion\", \"\") == \"\") {\n+        // Now that we know Tor is running, possibly set the proxy for onion addresses.\n+        bool allow_outbound_onion{true};\n+        if (gArgs.IsArgSet(\"-onlynet\")) {\n+            allow_outbound_onion = false;\n+            for (const auto& net : gArgs.GetArgs(\"-onlynet\")) {\n+                if (ParseNetwork(net) == NET_ONION) {\n+                    allow_outbound_onion = true;\n+                    break;\n+                }\n+            }\n+        }\n+        if (gArgs.GetArg(\"-onion\", \"\") == \"\" && allow_outbound_onion) {\n             CService resolved(LookupNumeric(\"127.0.0.1\", 9050));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r685023941",
      "id" : 685023941,
      "in_reply_to_id" : 684460683,
      "line" : 388,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NTAyMzk0MQ==",
      "original_commit_id" : "4f4c7d8b117e8a9cfb2430d2fc9f420ef48b4f6d",
      "original_line" : 388,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/torcontrol.cpp",
      "position" : 19,
      "pull_request_review_id" : 725159850,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-09T09:01:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/685023941",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Would this fix also #13378 ?\r\n\r\nTo my understanding, yes, but only if none of `-proxy` or `-onion` is set.\r\n\r\nProviding both `-onlynet=ipv4 -onion=127.0.0.1:9050` is kind of contradictory - why provide an outgoing tor proxy if you only want to connect to IPv4? I think Bitcoin Core should print an error and refuse to start in this case, but instead it treats it as \"onlynet ipv4 or tor\". Changing/fixing that is out of the scope of this PR which only aims to fix the behavior if none of `-proxy` or `-onion` is set.",
      "created_at" : "2021-08-09T09:15:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#issuecomment-895069245",
      "id" : 895069245,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22651",
      "node_id" : "IC_kwDOABII5841Waw9",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-09T09:15:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/895069245",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Also of course out of this PR, just to mention: I am sure you are already aware that to have multiple \"only\" nets is paradox, the option should better be called e.g. \"net\" instead of \"onlynet\"..",
      "created_at" : "2021-08-09T11:22:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#issuecomment-895144677",
      "id" : 895144677,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22651",
      "node_id" : "IC_kwDOABII5841WtLl",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-09T11:22:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/895144677",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8447873?v=4",
         "events_url" : "https://api.github.com/users/wodry/events{/privacy}",
         "followers_url" : "https://api.github.com/users/wodry/followers",
         "following_url" : "https://api.github.com/users/wodry/following{/other_user}",
         "gists_url" : "https://api.github.com/users/wodry/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/wodry",
         "id" : 8447873,
         "login" : "wodry",
         "node_id" : "MDQ6VXNlcjg0NDc4NzM=",
         "organizations_url" : "https://api.github.com/users/wodry/orgs",
         "received_events_url" : "https://api.github.com/users/wodry/received_events",
         "repos_url" : "https://api.github.com/users/wodry/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/wodry/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/wodry/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/wodry"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`4f4c7d8b11..4f3020d524`: append a functional test to exercise the modified behavior",
      "created_at" : "2021-08-11T07:20:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#issuecomment-896565507",
      "id" : 896565507,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22651",
      "node_id" : "IC_kwDOABII5841cIED",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-11T07:20:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/896565507",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686569913"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686569913"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think it is fine either way. A function would make more sense if this is used in more than one place. The code is now covered by a new functional test `feature_onlynet.py`. Left it as is.",
      "commit_id" : "25f9e113db979ef28b471664ae42c5f52daaba59",
      "created_at" : "2021-08-11T07:27:57Z",
      "diff_hunk" : "@@ -373,9 +373,18 @@ void TorController::auth_cb(TorControlConnection& _conn, const TorControlReply&\n     if (reply.code == 250) {\n         LogPrint(BCLog::TOR, \"tor: Authentication successful\\n\");\n \n-        // Now that we know Tor is running setup the proxy for onion addresses\n-        // if -onion isn't set to something else.\n-        if (gArgs.GetArg(\"-onion\", \"\") == \"\") {\n+        // Now that we know Tor is running, possibly set the proxy for onion addresses.\n+        bool allow_outbound_onion{true};\n+        if (gArgs.IsArgSet(\"-onlynet\")) {\n+            allow_outbound_onion = false;\n+            for (const auto& net : gArgs.GetArgs(\"-onlynet\")) {\n+                if (ParseNetwork(net) == NET_ONION) {\n+                    allow_outbound_onion = true;\n+                    break;\n+                }\n+            }\n+        }\n+        if (gArgs.GetArg(\"-onion\", \"\") == \"\" && allow_outbound_onion) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686569913",
      "id" : 686569913,
      "in_reply_to_id" : 684419652,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NjU2OTkxMw==",
      "original_commit_id" : "4f4c7d8b117e8a9cfb2430d2fc9f420ef48b4f6d",
      "original_line" : 387,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/torcontrol.cpp",
      "position" : null,
      "pull_request_review_id" : 727141836,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-11T07:27:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686569913",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686576643"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686576643"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think the function is not only shorter but also clearer and easier to reason about.",
      "commit_id" : "25f9e113db979ef28b471664ae42c5f52daaba59",
      "created_at" : "2021-08-11T07:37:29Z",
      "diff_hunk" : "@@ -373,9 +373,18 @@ void TorController::auth_cb(TorControlConnection& _conn, const TorControlReply&\n     if (reply.code == 250) {\n         LogPrint(BCLog::TOR, \"tor: Authentication successful\\n\");\n \n-        // Now that we know Tor is running setup the proxy for onion addresses\n-        // if -onion isn't set to something else.\n-        if (gArgs.GetArg(\"-onion\", \"\") == \"\") {\n+        // Now that we know Tor is running, possibly set the proxy for onion addresses.\n+        bool allow_outbound_onion{true};\n+        if (gArgs.IsArgSet(\"-onlynet\")) {\n+            allow_outbound_onion = false;\n+            for (const auto& net : gArgs.GetArgs(\"-onlynet\")) {\n+                if (ParseNetwork(net) == NET_ONION) {\n+                    allow_outbound_onion = true;\n+                    break;\n+                }\n+            }\n+        }\n+        if (gArgs.GetArg(\"-onion\", \"\") == \"\" && allow_outbound_onion) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686576643",
      "id" : 686576643,
      "in_reply_to_id" : 684419652,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NjU3NjY0Mw==",
      "original_commit_id" : "4f4c7d8b117e8a9cfb2430d2fc9f420ef48b4f6d",
      "original_line" : 387,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/torcontrol.cpp",
      "position" : null,
      "pull_request_review_id" : 727150046,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-11T07:37:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686576643",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`4f3020d524...00b7ba51eb`: hush `test/lint/lint-python.sh`",
      "created_at" : "2021-08-11T07:40:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#issuecomment-896577149",
      "id" : 896577149,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22651",
      "node_id" : "IC_kwDOABII5841cK59",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-11T07:40:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/896577149",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`00b7ba51eb...25f9e113db`: change `allow_outbound_onion` to a function, as per suggestion",
      "created_at" : "2021-08-11T07:46:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#issuecomment-896580901",
      "id" : 896580901,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22651",
      "node_id" : "IC_kwDOABII5841cL0l",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-11T07:46:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/896580901",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686583273"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686583273"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Alright, changed to a function.",
      "commit_id" : "25f9e113db979ef28b471664ae42c5f52daaba59",
      "created_at" : "2021-08-11T07:47:03Z",
      "diff_hunk" : "@@ -373,9 +373,18 @@ void TorController::auth_cb(TorControlConnection& _conn, const TorControlReply&\n     if (reply.code == 250) {\n         LogPrint(BCLog::TOR, \"tor: Authentication successful\\n\");\n \n-        // Now that we know Tor is running setup the proxy for onion addresses\n-        // if -onion isn't set to something else.\n-        if (gArgs.GetArg(\"-onion\", \"\") == \"\") {\n+        // Now that we know Tor is running, possibly set the proxy for onion addresses.\n+        bool allow_outbound_onion{true};\n+        if (gArgs.IsArgSet(\"-onlynet\")) {\n+            allow_outbound_onion = false;\n+            for (const auto& net : gArgs.GetArgs(\"-onlynet\")) {\n+                if (ParseNetwork(net) == NET_ONION) {\n+                    allow_outbound_onion = true;\n+                    break;\n+                }\n+            }\n+        }\n+        if (gArgs.GetArg(\"-onion\", \"\") == \"\" && allow_outbound_onion) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686583273",
      "id" : 686583273,
      "in_reply_to_id" : 684419652,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NjU4MzI3Mw==",
      "original_commit_id" : "4f4c7d8b117e8a9cfb2430d2fc9f420ef48b4f6d",
      "original_line" : 387,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/torcontrol.cpp",
      "position" : null,
      "pull_request_review_id" : 727158966,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-11T07:47:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686583273",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686598124"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686598124"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\nTest -onlynet configuration option.\r\n```",
      "commit_id" : "25f9e113db979ef28b471664ae42c5f52daaba59",
      "created_at" : "2021-08-11T08:07:23Z",
      "diff_hunk" : "@@ -0,0 +1,54 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021-2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test -onlynet",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686598124",
      "id" : 686598124,
      "line" : 6,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NjU5ODEyNA==",
      "original_commit_id" : "25f9e113db979ef28b471664ae42c5f52daaba59",
      "original_line" : 6,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "test/functional/feature_onlynet.py",
      "position" : 6,
      "pull_request_review_id" : 727178072,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-11T09:32:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686598124",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Introduce a basic TCP server in the functional testing framework and use\r\nit to simulate a Tor Control daemon, which is needed in order for the\r\ncode in `src/torcontrol.cpp` to execute the code that is relevant for\r\n`-onlynet`.\r\n\r\nInteresting. Will try this today. ",
      "created_at" : "2021-08-11T08:17:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#issuecomment-896610763",
      "id" : 896610763,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22651",
      "node_id" : "IC_kwDOABII5841cTHL",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-11T08:39:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/896610763",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686656841"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686656841"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I needed this line for the test to run:\r\n```diff\r\n class OnlynetTest(BitcoinTestFramework):\r\n     def set_test_params(self):\r\n+        self.setup_clean_chain = True\r\n         self.extra_args = [\r\n```\r\nOtherwise, was seeing the following error:\r\n\r\n<details><summary>test output</summary><p>\r\n\r\n```\r\n$ test/functional/feature_onlynet.py \r\n2021-08-11T09:22:40.305000Z TestFramework (INFO): Initializing test directory /tmp/bitcoin_func_test_p1tdzv8m\r\n2021-08-11T09:22:41.628000Z TestFramework (ERROR): Assertion failed\r\nTraceback (most recent call last):\r\n  File \"/home/jon/projects/bitcoin/bitcoin/test/functional/test_framework/test_framework.py\", line 130, in main\r\n    self.setup()\r\n  File \"/home/jon/projects/bitcoin/bitcoin/test/functional/test_framework/test_framework.py\", line 285, in setup\r\n    self.setup_network()\r\n  File \"/home/jon/projects/bitcoin/bitcoin/test/functional/test_framework/test_framework.py\", line 379, in setup_network\r\n    self.setup_nodes()\r\n  File \"/home/jon/projects/bitcoin/bitcoin/test/functional/test_framework/test_framework.py\", line 409, in setup_nodes\r\n    assert_equal(n.getblockchaininfo()[\"blocks\"], 199)\r\n  File \"/home/jon/projects/bitcoin/bitcoin/test/functional/test_framework/util.py\", line 49, in assert_equal\r\n    raise AssertionError(\"not(%s)\" % \" == \".join(str(arg) for arg in (thing1, thing2) + args))\r\nAssertionError: not(0 == 199)\r\n2021-08-11T09:22:41.680000Z TestFramework (INFO): Stopping nodes\r\n2021-08-11T09:22:41.860000Z TestFramework (WARNING): Not cleaning up dir /tmp/bitcoin_func_test_p1tdzv8m\r\n2021-08-11T09:22:41.860000Z TestFramework (ERROR): Test failed. Test logging available at /tmp/bitcoin_func_test_p1tdzv8m/test_framework.log\r\n2021-08-11T09:22:41.861000Z TestFramework (ERROR): \r\n2021-08-11T09:22:41.861000Z TestFramework (ERROR): Hint: Call /home/jon/projects/bitcoin/bitcoin/test/functional/combine_logs.py '/tmp/bitcoin_func_test_p1tdzv8m' to consolidate all logs\r\n2021-08-11T09:22:41.862000Z TestFramework (ERROR): \r\n2021-08-11T09:22:41.862000Z TestFramework (ERROR): If this failure happened unexpectedly or intermittently, please file a bug and provide a link or upload of the combined log.\r\n2021-08-11T09:22:41.862000Z TestFramework (ERROR): https://github.com/bitcoin/bitcoin/issues\r\n2021-08-11T09:22:41.862000Z TestFramework (ERROR): \r\n```\r\n</p></details>\r\n",
      "commit_id" : "25f9e113db979ef28b471664ae42c5f52daaba59",
      "created_at" : "2021-08-11T09:23:47Z",
      "diff_hunk" : "@@ -0,0 +1,54 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021-2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test -onlynet\n+\"\"\"\n+\n+from test_framework.basic_server import (\n+    BasicServer,\n+    tor_control\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+)\n+\n+\n+class OnlynetTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.extra_args = [",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686656841",
      "id" : 686656841,
      "line" : 21,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NjY1Njg0MQ==",
      "original_commit_id" : "25f9e113db979ef28b471664ae42c5f52daaba59",
      "original_line" : 21,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "test/functional/feature_onlynet.py",
      "position" : 21,
      "pull_request_review_id" : 727178072,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-11T09:32:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686656841",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686657721"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686657721"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Here is a proposed simplification using a dict comprehension in `networks_dict` and a loop for the assertions:\r\n```diff\r\n+    def networks_dict(self, node):\r\n+        info = self.nodes[node].getnetworkinfo()\r\n+        return {network[\"name\"]: network for network in info[\"networks\"]}\r\n \r\n     def run_test(self):\r\n-        def networks_dict(d):\r\n-            r = {}\r\n-            for x in d['networks']:\r\n-                r[x['name']] = x\r\n-            return r\r\n-\r\n-        # Would fail without https://github.com/bitcoin/bitcoin/pull/22651\r\n-        n0 = networks_dict(self.nodes[0].getnetworkinfo())\r\n-        assert_equal(n0['onion']['reachable'], False)\r\n-\r\n-        # Passes with or without https://github.com/bitcoin/bitcoin/pull/22651,\r\n-        # just to ensure behavior does not change unintended.\r\n-        n1 = networks_dict(self.nodes[1].getnetworkinfo())\r\n-        assert_equal(n1['onion']['reachable'], True)\r\n-\r\n-        # Passes with or without https://github.com/bitcoin/bitcoin/pull/22651,\r\n-        # just to ensure behavior does not change unintended.\r\n-        n2 = networks_dict(self.nodes[2].getnetworkinfo())\r\n-        assert_equal(n2['onion']['reachable'], True)\r\n+        for node, reachable in [[0, False], [1, True], [2, True]]:\r\n+            assert_equal(self.networks_dict(node)['onion']['reachable'], reachable)\r\n```\r\nCould perhaps add a comment describing why we expect the first node to not be reachable.",
      "commit_id" : "25f9e113db979ef28b471664ae42c5f52daaba59",
      "created_at" : "2021-08-11T09:24:59Z",
      "diff_hunk" : "@@ -0,0 +1,54 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021-2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test -onlynet\n+\"\"\"\n+\n+from test_framework.basic_server import (\n+    BasicServer,\n+    tor_control\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+)\n+\n+\n+class OnlynetTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.extra_args = [\n+            ['-onlynet=ipv4', '-torcontrol=127.0.0.1:19051', '-listenonion=1'],\n+            ['-onlynet=ipv4', '-torcontrol=127.0.0.1:19051', '-listenonion=1', '-onion=127.0.0.1:9050'],\n+            ['-onlynet=ipv4', '-torcontrol=127.0.0.1:19051', '-listenonion=1', '-proxy=127.0.0.1:9050'],\n+        ]\n+        self.num_nodes = len(self.extra_args)\n+        self.tor_control_server = BasicServer(bind=('127.0.0.1', 19051),\n+                                              response_generator=tor_control)\n+\n+\n+    def run_test(self):\n+        def networks_dict(d):\n+            r = {}\n+            for x in d['networks']:\n+                r[x['name']] = x\n+            return r\n+\n+        # Would fail without https://github.com/bitcoin/bitcoin/pull/22651\n+        n0 = networks_dict(self.nodes[0].getnetworkinfo())\n+        assert_equal(n0['onion']['reachable'], False)\n+\n+        # Passes with or without https://github.com/bitcoin/bitcoin/pull/22651,\n+        # just to ensure behavior does not change unintended.\n+        n1 = networks_dict(self.nodes[1].getnetworkinfo())\n+        assert_equal(n1['onion']['reachable'], True)\n+\n+        # Passes with or without https://github.com/bitcoin/bitcoin/pull/22651,\n+        # just to ensure behavior does not change unintended.\n+        n2 = networks_dict(self.nodes[2].getnetworkinfo())\n+        assert_equal(n2['onion']['reachable'], True)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686657721",
      "id" : 686657721,
      "line" : 50,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NjY1NzcyMQ==",
      "original_commit_id" : "25f9e113db979ef28b471664ae42c5f52daaba59",
      "original_line" : 50,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "test/functional/feature_onlynet.py",
      "position" : 50,
      "pull_request_review_id" : 727178072,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-11T09:33:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686657721",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686661675"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686661675"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n        # self.listen_socket = socket.create_server(address=bind, reuse_port=True)\r\n```",
      "commit_id" : "25f9e113db979ef28b471664ae42c5f52daaba59",
      "created_at" : "2021-08-11T09:30:24Z",
      "diff_hunk" : "@@ -0,0 +1,93 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021-2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+A basic TCP server that responds to requests based on a given/custom criteria.\n+\"\"\"\n+\n+import socket\n+import threading\n+\n+\n+class BasicServer:\n+    # @param[in] bind Listen address and port tuple, for example (\"127.0.0.1\", 80)\n+    # @param[in] response_generator j\n+    def __init__(self, *, bind, response_generator):\n+        \"\"\"\n+        :param bind: Listen address-port tuple, for example (\"127.0.0.1\", 80)\n+\n+        :param response_generator: A callback function, supplied with the\n+        request. It returns a reply that is to be send to the client either as\n+        a string or as an array which is joined into a single string. If it\n+        returns None, then the connection is closed by the server.\n+        \"\"\"\n+        # create_server() is only in python 3.8\n+        # https://docs.python.org/3/library/socket.html#socket.create_server\n+        #self.listen_socket = socket.create_server(address=bind, reuse_port=True)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686661675",
      "id" : 686661675,
      "line" : 27,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NjY2MTY3NQ==",
      "original_commit_id" : "25f9e113db979ef28b471664ae42c5f52daaba59",
      "original_line" : 27,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/basic_server.py",
      "position" : 27,
      "pull_request_review_id" : 727178072,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-11T09:32:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686661675",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686661792"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686661792"
         }
      },
      "author_association" : "MEMBER",
      "body" : "?",
      "commit_id" : "25f9e113db979ef28b471664ae42c5f52daaba59",
      "created_at" : "2021-08-11T09:30:35Z",
      "diff_hunk" : "@@ -0,0 +1,93 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021-2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+A basic TCP server that responds to requests based on a given/custom criteria.\n+\"\"\"\n+\n+import socket\n+import threading\n+\n+\n+class BasicServer:\n+    # @param[in] bind Listen address and port tuple, for example (\"127.0.0.1\", 80)\n+    # @param[in] response_generator j\n+    def __init__(self, *, bind, response_generator):\n+        \"\"\"\n+        :param bind: Listen address-port tuple, for example (\"127.0.0.1\", 80)\n+\n+        :param response_generator: A callback function, supplied with the\n+        request. It returns a reply that is to be send to the client either as\n+        a string or as an array which is joined into a single string. If it\n+        returns None, then the connection is closed by the server.\n+        \"\"\"\n+        # create_server() is only in python 3.8\n+        # https://docs.python.org/3/library/socket.html#socket.create_server\n+        #self.listen_socket = socket.create_server(address=bind, reuse_port=True)\n+        self.listen_socket = socket.socket(socket.AF_INET)\n+        self.listen_socket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)\n+        self.listen_socket.bind(bind)\n+        self.listen_socket.listen()\n+        #",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686661792",
      "id" : 686661792,
      "line" : 32,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NjY2MTc5Mg==",
      "original_commit_id" : "25f9e113db979ef28b471664ae42c5f52daaba59",
      "original_line" : 32,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/basic_server.py",
      "position" : 32,
      "pull_request_review_id" : 727178072,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-11T09:32:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686661792",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686664860"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686664860"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks!",
      "commit_id" : "25f9e113db979ef28b471664ae42c5f52daaba59",
      "created_at" : "2021-08-11T09:34:47Z",
      "diff_hunk" : "@@ -373,9 +373,18 @@ void TorController::auth_cb(TorControlConnection& _conn, const TorControlReply&\n     if (reply.code == 250) {\n         LogPrint(BCLog::TOR, \"tor: Authentication successful\\n\");\n \n-        // Now that we know Tor is running setup the proxy for onion addresses\n-        // if -onion isn't set to something else.\n-        if (gArgs.GetArg(\"-onion\", \"\") == \"\") {\n+        // Now that we know Tor is running, possibly set the proxy for onion addresses.\n+        bool allow_outbound_onion{true};\n+        if (gArgs.IsArgSet(\"-onlynet\")) {\n+            allow_outbound_onion = false;\n+            for (const auto& net : gArgs.GetArgs(\"-onlynet\")) {\n+                if (ParseNetwork(net) == NET_ONION) {\n+                    allow_outbound_onion = true;\n+                    break;\n+                }\n+            }\n+        }\n+        if (gArgs.GetArg(\"-onion\", \"\") == \"\" && allow_outbound_onion) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686664860",
      "id" : 686664860,
      "in_reply_to_id" : 684419652,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NjY2NDg2MA==",
      "original_commit_id" : "4f4c7d8b117e8a9cfb2430d2fc9f420ef48b4f6d",
      "original_line" : 387,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/torcontrol.cpp",
      "position" : null,
      "pull_request_review_id" : 727265513,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-11T09:34:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686664860",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686668471"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686668471"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit, either add a comma at the end of this line, or one-line it:\r\n```python\r\nfrom test_framework.basic_server import BasicServer, tor_control\r\n```",
      "commit_id" : "25f9e113db979ef28b471664ae42c5f52daaba59",
      "created_at" : "2021-08-11T09:39:49Z",
      "diff_hunk" : "@@ -0,0 +1,54 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021-2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test -onlynet\n+\"\"\"\n+\n+from test_framework.basic_server import (\n+    BasicServer,\n+    tor_control",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686668471",
      "id" : 686668471,
      "line" : 11,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NjY2ODQ3MQ==",
      "original_commit_id" : "25f9e113db979ef28b471664ae42c5f52daaba59",
      "original_line" : 11,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "test/functional/feature_onlynet.py",
      "position" : 11,
      "pull_request_review_id" : 727270408,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-11T09:39:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686668471",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`test_framework/basic_server.py` can also be used to add some functional tests for I2P. We can simulate an I2P router at least as long as the text/line-based SAM is being talked on the socket. Later, when the socket switches from SAM to the binary bitcoin p2p protocol we would have to close the socket.",
      "created_at" : "2021-08-11T12:22:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#issuecomment-896780844",
      "id" : 896780844,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22651",
      "node_id" : "IC_kwDOABII5841c8os",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-11T12:22:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/896780844",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`25f9e113db...16bf93e136`: address suggestions",
      "created_at" : "2021-08-11T12:49:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#issuecomment-896798367",
      "id" : 896798367,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22651",
      "node_id" : "IC_kwDOABII5841dA6f",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-11T12:49:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/896798367",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686798112"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686798112"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "16bf93e1361fa9a1503cadd96e5121d92937bfb5",
      "created_at" : "2021-08-11T12:49:27Z",
      "diff_hunk" : "@@ -0,0 +1,54 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021-2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test -onlynet",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686798112",
      "id" : 686798112,
      "in_reply_to_id" : 686598124,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4Njc5ODExMg==",
      "original_commit_id" : "25f9e113db979ef28b471664ae42c5f52daaba59",
      "original_line" : 6,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "test/functional/feature_onlynet.py",
      "position" : null,
      "pull_request_review_id" : 727440935,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-11T12:49:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686798112",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686798692"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686798692"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Added. Any idea why that failure is not on CI? I don't see it either locally.",
      "commit_id" : "16bf93e1361fa9a1503cadd96e5121d92937bfb5",
      "created_at" : "2021-08-11T12:50:08Z",
      "diff_hunk" : "@@ -0,0 +1,54 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021-2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test -onlynet\n+\"\"\"\n+\n+from test_framework.basic_server import (\n+    BasicServer,\n+    tor_control\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+)\n+\n+\n+class OnlynetTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.extra_args = [",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686798692",
      "id" : 686798692,
      "in_reply_to_id" : 686656841,
      "line" : 21,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4Njc5ODY5Mg==",
      "original_commit_id" : "25f9e113db979ef28b471664ae42c5f52daaba59",
      "original_line" : 21,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "test/functional/feature_onlynet.py",
      "position" : 21,
      "pull_request_review_id" : 727441684,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-11T12:50:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686798692",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686799215"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686799215"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Did something similar. I find `return {network[\"name\"]: network for network in info[\"networks\"]}` extremely hard to read.",
      "commit_id" : "16bf93e1361fa9a1503cadd96e5121d92937bfb5",
      "created_at" : "2021-08-11T12:50:50Z",
      "diff_hunk" : "@@ -0,0 +1,54 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021-2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test -onlynet\n+\"\"\"\n+\n+from test_framework.basic_server import (\n+    BasicServer,\n+    tor_control\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+)\n+\n+\n+class OnlynetTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.extra_args = [\n+            ['-onlynet=ipv4', '-torcontrol=127.0.0.1:19051', '-listenonion=1'],\n+            ['-onlynet=ipv4', '-torcontrol=127.0.0.1:19051', '-listenonion=1', '-onion=127.0.0.1:9050'],\n+            ['-onlynet=ipv4', '-torcontrol=127.0.0.1:19051', '-listenonion=1', '-proxy=127.0.0.1:9050'],\n+        ]\n+        self.num_nodes = len(self.extra_args)\n+        self.tor_control_server = BasicServer(bind=('127.0.0.1', 19051),\n+                                              response_generator=tor_control)\n+\n+\n+    def run_test(self):\n+        def networks_dict(d):\n+            r = {}\n+            for x in d['networks']:\n+                r[x['name']] = x\n+            return r\n+\n+        # Would fail without https://github.com/bitcoin/bitcoin/pull/22651\n+        n0 = networks_dict(self.nodes[0].getnetworkinfo())\n+        assert_equal(n0['onion']['reachable'], False)\n+\n+        # Passes with or without https://github.com/bitcoin/bitcoin/pull/22651,\n+        # just to ensure behavior does not change unintended.\n+        n1 = networks_dict(self.nodes[1].getnetworkinfo())\n+        assert_equal(n1['onion']['reachable'], True)\n+\n+        # Passes with or without https://github.com/bitcoin/bitcoin/pull/22651,\n+        # just to ensure behavior does not change unintended.\n+        n2 = networks_dict(self.nodes[2].getnetworkinfo())\n+        assert_equal(n2['onion']['reachable'], True)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686799215",
      "id" : 686799215,
      "in_reply_to_id" : 686657721,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4Njc5OTIxNQ==",
      "original_commit_id" : "25f9e113db979ef28b471664ae42c5f52daaba59",
      "original_line" : 50,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "test/functional/feature_onlynet.py",
      "position" : null,
      "pull_request_review_id" : 727442397,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-11T12:51:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686799215",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686799788"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686799788"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I wanted to mark the end of the snippet that is equivalent to `create_server()`. Removed.",
      "commit_id" : "16bf93e1361fa9a1503cadd96e5121d92937bfb5",
      "created_at" : "2021-08-11T12:51:33Z",
      "diff_hunk" : "@@ -0,0 +1,93 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021-2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+A basic TCP server that responds to requests based on a given/custom criteria.\n+\"\"\"\n+\n+import socket\n+import threading\n+\n+\n+class BasicServer:\n+    # @param[in] bind Listen address and port tuple, for example (\"127.0.0.1\", 80)\n+    # @param[in] response_generator j\n+    def __init__(self, *, bind, response_generator):\n+        \"\"\"\n+        :param bind: Listen address-port tuple, for example (\"127.0.0.1\", 80)\n+\n+        :param response_generator: A callback function, supplied with the\n+        request. It returns a reply that is to be send to the client either as\n+        a string or as an array which is joined into a single string. If it\n+        returns None, then the connection is closed by the server.\n+        \"\"\"\n+        # create_server() is only in python 3.8\n+        # https://docs.python.org/3/library/socket.html#socket.create_server\n+        #self.listen_socket = socket.create_server(address=bind, reuse_port=True)\n+        self.listen_socket = socket.socket(socket.AF_INET)\n+        self.listen_socket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)\n+        self.listen_socket.bind(bind)\n+        self.listen_socket.listen()\n+        #",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686799788",
      "id" : 686799788,
      "in_reply_to_id" : 686661792,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4Njc5OTc4OA==",
      "original_commit_id" : "25f9e113db979ef28b471664ae42c5f52daaba59",
      "original_line" : 32,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/basic_server.py",
      "position" : null,
      "pull_request_review_id" : 727443155,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-11T12:51:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686799788",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686799953"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686799953"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Added `,`.",
      "commit_id" : "16bf93e1361fa9a1503cadd96e5121d92937bfb5",
      "created_at" : "2021-08-11T12:51:44Z",
      "diff_hunk" : "@@ -0,0 +1,54 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021-2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test -onlynet\n+\"\"\"\n+\n+from test_framework.basic_server import (\n+    BasicServer,\n+    tor_control",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686799953",
      "id" : 686799953,
      "in_reply_to_id" : 686668471,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4Njc5OTk1Mw==",
      "original_commit_id" : "25f9e113db979ef28b471664ae42c5f52daaba59",
      "original_line" : 11,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "test/functional/feature_onlynet.py",
      "position" : null,
      "pull_request_review_id" : 727443364,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-11T12:51:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686799953",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686800249"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686800249"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "16bf93e1361fa9a1503cadd96e5121d92937bfb5",
      "created_at" : "2021-08-11T12:52:06Z",
      "diff_hunk" : "@@ -0,0 +1,93 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021-2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+A basic TCP server that responds to requests based on a given/custom criteria.\n+\"\"\"\n+\n+import socket\n+import threading\n+\n+\n+class BasicServer:\n+    # @param[in] bind Listen address and port tuple, for example (\"127.0.0.1\", 80)\n+    # @param[in] response_generator j\n+    def __init__(self, *, bind, response_generator):\n+        \"\"\"\n+        :param bind: Listen address-port tuple, for example (\"127.0.0.1\", 80)\n+\n+        :param response_generator: A callback function, supplied with the\n+        request. It returns a reply that is to be send to the client either as\n+        a string or as an array which is joined into a single string. If it\n+        returns None, then the connection is closed by the server.\n+        \"\"\"\n+        # create_server() is only in python 3.8\n+        # https://docs.python.org/3/library/socket.html#socket.create_server\n+        #self.listen_socket = socket.create_server(address=bind, reuse_port=True)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686800249",
      "id" : 686800249,
      "in_reply_to_id" : 686661675,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NjgwMDI0OQ==",
      "original_commit_id" : "25f9e113db979ef28b471664ae42c5f52daaba59",
      "original_line" : 27,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/basic_server.py",
      "position" : null,
      "pull_request_review_id" : 727443746,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-11T12:52:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686800249",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686865131"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686865131"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Comprehensions seem idiomatic/pythonic and the most-used way to do it in this codebase too (though I agree that a shorter `n` or `net` for the one line would probably be better than `network`), but I like your new version too. Nice and simple.",
      "commit_id" : "16bf93e1361fa9a1503cadd96e5121d92937bfb5",
      "created_at" : "2021-08-11T14:05:10Z",
      "diff_hunk" : "@@ -0,0 +1,54 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021-2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test -onlynet\n+\"\"\"\n+\n+from test_framework.basic_server import (\n+    BasicServer,\n+    tor_control\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+)\n+\n+\n+class OnlynetTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.extra_args = [\n+            ['-onlynet=ipv4', '-torcontrol=127.0.0.1:19051', '-listenonion=1'],\n+            ['-onlynet=ipv4', '-torcontrol=127.0.0.1:19051', '-listenonion=1', '-onion=127.0.0.1:9050'],\n+            ['-onlynet=ipv4', '-torcontrol=127.0.0.1:19051', '-listenonion=1', '-proxy=127.0.0.1:9050'],\n+        ]\n+        self.num_nodes = len(self.extra_args)\n+        self.tor_control_server = BasicServer(bind=('127.0.0.1', 19051),\n+                                              response_generator=tor_control)\n+\n+\n+    def run_test(self):\n+        def networks_dict(d):\n+            r = {}\n+            for x in d['networks']:\n+                r[x['name']] = x\n+            return r\n+\n+        # Would fail without https://github.com/bitcoin/bitcoin/pull/22651\n+        n0 = networks_dict(self.nodes[0].getnetworkinfo())\n+        assert_equal(n0['onion']['reachable'], False)\n+\n+        # Passes with or without https://github.com/bitcoin/bitcoin/pull/22651,\n+        # just to ensure behavior does not change unintended.\n+        n1 = networks_dict(self.nodes[1].getnetworkinfo())\n+        assert_equal(n1['onion']['reachable'], True)\n+\n+        # Passes with or without https://github.com/bitcoin/bitcoin/pull/22651,\n+        # just to ensure behavior does not change unintended.\n+        n2 = networks_dict(self.nodes[2].getnetworkinfo())\n+        assert_equal(n2['onion']['reachable'], True)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686865131",
      "id" : 686865131,
      "in_reply_to_id" : 686657721,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4Njg2NTEzMQ==",
      "original_commit_id" : "25f9e113db979ef28b471664ae42c5f52daaba59",
      "original_line" : 50,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "test/functional/feature_onlynet.py",
      "position" : null,
      "pull_request_review_id" : 727530382,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-11T14:05:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686865131",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686871346"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686871346"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Hm, after coming back here and rebuilding, the test now runs for me without it. Strange.  Sorry for the noise.",
      "commit_id" : "16bf93e1361fa9a1503cadd96e5121d92937bfb5",
      "created_at" : "2021-08-11T14:11:57Z",
      "diff_hunk" : "@@ -0,0 +1,54 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021-2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test -onlynet\n+\"\"\"\n+\n+from test_framework.basic_server import (\n+    BasicServer,\n+    tor_control\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+)\n+\n+\n+class OnlynetTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.extra_args = [",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686871346",
      "id" : 686871346,
      "in_reply_to_id" : 686656841,
      "line" : 21,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4Njg3MTM0Ng==",
      "original_commit_id" : "25f9e113db979ef28b471664ae42c5f52daaba59",
      "original_line" : 21,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "test/functional/feature_onlynet.py",
      "position" : 21,
      "pull_request_review_id" : 727539020,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-11T14:11:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686871346",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686873427"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686873427"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nits:\r\n\r\n- I think it's more robust to describe why than to refer to a GitHub PR or depend on GitHub in general\r\n\r\n- s/unintended/unintentionally/",
      "commit_id" : "16bf93e1361fa9a1503cadd96e5121d92937bfb5",
      "created_at" : "2021-08-11T14:14:12Z",
      "diff_hunk" : "@@ -0,0 +1,48 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021-2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test -onlynet configuration option.\n+\"\"\"\n+\n+from test_framework.basic_server import (\n+    BasicServer,\n+    tor_control,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+)\n+\n+\n+class OnlynetTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.extra_args = [\n+            ['-onlynet=ipv4', '-torcontrol=127.0.0.1:19051', '-listenonion=1'],\n+            ['-onlynet=ipv4', '-torcontrol=127.0.0.1:19051', '-listenonion=1', '-onion=127.0.0.1:9050'],\n+            ['-onlynet=ipv4', '-torcontrol=127.0.0.1:19051', '-listenonion=1', '-proxy=127.0.0.1:9050'],\n+        ]\n+        self.num_nodes = len(self.extra_args)\n+        self.tor_control_server = BasicServer(bind=('127.0.0.1', 19051),\n+                                              response_generator=tor_control)\n+        # see https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686656841\n+        self.setup_clean_chain = True\n+\n+    def onion_is_reachable(self, node):\n+        for net in self.nodes[node].getnetworkinfo()['networks']:\n+            if net['name'] == 'onion':\n+                return net['reachable']\n+        return False\n+\n+    def run_test(self):\n+        # Node 0 would fail the check without https://github.com/bitcoin/bitcoin/pull/22651.\n+        # Nodes 1 and 2 pass with or without https://github.com/bitcoin/bitcoin/pull/22651,\n+        # they are here just to ensure behavior does not change unintended.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686873427",
      "id" : 686873427,
      "line" : 41,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4Njg3MzQyNw==",
      "original_commit_id" : "16bf93e1361fa9a1503cadd96e5121d92937bfb5",
      "original_line" : 41,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "test/functional/feature_onlynet.py",
      "position" : 41,
      "pull_request_review_id" : 727541816,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-11T14:26:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686873427",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686876527"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686876527"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n        if (gArgs.GetArg(\"-onion\", \"\").empty() && AllowOutboundOnion()) {\r\n```",
      "commit_id" : "16bf93e1361fa9a1503cadd96e5121d92937bfb5",
      "created_at" : "2021-08-11T14:17:38Z",
      "diff_hunk" : "@@ -368,14 +368,26 @@ void TorController::add_onion_cb(TorControlConnection& _conn, const TorControlRe\n     }\n }\n \n+static bool AllowOutboundOnion()\n+{\n+    if (!gArgs.IsArgSet(\"-onlynet\")) {\n+        return true;\n+    }\n+    for (const auto& net : gArgs.GetArgs(\"-onlynet\")) {\n+        if (ParseNetwork(net) == NET_ONION) {\n+            return true;\n+        }\n+    }\n+    return false;\n+}\n+\n void TorController::auth_cb(TorControlConnection& _conn, const TorControlReply& reply)\n {\n     if (reply.code == 250) {\n         LogPrint(BCLog::TOR, \"tor: Authentication successful\\n\");\n \n-        // Now that we know Tor is running setup the proxy for onion addresses\n-        // if -onion isn't set to something else.\n-        if (gArgs.GetArg(\"-onion\", \"\") == \"\") {\n+        // Now that we know Tor is running, possibly set the proxy for onion addresses.\n+        if (gArgs.GetArg(\"-onion\", \"\") == \"\" && AllowOutboundOnion()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686876527",
      "id" : 686876527,
      "line" : 390,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4Njg3NjUyNw==",
      "original_commit_id" : "16bf93e1361fa9a1503cadd96e5121d92937bfb5",
      "original_line" : 390,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/torcontrol.cpp",
      "position" : 26,
      "pull_request_review_id" : 727541816,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-11T14:25:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686876527",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686883879"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686883879"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Would it make sense to test with multiple onlynet settings? (this is only a quick example, not a good one)\r\n\r\n```diff\r\ndiff --git a/test/functional/feature_onlynet.py b/test/functional/feature_onlynet.py\r\nindex 60e4caf33d..c43a541196 100755\r\n--- a/test/functional/feature_onlynet.py\r\n+++ b/test/functional/feature_onlynet.py\r\n@@ -22,6 +22,8 @@ class OnlynetTest(BitcoinTestFramework):\r\n             ['-onlynet=ipv4', '-torcontrol=127.0.0.1:19051', '-listenonion=1'],\r\n             ['-onlynet=ipv4', '-torcontrol=127.0.0.1:19051', '-listenonion=1', '-onion=127.0.0.1:9050'],\r\n             ['-onlynet=ipv4', '-torcontrol=127.0.0.1:19051', '-listenonion=1', '-proxy=127.0.0.1:9050'],\r\n+            ['-onlynet=ipv4', '-onlynet=ipv6', '-torcontrol=127.0.0.1:19051', '-listenonion=1'],\r\n         ]\r\n         self.num_nodes = len(self.extra_args)\r\n\r\n@@ -39,7 +41,7 @@ class OnlynetTest(BitcoinTestFramework):\r\n-        for node, expected_reachable in [[0, False], [1, True], [2, True]]:\r\n+        for node, expected_reachable in [[0, False], [1, True], [2, True], [3, False]]:\r\n             self.log.info(f'Verifying node {node} which uses {self.extra_args[node]}')\r\n             assert_equal(self.onion_is_reachable(node), expected_reachable)\r\n```\r\n",
      "commit_id" : "16bf93e1361fa9a1503cadd96e5121d92937bfb5",
      "created_at" : "2021-08-11T14:25:19Z",
      "diff_hunk" : "@@ -0,0 +1,48 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021-2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test -onlynet configuration option.\n+\"\"\"\n+\n+from test_framework.basic_server import (\n+    BasicServer,\n+    tor_control,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+)\n+\n+\n+class OnlynetTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.extra_args = [\n+            ['-onlynet=ipv4', '-torcontrol=127.0.0.1:19051', '-listenonion=1'],\n+            ['-onlynet=ipv4', '-torcontrol=127.0.0.1:19051', '-listenonion=1', '-onion=127.0.0.1:9050'],\n+            ['-onlynet=ipv4', '-torcontrol=127.0.0.1:19051', '-listenonion=1', '-proxy=127.0.0.1:9050'],\n+        ]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686883879",
      "id" : 686883879,
      "line" : 25,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4Njg4Mzg3OQ==",
      "original_commit_id" : "16bf93e1361fa9a1503cadd96e5121d92937bfb5",
      "original_line" : 25,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "test/functional/feature_onlynet.py",
      "position" : 25,
      "pull_request_review_id" : 727541816,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-11T14:50:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686883879",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Concept ACK",
      "created_at" : "2021-08-11T14:45:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#issuecomment-896890081",
      "id" : 896890081,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22651",
      "node_id" : "IC_kwDOABII5841dXTh",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-11T14:45:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/896890081",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/292191?v=4",
         "events_url" : "https://api.github.com/users/Talkless/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Talkless/followers",
         "following_url" : "https://api.github.com/users/Talkless/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Talkless/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Talkless",
         "id" : 292191,
         "login" : "Talkless",
         "node_id" : "MDQ6VXNlcjI5MjE5MQ==",
         "organizations_url" : "https://api.github.com/users/Talkless/orgs",
         "received_events_url" : "https://api.github.com/users/Talkless/received_events",
         "repos_url" : "https://api.github.com/users/Talkless/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Talkless/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Talkless/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Talkless"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`16bf93e136...5959ece29e`: address minor suggestions and avoid possibility of colliding listening ports by binding to port 0 (let the OS choose an available port, thanks @darosior for the idea!)",
      "created_at" : "2021-08-12T09:45:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#issuecomment-897498176",
      "id" : 897498176,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22651",
      "node_id" : "IC_kwDOABII5841frxA",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-12T09:45:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/897498176",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r687559139"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687559139"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think it is fine as it is. The point is to have `onlynet=...` but not `onlynet=onion`.",
      "commit_id" : "5959ece29e5b6b7ce0d8be60ae64a3312861f841",
      "created_at" : "2021-08-12T09:46:27Z",
      "diff_hunk" : "@@ -0,0 +1,48 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021-2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test -onlynet configuration option.\n+\"\"\"\n+\n+from test_framework.basic_server import (\n+    BasicServer,\n+    tor_control,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+)\n+\n+\n+class OnlynetTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.extra_args = [\n+            ['-onlynet=ipv4', '-torcontrol=127.0.0.1:19051', '-listenonion=1'],\n+            ['-onlynet=ipv4', '-torcontrol=127.0.0.1:19051', '-listenonion=1', '-onion=127.0.0.1:9050'],\n+            ['-onlynet=ipv4', '-torcontrol=127.0.0.1:19051', '-listenonion=1', '-proxy=127.0.0.1:9050'],\n+        ]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r687559139",
      "id" : 687559139,
      "in_reply_to_id" : 686883879,
      "line" : 28,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NzU1OTEzOQ==",
      "original_commit_id" : "16bf93e1361fa9a1503cadd96e5121d92937bfb5",
      "original_line" : 28,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "test/functional/feature_onlynet.py",
      "position" : 28,
      "pull_request_review_id" : 728397427,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-12T09:46:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687559139",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r687562997"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687562997"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "You suggested this one earlier and I deliberately skipped it but did not explain why.\r\n\r\nHere we are testing whether the result of `GetArg()` equals to its second argument, so it is better to keep that obvious, e.g. `GetArg(..., X) == X`.",
      "commit_id" : "5959ece29e5b6b7ce0d8be60ae64a3312861f841",
      "created_at" : "2021-08-12T09:51:24Z",
      "diff_hunk" : "@@ -368,14 +368,26 @@ void TorController::add_onion_cb(TorControlConnection& _conn, const TorControlRe\n     }\n }\n \n+static bool AllowOutboundOnion()\n+{\n+    if (!gArgs.IsArgSet(\"-onlynet\")) {\n+        return true;\n+    }\n+    for (const auto& net : gArgs.GetArgs(\"-onlynet\")) {\n+        if (ParseNetwork(net) == NET_ONION) {\n+            return true;\n+        }\n+    }\n+    return false;\n+}\n+\n void TorController::auth_cb(TorControlConnection& _conn, const TorControlReply& reply)\n {\n     if (reply.code == 250) {\n         LogPrint(BCLog::TOR, \"tor: Authentication successful\\n\");\n \n-        // Now that we know Tor is running setup the proxy for onion addresses\n-        // if -onion isn't set to something else.\n-        if (gArgs.GetArg(\"-onion\", \"\") == \"\") {\n+        // Now that we know Tor is running, possibly set the proxy for onion addresses.\n+        if (gArgs.GetArg(\"-onion\", \"\") == \"\" && AllowOutboundOnion()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r687562997",
      "id" : 687562997,
      "in_reply_to_id" : 686876527,
      "line" : 390,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NzU2Mjk5Nw==",
      "original_commit_id" : "16bf93e1361fa9a1503cadd96e5121d92937bfb5",
      "original_line" : 390,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/torcontrol.cpp",
      "position" : 26,
      "pull_request_review_id" : 728402289,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-12T09:51:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687562997",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r687563816"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687563816"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I agree, removed the github reference.\r\n\r\nI think \"uninternationally\" is even better, changed.",
      "commit_id" : "5959ece29e5b6b7ce0d8be60ae64a3312861f841",
      "created_at" : "2021-08-12T09:52:34Z",
      "diff_hunk" : "@@ -0,0 +1,48 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021-2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test -onlynet configuration option.\n+\"\"\"\n+\n+from test_framework.basic_server import (\n+    BasicServer,\n+    tor_control,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+)\n+\n+\n+class OnlynetTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.extra_args = [\n+            ['-onlynet=ipv4', '-torcontrol=127.0.0.1:19051', '-listenonion=1'],\n+            ['-onlynet=ipv4', '-torcontrol=127.0.0.1:19051', '-listenonion=1', '-onion=127.0.0.1:9050'],\n+            ['-onlynet=ipv4', '-torcontrol=127.0.0.1:19051', '-listenonion=1', '-proxy=127.0.0.1:9050'],\n+        ]\n+        self.num_nodes = len(self.extra_args)\n+        self.tor_control_server = BasicServer(bind=('127.0.0.1', 19051),\n+                                              response_generator=tor_control)\n+        # see https://github.com/bitcoin/bitcoin/pull/22651#discussion_r686656841\n+        self.setup_clean_chain = True\n+\n+    def onion_is_reachable(self, node):\n+        for net in self.nodes[node].getnetworkinfo()['networks']:\n+            if net['name'] == 'onion':\n+                return net['reachable']\n+        return False\n+\n+    def run_test(self):\n+        # Node 0 would fail the check without https://github.com/bitcoin/bitcoin/pull/22651.\n+        # Nodes 1 and 2 pass with or without https://github.com/bitcoin/bitcoin/pull/22651,\n+        # they are here just to ensure behavior does not change unintended.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r687563816",
      "id" : 687563816,
      "in_reply_to_id" : 686873427,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NzU2MzgxNg==",
      "original_commit_id" : "16bf93e1361fa9a1503cadd96e5121d92937bfb5",
      "original_line" : 41,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "test/functional/feature_onlynet.py",
      "position" : null,
      "pull_request_review_id" : 728403318,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-12T09:52:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687563816",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r687853500"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687853500"
         }
      },
      "author_association" : "MEMBER",
      "body" : "maybe use a docstring and describe the commit, feel free to ignore\r\n```diff\r\n-        # Node 0 would fail the check without c591379eb03381145c85ee5760ce829be337a749.\r\n-        # Nodes 1 and 2 pass with or without that commit, they are here just to ensure\r\n-        # behavior does not change unintentionally.\r\n+        \"\"\"\r\n+        - The test of node 0 would fail without commit c591379eb0,\r\n+          \"tor: respect non-onion -onlynet= for outgoing Tor connections.\"\r\n+\r\n+        - The tests of nodes 1 and 2 pass with or without that commit;\r\n+          they ensure that behavior does not change unintentionally.\r\n+        \"\"\"\r\n```\r\n",
      "commit_id" : "5959ece29e5b6b7ce0d8be60ae64a3312861f841",
      "created_at" : "2021-08-12T15:38:53Z",
      "diff_hunk" : "@@ -0,0 +1,47 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021-2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test -onlynet configuration option.\n+\"\"\"\n+\n+from test_framework.basic_server import (\n+    BasicServer,\n+    tor_control,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+)\n+\n+\n+class OnlynetTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.tor_control_server = BasicServer(bind=('127.0.0.1', 0),\n+                                              response_generator=tor_control)\n+        port = self.tor_control_server.listen_port\n+        self.extra_args = [\n+            ['-onlynet=ipv4', f'-torcontrol=127.0.0.1:{port}', '-listenonion=1'],\n+            ['-onlynet=ipv4', f'-torcontrol=127.0.0.1:{port}', '-listenonion=1', '-onion=127.0.0.1:9050'],\n+            ['-onlynet=ipv4', f'-torcontrol=127.0.0.1:{port}', '-listenonion=1', '-proxy=127.0.0.1:9050'],\n+        ]\n+        self.num_nodes = len(self.extra_args)\n+\n+    def onion_is_reachable(self, node):\n+        for net in self.nodes[node].getnetworkinfo()['networks']:\n+            if net['name'] == 'onion':\n+                return net['reachable']\n+        return False\n+\n+    def run_test(self):\n+        # Node 0 would fail the check without c591379eb03381145c85ee5760ce829be337a749.\n+        # Nodes 1 and 2 pass with or without that commit, they are here just to ensure\n+        # behavior does not change unintentionally.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r687853500",
      "id" : 687853500,
      "line" : 40,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4Nzg1MzUwMA==",
      "original_commit_id" : "5959ece29e5b6b7ce0d8be60ae64a3312861f841",
      "original_line" : 40,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "test/functional/feature_onlynet.py",
      "position" : 40,
      "pull_request_review_id" : 728782914,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-12T15:44:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687853500",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r687854013"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687854013"
         }
      },
      "author_association" : "MEMBER",
      "body" : "output is fairly long, could shorten without loss of signal, feel free to ignore\r\n```suggestion\r\n            self.log.info(f'Test node {node} {self.extra_args[node]}')\r\n```",
      "commit_id" : "5959ece29e5b6b7ce0d8be60ae64a3312861f841",
      "created_at" : "2021-08-12T15:39:28Z",
      "diff_hunk" : "@@ -0,0 +1,47 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021-2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test -onlynet configuration option.\n+\"\"\"\n+\n+from test_framework.basic_server import (\n+    BasicServer,\n+    tor_control,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+)\n+\n+\n+class OnlynetTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.tor_control_server = BasicServer(bind=('127.0.0.1', 0),\n+                                              response_generator=tor_control)\n+        port = self.tor_control_server.listen_port\n+        self.extra_args = [\n+            ['-onlynet=ipv4', f'-torcontrol=127.0.0.1:{port}', '-listenonion=1'],\n+            ['-onlynet=ipv4', f'-torcontrol=127.0.0.1:{port}', '-listenonion=1', '-onion=127.0.0.1:9050'],\n+            ['-onlynet=ipv4', f'-torcontrol=127.0.0.1:{port}', '-listenonion=1', '-proxy=127.0.0.1:9050'],\n+        ]\n+        self.num_nodes = len(self.extra_args)\n+\n+    def onion_is_reachable(self, node):\n+        for net in self.nodes[node].getnetworkinfo()['networks']:\n+            if net['name'] == 'onion':\n+                return net['reachable']\n+        return False\n+\n+    def run_test(self):\n+        # Node 0 would fail the check without c591379eb03381145c85ee5760ce829be337a749.\n+        # Nodes 1 and 2 pass with or without that commit, they are here just to ensure\n+        # behavior does not change unintentionally.\n+        for node, expected_reachable in [[0, False], [1, True], [2, True]]:\n+            self.log.info(f'Verifying node {node} which uses {self.extra_args[node]}')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r687854013",
      "id" : 687854013,
      "line" : 42,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4Nzg1NDAxMw==",
      "original_commit_id" : "5959ece29e5b6b7ce0d8be60ae64a3312861f841",
      "original_line" : 42,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "test/functional/feature_onlynet.py",
      "position" : 42,
      "pull_request_review_id" : 728782914,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-12T15:52:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687854013",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r687858037"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687858037"
         }
      },
      "author_association" : "MEMBER",
      "body" : "indeed, seeing a different random port on each run as described here",
      "commit_id" : "5959ece29e5b6b7ce0d8be60ae64a3312861f841",
      "created_at" : "2021-08-12T15:44:10Z",
      "diff_hunk" : "@@ -0,0 +1,94 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021-2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+A basic TCP server that responds to requests based on a given/custom criteria.\n+\"\"\"\n+\n+import socket\n+import threading\n+\n+\n+class BasicServer:\n+    def __init__(self, *, bind, response_generator):\n+        \"\"\"\n+        :param bind: Listen address-port tuple, for example (\"127.0.0.1\", 80).\n+        If the port is 0 then a random available one will be chosen and it",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r687858037",
      "id" : 687858037,
      "line" : 17,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4Nzg1ODAzNw==",
      "original_commit_id" : "5959ece29e5b6b7ce0d8be60ae64a3312861f841",
      "original_line" : 17,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/basic_server.py",
      "position" : 17,
      "pull_request_review_id" : 728782914,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-12T15:45:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687858037",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r689085583"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689085583"
         }
      },
      "author_association" : "NONE",
      "body" : "Because `==` will generate/call string comparison code, instead of just checking string length using `empty()`. Better just use specialized member functions instead of some kind \"generic\" comparison.\r\n\r\nAnother example is using `clear()` vs `= \"\"`: https://www.youtube.com/watch?v=3X9qK7HWxjk",
      "commit_id" : "5959ece29e5b6b7ce0d8be60ae64a3312861f841",
      "created_at" : "2021-08-15T12:55:22Z",
      "diff_hunk" : "@@ -368,14 +368,26 @@ void TorController::add_onion_cb(TorControlConnection& _conn, const TorControlRe\n     }\n }\n \n+static bool AllowOutboundOnion()\n+{\n+    if (!gArgs.IsArgSet(\"-onlynet\")) {\n+        return true;\n+    }\n+    for (const auto& net : gArgs.GetArgs(\"-onlynet\")) {\n+        if (ParseNetwork(net) == NET_ONION) {\n+            return true;\n+        }\n+    }\n+    return false;\n+}\n+\n void TorController::auth_cb(TorControlConnection& _conn, const TorControlReply& reply)\n {\n     if (reply.code == 250) {\n         LogPrint(BCLog::TOR, \"tor: Authentication successful\\n\");\n \n-        // Now that we know Tor is running setup the proxy for onion addresses\n-        // if -onion isn't set to something else.\n-        if (gArgs.GetArg(\"-onion\", \"\") == \"\") {\n+        // Now that we know Tor is running, possibly set the proxy for onion addresses.\n+        if (gArgs.GetArg(\"-onion\", \"\") == \"\" && AllowOutboundOnion()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r689085583",
      "id" : 689085583,
      "in_reply_to_id" : 686876527,
      "line" : 390,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4OTA4NTU4Mw==",
      "original_commit_id" : "16bf93e1361fa9a1503cadd96e5121d92937bfb5",
      "original_line" : 390,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/torcontrol.cpp",
      "position" : 26,
      "pull_request_review_id" : 730184663,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-15T12:55:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689085583",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/292191?v=4",
         "events_url" : "https://api.github.com/users/Talkless/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Talkless/followers",
         "following_url" : "https://api.github.com/users/Talkless/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Talkless/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Talkless",
         "id" : 292191,
         "login" : "Talkless",
         "node_id" : "MDQ6VXNlcjI5MjE5MQ==",
         "organizations_url" : "https://api.github.com/users/Talkless/orgs",
         "received_events_url" : "https://api.github.com/users/Talkless/received_events",
         "repos_url" : "https://api.github.com/users/Talkless/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Talkless/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Talkless/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Talkless"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r689088453"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689088453"
         }
      },
      "author_association" : "NONE",
      "body" : "Please consider using standard algorithms instead of hand-rolled loop:\r\n```\r\n#include <algorithm>\r\n...\r\n\r\n    const auto only_nets{gArgs.GetArgs(\"-onlynet\")};\r\n\r\n    //TODO: C++20: use std::ranges::any_of() instead\r\n    return std::any_of(only_nets.cbegin(), only_nets.cend(), [](const auto &net) {\r\n        return ParseNetwork(net) == NET_ONION;\r\n    });\r\n```",
      "commit_id" : "5959ece29e5b6b7ce0d8be60ae64a3312861f841",
      "created_at" : "2021-08-15T13:16:28Z",
      "diff_hunk" : "@@ -368,14 +368,26 @@ void TorController::add_onion_cb(TorControlConnection& _conn, const TorControlRe\n     }\n }\n \n+static bool AllowOutboundOnion()\n+{\n+    if (!gArgs.IsArgSet(\"-onlynet\")) {\n+        return true;\n+    }\n+    for (const auto& net : gArgs.GetArgs(\"-onlynet\")) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r689088453",
      "id" : 689088453,
      "line" : 376,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4OTA4ODQ1Mw==",
      "original_commit_id" : "5959ece29e5b6b7ce0d8be60ae64a3312861f841",
      "original_line" : 376,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/torcontrol.cpp",
      "position" : 9,
      "pull_request_review_id" : 730186627,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-15T13:16:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689088453",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/292191?v=4",
         "events_url" : "https://api.github.com/users/Talkless/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Talkless/followers",
         "following_url" : "https://api.github.com/users/Talkless/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Talkless/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Talkless",
         "id" : 292191,
         "login" : "Talkless",
         "node_id" : "MDQ6VXNlcjI5MjE5MQ==",
         "organizations_url" : "https://api.github.com/users/Talkless/orgs",
         "received_events_url" : "https://api.github.com/users/Talkless/received_events",
         "repos_url" : "https://api.github.com/users/Talkless/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Talkless/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Talkless/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Talkless"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This has a couple of ACKs and would be very good to have in 22.0 to alleviate user confusion over an impactful user-facing change in the release. @vasild, do you plan to update? Anyone else like to review here?",
      "created_at" : "2021-08-19T09:56:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#issuecomment-901778042",
      "id" : 901778042,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22651",
      "node_id" : "IC_kwDOABII5841wAp6",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-19T09:56:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/901778042",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r692117735"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/692117735"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think readability trumps micro-optimization here, leaving it as is.",
      "commit_id" : "a2ebcda19a25067cb8183f25f6ffd0a26065fcc5",
      "created_at" : "2021-08-19T13:36:55Z",
      "diff_hunk" : "@@ -368,14 +368,26 @@ void TorController::add_onion_cb(TorControlConnection& _conn, const TorControlRe\n     }\n }\n \n+static bool AllowOutboundOnion()\n+{\n+    if (!gArgs.IsArgSet(\"-onlynet\")) {\n+        return true;\n+    }\n+    for (const auto& net : gArgs.GetArgs(\"-onlynet\")) {\n+        if (ParseNetwork(net) == NET_ONION) {\n+            return true;\n+        }\n+    }\n+    return false;\n+}\n+\n void TorController::auth_cb(TorControlConnection& _conn, const TorControlReply& reply)\n {\n     if (reply.code == 250) {\n         LogPrint(BCLog::TOR, \"tor: Authentication successful\\n\");\n \n-        // Now that we know Tor is running setup the proxy for onion addresses\n-        // if -onion isn't set to something else.\n-        if (gArgs.GetArg(\"-onion\", \"\") == \"\") {\n+        // Now that we know Tor is running, possibly set the proxy for onion addresses.\n+        if (gArgs.GetArg(\"-onion\", \"\") == \"\" && AllowOutboundOnion()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r692117735",
      "id" : 692117735,
      "in_reply_to_id" : 686876527,
      "line" : 389,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MjExNzczNQ==",
      "original_commit_id" : "16bf93e1361fa9a1503cadd96e5121d92937bfb5",
      "original_line" : 389,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/torcontrol.cpp",
      "position" : 32,
      "pull_request_review_id" : 733997882,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-19T13:36:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/692117735",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r692118290"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/692118290"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Leaving it as is.",
      "commit_id" : "a2ebcda19a25067cb8183f25f6ffd0a26065fcc5",
      "created_at" : "2021-08-19T13:37:33Z",
      "diff_hunk" : "@@ -0,0 +1,47 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021-2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test -onlynet configuration option.\n+\"\"\"\n+\n+from test_framework.basic_server import (\n+    BasicServer,\n+    tor_control,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+)\n+\n+\n+class OnlynetTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.tor_control_server = BasicServer(bind=('127.0.0.1', 0),\n+                                              response_generator=tor_control)\n+        port = self.tor_control_server.listen_port\n+        self.extra_args = [\n+            ['-onlynet=ipv4', f'-torcontrol=127.0.0.1:{port}', '-listenonion=1'],\n+            ['-onlynet=ipv4', f'-torcontrol=127.0.0.1:{port}', '-listenonion=1', '-onion=127.0.0.1:9050'],\n+            ['-onlynet=ipv4', f'-torcontrol=127.0.0.1:{port}', '-listenonion=1', '-proxy=127.0.0.1:9050'],\n+        ]\n+        self.num_nodes = len(self.extra_args)\n+\n+    def onion_is_reachable(self, node):\n+        for net in self.nodes[node].getnetworkinfo()['networks']:\n+            if net['name'] == 'onion':\n+                return net['reachable']\n+        return False\n+\n+    def run_test(self):\n+        # Node 0 would fail the check without c591379eb03381145c85ee5760ce829be337a749.\n+        # Nodes 1 and 2 pass with or without that commit, they are here just to ensure\n+        # behavior does not change unintentionally.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r692118290",
      "id" : 692118290,
      "in_reply_to_id" : 687853500,
      "line" : 40,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MjExODI5MA==",
      "original_commit_id" : "5959ece29e5b6b7ce0d8be60ae64a3312861f841",
      "original_line" : 40,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "test/functional/feature_onlynet.py",
      "position" : 40,
      "pull_request_review_id" : 733998640,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-19T13:37:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/692118290",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r692119177"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/692119177"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "a2ebcda19a25067cb8183f25f6ffd0a26065fcc5",
      "created_at" : "2021-08-19T13:38:33Z",
      "diff_hunk" : "@@ -0,0 +1,47 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021-2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test -onlynet configuration option.\n+\"\"\"\n+\n+from test_framework.basic_server import (\n+    BasicServer,\n+    tor_control,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+)\n+\n+\n+class OnlynetTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.tor_control_server = BasicServer(bind=('127.0.0.1', 0),\n+                                              response_generator=tor_control)\n+        port = self.tor_control_server.listen_port\n+        self.extra_args = [\n+            ['-onlynet=ipv4', f'-torcontrol=127.0.0.1:{port}', '-listenonion=1'],\n+            ['-onlynet=ipv4', f'-torcontrol=127.0.0.1:{port}', '-listenonion=1', '-onion=127.0.0.1:9050'],\n+            ['-onlynet=ipv4', f'-torcontrol=127.0.0.1:{port}', '-listenonion=1', '-proxy=127.0.0.1:9050'],\n+        ]\n+        self.num_nodes = len(self.extra_args)\n+\n+    def onion_is_reachable(self, node):\n+        for net in self.nodes[node].getnetworkinfo()['networks']:\n+            if net['name'] == 'onion':\n+                return net['reachable']\n+        return False\n+\n+    def run_test(self):\n+        # Node 0 would fail the check without c591379eb03381145c85ee5760ce829be337a749.\n+        # Nodes 1 and 2 pass with or without that commit, they are here just to ensure\n+        # behavior does not change unintentionally.\n+        for node, expected_reachable in [[0, False], [1, True], [2, True]]:\n+            self.log.info(f'Verifying node {node} which uses {self.extra_args[node]}')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r692119177",
      "id" : 692119177,
      "in_reply_to_id" : 687854013,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MjExOTE3Nw==",
      "original_commit_id" : "5959ece29e5b6b7ce0d8be60ae64a3312861f841",
      "original_line" : 42,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "test/functional/feature_onlynet.py",
      "position" : null,
      "pull_request_review_id" : 733999825,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-19T13:38:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/692119177",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r692128599"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/692128599"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "a2ebcda19a25067cb8183f25f6ffd0a26065fcc5",
      "created_at" : "2021-08-19T13:49:03Z",
      "diff_hunk" : "@@ -368,14 +368,26 @@ void TorController::add_onion_cb(TorControlConnection& _conn, const TorControlRe\n     }\n }\n \n+static bool AllowOutboundOnion()\n+{\n+    if (!gArgs.IsArgSet(\"-onlynet\")) {\n+        return true;\n+    }\n+    for (const auto& net : gArgs.GetArgs(\"-onlynet\")) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r692128599",
      "id" : 692128599,
      "in_reply_to_id" : 689088453,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MjEyODU5OQ==",
      "original_commit_id" : "5959ece29e5b6b7ce0d8be60ae64a3312861f841",
      "original_line" : 376,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/torcontrol.cpp",
      "position" : null,
      "pull_request_review_id" : 734012647,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-19T13:49:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/692128599",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`5959ece29e...a2ebcda19a`: address some suggestions\r\n\r\n> @vasild, do you plan to update?\r\n\r\nDone! :)",
      "created_at" : "2021-08-19T13:49:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#issuecomment-901932190",
      "id" : 901932190,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22651",
      "node_id" : "IC_kwDOABII5841wmSe",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-19T13:49:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/901932190",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review re-ACK a2ebcda19a25067cb8183f25f6ffd0a26065fcc5 per `git diff 5959ece a2ebcda`, rebase on master, debug build, re-ran test a few times, and previously manually verified the behavior extensively as described in https://github.com/bitcoin/bitcoin/pull/22651#discussion_r684429929 and https://github.com/bitcoin/bitcoin/pull/22651#discussion_r684434758\r\n",
      "created_at" : "2021-08-19T14:53:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#issuecomment-901982638",
      "id" : 901982638,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22651",
      "node_id" : "IC_kwDOABII5841wymu",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-19T17:38:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/901982638",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Concept ACK",
      "created_at" : "2021-08-19T22:45:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#issuecomment-902300252",
      "id" : 902300252,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22651",
      "node_id" : "IC_kwDOABII5841yAJc",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-19T22:45:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/902300252",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/24482484?v=4",
         "events_url" : "https://api.github.com/users/Rspigler/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Rspigler/followers",
         "following_url" : "https://api.github.com/users/Rspigler/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Rspigler/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Rspigler",
         "id" : 24482484,
         "login" : "Rspigler",
         "node_id" : "MDQ6VXNlcjI0NDgyNDg0",
         "organizations_url" : "https://api.github.com/users/Rspigler/orgs",
         "received_events_url" : "https://api.github.com/users/Rspigler/received_events",
         "repos_url" : "https://api.github.com/users/Rspigler/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Rspigler/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Rspigler/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Rspigler"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "reACK https://github.com/bitcoin/bitcoin/pull/22651/commits/a2ebcda19a25067cb8183f25f6ffd0a26065fcc5\r\n\r\nMajor changes since last review:\r\n\r\n1. https://github.com/bitcoin/bitcoin/pull/22651#discussion_r689088453\r\n2. https://github.com/bitcoin/bitcoin/pull/22651#issuecomment-897498176",
      "created_at" : "2021-08-20T16:08:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#issuecomment-902800564",
      "id" : 902800564,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22651",
      "node_id" : "IC_kwDOABII5841z6S0",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-20T16:08:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/902800564",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> See also https://en.wikipedia.org/wiki/Principle_of_least_astonishment\r\n\r\nTo be honest this whole situation around onlynet gives me a headache: https://github.com/bitcoin/bitcoin/pull/22648#pullrequestreview-739349992",
      "created_at" : "2021-08-26T11:28:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#issuecomment-906322657",
      "id" : 906322657,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22651",
      "node_id" : "IC_kwDOABII5842BWLh",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-26T11:28:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/906322657",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r696627152"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/696627152"
         }
      },
      "author_association" : "NONE",
      "body" : "This is not micro-optimization, but avoiding unnecessary possible premature pessimization, see: https://stackoverflow.com/questions/15875252/premature-optimization-and-premature-pessimization-related-to-c-coding-standar/32269630#32269630\r\n\r\nIt's not optimization as it's not something more complex, harder to write or to read, not something uncommon.",
      "commit_id" : "a2ebcda19a25067cb8183f25f6ffd0a26065fcc5",
      "created_at" : "2021-08-26T13:25:43Z",
      "diff_hunk" : "@@ -368,14 +368,26 @@ void TorController::add_onion_cb(TorControlConnection& _conn, const TorControlRe\n     }\n }\n \n+static bool AllowOutboundOnion()\n+{\n+    if (!gArgs.IsArgSet(\"-onlynet\")) {\n+        return true;\n+    }\n+    for (const auto& net : gArgs.GetArgs(\"-onlynet\")) {\n+        if (ParseNetwork(net) == NET_ONION) {\n+            return true;\n+        }\n+    }\n+    return false;\n+}\n+\n void TorController::auth_cb(TorControlConnection& _conn, const TorControlReply& reply)\n {\n     if (reply.code == 250) {\n         LogPrint(BCLog::TOR, \"tor: Authentication successful\\n\");\n \n-        // Now that we know Tor is running setup the proxy for onion addresses\n-        // if -onion isn't set to something else.\n-        if (gArgs.GetArg(\"-onion\", \"\") == \"\") {\n+        // Now that we know Tor is running, possibly set the proxy for onion addresses.\n+        if (gArgs.GetArg(\"-onion\", \"\") == \"\" && AllowOutboundOnion()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r696627152",
      "id" : 696627152,
      "in_reply_to_id" : 686876527,
      "line" : 389,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NjYyNzE1Mg==",
      "original_commit_id" : "16bf93e1361fa9a1503cadd96e5121d92937bfb5",
      "original_line" : 389,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/torcontrol.cpp",
      "position" : 32,
      "pull_request_review_id" : 739471549,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-26T13:25:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/696627152",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/292191?v=4",
         "events_url" : "https://api.github.com/users/Talkless/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Talkless/followers",
         "following_url" : "https://api.github.com/users/Talkless/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Talkless/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Talkless",
         "id" : 292191,
         "login" : "Talkless",
         "node_id" : "MDQ6VXNlcjI5MjE5MQ==",
         "organizations_url" : "https://api.github.com/users/Talkless/orgs",
         "received_events_url" : "https://api.github.com/users/Talkless/received_events",
         "repos_url" : "https://api.github.com/users/Talkless/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Talkless/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Talkless/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Talkless"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r696707142"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/696707142"
         }
      },
      "author_association" : "NONE",
      "body" : "`const auto& onlynets` should not be a reference (it was not in my suggestion). It does extend lifetime of temporary, so no undefined horrors here, but since `GetArgs` does not return `const&`, and returned object does not use polymorphism, `&` seems out of place here.",
      "commit_id" : "a2ebcda19a25067cb8183f25f6ffd0a26065fcc5",
      "created_at" : "2021-08-26T14:50:08Z",
      "diff_hunk" : "@@ -368,14 +369,24 @@ void TorController::add_onion_cb(TorControlConnection& _conn, const TorControlRe\n     }\n }\n \n+static bool AllowOutboundOnion()\n+{\n+    if (!gArgs.IsArgSet(\"-onlynet\")) {\n+        return true;\n+    }\n+    const auto& onlynets = gArgs.GetArgs(\"-onlynet\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r696707142",
      "id" : 696707142,
      "line" : 377,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NjcwNzE0Mg==",
      "original_commit_id" : "a2ebcda19a25067cb8183f25f6ffd0a26065fcc5",
      "original_line" : 377,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/torcontrol.cpp",
      "position" : 17,
      "pull_request_review_id" : 739580117,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-26T14:50:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/696707142",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/292191?v=4",
         "events_url" : "https://api.github.com/users/Talkless/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Talkless/followers",
         "following_url" : "https://api.github.com/users/Talkless/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Talkless/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Talkless",
         "id" : 292191,
         "login" : "Talkless",
         "node_id" : "MDQ6VXNlcjI5MjE5MQ==",
         "organizations_url" : "https://api.github.com/users/Talkless/orgs",
         "received_events_url" : "https://api.github.com/users/Talkless/received_events",
         "repos_url" : "https://api.github.com/users/Talkless/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Talkless/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Talkless/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Talkless"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r698478079"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/698478079"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Removed.",
      "commit_id" : "baa6cb12ac5071bb68eb5ec375be73df4f4ae28f",
      "created_at" : "2021-08-30T13:15:37Z",
      "diff_hunk" : "@@ -368,14 +369,24 @@ void TorController::add_onion_cb(TorControlConnection& _conn, const TorControlRe\n     }\n }\n \n+static bool AllowOutboundOnion()\n+{\n+    if (!gArgs.IsArgSet(\"-onlynet\")) {\n+        return true;\n+    }\n+    const auto& onlynets = gArgs.GetArgs(\"-onlynet\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#discussion_r698478079",
      "id" : 698478079,
      "in_reply_to_id" : 696707142,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5ODQ3ODA3OQ==",
      "original_commit_id" : "a2ebcda19a25067cb8183f25f6ffd0a26065fcc5",
      "original_line" : 377,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/torcontrol.cpp",
      "position" : null,
      "pull_request_review_id" : 741634705,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-30T13:15:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/698478079",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`a2ebcda19a...baa6cb12ac`: address minor suggestion and fix commit id in a comment.",
      "created_at" : "2021-08-30T13:16:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#issuecomment-908334015",
      "id" : 908334015,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22651",
      "node_id" : "IC_kwDOABII5842JBO_",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-30T13:16:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/908334015",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@laanwj, I agree with your comments at https://github.com/bitcoin/bitcoin/pull/22648#discussion_r696535966. Opened https://github.com/bitcoin/bitcoin/pull/22834 which if merged will make this PR unnecessary.\r\n\r\nIMO https://github.com/bitcoin/bitcoin/pull/22834 should be merged and this PR (https://github.com/bitcoin/bitcoin/pull/22651) closed without merge. But lets see what reviewers think.",
      "created_at" : "2021-08-30T13:18:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#issuecomment-908335719",
      "id" : 908335719,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22651",
      "node_id" : "IC_kwDOABII5842JBpn",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-30T13:19:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/908335719",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review re-ACK baa6cb12ac5071bb68eb5ec375be73df4f4ae28f per `git diff a2ebcda baa6cb1`, rebase on master, debug build, ran the new test `test/functional/feature_onlynet.py` a few times, previously manually verified the behavior extensively as described in https://github.com/bitcoin/bitcoin/pull/22651#discussion_r684429929 and https://github.com/bitcoin/bitcoin/pull/22651#discussion_r684434758\r\n\r\nWill review #22834 soon. Perhaps the functional test work here can be ~ported over to it if that change is preferred.",
      "created_at" : "2021-08-30T17:00:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#issuecomment-908513666",
      "id" : 908513666,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22651",
      "node_id" : "IC_kwDOABII5842JtGC",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-30T17:00:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/908513666",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "#22834 looks like a better solution IMO",
      "created_at" : "2021-09-14T16:44:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#issuecomment-919326718",
      "id" : 919326718,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22651",
      "node_id" : "IC_kwDOABII5842y8_-",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-14T16:44:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/919326718",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> #22834 looks like a better solution IMO\r\n\r\nSo this PR should be closed?\r\n\r\n@vasild I'm confused :)",
      "created_at" : "2021-11-06T14:00:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#issuecomment-962456059",
      "id" : 962456059,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22651",
      "node_id" : "IC_kwDOABII5845Xen7",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/962456059/reactions"
      },
      "updated_at" : "2021-11-06T14:00:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/962456059",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/292191?v=4",
         "events_url" : "https://api.github.com/users/Talkless/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Talkless/followers",
         "following_url" : "https://api.github.com/users/Talkless/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Talkless/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Talkless",
         "id" : 292191,
         "login" : "Talkless",
         "node_id" : "MDQ6VXNlcjI5MjE5MQ==",
         "organizations_url" : "https://api.github.com/users/Talkless/orgs",
         "received_events_url" : "https://api.github.com/users/Talkless/received_events",
         "repos_url" : "https://api.github.com/users/Talkless/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Talkless/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Talkless/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Talkless"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Closing this in favor of https://github.com/bitcoin/bitcoin/pull/22834 which has more (concept) ACKs.\r\n\r\nThanks, @Talkless!",
      "created_at" : "2021-11-08T08:47:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22651#issuecomment-962931750",
      "id" : 962931750,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22651",
      "node_id" : "IC_kwDOABII5845ZSwm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/962931750/reactions"
      },
      "updated_at" : "2021-11-08T08:47:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/962931750",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   }
]
