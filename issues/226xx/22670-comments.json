[
   {
      "author_association" : "NONE",
      "body" : "In the wallet state where this error is surely reproduced, stop v22.0 and start v0.21.1. And when I execute the same transaction, no error occurs. v0.21.1 calculates fee correctly.\r\nSimilar confirmations were made for v0.21.0 and v0.20.0. These calculate the fee correctly.\r\n\r\nFrom the above test results, it can be said that the calculation of fee before remittance of v22.0 has changed significantly from the past version.",
      "created_at" : "2021-08-10T04:58:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/22670#issuecomment-895729528",
      "id" : 895729528,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22670",
      "node_id" : "IC_kwDOABII5841Y794",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-10T04:58:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/895729528",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7656623?v=4",
         "events_url" : "https://api.github.com/users/fujicoin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fujicoin/followers",
         "following_url" : "https://api.github.com/users/fujicoin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fujicoin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fujicoin",
         "id" : 7656623,
         "login" : "fujicoin",
         "node_id" : "MDQ6VXNlcjc2NTY2MjM=",
         "organizations_url" : "https://api.github.com/users/fujicoin/orgs",
         "received_events_url" : "https://api.github.com/users/fujicoin/received_events",
         "repos_url" : "https://api.github.com/users/fujicoin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fujicoin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fujicoin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fujicoin"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "For reference, attach the debug.log of the relevant part when an error occurs.\r\n[debug.log](https://github.com/bitcoin/bitcoin/files/6959757/debug.log)\r\n",
      "created_at" : "2021-08-10T07:27:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/22670#issuecomment-895796394",
      "id" : 895796394,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22670",
      "node_id" : "IC_kwDOABII5841ZMSq",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-10T07:27:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/895796394",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7656623?v=4",
         "events_url" : "https://api.github.com/users/fujicoin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fujicoin/followers",
         "following_url" : "https://api.github.com/users/fujicoin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fujicoin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fujicoin",
         "id" : 7656623,
         "login" : "fujicoin",
         "node_id" : "MDQ6VXNlcjc2NTY2MjM=",
         "organizations_url" : "https://api.github.com/users/fujicoin/orgs",
         "received_events_url" : "https://api.github.com/users/fujicoin/received_events",
         "repos_url" : "https://api.github.com/users/fujicoin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fujicoin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fujicoin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fujicoin"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I made a program with python and calculated fee from raw Tx. In my calculation the fee was 2.57729334.\r\nTherefore, it is correct to be out of memoly pool due to insufficient remittance fee.\r\n\r\n@fujicoin Did you try to abandon the transaction using [`abandontransaction`](https://bitcoincore.org/en/doc/0.21.0/rpc/wallet/abandontransaction/) and use a higher fee rate?\r\n\r\nThere are few questions with similar issues in which low fee rate was used and transaction timed out: https://bitcoin.stackexchange.com/search?q=not+in+memory+pool\r\n\r\nSimilar thing is mentioned in your log file:\r\n\r\n```\r\n2021-08-10T00:24:04Z [default wallet] Submitting wtx c6281e449ad08aa694d28c32cc545b8ddb3d01f74e3b0eff4f81ce9e9c6e616d to mempool for relay\r\n2021-08-10T00:24:04Z [default wallet] CommitTransaction(): Transaction cannot be broadcast immediately, min relay fee not met, 257729334 < 527440000\r\n```\r\n\r\n> I often create large transactions with more than 350 inputs\r\n\r\nNot sure what all changes you made in your altcoin, there are some size limits on transactions too in Bitcoin. For example someone was getting an error in NBitcoin recently for using lot of inputs: https://gitter.im/MetacoSA/NBitcoin?at=60eef4327473bf3d7825ab85\r\n\r\nDon't think there are any issues in Bitcoin Core so this issue is off-topic IMO.",
      "created_at" : "2021-08-10T08:06:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/22670#issuecomment-895820701",
      "id" : 895820701,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22670",
      "node_id" : "IC_kwDOABII5841ZSOd",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-10T08:06:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/895820701",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@prayank23\r\nI'm not having such a low-level discussion.\r\nIn the first image, the Total Amount is 5005.27790000 and the fee is 5.27790000. The remittance amount is 5000.\r\nIn the third image, Netamount is 5002.57729334 and fee is 2.57729334.\r\nDon't you think this is strange?",
      "created_at" : "2021-08-10T10:21:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/22670#issuecomment-895911436",
      "id" : 895911436,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22670",
      "node_id" : "IC_kwDOABII5841ZoYM",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-10T10:21:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/895911436",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7656623?v=4",
         "events_url" : "https://api.github.com/users/fujicoin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fujicoin/followers",
         "following_url" : "https://api.github.com/users/fujicoin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fujicoin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fujicoin",
         "id" : 7656623,
         "login" : "fujicoin",
         "node_id" : "MDQ6VXNlcjc2NTY2MjM=",
         "organizations_url" : "https://api.github.com/users/fujicoin/orgs",
         "received_events_url" : "https://api.github.com/users/fujicoin/received_events",
         "repos_url" : "https://api.github.com/users/fujicoin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fujicoin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fujicoin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fujicoin"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This is likely due to the coin selection changes that were merged for 22.0. I'll have a closer look.\r\n\r\nYour debug.log indicates that either `-paytxfee` was set or you set a custom feerate when making the transaction. Which did you set, and what was it set to?\r\n\r\nAre you able to recreate this issue using just Bitcoin Core on regtest?\r\n\r\n***\r\n\r\n~~The failure should come from an error is size estimation. It appears to be estimating that the size of the transaction is less than half of the actual size of the transaction.~~ Edit: No, it's estimating the right size, the output value is being set incorrectly. Or maybe its input values are calculated incorrectly.\r\n\r\n***\r\n\r\nAs an experiment, can you try using raw transaction RPCs? `fundrawtransaction` will return the estimated transaction fee, and after you do `sendrawtransaction`, you can lookup the actual transaction fee in the wallet.",
      "created_at" : "2021-08-10T18:20:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/22670#issuecomment-896212727",
      "id" : 896212727,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22670",
      "node_id" : "IC_kwDOABII5841ax73",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-10T18:39:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/896212727",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@achow101\r\nI have set 0.1 FJC / kB as the Custom feerate.\r\nThis value corresponds to the minimum feerate. ",
      "created_at" : "2021-08-10T18:33:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/22670#issuecomment-896221154",
      "id" : 896221154,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22670",
      "node_id" : "IC_kwDOABII5841az_i",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-10T18:33:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/896221154",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7656623?v=4",
         "events_url" : "https://api.github.com/users/fujicoin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fujicoin/followers",
         "following_url" : "https://api.github.com/users/fujicoin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fujicoin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fujicoin",
         "id" : 7656623,
         "login" : "fujicoin",
         "node_id" : "MDQ6VXNlcjc2NTY2MjM=",
         "organizations_url" : "https://api.github.com/users/fujicoin/orgs",
         "received_events_url" : "https://api.github.com/users/fujicoin/received_events",
         "repos_url" : "https://api.github.com/users/fujicoin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fujicoin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fujicoin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fujicoin"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@fujicoin Can you provide the output of `getrawtransaction c6281e449ad08aa694d28c32cc545b8ddb3d01f74e3b0eff4f81ce9e9c6e616d true` or `gettransaction c6281e449ad08aa694d28c32cc545b8ddb3d01f74e3b0eff4f81ce9e9c6e616d true true`?",
      "created_at" : "2021-08-10T18:54:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/22670#issuecomment-896234590",
      "id" : 896234590,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22670",
      "node_id" : "IC_kwDOABII5841a3Re",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-10T18:55:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/896234590",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I tested with a transaction that failed to transfer 3000 FJC.\r\nThe following image is the information at the time of remittance. The fee is 3.172. \r\n![fujicoin11](https://user-images.githubusercontent.com/7656623/128918488-b71ef273-13de-44f5-b224-b3a70f7268f5.png)\r\n\r\nWhen I checked this transaction with `fundrawtransaction`, I got the following response.\r\nThe fee rate was specified as 0.1 FJC/kB.\r\n`fundrawtransaction \"[RAW TX]\" \"{\\\"feeRate\\\": 0.1}\"`\r\n```\r\n\"fee\": 3.18670000,\r\n  \"changepos\": 0\r\n```\r\n\r\nThe result of `sendrawtransaction` is as follows:\r\n```\r\nmin relay fee not met, 253605577 < 316870000 (code -26)\r\n```\r\n\r\n",
      "created_at" : "2021-08-10T18:58:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/22670#issuecomment-896236890",
      "id" : 896236890,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22670",
      "node_id" : "IC_kwDOABII5841a31a",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-10T19:20:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/896236890",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7656623?v=4",
         "events_url" : "https://api.github.com/users/fujicoin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fujicoin/followers",
         "following_url" : "https://api.github.com/users/fujicoin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fujicoin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fujicoin",
         "id" : 7656623,
         "login" : "fujicoin",
         "node_id" : "MDQ6VXNlcjc2NTY2MjM=",
         "organizations_url" : "https://api.github.com/users/fujicoin/orgs",
         "received_events_url" : "https://api.github.com/users/fujicoin/received_events",
         "repos_url" : "https://api.github.com/users/fujicoin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fujicoin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fujicoin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fujicoin"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I believe the issue is in the effective value calculation for inputs. Since the fee is being underpaid, that means that the effective value of inputs is calculated to be higher than it actually is, which means that the size is being calculated smaller than it actually is. I don't see anything in our code that would cause this issue that would not be apparent in smaller transactions. It is possible that the wallet may be corrupted and contain some data that causes the size calculation of inputs to be incorrect, however I don't really know what would cause that (the size calculation is only dependent on scriptPubKeys and private keys).\r\n\r\nPossibly the issue is that there are some inputs which are causing the problem and so you are seeing the issue with only very large txs because they happen to include those inputs. This could be tested by using `fundrawtransaction` with only one input and making sure that only that input is in the funded tx. Then use `testmempoolaccept` (instead of `sendrawtransaction` so no transactions are actually sent) to see the tx works. If this hypothesis is correct, then some txs will fail and those inputs would be the problem.\r\n\r\nOtherwise, I can't tell what the issue is without having a test case to experiment with myself.",
      "created_at" : "2021-08-10T20:14:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/22670#issuecomment-896288411",
      "id" : 896288411,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22670",
      "node_id" : "IC_kwDOABII5841bEab",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-10T20:14:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/896288411",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@achow101\r\nThank you for your answer.\r\nI am trying to reproduce with bitcoin v22.0 rc2 windows-qt regtest. But for now, even if I make a big transaction, the problem doesn't occur.\r\nI will consider the peculiar input UTXO based on your suggestions.",
      "created_at" : "2021-08-10T21:13:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/22670#issuecomment-896320384",
      "id" : 896320384,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22670",
      "node_id" : "IC_kwDOABII5841bMOA",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-10T21:13:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/896320384",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7656623?v=4",
         "events_url" : "https://api.github.com/users/fujicoin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fujicoin/followers",
         "following_url" : "https://api.github.com/users/fujicoin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fujicoin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fujicoin",
         "id" : 7656623,
         "login" : "fujicoin",
         "node_id" : "MDQ6VXNlcjc2NTY2MjM=",
         "organizations_url" : "https://api.github.com/users/fujicoin/orgs",
         "received_events_url" : "https://api.github.com/users/fujicoin/received_events",
         "repos_url" : "https://api.github.com/users/fujicoin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fujicoin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fujicoin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fujicoin"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "The wallet currently being tested is collecting coins newly generated by mining. A rescan was performed, but the situation has not changed.\r\n\r\nSubsequent investigations revealed that:\r\nã»I checked 24 transactions that failed to transfer money, but all of them have one \"vout\". There is no change vout.\r\nãAlthough the fee is insufficient, the total amount will not be less than the remittance amount. It's as if wallet considers fee to be zero.\r\nã»Transactions that fail to remit use the output of change.\r\nã»Successful large transactions do not use change outputs.\r\n\r\nã»When all the change were locked, a big transaction will succeed. Conversely, unlocking will fail.\r\nã»Change is bech32 address by default. I made a change and tested it by specifying \"legacy\" or \"p2sh-segwit\" with `-changetype`.\r\nã»If I unlock only the \"legacy\" change and send money, it will fail. Also, even if I unlock only the change of \"p2sh-segwit\" and send the money, it will fail.\r\nIn short, using change fails a big transaction.\r\n\r\nA similar test was performed with fujicoin v0.21.0 qt.\r\nUnlock only bech32 change. Large transactions succeed. The transaction input contains the change.\r\nSimilar results were obtained by testing with \"legacy\" or \"p2sh-segwit\" change.\r\n\r\nWhat I can say for sure is that the v22.0rc2 and v0.21.0 wallets behave differently.",
      "created_at" : "2021-08-11T07:28:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/22670#issuecomment-896570186",
      "id" : 896570186,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22670",
      "node_id" : "IC_kwDOABII5841cJNK",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-11T07:28:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/896570186",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7656623?v=4",
         "events_url" : "https://api.github.com/users/fujicoin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fujicoin/followers",
         "following_url" : "https://api.github.com/users/fujicoin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fujicoin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fujicoin",
         "id" : 7656623,
         "login" : "fujicoin",
         "node_id" : "MDQ6VXNlcjc2NTY2MjM=",
         "organizations_url" : "https://api.github.com/users/fujicoin/orgs",
         "received_events_url" : "https://api.github.com/users/fujicoin/received_events",
         "repos_url" : "https://api.github.com/users/fujicoin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fujicoin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fujicoin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fujicoin"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@fujicoin If you unlock on bech32 change on 22.0rc2, does it also fail?",
      "created_at" : "2021-08-11T17:39:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/22670#issuecomment-897020591",
      "id" : 897020591,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22670",
      "node_id" : "IC_kwDOABII5841d3Kv",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-11T17:39:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/897020591",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@achow101\r\nYes, it also fail.\r\nI'm still considering it with bitcoin v22.0rc2 regtest. I found something interesting and will report it soon.\r\n",
      "created_at" : "2021-08-11T19:13:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/22670#issuecomment-897082966",
      "id" : 897082966,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22670",
      "node_id" : "IC_kwDOABII5841eGZW",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-11T19:13:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/897082966",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7656623?v=4",
         "events_url" : "https://api.github.com/users/fujicoin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fujicoin/followers",
         "following_url" : "https://api.github.com/users/fujicoin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fujicoin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fujicoin",
         "id" : 7656623,
         "login" : "fujicoin",
         "node_id" : "MDQ6VXNlcjc2NTY2MjM=",
         "organizations_url" : "https://api.github.com/users/fujicoin/orgs",
         "received_events_url" : "https://api.github.com/users/fujicoin/received_events",
         "repos_url" : "https://api.github.com/users/fujicoin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fujicoin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fujicoin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fujicoin"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "With bitcoin v22.0rc2 regtest, even if I blindly perform a reproduction test on a large transaction, it does not reproduce.\r\nSo I decided to create an environment similar to fujicoin's wallet.\r\nMy fuji coin wallet is a collection of generated coins of about 13.99 FJC.\r\nThe minimum fee for fujicoin is 10000sat / byte. On the other hand, bitcoin is 1sat / byte. So I made the bitcoin wallet a set of 0.001399 BTC.\r\nNext, I made 0.0002, 0.0003, 0.0004, 0.0005 change.\r\nThen, I sent 0.3BTC and 0.5BTC, but no error occurred as a result.\r\n\r\nWhat is interesting is the change generated at this time.\r\nAlthough the wallet is a set of 0.001399 BTC, large changes of 0.00974425 and 0.01009771 were generated.\r\n\r\nOn the other hand, in fujicoin, if the transaction is successful, a small change of about 3FJC is generated for the set of 13.99FJC.\r\n\r\nThis means that bitcoin has more transaction inputs. Of course, this difference is considered to be due to the difference in the fee-related parameters of bitcoin and fujicoin.\r\n\r\nThe fee-related parameters of fujicoin are as follows.\r\n```\r\nDEFAULT_MIN_RELAY_TX_FEE\t10000000\r\nDEFAULT_TRANSACTION_MAXFEE\t\t10 * COIN\r\nHIGH_TX_FEE_PER_KB\t\t1 * COIN\r\nHIGH_MAX_TX_FEE\t\t100 * HIGH_TX_FEE_PER_KB\r\nDEFAULT_BLOCK_MIN_TX_FEE\t10000000\r\nDEFAULT_INCREMENTAL_RELAY_FEE\t10000000\r\nDUST_RELAY_TX_FEE\t3000\r\nDEFAULT_PAY_TX_FEE\t0\r\nDEFAULT_FALLBACK_FEE\t20000000\r\nDEFAULT_DISCARD_FEE\t100000000\r\nDEFAULT_TRANSACTION_MINFEE\t10000000\r\nWALLET_INCREMENTAL_RELAY_FEE\t50000000\r\n```\r\n\r\nWhich parameters are affecting the number of inputs in a transaction?\r\nIt is thought that the reason why the parameters have an influence on the creation of transactions is that the transaction-related programs have been significantly rewritten in v22.0.\r\n\r\nâ postscript:\r\nThis seems to be irrelevant as it is the same for bitcoin v0.21.0 and fujicoin v0.21.0.",
      "created_at" : "2021-08-11T20:10:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/22670#issuecomment-897118136",
      "id" : 897118136,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22670",
      "node_id" : "IC_kwDOABII5841eO-4",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-11T22:45:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/897118136",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7656623?v=4",
         "events_url" : "https://api.github.com/users/fujicoin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fujicoin/followers",
         "following_url" : "https://api.github.com/users/fujicoin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fujicoin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fujicoin",
         "id" : 7656623,
         "login" : "fujicoin",
         "node_id" : "MDQ6VXNlcjc2NTY2MjM=",
         "organizations_url" : "https://api.github.com/users/fujicoin/orgs",
         "received_events_url" : "https://api.github.com/users/fujicoin/received_events",
         "repos_url" : "https://api.github.com/users/fujicoin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fujicoin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fujicoin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fujicoin"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "In the first place, whether the address is for change or not knows only the wallet that has the address. Other wallets don't know if the address is for change and it doesn't matter.\r\nWhy does the change in the input address affect when creating a transaction? Where is the part that is judged to be change and processed?\r\nThis problem may not be a miscalculation of fee.",
      "created_at" : "2021-08-11T22:27:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/22670#issuecomment-897202739",
      "id" : 897202739,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22670",
      "node_id" : "IC_kwDOABII5841ejoz",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-11T22:27:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/897202739",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7656623?v=4",
         "events_url" : "https://api.github.com/users/fujicoin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fujicoin/followers",
         "following_url" : "https://api.github.com/users/fujicoin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fujicoin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fujicoin",
         "id" : 7656623,
         "login" : "fujicoin",
         "node_id" : "MDQ6VXNlcjc2NTY2MjM=",
         "organizations_url" : "https://api.github.com/users/fujicoin/orgs",
         "received_events_url" : "https://api.github.com/users/fujicoin/received_events",
         "repos_url" : "https://api.github.com/users/fujicoin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fujicoin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fujicoin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fujicoin"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I have found the source of the problem, and I'm able to replicate the error on regtest when I set the minrelayfee to be similarly high. The culprit is that there are some places where we use an outputs real value rather than its effective value. I think the issue is much more apparent at high feerates because the difference between the effective value and the real value of an output is much larger so using the incorrect value means the calculation error can become big enough to be an issue.\r\n\r\nI'll have a fix shortly.\r\n\r\n***\r\n\r\nThe problem with the change outputs probably has to do with the size of the outputs rather than the fact that they are change.",
      "created_at" : "2021-08-11T23:50:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/22670#issuecomment-897235475",
      "id" : 897235475,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22670",
      "node_id" : "IC_kwDOABII5841eroT",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-11T23:57:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/897235475",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@achow101\r\nYou are right. I have now succeeded in reproducing the problem with bitcoin's regtest.\r\nI finally succeeded in reproducing the phenomenon with bitcoin v22.0rc3 regtest. Create a wallet situation that is almost the same as fujicoin.\r\nã»set -maxtxfee=10\r\nã»Send 13.99 BTC 400 times to one legacy address of an empty wallet-A.\r\nã»Advance one block.\r\nã»Select one UTXO of wallet-A and send 11BTC to the other wallet.\r\nã»Select one UTXO of wallet-A and send 10.5 BTC to the other wallet.\r\nã»Advance one block.\r\nã»set Custom tx fee to 0.1 BTC/kB\r\nã»Send 3000 BTC to another wallet.\r\nThis method reproduces the problem. The transaction before remittance and the actual transaction are different.\r\n![bitcoin1](https://user-images.githubusercontent.com/7656623/129127134-dee7add4-73c5-4250-af28-09c5c5ecd5a8.png)\r\n![bitcoin2](https://user-images.githubusercontent.com/7656623/129127166-54a2a463-db61-4f05-a111-d4a8aa3a000c.png)\r\n![bitcoin3](https://user-images.githubusercontent.com/7656623/129127183-c573c324-e977-4f35-8e7f-23b0ec5d3f35.png)\r\n\r\nThank you and expect a fix.\r\n",
      "created_at" : "2021-08-12T02:04:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/22670#issuecomment-897289348",
      "id" : 897289348,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22670",
      "node_id" : "IC_kwDOABII5841e4yE",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-12T02:09:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/897289348",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7656623?v=4",
         "events_url" : "https://api.github.com/users/fujicoin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fujicoin/followers",
         "following_url" : "https://api.github.com/users/fujicoin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fujicoin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fujicoin",
         "id" : 7656623,
         "login" : "fujicoin",
         "node_id" : "MDQ6VXNlcjc2NTY2MjM=",
         "organizations_url" : "https://api.github.com/users/fujicoin/orgs",
         "received_events_url" : "https://api.github.com/users/fujicoin/received_events",
         "repos_url" : "https://api.github.com/users/fujicoin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fujicoin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fujicoin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fujicoin"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Fix in #22686",
      "created_at" : "2021-08-12T02:16:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/22670#issuecomment-897294555",
      "id" : 897294555,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22670",
      "node_id" : "IC_kwDOABII5841e6Db",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-12T02:16:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/897294555",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@achow101 \r\nI created a binary with guix build to reflect the content of your PR.\r\nAs a result of remittance of 3000FJC with two bech32 changes on the wallet, it was confirmed that the remittance can be done without any problem.\r\nWhen I decoded and confirmed the transaction, the input did not contain any change. I think this is the result of a change in the behavior of the coin selection.\r\nI would like to continue testing as soon as the funds are collected.\r\nThank you for your prompt response.",
      "created_at" : "2021-08-12T04:01:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/22670#issuecomment-897330485",
      "id" : 897330485,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22670",
      "node_id" : "IC_kwDOABII5841fC01",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-12T04:01:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/897330485",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7656623?v=4",
         "events_url" : "https://api.github.com/users/fujicoin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fujicoin/followers",
         "following_url" : "https://api.github.com/users/fujicoin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fujicoin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fujicoin",
         "id" : 7656623,
         "login" : "fujicoin",
         "node_id" : "MDQ6VXNlcjc2NTY2MjM=",
         "organizations_url" : "https://api.github.com/users/fujicoin/orgs",
         "received_events_url" : "https://api.github.com/users/fujicoin/received_events",
         "repos_url" : "https://api.github.com/users/fujicoin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fujicoin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fujicoin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fujicoin"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I repeated testing large transactions with a modified binary. Transactions with change in input are also normal. The coin selection feels good.\r\nI will close this case because I think the problem has been resolved.",
      "created_at" : "2021-08-12T20:25:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/22670#issuecomment-897944510",
      "id" : 897944510,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22670",
      "node_id" : "IC_kwDOABII5841hYu-",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-12T20:25:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/897944510",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7656623?v=4",
         "events_url" : "https://api.github.com/users/fujicoin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fujicoin/followers",
         "following_url" : "https://api.github.com/users/fujicoin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fujicoin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fujicoin",
         "id" : 7656623,
         "login" : "fujicoin",
         "node_id" : "MDQ6VXNlcjc2NTY2MjM=",
         "organizations_url" : "https://api.github.com/users/fujicoin/orgs",
         "received_events_url" : "https://api.github.com/users/fujicoin/received_events",
         "repos_url" : "https://api.github.com/users/fujicoin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fujicoin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fujicoin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fujicoin"
      }
   }
]
