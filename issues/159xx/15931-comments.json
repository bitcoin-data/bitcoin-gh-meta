[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#17369](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/17369.html) (Refactor: Move encryption code between KeyMan and Wallet by achow101)\n* [#17261](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/17261.html) (Make ScriptPubKeyMan an actual interface and the wallet to have multiple by achow101)\n* [#17060](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/17060.html) (Cache 26% more coins: Reduce CCoinsMap::value_type from 96 to 76 bytes by martinus)\n* [#16944](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16944.html) (gui: create PSBT with watch-only wallet by Sjors)\n* [#16910](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16910.html) (wallet: reduce loading time by using unordered maps by achow101)\n* [#16895](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16895.html) (External signer multisig support by Sjors)\n* [#16688](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16688.html) (log: Add validation interface logging by jkczyz)\n* [#16549](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16549.html) ([WIP] UI external signer support (e.g. hardware wallet) by Sjors)\n* [#16546](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16546.html) ([WIP] External signer support - Wallet Box edition by Sjors)\n* [#16528](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16528.html) ([WIP] Native Descriptor Wallets (take 2) by achow101)\n* [#9381](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/9381.html) (Remove CWalletTx merging logic from AddToWallet by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-05-01T18:27:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-488368727",
      "id" : 488368727,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4ODM2ODcyNw==",
      "updated_at" : "2019-11-07T23:18:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/488368727",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-05-01T19:47:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-488393965",
      "id" : 488393965,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4ODM5Mzk2NQ==",
      "updated_at" : "2019-05-01T19:47:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/488393965",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-05-07T16:03:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-490143435",
      "id" : 490143435,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5MDE0MzQzNQ==",
      "updated_at" : "2019-05-07T16:03:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/490143435",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-05-14T13:00:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-492227305",
      "id" : 492227305,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5MjIyNzMwNQ==",
      "updated_at" : "2019-05-14T13:00:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/492227305",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Added to the \"Chasing Concept ACK\" board. @ryanofsky maybe you could give an initial Concept/Approach ACK/NACK ?",
      "created_at" : "2019-06-19T01:30:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-503370626",
      "id" : 503370626,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwMzM3MDYyNg==",
      "updated_at" : "2019-06-19T01:30:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/503370626",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes would be awesome to get a Concept ACK on the approach followed but if it's not the best one, I'm eager to rework the PR in depth! Going to rebase/fix tests failure soon",
      "created_at" : "2019-06-19T03:15:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-503389407",
      "id" : 503389407,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwMzM4OTQwNw==",
      "updated_at" : "2019-06-19T04:35:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/503389407",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r295421954"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/295421954"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Add m_last_block_processed_height field in CWallet\" (0284c72ab07362150fd26c86966ea7c7bc6cfed5)\r\n\r\nWould be good to initialize this to -1 here for safety (and also for documentation, to be clear that this can be -1).\r\n\r\nWould also be good to add GUARDED_BY(cs_wallet) annotation.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-06-19T17:38:25Z",
      "diff_hunk" : "@@ -815,6 +815,11 @@ class CWallet final : public CCryptoKeyStore, private interfaces::Chain::Notific\n      */\n     uint256 m_last_block_processed GUARDED_BY(cs_wallet);\n \n+    /* Height of last block processed is used by wallet to know depth of transactions\n+     * without relying on Chain interface beyond asynchronous updates.\n+     */\n+    int m_last_block_processed_height;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r295421954",
      "id" : 295421954,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5NTQyMTk1NA==",
      "original_commit_id" : "0284c72ab07362150fd26c86966ea7c7bc6cfed5",
      "original_position" : 7,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 251859358,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/295421954",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r295430761"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/295430761"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Use CWallet::m_last_block_processed_height in GetDepthInMainChain\" (233ae92f2d51333f158810d85d13cf63a1144e6b)\r\n\r\nCan we use -1 instead of 0 for this to be consistent with nIndex? Also would be good to note  here that when a transaction is conflicted, `hashBlock` and `block_height` refer to the earliest block with a conflicting transaction instead of the block containing the transaction.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-06-19T17:59:05Z",
      "diff_hunk" : "@@ -351,6 +351,11 @@ class CMerkleTx\n      */\n     int nIndex;\n \n+    /* Refers to height of block against which tx is merkle branch linked to\n+     * An block_height == 0 means that tx isn't yet linked to any block",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r295430761",
      "id" : 295430761,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5NTQzMDc2MQ==",
      "original_commit_id" : "8a1975586d3cc7f98961581859fd146a632bbd34",
      "original_position" : 5,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 251859358,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/295430761",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r295434058"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/295434058"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Use CWallet::m_last_block_processed_height in GetDepthInMainChain\" (233ae92f2d51333f158810d85d13cf63a1144e6b)\r\n\r\nIsn't this going to break existing serialization of transactions in the wallet? I think it'd be best not to change the serialized representation and just make this a memory-only field that gets filled when the wallet is loaded.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-06-19T18:06:42Z",
      "diff_hunk" : "@@ -383,9 +389,10 @@ class CMerkleTx\n         READWRITE(hashBlock);\n         READWRITE(vMerkleBranch);\n         READWRITE(nIndex);\n+        READWRITE(m_block_height);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r295434058",
      "id" : 295434058,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5NTQzNDA1OA==",
      "original_commit_id" : "8a1975586d3cc7f98961581859fd146a632bbd34",
      "original_position" : 24,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 251859358,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/295434058",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r295463739"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/295463739"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Add m_block_height field in CMerkleTx\" (8a1975586d3cc7f98961581859fd146a632bbd34)\r\n\r\nThis logic is getting hard to follow with three repetitive if(hashBlock...) blocks. Now that this is unconditionally updating hashBlock, I think the new logic is equivalent to the following and can be simplified:\r\n\r\n```c++\r\nassert(!wtxIn.isAbandoned()); // Incoming transactions should never have special abandoned block hash\r\nif (wtxIn.hashBlock != wtx.hashBlock) {\r\n    wtx.hashBlock = wtxIn.hashBlock;\r\n    wtx.m_block_height = wtxIn.m_block_height;\r\n    fUpdated = true;\r\n}\r\n```",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-06-19T18:53:20Z",
      "diff_hunk" : "@@ -965,12 +965,19 @@ bool CWallet::AddToWallet(const CWalletTx& wtxIn, bool fFlushOnClose)\n         if (!wtxIn.hashUnset() && wtxIn.hashBlock != wtx.hashBlock)\n         {\n             wtx.hashBlock = wtxIn.hashBlock;\n+            wtx.m_block_height = wtxIn.m_block_height;\n+            fUpdated = true;\n+        }\n+        if (wtxIn.hashBlock.IsNull() && !wtx.hashBlock.IsNull()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r295463739",
      "id" : 295463739,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5NTQ2MzczOQ==",
      "original_commit_id" : "8a1975586d3cc7f98961581859fd146a632bbd34",
      "original_position" : 7,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 251859358,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/295463739",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r295476638"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/295476638"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Add m_block_height field in CMerkleTx\" (8a1975586d3cc7f98961581859fd146a632bbd34)\r\n\r\nIt looks like a remaining place where m_block_height is still unset is in [`importprunedfunds`](https://github.com/bitcoin/bitcoin/blob/8a1975586d3cc7f98961581859fd146a632bbd34/src/wallet/rpcdump.cpp#L425-L426). It would probably be good to change that code to call `wtx.SetMerkleBranch` instead of setting members directly.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-06-19T19:06:25Z",
      "diff_hunk" : "@@ -4424,13 +4437,16 @@ CWalletKey::CWalletKey(int64_t nExpires)\n     nTimeExpires = nExpires;\n }\n \n-void CMerkleTx::SetMerkleBranch(const uint256& block_hash, int posInBlock)\n+void CMerkleTx::SetMerkleBranch(const uint256& block_hash, int posInBlock, int block_height)\n {\n     // Update the tx's hashBlock\n     hashBlock = block_hash;\n \n     // set the position of the transaction in the block\n     nIndex = posInBlock;\n+\n+    // set tx height\n+    m_block_height = block_height;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r295476638",
      "id" : 295476638,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5NTQ3NjYzOA==",
      "original_commit_id" : "8a1975586d3cc7f98961581859fd146a632bbd34",
      "original_position" : 151,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 251859358,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/295476638",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r295482350"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/295482350"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Add m_block_height field in CMerkleTx\" (8a1975586d3cc7f98961581859fd146a632bbd34)\r\n\r\nThere's no particular reason for keeping this height value, is there? I think it'd be cleaner to always represent abandoned transactions with block hash=ABANDON_HASH, block height=-1, index=-1 than to awkwardly make block hash and block height point different places.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-06-19T19:17:00Z",
      "diff_hunk" : "@@ -1152,6 +1161,8 @@ bool CWallet::AbandonTransaction(interfaces::Chain::Lock& locked_chain, const ui\n             // If the orig tx was not in block/mempool, none of its spends can be in mempool\n             assert(!wtx.InMempool());\n             wtx.nIndex = -1;\n+            // Conflicting height is inherited from ancestor tx",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r295482350",
      "id" : 295482350,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5NTQ4MjM1MA==",
      "original_commit_id" : "8a1975586d3cc7f98961581859fd146a632bbd34",
      "original_position" : 62,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 251859358,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/295482350",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r295486339"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/295486339"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Add m_block_height field in CMerkleTx\" (8a1975586d3cc7f98961581859fd146a632bbd34)\r\n\r\nThis comment seems out of date since position information is saved regardless. Would just drop it.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-06-19T19:28:03Z",
      "diff_hunk" : "@@ -1090,8 +1097,10 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransactionRef& ptx, const uint256\n             CWalletTx wtx(this, ptx);\n \n             // Get merkle branch if transaction was found in a block",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r295486339",
      "id" : 295486339,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5NTQ4NjMzOQ==",
      "original_commit_id" : "8a1975586d3cc7f98961581859fd146a632bbd34",
      "original_position" : 48,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 251859358,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/295486339",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r295487658"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/295487658"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Add m_block_height field in CMerkleTx\" (8a1975586d3cc7f98961581859fd146a632bbd34)\r\n\r\nI don't think this additional text belongs here since it is really commenting on the code calling this function, and not explaining what is happening right here. Would just drop this comment.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-06-19T19:31:41Z",
      "diff_hunk" : "@@ -1090,8 +1097,10 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransactionRef& ptx, const uint256\n             CWalletTx wtx(this, ptx);\n \n             // Get merkle branch if transaction was found in a block\n-            if (!block_hash.IsNull())\n-                wtx.SetMerkleBranch(block_hash, posInBlock);\n+            // Set block_hash to Null, posInBlock to 0, block_height to 0",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r295487658",
      "id" : 295487658,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5NTQ4NzY1OA==",
      "original_commit_id" : "8a1975586d3cc7f98961581859fd146a632bbd34",
      "original_position" : 51,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 251859358,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/295487658",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r295493094"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/295493094"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Add m_block_height field in CMerkleTx\" (8a1975586d3cc7f98961581859fd146a632bbd34)\r\n\r\nNot really related to this PR, but I'm surprised this code is treating `vtxConflicted` transactions as if they are in the mempool and not marking them as conflicted with `nIndex` set to -1, and block hash and height pointing to the conflicting block. Maybe add a TODO here that we could explicitly mark these transactions as being conflicted (have GetDepthInMainChain return negative values instead of 0).",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-06-19T19:46:28Z",
      "diff_hunk" : "@@ -1267,11 +1280,11 @@ void CWallet::BlockConnected(const CBlock& block, const std::vector<CTransaction\n \n     m_last_block_processed_height += 1;\n     for (const CTransactionRef& ptx : vtxConflicted) {\n-        SyncTransaction(ptx, {} /* block hash */, 0 /* position in block */);\n+        SyncTransaction(ptx, {} /* block hash */, 0 /* block height */, 0 /* position in block */);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r295493094",
      "id" : 295493094,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5NTQ5MzA5NA==",
      "original_commit_id" : "8a1975586d3cc7f98961581859fd146a632bbd34",
      "original_position" : 110,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 251859358,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/295493094",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r295495763"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/295495763"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Restrain waitForNotificationsIfNewBlocksConnected  check to strict tip to avoid race condition\" (6b7962a650def5629eb2f897b6ace79a684c0cf0)\r\n\r\nThis commit seems to be doing two unrelated things: dropping the BlockUntilSyncedToCurrentChain call here and also changing the BlockUntilSyncedToCurrentChain implementation. Would suggest splitting this into two separate commits if possible.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-06-19T19:53:19Z",
      "diff_hunk" : "@@ -94,10 +94,7 @@ static std::set<CWallet*> g_unloading_wallet_set;\n // Custom deleter for shared_ptr<CWallet>.\n static void ReleaseWallet(CWallet* wallet)\n {\n-    // Unregister and delete the wallet right after BlockUntilSyncedToCurrentChain\n-    // so that it's in sync with the current chainstate.\n     wallet->WalletLogPrintf(\"Releasing wallet\\n\");\n-    wallet->BlockUntilSyncedToCurrentChain();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r295495763",
      "id" : 295495763,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5NTQ5NTc2Mw==",
      "original_commit_id" : "6b7962a650def5629eb2f897b6ace79a684c0cf0",
      "original_position" : 7,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 251859358,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/295495763",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r295496246"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/295496246"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Restrain waitForNotificationsIfNewBlocksConnected  check to strict tip to avoid race condition\" (6b7962a650def5629eb2f897b6ace79a684c0cf0)\r\n\r\nWould suggest renaming `waitForNotificationsIfNewBlocksConnected` to `waitForNotificationsIfTipChanged` to accurately describe the new behavior.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-06-19T19:54:26Z",
      "diff_hunk" : "@@ -241,8 +241,7 @@ class Chain\n     virtual std::unique_ptr<Handler> handleNotifications(Notifications& notifications) = 0;\n \n     //! Wait for pending notifications to be processed unless block hash points to the current\n-    //! chain tip, or to a possible descendant of the current chain tip that isn't currently\n-    //! connected.\n+    //! chain tip.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r295496246",
      "id" : 295496246,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5NTQ5NjI0Ng==",
      "original_commit_id" : "6b7962a650def5629eb2f897b6ace79a684c0cf0",
      "original_position" : 6,
      "path" : "src/interfaces/chain.h",
      "position" : 29,
      "pull_request_review_id" : 251859358,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/295496246",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r295501695"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/295501695"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Use CWallet::m_last_block_processed_height in GetDepthInMainChain\" (233ae92f2d51333f158810d85d13cf63a1144e6b)\r\n\r\nCan we `assert(m_block_height > 0)` after this point? I'm afraid of another bug like the `importprunedfunds` one mentioned earlier leaving m_block_height unset and this function returning bogus values.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-06-19T20:08:34Z",
      "diff_hunk" : "@@ -4448,10 +4448,18 @@ void CMerkleTx::SetMerkleBranch(const uint256& block_hash, int posInBlock, int b\n \n int CMerkleTx::GetDepthInMainChain(interfaces::Chain::Lock& locked_chain) const\n {\n+    if (pwallet == nullptr)\n+        return 0;\n+\n     if (hashUnset())\n         return 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r295501695",
      "id" : 295501695,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5NTUwMTY5NQ==",
      "original_commit_id" : "233ae92f2d51333f158810d85d13cf63a1144e6b",
      "original_position" : 8,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 251859358,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/295501695",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r295505197"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/295505197"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Use CWallet::m_last_block_processed_height in GetDepthInMainChain\" (233ae92f2d51333f158810d85d13cf63a1144e6b)\r\n\r\nThis looks right but is the logic is kind of obscure. Maybe you could add an explanatory comment like \"If nIndex is -1 and the block hash is set, it means the transaction is conflicted, and that m_block_height will be set to the height of the earliest conflicting block, so can return 0 is that block has been disconnected.\"\r\n\r\nI think it'd also be good to replace nested `if(A) { if (B) return; }` with `if (A && B) { return; } `",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-06-19T20:17:54Z",
      "diff_hunk" : "@@ -4448,10 +4448,18 @@ void CMerkleTx::SetMerkleBranch(const uint256& block_hash, int posInBlock, int b\n \n int CMerkleTx::GetDepthInMainChain(interfaces::Chain::Lock& locked_chain) const\n {\n+    if (pwallet == nullptr)\n+        return 0;\n+\n     if (hashUnset())\n         return 0;\n \n-    return locked_chain.getBlockDepth(hashBlock) * (nIndex == -1 ? -1 : 1);\n+    if (nIndex == -1) {\n+        // Tx is no more conflicted but it's not more confirmed, so return 0",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r295505197",
      "id" : 295505197,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5NTUwNTE5Nw==",
      "original_commit_id" : "233ae92f2d51333f158810d85d13cf63a1144e6b",
      "original_position" : 12,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 251859358,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/295505197",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r295508382"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/295508382"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Add m_last_block_processed_height field in CWallet\" (0284c72ab07362150fd26c86966ea7c7bc6cfed5)\r\n\r\nCan this `assert(m_last_block_processed_height >= 0)`? This would catch usage errors if there are calls to this function before the wallet is initialized.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-06-19T20:25:30Z",
      "diff_hunk" : "@@ -1308,6 +1313,10 @@ class CWallet final : public CCryptoKeyStore, private interfaces::Chain::Notific\n \n     /** Implement lookup of key origin information through wallet key metadata. */\n     bool GetKeyOrigin(const CKeyID& keyid, KeyOriginInfo& info) const override;\n+\n+    int GetLastBlockHeight() const { return m_last_block_processed_height; };",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r295508382",
      "id" : 295508382,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5NTUwODM4Mg==",
      "original_commit_id" : "0284c72ab07362150fd26c86966ea7c7bc6cfed5",
      "original_position" : 17,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 251859358,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/295508382",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r301367213"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/301367213"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hmmm filled at startup using ```getBlockHeight```, given we already have ```hashBlock``` ? Do you envision the wallet to always query chain state to succeed its startup ?",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-07-09T01:52:58Z",
      "diff_hunk" : "@@ -383,9 +389,10 @@ class CMerkleTx\n         READWRITE(hashBlock);\n         READWRITE(vMerkleBranch);\n         READWRITE(nIndex);\n+        READWRITE(m_block_height);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r301367213",
      "id" : 301367213,
      "in_reply_to_id" : 295434058,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMTM2NzIxMw==",
      "original_commit_id" : "8a1975586d3cc7f98961581859fd146a632bbd34",
      "original_position" : 24,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 259235521,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/301367213",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r301367411"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/301367411"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated ```AddToWallet```, hope it's clearer ",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-07-09T01:54:08Z",
      "diff_hunk" : "@@ -965,12 +965,19 @@ bool CWallet::AddToWallet(const CWalletTx& wtxIn, bool fFlushOnClose)\n         if (!wtxIn.hashUnset() && wtxIn.hashBlock != wtx.hashBlock)\n         {\n             wtx.hashBlock = wtxIn.hashBlock;\n+            wtx.m_block_height = wtxIn.m_block_height;\n+            fUpdated = true;\n+        }\n+        if (wtxIn.hashBlock.IsNull() && !wtx.hashBlock.IsNull()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r301367411",
      "id" : 301367411,
      "in_reply_to_id" : 295463739,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMTM2NzQxMQ==",
      "original_commit_id" : "8a1975586d3cc7f98961581859fd146a632bbd34",
      "original_position" : 7,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 259235764,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/301367411",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r301368195"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/301368195"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Oooops, I forgot this one. I've added a call to ```SetMerkleBranch``` in ```importprunedfunds``` but had to change its argument to hask for transaction height too. Seems to me similar to the serialization issue, do we want wallet to ask chain the state of its stored transactions every time, even it should be able to infer it from the blocks already connected ?",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-07-09T01:58:59Z",
      "diff_hunk" : "@@ -4424,13 +4437,16 @@ CWalletKey::CWalletKey(int64_t nExpires)\n     nTimeExpires = nExpires;\n }\n \n-void CMerkleTx::SetMerkleBranch(const uint256& block_hash, int posInBlock)\n+void CMerkleTx::SetMerkleBranch(const uint256& block_hash, int posInBlock, int block_height)\n {\n     // Update the tx's hashBlock\n     hashBlock = block_hash;\n \n     // set the position of the transaction in the block\n     nIndex = posInBlock;\n+\n+    // set tx height\n+    m_block_height = block_height;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r301368195",
      "id" : 301368195,
      "in_reply_to_id" : 295476638,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMTM2ODE5NQ==",
      "original_commit_id" : "8a1975586d3cc7f98961581859fd146a632bbd34",
      "original_position" : 151,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 259236717,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/301368195",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r301368385"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/301368385"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Should be dropped on 1458ded",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-07-09T02:00:16Z",
      "diff_hunk" : "@@ -1090,8 +1097,10 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransactionRef& ptx, const uint256\n             CWalletTx wtx(this, ptx);\n \n             // Get merkle branch if transaction was found in a block",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r301368385",
      "id" : 301368385,
      "in_reply_to_id" : 295486339,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMTM2ODM4NQ==",
      "original_commit_id" : "8a1975586d3cc7f98961581859fd146a632bbd34",
      "original_position" : 48,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 259236975,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/301368385",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r301368491"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/301368491"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Should be dropped on 1458ded\r\n",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-07-09T02:00:51Z",
      "diff_hunk" : "@@ -1090,8 +1097,10 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransactionRef& ptx, const uint256\n             CWalletTx wtx(this, ptx);\n \n             // Get merkle branch if transaction was found in a block\n-            if (!block_hash.IsNull())\n-                wtx.SetMerkleBranch(block_hash, posInBlock);\n+            // Set block_hash to Null, posInBlock to 0, block_height to 0",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r301368491",
      "id" : 301368491,
      "in_reply_to_id" : 295487658,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMTM2ODQ5MQ==",
      "original_commit_id" : "8a1975586d3cc7f98961581859fd146a632bbd34",
      "original_position" : 51,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 259237088,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/301368491",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r301369291"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/301369291"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done, see 9c07c16",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-07-09T02:06:23Z",
      "diff_hunk" : "@@ -241,8 +241,7 @@ class Chain\n     virtual std::unique_ptr<Handler> handleNotifications(Notifications& notifications) = 0;\n \n     //! Wait for pending notifications to be processed unless block hash points to the current\n-    //! chain tip, or to a possible descendant of the current chain tip that isn't currently\n-    //! connected.\n+    //! chain tip.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r301369291",
      "id" : 301369291,
      "in_reply_to_id" : 295496246,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMTM2OTI5MQ==",
      "original_commit_id" : "6b7962a650def5629eb2f897b6ace79a684c0cf0",
      "original_position" : 6,
      "path" : "src/interfaces/chain.h",
      "position" : 29,
      "pull_request_review_id" : 259238012,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/301369291",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r301370162"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/301370162"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Splitted between 8a16c67 and 9c07c16",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-07-09T02:11:34Z",
      "diff_hunk" : "@@ -94,10 +94,7 @@ static std::set<CWallet*> g_unloading_wallet_set;\n // Custom deleter for shared_ptr<CWallet>.\n static void ReleaseWallet(CWallet* wallet)\n {\n-    // Unregister and delete the wallet right after BlockUntilSyncedToCurrentChain\n-    // so that it's in sync with the current chainstate.\n     wallet->WalletLogPrintf(\"Releasing wallet\\n\");\n-    wallet->BlockUntilSyncedToCurrentChain();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r301370162",
      "id" : 301370162,
      "in_reply_to_id" : 295495763,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMTM3MDE2Mg==",
      "original_commit_id" : "6b7962a650def5629eb2f897b6ace79a684c0cf0",
      "original_position" : 7,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 259238952,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/301370162",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r301370461"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/301370461"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Commented and updated logic as suggested on 573ca36",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-07-09T02:12:49Z",
      "diff_hunk" : "@@ -4448,10 +4448,18 @@ void CMerkleTx::SetMerkleBranch(const uint256& block_hash, int posInBlock, int b\n \n int CMerkleTx::GetDepthInMainChain(interfaces::Chain::Lock& locked_chain) const\n {\n+    if (pwallet == nullptr)\n+        return 0;\n+\n     if (hashUnset())\n         return 0;\n \n-    return locked_chain.getBlockDepth(hashBlock) * (nIndex == -1 ? -1 : 1);\n+    if (nIndex == -1) {\n+        // Tx is no more conflicted but it's not more confirmed, so return 0",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r301370461",
      "id" : 301370461,
      "in_reply_to_id" : 295505197,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMTM3MDQ2MQ==",
      "original_commit_id" : "233ae92f2d51333f158810d85d13cf63a1144e6b",
      "original_position" : 12,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 259239177,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/301370461",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r301370602"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/301370602"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Check should be there in b1ae297",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-07-09T02:13:42Z",
      "diff_hunk" : "@@ -1308,6 +1313,10 @@ class CWallet final : public CCryptoKeyStore, private interfaces::Chain::Notific\n \n     /** Implement lookup of key origin information through wallet key metadata. */\n     bool GetKeyOrigin(const CKeyID& keyid, KeyOriginInfo& info) const override;\n+\n+    int GetLastBlockHeight() const { return m_last_block_processed_height; };",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r301370602",
      "id" : 301370602,
      "in_reply_to_id" : 295508382,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMTM3MDYwMg==",
      "original_commit_id" : "0284c72ab07362150fd26c86966ea7c7bc6cfed5",
      "original_position" : 17,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 259239323,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/301370602",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r301370949"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/301370949"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hmmm, I introduced  ```assert(m_block_height >= -1)``` as we may GetDepthInMainChain on fresh transactions, their ```hashBlock``` being unset, their depth should appear as zero.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-07-09T02:15:58Z",
      "diff_hunk" : "@@ -4448,10 +4448,18 @@ void CMerkleTx::SetMerkleBranch(const uint256& block_hash, int posInBlock, int b\n \n int CMerkleTx::GetDepthInMainChain(interfaces::Chain::Lock& locked_chain) const\n {\n+    if (pwallet == nullptr)\n+        return 0;\n+\n     if (hashUnset())\n         return 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r301370949",
      "id" : 301370949,
      "in_reply_to_id" : 295501695,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMTM3MDk0OQ==",
      "original_commit_id" : "233ae92f2d51333f158810d85d13cf63a1144e6b",
      "original_position" : 8,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 259239738,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/301370949",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r301371748"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/301371748"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Okay, I did a second round with the following model in head  (state, triplet<hashBlock, nIndex, block_height>) : NEW<{}, -1, -1>, UNCONFIRMED<{}, 0, 0>, CONFIRMED<block_hash, posInBlock, block_height>, ABANDON<ABANDON_HASH, -1, -1>, CONFLICTED<hashBlock, -1, conflicting_height>.\r\nDo you have one similar, should we noted it somewhere ?",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-07-09T02:20:32Z",
      "diff_hunk" : "@@ -1152,6 +1161,8 @@ bool CWallet::AbandonTransaction(interfaces::Chain::Lock& locked_chain, const ui\n             // If the orig tx was not in block/mempool, none of its spends can be in mempool\n             assert(!wtx.InMempool());\n             wtx.nIndex = -1;\n+            // Conflicting height is inherited from ancestor tx",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r301371748",
      "id" : 301371748,
      "in_reply_to_id" : 295482350,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMTM3MTc0OA==",
      "original_commit_id" : "8a1975586d3cc7f98961581859fd146a632bbd34",
      "original_position" : 62,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 259240595,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/301371748",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r301372154"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/301372154"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ok, updated on 6289909, maybe I should refine it in its own commit?",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-07-09T02:23:12Z",
      "diff_hunk" : "@@ -1267,11 +1280,11 @@ void CWallet::BlockConnected(const CBlock& block, const std::vector<CTransaction\n \n     m_last_block_processed_height += 1;\n     for (const CTransactionRef& ptx : vtxConflicted) {\n-        SyncTransaction(ptx, {} /* block hash */, 0 /* position in block */);\n+        SyncTransaction(ptx, {} /* block hash */, 0 /* block height */, 0 /* position in block */);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r301372154",
      "id" : 301372154,
      "in_reply_to_id" : 295493094,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMTM3MjE1NA==",
      "original_commit_id" : "8a1975586d3cc7f98961581859fd146a632bbd34",
      "original_position" : 110,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 259241075,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/301372154",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Answered back to @ryanofsky comments on 1458ded, I'm on cleaning last Travis failures",
      "created_at" : "2019-07-09T02:24:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-509461542",
      "id" : 509461542,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwOTQ2MTU0Mg==",
      "updated_at" : "2019-07-09T02:24:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/509461542",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r303713964"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/303713964"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Note : I've seen one Travis failure on feature_reindex.py due to the assert. I wasn't able to reproduce it on my local dev env, I think it's caused by Travis really slow setup, but that's not great, what's your take on it ?",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-07-16T03:18:25Z",
      "diff_hunk" : "@@ -1308,6 +1313,10 @@ class CWallet final : public CCryptoKeyStore, private interfaces::Chain::Notific\n \n     /** Implement lookup of key origin information through wallet key metadata. */\n     bool GetKeyOrigin(const CKeyID& keyid, KeyOriginInfo& info) const override;\n+\n+    int GetLastBlockHeight() const { return m_last_block_processed_height; };",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r303713964",
      "id" : 303713964,
      "in_reply_to_id" : 295508382,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMzcxMzk2NA==",
      "original_commit_id" : "0284c72ab07362150fd26c86966ea7c7bc6cfed5",
      "original_position" : 17,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 262170043,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/303713964",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r306404822"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306404822"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This line is introduced in a too-early commit (_Add m_last_block_processed_height field in CWallet_) where the member variable _m_block_height_ doesn't yet exist. The _Add m_last_block_processed_height field in CWallet_ commit doesn't build because the variable is not declared.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-07-23T16:05:21Z",
      "diff_hunk" : "@@ -4608,36 +4606,48 @@ CWalletKey::CWalletKey(int64_t nExpires)\n     nTimeExpires = nExpires;\n }\n \n-void CMerkleTx::SetMerkleBranch(const uint256& block_hash, int posInBlock)\n+void CMerkleTx::SetMerkleBranch(const uint256& block_hash, int posInBlock, int block_height)\n {\n     // Update the tx's hashBlock\n     hashBlock = block_hash;\n \n     // set the position of the transaction in the block\n     nIndex = posInBlock;\n+\n+    // set tx height\n+    m_block_height = block_height;\n }\n \n-int CMerkleTx::GetDepthInMainChain(interfaces::Chain::Lock& locked_chain) const\n+int CMerkleTx::GetDepthInMainChain() const\n {\n+    if (pwallet == nullptr)\n+        return 0;\n+    assert(m_block_height >= -1);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r306404822",
      "id" : 306404822,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNjQwNDgyMg==",
      "original_commit_id" : "8d84bd560865fdf83fc86a05114cbed38789ca7e",
      "original_position" : 430,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 265517375,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306404822",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r306413990"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306413990"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is this required? the txoutproof includes a block header, which could be used to look up the height in the chain.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-07-23T16:24:46Z",
      "diff_hunk" : "@@ -375,6 +375,7 @@ UniValue importprunedfunds(const JSONRPCRequest& request)\n                 {\n                     {\"rawtransaction\", RPCArg::Type::STR_HEX, RPCArg::Optional::NO, \"A raw transaction in hex funding an already-existing address in wallet\"},\n                     {\"txoutproof\", RPCArg::Type::STR_HEX, RPCArg::Optional::NO, \"The hex output from gettxoutproof that contains the transaction\"},\n+                    {\"height\", RPCArg::Type::NUM, RPCArg::Optional::NO, \"The height in which transaction has been confirmed\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r306413990",
      "id" : 306413990,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNjQxMzk5MA==",
      "original_commit_id" : "8d84bd560865fdf83fc86a05114cbed38789ca7e",
      "original_position" : 4,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 265517375,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306413990",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r306420045"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306420045"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No need to move this function declaration.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-07-23T16:38:09Z",
      "diff_hunk" : "@@ -864,6 +873,9 @@ class CWallet final : public FillableSigningProvider, private interfaces::Chain:\n     /** Internal database handle. */\n     std::unique_ptr<WalletDatabase> database;\n \n+    //! Fetches a key from the keypool\n+    bool GetKeyFromPool(CPubKey& key, bool internal = false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r306420045",
      "id" : 306420045,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNjQyMDA0NQ==",
      "original_commit_id" : "8d84bd560865fdf83fc86a05114cbed38789ca7e",
      "original_position" : 166,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 265535761,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306420045",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r306441436"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306441436"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can these three lines be replaced by a call to `wtx.SetMerkleBranch()`?",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-07-23T17:28:34Z",
      "diff_hunk" : "@@ -251,16 +256,17 @@ BOOST_FIXTURE_TEST_CASE(coin_mark_dirty_immature_credit, TestChain100Setup)\n \n     wtx.hashBlock = ::ChainActive().Tip()->GetBlockHash();\n     wtx.nIndex = 0;\n+    wtx.m_block_height = ::ChainActive().Height();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r306441436",
      "id" : 306441436,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNjQ0MTQzNg==",
      "original_commit_id" : "8d84bd560865fdf83fc86a05114cbed38789ca7e",
      "original_position" : 44,
      "path" : "src/wallet/test/wallet_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 265535761,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306441436",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r306448468"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306448468"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In _Move CWallet ptr from CWalletTx to CMerkleTx_: is there any point in keeping the `CMerkleTx`/`CWalletTx` division after this? `CMerkleTx` is _only_ used as a base class for _CWalletTx_. It's been around since the first git commit, and I expect Satoshi thought `CMerkleTx` could be useful outside the wallet, but now that it's adding a pointer to the CWallet, it seems redundant to have it as a separate class.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-07-23T17:44:28Z",
      "diff_hunk" : "@@ -372,6 +372,9 @@ class CMerkleTx\n   /** Constant used in hashBlock to indicate tx has been abandoned */\n     static const uint256 ABANDON_HASH;\n \n+protected:\n+    const CWallet* pwallet;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r306448468",
      "id" : 306448468,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNjQ0ODQ2OA==",
      "original_commit_id" : "8d84bd560865fdf83fc86a05114cbed38789ca7e",
      "original_position" : 5,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 265535761,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306448468",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r306459728"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306459728"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The comment says `An block_height == 0` in commit _Add m_block_height field in CMerkleTx_ and then changes to `A block_height == -1` in _Use CWallet::m_last_block_processed_height in GetDepthInMainChain_.\r\n\r\nIt would be better to not change this in the course of the PR and just set it to `A block_height == -1` in the first PR.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-07-23T18:09:53Z",
      "diff_hunk" : "@@ -351,6 +351,11 @@ class CMerkleTx\n      */\n     int nIndex;\n \n+    /* Refers to height of block against which tx is merkle branch linked to\n+     * An block_height == 0 means that tx isn't yet linked to any block",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r306459728",
      "id" : 306459728,
      "in_reply_to_id" : 295430761,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNjQ1OTcyOA==",
      "original_commit_id" : "8a1975586d3cc7f98961581859fd146a632bbd34",
      "original_position" : 5,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 265535761,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306459728",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r306466421"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306466421"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This height accounting in the wallet scares me slightly. I think that prior to this change, the wallet tolerates any bug in the node that sends duplicate `BlockConnected()` or `BlockDisconnected()` calls over the CValidationInterface. After this change, a duplicate `BlockConnected` notification could cause the wallet to get into a very bad inconsistent state.\r\n\r\nIs it possible to update the CValidationInterface to also pass the block height when sending BlockConnected/BlockDisconnected notifications?",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-07-23T18:24:52Z",
      "diff_hunk" : "@@ -1422,12 +1414,13 @@ void CWallet::BlockConnected(const CBlock& block, const std::vector<CTransaction\n     // to abandon a transaction and then have it inadvertently cleared by\n     // the notification that the conflicted transaction was evicted.\n \n+    m_last_block_processed_height += 1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r306466421",
      "id" : 306466421,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNjQ2NjQyMQ==",
      "original_commit_id" : "8d84bd560865fdf83fc86a05114cbed38789ca7e",
      "original_position" : 186,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 265594064,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306466421",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've done a quick code review. The main thing that I'd like to see changed is merging the `CMerkleTx` and `CWalletTx` classes now that `CMerkleTx` is accessing wallet data (see discussion here: http://www.erisian.com.au/bitcoin-core-dev/log-2019-07-23.html#l-322)",
      "created_at" : "2019-07-23T18:26:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-514327967",
      "id" : 514327967,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNDMyNzk2Nw==",
      "updated_at" : "2019-07-23T18:26:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/514327967",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "(excellent work, by the way. Great to see some of these locked_chain instances being cleaned up)",
      "created_at" : "2019-07-23T18:28:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-514328665",
      "id" : 514328665,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNDMyODY2NQ==",
      "updated_at" : "2019-07-23T18:28:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/514328665",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r306958014"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306958014"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ooops, bad rebase sorry, should be corrected",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-07-24T18:28:54Z",
      "diff_hunk" : "@@ -4608,36 +4606,48 @@ CWalletKey::CWalletKey(int64_t nExpires)\n     nTimeExpires = nExpires;\n }\n \n-void CMerkleTx::SetMerkleBranch(const uint256& block_hash, int posInBlock)\n+void CMerkleTx::SetMerkleBranch(const uint256& block_hash, int posInBlock, int block_height)\n {\n     // Update the tx's hashBlock\n     hashBlock = block_hash;\n \n     // set the position of the transaction in the block\n     nIndex = posInBlock;\n+\n+    // set tx height\n+    m_block_height = block_height;\n }\n \n-int CMerkleTx::GetDepthInMainChain(interfaces::Chain::Lock& locked_chain) const\n+int CMerkleTx::GetDepthInMainChain() const\n {\n+    if (pwallet == nullptr)\n+        return 0;\n+    assert(m_block_height >= -1);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r306958014",
      "id" : 306958014,
      "in_reply_to_id" : 306404822,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNjk1ODAxNA==",
      "original_commit_id" : "8d84bd560865fdf83fc86a05114cbed38789ca7e",
      "original_position" : 430,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 266205506,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306958014",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r306961660"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306961660"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hmmm well we could use `getBlockHeight` again in this function but I didn't want because was planning to remove this Chain method after we move ScanForWalletTransactions and its logic on the node side.\r\n\r\nMaybe that a bit premature, but IMO this RPC should come with all proofs + height without us having to query the chain..",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-07-24T18:36:57Z",
      "diff_hunk" : "@@ -375,6 +375,7 @@ UniValue importprunedfunds(const JSONRPCRequest& request)\n                 {\n                     {\"rawtransaction\", RPCArg::Type::STR_HEX, RPCArg::Optional::NO, \"A raw transaction in hex funding an already-existing address in wallet\"},\n                     {\"txoutproof\", RPCArg::Type::STR_HEX, RPCArg::Optional::NO, \"The hex output from gettxoutproof that contains the transaction\"},\n+                    {\"height\", RPCArg::Type::NUM, RPCArg::Optional::NO, \"The height in which transaction has been confirmed\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r306961660",
      "id" : 306961660,
      "in_reply_to_id" : 306413990,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNjk2MTY2MA==",
      "original_commit_id" : "8d84bd560865fdf83fc86a05114cbed38789ca7e",
      "original_position" : 4,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 266210260,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306961660",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r306967081"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306967081"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "See #16451, thanks for going forwad on it :)",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-07-24T18:48:59Z",
      "diff_hunk" : "@@ -372,6 +372,9 @@ class CMerkleTx\n   /** Constant used in hashBlock to indicate tx has been abandoned */\n     static const uint256 ABANDON_HASH;\n \n+protected:\n+    const CWallet* pwallet;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r306967081",
      "id" : 306967081,
      "in_reply_to_id" : 306448468,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNjk2NzA4MQ==",
      "original_commit_id" : "8d84bd560865fdf83fc86a05114cbed38789ca7e",
      "original_position" : 5,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 266217071,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306967081",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r306995955"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306995955"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "You're right, it's far better to rely on message content than counting the message in itself.\r\nTo do, I've extended BlockDisconnected, for BlockConnected we have CBlockIndex it was just masked between Notification and CWallet",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-07-24T20:01:34Z",
      "diff_hunk" : "@@ -1422,12 +1414,13 @@ void CWallet::BlockConnected(const CBlock& block, const std::vector<CTransaction\n     // to abandon a transaction and then have it inadvertently cleared by\n     // the notification that the conflicted transaction was evicted.\n \n+    m_last_block_processed_height += 1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r306995955",
      "id" : 306995955,
      "in_reply_to_id" : 306466421,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNjk5NTk1NQ==",
      "original_commit_id" : "8d84bd560865fdf83fc86a05114cbed38789ca7e",
      "original_position" : 186,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 266253623,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306995955",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Addressed @jnewbery comments on a53586c, except https://github.com/bitcoin/bitcoin/pull/15931#discussion_r306961660 where I'm still thinking on it",
      "created_at" : "2019-07-24T20:03:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-514779211",
      "id" : 514779211,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNDc3OTIxMQ==",
      "updated_at" : "2019-07-24T20:03:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/514779211",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r307006966"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/307006966"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't like this change for a couple of reasons:\r\n\r\n- it's a breaking change for clients, so they'll need to reimplement their code\r\n- the RPC doesn't do any checking on the `height` value passed, so it's possible to get the wallet into some inconsistent state by passing a bad `height` value.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-07-24T20:30:23Z",
      "diff_hunk" : "@@ -375,6 +375,7 @@ UniValue importprunedfunds(const JSONRPCRequest& request)\n                 {\n                     {\"rawtransaction\", RPCArg::Type::STR_HEX, RPCArg::Optional::NO, \"A raw transaction in hex funding an already-existing address in wallet\"},\n                     {\"txoutproof\", RPCArg::Type::STR_HEX, RPCArg::Optional::NO, \"The hex output from gettxoutproof that contains the transaction\"},\n+                    {\"height\", RPCArg::Type::NUM, RPCArg::Optional::NO, \"The height in which transaction has been confirmed\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r307006966",
      "id" : 307006966,
      "in_reply_to_id" : 306413990,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNzAwNjk2Ng==",
      "original_commit_id" : "8d84bd560865fdf83fc86a05114cbed38789ca7e",
      "original_position" : 4,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 266268054,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/307006966",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-07-30T05:12:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-516264490",
      "id" : 516264490,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNjI2NDQ5MA==",
      "updated_at" : "2019-07-30T05:12:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/516264490",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "https://github.com/bitcoin/bitcoin/pull/16451 is merged. You should be able to rebase this and remove one of the commits.",
      "created_at" : "2019-07-31T12:07:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-516820571",
      "id" : 516820571,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNjgyMDU3MQ==",
      "updated_at" : "2019-07-31T12:07:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/516820571",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased without CMerkleTx relative commit",
      "created_at" : "2019-08-06T05:19:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-518504999",
      "id" : 518504999,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxODUwNDk5OQ==",
      "updated_at" : "2019-08-06T05:20:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/518504999",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r311123565"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/311123565"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm not sure if this macro does anything?",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-08-06T15:19:15Z",
      "diff_hunk" : "@@ -831,7 +836,14 @@ class CWallet final : public FillableSigningProvider, private interfaces::Chain:\n     uint256 m_last_block_processed GUARDED_BY(cs_wallet);\n \n     //! Fetches a key from the keypool\n-    bool GetKeyFromPool(CPubKey &key, bool internal = false);\n+    bool GetKeyFromPool(CPubKey& key, bool internal = false);\n+\n+    /* Height of last block processed is used by wallet to know depth of transactions\n+     * without relying on Chain interface beyond asynchronous updates. For safety, we\n+     * initialize it to -1.\n+     */\n+    int m_last_block_processed_height{-1};\n+    GUARDED_BY(cs_wallet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r311123565",
      "id" : 311123565,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMTEyMzU2NQ==",
      "original_commit_id" : "8fa26b2a6864c3347293d62bf29a0c46f54c716a",
      "original_position" : 129,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 271423875,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/311123565",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r311123704"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/311123704"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Please don't fixup style from surrounding code. It makes the diff less clean.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-08-06T15:19:32Z",
      "diff_hunk" : "@@ -831,7 +836,14 @@ class CWallet final : public FillableSigningProvider, private interfaces::Chain:\n     uint256 m_last_block_processed GUARDED_BY(cs_wallet);\n \n     //! Fetches a key from the keypool\n-    bool GetKeyFromPool(CPubKey &key, bool internal = false);\n+    bool GetKeyFromPool(CPubKey& key, bool internal = false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r311123704",
      "id" : 311123704,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMTEyMzcwNA==",
      "original_commit_id" : "8fa26b2a6864c3347293d62bf29a0c46f54c716a",
      "original_position" : 122,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 271423875,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/311123704",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I suggest you reverse the order of the first two commits:\r\n\r\n1. have one commit that _only_ updates the signature of `BlockDiscconected` in the validation interface.\r\n2. the second commit adds `m_last_block_processed_height` and uses the `pindex` in `BlockConnected`/`BlockDisconnected` to set the height.\r\n\r\nHaving one way for setting `m_last_block_processed_height` in the first commit which is replaced by a different way in the second commit makes this confusing for reviewers.",
      "created_at" : "2019-08-06T15:29:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-518720861",
      "id" : 518720861,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxODcyMDg2MQ==",
      "updated_at" : "2019-08-06T15:29:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/518720861",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK on reducing reliance on `locked_chain`. It seems worth adding `m_block_height`.  \r\n\r\nI might be more clear to swap the first two (?) commits, thereby introducing `m_last_block_processed_height` without the `+= 1` stuff.\r\n\r\nGetting a bunch of warnings on macOS along these lines:\r\n\r\n```\r\nIn file included from wallet/ismine.cpp:12:\r\n./wallet/wallet.h:846:5: warning: declaration does not declare anything [-Wmissing-declarations]\r\n    GUARDED_BY(cs_wallet);\r\n    ^\r\n./threadsafety.h:18:23: note: expanded from macro 'GUARDED_BY'\r\n#define GUARDED_BY(x) __attribute__((guarded_by(x)))\r\n                      ^\r\nIn file included from wallet/ismine.cpp:12:\r\n./wallet/wallet.h:846:5: warning: attribute guarded_by ignored, because it is not attached to a declaration [-Wignored-attributes]\r\n./threadsafety.h:18:48: note: expanded from macro 'GUARDED_BY'\r\n#define GUARDED_BY(x) __attribute__((guarded_by(x)))\r\n                                               ^\r\n2 warnings generated.\r\n```\r\n\r\nI'm worried that serializing `m_block_height` in `CWalletTx` makes wallets non backwards compatible, but I can't produce a problem (shameless plug for #12134).",
      "created_at" : "2019-08-06T15:39:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-518725058",
      "id" : 518725058,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxODcyNTA1OA==",
      "updated_at" : "2019-08-06T15:39:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/518725058",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r311369642"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/311369642"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks, I misused some linter scripts I think\r\n\r\n(in fact syntax _variable_ {-1} GUARDED_BY(lock) failed on some compilers compare to _variable_ GUARDED_BY(lock) =  -1) ",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-08-07T05:04:47Z",
      "diff_hunk" : "@@ -831,7 +836,14 @@ class CWallet final : public FillableSigningProvider, private interfaces::Chain:\n     uint256 m_last_block_processed GUARDED_BY(cs_wallet);\n \n     //! Fetches a key from the keypool\n-    bool GetKeyFromPool(CPubKey &key, bool internal = false);\n+    bool GetKeyFromPool(CPubKey& key, bool internal = false);\n+\n+    /* Height of last block processed is used by wallet to know depth of transactions\n+     * without relying on Chain interface beyond asynchronous updates. For safety, we\n+     * initialize it to -1.\n+     */\n+    int m_last_block_processed_height{-1};\n+    GUARDED_BY(cs_wallet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r311369642",
      "id" : 311369642,
      "in_reply_to_id" : 311123565,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMTM2OTY0Mg==",
      "original_commit_id" : "8fa26b2a6864c3347293d62bf29a0c46f54c716a",
      "original_position" : 129,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 271730323,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/311369642",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for review @Sjors, \r\n\r\nI inverted the 2 top commits at 71a053c to ease review.\r\n\r\nAbout `m_block_height` in `CWalletTx`, caching in block height in-memory let us with 2 options at serialization : \r\n* serialize in-memory member too, deserialize it at wallet loading\r\n* query `getBlockHeight` by passing `hashBlock`at `LoadToWallet` called by `ReadKeyValue`\r\n\r\nI tried also to implement 2nd option, but seems to me really inefficient due to the necessity to add another `cs_main` lock in `LoadWallet` for the length of deserialization to preserve locks order.\r\n\r\nIt may need release notes but I think it's move us towards less interdependence between wallet and chain. What's your thoughts ?",
      "created_at" : "2019-08-07T05:56:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-518951928",
      "id" : 518951928,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxODk1MTkyOA==",
      "updated_at" : "2019-08-07T06:12:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/518951928",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r311408799"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/311408799"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It's fine to use CBlockIndex pointers in CValidationInterface methods, but Chain::Notification methods should just pass `int height` parameters. Using CBlockIndex here exposes node internals to the wallet and  makes #10102 less efficient because CBlockIndex data would have to be serialized and sent across a socket.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-08-07T07:39:32Z",
      "diff_hunk" : "@@ -224,8 +221,8 @@ class Chain\n         virtual ~Notifications() {}\n         virtual void TransactionAddedToMempool(const CTransactionRef& tx) {}\n         virtual void TransactionRemovedFromMempool(const CTransactionRef& ptx) {}\n-        virtual void BlockConnected(const CBlock& block, const std::vector<CTransactionRef>& tx_conflicted) {}\n-        virtual void BlockDisconnected(const CBlock& block) {}\n+        virtual void BlockConnected(const CBlock& block, const std::vector<CTransactionRef>& tx_conflicted, const CBlockIndex* index) {}\n+        virtual void BlockDisconnected(const CBlock& block, const CBlockIndex* index) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r311408799",
      "id" : 311408799,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMTQwODc5OQ==",
      "original_commit_id" : "71a053ca85c64a0e9aeb18b1a6875104c9c5efc5",
      "original_position" : 26,
      "path" : "src/interfaces/chain.h",
      "position" : null,
      "pull_request_review_id" : 271779183,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/311408799",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Changing wallet serialization makes this PR more complicated to understand and test, and is something that can complicate wallet design going forward by increasing the number of data formats we have to think about staying compatible with.\r\n\r\nNote that `mapValue` can be used to change `WalletTx` serialization in a backwards-compatible way. It's a key-value store that anything can be written to/read from. Take a look at the `ReadOrderPos()`/`WriteOrderPos()` for an example of a parameter being written/read from the `mapValue` store.\r\n\r\n@ryanofsky - how can we be sure that if we add a `getBlockHeight()` call for every tx in the wallet, we won't introduce a performance regression for very large wallets?",
      "created_at" : "2019-08-07T12:55:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-519083686",
      "id" : 519083686,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxOTA4MzY4Ng==",
      "updated_at" : "2019-08-07T12:55:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/519083686",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> @ryanofsky - how can we be sure that if we add a getBlockHeight() call for every tx in the wallet, we won't introduce a performance regression for very large wallets?\r\n\r\nI don't think we can be sure without measuring. I would say if there is a performance regression, I think it would be better to handle in a followup PR that's only changing the serialization and avoiding getBlockHeight() calls, and not changing serialization along with the other things that already have to change here.\r\n\r\nThe reason I'm skeptical there would be a performance regression is that we're talking about adding a single map lookup in a loop which is already doing multiple allocations, map insertions, disk reads, and deserialization, and with the whole loop preceding a rescan. I wouldn't be shocked to see a difference, but I would be surprised to see a difference, and wouldn't want to make the wallet format more complicated and inconsistent, just for the possibility that a difference might exist.\r\n\r\n> Note that mapValue can be used to change WalletTx serialization in a backwards-compatible way. \r\n\r\nChanging the serialization in a backward compatible way would probably be good, but would create some risk for the future (especially without #12134) that we write new code that assumes data is present and seems to work on new wallets, but then turns out not to work on old wallets.",
      "created_at" : "2019-08-07T13:34:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-519099417",
      "id" : 519099417,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxOTA5OTQxNw==",
      "updated_at" : "2019-08-07T13:34:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/519099417",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "To be sure, if there is reason to think changing serialization will soup up the wallet, please don't let me stand in the way. My reaction isn't \"please don't do this\", just \"why wouldn't you want to mess with this if you didn't have to?\"",
      "created_at" : "2019-08-07T14:00:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-519110546",
      "id" : 519110546,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxOTExMDU0Ng==",
      "updated_at" : "2019-08-07T14:00:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/519110546",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Loading large wallets after initialization will need to lock cs_main to deserialize their txn, which maybe a performance regression. Removing chain lock in the wallet would make it better but still be a hit.\r\n\r\nBut agree, this PR is already big enough, I will change for 2nd option, and let's talk about safe serialization in another one, if needed and after more thoughts.",
      "created_at" : "2019-08-07T14:23:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-519120238",
      "id" : 519120238,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxOTEyMDIzOA==",
      "updated_at" : "2019-08-07T14:24:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/519120238",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@ryanofsky in fact I just realized we may have to take 1st option, `bitcoin-wallet` binary load a wallet and can't get its chain interface..\r\n\r\nDo you see a 3rd option beyond the 2 I've mentioned ?",
      "created_at" : "2019-08-07T18:43:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-519221758",
      "id" : 519221758,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxOTIyMTc1OA==",
      "updated_at" : "2019-08-07T18:43:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/519221758",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> @ryanofsky in fact I just realized we may have to take 1st option, `bitcoin-wallet` binary load a wallet and can't get its chain interface..\r\n> \r\n> Do you see a 3rd option beyond the 2 I've mentioned ?\r\n\r\nJust skip this if interfaces::Chain* pointer is null. Bitcoin-wallet won't do anything that requires knowing the block height of transactions in the wallet.",
      "created_at" : "2019-08-07T19:26:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-519236266",
      "id" : 519236266,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxOTIzNjI2Ng==",
      "updated_at" : "2019-08-07T19:26:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/519236266",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Just skip this if interfaces::Chain* pointer is null.\r\n\r\nThat makes sense, though maybe make that more explicit?",
      "created_at" : "2019-08-08T09:03:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-519434221",
      "id" : 519434221,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxOTQzNDIyMQ==",
      "updated_at" : "2019-08-08T09:03:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/519434221",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, I've beefed up comments on this, tell me it's enough (see in `CWallet::Verify` and `CWallet::LoadWallet`)\r\n\r\nThe query-chain-to-know-height approach makes compatibility not an issue, and doesn't block us to go forward with tx height serialization later . A caveat, right now, it has to lock chain for the whole deserialization period to preserve lock order. This inefficiency should go away when we remove chain locks in wallet (hopefully soon).\r\n\r\nPlease notify a diff in `AddToWallet` since last review, where we now also check block height of incoming transaction against its old version. Reason is when we load wallet while reindexing, `getBlockHeight` is not going to find block, so even if tx block hash doesn't change, we need to correct its height when we get block notification (`BlockConnected`) after reindex is done.\r\n\r\nAlso, I didn't pollute wallet db code path by passing the chain lock, as this one may be null in case of wallet tool and lock can be taken recursively without issue. Instead, we check again in `LoadToWallet` with the added method `hasChain` to know if we can query chain state safely.",
      "created_at" : "2019-08-08T17:05:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-519605528",
      "id" : 519605528,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxOTYwNTUyOA==",
      "updated_at" : "2019-08-08T17:05:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/519605528",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Hmm annotated `GetDepthInMainChain` with a `NO_THREAD_SAFETY_ANALYSIS` right now to avoid member access into incomplete type (same as `GetConflicts` and `GetAvailableCredit`). If anyone has an idea how to resolve them smoothly, I will  take it.",
      "created_at" : "2019-08-08T17:38:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-519617268",
      "id" : 519617268,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxOTYxNzI2OA==",
      "updated_at" : "2019-08-08T17:38:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/519617268",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've added a `GetDepthInMainChain()` call back into `SubmitMemoryPoolAndRelay()` in #16557. I think we probably want to get that log fix in first and rebase this PR on top of that (with the _Remove locked_chain from GetDepthInMainChain and its callers_ commit updated to remove _locked_chain_ from `SubmitMemoryPoolAndRelay()`)",
      "created_at" : "2019-08-09T15:18:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-519958907",
      "id" : 519958907,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxOTk1ODkwNw==",
      "updated_at" : "2019-08-09T15:18:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/519958907",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r312547306"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312547306"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: place this new data member immediately next to `m_last_block_processed`. The comment for both need to emphasize that this block hash/height is for the **node's** tip and doesn't indicate that the wallet has scanned up to this hash/height.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-08-09T16:02:44Z",
      "diff_hunk" : "@@ -833,6 +845,12 @@ class CWallet final : public FillableSigningProvider, private interfaces::Chain:\n     //! Fetches a key from the keypool\n     bool GetKeyFromPool(CPubKey &key, bool internal = false);\n \n+    /* Height of last block processed is used by wallet to know depth of transactions\n+     * without relying on Chain interface beyond asynchronous updates. For safety, we\n+     * initialize it to -1.\n+     */\n+    int m_last_block_processed_height GUARDED_BY(cs_wallet) = -1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r312547306",
      "id" : 312547306,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMjU0NzMwNg==",
      "original_commit_id" : "0233a55a71b9ade7e65d26ef6ce718a761e4389b",
      "original_position" : 113,
      "path" : "src/wallet/wallet.h",
      "position" : 150,
      "pull_request_review_id" : 273228460,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312547306",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r312568142"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312568142"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think this new assert is right. A user might 'abandon' a transaction and it later be relayed or confirmed in a block.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-08-09T17:01:00Z",
      "diff_hunk" : "@@ -1118,16 +1115,12 @@ bool CWallet::AddToWallet(const CWalletTx& wtxIn, bool fFlushOnClose)\n     bool fUpdated = false;\n     if (!fInsertedNew)\n     {\n-        // Merge\n-        if (!wtxIn.hashUnset() && wtxIn.hashBlock != wtx.hashBlock)\n-        {\n-            wtx.hashBlock = wtxIn.hashBlock;\n-            fUpdated = true;\n-        }\n-        // If no longer abandoned, update\n-        if (wtxIn.hashBlock.IsNull() && wtx.isAbandoned())\n-        {\n+        assert(!wtxIn.isAbandoned()); // Incoming transactions should never have special abandoned block hash",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r312568142",
      "id" : 312568142,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMjU2ODE0Mg==",
      "original_commit_id" : "0233a55a71b9ade7e65d26ef6ce718a761e4389b",
      "original_position" : 42,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 273228460,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312568142",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r312570526"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312570526"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: add comment on why a chain might not be available. I think this is only the case in the wallettool.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-08-09T17:07:52Z",
      "diff_hunk" : "@@ -1180,9 +1173,14 @@ bool CWallet::AddToWallet(const CWalletTx& wtxIn, bool fFlushOnClose)\n     return true;\n }\n \n-void CWallet::LoadToWallet(const CWalletTx& wtxIn)\n+void CWallet::LoadToWallet(CWalletTx& wtxIn)\n {\n     uint256 hash = wtxIn.GetHash();\n+    Optional<int> block_height = MakeOptional(false, int());\n+    if (hasChain()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r312570526",
      "id" : 312570526,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMjU3MDUyNg==",
      "original_commit_id" : "0233a55a71b9ade7e65d26ef6ce718a761e4389b",
      "original_position" : 60,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 273228460,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312570526",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r312576506"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312576506"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don'd understand why you've removed this conditional (I think it's because you want to set the tx's block height to 0 (https://github.com/bitcoin/bitcoin/pull/15931#discussion_r301371748), but I don't understand why you want to do that).\r\n\r\nIn general, I think it'd be easier if `hashBlock`, `nIndex` and `m_block_height` were added to a struct along with an `tx_state` enum which could take `UNCONFIRMED`, `CONFIRMED`, `CONFLICTED` or `ABANDONED`. I think these magic values in `nIndex` are confusing and should only be dealt with by the serialization/deserialization code.\r\n\r\nEDIT: if you do add that struct, consider using it as an argument for `SyncTransaction()` and `AddToWalletIfInvolvingMe()`.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-08-09T17:24:17Z",
      "diff_hunk" : "@@ -1248,9 +1246,7 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransactionRef& ptx, const uint256\n \n             CWalletTx wtx(this, ptx);\n \n-            // Get merkle branch if transaction was found in a block\n-            if (!block_hash.IsNull())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r312576506",
      "id" : 312576506,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMjU3NjUwNg==",
      "original_commit_id" : "0233a55a71b9ade7e65d26ef6ce718a761e4389b",
      "original_position" : 97,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 273228460,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312576506",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r312611972"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312611972"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think an alternative would be to reset the `hashBlock`, `nIndex` and `m_block_height` for all transactions matching the block hash when a `BlockDisconnected` is received. That would involve iterating through all of the wallet txs to check their `hashBlock`s. Re-orgs are supposed to be pretty rare, so I think that's ok. Thoughts?",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-08-09T19:03:11Z",
      "diff_hunk" : "@@ -4628,36 +4651,49 @@ CKeyPool::CKeyPool(const CPubKey& vchPubKeyIn, bool internalIn)\n     m_pre_split = false;\n }\n \n-void CWalletTx::SetMerkleBranch(const uint256& block_hash, int posInBlock)\n+void CWalletTx::SetMerkleBranch(const uint256& block_hash, int posInBlock, int block_height)\n {\n     // Update the tx's hashBlock\n     hashBlock = block_hash;\n \n     // set the position of the transaction in the block\n     nIndex = posInBlock;\n+\n+    // set tx height\n+    m_block_height = block_height;\n }\n \n-int CWalletTx::GetDepthInMainChain(interfaces::Chain::Lock& locked_chain) const\n+int CWalletTx::GetDepthInMainChain() const\n {\n+    if (pwallet == nullptr)\n+        return 0;\n+    AssertLockHeld(pwallet->cs_wallet);\n+    assert(m_block_height >= -1);\n     if (hashUnset())\n         return 0;\n \n-    return locked_chain.getBlockDepth(hashBlock) * (nIndex == -1 ? -1 : 1);\n+    // If nIndex is -1 and the block hash is set, it means the transaction is conflicted, and that m_block_height",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r312611972",
      "id" : 312611972,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMjYxMTk3Mg==",
      "original_commit_id" : "0233a55a71b9ade7e65d26ef6ce718a761e4389b",
      "original_position" : 490,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 273228460,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312611972",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r312613808"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312613808"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't understand why this has to be removed. Can you add some more detail to the commit log?\r\n\r\n(I think the current commit log \"Scheduler thread servicing chain state is stopped before wallet unloading and can't be useful\" isn't right. `ReleaseWallet()` is the delete expression for the CWallet shared_ptr, and so is called for example when the wallet is unloaded during runtime.)",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-08-09T19:09:14Z",
      "diff_hunk" : "@@ -98,10 +98,7 @@ static std::set<CWallet*> g_unloading_wallet_set;\n // Custom deleter for shared_ptr<CWallet>.\n static void ReleaseWallet(CWallet* wallet)\n {\n-    // Unregister and delete the wallet right after BlockUntilSyncedToCurrentChain",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r312613808",
      "id" : 312613808,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMjYxMzgwOA==",
      "original_commit_id" : "0233a55a71b9ade7e65d26ef6ce718a761e4389b",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 273228460,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312613808",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r312622408"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312622408"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this is a change in behaviour. The was previously (current tip height) - (height of block with conflicting tx). This is now just (height of block with conflicting tx).",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-08-09T19:38:10Z",
      "diff_hunk" : "@@ -1332,12 +1329,12 @@ bool CWallet::AbandonTransaction(interfaces::Chain::Lock& locked_chain, const ui\n     return true;\n }\n \n-void CWallet::MarkConflicted(const uint256& hashBlock, const uint256& hashTx)\n+void CWallet::MarkConflicted(const uint256& hashBlock, int conflicting_height, const uint256& hashTx)\n {\n     auto locked_chain = chain().lock();\n     LOCK(cs_wallet);\n \n-    int conflictconfirms = -locked_chain->getBlockDepth(hashBlock);\n+    int conflictconfirms = -conflicting_height;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r312622408",
      "id" : 312622408,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMjYyMjQwOA==",
      "original_commit_id" : "0233a55a71b9ade7e65d26ef6ce718a761e4389b",
      "original_position" : 161,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 273228460,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312622408",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r313034668"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/313034668"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, had a comment about it, it doesn't imply that the wallet has seen all blocks since genesis up until `m_last_block_processed_height`",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-08-12T17:19:13Z",
      "diff_hunk" : "@@ -833,6 +845,12 @@ class CWallet final : public FillableSigningProvider, private interfaces::Chain:\n     //! Fetches a key from the keypool\n     bool GetKeyFromPool(CPubKey &key, bool internal = false);\n \n+    /* Height of last block processed is used by wallet to know depth of transactions\n+     * without relying on Chain interface beyond asynchronous updates. For safety, we\n+     * initialize it to -1.\n+     */\n+    int m_last_block_processed_height GUARDED_BY(cs_wallet) = -1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r313034668",
      "id" : 313034668,
      "in_reply_to_id" : 312547306,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMzAzNDY2OA==",
      "original_commit_id" : "0233a55a71b9ade7e65d26ef6ce718a761e4389b",
      "original_position" : 113,
      "path" : "src/wallet/wallet.h",
      "position" : 150,
      "pull_request_review_id" : 273833477,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/313034668",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r313052247"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/313052247"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "After reading again about how to use abandontransaction, I think you're right, tx might be not in a block or not in your mempool so you can flag is as abandoned. But after this, it can still being included as part of other peers mempools. Removed it, was suggested here initially https://github.com/bitcoin/bitcoin/pull/15931#discussion_r295463739",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-08-12T17:58:40Z",
      "diff_hunk" : "@@ -1118,16 +1115,12 @@ bool CWallet::AddToWallet(const CWalletTx& wtxIn, bool fFlushOnClose)\n     bool fUpdated = false;\n     if (!fInsertedNew)\n     {\n-        // Merge\n-        if (!wtxIn.hashUnset() && wtxIn.hashBlock != wtx.hashBlock)\n-        {\n-            wtx.hashBlock = wtxIn.hashBlock;\n-            fUpdated = true;\n-        }\n-        // If no longer abandoned, update\n-        if (wtxIn.hashBlock.IsNull() && wtx.isAbandoned())\n-        {\n+        assert(!wtxIn.isAbandoned()); // Incoming transactions should never have special abandoned block hash",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r313052247",
      "id" : 313052247,
      "in_reply_to_id" : 312568142,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMzA1MjI0Nw==",
      "original_commit_id" : "0233a55a71b9ade7e65d26ef6ce718a761e4389b",
      "original_position" : 42,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 273854789,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/313052247",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r313056664"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/313056664"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Okay, this point is already mentioned in commit message, `Verify` and `LoadWallet` but added also on this place.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-08-12T18:09:09Z",
      "diff_hunk" : "@@ -1180,9 +1173,14 @@ bool CWallet::AddToWallet(const CWalletTx& wtxIn, bool fFlushOnClose)\n     return true;\n }\n \n-void CWallet::LoadToWallet(const CWalletTx& wtxIn)\n+void CWallet::LoadToWallet(CWalletTx& wtxIn)\n {\n     uint256 hash = wtxIn.GetHash();\n+    Optional<int> block_height = MakeOptional(false, int());\n+    if (hasChain()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r313056664",
      "id" : 313056664,
      "in_reply_to_id" : 312570526,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMzA1NjY2NA==",
      "original_commit_id" : "0233a55a71b9ade7e65d26ef6ce718a761e4389b",
      "original_position" : 60,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 273860373,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/313056664",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r313066785"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/313066785"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for this one, in fact after thinking of it, that would be a bug if you have multiple conflicting txn, you would pick up the one with the highest height instead of the highest depth so not the most conflicting one..",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-08-12T18:31:37Z",
      "diff_hunk" : "@@ -1332,12 +1329,12 @@ bool CWallet::AbandonTransaction(interfaces::Chain::Lock& locked_chain, const ui\n     return true;\n }\n \n-void CWallet::MarkConflicted(const uint256& hashBlock, const uint256& hashTx)\n+void CWallet::MarkConflicted(const uint256& hashBlock, int conflicting_height, const uint256& hashTx)\n {\n     auto locked_chain = chain().lock();\n     LOCK(cs_wallet);\n \n-    int conflictconfirms = -locked_chain->getBlockDepth(hashBlock);\n+    int conflictconfirms = -conflicting_height;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r313066785",
      "id" : 313066785,
      "in_reply_to_id" : 312622408,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMzA2Njc4NQ==",
      "original_commit_id" : "0233a55a71b9ade7e65d26ef6ce718a761e4389b",
      "original_position" : 161,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 273872772,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/313066785",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r314509181"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314509181"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Gone this way, see https://github.com/bitcoin/bitcoin/pull/16624",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-08-15T21:36:29Z",
      "diff_hunk" : "@@ -1248,9 +1246,7 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransactionRef& ptx, const uint256\n \n             CWalletTx wtx(this, ptx);\n \n-            // Get merkle branch if transaction was found in a block\n-            if (!block_hash.IsNull())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r314509181",
      "id" : 314509181,
      "in_reply_to_id" : 312576506,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDUwOTE4MQ==",
      "original_commit_id" : "0233a55a71b9ade7e65d26ef6ce718a761e4389b",
      "original_position" : 97,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 275683243,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314509181",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r314510848"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314510848"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes I've thought about while working on the rescan logic. I've introduced a `Rewind` callback in the `Chain::Notifications`, it should call a wallet method to zeroed out cleanly tx `hashBlock`, `nIndex` and `m_block_height`. I've proposed to introduce in this future-PR, this one is already wide enough.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-08-15T21:41:53Z",
      "diff_hunk" : "@@ -4628,36 +4651,49 @@ CKeyPool::CKeyPool(const CPubKey& vchPubKeyIn, bool internalIn)\n     m_pre_split = false;\n }\n \n-void CWalletTx::SetMerkleBranch(const uint256& block_hash, int posInBlock)\n+void CWalletTx::SetMerkleBranch(const uint256& block_hash, int posInBlock, int block_height)\n {\n     // Update the tx's hashBlock\n     hashBlock = block_hash;\n \n     // set the position of the transaction in the block\n     nIndex = posInBlock;\n+\n+    // set tx height\n+    m_block_height = block_height;\n }\n \n-int CWalletTx::GetDepthInMainChain(interfaces::Chain::Lock& locked_chain) const\n+int CWalletTx::GetDepthInMainChain() const\n {\n+    if (pwallet == nullptr)\n+        return 0;\n+    AssertLockHeld(pwallet->cs_wallet);\n+    assert(m_block_height >= -1);\n     if (hashUnset())\n         return 0;\n \n-    return locked_chain.getBlockDepth(hashBlock) * (nIndex == -1 ? -1 : 1);\n+    // If nIndex is -1 and the block hash is set, it means the transaction is conflicted, and that m_block_height",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r314510848",
      "id" : 314510848,
      "in_reply_to_id" : 312611972,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDUxMDg0OA==",
      "original_commit_id" : "0233a55a71b9ade7e65d26ef6ce718a761e4389b",
      "original_position" : 490,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 275685267,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314510848",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r314516068"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314516068"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I've run tests again, can't remember but I had a test staling some point which was solved by this, I think I may have introduce a height error at some point which would false `waitForNotificationsIfTipChanged` and later corrected it without realizing it would fix this. Drop this commit.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-08-15T21:59:12Z",
      "diff_hunk" : "@@ -98,10 +98,7 @@ static std::set<CWallet*> g_unloading_wallet_set;\n // Custom deleter for shared_ptr<CWallet>.\n static void ReleaseWallet(CWallet* wallet)\n {\n-    // Unregister and delete the wallet right after BlockUntilSyncedToCurrentChain",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r314516068",
      "id" : 314516068,
      "in_reply_to_id" : 312613808,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDUxNjA2OA==",
      "original_commit_id" : "0233a55a71b9ade7e65d26ef6ce718a761e4389b",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 275691648,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314516068",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r314516784"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314516784"
         }
      },
      "author_association" : "MEMBER",
      "body" : "3a04cd6776f7f1ec86cad20de90c9fbb24655536\r\n\r\nnit, could drop `&` from 1st argument, it was discussed elsewhere that smart pointers and iterators should be used as value.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-08-15T22:01:48Z",
      "diff_hunk" : "@@ -114,7 +114,7 @@ class CValidationInterface {\n      *\n      * Called on a background thread.\n      */\n-    virtual void BlockDisconnected(const std::shared_ptr<const CBlock> &block) {}\n+    virtual void BlockDisconnected(const std::shared_ptr<const CBlock>& block, const CBlockIndex* pindex) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r314516784",
      "id" : 314516784,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDUxNjc4NA==",
      "original_commit_id" : "3a04cd6776f7f1ec86cad20de90c9fbb24655536",
      "original_position" : 5,
      "path" : "src/validationinterface.h",
      "position" : null,
      "pull_request_review_id" : 275692610,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314516784",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r314517774"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314517774"
         }
      },
      "author_association" : "MEMBER",
      "body" : "3d32a691d2df4c73a39a64a5d331c29b5eb94213\r\n\r\nIs this a bugfix?",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-08-15T22:05:32Z",
      "diff_hunk" : "@@ -1442,9 +1443,12 @@ void CWallet::BlockDisconnected(const CBlock& block, int height)\n     auto locked_chain = chain().lock();\n     LOCK(cs_wallet);\n \n+    m_last_block_processed_height = height - 1;\n     for (const CTransactionRef& ptx : block.vtx) {\n         SyncTransaction(ptx, {} /* block hash */, 0 /* position in block */);\n     }\n+\n+    m_last_block_processed = block.hashPrevBlock;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r314517774",
      "id" : 314517774,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDUxNzc3NA==",
      "original_commit_id" : "3d32a691d2df4c73a39a64a5d331c29b5eb94213",
      "original_position" : 17,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 275692610,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314517774",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r314521199"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314521199"
         }
      },
      "author_association" : "MEMBER",
      "body" : "3d32a691d2df4c73a39a64a5d331c29b5eb94213\r\n\r\nWhy isn't this named `SetLastBlockProcessedHeight`?\r\n\r\nAnyway I think the variable should be `m_chain_tip_height`. Also, I think now `m_last_block_processed` should be improved, like:\r\n```cpp\r\n    uint256 m_chain_tip_hash GUARDED_BY(cs_wallet);\r\n    int m_chain_tip_height GUARDED_BY(cs_wallet){-1};\r\n```\r\nand both should be set at once.\r\n",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-08-15T22:18:58Z",
      "diff_hunk" : "@@ -1356,6 +1363,19 @@ class CWallet final : public FillableSigningProvider, private interfaces::Chain:\n \n     /** Implement lookup of key origin information through wallet key metadata. */\n     bool GetKeyOrigin(const CKeyID& keyid, KeyOriginInfo& info) const override;\n+\n+    /** Get last block processed height */\n+    int GetLastBlockHeight() const EXCLUSIVE_LOCKS_REQUIRED(cs_wallet)\n+    {\n+        AssertLockHeld(cs_wallet);\n+        return m_last_block_processed_height;\n+    };\n+    /** Set last block processed height, currently only use in unit test */\n+    void SetLastBlockHeight(int block_height) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r314521199",
      "id" : 314521199,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDUyMTE5OQ==",
      "original_commit_id" : "b75a18f8a3f54049a7daf18e85adaec2da0801ad",
      "original_position" : 26,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 275692610,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314521199",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r315242405"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/315242405"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Agree for the name of method and set at once, but not sure for variables. I think it would be confusing, as intent of this PR is to let the wallet have its own view of what chain tip is after processing block from validation interface. So real chain tip and the wallet one may diverge.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-08-19T14:31:48Z",
      "diff_hunk" : "@@ -1356,6 +1363,19 @@ class CWallet final : public FillableSigningProvider, private interfaces::Chain:\n \n     /** Implement lookup of key origin information through wallet key metadata. */\n     bool GetKeyOrigin(const CKeyID& keyid, KeyOriginInfo& info) const override;\n+\n+    /** Get last block processed height */\n+    int GetLastBlockHeight() const EXCLUSIVE_LOCKS_REQUIRED(cs_wallet)\n+    {\n+        AssertLockHeld(cs_wallet);\n+        return m_last_block_processed_height;\n+    };\n+    /** Set last block processed height, currently only use in unit test */\n+    void SetLastBlockHeight(int block_height) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r315242405",
      "id" : 315242405,
      "in_reply_to_id" : 314521199,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNTI0MjQwNQ==",
      "original_commit_id" : "b75a18f8a3f54049a7daf18e85adaec2da0801ad",
      "original_position" : 26,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 276599944,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/315242405",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r315246890"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/315246890"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah these would be from the wallet POV.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-08-19T14:40:06Z",
      "diff_hunk" : "@@ -1356,6 +1363,19 @@ class CWallet final : public FillableSigningProvider, private interfaces::Chain:\n \n     /** Implement lookup of key origin information through wallet key metadata. */\n     bool GetKeyOrigin(const CKeyID& keyid, KeyOriginInfo& info) const override;\n+\n+    /** Get last block processed height */\n+    int GetLastBlockHeight() const EXCLUSIVE_LOCKS_REQUIRED(cs_wallet)\n+    {\n+        AssertLockHeld(cs_wallet);\n+        return m_last_block_processed_height;\n+    };\n+    /** Set last block processed height, currently only use in unit test */\n+    void SetLastBlockHeight(int block_height) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r315246890",
      "id" : 315246890,
      "in_reply_to_id" : 314521199,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNTI0Njg5MA==",
      "original_commit_id" : "b75a18f8a3f54049a7daf18e85adaec2da0801ad",
      "original_position" : 26,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 276605479,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/315246890",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r315250728"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/315250728"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes it was a bugfix compare to a53586c at least, it became obvious only after switching to query the chain based on block hash at wallet loading!",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-08-19T14:46:40Z",
      "diff_hunk" : "@@ -1442,9 +1443,12 @@ void CWallet::BlockDisconnected(const CBlock& block, int height)\n     auto locked_chain = chain().lock();\n     LOCK(cs_wallet);\n \n+    m_last_block_processed_height = height - 1;\n     for (const CTransactionRef& ptx : block.vtx) {\n         SyncTransaction(ptx, {} /* block hash */, 0 /* position in block */);\n     }\n+\n+    m_last_block_processed = block.hashPrevBlock;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r315250728",
      "id" : 315250728,
      "in_reply_to_id" : 314517774,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNTI1MDcyOA==",
      "original_commit_id" : "3d32a691d2df4c73a39a64a5d331c29b5eb94213",
      "original_position" : 17,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 276610164,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/315250728",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r315291853"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/315291853"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "If I'm reading @jnewbery's comment correctly, part of the documentation for `m_last_block_processed` and `m_last_block_processed_height` can be shared.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-08-19T16:06:36Z",
      "diff_hunk" : "@@ -833,6 +845,12 @@ class CWallet final : public FillableSigningProvider, private interfaces::Chain:\n     //! Fetches a key from the keypool\n     bool GetKeyFromPool(CPubKey &key, bool internal = false);\n \n+    /* Height of last block processed is used by wallet to know depth of transactions\n+     * without relying on Chain interface beyond asynchronous updates. For safety, we\n+     * initialize it to -1.\n+     */\n+    int m_last_block_processed_height GUARDED_BY(cs_wallet) = -1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r315291853",
      "id" : 315291853,
      "in_reply_to_id" : 312547306,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNTI5MTg1Mw==",
      "original_commit_id" : "0233a55a71b9ade7e65d26ef6ce718a761e4389b",
      "original_position" : 113,
      "path" : "src/wallet/wallet.h",
      "position" : 150,
      "pull_request_review_id" : 276662148,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/315291853",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r315294228"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/315294228"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Would it be possible to set `m_last_block_processed_height` when setting `m_last_block_processed` below? Or does the intermediary calls rely on the value of either?\r\n\r\nSimilarly for `CWallet::BlockDisconnected`.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-08-19T16:12:20Z",
      "diff_hunk" : "@@ -1425,6 +1425,7 @@ void CWallet::BlockConnected(const CBlock& block, const std::vector<CTransaction\n     // to abandon a transaction and then have it inadvertently cleared by\n     // the notification that the conflicted transaction was evicted.\n \n+    m_last_block_processed_height = height;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r315294228",
      "id" : 315294228,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNTI5NDIyOA==",
      "original_commit_id" : "b75a18f8a3f54049a7daf18e85adaec2da0801ad",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : 210,
      "pull_request_review_id" : 276662148,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/315294228",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r315340601"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/315340601"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nits:\r\n\r\n1. Consider rewording for succinctness and clarity: Height of block against which tx is linked via a merkle branch.\r\n2. End each sentence with a period as they tend to blend when reading the comment.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-08-19T18:05:17Z",
      "diff_hunk" : "@@ -488,6 +489,11 @@ class CWalletTx\n      */\n     int nIndex;\n \n+    /* Refers to height of block against which tx is merkle branch linked to",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r315340601",
      "id" : 315340601,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNTM0MDYwMQ==",
      "original_commit_id" : "a9b7592ce9765cb8fcaa5b98debfc6cc7284b72b",
      "original_position" : 14,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 276662148,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/315340601",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r315347964"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/315347964"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Instead of initializing an `Optional<int>` then conditionally assigning it based on the result of `hasChain()`, could you instead define something like `chainHeight()` to return an `Optional<int>`? This would hide the chain logic from `LoadToWallet()`.\r\n\r\nIf not, consider directly assigning `0` to `wtxIn.m_block_height` and conditionally updating it based on `hasChain()`. The addition of `Optional<int>` here just seems to add indirection for the reader.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-08-19T18:23:01Z",
      "diff_hunk" : "@@ -1180,9 +1173,14 @@ bool CWallet::AddToWallet(const CWalletTx& wtxIn, bool fFlushOnClose)\n     return true;\n }\n \n-void CWallet::LoadToWallet(const CWalletTx& wtxIn)\n+void CWallet::LoadToWallet(CWalletTx& wtxIn)\n {\n     uint256 hash = wtxIn.GetHash();\n+    Optional<int> block_height = MakeOptional(false, int());\n+    if (hasChain()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r315347964",
      "id" : 315347964,
      "in_reply_to_id" : 312570526,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNTM0Nzk2NA==",
      "original_commit_id" : "0233a55a71b9ade7e65d26ef6ce718a761e4389b",
      "original_position" : 60,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 276662148,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/315347964",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r315428979"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/315428979"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Please don't do this. Trying to 'fix' surrounding code in a PR makes the diff bigger and more confusing for reviewers.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-08-19T21:54:39Z",
      "diff_hunk" : "@@ -114,7 +114,7 @@ class CValidationInterface {\n      *\n      * Called on a background thread.\n      */\n-    virtual void BlockDisconnected(const std::shared_ptr<const CBlock> &block) {}\n+    virtual void BlockDisconnected(const std::shared_ptr<const CBlock>& block, const CBlockIndex* pindex) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r315428979",
      "id" : 315428979,
      "in_reply_to_id" : 314516784,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNTQyODk3OQ==",
      "original_commit_id" : "3a04cd6776f7f1ec86cad20de90c9fbb24655536",
      "original_position" : 5,
      "path" : "src/validationinterface.h",
      "position" : null,
      "pull_request_review_id" : 276836047,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/315428979",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r315736818"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/315736818"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't want to add new method in Chain interface, but yes 2nd suggested alternative avoid the `MakeOptional` which is good, updated\r\n            ",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-08-20T14:53:31Z",
      "diff_hunk" : "@@ -1180,9 +1173,14 @@ bool CWallet::AddToWallet(const CWalletTx& wtxIn, bool fFlushOnClose)\n     return true;\n }\n \n-void CWallet::LoadToWallet(const CWalletTx& wtxIn)\n+void CWallet::LoadToWallet(CWalletTx& wtxIn)\n {\n     uint256 hash = wtxIn.GetHash();\n+    Optional<int> block_height = MakeOptional(false, int());\n+    if (hasChain()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r315736818",
      "id" : 315736818,
      "in_reply_to_id" : 312570526,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNTczNjgxOA==",
      "original_commit_id" : "0233a55a71b9ade7e65d26ef6ce718a761e4389b",
      "original_position" : 60,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 277227170,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/315736818",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r315744374"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/315744374"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated comments",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-08-20T15:06:55Z",
      "diff_hunk" : "@@ -833,6 +845,12 @@ class CWallet final : public FillableSigningProvider, private interfaces::Chain:\n     //! Fetches a key from the keypool\n     bool GetKeyFromPool(CPubKey &key, bool internal = false);\n \n+    /* Height of last block processed is used by wallet to know depth of transactions\n+     * without relying on Chain interface beyond asynchronous updates. For safety, we\n+     * initialize it to -1.\n+     */\n+    int m_last_block_processed_height GUARDED_BY(cs_wallet) = -1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r315744374",
      "id" : 315744374,
      "in_reply_to_id" : 312547306,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNTc0NDM3NA==",
      "original_commit_id" : "0233a55a71b9ade7e65d26ef6ce718a761e4389b",
      "original_position" : 113,
      "path" : "src/wallet/wallet.h",
      "position" : 150,
      "pull_request_review_id" : 277237118,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/315744374",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r315747855"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/315747855"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes it has to be before, but IIRC not the m_last_block_processed assignment. Moved it near to m_last_block_processed_height.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-08-20T15:13:14Z",
      "diff_hunk" : "@@ -1425,6 +1425,7 @@ void CWallet::BlockConnected(const CBlock& block, const std::vector<CTransaction\n     // to abandon a transaction and then have it inadvertently cleared by\n     // the notification that the conflicted transaction was evicted.\n \n+    m_last_block_processed_height = height;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r315747855",
      "id" : 315747855,
      "in_reply_to_id" : 315294228,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNTc0Nzg1NQ==",
      "original_commit_id" : "b75a18f8a3f54049a7daf18e85adaec2da0801ad",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : 210,
      "pull_request_review_id" : 277241649,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/315747855",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated at f766fe4, including @promag and @jkczyz feedbacks.",
      "created_at" : "2019-08-20T15:23:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-523065514",
      "id" : 523065514,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMzA2NTUxNA==",
      "updated_at" : "2019-08-20T15:23:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/523065514",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased at 7427cbf, due to silent build failures not reported by merge conflict detection.",
      "created_at" : "2019-08-20T19:37:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-523163963",
      "id" : 523163963,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMzE2Mzk2Mw==",
      "updated_at" : "2019-08-20T19:37:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/523163963",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Tried to compile commit 7427cbf to prepare for the PR review club, and I'm getting an error when running `make`:\r\n\r\n```\r\n  CXX      qt/test/test_bitcoin_qt-wallettests.o\r\nqt/test/wallettests.cpp: In function âvoid {anonymous}::TestGUI()â:\r\nqt/test/wallettests.cpp:145:17: error: âusing element_type = class CWalletâ {aka âclass CWalletâ} has no member named âSetLastBlockProcessedHeightâ; did you mean âSetLastBlockProcessedâ?\r\n  145 |         wallet->SetLastBlockProcessedHeight(105, ::ChainActive().Tip()->GetBlockHash());\r\n      |                 ^~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n      |                 SetLastBlockProcessed\r\nmake[2]: *** [Makefile:11357: qt/test/test_bitcoin_qt-wallettests.o] Error 1\r\nmake[2]: *** [Makefile:11357: qt/test/test_bitcoin_qt-wallettests.o] Error 1\r\nmake[1]: *** [Makefile:13676: all-recursive] Error 1\r\nmake: *** [Makefile:774: all-recursive] Error 1\r\n```\r\n\r\nNot sure if I'm doing anything wrong. I am able to compile `master` without any errors.",
      "created_at" : "2019-08-21T14:03:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-523471522",
      "id" : 523471522,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMzQ3MTUyMg==",
      "updated_at" : "2019-08-21T14:04:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/523471522",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/109058?v=4",
         "events_url" : "https://api.github.com/users/dergigi/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergigi/followers",
         "following_url" : "https://api.github.com/users/dergigi/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergigi/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergigi",
         "id" : 109058,
         "login" : "dergigi",
         "node_id" : "MDQ6VXNlcjEwOTA1OA==",
         "organizations_url" : "https://api.github.com/users/dergigi/orgs",
         "received_events_url" : "https://api.github.com/users/dergigi/received_events",
         "repos_url" : "https://api.github.com/users/dergigi/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergigi/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergigi/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergigi"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@dergigi sorry for that, skipped qt test build when I replied promag comment yesterday, shouldn't have. Updated at 15100ee with fix",
      "created_at" : "2019-08-21T14:17:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-523477200",
      "id" : 523477200,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMzQ3NzIwMA==",
      "updated_at" : "2019-08-21T14:17:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/523477200",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-09-05T14:10:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-528382875",
      "id" : 528382875,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyODM4Mjg3NQ==",
      "updated_at" : "2019-09-05T14:10:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/528382875",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I was looking over this again and think it's a really nice change. It'd be good to rebase now that #16624 is merged. It would also help with #16426 which depends on this PR.",
      "created_at" : "2019-10-10T18:13:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-540707584",
      "id" : 540707584,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0MDcwNzU4NA==",
      "updated_at" : "2019-10-10T18:13:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/540707584",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for the push @ryanofsky, and sorry for the delay for following-up on this PR. Also added nits leftover from #16624 \r\n\r\nI spent a bit more time thinking how we handle conflicts and found that Confirmation status isn't correct for children of conflicted txn, if conflicting tx get removed we unconfirm well the parent conflicted tx but not its child. Test here : https://github.com/ariard/bitcoin/tree/2019-10-conflicted-txn,  will correct in a later PR to avoid delaying more this one.",
      "created_at" : "2019-10-14T06:08:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-541514108",
      "id" : 541514108,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0MTUxNDEwOA==",
      "updated_at" : "2019-10-14T06:08:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/541514108",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-10-15T19:50:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-542376379",
      "id" : 542376379,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0MjM3NjM3OQ==",
      "updated_at" : "2019-10-15T19:50:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/542376379",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r335645716"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/335645716"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Add block_height field in struct Confirmation\" (6593366d385e1c299a675af58ddd2138b3bd01e5)\r\n\r\nWhat's the reason for the `&& !block_height check`? Is it to handle the case where a transaction was reorged out while online and then reconfirmed while offline? It seems like like nIndex will still incorrectly be 0 in this case, though the block height and hash will remain set. Not sure the 0 matters or needs to be fixed by a later rescan.\r\n\r\nWould be good to add a comment about the `&& !block_height` condition or any case where incorrect information might be set now that needs to be fixed by rescan later.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-10-16T18:39:41Z",
      "diff_hunk" : "@@ -1168,13 +1170,17 @@ void CWallet::LoadToWallet(CWalletTx& wtxIn)\n {\n     // If wallet doesn't have a chain (e.g wallet-tool), lock can't be taken.\n     auto locked_chain = LockChain();\n-    // If tx hasn't been reorged out of chain while wallet being shutdown\n-    // change tx status to UNCONFIRMED and reset hashBlock/nIndex.\n-    if (!wtxIn.m_confirm.hashBlock.IsNull()) {\n-        if (locked_chain && !locked_chain->getBlockHeight(wtxIn.m_confirm.hashBlock)) {\n+    if (locked_chain) {\n+        Optional<int> block_height = locked_chain->getBlockHeight(wtxIn.m_confirm.hashBlock);\n+        // If tx hasn't been reorged out of chain while wallet being shutdown\n+        // change tx status to UNCONFIRMED and reset hashBlock/nIndex.\n+        if ((wtxIn.isConflicted() || wtxIn.isConfirmed()) && !block_height) {\n             wtxIn.setUnconfirmed();\n             wtxIn.m_confirm.hashBlock = uint256();\n+            wtxIn.m_confirm.block_height = 0;\n             wtxIn.m_confirm.nIndex = 0;\n+        } else {\n+            wtxIn.m_confirm.block_height = (block_height) ? *block_height : 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r335645716",
      "id" : 335645716,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzNTY0NTcxNg==",
      "original_commit_id" : "6593366d385e1c299a675af58ddd2138b3bd01e5",
      "original_position" : 31,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 302793545,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/335645716",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r335655545"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/335655545"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Add block_height field in struct Confirmation\" (6593366d385e1c299a675af58ddd2138b3bd01e5)\r\n\r\nNew method seems unused",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-10-16T19:01:42Z",
      "diff_hunk" : "@@ -976,6 +978,8 @@ class CWallet final : public FillableSigningProvider, private interfaces::Chain:\n     /** Interface for accessing chain state. */\n     interfaces::Chain& chain() const { assert(m_chain); return *m_chain; }\n \n+    /** Interface to assert chain access. */\n+    bool hasChain() const { return m_chain != nullptr; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r335655545",
      "id" : 335655545,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzNTY1NTU0NQ==",
      "original_commit_id" : "6593366d385e1c299a675af58ddd2138b3bd01e5",
      "original_position" : 77,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 302793545,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/335655545",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r335660016"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/335660016"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Restrain waitForNotificationsIfNewBlocksConnected check to strict tip\" (25f7a78b952f172457b75b7fa2dc889215e0703b)\r\n\r\nCan the commit message say what motivated this change or what it has to do with the other changes in the PR? It mentions changing RPCs to not indicate reorged transactions are confirmed, but this seems like preexisting behavior not related to the PR.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-10-16T19:12:43Z",
      "diff_hunk" : "@@ -348,13 +348,11 @@ class ChainImpl : public Chain\n     {\n         return MakeUnique<NotificationsHandlerImpl>(*this, notifications);\n     }\n-    void waitForNotificationsIfNewBlocksConnected(const uint256& old_tip) override\n+    void waitForNotificationsIfTipChanged(const uint256& old_tip) override\n     {\n         if (!old_tip.IsNull()) {\n             LOCK(::cs_main);\n             if (old_tip == ::ChainActive().Tip()->GetBlockHash()) return;\n-            CBlockIndex* block = LookupBlockIndex(old_tip);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r335660016",
      "id" : 335660016,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzNTY2MDAxNg==",
      "original_commit_id" : "25f7a78b952f172457b75b7fa2dc889215e0703b",
      "original_position" : 10,
      "path" : "src/interfaces/chain.cpp",
      "position" : 38,
      "pull_request_review_id" : 302793545,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/335660016",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r335664441"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/335664441"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Use CWallet::m_last_block_processed_height in GetDepthInMainChain\" (901fa3a3a5fdac52ec6df69acb744abd99a6cb99)\r\n\r\nCan this return be eliminated? It seems risky to silently return incorrect information about a transaction if there was an iinitialization error at an earlier point in the code. It might be better to assert.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-10-16T19:23:10Z",
      "diff_hunk" : "@@ -4669,10 +4669,13 @@ void CWalletTx::SetConf(Status status, const uint256& block_hash, int posInBlock\n \n int CWalletTx::GetDepthInMainChain(interfaces::Chain::Lock& locked_chain) const\n {\n+    if (pwallet == nullptr)\n+        return 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r335664441",
      "id" : 335664441,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzNTY2NDQ0MQ==",
      "original_commit_id" : "901fa3a3a5fdac52ec6df69acb744abd99a6cb99",
      "original_position" : 5,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 302793545,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/335664441",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r335669691"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/335669691"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Use CWallet::m_last_block_processed_height in GetDepthInMainChain\" (901fa3a3a5fdac52ec6df69acb744abd99a6cb99)\r\n\r\nThis TODO is fine and no need to change things here, but I think GetDepthInMainChain and related methods should probably be standalone utility functions or `CWallet` methods instead of `CWalletTx` members. I guess other ways to support adding the lock annotation would be to move the `CWalletTx` class declaration after `CWallet`, or pass a new `CWallet&` argument.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-10-16T19:35:36Z",
      "diff_hunk" : "@@ -639,7 +639,13 @@ class CWalletTx\n      *  0  : in memory pool, waiting to be included in a block\n      * >=1 : this many blocks deep in the main chain\n      */\n-    int GetDepthInMainChain(interfaces::Chain::Lock& locked_chain) const;\n+    // TODO: Remove \"NO_THREAD_SAFETY_ANALYSIS\" and replace it with the correct\n+    // annotation \"EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\". The annotation\n+    // \"NO_THREAD_SAFETY_ANALYSIS\" was temporarily added to avoid having to\n+    // resolve the issue of member access into incomplete type CWallet. Note\n+    // that we still have the runtime check \"AssertLockHeld(pwallet->cs_wallet)\"\n+    // in place.\n+    int GetDepthInMainChain(interfaces::Chain::Lock& locked_chain) const NO_THREAD_SAFETY_ANALYSIS;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r335669691",
      "id" : 335669691,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzNTY2OTY5MQ==",
      "original_commit_id" : "901fa3a3a5fdac52ec6df69acb744abd99a6cb99",
      "original_position" : 11,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 302793545,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/335669691",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338123599"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338123599"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated the comment, which was saying the inverse of what was done in code, if tx was confirmed (or conflicted by another confirmed tx) and a reorg happens we should reset tx status to unconfirmed. The case where a transaction was reorged out while online and then reconfirmed while offline is covered by the rescan logic of wallet creation IMO. Reason for the `&& !block_height` is to check that we don't find anymore the block based on the tx `hashBlock` stored, hint of a reorg.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-10-23T15:34:40Z",
      "diff_hunk" : "@@ -1168,13 +1170,17 @@ void CWallet::LoadToWallet(CWalletTx& wtxIn)\n {\n     // If wallet doesn't have a chain (e.g wallet-tool), lock can't be taken.\n     auto locked_chain = LockChain();\n-    // If tx hasn't been reorged out of chain while wallet being shutdown\n-    // change tx status to UNCONFIRMED and reset hashBlock/nIndex.\n-    if (!wtxIn.m_confirm.hashBlock.IsNull()) {\n-        if (locked_chain && !locked_chain->getBlockHeight(wtxIn.m_confirm.hashBlock)) {\n+    if (locked_chain) {\n+        Optional<int> block_height = locked_chain->getBlockHeight(wtxIn.m_confirm.hashBlock);\n+        // If tx hasn't been reorged out of chain while wallet being shutdown\n+        // change tx status to UNCONFIRMED and reset hashBlock/nIndex.\n+        if ((wtxIn.isConflicted() || wtxIn.isConfirmed()) && !block_height) {\n             wtxIn.setUnconfirmed();\n             wtxIn.m_confirm.hashBlock = uint256();\n+            wtxIn.m_confirm.block_height = 0;\n             wtxIn.m_confirm.nIndex = 0;\n+        } else {\n+            wtxIn.m_confirm.block_height = (block_height) ? *block_height : 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338123599",
      "id" : 338123599,
      "in_reply_to_id" : 335645716,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzODEyMzU5OQ==",
      "original_commit_id" : "6593366d385e1c299a675af58ddd2138b3bd01e5",
      "original_position" : 31,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 305989447,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338123599",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338123703"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338123703"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Removed",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-10-23T15:34:51Z",
      "diff_hunk" : "@@ -976,6 +978,8 @@ class CWallet final : public FillableSigningProvider, private interfaces::Chain:\n     /** Interface for accessing chain state. */\n     interfaces::Chain& chain() const { assert(m_chain); return *m_chain; }\n \n+    /** Interface to assert chain access. */\n+    bool hasChain() const { return m_chain != nullptr; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338123703",
      "id" : 338123703,
      "in_reply_to_id" : 335655545,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzODEyMzcwMw==",
      "original_commit_id" : "6593366d385e1c299a675af58ddd2138b3bd01e5",
      "original_position" : 77,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 305989585,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338123703",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338125519"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338125519"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated commit message, due to the switch to height tracking based on callbacks, if we don't wait for the whole callbacks queue being drawn because the last block hash processed by the wallet may be a descendant of the current tip, we may miss to process BlockDisconnected and so get tx deptch inconsistencies. ",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-10-23T15:38:08Z",
      "diff_hunk" : "@@ -348,13 +348,11 @@ class ChainImpl : public Chain\n     {\n         return MakeUnique<NotificationsHandlerImpl>(*this, notifications);\n     }\n-    void waitForNotificationsIfNewBlocksConnected(const uint256& old_tip) override\n+    void waitForNotificationsIfTipChanged(const uint256& old_tip) override\n     {\n         if (!old_tip.IsNull()) {\n             LOCK(::cs_main);\n             if (old_tip == ::ChainActive().Tip()->GetBlockHash()) return;\n-            CBlockIndex* block = LookupBlockIndex(old_tip);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338125519",
      "id" : 338125519,
      "in_reply_to_id" : 335660016,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzODEyNTUxOQ==",
      "original_commit_id" : "25f7a78b952f172457b75b7fa2dc889215e0703b",
      "original_position" : 10,
      "path" : "src/interfaces/chain.cpp",
      "position" : 38,
      "pull_request_review_id" : 305991976,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338125519",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338125648"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338125648"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Switch to asserting.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-10-23T15:38:21Z",
      "diff_hunk" : "@@ -4669,10 +4669,13 @@ void CWalletTx::SetConf(Status status, const uint256& block_hash, int posInBlock\n \n int CWalletTx::GetDepthInMainChain(interfaces::Chain::Lock& locked_chain) const\n {\n+    if (pwallet == nullptr)\n+        return 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338125648",
      "id" : 338125648,
      "in_reply_to_id" : 335664441,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzODEyNTY0OA==",
      "original_commit_id" : "901fa3a3a5fdac52ec6df69acb744abd99a6cb99",
      "original_position" : 5,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 305992149,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338125648",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338126522"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338126522"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ok, I think will let it as it is for now and will try to pass a `CWallet&` argment in a future PR scoped only on this.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-10-23T15:39:52Z",
      "diff_hunk" : "@@ -639,7 +639,13 @@ class CWalletTx\n      *  0  : in memory pool, waiting to be included in a block\n      * >=1 : this many blocks deep in the main chain\n      */\n-    int GetDepthInMainChain(interfaces::Chain::Lock& locked_chain) const;\n+    // TODO: Remove \"NO_THREAD_SAFETY_ANALYSIS\" and replace it with the correct\n+    // annotation \"EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\". The annotation\n+    // \"NO_THREAD_SAFETY_ANALYSIS\" was temporarily added to avoid having to\n+    // resolve the issue of member access into incomplete type CWallet. Note\n+    // that we still have the runtime check \"AssertLockHeld(pwallet->cs_wallet)\"\n+    // in place.\n+    int GetDepthInMainChain(interfaces::Chain::Lock& locked_chain) const NO_THREAD_SAFETY_ANALYSIS;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338126522",
      "id" : 338126522,
      "in_reply_to_id" : 335669691,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzODEyNjUyMg==",
      "original_commit_id" : "901fa3a3a5fdac52ec6df69acb744abd99a6cb99",
      "original_position" : 11,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 305993286,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338126522",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for review @ryanofsky, rebased and addressed your comment at 089189e\r\n\r\n> IIUC this is current behavior, independent of the PR?\r\n\r\nAFAIK, we don't have logic to undo conflicts on child txn so it was already even there before #16624. ",
      "created_at" : "2019-10-23T15:40:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-545505919",
      "id" : 545505919,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NTUwNTkxOQ==",
      "updated_at" : "2019-10-23T15:48:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/545505919",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338150753"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338150753"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Pass block height in Chain::BlockConnected/Chain::BlockDisconnected\" (82c591ea35ac918147ca66444ae608b8385abd7c)\r\n\r\nWould it be more correct to pass the block height here instead of 0?",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-10-23T16:26:24Z",
      "diff_hunk" : "@@ -307,7 +307,7 @@ static int64_t AddTx(CWallet& wallet, uint32_t lockTime, int64_t mockTime, int64\n         wallet.AddToWallet(wtx);\n     }\n     if (block) {\n-        wtx.SetConf(CWalletTx::Status::CONFIRMED, block->GetBlockHash(), 0);\n+        wtx.SetConf(CWalletTx::Status::CONFIRMED, block->GetBlockHash(), 0, 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338150753",
      "id" : 338150753,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzODE1MDc1Mw==",
      "original_commit_id" : "de8fe7d717042823f2aa429be2a260904a10b42e",
      "original_position" : 14,
      "path" : "src/wallet/test/wallet_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 306024592,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338150753",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338156719"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338156719"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Add block_height field in struct Confirmation\" (de8fe7d717042823f2aa429be2a260904a10b42e)\r\n\r\nPerhaps something for a followup PR, but I wonder if some getBlockHeight calls can be removed now and replaced with block_height accesses:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/089189ef99effe79bb2b71b9248f8aa419079b9a/src/interfaces/wallet.cpp#L66\r\nhttps://github.com/bitcoin/bitcoin/blob/089189ef99effe79bb2b71b9248f8aa419079b9a/src/wallet/wallet.cpp#L4049",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-10-23T16:38:20Z",
      "diff_hunk" : "@@ -496,13 +496,14 @@ class CWalletTx\n         ABANDONED\n     };\n \n-    /* Confirmation includes tx status and a pair of {block hash/tx index in block} at which tx has been confirmed.\n-     * This pair is both 0 if tx hasn't confirmed yet. Meaning of these fields changes with CONFLICTED state\n-     * where they instead point to block hash and index of the deepest conflicting tx.\n+    /* Confirmation includes tx status and a triplet of {block hash/block height/tx index in block} at which tx has been confirmed.\n+     * This triplet is whole 0 if tx hasn't confirmed yet. Meaning of these fields changes with CONFLICTED state\n+     * where they instead point to block hash and block height of the deepest conflicting tx.\n      */\n     struct Confirmation {\n         Status status = UNCONFIRMED;\n         uint256 hashBlock = uint256();\n+        int block_height = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338156719",
      "id" : 338156719,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzODE1NjcxOQ==",
      "original_commit_id" : "de8fe7d717042823f2aa429be2a260904a10b42e",
      "original_position" : 14,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 306024592,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338156719",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338161904"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338161904"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Add block_height field in struct Confirmation\" (de8fe7d717042823f2aa429be2a260904a10b42e)\r\n\r\nI think this comment should explicitly mention what you said about \"The case where a transaction was reorged out while online and then reconfirmed while offline is covered by the rescan logic,\" or at least mention generally that these transaction statuses aren't final and will be patched up by a rescan after the load.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-10-23T16:49:05Z",
      "diff_hunk" : "@@ -1166,13 +1168,18 @@ void CWallet::LoadToWallet(CWalletTx& wtxIn)\n {\n     // If wallet doesn't have a chain (e.g wallet-tool), lock can't be taken.\n     auto locked_chain = LockChain();\n-    // If tx hasn't been reorged out of chain while wallet being shutdown\n-    // change tx status to UNCONFIRMED and reset hashBlock/nIndex.\n-    if (!wtxIn.m_confirm.hashBlock.IsNull()) {\n-        if (locked_chain && !locked_chain->getBlockHeight(wtxIn.m_confirm.hashBlock)) {\n+    if (locked_chain) {\n+        Optional<int> block_height = locked_chain->getBlockHeight(wtxIn.m_confirm.hashBlock);\n+        // If tx (or conflicting tx) has been reorged out of chain while wallet being shutdown\n+        // change tx status to UNCONFIRMED and reset hashBlock/nIndex. ABANDONED tx should have\n+        // a block_height unset but shouldn't see its status updated.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338161904",
      "id" : 338161904,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzODE2MTkwNA==",
      "original_commit_id" : "de8fe7d717042823f2aa429be2a260904a10b42e",
      "original_position" : 25,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 306024592,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338161904",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338162196"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338162196"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Add block_height field in struct Confirmation\" (de8fe7d717042823f2aa429be2a260904a10b42e)\r\n\r\ns/being shutdown/was shutdown/ for clarity",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-10-23T16:49:42Z",
      "diff_hunk" : "@@ -1166,13 +1168,18 @@ void CWallet::LoadToWallet(CWalletTx& wtxIn)\n {\n     // If wallet doesn't have a chain (e.g wallet-tool), lock can't be taken.\n     auto locked_chain = LockChain();\n-    // If tx hasn't been reorged out of chain while wallet being shutdown\n-    // change tx status to UNCONFIRMED and reset hashBlock/nIndex.\n-    if (!wtxIn.m_confirm.hashBlock.IsNull()) {\n-        if (locked_chain && !locked_chain->getBlockHeight(wtxIn.m_confirm.hashBlock)) {\n+    if (locked_chain) {\n+        Optional<int> block_height = locked_chain->getBlockHeight(wtxIn.m_confirm.hashBlock);\n+        // If tx (or conflicting tx) has been reorged out of chain while wallet being shutdown",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338162196",
      "id" : 338162196,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzODE2MjE5Ng==",
      "original_commit_id" : "de8fe7d717042823f2aa429be2a260904a10b42e",
      "original_position" : 23,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 306024592,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338162196",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338169478"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338169478"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Add block_height field in struct Confirmation\" (de8fe7d717042823f2aa429be2a260904a10b42e)\r\n\r\nMakes sense! I think logic would be less confusing it we got rid of the repeated height checks, though. Would suggest\r\n\r\n```c++\r\nOptional<int> block_height = locked_chain->getBlockHeight(wtxIn.m_confirm.hashBlock);\r\nif (block_height) {\r\n    // Update cached block height variable since it not stored in the\r\n    // serialized transaction.\r\n    wtxIn.m_confirm.block_height = *block_height;\r\n} else if (wtxIn.isConflicted() || wtxIn.isConfirmed()) {\r\n    // If tx block (or conflicting block) was reorged out of chain\r\n    // while the wallet was shut down, change tx status to UNCONFIRMED\r\n    // and reset block height, hash, and index. ABANDONED tx don't have\r\n    // associated blocks and don't need to be updated.\r\n    wtxIn.setUnconfirmed();\r\n    wtxIn.m_confirm.hashBlock = uint256();\r\n    wtxIn.m_confirm.block_height = 0;\r\n    wtxIn.m_confirm.nIndex = 0;\r\n}\r\n```\r\n",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-10-23T17:05:04Z",
      "diff_hunk" : "@@ -1168,13 +1170,17 @@ void CWallet::LoadToWallet(CWalletTx& wtxIn)\n {\n     // If wallet doesn't have a chain (e.g wallet-tool), lock can't be taken.\n     auto locked_chain = LockChain();\n-    // If tx hasn't been reorged out of chain while wallet being shutdown\n-    // change tx status to UNCONFIRMED and reset hashBlock/nIndex.\n-    if (!wtxIn.m_confirm.hashBlock.IsNull()) {\n-        if (locked_chain && !locked_chain->getBlockHeight(wtxIn.m_confirm.hashBlock)) {\n+    if (locked_chain) {\n+        Optional<int> block_height = locked_chain->getBlockHeight(wtxIn.m_confirm.hashBlock);\n+        // If tx hasn't been reorged out of chain while wallet being shutdown\n+        // change tx status to UNCONFIRMED and reset hashBlock/nIndex.\n+        if ((wtxIn.isConflicted() || wtxIn.isConfirmed()) && !block_height) {\n             wtxIn.setUnconfirmed();\n             wtxIn.m_confirm.hashBlock = uint256();\n+            wtxIn.m_confirm.block_height = 0;\n             wtxIn.m_confirm.nIndex = 0;\n+        } else {\n+            wtxIn.m_confirm.block_height = (block_height) ? *block_height : 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338169478",
      "id" : 338169478,
      "in_reply_to_id" : 335645716,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzODE2OTQ3OA==",
      "original_commit_id" : "6593366d385e1c299a675af58ddd2138b3bd01e5",
      "original_position" : 31,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 306024592,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338169478",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338274948"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338274948"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Add block_height field in struct Confirmation\" (de8fe7d717042823f2aa429be2a260904a10b42e)\r\n\r\nNote: this is one of the previous PR cleanups mentioned in the commit description: https://github.com/bitcoin/bitcoin/pull/16624#discussion_r321331630",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-10-23T20:57:35Z",
      "diff_hunk" : "@@ -1303,7 +1310,6 @@ bool CWallet::AbandonTransaction(interfaces::Chain::Lock& locked_chain, const ui\n         if (currentconfirm == 0 && !wtx.isAbandoned()) {\n             // If the orig tx was not in block/mempool, none of its spends can be in mempool\n             assert(!wtx.InMempool());\n-            wtx.m_confirm.nIndex = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338274948",
      "id" : 338274948,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzODI3NDk0OA==",
      "original_commit_id" : "de8fe7d717042823f2aa429be2a260904a10b42e",
      "original_position" : 74,
      "path" : "src/wallet/wallet.cpp",
      "position" : 140,
      "pull_request_review_id" : 306024592,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338274948",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338278567"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338278567"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Pass block height in Chain::BlockConnected/Chain::BlockDisconnected\" (82c591ea35ac918147ca66444ae608b8385abd7c)\r\n\r\nOrder of arguments here is wrong. Block height come before position in block.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-10-23T21:06:11Z",
      "diff_hunk" : "@@ -1391,7 +1398,7 @@ void CWallet::SyncTransaction(const CTransactionRef& ptx, CWalletTx::Status stat\n void CWallet::TransactionAddedToMempool(const CTransactionRef& ptx) {\n     auto locked_chain = chain().lock();\n     LOCK(cs_wallet);\n-    SyncTransaction(ptx, CWalletTx::Status::UNCONFIRMED, {} /* block hash */, 0 /* position in block */);\n+    SyncTransaction(ptx, CWalletTx::Status::UNCONFIRMED, {} /* block hash */, 0 /* position in block */, 0 /* block height */);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338278567",
      "id" : 338278567,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzODI3ODU2Nw==",
      "original_commit_id" : "de8fe7d717042823f2aa429be2a260904a10b42e",
      "original_position" : 112,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 306024592,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338278567",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338282044"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338282044"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Add block_height field in struct Confirmation\" (de8fe7d717042823f2aa429be2a260904a10b42e)\r\n\r\nCould you move the block_height argument after block_hash to be consistent with `SyncTransaction` argument order and `Confirmation` struct order?\r\n\r\nAlternately, it possible, it would be really nice to combine the 4 status/hash/height/index arguments into a single CWalletTx::Confirmation struct argument, because having 4 int arguments in a row makes bugs more likely.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-10-23T21:14:27Z",
      "diff_hunk" : "@@ -798,10 +800,10 @@ class CWallet final : public FillableSigningProvider, private interfaces::Chain:\n      * Abandoned state should probably be more carefully tracked via different\n      * posInBlock signals or by checking mempool presence when necessary.\n      */\n-    bool AddToWalletIfInvolvingMe(const CTransactionRef& tx, CWalletTx::Status status, const uint256& block_hash, int posInBlock, bool fUpdate) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n+    bool AddToWalletIfInvolvingMe(const CTransactionRef& tx, CWalletTx::Status status, const uint256& block_hash, int posInBlock, bool fUpdate, int block_height) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338282044",
      "id" : 338282044,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzODI4MjA0NA==",
      "original_commit_id" : "de8fe7d717042823f2aa429be2a260904a10b42e",
      "original_position" : 55,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 306024592,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338282044",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338282320"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338282320"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Add block_height field in struct Confirmation\" (de8fe7d717042823f2aa429be2a260904a10b42e)\r\n\r\nCould you move the block_height argument after block_hash to be consistent with `SyncTransaction` argument order and `Confirmation` struct order?",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-10-23T21:15:10Z",
      "diff_hunk" : "@@ -630,7 +630,7 @@ class CWalletTx\n     // in place.\n     std::set<uint256> GetConflicts() const NO_THREAD_SAFETY_ANALYSIS;\n \n-    void SetConf(Status status, const uint256& block_hash, int posInBlock);\n+    void SetConf(Status status, const uint256& block_hash, int posInBlock, int block_height);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338282320",
      "id" : 338282320,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzODI4MjMyMA==",
      "original_commit_id" : "de8fe7d717042823f2aa429be2a260904a10b42e",
      "original_position" : 31,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 306024592,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338282320",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338285914"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338285914"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Add block_height field in struct Confirmation\" (de8fe7d717042823f2aa429be2a260904a10b42e)\r\n\r\nThis seems harmless, but it's unclear why it's part of this commit. Is this line meant to added to another commit where the block_height is actually used? Also, I don't see where -1 would be set or allowed for this.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-10-23T21:24:00Z",
      "diff_hunk" : "@@ -4632,20 +4639,24 @@ CKeyPool::CKeyPool(const CPubKey& vchPubKeyIn, bool internalIn)\n     m_pre_split = false;\n }\n \n-void CWalletTx::SetConf(Status status, const uint256& block_hash, int posInBlock)\n+void CWalletTx::SetConf(Status status, const uint256& block_hash, int posInBlock, int block_height)\n {\n     // Update tx status\n     m_confirm.status = status;\n \n     // Update the tx's hashBlock\n     m_confirm.hashBlock = block_hash;\n \n+    // set tx height\n+    m_confirm.block_height = block_height;\n+\n     // set the position of the transaction in the block\n     m_confirm.nIndex = posInBlock;\n }\n \n int CWalletTx::GetDepthInMainChain(interfaces::Chain::Lock& locked_chain) const\n {\n+    assert(m_confirm.block_height >= -1);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338285914",
      "id" : 338285914,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzODI4NTkxNA==",
      "original_commit_id" : "de8fe7d717042823f2aa429be2a260904a10b42e",
      "original_position" : 165,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 306024592,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338285914",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338287777"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338287777"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Add block_height field in struct Confirmation\" (de8fe7d717042823f2aa429be2a260904a10b42e)\r\n\r\nMaybe replace \"hasn't confirmed yet\" with \"is unconfirmed or abandoned\" to be more specific and include mention of the abandoned state.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-10-23T21:28:43Z",
      "diff_hunk" : "@@ -496,13 +496,14 @@ class CWalletTx\n         ABANDONED\n     };\n \n-    /* Confirmation includes tx status and a pair of {block hash/tx index in block} at which tx has been confirmed.\n-     * This pair is both 0 if tx hasn't confirmed yet. Meaning of these fields changes with CONFLICTED state\n-     * where they instead point to block hash and index of the deepest conflicting tx.\n+    /* Confirmation includes tx status and a triplet of {block hash/block height/tx index in block} at which tx has been confirmed.\n+     * This triplet is whole 0 if tx hasn't confirmed yet. Meaning of these fields changes with CONFLICTED state",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338287777",
      "id" : 338287777,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzODI4Nzc3Nw==",
      "original_commit_id" : "de8fe7d717042823f2aa429be2a260904a10b42e",
      "original_position" : 8,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 306024592,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338287777",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338288319"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338288319"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Add block_height field in struct Confirmation\" (de8fe7d717042823f2aa429be2a260904a10b42e)\r\n\r\nNote: this is another cleanup from the previous pr.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-10-23T21:30:05Z",
      "diff_hunk" : "@@ -546,7 +547,6 @@ class CWalletTx\n          * compatibility (pre-commit 9ac63d6).\n          */\n         if (serializedIndex == -1 && m_confirm.hashBlock == ABANDON_HASH) {\n-            m_confirm.hashBlock = uint256();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338288319",
      "id" : 338288319,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzODI4ODMxOQ==",
      "original_commit_id" : "de8fe7d717042823f2aa429be2a260904a10b42e",
      "original_position" : 22,
      "path" : "src/wallet/wallet.h",
      "position" : 28,
      "pull_request_review_id" : 306024592,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338288319",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338291892"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338291892"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Add m_last_block_processed_height field in CWallet\" (9161f0bf0321e90e0aaeeafc58c5ea6f97ebb1e2):\r\n\r\nWould `assert(m_last_block_processed_height >= 0)` to make sure we're past initialization and don't wind up with crazy depth values.\r\n",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-10-23T21:39:22Z",
      "diff_hunk" : "@@ -1405,6 +1411,20 @@ class CWallet final : public FillableSigningProvider, private interfaces::Chain:\n \n     /** Implement lookup of key origin information through wallet key metadata. */\n     bool GetKeyOrigin(const CKeyID& keyid, KeyOriginInfo& info) const override;\n+\n+    /** Get last block processed height */\n+    int GetLastBlockHeight() const EXCLUSIVE_LOCKS_REQUIRED(cs_wallet)\n+    {\n+        AssertLockHeld(cs_wallet);\n+        return m_last_block_processed_height;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338291892",
      "id" : 338291892,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzODI5MTg5Mg==",
      "original_commit_id" : "9161f0bf0321e90e0aaeeafc58c5ea6f97ebb1e2",
      "original_position" : 31,
      "path" : "src/wallet/wallet.h",
      "position" : 203,
      "pull_request_review_id" : 306024592,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338291892",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338293551"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338293551"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Add block_height field in struct Confirmation\" (de8fe7d717042823f2aa429be2a260904a10b42e)\r\n\r\nCan you replace m_last_block_processed_height with height on this line? It's slightly worrying to depend on the wallet member if it might get updated for some reason, and also better to be more consistent with previous `block_hash` argument.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-10-23T21:43:59Z",
      "diff_hunk" : "@@ -1416,7 +1423,7 @@ void CWallet::BlockConnected(const CBlock& block, const std::vector<CTransaction\n     m_last_block_processed_height = height;\n     m_last_block_processed = block_hash;\n     for (size_t i = 0; i < block.vtx.size(); i++) {\n-        SyncTransaction(block.vtx[i], CWalletTx::Status::CONFIRMED, block_hash, i);\n+        SyncTransaction(block.vtx[i], CWalletTx::Status::CONFIRMED, block_hash, m_last_block_processed_height, i);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338293551",
      "id" : 338293551,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzODI5MzU1MQ==",
      "original_commit_id" : "de8fe7d717042823f2aa429be2a260904a10b42e",
      "original_position" : 121,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 306024592,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338293551",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-10-24T11:40:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-545878618",
      "id" : 545878618,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NTg3ODYxOA==",
      "updated_at" : "2019-10-24T11:40:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/545878618",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338744823"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338744823"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I let it be, need thoughts maybe to retrieve more as same time",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-10-24T19:10:13Z",
      "diff_hunk" : "@@ -496,13 +496,14 @@ class CWalletTx\n         ABANDONED\n     };\n \n-    /* Confirmation includes tx status and a pair of {block hash/tx index in block} at which tx has been confirmed.\n-     * This pair is both 0 if tx hasn't confirmed yet. Meaning of these fields changes with CONFLICTED state\n-     * where they instead point to block hash and index of the deepest conflicting tx.\n+    /* Confirmation includes tx status and a triplet of {block hash/block height/tx index in block} at which tx has been confirmed.\n+     * This triplet is whole 0 if tx hasn't confirmed yet. Meaning of these fields changes with CONFLICTED state\n+     * where they instead point to block hash and block height of the deepest conflicting tx.\n      */\n     struct Confirmation {\n         Status status = UNCONFIRMED;\n         uint256 hashBlock = uint256();\n+        int block_height = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338744823",
      "id" : 338744823,
      "in_reply_to_id" : 338156719,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzODc0NDgyMw==",
      "original_commit_id" : "de8fe7d717042823f2aa429be2a260904a10b42e",
      "original_position" : 14,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 306802224,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338744823",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338745557"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338745557"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Added commit d0c4ce6 : Replace CWalletTx:SetConf by Confirmation initialization list, should make things less error-prone.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-10-24T19:12:04Z",
      "diff_hunk" : "@@ -1391,7 +1398,7 @@ void CWallet::SyncTransaction(const CTransactionRef& ptx, CWalletTx::Status stat\n void CWallet::TransactionAddedToMempool(const CTransactionRef& ptx) {\n     auto locked_chain = chain().lock();\n     LOCK(cs_wallet);\n-    SyncTransaction(ptx, CWalletTx::Status::UNCONFIRMED, {} /* block hash */, 0 /* position in block */);\n+    SyncTransaction(ptx, CWalletTx::Status::UNCONFIRMED, {} /* block hash */, 0 /* position in block */, 0 /* block height */);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338745557",
      "id" : 338745557,
      "in_reply_to_id" : 338278567,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzODc0NTU1Nw==",
      "original_commit_id" : "de8fe7d717042823f2aa429be2a260904a10b42e",
      "original_position" : 112,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 306803219,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338745557",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338745681"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338745681"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "See d0c4ce6",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-10-24T19:12:24Z",
      "diff_hunk" : "@@ -798,10 +800,10 @@ class CWallet final : public FillableSigningProvider, private interfaces::Chain:\n      * Abandoned state should probably be more carefully tracked via different\n      * posInBlock signals or by checking mempool presence when necessary.\n      */\n-    bool AddToWalletIfInvolvingMe(const CTransactionRef& tx, CWalletTx::Status status, const uint256& block_hash, int posInBlock, bool fUpdate) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n+    bool AddToWalletIfInvolvingMe(const CTransactionRef& tx, CWalletTx::Status status, const uint256& block_hash, int posInBlock, bool fUpdate, int block_height) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338745681",
      "id" : 338745681,
      "in_reply_to_id" : 338282044,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzODc0NTY4MQ==",
      "original_commit_id" : "de8fe7d717042823f2aa429be2a260904a10b42e",
      "original_position" : 55,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 306803386,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338745681",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338746058"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338746058"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Removed, was there to be sure block_height was initialized in a previous version, now it has to be with `Confirmation` default initialization",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-10-24T19:13:22Z",
      "diff_hunk" : "@@ -4632,20 +4639,24 @@ CKeyPool::CKeyPool(const CPubKey& vchPubKeyIn, bool internalIn)\n     m_pre_split = false;\n }\n \n-void CWalletTx::SetConf(Status status, const uint256& block_hash, int posInBlock)\n+void CWalletTx::SetConf(Status status, const uint256& block_hash, int posInBlock, int block_height)\n {\n     // Update tx status\n     m_confirm.status = status;\n \n     // Update the tx's hashBlock\n     m_confirm.hashBlock = block_hash;\n \n+    // set tx height\n+    m_confirm.block_height = block_height;\n+\n     // set the position of the transaction in the block\n     m_confirm.nIndex = posInBlock;\n }\n \n int CWalletTx::GetDepthInMainChain(interfaces::Chain::Lock& locked_chain) const\n {\n+    assert(m_confirm.block_height >= -1);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338746058",
      "id" : 338746058,
      "in_reply_to_id" : 338285914,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzODc0NjA1OA==",
      "original_commit_id" : "de8fe7d717042823f2aa429be2a260904a10b42e",
      "original_position" : 165,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 306803889,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338746058",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338746153"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338746153"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-10-24T19:13:37Z",
      "diff_hunk" : "@@ -1405,6 +1411,20 @@ class CWallet final : public FillableSigningProvider, private interfaces::Chain:\n \n     /** Implement lookup of key origin information through wallet key metadata. */\n     bool GetKeyOrigin(const CKeyID& keyid, KeyOriginInfo& info) const override;\n+\n+    /** Get last block processed height */\n+    int GetLastBlockHeight() const EXCLUSIVE_LOCKS_REQUIRED(cs_wallet)\n+    {\n+        AssertLockHeld(cs_wallet);\n+        return m_last_block_processed_height;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338746153",
      "id" : 338746153,
      "in_reply_to_id" : 338291892,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzODc0NjE1Mw==",
      "original_commit_id" : "9161f0bf0321e90e0aaeeafc58c5ea6f97ebb1e2",
      "original_position" : 31,
      "path" : "src/wallet/wallet.h",
      "position" : 203,
      "pull_request_review_id" : 306804012,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338746153",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks @ryanofsky , addressed most of your comments, specially https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338169478a and adding commit d0c4ce6 to wrap all confirmations values directly in BlockConnected/BlockDisconnected.\r\n\r\nRebased at 75c276e",
      "created_at" : "2019-10-24T19:15:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-546062625",
      "id" : 546062625,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NjA2MjYyNQ==",
      "updated_at" : "2019-10-24T19:15:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/546062625",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338791804"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338791804"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Replace CWalletTx::SetConf by Confirmation initialization list\" (d0c4ce686ba388b9fefff2b153358e33a042ee80)\r\n\r\nNot important, but might want to avoid creating named variable with:\r\n\r\n```\r\nwtx.m_confirm = CWalletTx::Confirmation{CWalletTx::Status::CONFIRMED, merkleBlock.header.GetHash(), txnIndex};\r\n```\r\n\r\nSimilarly with all the other temporary `confirm` variables below.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-10-24T21:06:20Z",
      "diff_hunk" : "@@ -383,7 +383,8 @@ UniValue importprunedfunds(const JSONRPCRequest& request)\n         throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Something wrong with merkleblock\");\n     }\n \n-    wtx.SetConf(CWalletTx::Status::CONFIRMED, merkleBlock.header.GetHash(), txnIndex);\n+    CWalletTx::Confirmation confirm(CWalletTx::Status::CONFIRMED, merkleBlock.header.GetHash(), txnIndex);\n+    wtx.m_confirm = confirm;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338791804",
      "id" : 338791804,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzODc5MTgwNA==",
      "original_commit_id" : "d0c4ce686ba388b9fefff2b153358e33a042ee80",
      "original_position" : 6,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 306864462,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338791804",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338792689"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338792689"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Replace CWalletTx::SetConf by Confirmation initialization list\" (d0c4ce686ba388b9fefff2b153358e33a042ee80)\r\n\r\nNot a big deal, but probably better to pass with reference type `const CWalletTx::Confirmation&` to avoid copies when this is called. Similarly for other functions taking confirm arguments.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-10-24T21:08:36Z",
      "diff_hunk" : "@@ -1193,19 +1193,19 @@ void CWallet::LoadToWallet(CWalletTx& wtxIn)\n     }\n }\n \n-bool CWallet::AddToWalletIfInvolvingMe(const CTransactionRef& ptx, CWalletTx::Status status, const uint256& block_hash, int posInBlock, bool fUpdate)\n+bool CWallet::AddToWalletIfInvolvingMe(const CTransactionRef& ptx, CWalletTx::Confirmation confirm, bool fUpdate)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r338792689",
      "id" : 338792689,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzODc5MjY4OQ==",
      "original_commit_id" : "d0c4ce686ba388b9fefff2b153358e33a042ee80",
      "original_position" : 5,
      "path" : "src/wallet/wallet.cpp",
      "position" : 70,
      "pull_request_review_id" : 306864462,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/338792689",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. I like the direction of this.",
      "created_at" : "2019-10-25T12:52:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-546341167",
      "id" : 546341167,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NjM0MTE2Nw==",
      "updated_at" : "2019-10-25T12:52:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/546341167",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-10-29T13:21:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-547415979",
      "id" : 547415979,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NzQxNTk3OQ==",
      "updated_at" : "2019-10-29T13:21:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/547415979",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Code review in progress. Built b2c68eb3cdc851d4d1a3bb6a8a64397907e22618, ran tests, running bitcoind w/logging for a few hours.",
      "created_at" : "2019-10-31T17:01:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-548472707",
      "id" : 548472707,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0ODQ3MjcwNw==",
      "updated_at" : "2019-10-31T17:01:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/548472707",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-11-05T10:40:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-549767161",
      "id" : 549767161,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0OTc2NzE2MQ==",
      "updated_at" : "2019-11-05T10:40:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/549767161",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This has had a decent amount of code review but only one code review ack.\r\n\r\nIf previous reviewers want to take another look and add ACKs, it would be very helpful. The PR is smaller and simpler than it was originally, and most of the changes (especially in the last few commits) are actually trivial. A lot of improvments can build on this PR to make the wallet more asynchronous, clean up rescanning, etc.\r\n\r\nReview history:\r\n\r\nryanofsky review and concept ack 2019-06-19 https://github.com/bitcoin/bitcoin/pull/15931#pullrequestreview-251859358\r\npromag concept ack 2019-06-30 https://github.com/bitcoin/bitcoin/pull/15931#pullrequestreview-256075977\r\njnewbery review 2019-07-23 https://github.com/bitcoin/bitcoin/pull/15931#pullrequestreview-265517375\r\njnewbery review 2019-08-06 https://github.com/bitcoin/bitcoin/pull/15931#pullrequestreview-271423875\r\nsjors review and concept ack 2019-08-06 https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-518725058\r\njnewbery review 2019-08-09 https://github.com/bitcoin/bitcoin/pull/15931#pullrequestreview-273228460\r\npromag review 2019-08-15 https://github.com/bitcoin/bitcoin/pull/15931#pullrequestreview-275692610\r\njkczyz review 2019-08-19 https://github.com/bitcoin/bitcoin/pull/15931#pullrequestreview-276662148\r\nryanofsky review 2019-10-23 https://github.com/bitcoin/bitcoin/pull/15931#pullrequestreview-306024592\r\nryanofsky review ack 2019-10-24 https://github.com/bitcoin/bitcoin/pull/15931#pullrequestreview-306864462\r\nlaanwj concept ack 2019-10-25 https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-546341167\r\nryanofsky reack 2019-10-30 https://github.com/bitcoin/bitcoin/pull/15931#pullrequestreview-309395041",
      "created_at" : "2019-11-05T17:55:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-549939666",
      "id" : 549939666,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0OTkzOTY2Ng==",
      "updated_at" : "2019-11-05T17:55:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/549939666",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r342715246"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342715246"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Note for future followup: I believe we could call [`IsFinalTx`](https://github.com/bitcoin/bitcoin/blob/50591f6ec61b802cf4193cdbefcc85ad75716e8d/src/consensus/tx_verify.cpp#L17-L28) instead of [`checkFinalTx`](https://github.com/bitcoin/bitcoin/blob/50591f6ec61b802cf4193cdbefcc85ad75716e8d/src/validation.cpp#L189-L219) so `locked_chain` argument no longer needs to be passed to `CWalletTx::IsTrusted`",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-11-05T18:08:57Z",
      "diff_hunk" : "@@ -1840,7 +1860,7 @@ bool CWalletTx::IsTrusted(interfaces::Chain::Lock& locked_chain) const\n     if (!locked_chain.checkFinalTx(*tx)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r342715246",
      "id" : 342715246,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjcxNTI0Ng==",
      "original_commit_id" : "b2c68eb3cdc851d4d1a3bb6a8a64397907e22618",
      "original_position" : 365,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 311933361,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342715246",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r342783384"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342783384"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Remove locked_chain from GetDepthInMainChain and its callers\" (dd3cb3804126abdba8684cb965d2e1dc3766b3fd)\r\n\r\nAppears to be a mistake during rebase: lost abs() call",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-11-05T20:32:52Z",
      "diff_hunk" : "@@ -1598,7 +1597,7 @@ static UniValue listsinceblock(const JSONRPCRequest& request)\n     for (const std::pair<const uint256, CWalletTx>& pairWtx : pwallet->mapWallet) {\n         CWalletTx tx = pairWtx.second;\n \n-        if (depth == -1 || abs(tx.GetDepthInMainChain(*locked_chain)) < depth) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r342783384",
      "id" : 342783384,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0Mjc4MzM4NA==",
      "original_commit_id" : "dd3cb3804126abdba8684cb965d2e1dc3766b3fd",
      "original_position" : 62,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 62,
      "pull_request_review_id" : 312023348,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342783384",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r342787764"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342787764"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks to spot it, was introducted in 436ad43, corrected rebase mistake!",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-11-05T20:44:05Z",
      "diff_hunk" : "@@ -1598,7 +1597,7 @@ static UniValue listsinceblock(const JSONRPCRequest& request)\n     for (const std::pair<const uint256, CWalletTx>& pairWtx : pwallet->mapWallet) {\n         CWalletTx tx = pairWtx.second;\n \n-        if (depth == -1 || abs(tx.GetDepthInMainChain(*locked_chain)) < depth) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r342787764",
      "id" : 342787764,
      "in_reply_to_id" : 342783384,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0Mjc4Nzc2NA==",
      "original_commit_id" : "dd3cb3804126abdba8684cb965d2e1dc3766b3fd",
      "original_position" : 62,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 62,
      "pull_request_review_id" : 312029465,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342787764",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Sure Russell, I'll review.",
      "created_at" : "2019-11-05T21:39:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-550033276",
      "id" : 550033276,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1MDAzMzI3Ng==",
      "updated_at" : "2019-11-05T21:39:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/550033276",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r342821318"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342821318"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This code would benefit if organized using a guard clause.\r\n\r\n```c++\r\nif (merkleBlock.txn.ExtractMatches(vMatch, vIndex) != merkleBlock.header.hashMerkleRoot) {\r\n    throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Something wrong with merkleblock\");\r\n}\r\n\r\nauto locked_chain = pwallet->chain().lock();\r\nOptional<int> height = locked_chain->getBlockHeight(merkleBlock.header.GetHash());\r\nif (height == nullopt) {\r\n    ...\r\n}\r\n```\r\n\r\nThis would remove nesting, allow `height` and to be initialized where it is declared, and move the exception currently in the else clause closer to where the condition has been violated. It would also allow `txnIndex` to be declared and defined in one place.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-11-05T22:03:43Z",
      "diff_hunk" : "@@ -364,10 +364,12 @@ UniValue importprunedfunds(const JSONRPCRequest& request)\n     std::vector<uint256> vMatch;\n     std::vector<unsigned int> vIndex;\n     unsigned int txnIndex = 0;\n+    Optional<int> height;\n     if (merkleBlock.txn.ExtractMatches(vMatch, vIndex) == merkleBlock.header.hashMerkleRoot) {\n \n         auto locked_chain = pwallet->chain().lock();\n-        if (locked_chain->getBlockHeight(merkleBlock.header.GetHash()) == nullopt) {\n+        height = locked_chain->getBlockHeight(merkleBlock.header.GetHash());\n+        if (height == nullopt) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r342821318",
      "id" : 342821318,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjgyMTMxOA==",
      "original_commit_id" : "058eb3a0ee7a47b51f115f8f04f4770bf5b85900",
      "original_position" : 10,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 312074416,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342821318",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r342824980"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342824980"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It looks like you add this member one commit too early (_Replace CWalletTx::SetConf by Confirmation initialization list_ instead of _Add block_height field in struct Confirmation_), which means that all of the `Confirmation` objects in that commit are setting height incorrectly. Not sure if that would break anything with git bisect. Can you rearranage those commits?",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-11-05T22:12:51Z",
      "diff_hunk" : "@@ -356,14 +356,16 @@ class CWalletTx\n         ABANDONED\n     };\n \n-    /* Confirmation includes tx status and a pair of {block hash/tx index in block} at which tx has been confirmed.\n-     * This pair is both 0 if tx hasn't confirmed yet. Meaning of these fields changes with CONFLICTED state\n-     * where they instead point to block hash and index of the deepest conflicting tx.\n+    /* Confirmation includes tx status and a triplet of {block hash/block height/tx index in block} at which tx has been confirmed.\n+     * This triplet is whole 0 if tx is unconfirmed or abandoned. Meaning of these fields changes with CONFLICTED state\n+     * where they instead point to block hash and block height of the deepest conflicting tx.\n      */\n     struct Confirmation {\n-        Status status = UNCONFIRMED;\n-        uint256 hashBlock = uint256();\n-        int nIndex = 0;\n+        Status status;\n+        uint256 hashBlock;\n+        int block_height;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r342824980",
      "id" : 342824980,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjgyNDk4MA==",
      "original_commit_id" : "8a11ab3ff4cba6456021e46813f530c22ada8ac1",
      "original_position" : 17,
      "path" : "src/wallet/wallet.h",
      "position" : 17,
      "pull_request_review_id" : 312079230,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342824980",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r342825965"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342825965"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit (not worth fixing here, but good to keep in mind for future PRs): these very long (>120 char) lines make looking at diffs quite difficult. Both this comment block and the `Confirmation` constructor could be line-wrapped.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-11-05T22:15:17Z",
      "diff_hunk" : "@@ -356,14 +356,16 @@ class CWalletTx\n         ABANDONED\n     };\n \n-    /* Confirmation includes tx status and a pair of {block hash/tx index in block} at which tx has been confirmed.\n-     * This pair is both 0 if tx hasn't confirmed yet. Meaning of these fields changes with CONFLICTED state\n-     * where they instead point to block hash and index of the deepest conflicting tx.\n+    /* Confirmation includes tx status and a triplet of {block hash/block height/tx index in block} at which tx has been confirmed.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r342825965",
      "id" : 342825965,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjgyNTk2NQ==",
      "original_commit_id" : "8a11ab3ff4cba6456021e46813f530c22ada8ac1",
      "original_position" : 7,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 312079230,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342825965",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r342826446"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342826446"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: \"This triplet is whole 0\" doesn't sound right. \"All three are set to 0\" would be more natural.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-11-05T22:16:17Z",
      "diff_hunk" : "@@ -356,14 +356,16 @@ class CWalletTx\n         ABANDONED\n     };\n \n-    /* Confirmation includes tx status and a pair of {block hash/tx index in block} at which tx has been confirmed.\n-     * This pair is both 0 if tx hasn't confirmed yet. Meaning of these fields changes with CONFLICTED state\n-     * where they instead point to block hash and index of the deepest conflicting tx.\n+    /* Confirmation includes tx status and a triplet of {block hash/block height/tx index in block} at which tx has been confirmed.\n+     * This triplet is whole 0 if tx is unconfirmed or abandoned. Meaning of these fields changes with CONFLICTED state",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r342826446",
      "id" : 342826446,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjgyNjQ0Ng==",
      "original_commit_id" : "8a11ab3ff4cba6456021e46813f530c22ada8ac1",
      "original_position" : 8,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 312079230,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342826446",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r342828677"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342828677"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm not a big fan of these default arguments, especially since the last two are both `int`s. It's too easy to accidentally call the constructor with the wrong number of arguments and set `block_height` when you meant to set `nIndex` (as this branch does in an intermediate commit)",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-11-05T22:22:12Z",
      "diff_hunk" : "@@ -356,14 +356,16 @@ class CWalletTx\n         ABANDONED\n     };\n \n-    /* Confirmation includes tx status and a pair of {block hash/tx index in block} at which tx has been confirmed.\n-     * This pair is both 0 if tx hasn't confirmed yet. Meaning of these fields changes with CONFLICTED state\n-     * where they instead point to block hash and index of the deepest conflicting tx.\n+    /* Confirmation includes tx status and a triplet of {block hash/block height/tx index in block} at which tx has been confirmed.\n+     * This triplet is whole 0 if tx is unconfirmed or abandoned. Meaning of these fields changes with CONFLICTED state\n+     * where they instead point to block hash and block height of the deepest conflicting tx.\n      */\n     struct Confirmation {\n-        Status status = UNCONFIRMED;\n-        uint256 hashBlock = uint256();\n-        int nIndex = 0;\n+        Status status;\n+        uint256 hashBlock;\n+        int block_height;\n+        int nIndex;\n+        Confirmation(Status s = UNCONFIRMED, uint256 h = uint256(), int b = 0, int i = 0) : status(s), hashBlock(h), block_height(b), nIndex(i) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r342828677",
      "id" : 342828677,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjgyODY3Nw==",
      "original_commit_id" : "8a11ab3ff4cba6456021e46813f530c22ada8ac1",
      "original_position" : 19,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 312079230,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342828677",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r342837263"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342837263"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Can these fields be `const` now?",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-11-05T22:45:47Z",
      "diff_hunk" : "@@ -361,9 +361,11 @@ class CWalletTx\n      * where they instead point to block hash and index of the deepest conflicting tx.\n      */\n     struct Confirmation {\n-        Status status = UNCONFIRMED;\n-        uint256 hashBlock = uint256();\n-        int nIndex = 0;\n+        Status status;\n+        uint256 hashBlock;\n+        int block_height;\n+        int nIndex;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r342837263",
      "id" : 342837263,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjgzNzI2Mw==",
      "original_commit_id" : "5643cb72ea4fa77b2a08cfc60474d8839cb17485",
      "original_position" : 10,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 312074416,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342837263",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r342837797"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342837797"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The documentation needs to be updated for this new field.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-11-05T22:47:22Z",
      "diff_hunk" : "@@ -361,9 +361,11 @@ class CWalletTx\n      * where they instead point to block hash and index of the deepest conflicting tx.\n      */\n     struct Confirmation {\n-        Status status = UNCONFIRMED;\n-        uint256 hashBlock = uint256();\n-        int nIndex = 0;\n+        Status status;\n+        uint256 hashBlock;\n+        int block_height;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r342837797",
      "id" : 342837797,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjgzNzc5Nw==",
      "original_commit_id" : "5643cb72ea4fa77b2a08cfc60474d8839cb17485",
      "original_position" : 9,
      "path" : "src/wallet/wallet.h",
      "position" : 17,
      "pull_request_review_id" : 312074416,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342837797",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated at 36b68de :\r\n* move `block_height` to _Add block_height field in struct Confirmation_\r\n* modify `Confirmation` constructor and add comments to avoid ambiguity in place where it's called\r\n* rearrange `Confirmation` constructor comment\r\n* fix nit wording on `Confirmation` comment\r\n* add guard clause for `importprunedfunds` as [suggested](https://github.com/bitcoin/bitcoin/pull/15931#discussion_r342821318) in its own commit\r\n* rewrite commit message for former _Restrain waitForNotificationsIfNewBlocksConnected check to strict tip_\r\n\r\nThanks @ryanofsky, @jnewbery, @jkczyz for reviews! Re-ACK should be minimal on diff. \r\n\r\nEDIT: forgot to update test too, travis should pass now.",
      "created_at" : "2019-11-06T17:54:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-550426449",
      "id" : 550426449,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1MDQyNjQ0OQ==",
      "updated_at" : "2019-11-06T18:38:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/550426449",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r343240886"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343240886"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Rearrange members initialization order and add comments, tell me if you have a better measure.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-11-06T17:55:13Z",
      "diff_hunk" : "@@ -356,14 +356,16 @@ class CWalletTx\n         ABANDONED\n     };\n \n-    /* Confirmation includes tx status and a pair of {block hash/tx index in block} at which tx has been confirmed.\n-     * This pair is both 0 if tx hasn't confirmed yet. Meaning of these fields changes with CONFLICTED state\n-     * where they instead point to block hash and index of the deepest conflicting tx.\n+    /* Confirmation includes tx status and a triplet of {block hash/block height/tx index in block} at which tx has been confirmed.\n+     * This triplet is whole 0 if tx is unconfirmed or abandoned. Meaning of these fields changes with CONFLICTED state\n+     * where they instead point to block hash and block height of the deepest conflicting tx.\n      */\n     struct Confirmation {\n-        Status status = UNCONFIRMED;\n-        uint256 hashBlock = uint256();\n-        int nIndex = 0;\n+        Status status;\n+        uint256 hashBlock;\n+        int block_height;\n+        int nIndex;\n+        Confirmation(Status s = UNCONFIRMED, uint256 h = uint256(), int b = 0, int i = 0) : status(s), hashBlock(h), block_height(b), nIndex(i) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r343240886",
      "id" : 343240886,
      "in_reply_to_id" : 342828677,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MzI0MDg4Ng==",
      "original_commit_id" : "8a11ab3ff4cba6456021e46813f530c22ada8ac1",
      "original_position" : 19,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 312629357,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343240886",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r343241228"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343241228"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think we can't due to setting them with method like `setAbandoned`?",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-11-06T17:55:57Z",
      "diff_hunk" : "@@ -361,9 +361,11 @@ class CWalletTx\n      * where they instead point to block hash and index of the deepest conflicting tx.\n      */\n     struct Confirmation {\n-        Status status = UNCONFIRMED;\n-        uint256 hashBlock = uint256();\n-        int nIndex = 0;\n+        Status status;\n+        uint256 hashBlock;\n+        int block_height;\n+        int nIndex;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r343241228",
      "id" : 343241228,
      "in_reply_to_id" : 342837263,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MzI0MTIyOA==",
      "original_commit_id" : "5643cb72ea4fa77b2a08cfc60474d8839cb17485",
      "original_position" : 10,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 312629801,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343241228",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r343241730"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343241730"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Shouldn't be an issue anymore as `block_height` has been switched to the right commit.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-11-06T17:57:00Z",
      "diff_hunk" : "@@ -361,9 +361,11 @@ class CWalletTx\n      * where they instead point to block hash and index of the deepest conflicting tx.\n      */\n     struct Confirmation {\n-        Status status = UNCONFIRMED;\n-        uint256 hashBlock = uint256();\n-        int nIndex = 0;\n+        Status status;\n+        uint256 hashBlock;\n+        int block_height;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r343241730",
      "id" : 343241730,
      "in_reply_to_id" : 342837797,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MzI0MTczMA==",
      "original_commit_id" : "5643cb72ea4fa77b2a08cfc60474d8839cb17485",
      "original_position" : 9,
      "path" : "src/wallet/wallet.h",
      "position" : 17,
      "pull_request_review_id" : 312630432,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T18:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343241730",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r343272517"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343272517"
         }
      },
      "author_association" : "MEMBER",
      "body" : "very minor nit: using `b` for height and `h` for hash is a little confusing. Using a few extra characters and calling these `status_in`, `height_in`, `hash_in` and `index_in` would make this clearer.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-11-06T19:03:47Z",
      "diff_hunk" : "@@ -356,14 +356,17 @@ class CWalletTx\n         ABANDONED\n     };\n \n-    /* Confirmation includes tx status and a pair of {block hash/tx index in block} at which tx has been confirmed.\n-     * This pair is both 0 if tx hasn't confirmed yet. Meaning of these fields changes with CONFLICTED state\n-     * where they instead point to block hash and index of the deepest conflicting tx.\n+    /* Confirmation includes tx status and a triplet of {block height/block hash/tx index in block}\n+     * at which tx has been confirmed. All three are set to 0 if tx is unconfirmed or abandoned.\n+     * Meaning of these fields changes with CONFLICTED state where they instead point to block hash\n+     * and block height of the deepest conflicting tx.\n      */\n     struct Confirmation {\n-        Status status = UNCONFIRMED;\n-        uint256 hashBlock = uint256();\n-        int nIndex = 0;\n+        Status status;\n+        int block_height;\n+        uint256 hashBlock;\n+        int nIndex;\n+        Confirmation(Status s = UNCONFIRMED, int b = 0, uint256 h = uint256(), int i = 0) : status(s), block_height(b), hashBlock(h), nIndex(i) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r343272517",
      "id" : 343272517,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MzI3MjUxNw==",
      "original_commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "original_position" : 20,
      "path" : "src/wallet/wallet.h",
      "position" : 20,
      "pull_request_review_id" : 312670750,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T19:26:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343272517",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r343354412"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343354412"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ah, you're right. Could be better to assign a new object within `setAbandoned` instead, but feel free to leave as it is. Looks like there are other places where these are directly assigned.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-11-06T22:08:48Z",
      "diff_hunk" : "@@ -361,9 +361,11 @@ class CWalletTx\n      * where they instead point to block hash and index of the deepest conflicting tx.\n      */\n     struct Confirmation {\n-        Status status = UNCONFIRMED;\n-        uint256 hashBlock = uint256();\n-        int nIndex = 0;\n+        Status status;\n+        uint256 hashBlock;\n+        int block_height;\n+        int nIndex;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r343354412",
      "id" : 343354412,
      "in_reply_to_id" : 342837263,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MzM1NDQxMg==",
      "original_commit_id" : "5643cb72ea4fa77b2a08cfc60474d8839cb17485",
      "original_position" : 10,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 312778114,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-06T22:08:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343354412",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "utACK 769ff05",
      "created_at" : "2019-11-06T22:09:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-550523375",
      "id" : 550523375,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1MDUyMzM3NQ==",
      "updated_at" : "2019-11-06T22:09:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/550523375",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jkczyz you've ACKed an intermediate commit (github annoyingly orders commits in date order, not commit order). Did you mean to ACK the final commit in this branch (36b68de5b2938722911db900ca299f7008780d01).",
      "created_at" : "2019-11-06T23:11:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-550543414",
      "id" : 550543414,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1MDU0MzQxNA==",
      "updated_at" : "2019-11-06T23:11:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/550543414",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r343383028"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343383028"
         }
      },
      "author_association" : "MEMBER",
      "body" : "5aacc3eff15b9b5bdc951f1e274f00d581f63bce\r\n\r\n> Yes it has to be before\r\n\r\nCould leave a comment explaining why?\r\n\r\n> Moved it near to m_last_block_processed_height.\r\n\r\nWhy? If there's no reason to change then I'd it keep where it was.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-11-06T23:31:00Z",
      "diff_hunk" : "@@ -1425,6 +1425,7 @@ void CWallet::BlockConnected(const CBlock& block, const std::vector<CTransaction\n     // to abandon a transaction and then have it inadvertently cleared by\n     // the notification that the conflicted transaction was evicted.\n \n+    m_last_block_processed_height = height;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r343383028",
      "id" : 343383028,
      "in_reply_to_id" : 315294228,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MzM4MzAyOA==",
      "original_commit_id" : "b75a18f8a3f54049a7daf18e85adaec2da0801ad",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : 210,
      "pull_request_review_id" : 312833449,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-07T00:25:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343383028",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r343384187"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343384187"
         }
      },
      "author_association" : "MEMBER",
      "body" : "5aacc3eff15b9b5bdc951f1e274f00d581f63bce\r\n\r\nnit, use default member initialize `{-1}` instead of `= -1`.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-11-06T23:35:07Z",
      "diff_hunk" : "@@ -833,6 +845,12 @@ class CWallet final : public FillableSigningProvider, private interfaces::Chain:\n     //! Fetches a key from the keypool\n     bool GetKeyFromPool(CPubKey &key, bool internal = false);\n \n+    /* Height of last block processed is used by wallet to know depth of transactions\n+     * without relying on Chain interface beyond asynchronous updates. For safety, we\n+     * initialize it to -1.\n+     */\n+    int m_last_block_processed_height GUARDED_BY(cs_wallet) = -1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r343384187",
      "id" : 343384187,
      "in_reply_to_id" : 312547306,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MzM4NDE4Nw==",
      "original_commit_id" : "0233a55a71b9ade7e65d26ef6ce718a761e4389b",
      "original_position" : 113,
      "path" : "src/wallet/wallet.h",
      "position" : 150,
      "pull_request_review_id" : 312833449,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-07T00:25:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343384187",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r343385419"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343385419"
         }
      },
      "author_association" : "MEMBER",
      "body" : "5aacc3eff15b9b5bdc951f1e274f00d581f63bce\r\n\r\nUse `const uint256& block_hash`?",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-11-06T23:39:16Z",
      "diff_hunk" : "@@ -1129,6 +1135,21 @@ class CWallet final : public WalletStorage, private interfaces::Chain::Notificat\n     LegacyScriptPubKeyMan::WatchKeyMap& mapWatchKeys GUARDED_BY(cs_KeyStore) = m_spk_man->mapWatchKeys;\n     WalletBatch*& encrypted_batch GUARDED_BY(cs_wallet) = m_spk_man->encrypted_batch;\n     using CryptedKeyMap = LegacyScriptPubKeyMan::CryptedKeyMap;\n+\n+    /** Get last block processed height */\n+    int GetLastBlockHeight() const EXCLUSIVE_LOCKS_REQUIRED(cs_wallet)\n+    {\n+        AssertLockHeld(cs_wallet);\n+        assert(m_last_block_processed_height >= 0);\n+        return m_last_block_processed_height;\n+    };\n+    /** Set last block processed height, currently only use in unit test */\n+    void SetLastBlockProcessed(int block_height, uint256 block_hash) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r343385419",
      "id" : 343385419,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MzM4NTQxOQ==",
      "original_commit_id" : "5aacc3eff15b9b5bdc951f1e274f00d581f63bce",
      "original_position" : 35,
      "path" : "src/wallet/wallet.h",
      "position" : 206,
      "pull_request_review_id" : 312833449,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-07T00:25:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343385419",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r343386868"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343386868"
         }
      },
      "author_association" : "MEMBER",
      "body" : "5aacc3eff15b9b5bdc951f1e274f00d581f63bce\r\n\r\nWhy not just lock `::cs_main` if you don't even use the interface?",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-11-06T23:44:38Z",
      "diff_hunk" : "@@ -139,10 +139,12 @@ void TestGUI(interfaces::Node& node)\n     wallet->LoadWallet(firstRun);\n     {\n         auto spk_man = wallet->GetLegacyScriptPubKeyMan();\n+        auto locked_chain = wallet->chain().lock();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r343386868",
      "id" : 343386868,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MzM4Njg2OA==",
      "original_commit_id" : "5aacc3eff15b9b5bdc951f1e274f00d581f63bce",
      "original_position" : 4,
      "path" : "src/qt/test/wallettests.cpp",
      "position" : 4,
      "pull_request_review_id" : 312833449,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-07T00:25:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343386868",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r343387639"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343387639"
         }
      },
      "author_association" : "MEMBER",
      "body" : "10b4729e33f76092bd8cfa06d1a5e0a066436f76\r\n\r\nnit, just `pindex`? Otherwise use snake case. Same in the header.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-11-06T23:47:24Z",
      "diff_hunk" : "@@ -185,7 +185,7 @@ void CZMQNotificationInterface::BlockConnected(const std::shared_ptr<const CBloc\n     }\n }\n \n-void CZMQNotificationInterface::BlockDisconnected(const std::shared_ptr<const CBlock>& pblock)\n+void CZMQNotificationInterface::BlockDisconnected(const std::shared_ptr<const CBlock>& pblock, const CBlockIndex* pindexDisconnected)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r343387639",
      "id" : 343387639,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MzM4NzYzOQ==",
      "original_commit_id" : "10b4729e33f76092bd8cfa06d1a5e0a066436f76",
      "original_position" : 5,
      "path" : "src/zmq/zmqnotificationinterface.cpp",
      "position" : 5,
      "pull_request_review_id" : 312833449,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-07T00:25:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343387639",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r343390851"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343390851"
         }
      },
      "author_association" : "MEMBER",
      "body" : "9700fcb47feca9d78e005b8d18b41148c8f6b25f\r\n\r\nYou can also drop `Confirmation` constructor and do\r\n```cpp\r\nwtx.m_confirm = {CWalletTx::Status::CONFIRMED, merkleBlock.header.GetHash(), int(txnIndex)};\r\n```\r\nand\r\n```cpp\r\n    SyncTransaction(ptx, {CWalletTx::Status::UNCONFIRMED, /* hash = */ {}, /* index = */ 0);\r\n```",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-11-06T23:59:56Z",
      "diff_hunk" : "@@ -383,7 +383,8 @@ UniValue importprunedfunds(const JSONRPCRequest& request)\n         throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Something wrong with merkleblock\");\n     }\n \n-    wtx.SetConf(CWalletTx::Status::CONFIRMED, merkleBlock.header.GetHash(), txnIndex);\n+    CWalletTx::Confirmation confirm(CWalletTx::Status::CONFIRMED, merkleBlock.header.GetHash(), txnIndex);\n+    wtx.m_confirm = confirm;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r343390851",
      "id" : 343390851,
      "in_reply_to_id" : 338791804,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MzM5MDg1MQ==",
      "original_commit_id" : "d0c4ce686ba388b9fefff2b153358e33a042ee80",
      "original_position" : 6,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 312833449,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-07T00:25:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343390851",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> @jkczyz you've ACKed an intermediate commit (github annoyingly orders commits in date order, not commit order). Did you mean to ACK the final commit in this branch ([36b68de](https://github.com/bitcoin/bitcoin/commit/36b68de5b2938722911db900ca299f7008780d01)).\r\n\r\nutACK 36b68de\r\n\r\nRight! The PR interface was showing a different order from the branch.",
      "created_at" : "2019-11-07T00:11:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-550559554",
      "id" : 550559554,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1MDU1OTU1NA==",
      "updated_at" : "2019-11-07T00:11:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/550559554",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r343395865"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343395865"
         }
      },
      "author_association" : "MEMBER",
      "body" : "0ff03871add000f8b4d8f82aeb168eed2fc9dc5f\r\n\r\nI don't think commit message is correct:\r\n```\r\nAvoid to lock chain to query state thanks to tracking last block\r\nheight in CWallet.\r\n```\r\nShould say something like?\r\n```\r\nUse wallet's last block height instead of the locked chain, which\r\nwill allow removing the chain lock.\r\n```",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-11-07T00:19:14Z",
      "diff_hunk" : "@@ -3936,9 +3936,11 @@ CKeyPool::CKeyPool(const CPubKey& vchPubKeyIn, bool internalIn)\n \n int CWalletTx::GetDepthInMainChain(interfaces::Chain::Lock& locked_chain) const\n {\n+    assert(pwallet != nullptr);\n+    AssertLockHeld(pwallet->cs_wallet);\n     if (isUnconfirmed() || isAbandoned()) return 0;\n \n-    return locked_chain.getBlockDepth(m_confirm.hashBlock) * (isConflicted() ? -1 : 1);\n+    return (pwallet->GetLastBlockHeight() - m_confirm.block_height + 1) * (isConflicted() ? -1 : 1);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r343395865",
      "id" : 343395865,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MzM5NTg2NQ==",
      "original_commit_id" : "0ff03871add000f8b4d8f82aeb168eed2fc9dc5f",
      "original_position" : 9,
      "path" : "src/wallet/wallet.cpp",
      "position" : 514,
      "pull_request_review_id" : 312833449,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-07T00:25:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343395865",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r343396904"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343396904"
         }
      },
      "author_association" : "MEMBER",
      "body" : "36b68de5b2938722911db900ca299f7008780d01\r\n\r\nWhat's the problem with `-(m_last_block_processed_height - conflicting_height + 1)`?",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-11-07T00:23:13Z",
      "diff_hunk" : "@@ -986,7 +986,7 @@ void CWallet::MarkConflicted(const uint256& hashBlock, int conflicting_height, c\n     auto locked_chain = chain().lock();\n     LOCK(cs_wallet);\n \n-    int conflictconfirms = -locked_chain->getBlockDepth(hashBlock);\n+    int conflictconfirms = (m_last_block_processed_height - conflicting_height + 1) * -1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r343396904",
      "id" : 343396904,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MzM5NjkwNA==",
      "original_commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "original_position" : 5,
      "path" : "src/wallet/wallet.cpp",
      "position" : 155,
      "pull_request_review_id" : 312833449,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-07T00:25:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343396904",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r343752221"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343752221"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Method `chain` here is the way to use the `interfaces::chain`, I think it doesn't matter that much here to use the `Node` or `Chain` one.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-11-07T16:37:24Z",
      "diff_hunk" : "@@ -139,10 +139,12 @@ void TestGUI(interfaces::Node& node)\n     wallet->LoadWallet(firstRun);\n     {\n         auto spk_man = wallet->GetLegacyScriptPubKeyMan();\n+        auto locked_chain = wallet->chain().lock();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r343752221",
      "id" : 343752221,
      "in_reply_to_id" : 343386868,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0Mzc1MjIyMQ==",
      "original_commit_id" : "5aacc3eff15b9b5bdc951f1e274f00d581f63bce",
      "original_position" : 4,
      "path" : "src/qt/test/wallettests.cpp",
      "position" : 4,
      "pull_request_review_id" : 313475613,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-07T16:37:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343752221",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r343753048"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343753048"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "That's a better wording, I will use it if I have to rebase.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2019-11-07T16:38:53Z",
      "diff_hunk" : "@@ -3936,9 +3936,11 @@ CKeyPool::CKeyPool(const CPubKey& vchPubKeyIn, bool internalIn)\n \n int CWalletTx::GetDepthInMainChain(interfaces::Chain::Lock& locked_chain) const\n {\n+    assert(pwallet != nullptr);\n+    AssertLockHeld(pwallet->cs_wallet);\n     if (isUnconfirmed() || isAbandoned()) return 0;\n \n-    return locked_chain.getBlockDepth(m_confirm.hashBlock) * (isConflicted() ? -1 : 1);\n+    return (pwallet->GetLastBlockHeight() - m_confirm.block_height + 1) * (isConflicted() ? -1 : 1);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r343753048",
      "id" : 343753048,
      "in_reply_to_id" : 343395865,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0Mzc1MzA0OA==",
      "original_commit_id" : "0ff03871add000f8b4d8f82aeb168eed2fc9dc5f",
      "original_position" : 9,
      "path" : "src/wallet/wallet.cpp",
      "position" : 514,
      "pull_request_review_id" : 313476682,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2019-11-07T16:38:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343753048",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Can someome relaunch AppVeyor ? It got a linker error on bech32_tests.obj",
      "created_at" : "2019-11-07T16:43:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-551162795",
      "id" : 551162795,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1MTE2Mjc5NQ==",
      "updated_at" : "2019-11-07T16:43:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/551162795",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Can someome relaunch AppVeyor ? It got a linker error on bech32_tests.obj\r\n\r\nAppveyor is an unrelated pending issue from https://github.com/bitcoin/bitcoin/pull/17357 affecting all other PRs that iiuc should be fixed by https://github.com/bitcoin/bitcoin/pull/17384.",
      "created_at" : "2019-11-07T16:50:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-551165891",
      "id" : 551165891,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1MTE2NTg5MQ==",
      "updated_at" : "2019-11-07T16:51:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/551165891",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Looks good, thanks for keeping this maintained ariard. I agree with most of promag's comments but they aren't worth holding up merge for.\r\n\r\nutACK 36b68de5b2938722911db900ca299f7008780d01\r\n\r\n",
      "created_at" : "2019-11-08T10:20:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-551524362",
      "id" : 551524362,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1MTUyNDM2Mg==",
      "updated_at" : "2019-11-08T10:20:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/551524362",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/meshcollider/followers",
         "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/meshcollider",
         "id" : 3211283,
         "login" : "meshcollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
         "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
         "repos_url" : "https://api.github.com/users/meshcollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/meshcollider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "It looks like this might have sped up all WalletBalance micro benchmarks:\r\n\r\nhttps://codespeed.bitcoinperf.com/timeline/?exe=3%2C4%2C2%2C1%2C5&base=1%2B23&ben=micro.clang.WalletBalanceDirty&env=1&revs=10&equid=off&quarts=on&extr=on",
      "created_at" : "2019-11-12T23:07:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-553159016",
      "id" : 553159016,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1MzE1OTAxNg==",
      "updated_at" : "2019-11-12T23:07:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/553159016",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "It appears like @MarcoFalke's link always displays the last 10 days, which already don't include the performance gains (which happened on Nov 8). I couldn't find a way to link to a specific date range in codespeed, so for future reference for people bumping into this thread, here's [a screenshot](https://user-images.githubusercontent.com/877904/69193689-fdf0b300-0b2f-11ea-9d1d-5ab40ef5cf00.png) instead (of the last 50 days).\r\n",
      "created_at" : "2019-11-19T22:56:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#issuecomment-555754713",
      "id" : 555754713,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15931",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1NTc1NDcxMw==",
      "updated_at" : "2019-11-19T22:56:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/555754713",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/877904?v=4",
         "events_url" : "https://api.github.com/users/shesek/events{/privacy}",
         "followers_url" : "https://api.github.com/users/shesek/followers",
         "following_url" : "https://api.github.com/users/shesek/following{/other_user}",
         "gists_url" : "https://api.github.com/users/shesek/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/shesek",
         "id" : 877904,
         "login" : "shesek",
         "node_id" : "MDQ6VXNlcjg3NzkwNA==",
         "organizations_url" : "https://api.github.com/users/shesek/orgs",
         "received_events_url" : "https://api.github.com/users/shesek/received_events",
         "repos_url" : "https://api.github.com/users/shesek/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/shesek/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/shesek/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/shesek"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r371512762"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/371512762"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Use CWallet::m_last_block_processed_height in GetDepthInMainChain\" (0ff03871add000f8b4d8f82aeb168eed2fc9dc5f)\r\n\r\n@ariard It seems like this line is written assuming that `GetLastBlockHeight()` is always `>= m_confirm.block_height`, but if I add asserts here:\r\n\r\n```c++\r\nassert(m_confirm.block_height >= 0);\r\nassert(m_confirm.block_height <= pwallet->GetLastBlockHeight());\r\n```\r\n\r\nThe second assert fails in `wallet_abandonconflict.py` and `wallet_bumpfee.py` tests. Wondering if this expected or seems like a bug to you",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2020-01-27T22:14:22Z",
      "diff_hunk" : "@@ -3936,9 +3936,11 @@ CKeyPool::CKeyPool(const CPubKey& vchPubKeyIn, bool internalIn)\n \n int CWalletTx::GetDepthInMainChain(interfaces::Chain::Lock& locked_chain) const\n {\n+    assert(pwallet != nullptr);\n+    AssertLockHeld(pwallet->cs_wallet);\n     if (isUnconfirmed() || isAbandoned()) return 0;\n \n-    return locked_chain.getBlockDepth(m_confirm.hashBlock) * (isConflicted() ? -1 : 1);\n+    return (pwallet->GetLastBlockHeight() - m_confirm.block_height + 1) * (isConflicted() ? -1 : 1);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r371512762",
      "id" : 371512762,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTUxMjc2Mg==",
      "original_commit_id" : "0ff03871add000f8b4d8f82aeb168eed2fc9dc5f",
      "original_position" : 9,
      "path" : "src/wallet/wallet.cpp",
      "position" : 514,
      "pull_request_review_id" : 349013338,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "updated_at" : "2020-01-27T22:14:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/371512762",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r554147619"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/554147619"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Use CWallet::m_last_block_processed_height in GetDepthInMainChain\" ([0ff0387](https://github.com/bitcoin/bitcoin/commit/0ff03871add000f8b4d8f82aeb168eed2fc9dc5f))\r\n\r\nDropping the `getBlockDepth` call here introduces a bug because `getBlockDepth` had a safety check to return 0 if there was a reorg and hashBlock is no longer in the active chain, while the new code will just return a garbage depth. I think this is also the reason adding height asserts didn't work in some tests: https://github.com/bitcoin/bitcoin/pull/15931#discussion_r371512762. A few fixes are possible and mentioned [*bug-reorg-depth*](https://github.com/bitcoin-core/bitcoin-devwiki/wiki/Wallet-Transaction-Conflict-Tracking#bug-reorg-depth). A fix shouldn't be hard, but a bigger challenge is adding better test coverage to prevent more bugs like this.",
      "commit_id" : "36b68de5b2938722911db900ca299f7008780d01",
      "created_at" : "2021-01-08T19:30:07Z",
      "diff_hunk" : "@@ -3936,9 +3936,11 @@ CKeyPool::CKeyPool(const CPubKey& vchPubKeyIn, bool internalIn)\n \n int CWalletTx::GetDepthInMainChain(interfaces::Chain::Lock& locked_chain) const\n {\n+    assert(pwallet != nullptr);\n+    AssertLockHeld(pwallet->cs_wallet);\n     if (isUnconfirmed() || isAbandoned()) return 0;\n \n-    return locked_chain.getBlockDepth(m_confirm.hashBlock) * (isConflicted() ? -1 : 1);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15931#discussion_r554147619",
      "id" : 554147619,
      "line" : 3931,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDE0NzYxOQ==",
      "original_commit_id" : "0ff03871add000f8b4d8f82aeb168eed2fc9dc5f",
      "original_line" : 3941,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 513,
      "pull_request_review_id" : 564524921,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15931",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-08T19:37:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/554147619",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   }
]
