[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r281782731"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/281782731"
         }
      },
      "author_association" : "MEMBER",
      "body" : "style-nit: Why shuffle the includes for no reason?",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-07T18:53:19Z",
      "diff_hunk" : "@@ -34,7 +35,6 @@\n #include <timedata.h>\n #include <tinyformat.h>\n #include <txdb.h>\n-#include <txmempool.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r281782731",
      "id" : 281782731,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4MTc4MjczMQ==",
      "original_commit_id" : "0f7a07c4a455be9bfe6197ae4fc3b5edaba7e277",
      "original_position" : 12,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 234700228,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-16T13:07:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/281782731",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r281783295"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/281783295"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oops, will fix.",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-07T18:54:52Z",
      "diff_hunk" : "@@ -34,7 +35,6 @@\n #include <timedata.h>\n #include <tinyformat.h>\n #include <txdb.h>\n-#include <txmempool.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r281783295",
      "id" : 281783295,
      "in_reply_to_id" : 281782731,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4MTc4MzI5NQ==",
      "original_commit_id" : "0f7a07c4a455be9bfe6197ae4fc3b5edaba7e277",
      "original_position" : 12,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 234701028,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-16T13:07:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/281783295",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#16092](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16092.html) (Don't use global (external) symbols for symbols that are used in only one translation unit by practicalswift)\n* [#15981](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15981.html) (Use __func__ for log messages by Bushstar)\n* [#15921](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15921.html) (Tidy up ValidationState interface by jnewbery)\n* [#15759](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15759.html) ([p2p] Add 2 outbound blocks-only connections by sdaftuar)\n* [#15192](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15192.html) (Add missing cs_main locks in ThreadImport(...)/Shutdown(...)/gettxoutsetinfo(...)/InitScriptExecutionCache(). Add missing locking annotations. by practicalswift)\n* [#15191](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15191.html) (validation: Add missing cs_{LastBlockFile,nBlockSequenceId} locks in PruneAndFlush() and UnloadBlockIndex(). Add missing locking annotations. by practicalswift)\n* [#14856](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14856.html) (net: remove more CConnman globals (theuni) by dongcarl)\n* [#14193](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14193.html) (validation: Add missing mempool locks by MarcoFalke)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-05-07T22:50:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#issuecomment-490282681",
      "id" : 490282681,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15976",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5MDI4MjY4MQ==",
      "updated_at" : "2019-05-28T07:26:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/490282681",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r282111893"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/282111893"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Does this implementation really need to be in the header?",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-08T15:09:48Z",
      "diff_hunk" : "@@ -422,6 +422,195 @@ inline CBlockIndex* LookupBlockIndex(const uint256& hash)\n /** Find the last common block between the parameter chain and a locator. */\n CBlockIndex* FindForkInGlobalIndex(const CChain& chain, const CBlockLocator& locator) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+enum DisconnectResult\n+{\n+    DISCONNECT_OK,      // All good.\n+    DISCONNECT_UNCLEAN, // Rolled back, but UTXO set was inconsistent with block.\n+    DISCONNECT_FAILED   // Something else went wrong.\n+};\n+\n+class ConnectTrace;\n+\n+/** @see CChainState::FlushStateToDisk */\n+enum class FlushStateMode {\n+    NONE,\n+    IF_NEEDED,\n+    PERIODIC,\n+    ALWAYS\n+};\n+\n+struct CBlockIndexWorkComparator\n+{\n+    bool operator()(const CBlockIndex *pa, const CBlockIndex *pb) const {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r282111893",
      "id" : 282111893,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4MjExMTg5Mw==",
      "original_commit_id" : "65e22684281996ee49889642c745143e99736ae2",
      "original_position" : 60,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 235115884,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-16T13:07:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/282111893",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I dislike that member functions that previously could (and should) only be called in the validation module are now callable from anywhere. To make it worse, they are easily confused e.g. `::ActivateBestChain` vs `CChainState::ActivateBestChain`. The only solution I could think of is to mark the public methods that are not supposed to be called outside of validation with an underscore or something (similar to python).",
      "created_at" : "2019-05-08T16:30:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#issuecomment-490557315",
      "id" : 490557315,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15976",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5MDU1NzMxNQ==",
      "updated_at" : "2019-05-08T16:30:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/490557315",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "An alternative could be to remove the global methods (e.g. `::ActivateBestChain`) and inline them into the members?",
      "created_at" : "2019-05-08T16:36:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#issuecomment-490559432",
      "id" : 490559432,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15976",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5MDU1OTQzMg==",
      "updated_at" : "2019-05-08T16:36:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/490559432",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r282162424"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/282162424"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The method implementation doesn't, but the struct declaration does because it affects the layout of CChainState objects.",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-08T17:11:53Z",
      "diff_hunk" : "@@ -422,6 +422,195 @@ inline CBlockIndex* LookupBlockIndex(const uint256& hash)\n /** Find the last common block between the parameter chain and a locator. */\n CBlockIndex* FindForkInGlobalIndex(const CChain& chain, const CBlockLocator& locator) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+enum DisconnectResult\n+{\n+    DISCONNECT_OK,      // All good.\n+    DISCONNECT_UNCLEAN, // Rolled back, but UTXO set was inconsistent with block.\n+    DISCONNECT_FAILED   // Something else went wrong.\n+};\n+\n+class ConnectTrace;\n+\n+/** @see CChainState::FlushStateToDisk */\n+enum class FlushStateMode {\n+    NONE,\n+    IF_NEEDED,\n+    PERIODIC,\n+    ALWAYS\n+};\n+\n+struct CBlockIndexWorkComparator\n+{\n+    bool operator()(const CBlockIndex *pa, const CBlockIndex *pb) const {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r282162424",
      "id" : 282162424,
      "in_reply_to_id" : 282111893,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4MjE2MjQyNA==",
      "original_commit_id" : "65e22684281996ee49889642c745143e99736ae2",
      "original_position" : 60,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 235180228,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-16T13:07:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/282162424",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> could (and should) only be called in the validation module are now callable from anywhere\r\n\r\nWould you say the root cause of that is that ::ChainstateActive is global? Maybe we can make that only available through interfaces? There's not that many places we access member functions from.",
      "created_at" : "2019-05-08T17:15:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#issuecomment-490572428",
      "id" : 490572428,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15976",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5MDU3MjQyOA==",
      "updated_at" : "2019-05-08T17:15:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/490572428",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Would you say the root cause of that is that ::ChainstateActive is global?\r\n\r\nAlso, `chainActive`, `mapBlockIndex`, .... I fail to see how an interface could help here. Shouldn't `CChainState` be the interface?",
      "created_at" : "2019-05-08T17:26:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#issuecomment-490576375",
      "id" : 490576375,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15976",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5MDU3NjM3NQ==",
      "updated_at" : "2019-05-08T17:26:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/490576375",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> An alternative could be to remove the global methods (e.g. ::ActivateBestChain) and inline them into the members?\r\n\r\nI like this idea but left it on the table in the interest of minimizing the diff.\r\n\r\nIn general, my preference would be to have anything outside of validation deal with the CChainState interface (`::ChainstateActive()` or other instances), and have anything only to be used by validation in a static function outside of the header file. I didn't initially do this (to keep the diff small), but I'm happy to add commits if that seems preferable.",
      "created_at" : "2019-05-08T17:43:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#issuecomment-490582434",
      "id" : 490582434,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15976",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5MDU4MjQzNA==",
      "updated_at" : "2019-05-08T17:43:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/490582434",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-05-08T21:06:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#issuecomment-490499616",
      "id" : 490499616,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15976",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5MDQ5OTYxNg==",
      "updated_at" : "2019-05-08T21:06:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/490499616",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r283475344"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/283475344"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit de39209d0c move-only: make the CChainState interface public\r\n\r\nCould keep this implementation in the cpp file? Only put the struct and declaration in the header?\r\n\r\nAlso, the commit description mentions a \"namespace\", which is no longer true, so should be removed?",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-13T18:23:45Z",
      "diff_hunk" : "@@ -422,6 +422,195 @@ inline CBlockIndex* LookupBlockIndex(const uint256& hash)\n /** Find the last common block between the parameter chain and a locator. */\n CBlockIndex* FindForkInGlobalIndex(const CChain& chain, const CBlockLocator& locator) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+enum DisconnectResult\n+{\n+    DISCONNECT_OK,      // All good.\n+    DISCONNECT_UNCLEAN, // Rolled back, but UTXO set was inconsistent with block.\n+    DISCONNECT_FAILED   // Something else went wrong.\n+};\n+\n+class ConnectTrace;\n+\n+/** @see CChainState::FlushStateToDisk */\n+enum class FlushStateMode {\n+    NONE,\n+    IF_NEEDED,\n+    PERIODIC,\n+    ALWAYS\n+};\n+\n+struct CBlockIndexWorkComparator\n+{\n+    bool operator()(const CBlockIndex *pa, const CBlockIndex *pb) const {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r283475344",
      "id" : 283475344,
      "in_reply_to_id" : 282111893,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4MzQ3NTM0NA==",
      "original_commit_id" : "65e22684281996ee49889642c745143e99736ae2",
      "original_position" : 60,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 236841987,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-16T13:07:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/283475344",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r283479959"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/283479959"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit 9147f28ec0 refactoring: FlushStateToDisk -> CChainState\r\n\r\n\r\nIt seems weird to move a method that was `static` in validation.cpp to the header file as a public member function. At the very least it should be private. (However, I'd prefer if in the same commit the `FlushStateToDisk` and `PruneAndFlush` were moved to a public method in CChainState.)",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-13T18:34:51Z",
      "diff_hunk" : "@@ -524,6 +533,21 @@ class CChainState {\n \n     bool LoadBlockIndex(const Consensus::Params& consensus_params, CBlockTreeDB& blocktree) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+    /**\n+     * Update the on-disk chain state.\n+     * The caches and indexes are flushed depending on the mode we're called with\n+     * if they're too large, if it's been a while since the last write,\n+     * or always and in all cases if we're in prune mode and are deleting files.\n+     *\n+     * If FlushStateMode::NONE is used, then FlushStateToDisk(...) won't do anything\n+     * besides checking if we need to prune.\n+     */\n+    bool FlushStateToDisk(",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r283479959",
      "id" : 283479959,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4MzQ3OTk1OQ==",
      "original_commit_id" : "9147f28ec03181d69fe46aa81dbe82086b2c684d",
      "original_position" : 48,
      "path" : "src/validation.h",
      "position" : 150,
      "pull_request_review_id" : 236841987,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-16T13:07:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/283479959",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r283481731"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/283481731"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit 61fd34e244  refactoring: IsInitialBlockDownload -> CChainState\r\n\r\n\r\nInstead of a question, say \"Whether this c...\"?",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-13T18:39:46Z",
      "diff_hunk" : "@@ -523,6 +521,14 @@ class CChainState {\n      */\n     CCriticalSection m_cs_chainstate;\n \n+    /**\n+     * Is this chainstate undergoing initial block download?",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r283481731",
      "id" : 283481731,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4MzQ4MTczMQ==",
      "original_commit_id" : "61fd34e24400b4cee07a379630331f37d2847588",
      "original_position" : 14,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 236841987,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-16T13:07:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/283481731",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r283481944"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/283481944"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit 61fd34e refactoring: IsInitialBlockDownload -> CChainState\r\n\r\nThis is only toggled once (aka latched)? So should keep that nomenclature? ",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-13T18:40:24Z",
      "diff_hunk" : "@@ -523,6 +521,14 @@ class CChainState {\n      */\n     CCriticalSection m_cs_chainstate;\n \n+    /**\n+     * Is this chainstate undergoing initial block download?\n+     *\n+     * Mutable because we need to be able to mark IsInitialBlockDownload()\n+     * const, which toggles this for caching purposes.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r283481944",
      "id" : 283481944,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4MzQ4MTk0NA==",
      "original_commit_id" : "61fd34e24400b4cee07a379630331f37d2847588",
      "original_position" : 17,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 236841987,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-16T13:07:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/283481944",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284016299"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284016299"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Is there any particular reason why  `FlushStateToDisk` `PruneAndFlush` should not be ChainState members and `FlushStateToDisk` `IsInitialBlockDownload` should be? Curious how your comment in https://github.com/bitcoin/bitcoin/pull/15976#issuecomment-490582434 applies to these individual cases. Not that it really matters, but it'd be nice to have consistency, and maybe explicit rationale for why things are or aren't members in the commit messages.",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-14T21:55:01Z",
      "diff_hunk" : "@@ -278,9 +279,9 @@ void PruneOneBlockFile(const int fileNumber) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n void UnlinkPrunedFiles(const std::set<int>& setFilesToPrune);\n \n /** Flush all state, indexes and buffers to disk. */\n-void FlushStateToDisk();\n+void FlushStateToDisk(CChainState& chainstate);\n /** Prune block files and flush state to disk. */\n-void PruneAndFlush();\n+void PruneAndFlush(CChainState& chainstate);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284016299",
      "id" : 284016299,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDAxNjI5OQ==",
      "original_commit_id" : "9147f28ec03181d69fe46aa81dbe82086b2c684d",
      "original_position" : 16,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 237522242,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-16T13:07:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284016299",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284070760"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284070760"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No good reason beyond the fact that `FlushStateToDisk` affects on-disk block files (which are shared across chainstates) - but that's a symptom of a more general issue (that FSTD handles pruning, which seems like a separate concern) so probably not worth worrying about here.\r\n\r\n",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-15T02:55:50Z",
      "diff_hunk" : "@@ -278,9 +279,9 @@ void PruneOneBlockFile(const int fileNumber) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n void UnlinkPrunedFiles(const std::set<int>& setFilesToPrune);\n \n /** Flush all state, indexes and buffers to disk. */\n-void FlushStateToDisk();\n+void FlushStateToDisk(CChainState& chainstate);\n /** Prune block files and flush state to disk. */\n-void PruneAndFlush();\n+void PruneAndFlush(CChainState& chainstate);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284070760",
      "id" : 284070760,
      "in_reply_to_id" : 284016299,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDA3MDc2MA==",
      "original_commit_id" : "9147f28ec03181d69fe46aa81dbe82086b2c684d",
      "original_position" : 16,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 237588704,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-16T13:07:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284070760",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284071249"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284071249"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Agree with your general concern, but usage of `FlushStateToDisk` happens in places that won't work with `private` like `AcceptToMemoryPoolWithTime` and so if we made it private, we'd have to attach a bunch of `friend` statements which seems kind of gross.",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-15T02:58:41Z",
      "diff_hunk" : "@@ -524,6 +533,21 @@ class CChainState {\n \n     bool LoadBlockIndex(const Consensus::Params& consensus_params, CBlockTreeDB& blocktree) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+    /**\n+     * Update the on-disk chain state.\n+     * The caches and indexes are flushed depending on the mode we're called with\n+     * if they're too large, if it's been a while since the last write,\n+     * or always and in all cases if we're in prune mode and are deleting files.\n+     *\n+     * If FlushStateMode::NONE is used, then FlushStateToDisk(...) won't do anything\n+     * besides checking if we need to prune.\n+     */\n+    bool FlushStateToDisk(",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284071249",
      "id" : 284071249,
      "in_reply_to_id" : 283479959,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDA3MTI0OQ==",
      "original_commit_id" : "9147f28ec03181d69fe46aa81dbe82086b2c684d",
      "original_position" : 48,
      "path" : "src/validation.h",
      "position" : 150,
      "pull_request_review_id" : 237589247,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-16T13:07:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284071249",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the good feedback @Sjors @MarcoFalke @ryanofsky. I agree with the comments so far and have incorporated all of them aside from those noted above. Initially I hadn't touched the global `Flush` functions because I thought it'd create an unnecessarily large diff, but it turns out that it's negligible.\r\n\r\nI took the liberty of renaming the global function equivalents for clarity, and in the process I did notice something sort of interesting. `PruneAndFlush()` doesn't seem to actually do any flushing, just pruning, and so I'm calling it `PruneBlockFiles()` accordingly. This might be worth more general investigation because other parts of the code seem to assume that call flushes chainstate (which doesn't seem correct).",
      "created_at" : "2019-05-15T03:04:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#issuecomment-492485689",
      "id" : 492485689,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15976",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5MjQ4NTY4OQ==",
      "updated_at" : "2019-05-15T03:04:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/492485689",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284220451"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284220451"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Hmm, makes sense",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-15T12:04:53Z",
      "diff_hunk" : "@@ -524,6 +533,21 @@ class CChainState {\n \n     bool LoadBlockIndex(const Consensus::Params& consensus_params, CBlockTreeDB& blocktree) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+    /**\n+     * Update the on-disk chain state.\n+     * The caches and indexes are flushed depending on the mode we're called with\n+     * if they're too large, if it's been a while since the last write,\n+     * or always and in all cases if we're in prune mode and are deleting files.\n+     *\n+     * If FlushStateMode::NONE is used, then FlushStateToDisk(...) won't do anything\n+     * besides checking if we need to prune.\n+     */\n+    bool FlushStateToDisk(",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284220451",
      "id" : 284220451,
      "in_reply_to_id" : 283479959,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDIyMDQ1MQ==",
      "original_commit_id" : "9147f28ec03181d69fe46aa81dbe82086b2c684d",
      "original_position" : 48,
      "path" : "src/validation.h",
      "position" : 150,
      "pull_request_review_id" : 237776265,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-16T13:07:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284220451",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284223105"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284223105"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit a8930a66b1 move-only: make the CChainState interface public\r\n\r\n\r\nWhy is this moved to the end of the cpp file instead of keeping it at the top? This breaks both `git blame` and git diff with `--color-moved=dimmed-zebra --ignore-all-space`",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-15T12:12:22Z",
      "diff_hunk" : "@@ -4916,3 +4760,21 @@ class CMainCleanup\n         mapBlockIndex.clear();\n     }\n } instance_of_cmaincleanup;\n+\n+bool CBlockIndexWorkComparator::operator()(const CBlockIndex *pa, const CBlockIndex *pb) const {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284223105",
      "id" : 284223105,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDIyMzEwNQ==",
      "original_commit_id" : "5fe4eb3a1a8ca7da24a451360a7d38c768e12b10",
      "original_position" : 545,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 237779586,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-16T13:07:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284223105",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284224235"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284224235"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n/** @returns the most-work valid chainstate. */\r\n```\r\n\r\nin commit 7794d41a58 refactoring: introduce ChainstateActive()\r\n\r\n\r\nCould clarify that this the chainstate is fully validated (as opposed to a pow header chain)",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-15T12:15:48Z",
      "diff_hunk" : "@@ -435,6 +610,9 @@ bool InvalidateBlock(CValidationState& state, const CChainParams& chainparams, C\n /** Remove invalidity status from a block and its descendants. */\n void ResetBlockFailureFlags(CBlockIndex* pindex) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+/** @returns the most-work chainstate. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284224235",
      "id" : 284224235,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDIyNDIzNQ==",
      "original_commit_id" : "5fe4eb3a1a8ca7da24a451360a7d38c768e12b10",
      "original_position" : 226,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 237779586,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-16T13:07:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284224235",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284226967"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284226967"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit 7ab9e339a8 refactoring: FlushStateToDisk -> CChainState\r\n\r\n\r\nstyle-question: You remove the global with the same name in this commit, so the `this->` is not required?",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-15T12:23:21Z",
      "diff_hunk" : "@@ -2196,27 +2035,31 @@ bool static FlushStateToDisk(const CChainParams& chainparams, CValidationState &\n     }\n     if (full_flush_completed) {\n         // Update best block in wallet (so we can detect restored wallets).\n-        GetMainSignals().ChainStateFlushed(::ChainActive().GetLocator());\n+        GetMainSignals().ChainStateFlushed(m_chain.GetLocator());\n     }\n     } catch (const std::runtime_error& e) {\n         return AbortNode(state, std::string(\"System error while flushing: \") + e.what());\n     }\n     return true;\n }\n \n-void FlushStateToDisk() {\n+void CChainState::ForceFlushStateToDisk() {\n     CValidationState state;\n     const CChainParams& chainparams = Params();\n-    if (!FlushStateToDisk(chainparams, state, FlushStateMode::ALWAYS)) {\n+    if (!this->FlushStateToDisk(chainparams, state, FlushStateMode::ALWAYS)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284226967",
      "id" : 284226967,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDIyNjk2Nw==",
      "original_commit_id" : "5fe4eb3a1a8ca7da24a451360a7d38c768e12b10",
      "original_position" : 313,
      "path" : "src/validation.cpp",
      "position" : 330,
      "pull_request_review_id" : 237779586,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-16T13:07:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284226967",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284229049"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284229049"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit 7ab9e339a8 refactoring: FlushStateToDisk -> CChainState\r\n\r\n\r\nI'd rather not add a comment that starts with \"confusingly\". You renamed the function and removed the confusion.",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-15T12:28:58Z",
      "diff_hunk" : "@@ -2196,27 +2035,31 @@ bool static FlushStateToDisk(const CChainParams& chainparams, CValidationState &\n     }\n     if (full_flush_completed) {\n         // Update best block in wallet (so we can detect restored wallets).\n-        GetMainSignals().ChainStateFlushed(::ChainActive().GetLocator());\n+        GetMainSignals().ChainStateFlushed(m_chain.GetLocator());\n     }\n     } catch (const std::runtime_error& e) {\n         return AbortNode(state, std::string(\"System error while flushing: \") + e.what());\n     }\n     return true;\n }\n \n-void FlushStateToDisk() {\n+void CChainState::ForceFlushStateToDisk() {\n     CValidationState state;\n     const CChainParams& chainparams = Params();\n-    if (!FlushStateToDisk(chainparams, state, FlushStateMode::ALWAYS)) {\n+    if (!this->FlushStateToDisk(chainparams, state, FlushStateMode::ALWAYS)) {\n         LogPrintf(\"%s: failed to flush state (%s)\\n\", __func__, FormatStateMessage(state));\n     }\n }\n \n-void PruneAndFlush() {\n+void CChainState::PruneBlockFiles() {\n     CValidationState state;\n     fCheckForPruning = true;\n     const CChainParams& chainparams = Params();\n-    if (!FlushStateToDisk(chainparams, state, FlushStateMode::NONE)) {\n+\n+    // Confusingly, nothing is actually flushed to disk due to\n+    // FlushStateMode::NONE; the only effect of this call is to prune\n+    // block files if necessary.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284229049",
      "id" : 284229049,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDIyOTA0OQ==",
      "original_commit_id" : "5fe4eb3a1a8ca7da24a451360a7d38c768e12b10",
      "original_position" : 327,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 237779586,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-16T13:07:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284229049",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284264160"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284264160"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I like prefixing with `this->` for methods because it makes it obvious we're calling a method, sort of like `m_`. See the IRC discussion: http://www.erisian.com.au/bitcoin-core-dev/log-2019-05-06.html#l-572\r\n\r\nHappy to undo it if it's controversial though.",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-15T13:48:32Z",
      "diff_hunk" : "@@ -2196,27 +2035,31 @@ bool static FlushStateToDisk(const CChainParams& chainparams, CValidationState &\n     }\n     if (full_flush_completed) {\n         // Update best block in wallet (so we can detect restored wallets).\n-        GetMainSignals().ChainStateFlushed(::ChainActive().GetLocator());\n+        GetMainSignals().ChainStateFlushed(m_chain.GetLocator());\n     }\n     } catch (const std::runtime_error& e) {\n         return AbortNode(state, std::string(\"System error while flushing: \") + e.what());\n     }\n     return true;\n }\n \n-void FlushStateToDisk() {\n+void CChainState::ForceFlushStateToDisk() {\n     CValidationState state;\n     const CChainParams& chainparams = Params();\n-    if (!FlushStateToDisk(chainparams, state, FlushStateMode::ALWAYS)) {\n+    if (!this->FlushStateToDisk(chainparams, state, FlushStateMode::ALWAYS)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284264160",
      "id" : 284264160,
      "in_reply_to_id" : 284226967,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDI2NDE2MA==",
      "original_commit_id" : "5fe4eb3a1a8ca7da24a451360a7d38c768e12b10",
      "original_position" : 313,
      "path" : "src/validation.cpp",
      "position" : 330,
      "pull_request_review_id" : 237832831,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-16T13:07:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284264160",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284266146"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284266146"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It'd be in an awkward place at the top of the file - right below the \"global state\" comment. Happy to move it back if you think the diff convenience is worth it though.",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-15T13:52:23Z",
      "diff_hunk" : "@@ -4916,3 +4760,21 @@ class CMainCleanup\n         mapBlockIndex.clear();\n     }\n } instance_of_cmaincleanup;\n+\n+bool CBlockIndexWorkComparator::operator()(const CBlockIndex *pa, const CBlockIndex *pb) const {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284266146",
      "id" : 284266146,
      "in_reply_to_id" : 284223105,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDI2NjE0Ng==",
      "original_commit_id" : "5fe4eb3a1a8ca7da24a451360a7d38c768e12b10",
      "original_position" : 545,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 237835367,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-16T13:07:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284266146",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284266408"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284266408"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah good point! Thanks.",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-15T13:52:54Z",
      "diff_hunk" : "@@ -435,6 +610,9 @@ bool InvalidateBlock(CValidationState& state, const CChainParams& chainparams, C\n /** Remove invalidity status from a block and its descendants. */\n void ResetBlockFailureFlags(CBlockIndex* pindex) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+/** @returns the most-work chainstate. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284266408",
      "id" : 284266408,
      "in_reply_to_id" : 284224235,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDI2NjQwOA==",
      "original_commit_id" : "5fe4eb3a1a8ca7da24a451360a7d38c768e12b10",
      "original_position" : 226,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 237835732,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-16T13:07:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284266408",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> PruneAndFlush() doesn't seem to actually do any flushing\r\n\r\nMy mistake: flushes *do* happen when calling `PruneAndFlush()`. I've undone that particular rename and removed the comment I added. ",
      "created_at" : "2019-05-15T13:57:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#issuecomment-492665786",
      "id" : 492665786,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15976",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5MjY2NTc4Ng==",
      "updated_at" : "2019-05-15T13:57:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/492665786",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284290728"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284290728"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't understand what the \"global state\" comment should convey. If a symbol is global and not const, we prefix it with `g_`. Might want to remove it?",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-15T14:38:31Z",
      "diff_hunk" : "@@ -4916,3 +4760,21 @@ class CMainCleanup\n         mapBlockIndex.clear();\n     }\n } instance_of_cmaincleanup;\n+\n+bool CBlockIndexWorkComparator::operator()(const CBlockIndex *pa, const CBlockIndex *pb) const {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284290728",
      "id" : 284290728,
      "in_reply_to_id" : 284223105,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDI5MDcyOA==",
      "original_commit_id" : "5fe4eb3a1a8ca7da24a451360a7d38c768e12b10",
      "original_position" : 545,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 237866934,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-16T13:07:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284290728",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284291087"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284291087"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Asked because we don't do this elsewhere. You can pick whatever you prefer ofc",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-15T14:39:12Z",
      "diff_hunk" : "@@ -2196,27 +2035,31 @@ bool static FlushStateToDisk(const CChainParams& chainparams, CValidationState &\n     }\n     if (full_flush_completed) {\n         // Update best block in wallet (so we can detect restored wallets).\n-        GetMainSignals().ChainStateFlushed(::ChainActive().GetLocator());\n+        GetMainSignals().ChainStateFlushed(m_chain.GetLocator());\n     }\n     } catch (const std::runtime_error& e) {\n         return AbortNode(state, std::string(\"System error while flushing: \") + e.what());\n     }\n     return true;\n }\n \n-void FlushStateToDisk() {\n+void CChainState::ForceFlushStateToDisk() {\n     CValidationState state;\n     const CChainParams& chainparams = Params();\n-    if (!FlushStateToDisk(chainparams, state, FlushStateMode::ALWAYS)) {\n+    if (!this->FlushStateToDisk(chainparams, state, FlushStateMode::ALWAYS)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284291087",
      "id" : 284291087,
      "in_reply_to_id" : 284226967,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDI5MTA4Nw==",
      "original_commit_id" : "5fe4eb3a1a8ca7da24a451360a7d38c768e12b10",
      "original_position" : 313,
      "path" : "src/validation.cpp",
      "position" : 330,
      "pull_request_review_id" : 237867411,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-16T13:07:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284291087",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284330177"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284330177"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> I like prefixing with this-> for methods because it makes it obvious we're calling a method, sort of like m_\r\n\r\nFWIW, I still think https://github.com/bitcoin/bitcoin/pull/14635 is a good solution that would improve readability in these cases",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-15T15:56:13Z",
      "diff_hunk" : "@@ -2196,27 +2035,31 @@ bool static FlushStateToDisk(const CChainParams& chainparams, CValidationState &\n     }\n     if (full_flush_completed) {\n         // Update best block in wallet (so we can detect restored wallets).\n-        GetMainSignals().ChainStateFlushed(::ChainActive().GetLocator());\n+        GetMainSignals().ChainStateFlushed(m_chain.GetLocator());\n     }\n     } catch (const std::runtime_error& e) {\n         return AbortNode(state, std::string(\"System error while flushing: \") + e.what());\n     }\n     return true;\n }\n \n-void FlushStateToDisk() {\n+void CChainState::ForceFlushStateToDisk() {\n     CValidationState state;\n     const CChainParams& chainparams = Params();\n-    if (!FlushStateToDisk(chainparams, state, FlushStateMode::ALWAYS)) {\n+    if (!this->FlushStateToDisk(chainparams, state, FlushStateMode::ALWAYS)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284330177",
      "id" : 284330177,
      "in_reply_to_id" : 284226967,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDMzMDE3Nw==",
      "original_commit_id" : "5fe4eb3a1a8ca7da24a451360a7d38c768e12b10",
      "original_position" : 313,
      "path" : "src/validation.cpp",
      "position" : 330,
      "pull_request_review_id" : 237918090,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-16T13:07:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284330177",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284441906"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284441906"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit, in commit a8930a66b1 move-only: make the CChainState interface public\r\n\r\n\r\nThis comment wasn't accurate before the commit, nor is it accurate after the commit. And it made you move the code block below all the way down in the file.\r\n\r\nCould instead remove this comment and keep the code block below in place? This also makes `git blame` and `git diff` work on the commit without workarounds.",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-15T20:41:46Z",
      "diff_hunk" : "@@ -63,162 +63,10 @@\n /**\n  * Global state",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284441906",
      "id" : 284441906,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDQ0MTkwNg==",
      "original_commit_id" : "64d0f872fcf6b61de9e4e62ce13dbbe3b00cbb6c",
      "original_position" : 2,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 238059557,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-16T13:07:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284441906",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284696473"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284696473"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yep, agree. Not sure how much it helps the diff, but that comment should be removed. I've pushed [the change](https://github.com/bitcoin/bitcoin/compare/64d0f872fcf6b61de9e4e62ce13dbbe3b00cbb6c..403e677c9ebbf9744733010e6b0c2d1b182ee850).",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-16T13:08:38Z",
      "diff_hunk" : "@@ -63,162 +63,10 @@\n /**\n  * Global state",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284696473",
      "id" : 284696473,
      "in_reply_to_id" : 284441906,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDY5NjQ3Mw==",
      "original_commit_id" : "64d0f872fcf6b61de9e4e62ce13dbbe3b00cbb6c",
      "original_position" : 2,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 238379350,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-16T13:08:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284696473",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284716026"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284716026"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: might as well improve this comment while you're moving it, by using more sentences...\r\n\r\n```\r\n* Consider flushing caches and indexes for the on-disk chain state.\r\n* If we're in prune mode and about to delete block files, we flush.\r\n* Otherwise we check FlushStateMode:\r\n* IF_NEEDED: if the chainstate is too large compared to -dbcache (plus -mempoolsize in IBD)\r\n* PERIODIC: it's been a while since the last write\r\n* ALWAYS: e.g. during shutdown or RPC queries about the chain state\r\n* NONE: only flush if a manual prune height provided and it is above the current prune height\r\n```\r\n\r\nThis clarification also makes it pretty obvious that this method needs to be split, but that can wait.",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-16T13:49:59Z",
      "diff_hunk" : "@@ -508,6 +513,28 @@ class CChainState {\n \n     bool LoadBlockIndex(const Consensus::Params& consensus_params, CBlockTreeDB& blocktree) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+    /**\n+     * Update the on-disk chain state.\n+     * The caches and indexes are flushed depending on the mode we're called with",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284716026",
      "id" : 284716026,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDcxNjAyNg==",
      "original_commit_id" : "3ccbc376dd313fb7666471f24f6d9370914d00f3",
      "original_position" : 40,
      "path" : "src/validation.h",
      "position" : 143,
      "pull_request_review_id" : 238404463,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-16T14:30:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284716026",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284732394"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284732394"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: flushing is done _before_ pruning. Rename to `FlushAndPrune()`?",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-16T14:22:18Z",
      "diff_hunk" : "@@ -508,6 +513,28 @@ class CChainState {\n \n     bool LoadBlockIndex(const Consensus::Params& consensus_params, CBlockTreeDB& blocktree) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+    /**\n+     * Update the on-disk chain state.\n+     * The caches and indexes are flushed depending on the mode we're called with\n+     * if they're too large, if it's been a while since the last write,\n+     * or always and in all cases if we're in prune mode and are deleting files.\n+     *\n+     * If FlushStateMode::NONE is used, then FlushStateToDisk(...) won't do anything\n+     * besides checking if we need to prune.\n+     */\n+    bool FlushStateToDisk(\n+        const CChainParams& chainparams,\n+        CValidationState &state,\n+        FlushStateMode mode,\n+        int nManualPruneHeight = 0);\n+\n+    //! Unconditionally flush all changes to disk.\n+    void ForceFlushStateToDisk();\n+\n+    //! Prune blockfiles from the disk if necessary and then flush chainstate changes",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284732394",
      "id" : 284732394,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDczMjM5NA==",
      "original_commit_id" : "3ccbc376dd313fb7666471f24f6d9370914d00f3",
      "original_position" : 56,
      "path" : "src/validation.h",
      "position" : 159,
      "pull_request_review_id" : 238404463,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-16T14:30:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284732394",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284733657"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284733657"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yuck (but out of scope)",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-16T14:24:41Z",
      "diff_hunk" : "@@ -2058,27 +2046,28 @@ bool static FlushStateToDisk(const CChainParams& chainparams, CValidationState &\n     }\n     if (full_flush_completed) {\n         // Update best block in wallet (so we can detect restored wallets).\n-        GetMainSignals().ChainStateFlushed(::ChainActive().GetLocator());\n+        GetMainSignals().ChainStateFlushed(m_chain.GetLocator());\n     }\n     } catch (const std::runtime_error& e) {\n         return AbortNode(state, std::string(\"System error while flushing: \") + e.what());\n     }\n     return true;\n }\n \n-void FlushStateToDisk() {\n+void CChainState::ForceFlushStateToDisk() {\n     CValidationState state;\n     const CChainParams& chainparams = Params();\n-    if (!FlushStateToDisk(chainparams, state, FlushStateMode::ALWAYS)) {\n+    if (!this->FlushStateToDisk(chainparams, state, FlushStateMode::ALWAYS)) {\n         LogPrintf(\"%s: failed to flush state (%s)\\n\", __func__, FormatStateMessage(state));\n     }\n }\n \n-void PruneAndFlush() {\n+void CChainState::PruneAndFlush() {\n     CValidationState state;\n     fCheckForPruning = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284733657",
      "id" : 284733657,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDczMzY1Nw==",
      "original_commit_id" : "3ccbc376dd313fb7666471f24f6d9370914d00f3",
      "original_position" : 74,
      "path" : "src/validation.cpp",
      "position" : 338,
      "pull_request_review_id" : 238404463,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-16T14:30:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284733657",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284742646"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284742646"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ehh, well it depends on what you're talking about being flushed - i.e. `pcoinsTip` get flushed [after](https://github.com/bitcoin/bitcoin/blob/master/src/validation.cpp#L2191) the prune happens.",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-16T14:41:37Z",
      "diff_hunk" : "@@ -508,6 +513,28 @@ class CChainState {\n \n     bool LoadBlockIndex(const Consensus::Params& consensus_params, CBlockTreeDB& blocktree) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+    /**\n+     * Update the on-disk chain state.\n+     * The caches and indexes are flushed depending on the mode we're called with\n+     * if they're too large, if it's been a while since the last write,\n+     * or always and in all cases if we're in prune mode and are deleting files.\n+     *\n+     * If FlushStateMode::NONE is used, then FlushStateToDisk(...) won't do anything\n+     * besides checking if we need to prune.\n+     */\n+    bool FlushStateToDisk(\n+        const CChainParams& chainparams,\n+        CValidationState &state,\n+        FlushStateMode mode,\n+        int nManualPruneHeight = 0);\n+\n+    //! Unconditionally flush all changes to disk.\n+    void ForceFlushStateToDisk();\n+\n+    //! Prune blockfiles from the disk if necessary and then flush chainstate changes",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284742646",
      "id" : 284742646,
      "in_reply_to_id" : 284732394,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDc0MjY0Ng==",
      "original_commit_id" : "3ccbc376dd313fb7666471f24f6d9370914d00f3",
      "original_position" : 56,
      "path" : "src/validation.h",
      "position" : 159,
      "pull_request_review_id" : 238439543,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-16T14:41:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284742646",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284753199"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284753199"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I was talking about the chain state, which is the biggest thing :-) ",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-16T15:01:37Z",
      "diff_hunk" : "@@ -508,6 +513,28 @@ class CChainState {\n \n     bool LoadBlockIndex(const Consensus::Params& consensus_params, CBlockTreeDB& blocktree) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+    /**\n+     * Update the on-disk chain state.\n+     * The caches and indexes are flushed depending on the mode we're called with\n+     * if they're too large, if it's been a while since the last write,\n+     * or always and in all cases if we're in prune mode and are deleting files.\n+     *\n+     * If FlushStateMode::NONE is used, then FlushStateToDisk(...) won't do anything\n+     * besides checking if we need to prune.\n+     */\n+    bool FlushStateToDisk(\n+        const CChainParams& chainparams,\n+        CValidationState &state,\n+        FlushStateMode mode,\n+        int nManualPruneHeight = 0);\n+\n+    //! Unconditionally flush all changes to disk.\n+    void ForceFlushStateToDisk();\n+\n+    //! Prune blockfiles from the disk if necessary and then flush chainstate changes",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284753199",
      "id" : 284753199,
      "in_reply_to_id" : 284732394,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDc1MzE5OQ==",
      "original_commit_id" : "3ccbc376dd313fb7666471f24f6d9370914d00f3",
      "original_position" : 56,
      "path" : "src/validation.h",
      "position" : 159,
      "pull_request_review_id" : 238453339,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-16T15:01:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284753199",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284755131"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284755131"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah, `pcoinsTip` (chainstate) is flushed *after* pruning.",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-16T15:05:21Z",
      "diff_hunk" : "@@ -508,6 +513,28 @@ class CChainState {\n \n     bool LoadBlockIndex(const Consensus::Params& consensus_params, CBlockTreeDB& blocktree) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+    /**\n+     * Update the on-disk chain state.\n+     * The caches and indexes are flushed depending on the mode we're called with\n+     * if they're too large, if it's been a while since the last write,\n+     * or always and in all cases if we're in prune mode and are deleting files.\n+     *\n+     * If FlushStateMode::NONE is used, then FlushStateToDisk(...) won't do anything\n+     * besides checking if we need to prune.\n+     */\n+    bool FlushStateToDisk(\n+        const CChainParams& chainparams,\n+        CValidationState &state,\n+        FlushStateMode mode,\n+        int nManualPruneHeight = 0);\n+\n+    //! Unconditionally flush all changes to disk.\n+    void ForceFlushStateToDisk();\n+\n+    //! Prune blockfiles from the disk if necessary and then flush chainstate changes",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284755131",
      "id" : 284755131,
      "in_reply_to_id" : 284732394,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDc1NTEzMQ==",
      "original_commit_id" : "3ccbc376dd313fb7666471f24f6d9370914d00f3",
      "original_position" : 56,
      "path" : "src/validation.h",
      "position" : 159,
      "pull_request_review_id" : 238455958,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-16T15:05:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284755131",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284773736"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284773736"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah wait, never mind, you're right. Why do we flush the chainstate cache after pruning? Is that in order to minimize the chances of running out of disk space?",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-16T15:42:15Z",
      "diff_hunk" : "@@ -508,6 +513,28 @@ class CChainState {\n \n     bool LoadBlockIndex(const Consensus::Params& consensus_params, CBlockTreeDB& blocktree) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+    /**\n+     * Update the on-disk chain state.\n+     * The caches and indexes are flushed depending on the mode we're called with\n+     * if they're too large, if it's been a while since the last write,\n+     * or always and in all cases if we're in prune mode and are deleting files.\n+     *\n+     * If FlushStateMode::NONE is used, then FlushStateToDisk(...) won't do anything\n+     * besides checking if we need to prune.\n+     */\n+    bool FlushStateToDisk(\n+        const CChainParams& chainparams,\n+        CValidationState &state,\n+        FlushStateMode mode,\n+        int nManualPruneHeight = 0);\n+\n+    //! Unconditionally flush all changes to disk.\n+    void ForceFlushStateToDisk();\n+\n+    //! Prune blockfiles from the disk if necessary and then flush chainstate changes",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r284773736",
      "id" : 284773736,
      "in_reply_to_id" : 284732394,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDc3MzczNg==",
      "original_commit_id" : "3ccbc376dd313fb7666471f24f6d9370914d00f3",
      "original_position" : 56,
      "path" : "src/validation.h",
      "position" : 159,
      "pull_request_review_id" : 238479601,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-16T15:42:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284773736",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r285154179"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/285154179"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit 4d6688603b refactoring: introduce ChainstateActive()\r\n\r\n\r\nWhy is this changed? It seems this method will go away anyway. See https://github.com/bitcoin/bitcoin/pull/15606/files#diff-24efdb00bfbe56b140fb006b562cc70bL4415",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-17T14:37:21Z",
      "diff_hunk" : "@@ -4414,7 +4269,7 @@ bool CChainState::LoadGenesisBlock(const CChainParams& chainparams)\n \n bool LoadGenesisBlock(const CChainParams& chainparams)\n {\n-    return g_chainstate.LoadGenesisBlock(chainparams);\n+    return ::ChainstateActive().LoadGenesisBlock(chainparams);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r285154179",
      "id" : 285154179,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NTE1NDE3OQ==",
      "original_commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "original_position" : 532,
      "path" : "src/validation.cpp",
      "position" : 532,
      "pull_request_review_id" : 238962331,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-17T14:46:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/285154179",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r285154734"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/285154734"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit 4d66886 refactoring: introduce ChainstateActive()\r\n\r\n\r\nWhy is this changed? It seems that eventually you'll pass in the chainstate, see https://github.com/bitcoin/bitcoin/pull/15606/files#diff-24efdb00bfbe56b140fb006b562cc70bR4324\r\n\r\nSo why would you change the same line twice?",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-17T14:38:44Z",
      "diff_hunk" : "@@ -4312,7 +4167,7 @@ bool CChainState::RewindBlockIndex(const CChainParams& params)\n }\n \n bool RewindBlockIndex(const CChainParams& params) {\n-    if (!g_chainstate.RewindBlockIndex(params)) {\n+    if (!::ChainstateActive().RewindBlockIndex(params)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r285154734",
      "id" : 285154734,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NTE1NDczNA==",
      "original_commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "original_position" : 505,
      "path" : "src/validation.cpp",
      "position" : 505,
      "pull_request_review_id" : 238962331,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-17T14:46:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/285154734",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r285154989"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/285154989"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit 4d66886 refactoring: introduce ChainstateActive()\r\n\r\nSame here (and all other changes in this commit)",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-17T14:39:20Z",
      "diff_hunk" : "@@ -4179,7 +4034,7 @@ bool CChainState::ReplayBlocks(const CChainParams& params, CCoinsView* view)\n }\n \n bool ReplayBlocks(const CChainParams& params, CCoinsView* view) {\n-    return g_chainstate.ReplayBlocks(params, view);\n+    return ::ChainstateActive().ReplayBlocks(params, view);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r285154989",
      "id" : 285154989,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NTE1NDk4OQ==",
      "original_commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "original_position" : 496,
      "path" : "src/validation.cpp",
      "position" : 496,
      "pull_request_review_id" : 238962331,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-17T14:46:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/285154989",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r285155670"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/285155670"
         }
      },
      "author_association" : "MEMBER",
      "body" : "git-style-nit in commit d7c97edeea move-only: make the CChainState interface public\r\n\r\n\r\nCould keep the previous indentation to preserve the `git blame` and minimize the diff line count? No strong opinion, though.\r\nPlease don't address my nit if you don't have to touch the patches for other reasons.",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-17T14:40:44Z",
      "diff_hunk" : "@@ -60,165 +60,27 @@\n #define MICRO 0.000001\n #define MILLI 0.001\n \n-/**\n- * Global state\n- */\n-namespace {\n-    struct CBlockIndexWorkComparator\n-    {\n-        bool operator()(const CBlockIndex *pa, const CBlockIndex *pb) const {\n-            // First sort by most total work, ...",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r285155670",
      "id" : 285155670,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NTE1NTY3MA==",
      "original_commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "original_position" : 11,
      "path" : "src/validation.cpp",
      "position" : 11,
      "pull_request_review_id" : 238962331,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-17T14:46:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/285155670",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r287094923"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/287094923"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't know that we should maintain a weird indentation just for ease-of-diff, but if other reviewers disagree, I'll make the change.",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-23T19:16:47Z",
      "diff_hunk" : "@@ -60,165 +60,27 @@\n #define MICRO 0.000001\n #define MILLI 0.001\n \n-/**\n- * Global state\n- */\n-namespace {\n-    struct CBlockIndexWorkComparator\n-    {\n-        bool operator()(const CBlockIndex *pa, const CBlockIndex *pb) const {\n-            // First sort by most total work, ...",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r287094923",
      "id" : 287094923,
      "in_reply_to_id" : 285155670,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NzA5NDkyMw==",
      "original_commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "original_position" : 11,
      "path" : "src/validation.cpp",
      "position" : 11,
      "pull_request_review_id" : 241399575,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-23T19:16:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/287094923",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r287097288"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/287097288"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Even before that change, we remove the `g_chainstate` symbol (https://github.com/bitcoin/bitcoin/pull/15606/commits/4c4b9ce2f310a519f1579f6a2892c590c1b96c6a) which means that this change would have to happen at some point anyway.",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-23T19:23:37Z",
      "diff_hunk" : "@@ -4312,7 +4167,7 @@ bool CChainState::RewindBlockIndex(const CChainParams& params)\n }\n \n bool RewindBlockIndex(const CChainParams& params) {\n-    if (!g_chainstate.RewindBlockIndex(params)) {\n+    if (!::ChainstateActive().RewindBlockIndex(params)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r287097288",
      "id" : 287097288,
      "in_reply_to_id" : 285154734,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NzA5NzI4OA==",
      "original_commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "original_position" : 505,
      "path" : "src/validation.cpp",
      "position" : 505,
      "pull_request_review_id" : 241402718,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-23T19:23:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/287097288",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "My comments are mostly meant to minimize the changed lines, so purely stylistic. I guess you shouldn't address them unless you need to invalidate the reviews for other reasons.",
      "created_at" : "2019-05-23T19:46:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#issuecomment-495359473",
      "id" : 495359473,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15976",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5NTM1OTQ3Mw==",
      "updated_at" : "2019-05-23T19:46:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/495359473",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r288378134"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/288378134"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit in commit d7c97ed move-only: make the CChainState interface public\r\n\r\nHow about defining `CBlockIndexWorkComparator` privately within `CChainState`, given it is not used outside the class?",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-29T03:13:23Z",
      "diff_hunk" : "@@ -422,6 +423,145 @@ inline CBlockIndex* LookupBlockIndex(const uint256& hash)\n /** Find the last common block between the parameter chain and a locator. */\n CBlockIndex* FindForkInGlobalIndex(const CChain& chain, const CBlockLocator& locator) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+enum DisconnectResult\n+{\n+    DISCONNECT_OK,      // All good.\n+    DISCONNECT_UNCLEAN, // Rolled back, but UTXO set was inconsistent with block.\n+    DISCONNECT_FAILED   // Something else went wrong.\n+};\n+\n+class ConnectTrace;\n+\n+struct CBlockIndexWorkComparator\n+{\n+    bool operator()(const CBlockIndex *pa, const CBlockIndex *pb) const;\n+};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r288378134",
      "id" : 288378134,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4ODM3ODEzNA==",
      "original_commit_id" : "d7c97edeea8cee10ad9da1f940d39d5073ac142d",
      "original_position" : 24,
      "path" : "src/validation.h",
      "position" : 60,
      "pull_request_review_id" : 243020635,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-29T03:13:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/288378134",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r288378773"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/288378773"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit in commit 4d66886 refactoring: introduce ChainstateActive()\r\n\r\nHow about making `g_chainstate` static?",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-29T03:17:33Z",
      "diff_hunk" : "@@ -80,6 +80,8 @@ bool CBlockIndexWorkComparator::operator()(const CBlockIndex *pa, const CBlockIn\n \n CChainState g_chainstate;\n \n+CChainState& ChainstateActive() { return g_chainstate; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r288378773",
      "id" : 288378773,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4ODM3ODc3Mw==",
      "original_commit_id" : "4d6688603b8c8df854d52df464e157d0a6e7bde6",
      "original_position" : 4,
      "path" : "src/validation.cpp",
      "position" : 178,
      "pull_request_review_id" : 243021426,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-29T03:33:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/288378773",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK https://github.com/bitcoin/bitcoin/pull/15976/commits/403e677c9ebbf9744733010e6b0c2d1b182ee850 no need to address my nits herein",
      "created_at" : "2019-05-29T03:27:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#issuecomment-496769376",
      "id" : 496769376,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15976",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5Njc2OTM3Ng==",
      "updated_at" : "2019-05-29T03:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/496769376",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r288380488"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/288380488"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: given context, this could be renamed `ForceFlushToDisk`",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-29T03:28:48Z",
      "diff_hunk" : "@@ -422,6 +418,186 @@ inline CBlockIndex* LookupBlockIndex(const uint256& hash)\n /** Find the last common block between the parameter chain and a locator. */\n CBlockIndex* FindForkInGlobalIndex(const CChain& chain, const CBlockLocator& locator) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+enum DisconnectResult\n+{\n+    DISCONNECT_OK,      // All good.\n+    DISCONNECT_UNCLEAN, // Rolled back, but UTXO set was inconsistent with block.\n+    DISCONNECT_FAILED   // Something else went wrong.\n+};\n+\n+class ConnectTrace;\n+\n+/** @see CChainState::FlushStateToDisk */\n+enum class FlushStateMode {\n+    NONE,\n+    IF_NEEDED,\n+    PERIODIC,\n+    ALWAYS\n+};\n+\n+struct CBlockIndexWorkComparator\n+{\n+    bool operator()(const CBlockIndex *pa, const CBlockIndex *pb) const;\n+};\n+\n+/**\n+ * CChainState stores and provides an API to update our local knowledge of the\n+ * current best chain and header tree.\n+ *\n+ * It generally provides access to the current block tree, as well as functions\n+ * to provide new data, which it will appropriately validate and incorporate in\n+ * its state as necessary.\n+ *\n+ * Eventually, the API here is targeted at being exposed externally as a\n+ * consumable libconsensus library, so any functions added must only call\n+ * other class member functions, pure functions in other parts of the consensus\n+ * library, callbacks via the validation interface, or read/write-to-disk\n+ * functions (eventually this will also be via callbacks).\n+ */\n+class CChainState {\n+private:\n+    /**\n+     * The set of all CBlockIndex entries with BLOCK_VALID_TRANSACTIONS (for itself and all ancestors) and\n+     * as good as our current tip or better. Entries may be failed, though, and pruning nodes may be\n+     * missing the data for the block.\n+     */\n+    std::set<CBlockIndex*, CBlockIndexWorkComparator> setBlockIndexCandidates;\n+\n+    /**\n+     * Every received block is assigned a unique and increasing identifier, so we\n+     * know which one to give priority in case of a fork.\n+     */\n+    CCriticalSection cs_nBlockSequenceId;\n+    /** Blocks loaded from disk are assigned id 0, so start the counter at 1. */\n+    int32_t nBlockSequenceId = 1;\n+    /** Decreasing counter (used by subsequent preciousblock calls). */\n+    int32_t nBlockReverseSequenceId = -1;\n+    /** chainwork for the last block that preciousblock has been applied to. */\n+    arith_uint256 nLastPreciousChainwork = 0;\n+\n+    /** In order to efficiently track invalidity of headers, we keep the set of\n+      * blocks which we tried to connect and found to be invalid here (ie which\n+      * were set to BLOCK_FAILED_VALID since the last restart). We can then\n+      * walk this set and check if a new header is a descendant of something in\n+      * this set, preventing us from having to walk mapBlockIndex when we try\n+      * to connect a bad block and fail.\n+      *\n+      * While this is more complicated than marking everything which descends\n+      * from an invalid block as invalid at the time we discover it to be\n+      * invalid, doing so would require walking all of mapBlockIndex to find all\n+      * descendants. Since this case should be very rare, keeping track of all\n+      * BLOCK_FAILED_VALID blocks in a set should be just fine and work just as\n+      * well.\n+      *\n+      * Because we already walk mapBlockIndex in height-order at startup, we go\n+      * ahead and mark descendants of invalid blocks as FAILED_CHILD at that time,\n+      * instead of putting things in this set.\n+      */\n+    std::set<CBlockIndex*> m_failed_blocks;\n+\n+    /**\n+     * the ChainState CriticalSection\n+     * A lock that must be held when modifying this ChainState - held in ActivateBestChain()\n+     */\n+    CCriticalSection m_cs_chainstate;\n+\n+    /**\n+     * Whether this chainstate is undergoing initial block download.\n+     *\n+     * Mutable because we need to be able to mark IsInitialBlockDownload()\n+     * const, which latches this for caching purposes.\n+     */\n+    mutable std::atomic<bool> m_cached_finished_ibd{false};\n+\n+public:\n+    //! The current chain of blockheaders we consult and build on.\n+    //! @see CChain, CBlockIndex.\n+    CChain m_chain;\n+    BlockMap mapBlockIndex GUARDED_BY(cs_main);\n+    std::multimap<CBlockIndex*, CBlockIndex*> mapBlocksUnlinked;\n+    CBlockIndex *pindexBestInvalid = nullptr;\n+\n+    bool LoadBlockIndex(const Consensus::Params& consensus_params, CBlockTreeDB& blocktree) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+\n+    /**\n+     * Update the on-disk chain state.\n+     * The caches and indexes are flushed depending on the mode we're called with\n+     * if they're too large, if it's been a while since the last write,\n+     * or always and in all cases if we're in prune mode and are deleting files.\n+     *\n+     * If FlushStateMode::NONE is used, then FlushStateToDisk(...) won't do anything\n+     * besides checking if we need to prune.\n+     */\n+    bool FlushStateToDisk(\n+        const CChainParams& chainparams,\n+        CValidationState &state,\n+        FlushStateMode mode,\n+        int nManualPruneHeight = 0);\n+\n+    //! Unconditionally flush all changes to disk.\n+    void ForceFlushStateToDisk();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r288380488",
      "id" : 288380488,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4ODM4MDQ4OA==",
      "original_commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "original_position" : 157,
      "path" : "src/validation.h",
      "position" : 157,
      "pull_request_review_id" : 243023504,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-29T03:28:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/288380488",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r288380573"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/288380573"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: given context, this could be renamed `FlushToDisk`",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-29T03:29:24Z",
      "diff_hunk" : "@@ -422,6 +418,186 @@ inline CBlockIndex* LookupBlockIndex(const uint256& hash)\n /** Find the last common block between the parameter chain and a locator. */\n CBlockIndex* FindForkInGlobalIndex(const CChain& chain, const CBlockLocator& locator) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+enum DisconnectResult\n+{\n+    DISCONNECT_OK,      // All good.\n+    DISCONNECT_UNCLEAN, // Rolled back, but UTXO set was inconsistent with block.\n+    DISCONNECT_FAILED   // Something else went wrong.\n+};\n+\n+class ConnectTrace;\n+\n+/** @see CChainState::FlushStateToDisk */\n+enum class FlushStateMode {\n+    NONE,\n+    IF_NEEDED,\n+    PERIODIC,\n+    ALWAYS\n+};\n+\n+struct CBlockIndexWorkComparator\n+{\n+    bool operator()(const CBlockIndex *pa, const CBlockIndex *pb) const;\n+};\n+\n+/**\n+ * CChainState stores and provides an API to update our local knowledge of the\n+ * current best chain and header tree.\n+ *\n+ * It generally provides access to the current block tree, as well as functions\n+ * to provide new data, which it will appropriately validate and incorporate in\n+ * its state as necessary.\n+ *\n+ * Eventually, the API here is targeted at being exposed externally as a\n+ * consumable libconsensus library, so any functions added must only call\n+ * other class member functions, pure functions in other parts of the consensus\n+ * library, callbacks via the validation interface, or read/write-to-disk\n+ * functions (eventually this will also be via callbacks).\n+ */\n+class CChainState {\n+private:\n+    /**\n+     * The set of all CBlockIndex entries with BLOCK_VALID_TRANSACTIONS (for itself and all ancestors) and\n+     * as good as our current tip or better. Entries may be failed, though, and pruning nodes may be\n+     * missing the data for the block.\n+     */\n+    std::set<CBlockIndex*, CBlockIndexWorkComparator> setBlockIndexCandidates;\n+\n+    /**\n+     * Every received block is assigned a unique and increasing identifier, so we\n+     * know which one to give priority in case of a fork.\n+     */\n+    CCriticalSection cs_nBlockSequenceId;\n+    /** Blocks loaded from disk are assigned id 0, so start the counter at 1. */\n+    int32_t nBlockSequenceId = 1;\n+    /** Decreasing counter (used by subsequent preciousblock calls). */\n+    int32_t nBlockReverseSequenceId = -1;\n+    /** chainwork for the last block that preciousblock has been applied to. */\n+    arith_uint256 nLastPreciousChainwork = 0;\n+\n+    /** In order to efficiently track invalidity of headers, we keep the set of\n+      * blocks which we tried to connect and found to be invalid here (ie which\n+      * were set to BLOCK_FAILED_VALID since the last restart). We can then\n+      * walk this set and check if a new header is a descendant of something in\n+      * this set, preventing us from having to walk mapBlockIndex when we try\n+      * to connect a bad block and fail.\n+      *\n+      * While this is more complicated than marking everything which descends\n+      * from an invalid block as invalid at the time we discover it to be\n+      * invalid, doing so would require walking all of mapBlockIndex to find all\n+      * descendants. Since this case should be very rare, keeping track of all\n+      * BLOCK_FAILED_VALID blocks in a set should be just fine and work just as\n+      * well.\n+      *\n+      * Because we already walk mapBlockIndex in height-order at startup, we go\n+      * ahead and mark descendants of invalid blocks as FAILED_CHILD at that time,\n+      * instead of putting things in this set.\n+      */\n+    std::set<CBlockIndex*> m_failed_blocks;\n+\n+    /**\n+     * the ChainState CriticalSection\n+     * A lock that must be held when modifying this ChainState - held in ActivateBestChain()\n+     */\n+    CCriticalSection m_cs_chainstate;\n+\n+    /**\n+     * Whether this chainstate is undergoing initial block download.\n+     *\n+     * Mutable because we need to be able to mark IsInitialBlockDownload()\n+     * const, which latches this for caching purposes.\n+     */\n+    mutable std::atomic<bool> m_cached_finished_ibd{false};\n+\n+public:\n+    //! The current chain of blockheaders we consult and build on.\n+    //! @see CChain, CBlockIndex.\n+    CChain m_chain;\n+    BlockMap mapBlockIndex GUARDED_BY(cs_main);\n+    std::multimap<CBlockIndex*, CBlockIndex*> mapBlocksUnlinked;\n+    CBlockIndex *pindexBestInvalid = nullptr;\n+\n+    bool LoadBlockIndex(const Consensus::Params& consensus_params, CBlockTreeDB& blocktree) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+\n+    /**\n+     * Update the on-disk chain state.\n+     * The caches and indexes are flushed depending on the mode we're called with\n+     * if they're too large, if it's been a while since the last write,\n+     * or always and in all cases if we're in prune mode and are deleting files.\n+     *\n+     * If FlushStateMode::NONE is used, then FlushStateToDisk(...) won't do anything\n+     * besides checking if we need to prune.\n+     */\n+    bool FlushStateToDisk(",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r288380573",
      "id" : 288380573,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4ODM4MDU3Mw==",
      "original_commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "original_position" : 150,
      "path" : "src/validation.h",
      "position" : 150,
      "pull_request_review_id" : 243023606,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-29T03:29:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/288380573",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r288380744"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/288380744"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: this could be moved to `CChainState::FlushMode`",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-29T03:30:35Z",
      "diff_hunk" : "@@ -422,6 +418,186 @@ inline CBlockIndex* LookupBlockIndex(const uint256& hash)\n /** Find the last common block between the parameter chain and a locator. */\n CBlockIndex* FindForkInGlobalIndex(const CChain& chain, const CBlockLocator& locator) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+enum DisconnectResult\n+{\n+    DISCONNECT_OK,      // All good.\n+    DISCONNECT_UNCLEAN, // Rolled back, but UTXO set was inconsistent with block.\n+    DISCONNECT_FAILED   // Something else went wrong.\n+};\n+\n+class ConnectTrace;\n+\n+/** @see CChainState::FlushStateToDisk */\n+enum class FlushStateMode {\n+    NONE,\n+    IF_NEEDED,\n+    PERIODIC,\n+    ALWAYS\n+};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r288380744",
      "id" : 288380744,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4ODM4MDc0NA==",
      "original_commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "original_position" : 55,
      "path" : "src/validation.h",
      "position" : 55,
      "pull_request_review_id" : 243023804,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-29T03:30:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/288380744",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "4 utACKs on this - is there anyone else who wants to give it a look before merge?",
      "created_at" : "2019-05-30T18:02:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#issuecomment-497425233",
      "id" : 497425233,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15976",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5NzQyNTIzMw==",
      "updated_at" : "2019-05-30T18:02:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/497425233",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r289119702"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/289119702"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I very much like the idea of clarifying this comment, but in my experience doc changes sometimes generate a surprising amount of feedback. I don't want to expand this PR beyond its current size (or delay it more than necessary), but will definitely be happy to review follow-up PRs making the change you suggest. ",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-05-30T18:41:21Z",
      "diff_hunk" : "@@ -508,6 +513,28 @@ class CChainState {\n \n     bool LoadBlockIndex(const Consensus::Params& consensus_params, CBlockTreeDB& blocktree) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+    /**\n+     * Update the on-disk chain state.\n+     * The caches and indexes are flushed depending on the mode we're called with",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r289119702",
      "id" : 289119702,
      "in_reply_to_id" : 284716026,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTExOTcwMg==",
      "original_commit_id" : "3ccbc376dd313fb7666471f24f6d9370914d00f3",
      "original_position" : 40,
      "path" : "src/validation.h",
      "position" : 143,
      "pull_request_review_id" : 243961682,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-05-30T18:41:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/289119702",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r289658222"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/289658222"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't mind the indentation `git show --color-moved=dimmed_zebra --color-moved-ws=ignore-all-space d7c97edeea8cee10ad9da1f940d39d5073ac142d`.\r\n\r\nI think this operator was inlined? Does it make sense to declare it `inline`?",
      "commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-06-02T21:15:58Z",
      "diff_hunk" : "@@ -60,165 +60,27 @@\n #define MICRO 0.000001\n #define MILLI 0.001\n \n-/**\n- * Global state\n- */\n-namespace {\n-    struct CBlockIndexWorkComparator\n-    {\n-        bool operator()(const CBlockIndex *pa, const CBlockIndex *pb) const {\n-            // First sort by most total work, ...",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#discussion_r289658222",
      "id" : 289658222,
      "in_reply_to_id" : 285155670,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY1ODIyMg==",
      "original_commit_id" : "403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "original_position" : 11,
      "path" : "src/validation.cpp",
      "position" : 11,
      "pull_request_review_id" : 244642736,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15976",
      "updated_at" : "2019-06-02T21:17:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/289658222",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 403e677c9ebbf9744733010e6b0c2d1b182ee850",
      "created_at" : "2019-06-05T09:54:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15976#issuecomment-499018489",
      "id" : 499018489,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15976",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5OTAxODQ4OQ==",
      "updated_at" : "2019-06-05T09:54:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/499018489",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
