{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "I am using Ubuntu 21.04 and have a system BDB installed (5.3): [dpkg_bdbd.log](https://github.com/bitcoin/bitcoin/files/7483664/dpkg_bdbd.log) and QT5: [dpkg_qt.log](https://github.com/bitcoin/bitcoin/files/7483680/dpkg_qt.log).\r\n\r\nBitcoin source is at a0988140b71485ad12c3c3a4a9573f7c21b1eff8 (tag v22.0)\r\n\r\n`make check` runs successfully to completion when using\r\n\r\n```\r\n./contrib/install_db4.sh `pwd`\r\nexport BDB_PREFIX=\"/home/will/src/bitcoin/db4\"\r\n./autogen.sh\r\n./configure BDB_LIBS=\"-L${BDB_PREFIX}/lib -ldb_cxx-4.8\" BDB_CFLAGS=\"-I${BDB_PREFIX}/include\" --without-gui\r\nmake check -j`nproc`\r\n```\r\n\r\nHowever, if I enable the gui package then it will fail with a segmentation fault inside a wallet test: \r\n\r\n```\r\n$ rg Error make_check.log\r\n212:2021-11-05Tmake[3]: *** [Makefile:18087: wallet/test/psbt_wallet_tests.cpp.test] Error 1\r\n3088:Error: A version conflict was detected between the run-time BerkeleyDB library and the one used during compilation.\r\n3094:2021-11-05T10:16:58.271290Z [test] [noui.cpp:43] [noui_ThreadSafeMessageBox] Error: A version conflict was detected between the run-time BerkeleyDB library and the one used during compilation.\r\n5964:Error: A version conflict was detected between the run-time BerkeleyDB library and the one used during compilation.\r\n5970:2021-11-05T10:16:58.309941Z [test] [noui.cpp:43] [noui_ThreadSafeMessageBox] Error: A version conflict was detected between the run-time BerkeleyDB library and the one used during compilation.\r\n8793:Error: A version conflict was detected between the run-time BerkeleyDB library and the one used during compilation.\r\n8799:2021-11-05T10:16:58.333933Z [test] [noui.cpp:43] [noui_ThreadSafeMessageBox] Error: A version conflict was detected between the run-time BerkeleyDB library and the one used during compilation.\r\n11533:Error: A version conflict was detected between the run-time BerkeleyDB library and the one used during compilation.\r\n11539:2021-11-05T10:16:58.356529Z [test] [noui.cpp:43] [noui_ThreadSafeMessageBox] Error: A version conflict was detected between the run-time BerkeleyDB library and the one used during compilation.\r\n11559:2021-11-05T10:16:58.357477Z [test] [txmempool.cpp:633] [check] Checking mempool with 0 make[3]: *** [Makefile:18086: wallet/test/wallet_tests.cpp.test] Error 1\r\n```\r\n[make_check.log](https://github.com/bitcoin/bitcoin/files/7484237/make_check.log)\r\n\r\n[config.log](https://github.com/bitcoin/bitcoin/files/7484242/config.log)\r\n\r\nThis is causing `make` to hang indefinitely, but one time it ran (somewhat) to completion and wrote the following to test-suite.log (which is usually more empty than this, containing only up to `FAIL`):\r\n\r\n```\r\n=============================================\r\n   Bitcoin Core 22.0.0: src/test-suite.log\r\n=============================================\r\n\r\n# TOTAL: 1\r\n# PASS:  0\r\n# SKIP:  0\r\n# XFAIL: 0\r\n# FAIL:  1\r\n# XPASS: 0\r\n# ERROR: 0\r\n\r\n.. contents:: :depth: 2\r\n\r\nFAIL: qt/test/test_bitcoin-qt\r\n=============================\r\n\r\nWarning: Ignoring XDG_SESSION_TYPE=wayland on Gnome. Use QT_QPA_PLATFORM=wayland to run on Wayland anyway.\r\n********* Start testing of AppTests *********\r\nConfig: Using QtTest library 5.15.2, Qt 5.15.2 (x86_64-little_endian-lp64 shared (dynamic) release build; by GCC 10.3.0), ubuntu 21.04\r\nPASS   : AppTests::initTestCase()\r\nError: A version conflict was detected between the run-time BerkeleyDB library and the one used during compilation.\r\nQINFO  : AppTests::appTests() Backing up GUI settings to \"/tmp/test_common_Bitcoin Core/321e4f587b345b4b1fb1314fd08629f45fc98e29e97937449a178d78d0cce606/regtest/guisettings.ini.bak\"\r\nError: A version conflict was detected between the run-time BerkeleyDB library and the one used during compilation.\r\nQWARN  : AppTests::appTests() This plugin does not support propagateSizeHints()\r\n\r\n=== Received signal at function time: 300000ms, total time: 300000ms, dumping stack ===\r\nGNU gdb (Ubuntu 10.1-2ubuntu2) 10.1.90.20210411-git\r\nCopyright (C) 2021 Free Software Foundation, Inc.\r\nLicense GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\r\nThis is free software: you are free to change and redistribute it.\r\nThere is NO WARRANTY, to the extent permitted by law.\r\nType \"show copying\" and \"show warranty\" for details.\r\nThis GDB was configured as \"x86_64-linux-gnu\".\r\nType \"show configuration\" for configuration details.\r\nFor bug reporting instructions, please see:\r\n<https://www.gnu.org/software/gdb/bugs/>.\r\nFind the GDB manual and other documentation resources online at:\r\n    <http://www.gnu.org/software/gdb/documentation/>.\r\n\r\nFor help, type \"help\".\r\nType \"apropos word\" to search for commands related to \"word\".\r\nAttaching to process 81650\r\n(gdb) === End of stack trace ===\r\nQFATAL : AppTests::appTests() Test function timed out\r\nFAIL!  : AppTests::appTests() Received a fatal error.\r\n   Loc: [Unknown file(0)]\r\nTotals: 1 passed, 1 failed, 0 skipped, 0 blacklisted, 300048ms\r\n********* Finished testing of AppTests *********\r\nFAIL qt/test/test_bitcoin-qt (exit status: 134)\r\n```\r\n\r\nIt is reproducible on my system currently, so let me know if there are any more pieces of info I can provide to help. I don't quite understand why BDB 5.3 is being touched at any point, despite them being system-installed...\r\n \r\n",
   "closed_at" : "2022-01-06T14:16:44Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
      "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
      "followers_url" : "https://api.github.com/users/willcl-ark/followers",
      "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
      "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/willcl-ark",
      "id" : 6606587,
      "login" : "willcl-ark",
      "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
      "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
      "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
      "repos_url" : "https://api.github.com/users/willcl-ark/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/willcl-ark"
   },
   "comments" : 6,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23442/comments",
   "created_at" : "2021-11-05T11:23:46Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23442/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/23442",
   "id" : 1045726031,
   "labels" : [
      {
         "color" : "FBBAAB",
         "default" : false,
         "description" : null,
         "id" : 64585,
         "name" : "Bug",
         "node_id" : "MDU6TGFiZWw2NDU4NQ==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug"
      },
      {
         "color" : "08a781",
         "default" : false,
         "description" : null,
         "id" : 149424,
         "name" : "Wallet",
         "node_id" : "MDU6TGFiZWwxNDk0MjQ=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet"
      },
      {
         "color" : "006688",
         "default" : false,
         "description" : null,
         "id" : 477890092,
         "name" : "Questions and Help",
         "node_id" : "MDU6TGFiZWw0Nzc4OTAwOTI=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Questions%20and%20Help"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23442/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "I_kwDOABII584-VINP",
   "number" : 23442,
   "performed_via_github_app" : null,
   "reactions" : {
      "+1" : 0,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 0,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23442/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23442/timeline",
   "title" : "Segfault when running `make check` with gui package enabled on Ubuntu 21.04",
   "updated_at" : "2022-01-06T14:16:44Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23442",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
      "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
      "followers_url" : "https://api.github.com/users/willcl-ark/followers",
      "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
      "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/willcl-ark",
      "id" : 6606587,
      "login" : "willcl-ark",
      "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
      "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
      "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
      "repos_url" : "https://api.github.com/users/willcl-ark/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/willcl-ark"
   }
}
