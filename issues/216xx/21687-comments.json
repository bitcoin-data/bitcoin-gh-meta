[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This would needs tests written. Also consistent failures on [CI](https://cirrus-ci.com/task/5790448116563968?logs=ci#L2751) and [linter](https://cirrus-ci.com/task/6159884023496704?logs=lint#L889)",
      "created_at" : "2021-04-15T05:29:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21687#issuecomment-820125027",
      "id" : 820125027,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21687",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMDEyNTAyNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-15T05:29:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/820125027",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23396902?v=4",
         "events_url" : "https://api.github.com/users/jarolrod/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jarolrod/followers",
         "following_url" : "https://api.github.com/users/jarolrod/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jarolrod/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jarolrod",
         "id" : 23396902,
         "login" : "jarolrod",
         "node_id" : "MDQ6VXNlcjIzMzk2OTAy",
         "organizations_url" : "https://api.github.com/users/jarolrod/orgs",
         "received_events_url" : "https://api.github.com/users/jarolrod/received_events",
         "repos_url" : "https://api.github.com/users/jarolrod/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jarolrod/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jarolrod/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jarolrod"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21687#discussion_r613948313"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613948313"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is untrue. All inbound connections have the same relay time assigned. See https://github.com/bitcoin/bitcoin/blob/c6b30ccb2eee5f80f844f79766591f0a1326ce43/src/net.cpp#L3014\r\n\r\nHaving multiple connections should be no different than a single one.",
      "commit_id" : "26af082294183d9c8d0c2a52374e5c0bc18f8610",
      "created_at" : "2021-04-15T10:22:48Z",
      "diff_hunk" : "@@ -1136,6 +1152,31 @@ void CConnman::CreateNodeFromAcceptedSocket(SOCKET hSocket,\n         }\n     }\n \n+\t// Currently, users can open multiple connections to a reachable node using the same IP address and a \n+\t// different port and request blockchain data at each connection. This behavior has the following impacts:\n+\t//   (1) Overwhelm the reachable node and consume its bandwidth by requesting data and discarding it\n+\t//     (see video demonstrations here: https://www.dropbox.com/s/pvasua7lnepdgfq/Occupy_Connections.mp4?dl=0\n+\t//     and https://www.dropbox.com/s/45ld1h7cxi3xzj6/RequestingBlockchain.mp4?dl=0)\n+\t//   (2) Undermine the transaction relaying anonymity since multiple connections to each node increase the\n+\t//     probability of mapping a transaction to an IP address (currently, the random delay factor in the\n+\t//     trickling effect implicitly assumes the attacker has one connection to each node). By establishing\n+\t//     multiple connections, the attacker undermines the anonymity property. ",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21687#discussion_r613948313",
      "id" : 613948313,
      "line" : 1163,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMzk0ODMxMw==",
      "original_commit_id" : "26af082294183d9c8d0c2a52374e5c0bc18f8610",
      "original_line" : 1163,
      "original_position" : 44,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 44,
      "pull_request_review_id" : 636523122,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21687",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-15T10:30:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613948313",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21687#discussion_r613950030"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613950030"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I didn't visit the website and I won't open this mp4, but a single inbound connection should be able to ask for the same data that multiple connections ask for.",
      "commit_id" : "26af082294183d9c8d0c2a52374e5c0bc18f8610",
      "created_at" : "2021-04-15T10:25:26Z",
      "diff_hunk" : "@@ -1136,6 +1152,31 @@ void CConnman::CreateNodeFromAcceptedSocket(SOCKET hSocket,\n         }\n     }\n \n+\t// Currently, users can open multiple connections to a reachable node using the same IP address and a \n+\t// different port and request blockchain data at each connection. This behavior has the following impacts:\n+\t//   (1) Overwhelm the reachable node and consume its bandwidth by requesting data and discarding it\n+\t//     (see video demonstrations here: https://www.dropbox.com/s/pvasua7lnepdgfq/Occupy_Connections.mp4?dl=0\n+\t//     and https://www.dropbox.com/s/45ld1h7cxi3xzj6/RequestingBlockchain.mp4?dl=0)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21687#discussion_r613950030",
      "id" : 613950030,
      "line" : 1159,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMzk1MDAzMA==",
      "original_commit_id" : "26af082294183d9c8d0c2a52374e5c0bc18f8610",
      "original_line" : 1159,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 40,
      "pull_request_review_id" : 636523122,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21687",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-15T10:30:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613950030",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21687#discussion_r614356780"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/614356780"
         }
      },
      "author_association" : "NONE",
      "body" : "Feasibly occupying multiple incoming connections using the same IP address will undermine the transaction anonymity property provisioned by the \"diffusion\" process. In the current deployment, a node announces a transaction to each connection after a certain delay. The assumption is that the adversary will not be able to infer the source of the transaction as it might receive the INV from another connection rather than the source (ref diffusion and exponential delay). \r\n\r\nIf an adversary occupies multiple incoming connections, the adversary can easily infer the source of the transaction, despite that delay (higher probability of receiving INV from the source rather than any other connection of that source). Allowing multiple incoming connections from the same IP address makes it a lot easier. ",
      "commit_id" : "26af082294183d9c8d0c2a52374e5c0bc18f8610",
      "created_at" : "2021-04-15T20:03:33Z",
      "diff_hunk" : "@@ -1136,6 +1152,31 @@ void CConnman::CreateNodeFromAcceptedSocket(SOCKET hSocket,\n         }\n     }\n \n+\t// Currently, users can open multiple connections to a reachable node using the same IP address and a \n+\t// different port and request blockchain data at each connection. This behavior has the following impacts:\n+\t//   (1) Overwhelm the reachable node and consume its bandwidth by requesting data and discarding it\n+\t//     (see video demonstrations here: https://www.dropbox.com/s/pvasua7lnepdgfq/Occupy_Connections.mp4?dl=0\n+\t//     and https://www.dropbox.com/s/45ld1h7cxi3xzj6/RequestingBlockchain.mp4?dl=0)\n+\t//   (2) Undermine the transaction relaying anonymity since multiple connections to each node increase the\n+\t//     probability of mapping a transaction to an IP address (currently, the random delay factor in the\n+\t//     trickling effect implicitly assumes the attacker has one connection to each node). By establishing\n+\t//     multiple connections, the attacker undermines the anonymity property. ",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21687#discussion_r614356780",
      "id" : 614356780,
      "in_reply_to_id" : 613948313,
      "line" : 1163,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNDM1Njc4MA==",
      "original_commit_id" : "26af082294183d9c8d0c2a52374e5c0bc18f8610",
      "original_line" : 1163,
      "original_position" : 44,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 44,
      "pull_request_review_id" : 637082004,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21687",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-15T20:03:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/614356780",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6090740?v=4",
         "events_url" : "https://api.github.com/users/beingmsaad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/beingmsaad/followers",
         "following_url" : "https://api.github.com/users/beingmsaad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/beingmsaad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/beingmsaad",
         "id" : 6090740,
         "login" : "beingmsaad",
         "node_id" : "MDQ6VXNlcjYwOTA3NDA=",
         "organizations_url" : "https://api.github.com/users/beingmsaad/orgs",
         "received_events_url" : "https://api.github.com/users/beingmsaad/received_events",
         "repos_url" : "https://api.github.com/users/beingmsaad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/beingmsaad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/beingmsaad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/beingmsaad"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21687#discussion_r614358042"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/614358042"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That's not correct. All incoming connections share the same Poisson timer for diffusion, so an attacker that creates multiple incoming connections should not be able to observe (significantly) more than with a single connection.",
      "commit_id" : "26af082294183d9c8d0c2a52374e5c0bc18f8610",
      "created_at" : "2021-04-15T20:05:50Z",
      "diff_hunk" : "@@ -1136,6 +1152,31 @@ void CConnman::CreateNodeFromAcceptedSocket(SOCKET hSocket,\n         }\n     }\n \n+\t// Currently, users can open multiple connections to a reachable node using the same IP address and a \n+\t// different port and request blockchain data at each connection. This behavior has the following impacts:\n+\t//   (1) Overwhelm the reachable node and consume its bandwidth by requesting data and discarding it\n+\t//     (see video demonstrations here: https://www.dropbox.com/s/pvasua7lnepdgfq/Occupy_Connections.mp4?dl=0\n+\t//     and https://www.dropbox.com/s/45ld1h7cxi3xzj6/RequestingBlockchain.mp4?dl=0)\n+\t//   (2) Undermine the transaction relaying anonymity since multiple connections to each node increase the\n+\t//     probability of mapping a transaction to an IP address (currently, the random delay factor in the\n+\t//     trickling effect implicitly assumes the attacker has one connection to each node). By establishing\n+\t//     multiple connections, the attacker undermines the anonymity property. ",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21687#discussion_r614358042",
      "id" : 614358042,
      "in_reply_to_id" : 613948313,
      "line" : 1163,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNDM1ODA0Mg==",
      "original_commit_id" : "26af082294183d9c8d0c2a52374e5c0bc18f8610",
      "original_line" : 1163,
      "original_position" : 44,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 44,
      "pull_request_review_id" : 637083767,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21687",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-15T20:05:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/614358042",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21687#discussion_r614363637"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/614363637"
         }
      },
      "author_association" : "NONE",
      "body" : "You are right. Any inbound connection should be able to request the same data that any other connection asks for. In that case, any effect on the bandwidth is perfectly fine. However, having multiple inbound connections from the same IP address makes it a lot easier for the adversary to overwhelm the bandwidth of the victim node. And this can be done easily through simple scripts without actually running a blockchain node. I have observed 33 incoming connections to my reachable node from the same IP address which raised a flag for me. \r\nAgain, the problem circle backs to allowing multiple incoming connections from the same IP address which needs to be addressed. ",
      "commit_id" : "26af082294183d9c8d0c2a52374e5c0bc18f8610",
      "created_at" : "2021-04-15T20:15:59Z",
      "diff_hunk" : "@@ -1136,6 +1152,31 @@ void CConnman::CreateNodeFromAcceptedSocket(SOCKET hSocket,\n         }\n     }\n \n+\t// Currently, users can open multiple connections to a reachable node using the same IP address and a \n+\t// different port and request blockchain data at each connection. This behavior has the following impacts:\n+\t//   (1) Overwhelm the reachable node and consume its bandwidth by requesting data and discarding it\n+\t//     (see video demonstrations here: https://www.dropbox.com/s/pvasua7lnepdgfq/Occupy_Connections.mp4?dl=0\n+\t//     and https://www.dropbox.com/s/45ld1h7cxi3xzj6/RequestingBlockchain.mp4?dl=0)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21687#discussion_r614363637",
      "id" : 614363637,
      "in_reply_to_id" : 613950030,
      "line" : 1159,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNDM2MzYzNw==",
      "original_commit_id" : "26af082294183d9c8d0c2a52374e5c0bc18f8610",
      "original_line" : 1159,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 40,
      "pull_request_review_id" : 637091290,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21687",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-15T20:15:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/614363637",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6090740?v=4",
         "events_url" : "https://api.github.com/users/beingmsaad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/beingmsaad/followers",
         "following_url" : "https://api.github.com/users/beingmsaad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/beingmsaad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/beingmsaad",
         "id" : 6090740,
         "login" : "beingmsaad",
         "node_id" : "MDQ6VXNlcjYwOTA3NDA=",
         "organizations_url" : "https://api.github.com/users/beingmsaad/orgs",
         "received_events_url" : "https://api.github.com/users/beingmsaad/received_events",
         "repos_url" : "https://api.github.com/users/beingmsaad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/beingmsaad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/beingmsaad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/beingmsaad"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21687#discussion_r614390824"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/614390824"
         }
      },
      "author_association" : "NONE",
      "body" : "Thanks Pieter. A test case would be to (1) set up a reachable node (say A), (2) find its outgoing connections (getpeerinfo), (3) establish one connection to each of A's outgoing connections, (4) establish multiple connections to A (say 30), and (5) generate a transaction from A and see how much can be inferred. I can do this experiment on my nodes and get back to you with the results. \r\n\r\nYou have pointed out that that attacker will not be able to observe (significantly) more than with a single connection. Does significantly mean a probability in k where k is the total number of incoming connections? ",
      "commit_id" : "26af082294183d9c8d0c2a52374e5c0bc18f8610",
      "created_at" : "2021-04-15T21:05:01Z",
      "diff_hunk" : "@@ -1136,6 +1152,31 @@ void CConnman::CreateNodeFromAcceptedSocket(SOCKET hSocket,\n         }\n     }\n \n+\t// Currently, users can open multiple connections to a reachable node using the same IP address and a \n+\t// different port and request blockchain data at each connection. This behavior has the following impacts:\n+\t//   (1) Overwhelm the reachable node and consume its bandwidth by requesting data and discarding it\n+\t//     (see video demonstrations here: https://www.dropbox.com/s/pvasua7lnepdgfq/Occupy_Connections.mp4?dl=0\n+\t//     and https://www.dropbox.com/s/45ld1h7cxi3xzj6/RequestingBlockchain.mp4?dl=0)\n+\t//   (2) Undermine the transaction relaying anonymity since multiple connections to each node increase the\n+\t//     probability of mapping a transaction to an IP address (currently, the random delay factor in the\n+\t//     trickling effect implicitly assumes the attacker has one connection to each node). By establishing\n+\t//     multiple connections, the attacker undermines the anonymity property. ",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21687#discussion_r614390824",
      "id" : 614390824,
      "in_reply_to_id" : 613948313,
      "line" : 1163,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNDM5MDgyNA==",
      "original_commit_id" : "26af082294183d9c8d0c2a52374e5c0bc18f8610",
      "original_line" : 1163,
      "original_position" : 44,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 44,
      "pull_request_review_id" : 637127893,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21687",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-15T21:05:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/614390824",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6090740?v=4",
         "events_url" : "https://api.github.com/users/beingmsaad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/beingmsaad/followers",
         "following_url" : "https://api.github.com/users/beingmsaad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/beingmsaad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/beingmsaad",
         "id" : 6090740,
         "login" : "beingmsaad",
         "node_id" : "MDQ6VXNlcjYwOTA3NDA=",
         "organizations_url" : "https://api.github.com/users/beingmsaad/orgs",
         "received_events_url" : "https://api.github.com/users/beingmsaad/received_events",
         "repos_url" : "https://api.github.com/users/beingmsaad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/beingmsaad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/beingmsaad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/beingmsaad"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21687#discussion_r614393006"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/614393006"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@beingmsaad That would be interesting to get data on!\r\n\r\nThe only gain you should get from having multiple incoming connections vs. just a single one is avoiding more internal latency/processing delay in the message processing loop. I.e., if CPU speed was infinite, there should be no gain at all. \r\n\r\nI mention \"significantly\" because it's not necessarily true in reality that it's literally no data, but at best I expect that you'd quickly converge towards a small constant factor better accuracy than a single one (maybe a few percent; perhaps a bit more on nodes that are relatively loaded). Of course, if this intuition is wrong I'd very much like to know.",
      "commit_id" : "26af082294183d9c8d0c2a52374e5c0bc18f8610",
      "created_at" : "2021-04-15T21:09:05Z",
      "diff_hunk" : "@@ -1136,6 +1152,31 @@ void CConnman::CreateNodeFromAcceptedSocket(SOCKET hSocket,\n         }\n     }\n \n+\t// Currently, users can open multiple connections to a reachable node using the same IP address and a \n+\t// different port and request blockchain data at each connection. This behavior has the following impacts:\n+\t//   (1) Overwhelm the reachable node and consume its bandwidth by requesting data and discarding it\n+\t//     (see video demonstrations here: https://www.dropbox.com/s/pvasua7lnepdgfq/Occupy_Connections.mp4?dl=0\n+\t//     and https://www.dropbox.com/s/45ld1h7cxi3xzj6/RequestingBlockchain.mp4?dl=0)\n+\t//   (2) Undermine the transaction relaying anonymity since multiple connections to each node increase the\n+\t//     probability of mapping a transaction to an IP address (currently, the random delay factor in the\n+\t//     trickling effect implicitly assumes the attacker has one connection to each node). By establishing\n+\t//     multiple connections, the attacker undermines the anonymity property. ",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21687#discussion_r614393006",
      "id" : 614393006,
      "in_reply_to_id" : 613948313,
      "line" : 1163,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNDM5MzAwNg==",
      "original_commit_id" : "26af082294183d9c8d0c2a52374e5c0bc18f8610",
      "original_line" : 1163,
      "original_position" : 44,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 44,
      "pull_request_review_id" : 637130690,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21687",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-15T21:17:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/614393006",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21687#discussion_r614397316"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/614397316"
         }
      },
      "author_association" : "NONE",
      "body" : "@sipa I will get some data on it and share it with you (possibly over the weekend). Will generate a few transactions in the testnet and see how much can be inferred by making 2-30 incoming connections. ",
      "commit_id" : "26af082294183d9c8d0c2a52374e5c0bc18f8610",
      "created_at" : "2021-04-15T21:17:25Z",
      "diff_hunk" : "@@ -1136,6 +1152,31 @@ void CConnman::CreateNodeFromAcceptedSocket(SOCKET hSocket,\n         }\n     }\n \n+\t// Currently, users can open multiple connections to a reachable node using the same IP address and a \n+\t// different port and request blockchain data at each connection. This behavior has the following impacts:\n+\t//   (1) Overwhelm the reachable node and consume its bandwidth by requesting data and discarding it\n+\t//     (see video demonstrations here: https://www.dropbox.com/s/pvasua7lnepdgfq/Occupy_Connections.mp4?dl=0\n+\t//     and https://www.dropbox.com/s/45ld1h7cxi3xzj6/RequestingBlockchain.mp4?dl=0)\n+\t//   (2) Undermine the transaction relaying anonymity since multiple connections to each node increase the\n+\t//     probability of mapping a transaction to an IP address (currently, the random delay factor in the\n+\t//     trickling effect implicitly assumes the attacker has one connection to each node). By establishing\n+\t//     multiple connections, the attacker undermines the anonymity property. ",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21687#discussion_r614397316",
      "id" : 614397316,
      "in_reply_to_id" : 613948313,
      "line" : 1163,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNDM5NzMxNg==",
      "original_commit_id" : "26af082294183d9c8d0c2a52374e5c0bc18f8610",
      "original_line" : 1163,
      "original_position" : 44,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 44,
      "pull_request_review_id" : 637136984,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21687",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-15T21:17:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/614397316",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6090740?v=4",
         "events_url" : "https://api.github.com/users/beingmsaad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/beingmsaad/followers",
         "following_url" : "https://api.github.com/users/beingmsaad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/beingmsaad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/beingmsaad",
         "id" : 6090740,
         "login" : "beingmsaad",
         "node_id" : "MDQ6VXNlcjYwOTA3NDA=",
         "organizations_url" : "https://api.github.com/users/beingmsaad/orgs",
         "received_events_url" : "https://api.github.com/users/beingmsaad/received_events",
         "repos_url" : "https://api.github.com/users/beingmsaad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/beingmsaad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/beingmsaad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/beingmsaad"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21687#discussion_r614542575"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/614542575"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "If these videos contain any relevant rationale for this PR, consider sharing that information as text instead (and then remove the links).\r\n\r\nFor security reasons I don't think many regular contributors to this project (which tend to be highly security/OPSEC conscious) would be willing to download and open an MP4 file which is bit-by-bit controlled by an untrusted uploader. FWIW, these lists are pretty long/scary https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=vlc and https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=ffmpeg :)\r\n\r\nThe above is a general observation: I'm _not_ claiming that there is anything fishy with these specific MP4 files. ",
      "commit_id" : "26af082294183d9c8d0c2a52374e5c0bc18f8610",
      "created_at" : "2021-04-16T03:53:09Z",
      "diff_hunk" : "@@ -1136,6 +1152,31 @@ void CConnman::CreateNodeFromAcceptedSocket(SOCKET hSocket,\n         }\n     }\n \n+\t// Currently, users can open multiple connections to a reachable node using the same IP address and a \n+\t// different port and request blockchain data at each connection. This behavior has the following impacts:\n+\t//   (1) Overwhelm the reachable node and consume its bandwidth by requesting data and discarding it\n+\t//     (see video demonstrations here: https://www.dropbox.com/s/pvasua7lnepdgfq/Occupy_Connections.mp4?dl=0",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21687#discussion_r614542575",
      "id" : 614542575,
      "line" : 1158,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNDU0MjU3NQ==",
      "original_commit_id" : "26af082294183d9c8d0c2a52374e5c0bc18f8610",
      "original_line" : 1158,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 39,
      "pull_request_review_id" : 637310235,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21687",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-16T03:54:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/614542575",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21687#discussion_r614554801"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/614554801"
         }
      },
      "author_association" : "NONE",
      "body" : "@practicalswift Sure. Actually, we have a research paper in submission. The submission is double-blind and usually, reviewers do not have time to go through data. Hence, I just did a screen recording and uploaded it. \r\n\r\nHere is what happens in the two videos. (1) A lightweight scrip occupies all the incoming connections of our reachable node using the same IP address and multiple ports (there are 65K ports on a commodity computer. An adversary can potentially make 64K outgoing connections using a single machine). (2) The second video shows each of those incoming connections continuously requesting block headers from our reachable node and discarding them. As a result, the node's bandwidth is exhausted while the adversary does not have to store anything. The adversary just keeps requesting block headers through each connection and discards them. \r\n\r\n\r\nAlso important to mention is that the idea came to mind since I do blockchain synchronization analysis (i.e, execute getpeerinfo to see who has the up-to-date chain). During that analysis, I found 33 incoming connections from the same IP address, and they remained connected for 21 hours. That's when I started looking into this. ",
      "commit_id" : "26af082294183d9c8d0c2a52374e5c0bc18f8610",
      "created_at" : "2021-04-16T04:39:01Z",
      "diff_hunk" : "@@ -1136,6 +1152,31 @@ void CConnman::CreateNodeFromAcceptedSocket(SOCKET hSocket,\n         }\n     }\n \n+\t// Currently, users can open multiple connections to a reachable node using the same IP address and a \n+\t// different port and request blockchain data at each connection. This behavior has the following impacts:\n+\t//   (1) Overwhelm the reachable node and consume its bandwidth by requesting data and discarding it\n+\t//     (see video demonstrations here: https://www.dropbox.com/s/pvasua7lnepdgfq/Occupy_Connections.mp4?dl=0",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21687#discussion_r614554801",
      "id" : 614554801,
      "in_reply_to_id" : 614542575,
      "line" : 1158,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNDU1NDgwMQ==",
      "original_commit_id" : "26af082294183d9c8d0c2a52374e5c0bc18f8610",
      "original_line" : 1158,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 39,
      "pull_request_review_id" : 637323873,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21687",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-16T04:39:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/614554801",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6090740?v=4",
         "events_url" : "https://api.github.com/users/beingmsaad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/beingmsaad/followers",
         "following_url" : "https://api.github.com/users/beingmsaad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/beingmsaad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/beingmsaad",
         "id" : 6090740,
         "login" : "beingmsaad",
         "node_id" : "MDQ6VXNlcjYwOTA3NDA=",
         "organizations_url" : "https://api.github.com/users/beingmsaad/orgs",
         "received_events_url" : "https://api.github.com/users/beingmsaad/received_events",
         "repos_url" : "https://api.github.com/users/beingmsaad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/beingmsaad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/beingmsaad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/beingmsaad"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21687#discussion_r614556824"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/614556824"
         }
      },
      "author_association" : "NONE",
      "body" : "@practicalswift Additional caveat (alongside bandwidth exhaustion) is the risk of transaction deanonymization. I am currently conducting experiments on that. \r\n\r\n33 incoming connections from one IP address for 21 hours looked fishy. So I reached out to @am33r who deployed 1 connection per IP policy to stop that. ",
      "commit_id" : "26af082294183d9c8d0c2a52374e5c0bc18f8610",
      "created_at" : "2021-04-16T04:46:48Z",
      "diff_hunk" : "@@ -1136,6 +1152,31 @@ void CConnman::CreateNodeFromAcceptedSocket(SOCKET hSocket,\n         }\n     }\n \n+\t// Currently, users can open multiple connections to a reachable node using the same IP address and a \n+\t// different port and request blockchain data at each connection. This behavior has the following impacts:\n+\t//   (1) Overwhelm the reachable node and consume its bandwidth by requesting data and discarding it\n+\t//     (see video demonstrations here: https://www.dropbox.com/s/pvasua7lnepdgfq/Occupy_Connections.mp4?dl=0",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21687#discussion_r614556824",
      "id" : 614556824,
      "in_reply_to_id" : 614542575,
      "line" : 1158,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNDU1NjgyNA==",
      "original_commit_id" : "26af082294183d9c8d0c2a52374e5c0bc18f8610",
      "original_line" : 1158,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 39,
      "pull_request_review_id" : 637326207,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21687",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-16T04:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/614556824",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6090740?v=4",
         "events_url" : "https://api.github.com/users/beingmsaad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/beingmsaad/followers",
         "following_url" : "https://api.github.com/users/beingmsaad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/beingmsaad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/beingmsaad",
         "id" : 6090740,
         "login" : "beingmsaad",
         "node_id" : "MDQ6VXNlcjYwOTA3NDA=",
         "organizations_url" : "https://api.github.com/users/beingmsaad/orgs",
         "received_events_url" : "https://api.github.com/users/beingmsaad/received_events",
         "repos_url" : "https://api.github.com/users/beingmsaad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/beingmsaad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/beingmsaad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/beingmsaad"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "So there could be a number of explanations why someone would want to do this.\n\nOne is that perhaps they simply don't know that multiple connections doesn't really add accuracy to transaction announcements. This synchronization of inbound poisson timers was only added a few releases ago, specifically in response to observing deanonymizers making multiple connections (from the same IP, or from multiple).\n\nAnother is to increase the strength of bandwidth or other resource exhaustion attacks. I believe that this indeed helps the attacker, but I'm not sure how much. Our protection against volumetric DoS attacks against individual nodes is low, and it should be almost as easily be possible to perform them with a single connection.\n\nAs for disallowing multiple connections from the same IP:\n* When incoming transaction slots run out, we already prioritize peers from varied IP ranges, and so multiple connections from the same IP would already be preferred for disconnection. It works per IP range, because it's believed that in general it's cheap for attackers to get access to multiple IPs in the same range already.\n* If we're actually observing attacks in the wild (especially effective DoS attacks), we should obviously do something against that; your solution is one, but it's fairly aggressive.\n* A slightly less aggressive solution would be added to the inbound prioritization logic a feature that prefers disconnecting multiple connections from the same IP (even more than multiple connections from the same IP range).\n* If we'd actually want to refuse like you propose here, it would need a bunch of safeguards (e.g. localhost would need to be excluded, because many local services may connect directly locally; also it should be able to bypass this policy using net permissions like NOBAN",
      "created_at" : "2021-04-16T05:01:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21687#issuecomment-820907002",
      "id" : 820907002,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21687",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMDkwNzAwMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-16T05:01:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/820907002",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@sipa I completely agree with the policy being aggressive. My bigger concern however was that no two unreachable nodes behind NAT will be able to connect to the same reachable node. Now there are two approaches to find an optimal solution.\r\n\r\n(1) The current connection eviction policy. I am currently reviewing it to see if there is a chance of it being a double-edged sword. If we evict adversary's connections (assuming adversary exploits 1 IP 64K ports weakness), the adversary can also evict benign connections among honest nodes by switching IP addresses. There are great safeguards in place right now (i.e., protecting a subset of peers that relay blocks to us). But again, if an adversary arbitrarily disconnects a connection between two honest nodes, we wouldn't want that. I am stress testing the connection eviction logic on my node right now and will update you if I come across a problem.\r\n\r\n(2) The second approach is to find a middle ground. Can we allow x number of incoming connections from the same IP address such that the policy is not really aggressive and we also support NATed nodes. For that purpose, I have been connecting to reachable nodes and monitoring IP Addresses in the ADDR response. The last I checked (November 2020), the ratio between reachable and unreachable nodes was 1:5. We can test that approach (i.e., by setting x=5, we do not risk deanonymization, support the unreachable nodes behind NAT, and local host support for onioncat). \r\n\r\nA minor concern that I have with the eviction logic is that it only comes into play when all incoming connections are occupied. If a node has 10 incoming connections right now, the adversary can occupy (117-10) and stay connected. The eviction logic will only slowly get rid of the adversary. ",
      "created_at" : "2021-04-16T05:28:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21687#issuecomment-820916278",
      "id" : 820916278,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21687",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMDkxNjI3OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-16T05:28:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/820916278",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6090740?v=4",
         "events_url" : "https://api.github.com/users/beingmsaad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/beingmsaad/followers",
         "following_url" : "https://api.github.com/users/beingmsaad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/beingmsaad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/beingmsaad",
         "id" : 6090740,
         "login" : "beingmsaad",
         "node_id" : "MDQ6VXNlcjYwOTA3NDA=",
         "organizations_url" : "https://api.github.com/users/beingmsaad/orgs",
         "received_events_url" : "https://api.github.com/users/beingmsaad/received_events",
         "repos_url" : "https://api.github.com/users/beingmsaad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/beingmsaad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/beingmsaad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/beingmsaad"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@sipa Also, \"A slightly less aggressive solution would be added to the inbound prioritization logic a feature that prefers disconnecting multiple connections from the same IP (even more than multiple connections from the same IP range)\" looks like a great approach indeed. ",
      "created_at" : "2021-04-16T05:34:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21687#issuecomment-820918792",
      "id" : 820918792,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21687",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMDkxODc5Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-16T05:34:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/820918792",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6090740?v=4",
         "events_url" : "https://api.github.com/users/beingmsaad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/beingmsaad/followers",
         "following_url" : "https://api.github.com/users/beingmsaad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/beingmsaad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/beingmsaad",
         "id" : 6090740,
         "login" : "beingmsaad",
         "node_id" : "MDQ6VXNlcjYwOTA3NDA=",
         "organizations_url" : "https://api.github.com/users/beingmsaad/orgs",
         "received_events_url" : "https://api.github.com/users/beingmsaad/received_events",
         "repos_url" : "https://api.github.com/users/beingmsaad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/beingmsaad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/beingmsaad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/beingmsaad"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I pretty much agree with @MarcoFalke and @sipa above, but won't add extra noise by rephrasing their arguments.\r\nI would love to see improvements to bandwidth DoS and transactional privacy, but this PR in the current shape I think is not a good solution to either problem.\r\n",
      "created_at" : "2021-04-16T09:41:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21687#issuecomment-821054881",
      "id" : 821054881,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21687",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMTA1NDg4MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-16T09:41:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/821054881",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "The decision to not do this was very much intentional.  There are some cases where whole countries (e.g. Qatar) access the internet from behind one or just a few IPs-- likewise for many institutions.   Hard prohibiting would allow attackers that can make connections behind these to easily totally deny everyone else behind their firewall from connecting-- just mass connect with a single connection to every node and then with the help of this policy anyone else will be unable to connect to anyone.\r\n\r\nNo matter what is done with IP filtering attackers can still make multiple connections. There are even commercial services that specialize in providing IPs in different net blocks for attacking P2P networks,  and of course any large botnet could proxy connections through hundreds of thousands of IPs -- people sometimes use these casually just to be nussances on the Bitcoin IRC channels.\r\n\r\nThere are at least two known networks that attack the Bitcoin network using multiple entire /24s *today* -- and even one is enough to use every connection slot. Any attack that would be prevented by this PR would immediately again be possible for an attacker after get got access to 125 IPs which even random scriptkiddies can do with moderate effort, and pretty much every IPv6 user can do trivially.\r\n\r\nSo. in general. the system must be robust against attackers that make multiple connections, and still must be just as robust against it no matter what per IP limits there are.  AFAIK it largely is robust and parts of it that aren't need to be be fixed rather than patched around with a known-false assumption that attackers can't just get a /25 to attack with (super duper false for IPv6 :) ).\r\n\r\nAs a minor concession to deal with idiots wasting resources,  non-protected peers on the same hosts are prioritized for disconnection in the eviction logic.\r\n\r\nI believe the above comment about repeating doesn't hold because after protected peers are removed it's the youngest peer that is eliminated.\r\n\r\n> (2) Undermine the transaction relaying anonymity since multiple connections to each node increase the probability of mapping a transaction to an IP address (currently, the random delay factor in the trickling effect implicitly assumes the attacker has one connection to each node). \r\n\r\nThis is false by the system's design.  All incoming peers share the same delay pool because it is known that attackers can and do use multiple connections. If there is some sidechannel that bypasses this, it needs to be fixed.\r\n\r\n",
      "created_at" : "2021-04-18T00:24:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21687#issuecomment-821907601",
      "id" : 821907601,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21687",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMTkwNzYwMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-18T00:24:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/821907601",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I did some experiments today and found that incoming connections indeed share the same delay pool (modulo the minor variations incorporated by network delays). Here is what I did. Correct me if there are lapses in the approach. \r\n\r\n(1) I set up a reachable node (A) with 7 outbound connections (B1...B7).\r\n(2) Using a script on another machine, I established 25 outbound connections (C1...C25 --> same IP address and different ports) to A and 1 outbound connection to each B1... B7. \r\n(3) I conducted two standalone experiments in which I  generated 10 transactions and 9 transactions from node A, respectively. Then, I applied the following heuristic to analyze \"the degree of deanonymization (if any)  achieved in both experiments.\r\n\r\n**Heuristic:** If A is the source of transaction, then any node in C1...C25 will receive that transaction from A before receiving it from any node in B1...B7. Conversely, for all transactions not generated by A, but relayed by A and B1...B7, all nodes in C1..C25 will receive them from any node in (B1...B7) before receiving it from A. \r\n\r\nSo far, the results show that among 10+9= 19 transactions generated by A, (7+6 = 13) mapped on Heuristic 1. Among the other 15 transactions not generated by A but relayed by A and B1..B7, C1..C25 received (14/15) from B1...B7, before receiving them from A. (I could have done a better job explaining heuristic and results mathematically using Latex, but I hope the meaning comes across clearly). I will double-check the results for accuracy just in case something is missing. Two connections in B1...B7 crashed in the middle of the experiment, so that needs to be corrected as well. \r\n\r\nShare your comments/thoughts on the aforementioned results. If the approach is meaningful, then is 13/19 (68%) accuracy good? Please also suggest ways in which to further broaden the scope of the experiment (I am planning to connect a random set of nodes D1..Dx) to which A is not connected and also do some timestamping as a control. \r\n\r\nThe overarching idea is to analyze how much an adversary can infer about the source of a transaction by establishing multiple incoming connections to a node (made more feasible by 1IP + 65K ports)? \r\n\r\nRe Connection Patterns from Qatar: There is a natural caveat of Nakamoto consensus desynchronization (global vs local) if all nodes behind NAT connect to the same set of reachable nodes. I will elaborate on that later. \r\n\r\nRe Sidechannels: Good suggestion. One way to explore side-channel attacks would be to look at the variance in transaction timestamps when (1) transactions are relayed by the source, and (2) not relayed by the source, given the delay pool inbound connections is the same. I will look into that. \r\n",
      "created_at" : "2021-04-18T21:11:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21687#issuecomment-822062420",
      "id" : 822062420,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21687",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMjA2MjQyMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-18T21:11:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/822062420",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6090740?v=4",
         "events_url" : "https://api.github.com/users/beingmsaad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/beingmsaad/followers",
         "following_url" : "https://api.github.com/users/beingmsaad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/beingmsaad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/beingmsaad",
         "id" : 6090740,
         "login" : "beingmsaad",
         "node_id" : "MDQ6VXNlcjYwOTA3NDA=",
         "organizations_url" : "https://api.github.com/users/beingmsaad/orgs",
         "received_events_url" : "https://api.github.com/users/beingmsaad/received_events",
         "repos_url" : "https://api.github.com/users/beingmsaad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/beingmsaad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/beingmsaad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/beingmsaad"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Thanks, everyone for pitching in. \r\nThe current PR was aimed at highlighting a few caveats in 1IP and 65K connections. \r\nBased on the feedback, there are a few things that clearly standout. (1) The policy can be made less aggressive by allowing a few connections from the same IP address or the same netgroup as @sipa pointed out. (2) @beingmsaad also highlighted the gap between reachable and unreachable nodes (IP addresses received in Addr response) to find an optimistic bound on the policy. I will explore both avenues. \r\n\r\nIt is clear that an adversary can use proxies or strong adversaries like ASes and ISPs can exhaust connection limits. However, the current design makes it a lot easier given an adversary needs just one IP and all the ports available on the adversary's machine. \r\n\r\nI am also curious to know one more thing that could be a DoS attempt and if current Bitcoin Core design takes care of that (@beingmsaad and @sipa). \r\n\r\nIf an attacker makes 15 connections from the same address and requests the blockchain and discards whatever it receives. Assume the attacker has received the entire chain and then repeats all the requests. Is there a mechanism in place to prevent that? Since we have already relayed those blocks to that connection, requesting them multiple times (and discarding them on reception) is bandwidth exhausting attempt on a victim node.",
      "created_at" : "2021-04-18T21:25:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21687#issuecomment-822064460",
      "id" : 822064460,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21687",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMjA2NDQ2MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-18T21:25:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/822064460",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6051784?v=4",
         "events_url" : "https://api.github.com/users/am33r/events{/privacy}",
         "followers_url" : "https://api.github.com/users/am33r/followers",
         "following_url" : "https://api.github.com/users/am33r/following{/other_user}",
         "gists_url" : "https://api.github.com/users/am33r/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/am33r",
         "id" : 6051784,
         "login" : "am33r",
         "node_id" : "MDQ6VXNlcjYwNTE3ODQ=",
         "organizations_url" : "https://api.github.com/users/am33r/orgs",
         "received_events_url" : "https://api.github.com/users/am33r/received_events",
         "repos_url" : "https://api.github.com/users/am33r/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/am33r/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/am33r/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/am33r"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> If an attacker makes 15 connections from the same address and requests the blockchain and discards whatever it receives. Assume the attacker has received the entire chain and then repeats all the requests. Is there a mechanism in place to prevent that?\n\nNo, there isn't; our protections against DoS attacks of this nature (ones where the attacker and victim have similar resource costs, against a single victim at a time) is very low. But my belief is that doing the same attack with just one connection will cause just as much harm as doing it with 15; in both cases whatever the bottleneck is (disk I/O, network bandwidth, CPU usage, ...) will be maxed out, and the rest won't be.\n\nWhere attackers with many connection matters is in their ability to prevent a node from using connection slots for honest peers instead. I think Bitcoin Core has fairly good defenses against this effect already, as such peer would be prioritized for disconnection already.\n\nLonger term I believe the solution against volumetric DoS attacks like these is keeping track of how many resources are spent on each peer, and slowing down processing of the worst ones whenever those resources run out. I don't believe the longer term solution is playing cat-and-mouse games; specializing multiple connections from a single IP is just going to result in attackers using ranges of IP addresses instead as @gmaxwell mentions (especially with increasing IPv6 availability, this is trivial).",
      "created_at" : "2021-04-18T21:33:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21687#issuecomment-822065487",
      "id" : 822065487,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21687",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMjA2NTQ4Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-18T21:34:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/822065487",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> Specializing multiple connections from a single IP is just going to result in attackers using ranges of IP addresses instead as @gmaxwell mentions (especially with increasing IPv6 availability, this is trivial).\r\n\r\nI agree with @gmaxwell's observation. However, wouldn't it be more desirable to force the adversary to acquire a range of IP addresses in the given threat model rather than achieving the same goal with just 1 IP address? \r\n",
      "created_at" : "2021-04-18T22:04:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21687#issuecomment-822069375",
      "id" : 822069375,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21687",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMjA2OTM3NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-18T22:04:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/822069375",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6090740?v=4",
         "events_url" : "https://api.github.com/users/beingmsaad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/beingmsaad/followers",
         "following_url" : "https://api.github.com/users/beingmsaad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/beingmsaad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/beingmsaad",
         "id" : 6090740,
         "login" : "beingmsaad",
         "node_id" : "MDQ6VXNlcjYwOTA3NDA=",
         "organizations_url" : "https://api.github.com/users/beingmsaad/orgs",
         "received_events_url" : "https://api.github.com/users/beingmsaad/received_events",
         "repos_url" : "https://api.github.com/users/beingmsaad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/beingmsaad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/beingmsaad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/beingmsaad"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> However, wouldn't it be more desirable to force the adversary to acquire a range of IP addresses in the given threat model rather than achieving the same goal with just 1 IP address?\r\n\r\nIf there are concrete attacks right now that make use of multiple connections per IP (in a way where the attacker actually gains an advantage by using multiple connections), yes.\r\n\r\nBut I do expect that in the longer term, if there is better generic DoS protection, there won't be an advantage anymore for attackers to do so.",
      "created_at" : "2021-04-18T23:50:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21687#issuecomment-822088133",
      "id" : 822088133,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21687",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMjA4ODEzMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-18T23:50:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/822088133",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> If there are concrete attacks right now that make use of multiple connections per IP (in a way where the attacker actually gains an advantage by using multiple connections), yes.\r\n\r\nEven if there are it has to be weighed against the cost of amplifying other attacks by making it easier for an attacker to deny connectivity to the network for other parties sharing his NAT.  My thought is that even reasoning about that isn't worth the benefit, better to fix the attacks directly since it needs to be fixed regardless as it's really easy to get a hundred IPs.\r\n\r\n>  If the approach is meaningful, then is 13/19 (68%) accuracy good?\r\n\r\nI don't see how this test is useful.   I think a useful test would have a network of nodes and two equal attackers. The attackers don't relay transactions.  One attacker makes 25 connections to each target, the other attacker makes 1 connection to each target.  Attackers attribute transactions to the first node they heard the connection from.   Then you want to ask if the attacker is identifying the actual origin more often and if the difference is statistically significant.\r\n\r\nInstead, if I've understood your description you've just implemented an attacker with many connections and asked how often the true origin showed up.   This doesn't tell you anything about the relative advantage of one or many connections.\r\n\r\nThe fact that txn will come slightly more often from the actual source rather than some graph of other peers is expected but doesn't have anything to do with one or many connections. The privacy provided is much stronger for single and infrequent txn than it is for some transaction firehose. :)\r\n\r\n> connect to the same set of reachable nodes.\r\n\r\nThe concern wasn't so much that they be able to connect to the same set of nodes in ordinary usage, but rather that an attacker can aggressively connect to *all* reachable nodes and thereby completely deny service to its same network siblings (with the proposed change) or allow the attacker to only connect to a small number of nodes they control.   The attack is cheap for the attacker and not very obvious -- even to the victim except for the fact that most places they try to connect to disconnect them.\r\n\r\nIt's better if they connect to different nodes, but the sheer number of nodes means that honest participants will mostly do so in any case. Its attackers you need to worry about.\r\n",
      "created_at" : "2021-04-21T01:25:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21687#issuecomment-823707688",
      "id" : 823707688,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21687",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMzcwNzY4OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-21T01:25:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/823707688",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I am going to close this for now, because this connection policy wouldn't make sense for us. Though, feel free to continue discussion here.\r\n\r\nImprovements to the eviction logic or improving the scheduler to prioritize \"good\" peers (and thus de-prioritize \"bad\" peers) are welcome.",
      "created_at" : "2021-04-21T05:15:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21687#issuecomment-823782467",
      "id" : 823782467,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21687",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMzc4MjQ2Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-21T05:15:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/823782467",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
