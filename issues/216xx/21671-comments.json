[
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. We should also update the [`HOSTS` listing](https://github.com/bitcoin/bitcoin/tree/master/contrib/guix#as-a-tool-for-deterministic-builds) in the Guix README.",
      "created_at" : "2021-04-14T02:13:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21671#issuecomment-819170898",
      "id" : 819170898,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21671",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxOTE3MDg5OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-14T02:13:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/819170898",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Pushed c9ea4c79c3dfb6418bc3a5b6533d81ac94793e65 -> 9e4e638750fb17abb173aae2f6a33d838befd7c3\r\n- Addressed: https://github.com/bitcoin/bitcoin/pull/21671#issuecomment-819170898",
      "created_at" : "2021-04-14T14:13:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21671#issuecomment-819550942",
      "id" : 819550942,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21671",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxOTU1MDk0Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-14T14:13:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/819550942",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. Using canonicalized architecture tuples makes sense, I guess, it's good to rule out ambiguity when the architecture (at least the part that we care about) is the same but have slightly different tuples. I think the whole thing (architecture tuples in general, I mean) is a mess but that's how it is.",
      "created_at" : "2021-04-14T15:05:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21671#issuecomment-819591053",
      "id" : 819591053,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21671",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxOTU5MTA1Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-14T15:11:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/819591053",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #22392 by fanquake\n* #22365 by dongcarl\n* #22237 by dgoncharov\n* #21711 by dongcarl\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-04-29T07:25:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21671#issuecomment-829002367",
      "id" : 829002367,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21671",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyOTAwMjM2Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-02T23:00:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/829002367",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated to be based on: #21799",
      "created_at" : "2021-05-04T15:50:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21671#issuecomment-832048008",
      "id" : 832048008,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21671",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgzMjA0ODAwOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-04T15:50:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/832048008",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Pushed 69d4d9ca9b5d51ef4db04d486333aefab2fdf2e1 -> aa0f83283504c69b57ea20f4cb127c4ec4d993f3\r\n- Rebased after merge of #21799",
      "created_at" : "2021-05-07T19:42:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21671#issuecomment-834727600",
      "id" : 834727600,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21671",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgzNDcyNzYwMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-07T19:42:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/834727600",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK aa0f83283504c69b57ea20f4cb127c4ec4d993f3",
      "created_at" : "2021-06-03T12:48:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21671#issuecomment-853841975",
      "id" : 853841975,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21671",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg1Mzg0MTk3NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-03T12:48:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/853841975",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Tested that hosts are properly passed through, i.e `x86_64-linux-gnu` becomes `x86_64-pc-linux-gnu`. However this doesn't build the `x86_64-pc-linux-gnu` host for me (aa0f83283504c69b57ea20f4cb127c4ec4d993f3):\r\n```bash\r\ntime HOSTS=\"x86_64-pc-linux-gnu\" BASE_CACHE=\"/guix/base_cache\" SOURCES_PATH=\"/guix/sources\" SDK_PATH=\"/guix/SDKs\" ./contrib/guix/guix-build\r\n...\r\nINFO: Building aa0f83283504 for platform triple x86_64-pc-linux-gnu:\r\n      ...using reference timestamp: 1618345007\r\n      ...running at most 8 jobs\r\n      ...from worktree directory: '/bitcoin'\r\n          ...bind-mounted in container to: '/bitcoin'\r\n      ...in build directory: '/bitcoin/guix-build-aa0f83283504/distsrc-aa0f83283504-x86_64-pc-linux-gnu'\r\n          ...bind-mounted in container to: '/distsrc-base/distsrc-aa0f83283504-x86_64-pc-linux-gnu'\r\n      ...outputting in: '/bitcoin/guix-build-aa0f83283504/output/x86_64-pc-linux-gnu'\r\n          ...bind-mounted in container to: '/outdir-base/x86_64-pc-linux-gnu'\r\nRequired environment variables as seen inside the container:\r\n    DIST_ARCHIVE_BASE: /outdir-base/dist-archive\r\n    DISTNAME: bitcoin-aa0f83283504\r\n    HOST: x86_64-pc-linux-gnu\r\n    SOURCE_DATE_EPOCH: 1618345007\r\n    JOBS: 8\r\n    DISTSRC: /distsrc-base/distsrc-aa0f83283504-x86_64-pc-linux-gnu\r\n    OUTDIR: /outdir-base/x86_64-pc-linux-gnu\r\nmake: Entering directory '/bitcoin/depends'\r\n...\r\nchecking whether we are cross compiling... configure: error: in `/bitcoin/depends/work/build/x86_64-pc-linux-gnu/libevent/2.1.11-stable-3f710cc1119':\r\nconfigure: error: cannot run C compiled programs.\r\nIf you meant to cross compile, use `--host'.\r\nSee `config.log' for more details\r\nmake: *** [funcs.mk:282: /bitcoin/depends/work/build/x86_64-pc-linux-gnu/libevent/2.1.11-stable-3f710cc1119/./.stamp_configured] Error 1\r\nmake: Leaving directory '/bitcoin/depends'\r\n```\r\n\r\n`config.log`\r\n```bash\r\nconfigure:2676: checking for a BSD-compatible install\r\nconfigure:2744: result: /root/.guix-profile/bin/install -c\r\nconfigure:2755: checking whether build environment is sane\r\nconfigure:2810: result: yes\r\nconfigure:2959: checking for a thread-safe mkdir -p\r\nconfigure:2998: result: /root/.guix-profile/bin/mkdir -p\r\nconfigure:3005: checking for gawk\r\nconfigure:3021: found /root/.guix-profile/bin/gawk\r\nconfigure:3032: result: gawk\r\nconfigure:3043: checking whether make sets $(MAKE)\r\nconfigure:3065: result: yes\r\nconfigure:3094: checking whether make supports nested variables\r\nconfigure:3111: result: yes\r\nconfigure:3248: checking whether make supports nested variables\r\nconfigure:3265: result: yes\r\nconfigure:3291: checking whether make supports the include directive\r\nconfigure:3306: make -f confmf.GNU && cat confinc.out\r\nmake[1]: Entering directory '/bitcoin/depends/work/build/x86_64-pc-linux-gnu/libevent/2.1.11-stable-3f710cc1119'\r\nmake[1]: Leaving directory '/bitcoin/depends/work/build/x86_64-pc-linux-gnu/libevent/2.1.11-stable-3f710cc1119'\r\nthis is the am__doit target\r\nconfigure:3309: $? = 0\r\nconfigure:3328: result: yes (GNU style)\r\nconfigure:3358: checking for x86_64-pc-linux-gnu-gcc\r\nconfigure:3385: result: x86_64-pc-linux-gnu-gcc\r\nconfigure:3654: checking for C compiler version\r\nconfigure:3663: x86_64-pc-linux-gnu-gcc --version >&5\r\nx86_64-pc-linux-gnu-gcc (GCC) 8.4.0\r\nCopyright (C) 2018 Free Software Foundation, Inc.\r\nThis is free software; see the source for copying conditions.  There is NO\r\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\nconfigure:3674: $? = 0\r\nconfigure:3663: x86_64-pc-linux-gnu-gcc -v >&5\r\nUsing built-in specs.\r\nCOLLECT_GCC=x86_64-pc-linux-gnu-gcc\r\nCOLLECT_LTO_WRAPPER=/gnu/store/jyg0s2g2gil3w8d7ym2i6lhz45cj5ncx-gcc-cross-x86_64-pc-linux-gnu-8.4.0/libexec/gcc/x86_64-pc-linux-gnu/8.4.0/lto-wrapper\r\nTarget: x86_64-pc-linux-gnu\r\nConfigured with: \r\nThread model: posix\r\ngcc version 8.4.0 (GCC) \r\nconfigure:3674: $? = 0\r\nconfigure:3663: x86_64-pc-linux-gnu-gcc -V >&5\r\nx86_64-pc-linux-gnu-gcc: error: unrecognized command line option '-V'\r\nx86_64-pc-linux-gnu-gcc: fatal error: no input files\r\ncompilation terminated.\r\nconfigure:3674: $? = 1\r\nconfigure:3663: x86_64-pc-linux-gnu-gcc -qversion >&5\r\nx86_64-pc-linux-gnu-gcc: error: unrecognized command line option '-qversion'; did you mean '--version'?\r\nx86_64-pc-linux-gnu-gcc: fatal error: no input files\r\ncompilation terminated.\r\nconfigure:3674: $? = 1\r\nconfigure:3694: checking whether the C compiler works\r\nconfigure:3716: x86_64-pc-linux-gnu-gcc -pipe -O2   -I/bitcoin/depends/x86_64-pc-linux-gnu/include   -L/bitcoin/depends/x86_64-pc-linux-gnu/lib conftest.c  >&5\r\nconfigure:3720: $? = 0\r\nconfigure:3768: result: yes\r\nconfigure:3771: checking for C compiler default output file name\r\nconfigure:3773: result: a.out\r\nconfigure:3779: checking for suffix of executables\r\nconfigure:3786: x86_64-pc-linux-gnu-gcc -o conftest -pipe -O2   -I/bitcoin/depends/x86_64-pc-linux-gnu/include   -L/bitcoin/depends/x86_64-pc-linux-gnu/lib conftest.c  >&5\r\nconfigure:3790: $? = 0\r\nconfigure:3812: result: \r\nconfigure:3834: checking whether we are cross compiling\r\nconfigure:3842: x86_64-pc-linux-gnu-gcc -o conftest -pipe -O2   -I/bitcoin/depends/x86_64-pc-linux-gnu/include   -L/bitcoin/depends/x86_64-pc-linux-gnu/lib conftest.c  >&5\r\nconfigure:3846: $? = 0\r\nconfigure:3853: ./conftest\r\n./conftest: error while loading shared libraries: libgcc_s.so.1: cannot open shared object file: No such file or directory\r\nconfigure:3857: $? = 127\r\nconfigure:3864: error: in `/bitcoin/depends/work/build/x86_64-pc-linux-gnu/libevent/2.1.11-stable-3f710cc1119':\r\nconfigure:3866: error: cannot run C compiled programs.\r\nIf you meant to cross compile, use `--host'.\r\nSee `config.log' for more details\r\n```\r\n\r\nAll other hosts seem to build fine.",
      "created_at" : "2021-06-10T06:00:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21671#issuecomment-858331108",
      "id" : 858331108,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21671",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg1ODMzMTEwOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-10T06:00:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/858331108",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Very curious as I did not encounter this before (or perhaps I did and did not notice?)\r\n\r\nI will investigate further but the following patch fixes the problem (not in any way that we'd want in our repo), which is interesting.\r\n```diff\r\ndiff --git a/depends/funcs.mk b/depends/funcs.mk\r\nindex 34a030fab7..e5fcb352a8 100644\r\n--- a/depends/funcs.mk\r\n+++ b/depends/funcs.mk\r\n@@ -146,7 +146,7 @@ $(1)_stage_env+=PATH=$(build_prefix)/bin:$(PATH)\r\n # config.guess, which is what we set it too here. This also quells autoconf\r\n # warnings, \"If you wanted to set the --build type, don't use --host.\",\r\n # when using versions older than 2.70.\r\n-$(1)_autoconf=./configure --build=$(BUILD) --host=$($($(1)_type)_host) --prefix=$($($(1)_type)_prefix) $$($(1)_config_opts) CC=\"$$($(1)_cc)\" CXX=\"$$($(1)_cxx)\"\r\n+$(1)_autoconf=./configure --build=$(BUILD) --host=$($($(1)_type)_host) --prefix=$($($(1)_type)_prefix) $$($(1)_config_opts) CC=\"$$($(1)_cc)\" CXX=\"$$($(1)_cxx)\" cross_compiling=yes\r\n ifneq ($($(1)_nm),)\r\n $(1)_autoconf += NM=\"$$($(1)_nm)\"\r\n endif\r\n```",
      "created_at" : "2021-06-15T14:59:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21671#issuecomment-861573493",
      "id" : 861573493,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21671",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2MTU3MzQ5Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-15T14:59:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/861573493",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Pushed aa0f832835..d0e2378c1a\r\n\r\nWrote up a description of my investigation\r\n\r\n---\r\n\r\nAbstractly, our Guix builds do not treat native-builds and cross-builds differently. We always build 2 toolchains:\r\n\r\n1. A native toolchain (in depends terms: build) (namely, the `gcc-toolchain` package, with the command line name being simply `gcc`), and\r\n2. A cross toolchain (in depends terms: host) (namely, packages returned by the `make-cross-toolchain` procedure in `manifest.scm`, with the command line name being something like `x86_64-pc-linux-gnu-gcc`)\r\n\r\nThis means that even if we are technically not cross compiling (`build==host`), we do not coalesce or reuse the toolchains in any way. This is necessary because our release binaries (produced by the cross toolchain) are built to:\r\n\r\n1. Have a dependency on a minimal number of shared libraries\r\n2. Expect the dynamic linker/loader `ld-linux.so(8)` to be somewhere like `/lib{,64}/ld*`\r\n\r\nThis is not the case for binaries produced by Guix's native `gcc-toolchain` package. They are built to work best in Guix containers, where the binaries reach for libraries and `ld-linux.so(8)` in `/gnu/store` and have dependencies recorded as RUNPATHs in their dynamic section (since paths are deterministic).\r\n\r\nIn other words, Guix's native `gcc-toolchain` package can be thought of as a different platform triple: `x86_64-guix-linux-gnu` (PLEASE don't actually use this triple this is not standard just a way to think about it).\r\n\r\nWe can therefore think of performing a Guix build on `x86_64` for `x86_64` as a cross-compilation with build=`x86_64-guix-linux-gnu` and host=`x86_64-pc-linux-gnu` since even when the architecture and OS matches, binaries built with the native toolchain will not run on normal distros, and binaries built with the cross toolchain will not run in Guix environments.\r\n\r\n---\r\n\r\nWith this context in mind, we can now discuss our particular issue.\r\n\r\nPrior to canonicalizing `$HOST` (this PR), autoconf's barely-working cross compilation detection (which is marked `# FIXME: To remove some day.`) set `cross_compiling=yes` if `$host` is not the exact same string as `$build`: http://git.savannah.gnu.org/gitweb/?p=autoconf.git;a=blob;f=lib/autoconf/general.m4;h=053130b3d0ba7af8b9177da6ff850d8c20ac6cbe;hb=HEAD#l972. Which actually worked in our favor since we were not canonicalizing `host` and specifying `build=x86_64-pc-linux-gnu` and `host=x86_64-linux-gnu`, and the missing `-pc-` made autoconf assume that it was a cross-compilation.\r\n\r\nAfter canonicalizing `$HOST` autoconf instead sees that `$build==$host` and sets `cross_compiling=no`, which leads to later configure tests to compile `conftest` binaries using `CC` (namely, our cross-toolchain `x86_64-pc-linux-gnu-gcc`) and attempt to run them inside the Guix container. This leads to the problems fanquake identified here: https://github.com/bitcoin/bitcoin/pull/21671#issuecomment-858331108\r\n\r\nThe solution is to be explicit and supply `cross_compiling=yes` to `./configure`, which is us saying: \"yes i'm on the same architecture, OS, and userspace as the target, but there are important differences in what we want in our dynamic sections which lead to binaries not being able to find the right libraries to load if they were copied to the other environment so just assume that I'm cross compiling and don't try to be smart\"",
      "created_at" : "2021-06-18T18:11:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21671#issuecomment-864200182",
      "id" : 864200182,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21671",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2NDIwMDE4Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-18T18:11:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/864200182",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-07-05T16:40:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21671#issuecomment-874231029",
      "id" : 874231029,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21671",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3NDIzMTAyOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-05T16:40:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/874231029",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   }
]
