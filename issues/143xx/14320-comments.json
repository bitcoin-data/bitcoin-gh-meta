[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r220243205"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220243205"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think it'd be more correct to add a `std::unordered_map<std::string, BerkeleyFileid> m_fileids` member in `BerkeleyEnvironment` member instead of a `g_fileids` global because there can be duplicate filenames if the files are in different directories.\r\n\r\nAlso, making this a member would be consistent with existing `mapFileUseCount` `mapDb` members there which are also maps indexed by filename. In the future it could be nice to consolidate the 3 maps.",
      "commit_id" : "4ea77320c5f0b275876be41ff530bb328ba0cb87",
      "created_at" : "2018-09-25T15:32:43Z",
      "diff_hunk" : "@@ -20,6 +21,12 @@\n #include <boost/thread.hpp>\n \n namespace {\n+\n+struct BerkeleyFileid {\n+    u_int8_t value[DB_FILE_ID_LEN];\n+};\n+std::unordered_map<std::string, BerkeleyFileid> g_fileids;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r220243205",
      "id" : 220243205,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMDI0MzIwNQ==",
      "original_commit_id" : "4d5a58b1d242edd9b57bd7ac905e690c9dd362e8",
      "original_position" : 16,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 158605964,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320",
      "updated_at" : "2018-10-24T15:08:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220243205",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r220267509"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220267509"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Updated",
      "commit_id" : "4ea77320c5f0b275876be41ff530bb328ba0cb87",
      "created_at" : "2018-09-25T16:38:29Z",
      "diff_hunk" : "@@ -20,6 +21,12 @@\n #include <boost/thread.hpp>\n \n namespace {\n+\n+struct BerkeleyFileid {\n+    u_int8_t value[DB_FILE_ID_LEN];\n+};\n+std::unordered_map<std::string, BerkeleyFileid> g_fileids;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r220267509",
      "id" : 220267509,
      "in_reply_to_id" : 220243205,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMDI2NzUwOQ==",
      "original_commit_id" : "4d5a58b1d242edd9b57bd7ac905e690c9dd362e8",
      "original_position" : 16,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 158636052,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320",
      "updated_at" : "2018-10-24T15:08:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220267509",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/11154118?v=4",
         "events_url" : "https://api.github.com/users/ken2812221/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ken2812221/followers",
         "following_url" : "https://api.github.com/users/ken2812221/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ken2812221/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ken2812221",
         "id" : 11154118,
         "login" : "ken2812221",
         "node_id" : "MDQ6VXNlcjExMTU0MTE4",
         "organizations_url" : "https://api.github.com/users/ken2812221/orgs",
         "received_events_url" : "https://api.github.com/users/ken2812221/received_events",
         "repos_url" : "https://api.github.com/users/ken2812221/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ken2812221/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ken2812221"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->Reviewers, this pull request conflicts with the following ones:\n\n* #14531 (Replace fs::relative call with custom GetRelativePath by promag)\n* #11911 (Free BerkeleyEnvironment instances when not in use by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2018-09-25T17:01:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14320#issuecomment-424423106",
      "id" : 424423106,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14320",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyNDQyMzEwNg==",
      "updated_at" : "2018-10-23T22:49:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/424423106",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r220277755"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220277755"
         }
      },
      "author_association" : "MEMBER",
      "body" : "move `memcmp` to `BerkeleyFileid::operator==`?",
      "commit_id" : "4ea77320c5f0b275876be41ff530bb328ba0cb87",
      "created_at" : "2018-09-25T17:10:26Z",
      "diff_hunk" : "@@ -29,27 +30,24 @@ namespace {\n //! (https://docs.oracle.com/cd/E17275_01/html/programmer_reference/program_copy.html),\n //! so bitcoin should never create different databases with the same fileid, but\n //! this error can be triggered if users manually copy database files.\n-void CheckUniqueFileid(const BerkeleyEnvironment& env, const std::string& filename, Db& db)\n+void CheckUniqueFileid(BerkeleyEnvironment& env, const std::string& filename, Db& db)\n {\n     if (env.IsMock()) return;\n \n-    u_int8_t fileid[DB_FILE_ID_LEN];\n-    int ret = db.get_mpf()->get_fileid(fileid);\n+    BerkeleyFileid fileid;\n+    int ret = db.get_mpf()->get_fileid(fileid.value);\n     if (ret != 0) {\n         throw std::runtime_error(strprintf(\"BerkeleyBatch: Can't open database %s (get_fileid failed with %d)\", filename, ret));\n     }\n \n-    for (const auto& item : env.mapDb) {\n-        u_int8_t item_fileid[DB_FILE_ID_LEN];\n-        if (item.second && item.second->get_mpf()->get_fileid(item_fileid) == 0 &&\n-            memcmp(fileid, item_fileid, sizeof(fileid)) == 0) {\n-            const char* item_filename = nullptr;\n-            item.second->get_dbname(&item_filename, nullptr);\n+    for (const auto& item : env.m_fileids) {\n+        if (item.first != filename && memcmp(fileid.value, item.second.value, sizeof(fileid)) == 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r220277755",
      "id" : 220277755,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMDI3Nzc1NQ==",
      "original_commit_id" : "839142c826f5e3376dbbfaad6ae63b795497dc56",
      "original_position" : 32,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 158649211,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320",
      "updated_at" : "2018-10-24T15:08:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220277755",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r220290148"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220290148"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Since `CheckUniqueFileid` is called on all `BerkeleyEnvironment` instances, this will incorrectly add the filename to unrelated BerkeleyEnvironment instances that don't actually contain `filename`. I'd suggest dropping this line, adding a `BerkeleyFileid& fileid` output parameter to `CheckUniqueFileid`, and passing in `this->env->m_fileids[strFilename]` where `CheckUniqueFileid` is called in `BerkeleyBatch::BerkeleyBatch`.",
      "commit_id" : "4ea77320c5f0b275876be41ff530bb328ba0cb87",
      "created_at" : "2018-09-25T17:45:51Z",
      "diff_hunk" : "@@ -29,27 +30,24 @@ namespace {\n //! (https://docs.oracle.com/cd/E17275_01/html/programmer_reference/program_copy.html),\n //! so bitcoin should never create different databases with the same fileid, but\n //! this error can be triggered if users manually copy database files.\n-void CheckUniqueFileid(const BerkeleyEnvironment& env, const std::string& filename, Db& db)\n+void CheckUniqueFileid(BerkeleyEnvironment& env, const std::string& filename, Db& db)\n {\n     if (env.IsMock()) return;\n \n-    u_int8_t fileid[DB_FILE_ID_LEN];\n-    int ret = db.get_mpf()->get_fileid(fileid);\n+    BerkeleyFileid fileid;\n+    int ret = db.get_mpf()->get_fileid(fileid.value);\n     if (ret != 0) {\n         throw std::runtime_error(strprintf(\"BerkeleyBatch: Can't open database %s (get_fileid failed with %d)\", filename, ret));\n     }\n \n-    for (const auto& item : env.mapDb) {\n-        u_int8_t item_fileid[DB_FILE_ID_LEN];\n-        if (item.second && item.second->get_mpf()->get_fileid(item_fileid) == 0 &&\n-            memcmp(fileid, item_fileid, sizeof(fileid)) == 0) {\n-            const char* item_filename = nullptr;\n-            item.second->get_dbname(&item_filename, nullptr);\n+    for (const auto& item : env.m_fileids) {\n+        if (item.first != filename && memcmp(fileid.value, item.second.value, sizeof(fileid)) == 0) {\n             throw std::runtime_error(strprintf(\"BerkeleyBatch: Can't open database %s (duplicates fileid %s from %s)\", filename,\n-                HexStr(std::begin(item_fileid), std::end(item_fileid)),\n-                item_filename ? item_filename : \"(unknown database)\"));\n+                HexStr(std::begin(item.second.value), std::end(item.second.value)), item.first));\n         }\n     }\n+\n+    env.m_fileids.emplace(filename, fileid);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r220290148",
      "id" : 220290148,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMDI5MDE0OA==",
      "original_commit_id" : "0ce468502b1438a81f7b00c4614fc04c99babdeb",
      "original_position" : 40,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 158664541,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320",
      "updated_at" : "2018-10-24T15:08:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220290148",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r220293029"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220293029"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"util: Fix broken Windows file lock\"\r\n\r\nCan you describe how the lock is broken in the commit message?",
      "commit_id" : "4ea77320c5f0b275876be41ff530bb328ba0cb87",
      "created_at" : "2018-09-25T17:53:54Z",
      "diff_hunk" : "@@ -89,7 +89,7 @@ bool FileLock::TryLock()\n         return false;\n     }\n     _OVERLAPPED overlapped = {0};\n-    if (!LockFileEx(hFile, LOCKFILE_EXCLUSIVE_LOCK | LOCKFILE_FAIL_IMMEDIATELY, 0, 0, 0, &overlapped)) {\n+    if (!LockFileEx(hFile, LOCKFILE_EXCLUSIVE_LOCK | LOCKFILE_FAIL_IMMEDIATELY, 0, -1, -1, &overlapped)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r220293029",
      "id" : 220293029,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMDI5MzAyOQ==",
      "original_commit_id" : "87a39fcdd6c8ff44348bcc86c289cb4ffac5b25e",
      "original_position" : 5,
      "path" : "src/fs.cpp",
      "position" : null,
      "pull_request_review_id" : 158664541,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320",
      "updated_at" : "2018-10-24T15:08:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220293029",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r220328915"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220328915"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That was introduced by #13862. I assume that it could work with length 0 if it is a exclusive lock, but it doesn't. I would have to specify -1, -1 to make it work.\r\n\r\nThe boost implementation:\r\n\r\nhttps://github.com/boostorg/interprocess/blob/8b3621353017aa527a22124655c9458d0b64b358/include/boost/interprocess/detail/os_file_functions.hpp#L230-L243",
      "commit_id" : "4ea77320c5f0b275876be41ff530bb328ba0cb87",
      "created_at" : "2018-09-25T19:42:04Z",
      "diff_hunk" : "@@ -89,7 +89,7 @@ bool FileLock::TryLock()\n         return false;\n     }\n     _OVERLAPPED overlapped = {0};\n-    if (!LockFileEx(hFile, LOCKFILE_EXCLUSIVE_LOCK | LOCKFILE_FAIL_IMMEDIATELY, 0, 0, 0, &overlapped)) {\n+    if (!LockFileEx(hFile, LOCKFILE_EXCLUSIVE_LOCK | LOCKFILE_FAIL_IMMEDIATELY, 0, -1, -1, &overlapped)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r220328915",
      "id" : 220328915,
      "in_reply_to_id" : 220293029,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMDMyODkxNQ==",
      "original_commit_id" : "87a39fcdd6c8ff44348bcc86c289cb4ffac5b25e",
      "original_position" : 5,
      "path" : "src/fs.cpp",
      "position" : null,
      "pull_request_review_id" : 158712346,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320",
      "updated_at" : "2018-10-24T15:08:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220328915",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/11154118?v=4",
         "events_url" : "https://api.github.com/users/ken2812221/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ken2812221/followers",
         "following_url" : "https://api.github.com/users/ken2812221/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ken2812221/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ken2812221",
         "id" : 11154118,
         "login" : "ken2812221",
         "node_id" : "MDQ6VXNlcjExMTU0MTE4",
         "organizations_url" : "https://api.github.com/users/ken2812221/orgs",
         "received_events_url" : "https://api.github.com/users/ken2812221/received_events",
         "repos_url" : "https://api.github.com/users/ken2812221/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ken2812221/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ken2812221"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r220332273"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220332273"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Note that if two or more BerkeleyDatabase share the same BerkeleyEnvironment, the `env` would be a wild pointer after the first call.",
      "commit_id" : "4ea77320c5f0b275876be41ff530bb328ba0cb87",
      "created_at" : "2018-09-25T19:52:49Z",
      "diff_hunk" : "@@ -826,6 +826,8 @@ void BerkeleyDatabase::Flush(bool shutdown)\n             LOCK(cs_db);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r220332273",
      "id" : 220332273,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMDMzMjI3Mw==",
      "original_commit_id" : "f31c3fcc88960503bea5fd2d078286f93cf2416e",
      "original_position" : 63,
      "path" : "src/wallet/db.cpp",
      "position" : 61,
      "pull_request_review_id" : 158716478,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320",
      "updated_at" : "2018-10-24T15:08:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220332273",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/11154118?v=4",
         "events_url" : "https://api.github.com/users/ken2812221/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ken2812221/followers",
         "following_url" : "https://api.github.com/users/ken2812221/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ken2812221/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ken2812221",
         "id" : 11154118,
         "login" : "ken2812221",
         "node_id" : "MDQ6VXNlcjExMTU0MTE4",
         "organizations_url" : "https://api.github.com/users/ken2812221/orgs",
         "received_events_url" : "https://api.github.com/users/ken2812221/received_events",
         "repos_url" : "https://api.github.com/users/ken2812221/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ken2812221/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ken2812221"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r220337687"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220337687"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think you could restore `auto& env` to `const auto& env` here.",
      "commit_id" : "4ea77320c5f0b275876be41ff530bb328ba0cb87",
      "created_at" : "2018-09-25T20:10:50Z",
      "diff_hunk" : "@@ -503,8 +503,8 @@ BerkeleyBatch::BerkeleyBatch(BerkeleyDatabase& database, const char* pszMode, bo\n             // be implemented, so no equality checks are needed at all. (Newer\n             // versions of BDB have an set_lk_exclusive method for this\n             // purpose, but the older version we use does not.)\n-            for (const auto& env : g_dbenvs) {\n-                CheckUniqueFileid(env.second, strFilename, *pdb_temp);\n+            for (auto& env : g_dbenvs) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r220337687",
      "id" : 220337687,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMDMzNzY4Nw==",
      "original_commit_id" : "f31c3fcc88960503bea5fd2d078286f93cf2416e",
      "original_position" : 57,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 158723190,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320",
      "updated_at" : "2018-10-24T15:08:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220337687",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r220340144"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220340144"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think `item.first != filename` condition makes the check too loose again because the same filename can exist in different directories (and we'd expect pretty much all wallet directories to have a `wallet.dat` file).\r\n\r\nPerhaps change condition to: `if (item.second == fileid && !(&item.second == &fileid))`\r\n",
      "commit_id" : "4ea77320c5f0b275876be41ff530bb328ba0cb87",
      "created_at" : "2018-09-25T20:19:08Z",
      "diff_hunk" : "@@ -29,25 +30,19 @@ namespace {\n //! (https://docs.oracle.com/cd/E17275_01/html/programmer_reference/program_copy.html),\n //! so bitcoin should never create different databases with the same fileid, but\n //! this error can be triggered if users manually copy database files.\n-void CheckUniqueFileid(const BerkeleyEnvironment& env, const std::string& filename, Db& db)\n+void CheckUniqueFileid(const BerkeleyEnvironment& env, const std::string& filename, Db& db, BerkeleyFileid& fileid)\n {\n     if (env.IsMock()) return;\n \n-    u_int8_t fileid[DB_FILE_ID_LEN];\n-    int ret = db.get_mpf()->get_fileid(fileid);\n+    int ret = db.get_mpf()->get_fileid(fileid.value);\n     if (ret != 0) {\n         throw std::runtime_error(strprintf(\"BerkeleyBatch: Can't open database %s (get_fileid failed with %d)\", filename, ret));\n     }\n \n-    for (const auto& item : env.mapDb) {\n-        u_int8_t item_fileid[DB_FILE_ID_LEN];\n-        if (item.second && item.second->get_mpf()->get_fileid(item_fileid) == 0 &&\n-            memcmp(fileid, item_fileid, sizeof(fileid)) == 0) {\n-            const char* item_filename = nullptr;\n-            item.second->get_dbname(&item_filename, nullptr);\n+    for (const auto& item : env.m_fileids) {\n+        if (item.first != filename && fileid == item.second) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r220340144",
      "id" : 220340144,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMDM0MDE0NA==",
      "original_commit_id" : "8389ce8fb0802920b5a0bd50cf21ece57409a641",
      "original_position" : 31,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 158723190,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320",
      "updated_at" : "2018-10-24T15:08:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220340144",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r220340609"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220340609"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It might be safer if memcmp compared just the value field rather than the whole object, since it seems possible the compiler could pad the objects. Maybe:\r\n\r\n```\r\nreturn memcmp(this->field, b.field, sizeof(this->field)) == 0;\r\n```",
      "commit_id" : "4ea77320c5f0b275876be41ff530bb328ba0cb87",
      "created_at" : "2018-09-25T20:20:39Z",
      "diff_hunk" : "@@ -56,6 +51,11 @@ CCriticalSection cs_db;\n std::map<std::string, BerkeleyEnvironment> g_dbenvs GUARDED_BY(cs_db); //!< Map from directory name to open db environment.\n } // namespace\n \n+bool BerkeleyFileid::operator==(const BerkeleyFileid& b) const\n+{\n+    return memcmp(this, &b, sizeof(BerkeleyFileid)) == 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r220340609",
      "id" : 220340609,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMDM0MDYwOQ==",
      "original_commit_id" : "8389ce8fb0802920b5a0bd50cf21ece57409a641",
      "original_position" : 45,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 158723190,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320",
      "updated_at" : "2018-10-24T15:08:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220340609",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r220342404"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220342404"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good catch. This appears to be a bug introduced in 0b82bac76d0f842bd2294a290388536951fbc576 from #13111 and then tweaked in a769461d5e37ddcb771ae836254fdc69177a28c4 in #12493. It seems not directly related to this issue, so probably best addressed separately.",
      "commit_id" : "4ea77320c5f0b275876be41ff530bb328ba0cb87",
      "created_at" : "2018-09-25T20:25:44Z",
      "diff_hunk" : "@@ -826,6 +826,8 @@ void BerkeleyDatabase::Flush(bool shutdown)\n             LOCK(cs_db);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r220342404",
      "id" : 220342404,
      "in_reply_to_id" : 220332273,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMDM0MjQwNA==",
      "original_commit_id" : "f31c3fcc88960503bea5fd2d078286f93cf2416e",
      "original_position" : 63,
      "path" : "src/wallet/db.cpp",
      "position" : 61,
      "pull_request_review_id" : 158723190,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320",
      "updated_at" : "2018-10-24T15:08:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220342404",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r220344442"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220344442"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done",
      "commit_id" : "4ea77320c5f0b275876be41ff530bb328ba0cb87",
      "created_at" : "2018-09-25T20:31:47Z",
      "diff_hunk" : "@@ -29,27 +30,24 @@ namespace {\n //! (https://docs.oracle.com/cd/E17275_01/html/programmer_reference/program_copy.html),\n //! so bitcoin should never create different databases with the same fileid, but\n //! this error can be triggered if users manually copy database files.\n-void CheckUniqueFileid(const BerkeleyEnvironment& env, const std::string& filename, Db& db)\n+void CheckUniqueFileid(BerkeleyEnvironment& env, const std::string& filename, Db& db)\n {\n     if (env.IsMock()) return;\n \n-    u_int8_t fileid[DB_FILE_ID_LEN];\n-    int ret = db.get_mpf()->get_fileid(fileid);\n+    BerkeleyFileid fileid;\n+    int ret = db.get_mpf()->get_fileid(fileid.value);\n     if (ret != 0) {\n         throw std::runtime_error(strprintf(\"BerkeleyBatch: Can't open database %s (get_fileid failed with %d)\", filename, ret));\n     }\n \n-    for (const auto& item : env.mapDb) {\n-        u_int8_t item_fileid[DB_FILE_ID_LEN];\n-        if (item.second && item.second->get_mpf()->get_fileid(item_fileid) == 0 &&\n-            memcmp(fileid, item_fileid, sizeof(fileid)) == 0) {\n-            const char* item_filename = nullptr;\n-            item.second->get_dbname(&item_filename, nullptr);\n+    for (const auto& item : env.m_fileids) {\n+        if (item.first != filename && memcmp(fileid.value, item.second.value, sizeof(fileid)) == 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r220344442",
      "id" : 220344442,
      "in_reply_to_id" : 220277755,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMDM0NDQ0Mg==",
      "original_commit_id" : "839142c826f5e3376dbbfaad6ae63b795497dc56",
      "original_position" : 32,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 158731732,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320",
      "updated_at" : "2018-10-24T15:08:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220344442",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/11154118?v=4",
         "events_url" : "https://api.github.com/users/ken2812221/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ken2812221/followers",
         "following_url" : "https://api.github.com/users/ken2812221/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ken2812221/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ken2812221",
         "id" : 11154118,
         "login" : "ken2812221",
         "node_id" : "MDQ6VXNlcjExMTU0MTE4",
         "organizations_url" : "https://api.github.com/users/ken2812221/orgs",
         "received_events_url" : "https://api.github.com/users/ken2812221/received_events",
         "repos_url" : "https://api.github.com/users/ken2812221/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ken2812221/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ken2812221"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r220344539"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220344539"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done",
      "commit_id" : "4ea77320c5f0b275876be41ff530bb328ba0cb87",
      "created_at" : "2018-09-25T20:32:06Z",
      "diff_hunk" : "@@ -29,27 +30,24 @@ namespace {\n //! (https://docs.oracle.com/cd/E17275_01/html/programmer_reference/program_copy.html),\n //! so bitcoin should never create different databases with the same fileid, but\n //! this error can be triggered if users manually copy database files.\n-void CheckUniqueFileid(const BerkeleyEnvironment& env, const std::string& filename, Db& db)\n+void CheckUniqueFileid(BerkeleyEnvironment& env, const std::string& filename, Db& db)\n {\n     if (env.IsMock()) return;\n \n-    u_int8_t fileid[DB_FILE_ID_LEN];\n-    int ret = db.get_mpf()->get_fileid(fileid);\n+    BerkeleyFileid fileid;\n+    int ret = db.get_mpf()->get_fileid(fileid.value);\n     if (ret != 0) {\n         throw std::runtime_error(strprintf(\"BerkeleyBatch: Can't open database %s (get_fileid failed with %d)\", filename, ret));\n     }\n \n-    for (const auto& item : env.mapDb) {\n-        u_int8_t item_fileid[DB_FILE_ID_LEN];\n-        if (item.second && item.second->get_mpf()->get_fileid(item_fileid) == 0 &&\n-            memcmp(fileid, item_fileid, sizeof(fileid)) == 0) {\n-            const char* item_filename = nullptr;\n-            item.second->get_dbname(&item_filename, nullptr);\n+    for (const auto& item : env.m_fileids) {\n+        if (item.first != filename && memcmp(fileid.value, item.second.value, sizeof(fileid)) == 0) {\n             throw std::runtime_error(strprintf(\"BerkeleyBatch: Can't open database %s (duplicates fileid %s from %s)\", filename,\n-                HexStr(std::begin(item_fileid), std::end(item_fileid)),\n-                item_filename ? item_filename : \"(unknown database)\"));\n+                HexStr(std::begin(item.second.value), std::end(item.second.value)), item.first));\n         }\n     }\n+\n+    env.m_fileids.emplace(filename, fileid);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r220344539",
      "id" : 220344539,
      "in_reply_to_id" : 220290148,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMDM0NDUzOQ==",
      "original_commit_id" : "0ce468502b1438a81f7b00c4614fc04c99babdeb",
      "original_position" : 40,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 158731858,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320",
      "updated_at" : "2018-10-24T15:08:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220344539",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/11154118?v=4",
         "events_url" : "https://api.github.com/users/ken2812221/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ken2812221/followers",
         "following_url" : "https://api.github.com/users/ken2812221/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ken2812221/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ken2812221",
         "id" : 11154118,
         "login" : "ken2812221",
         "node_id" : "MDQ6VXNlcjExMTU0MTE4",
         "organizations_url" : "https://api.github.com/users/ken2812221/orgs",
         "received_events_url" : "https://api.github.com/users/ken2812221/received_events",
         "repos_url" : "https://api.github.com/users/ken2812221/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ken2812221/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ken2812221"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r220437861"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220437861"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why not call `m_fileds.erase` if `shutdown` is true? It seems ok to only erase if `shutdown` is false, but if there is a specific reason for not erasing when shutting down, it would be useful to note in a code comment.",
      "commit_id" : "4ea77320c5f0b275876be41ff530bb328ba0cb87",
      "created_at" : "2018-09-26T06:22:55Z",
      "diff_hunk" : "@@ -826,6 +826,8 @@ void BerkeleyDatabase::Flush(bool shutdown)\n             LOCK(cs_db);\n             g_dbenvs.erase(env->Directory().string());\n             env = nullptr;\n+        } else {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r220437861",
      "id" : 220437861,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMDQzNzg2MQ==",
      "original_commit_id" : "cb4af1969c03b56bc18b63286627922db86743d2",
      "original_position" : 64,
      "path" : "src/wallet/db.cpp",
      "position" : 64,
      "pull_request_review_id" : 158845164,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320",
      "updated_at" : "2018-10-24T15:08:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220437861",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r220439572"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220439572"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That would cause an access violation on Windows since it's a wild pointer in the second call. Also, since the env is deleted when `g_dbenvs.erase` called, the map doesn't exist anymore.",
      "commit_id" : "4ea77320c5f0b275876be41ff530bb328ba0cb87",
      "created_at" : "2018-09-26T06:32:50Z",
      "diff_hunk" : "@@ -826,6 +826,8 @@ void BerkeleyDatabase::Flush(bool shutdown)\n             LOCK(cs_db);\n             g_dbenvs.erase(env->Directory().string());\n             env = nullptr;\n+        } else {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r220439572",
      "id" : 220439572,
      "in_reply_to_id" : 220437861,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMDQzOTU3Mg==",
      "original_commit_id" : "cb4af1969c03b56bc18b63286627922db86743d2",
      "original_position" : 64,
      "path" : "src/wallet/db.cpp",
      "position" : 64,
      "pull_request_review_id" : 158847288,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320",
      "updated_at" : "2018-10-24T15:08:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220439572",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/11154118?v=4",
         "events_url" : "https://api.github.com/users/ken2812221/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ken2812221/followers",
         "following_url" : "https://api.github.com/users/ken2812221/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ken2812221/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ken2812221",
         "id" : 11154118,
         "login" : "ken2812221",
         "node_id" : "MDQ6VXNlcjExMTU0MTE4",
         "organizations_url" : "https://api.github.com/users/ken2812221/orgs",
         "received_events_url" : "https://api.github.com/users/ken2812221/received_events",
         "repos_url" : "https://api.github.com/users/ken2812221/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ken2812221/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ken2812221"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Is this for backport?",
      "created_at" : "2018-09-27T16:20:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14320#issuecomment-425155025",
      "id" : 425155025,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14320",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyNTE1NTAyNQ==",
      "updated_at" : "2018-09-27T16:20:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/425155025",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Is this for backport?\r\n\r\nCould be backported, but I think the benefit would be very minimal. I think you have to literally copy a wallet database file and use the `loadwallet` RPC in order to trigger the missing error check that this PR restores.",
      "created_at" : "2018-09-27T16:35:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14320#issuecomment-425159822",
      "id" : 425159822,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14320",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyNTE1OTgyMg==",
      "updated_at" : "2018-09-27T16:35:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/425159822",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--32850dd3fdea838b4049e64f46995ea2-->\n| Coverage  | Change ([pull 14320](https://drahtbot.github.io/reports/coverage/bitcoin/bitcoin/14320/total.coverage/index.html)) | Reference ([master](https://drahtbot.github.io/reports/coverage/bitcoin/bitcoin/master/total.coverage/index.html))   |\n|-----------|-------------------------|--------------------|\n| Lines     | +0.0019 %            | 87.0361 %        |\n| Functions | -0.0049 %            | 84.1130 %        |\n| Branches  | -0.0008 %            | 51.5451 %        |\n",
      "created_at" : "2018-09-28T03:33:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14320#issuecomment-425310592",
      "id" : 425310592,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14320",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyNTMxMDU5Mg==",
      "updated_at" : "2018-09-28T03:33:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/425310592",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2018-10-20T09:51:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14320#issuecomment-431566240",
      "id" : 431566240,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14320",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMTU2NjI0MA==",
      "updated_at" : "2018-10-20T09:51:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/431566240",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased",
      "created_at" : "2018-10-21T07:47:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14320#issuecomment-431646954",
      "id" : 431646954,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14320",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMTY0Njk1NA==",
      "updated_at" : "2018-10-21T07:47:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/431646954",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/11154118?v=4",
         "events_url" : "https://api.github.com/users/ken2812221/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ken2812221/followers",
         "following_url" : "https://api.github.com/users/ken2812221/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ken2812221/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ken2812221",
         "id" : 11154118,
         "login" : "ken2812221",
         "node_id" : "MDQ6VXNlcjExMTU0MTE4",
         "organizations_url" : "https://api.github.com/users/ken2812221/orgs",
         "received_events_url" : "https://api.github.com/users/ken2812221/received_events",
         "repos_url" : "https://api.github.com/users/ken2812221/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ken2812221/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ken2812221"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r227140002"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/227140002"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Note: It looks os.path.join change is not directly related to this PR, but is just a fix for listwalletdir (added in #14291) on windows.",
      "commit_id" : "4ea77320c5f0b275876be41ff530bb328ba0cb87",
      "created_at" : "2018-10-22T21:11:28Z",
      "diff_hunk" : "@@ -69,11 +69,13 @@ def wallet_file(name):\n         #   w8         - to verify existing wallet file is loaded correctly\n         #   ''         - to verify default wallet file is created correctly\n         wallet_names = ['w1', 'w2', 'w3', 'w', 'sub/w5', os.path.join(self.options.tmpdir, 'extern/w6'), 'w7_symlink', 'w8', '']\n+        wallet_exclude = set()\n         if os.name == 'nt':\n             wallet_names.remove('w7_symlink')\n+            wallet_exclude = {'w7'}\n         extra_args = ['-wallet={}'.format(n) for n in wallet_names]\n         self.start_node(0, extra_args)\n-        assert_equal(set(map(lambda w: w['name'], self.nodes[0].listwalletdir()['wallets'])), set(['', 'w3', 'w2', 'sub/w5', 'w7', 'w7', 'w1', 'w8', 'w']))\n+        assert_equal(set(map(lambda w: w['name'], self.nodes[0].listwalletdir()['wallets'])), set(['', 'w3', 'w2', os.path.join('sub', 'w5'), 'w7', 'w7', 'w1', 'w8', 'w']) - wallet_exclude)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r227140002",
      "id" : 227140002,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNzE0MDAwMg==",
      "original_commit_id" : "02b6bd343da296dc29ea017447b18c9afa13b5e3",
      "original_position" : 11,
      "path" : "test/functional/wallet_multiwallet.py",
      "position" : null,
      "pull_request_review_id" : 167111739,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320",
      "updated_at" : "2018-10-24T15:08:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/227140002",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r227140322"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/227140322"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> 'w7', 'w7'\r\n\r\nCode precedes this PR, but I think listing w7 twice has no effect.",
      "commit_id" : "4ea77320c5f0b275876be41ff530bb328ba0cb87",
      "created_at" : "2018-10-22T21:12:34Z",
      "diff_hunk" : "@@ -69,11 +69,13 @@ def wallet_file(name):\n         #   w8         - to verify existing wallet file is loaded correctly\n         #   ''         - to verify default wallet file is created correctly\n         wallet_names = ['w1', 'w2', 'w3', 'w', 'sub/w5', os.path.join(self.options.tmpdir, 'extern/w6'), 'w7_symlink', 'w8', '']\n+        wallet_exclude = set()\n         if os.name == 'nt':\n             wallet_names.remove('w7_symlink')\n+            wallet_exclude = {'w7'}\n         extra_args = ['-wallet={}'.format(n) for n in wallet_names]\n         self.start_node(0, extra_args)\n-        assert_equal(set(map(lambda w: w['name'], self.nodes[0].listwalletdir()['wallets'])), set(['', 'w3', 'w2', 'sub/w5', 'w7', 'w7', 'w1', 'w8', 'w']))\n+        assert_equal(set(map(lambda w: w['name'], self.nodes[0].listwalletdir()['wallets'])), set(['', 'w3', 'w2', os.path.join('sub', 'w5'), 'w7', 'w7', 'w1', 'w8', 'w']) - wallet_exclude)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r227140322",
      "id" : 227140322,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNzE0MDMyMg==",
      "original_commit_id" : "02b6bd343da296dc29ea017447b18c9afa13b5e3",
      "original_position" : 11,
      "path" : "test/functional/wallet_multiwallet.py",
      "position" : null,
      "pull_request_review_id" : 167111739,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320",
      "updated_at" : "2018-10-24T15:08:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/227140322",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r227157098"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/227157098"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is changed in #14531.",
      "commit_id" : "4ea77320c5f0b275876be41ff530bb328ba0cb87",
      "created_at" : "2018-10-22T22:14:08Z",
      "diff_hunk" : "@@ -69,11 +69,13 @@ def wallet_file(name):\n         #   w8         - to verify existing wallet file is loaded correctly\n         #   ''         - to verify default wallet file is created correctly\n         wallet_names = ['w1', 'w2', 'w3', 'w', 'sub/w5', os.path.join(self.options.tmpdir, 'extern/w6'), 'w7_symlink', 'w8', '']\n+        wallet_exclude = set()\n         if os.name == 'nt':\n             wallet_names.remove('w7_symlink')\n+            wallet_exclude = {'w7'}\n         extra_args = ['-wallet={}'.format(n) for n in wallet_names]\n         self.start_node(0, extra_args)\n-        assert_equal(set(map(lambda w: w['name'], self.nodes[0].listwalletdir()['wallets'])), set(['', 'w3', 'w2', 'sub/w5', 'w7', 'w7', 'w1', 'w8', 'w']))\n+        assert_equal(set(map(lambda w: w['name'], self.nodes[0].listwalletdir()['wallets'])), set(['', 'w3', 'w2', os.path.join('sub', 'w5'), 'w7', 'w7', 'w1', 'w8', 'w']) - wallet_exclude)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r227157098",
      "id" : 227157098,
      "in_reply_to_id" : 227140322,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNzE1NzA5OA==",
      "original_commit_id" : "02b6bd343da296dc29ea017447b18c9afa13b5e3",
      "original_position" : 11,
      "path" : "test/functional/wallet_multiwallet.py",
      "position" : null,
      "pull_request_review_id" : 167132520,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320",
      "updated_at" : "2018-10-24T15:08:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/227157098",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Just split appveyor part to #14559 to make this PR easier to review.",
      "created_at" : "2018-10-24T07:13:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14320#issuecomment-432540256",
      "id" : 432540256,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14320",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMjU0MDI1Ng==",
      "updated_at" : "2018-10-24T07:13:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/432540256",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/11154118?v=4",
         "events_url" : "https://api.github.com/users/ken2812221/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ken2812221/followers",
         "following_url" : "https://api.github.com/users/ken2812221/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ken2812221/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ken2812221",
         "id" : 11154118,
         "login" : "ken2812221",
         "node_id" : "MDQ6VXNlcjExMTU0MTE4",
         "organizations_url" : "https://api.github.com/users/ken2812221/orgs",
         "received_events_url" : "https://api.github.com/users/ken2812221/received_events",
         "repos_url" : "https://api.github.com/users/ken2812221/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ken2812221/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ken2812221"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r227735179"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/227735179"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good catch indeed. The bug was not introduced in 0b82bac but in a769461d?",
      "commit_id" : "4ea77320c5f0b275876be41ff530bb328ba0cb87",
      "created_at" : "2018-10-24T10:40:47Z",
      "diff_hunk" : "@@ -826,6 +826,8 @@ void BerkeleyDatabase::Flush(bool shutdown)\n             LOCK(cs_db);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r227735179",
      "id" : 227735179,
      "in_reply_to_id" : 220332273,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNzczNTE3OQ==",
      "original_commit_id" : "f31c3fcc88960503bea5fd2d078286f93cf2416e",
      "original_position" : 63,
      "path" : "src/wallet/db.cpp",
      "position" : 61,
      "pull_request_review_id" : 167840681,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320",
      "updated_at" : "2018-10-24T15:08:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/227735179",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r227811095"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/227811095"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It might not be clear what \"wild pointers\" refers to in this todo (laanwj asked about it here: https://github.com/bitcoin/bitcoin/pull/14531#discussion_r227770685). Wild pointers could mean either dead pointers or raw pointers, but I think the TODO is referring to the bug described here: https://github.com/bitcoin/bitcoin/pull/14320#discussion_r220332273. Maybe could be expanded as:\r\n\r\n```c++\r\n// TODO: To avoid g_dbenvs.erase erasing the environment prematurely after the\r\n// first database shutdown when multiple databases are open in the same\r\n// environment, should replace raw database `env` pointers with shared or weak\r\n// pointers, or else separate the database and environment shutdowns so\r\n// environments can be shut down after databases.\r\n```",
      "commit_id" : "4ea77320c5f0b275876be41ff530bb328ba0cb87",
      "created_at" : "2018-10-24T14:23:53Z",
      "diff_hunk" : "@@ -826,6 +826,10 @@ void BerkeleyDatabase::Flush(bool shutdown)\n             LOCK(cs_db);\n             g_dbenvs.erase(env->Directory().string());\n             env = nullptr;\n+        } else {\n+            // To avoid accessing a map that has already deconstructed, do not call this when shutdown is true. g_dbenvs.erase would also erase this value.\n+            // TODO: get rid of wild pointers\n+            env->m_fileids.erase(strFile);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r227811095",
      "id" : 227811095,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNzgxMTA5NQ==",
      "original_commit_id" : "ef16fc5da6ca6b33d4a92e509d627d908f8ed995",
      "original_position" : 67,
      "path" : "src/wallet/db.cpp",
      "position" : 70,
      "pull_request_review_id" : 167936780,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320",
      "updated_at" : "2018-10-24T15:08:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/227811095",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r227816594"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/227816594"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@laanwj suggested `BerkeleyFileId`. I also suggest `WalletDatabaseFileId` or `DBFileId`.",
      "commit_id" : "4ea77320c5f0b275876be41ff530bb328ba0cb87",
      "created_at" : "2018-10-24T14:35:11Z",
      "diff_hunk" : "@@ -18,13 +18,19 @@\n #include <map>\n #include <memory>\n #include <string>\n+#include <unordered_map>\n #include <vector>\n \n #include <db_cxx.h>\n \n static const unsigned int DEFAULT_WALLET_DBLOGSIZE = 100;\n static const bool DEFAULT_WALLET_PRIVDB = true;\n \n+struct BerkeleyFileid {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r227816594",
      "id" : 227816594,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNzgxNjU5NA==",
      "original_commit_id" : "ef16fc5da6ca6b33d4a92e509d627d908f8ed995",
      "original_position" : 12,
      "path" : "src/wallet/db.h",
      "position" : null,
      "pull_request_review_id" : 167840681,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320",
      "updated_at" : "2018-10-24T15:08:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/227816594",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ef16fc5 -> 4ea7732\r\n1. Rename BerkeleyFileid -> WalletDatabaseFileId (@promag)\r\n2. Added @ryanofsky's comments",
      "created_at" : "2018-10-24T15:13:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14320#issuecomment-432700770",
      "id" : 432700770,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14320",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMjcwMDc3MA==",
      "updated_at" : "2018-10-24T15:13:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/432700770",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/11154118?v=4",
         "events_url" : "https://api.github.com/users/ken2812221/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ken2812221/followers",
         "following_url" : "https://api.github.com/users/ken2812221/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ken2812221/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ken2812221",
         "id" : 11154118,
         "login" : "ken2812221",
         "node_id" : "MDQ6VXNlcjExMTU0MTE4",
         "organizations_url" : "https://api.github.com/users/ken2812221/orgs",
         "received_events_url" : "https://api.github.com/users/ken2812221/received_events",
         "repos_url" : "https://api.github.com/users/ken2812221/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ken2812221/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ken2812221"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r227842330"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/227842330"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thread https://github.com/bitcoin/bitcoin/pull/14320#discussion_r220332273\r\n\r\n> Good catch indeed. The bug was not introduced in 0b82bac but in a769461?\r\n\r\n0b82bac76d0f842bd2294a290388536951fbc576 added the call to erase the environment too early and a769461d5e37ddcb771ae836254fdc69177a28c4 just moved the call, IIUC.",
      "commit_id" : "4ea77320c5f0b275876be41ff530bb328ba0cb87",
      "created_at" : "2018-10-24T15:30:35Z",
      "diff_hunk" : "@@ -826,6 +826,8 @@ void BerkeleyDatabase::Flush(bool shutdown)\n             LOCK(cs_db);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14320#discussion_r227842330",
      "id" : 227842330,
      "in_reply_to_id" : 220332273,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNzg0MjMzMA==",
      "original_commit_id" : "f31c3fcc88960503bea5fd2d078286f93cf2416e",
      "original_position" : 63,
      "path" : "src/wallet/db.cpp",
      "position" : 61,
      "pull_request_review_id" : 167975024,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14320",
      "updated_at" : "2018-10-24T15:30:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/227842330",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Tested ACK 4ea7732, new test fails without this fix.",
      "created_at" : "2018-10-24T15:32:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14320#issuecomment-432707886",
      "id" : 432707886,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14320",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMjcwNzg4Ng==",
      "updated_at" : "2018-10-24T15:32:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/432707886",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 6241eb3224d95ea04c04dcab2dac88687f49440e",
      "created_at" : "2018-10-24T15:37:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14320#issuecomment-432709742",
      "id" : 432709742,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14320",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMjcwOTc0Mg==",
      "updated_at" : "2018-10-24T15:37:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/432709742",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
