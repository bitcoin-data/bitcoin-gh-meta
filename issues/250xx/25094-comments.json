[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I retested this using 24.0rc5, and I also set up a second bitcoind instance just for testing my hidden service. Similar setup, but I use\r\n\r\n```\r\n-connect=xxx.onion:8333\r\n```\r\n\r\nto specifically only connect to my hidden server (address redacted). However, all I get in the log of the connecting bitcoind is:\r\n\r\n```\r\nSocks5() connect to xxx.onion:8333 failed: general failure\r\n```\r\n\r\nNote that if I configure a hidden service manually (in the tor container), I can connect. So my test setup seems to be fine.\r\n\r\nIt would be great if I could somehow see in the logs what bitcoind tells tor via the control port. For example, does it perhaps tell to connect to localhost rather than bitcoind? Does such a tracelog exist?",
      "created_at" : "2022-11-10T15:18:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/25094#issuecomment-1310448086",
      "id" : 1310448086,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25094",
      "node_id" : "IC_kwDOABII585OG9nW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1310448086/reactions"
      },
      "updated_at" : "2022-11-10T15:19:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1310448086",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/743306?v=4",
         "events_url" : "https://api.github.com/users/schildbach/events{/privacy}",
         "followers_url" : "https://api.github.com/users/schildbach/followers",
         "following_url" : "https://api.github.com/users/schildbach/following{/other_user}",
         "gists_url" : "https://api.github.com/users/schildbach/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/schildbach",
         "id" : 743306,
         "login" : "schildbach",
         "node_id" : "MDQ6VXNlcjc0MzMwNg==",
         "organizations_url" : "https://api.github.com/users/schildbach/orgs",
         "received_events_url" : "https://api.github.com/users/schildbach/received_events",
         "repos_url" : "https://api.github.com/users/schildbach/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/schildbach/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/schildbach/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/schildbach"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm now pretty confident that the hidden service configuration of bitcoind via control port is broken in the following way:\r\n\r\nIf you bind the port for incoming onion connections via wildcard, like this\r\n\r\n```\r\n-bind=[::]:8334=onion\r\n```\r\n\r\nit uses that wildcard address as a target address for the hidden service. Which will fail, because a wildcard has a different meaning to the container that has Tor. The result is zero incoming connections via hidden service, and the above errors on the client side of the hidden service.\r\n",
      "created_at" : "2022-11-11T09:57:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/25094#issuecomment-1311481256",
      "id" : 1311481256,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25094",
      "node_id" : "IC_kwDOABII585OK52o",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1311481256/reactions"
      },
      "updated_at" : "2022-11-11T09:57:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1311481256",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/743306?v=4",
         "events_url" : "https://api.github.com/users/schildbach/events{/privacy}",
         "followers_url" : "https://api.github.com/users/schildbach/followers",
         "following_url" : "https://api.github.com/users/schildbach/following{/other_user}",
         "gists_url" : "https://api.github.com/users/schildbach/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/schildbach",
         "id" : 743306,
         "login" : "schildbach",
         "node_id" : "MDQ6VXNlcjc0MzMwNg==",
         "organizations_url" : "https://api.github.com/users/schildbach/orgs",
         "received_events_url" : "https://api.github.com/users/schildbach/received_events",
         "repos_url" : "https://api.github.com/users/schildbach/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/schildbach/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/schildbach/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/schildbach"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "The default for signet is `-bind=127.0.0.1:38334=onion`. From your attached `log-bitcoind.txt`:\r\n\r\n> Bound to 127.0.0.1:38334\r\n\r\nThen `bitcoind` is telling the tor daemon to redirect connections destined to the `.onion` address to `127.0.0.1:38334`. This obviously does not work when Tor is running on a different machine than `bitcoind`. You need to modify the default to something like `-bind=a.b.c.d:38334=onion` such that `bitcoind` can bind to `a.b.c.d` and the tor daemon can connect to it. `[::]` fulfills the first but not the second :(\r\n\r\nIs it not possible to have the docker-assigned IP address of the machine in an environment variable, like e.g. `${TOR_SOCKS_PORT}` from above?",
      "created_at" : "2022-11-11T11:02:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/25094#issuecomment-1311552077",
      "id" : 1311552077,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25094",
      "node_id" : "IC_kwDOABII585OLLJN",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1311552077/reactions"
      },
      "updated_at" : "2022-11-11T11:03:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1311552077",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Sorry for the signet/mainnet mismatch between my May and current configurations. Btw. the hidden service address from May also doesn't exist any more, I think.\r\n\r\n> Then bitcoind is telling the tor daemon to redirect connections destined to the .onion address to 127.0.0.1:38334.\r\n\r\nIt probably shouldn't do that and instead print a message to the log? And, like I suggested in the other issue, maybe a configuration option for what address to use in this case would make sense?\r\n\r\n> Is it not possible to have the docker-assigned IP address of the machine in an environment variable, like e.g. ${TOR_SOCKS_PORT} from above?\r\n\r\nAfaik no. Docker recommends using hostnames.\r\n\r\n\r\n",
      "created_at" : "2022-11-11T12:14:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/25094#issuecomment-1311624897",
      "id" : 1311624897,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25094",
      "node_id" : "IC_kwDOABII585OLc7B",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1311624897/reactions"
      },
      "updated_at" : "2022-11-11T12:15:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1311624897",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/743306?v=4",
         "events_url" : "https://api.github.com/users/schildbach/events{/privacy}",
         "followers_url" : "https://api.github.com/users/schildbach/followers",
         "following_url" : "https://api.github.com/users/schildbach/following{/other_user}",
         "gists_url" : "https://api.github.com/users/schildbach/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/schildbach",
         "id" : 743306,
         "login" : "schildbach",
         "node_id" : "MDQ6VXNlcjc0MzMwNg==",
         "organizations_url" : "https://api.github.com/users/schildbach/orgs",
         "received_events_url" : "https://api.github.com/users/schildbach/received_events",
         "repos_url" : "https://api.github.com/users/schildbach/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/schildbach/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/schildbach/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/schildbach"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> It probably shouldn't do that and instead print a message to the log?\r\n\r\nWhy? It works well in the default case when tor is on the same machine and `-bind=127.0.0.1:8334=onion` and `-torcontrol=127.0.0.1:9051` (these are the default values). You have changed `-torcontrol`, but not `-bind=...=onion`. If you change the latter, then it will work too.\r\n\r\nThe only problem is that you want to use a hostname instead of an IP address for `-bind`, right?",
      "created_at" : "2022-11-11T13:32:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/25094#issuecomment-1311700853",
      "id" : 1311700853,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25094",
      "node_id" : "IC_kwDOABII585OLvd1",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1311700853/reactions"
      },
      "updated_at" : "2022-11-11T13:32:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1311700853",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "What I meant is it should probably not silently convert `[::]` to `127.0.0.1`. Yes, if you bind to `127.0.0.1` then it's expected to use `127.0.0.1` for the hidden service target. Of course running bitcoind and tor in the same container is not really recommended.\r\n\r\nAn elegant way to support the container isolated case would be\r\n\r\n```\r\n-torcontrol=tor:9051\r\n-bind=tor:8334=onion\r\n```\r\n\r\nor\r\n\r\n```\r\n-torcontrol=tor:9051\r\n-bind=[::]:8334=onion\r\n-hiddenservicetarget=tor:8334\r\n```\r\n\r\n\"hiddenservicetarget\" being a new option that would separate the bind address from the target address. If it exists, bitcoind would not try to derive the target address from the onion bind address and instead use the value of the option.\r\n\r\nI think one of these two ways should be considered in order to support container isolation.\r\n",
      "created_at" : "2022-11-11T14:25:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/25094#issuecomment-1311760237",
      "id" : 1311760237,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25094",
      "node_id" : "IC_kwDOABII585OL99t",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1311760237/reactions"
      },
      "updated_at" : "2022-11-11T14:29:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1311760237",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/743306?v=4",
         "events_url" : "https://api.github.com/users/schildbach/events{/privacy}",
         "followers_url" : "https://api.github.com/users/schildbach/followers",
         "following_url" : "https://api.github.com/users/schildbach/following{/other_user}",
         "gists_url" : "https://api.github.com/users/schildbach/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/schildbach",
         "id" : 743306,
         "login" : "schildbach",
         "node_id" : "MDQ6VXNlcjc0MzMwNg==",
         "organizations_url" : "https://api.github.com/users/schildbach/orgs",
         "received_events_url" : "https://api.github.com/users/schildbach/received_events",
         "repos_url" : "https://api.github.com/users/schildbach/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/schildbach/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/schildbach/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/schildbach"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> What I meant is it should probably not silently convert [::] to 127.0.0.1\r\n\r\nYes, probably it makes sense to print something like \"tor control returned an invalid address for the socks5 proxy: [::]:9050, falling back to the default 127.0.0.1:9050`.\r\n\r\n> I think one of these two ways should be considered in order to support container isolation.\r\n\r\nI agree.",
      "created_at" : "2022-11-11T14:55:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/25094#issuecomment-1311789124",
      "id" : 1311789124,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25094",
      "node_id" : "IC_kwDOABII585OMFBE",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1311789124/reactions"
      },
      "updated_at" : "2022-11-11T14:55:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1311789124",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   }
]
