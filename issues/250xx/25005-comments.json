[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#25269](https://github.com/bitcoin/bitcoin/pull/25269) (wallet: re-activate the not triggered  \"AmountWithFeeExceedsBalance\" error by furszy)\n* [#25183](https://github.com/bitcoin/bitcoin/pull/25183) (rpc: Segwit-only inputs option for fundrawtransaction by aureleoules)\n* [#24699](https://github.com/bitcoin/bitcoin/pull/24699) (wallet: Improve AvailableCoins performance by reducing duplicated operations by achow101)\n* [#24584](https://github.com/bitcoin/bitcoin/pull/24584) (wallet: avoid mixing different `OutputTypes` during coin selection by josibake)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-04-28T02:00:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#issuecomment-1111657636",
      "id" : 1111657636,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25005",
      "node_id" : "IC_kwDOABII585CQoyk",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1111657636/reactions"
      },
      "updated_at" : "2022-06-17T07:02:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1111657636",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@furszy It looks like the qt wallet test is failing in the CI. You can run `./src/qt/test/test_bitcoin-qt` in your dev environment to reproduce and debug the issue.",
      "created_at" : "2022-04-28T10:45:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#issuecomment-1112056877",
      "id" : 1112056877,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25005",
      "node_id" : "IC_kwDOABII585CSKQt",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1112056877/reactions"
      },
      "updated_at" : "2022-04-28T10:45:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1112056877",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Ah, thanks @jonatack ð. Just noticed that the GUI `WalletTests` isn't run by default in my OS under `make check`.\r\n\r\nIt's an easy fix; as the test doesn't start the balance polling timer, the model does not have the balance cached so.. as 5babfb7 make uses of it, the creation process fails with a not-enough balance error.\r\n\r\nWill push the fix and expand + improve the test coverage a bit more.\r\nAnd.. most likely will decouple that last commit into a separate PR in few days. Have some further improvements locally for the wallet model area that can package out all together that aren't really part of the scope of this PR.\r\n(like a mutex to be able to access the model cached balance from different threads, connect it to the widgets etc..)",
      "created_at" : "2022-04-28T14:01:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#issuecomment-1112243680",
      "id" : 1112243680,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25005",
      "node_id" : "IC_kwDOABII585CS33g",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1112243680/reactions"
      },
      "updated_at" : "2022-04-28T14:19:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1112243680",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> 6) The GUI `WalletModel::prepareTransaction` will now use the cached balance to make the funds availability check if the user didn't manually selected outputs to spend. This will avoid an entire on-demand recalculation of the available balance which is quite expensive as the wallet has to walk through the entire txs map.\r\n\r\nDropped the last two commits that were implementing point (6) described above. They are now part of https://github.com/bitcoin-core/gui/pull/598",
      "created_at" : "2022-05-09T20:58:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#issuecomment-1121574208",
      "id" : 1121574208,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25005",
      "node_id" : "IC_kwDOABII585C2d1A",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1121574208/reactions"
      },
      "updated_at" : "2022-05-10T15:03:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1121574208",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r874124981"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/874124981"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 2cdd2a1a5498cb8767799dd26a4082e9d3b064ee \"wallet: speedup 'GetAvailableBalance' filtering by spendable outputs only and using the 'AvailableCoins' retrieved total_amount.\"\r\n\r\nWhat is the purpose of the rename and making an empty `CCoinControl` here? `AvailableCoins` can take `nullptr` for `coinControl`.",
      "commit_id" : "2cdd2a1a5498cb8767799dd26a4082e9d3b064ee",
      "created_at" : "2022-05-16T20:23:45Z",
      "diff_hunk" : "@@ -225,17 +223,13 @@ CoinsResult AvailableCoins(const CWallet& wallet,\n     return result;\n }\n \n-CAmount GetAvailableBalance(const CWallet& wallet, const CCoinControl* coinControl)\n+CAmount GetAvailableBalance(const CWallet& wallet, const CCoinControl* _coinControl)\n {\n     LOCK(wallet.cs_wallet);\n-\n-    CAmount balance = 0;\n-    for (const COutput& out : AvailableCoins(wallet, coinControl).coins) {\n-        if (out.spendable) {\n-            balance += out.txout.nValue;\n-        }\n-    }\n-    return balance;\n+    // Copy to filter by spendable coins only\n+    CCoinControl coinControl = _coinControl ? *_coinControl : CCoinControl();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r874124981",
      "id" : 874124981,
      "line" : 230,
      "node_id" : "PRRC_kwDOABII5840Gha1",
      "original_commit_id" : "2cdd2a1a5498cb8767799dd26a4082e9d3b064ee",
      "original_line" : 230,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 40,
      "pull_request_review_id" : 974523072,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/874124981/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-16T20:27:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/874124981",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Hey achow101, thanks for the review!\r\n\r\n> I don't quite understand the purpose of the first commit. It doesn't seem like it materially improves anything?\r\n\r\nWe are skipping the non-spendable coins that appear in `vCoins` (`AvailableCoins` result) later, in several parts of the `CreateTransaction` and `GetBalance` flows:\r\n\r\n1.  `GetAvailableBalance` was (1) getting all the available coins calling `AvailableCoins` and, right away, walking through the entire vector, skipping the non-spendable coins, to calculate the total balance.â¨\r\n\r\n2. Inside `CreateTransactionInternal` â> `SelectCoins(vCoins,...)`, we have several calls to `AttemptSelection` which, on each of them internally, we call twice to `GroupOutputs` which internally has two for-loops over the entire `vCoins` vector that skip the non-spendable coins.\r\n\r\nSo, the purpose is not add the non-spendable coins into the `AvailableCoins` result (`vCoins`) in the first place for the processes that arenât using them at all, so we donât waste resources skipping them later so many times.\r\n\r\nNote: this speedup is for all the processes that calls to `CreateTransaction` and `GetBalance*` internally.",
      "created_at" : "2022-05-21T17:54:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#issuecomment-1133735550",
      "id" : 1133735550,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25005",
      "node_id" : "IC_kwDOABII585Dk25-",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1133735550/reactions"
      },
      "updated_at" : "2022-05-21T17:54:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1133735550",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r878744964"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/878744964"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The previous flow was:\r\n```c++\r\nstd::vector<COutput> vCoins;\r\nAvailableCoins(wallet, vCoins, coinControl);\r\nfor (const COutput& out : vCoins) {\r\n     if (out.spendable) { --> // this is the reason\r\n         balance += out.txout.nValue;\r\n     }\r\n}\r\n```\r\n\r\nTo remove the second unnecessary for-loop, as the function arg is `const CCoinControl*`, in order to continue having the same calculation (skipping the non-spendable coins), needed to create a local copy of the `coinControl` arg and set the new flag `m_include_only_spendable_outputs` to true (which by default is false).\r\n\r\nSo the coins vector and the total balance returned by `AvailableCoins` has all, and only, the spendable coins directly.\r\n\r\nIn the new flow:\r\n```c++\r\nCCoinControl coinControl = _coinControl ? *_coinControl : CCoinControl();\r\ncoinControl.m_include_only_spendable_outputs = true; // --> this enforces that non-spendable coins are filtered from `AvailableCoins` result.\r\nreturn AvailableCoins(wallet, &coinControl).total_amount;\r\n```\r\n",
      "commit_id" : "46ac311e0bf706482bb8d7001f6ff6825620caff",
      "created_at" : "2022-05-21T18:09:03Z",
      "diff_hunk" : "@@ -225,17 +223,13 @@ CoinsResult AvailableCoins(const CWallet& wallet,\n     return result;\n }\n \n-CAmount GetAvailableBalance(const CWallet& wallet, const CCoinControl* coinControl)\n+CAmount GetAvailableBalance(const CWallet& wallet, const CCoinControl* _coinControl)\n {\n     LOCK(wallet.cs_wallet);\n-\n-    CAmount balance = 0;\n-    for (const COutput& out : AvailableCoins(wallet, coinControl).coins) {\n-        if (out.spendable) {\n-            balance += out.txout.nValue;\n-        }\n-    }\n-    return balance;\n+    // Copy to filter by spendable coins only\n+    CCoinControl coinControl = _coinControl ? *_coinControl : CCoinControl();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r878744964",
      "id" : 878744964,
      "in_reply_to_id" : 874124981,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5840YJWE",
      "original_commit_id" : "2cdd2a1a5498cb8767799dd26a4082e9d3b064ee",
      "original_line" : 236,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 980866810,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/878744964/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-21T21:46:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/878744964",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased after #25083 merge. Conflicts solved.",
      "created_at" : "2022-05-23T18:18:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#issuecomment-1134992768",
      "id" : 1134992768,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25005",
      "node_id" : "IC_kwDOABII585Dpp2A",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1134992768/reactions"
      },
      "updated_at" : "2022-05-23T18:18:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1134992768",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r888117918"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/888117918"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 3082f2270fa96eaf2bd1d5e69d56fce9588a4f79 \"wallet: add 'm_include_only_spendable_outputs' filter to CoinControl\"\r\n\r\nInstead of setting this parameter all the way out here in the RPC, I think it would make more sense to set it closer to the places where it actually matters, e.g. in `CreateTransactionInternal` right before `AvailableCoins` is called. This way we won't have to remember to always set this option for every caller to `CreateTransaction`.",
      "commit_id" : "46ac311e0bf706482bb8d7001f6ff6825620caff",
      "created_at" : "2022-06-02T15:53:03Z",
      "diff_hunk" : "@@ -395,6 +396,8 @@ RPCHelpMan sendmany()\n         coin_control.m_signal_bip125_rbf = request.params[5].get_bool();\n     }\n \n+    coin_control.m_include_only_spendable_outputs = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r888117918",
      "id" : 888117918,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584075qe",
      "original_commit_id" : "3082f2270fa96eaf2bd1d5e69d56fce9588a4f79",
      "original_line" : 399,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 993779961,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/888117918/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-02T16:00:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/888117918",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r888119926"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/888119926"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In aa0be53fcd85f8ad8102c5843baeec9d0740297a \"wallet::AvailableCoins, stop calling 'wtx.tx->vout[i]' multiple times.\"\r\n\r\nnit: const\r\n```suggestion\r\n            const COutPoint outpoint(wtxid, i);\r\n```",
      "commit_id" : "46ac311e0bf706482bb8d7001f6ff6825620caff",
      "created_at" : "2022-06-02T15:55:13Z",
      "diff_hunk" : "@@ -166,24 +166,27 @@ CoinsResult AvailableCoins(const CWallet& wallet,\n         bool tx_from_me = CachedTxIsFromMe(wallet, wtx, ISMINE_ALL);\n \n         for (unsigned int i = 0; i < wtx.tx->vout.size(); i++) {\n+            const CTxOut& output = wtx.tx->vout[i];\n+            COutPoint outpoint(wtxid, i);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r888119926",
      "id" : 888119926,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584076J2",
      "original_commit_id" : "aa0be53fcd85f8ad8102c5843baeec9d0740297a",
      "original_line" : 170,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 993779961,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/888119926/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-02T16:00:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/888119926",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r888123040"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/888123040"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In da875e6e8008f9b7053b5ce42fade49a322e0a50 \"wallet::IsSpent accepting 'COutPoint' instead of hash:index.\"\r\n\r\nnit: inline\r\n```suggestion\r\n        if (!wallet.IsSpent(COutPoint(hashTx, i)) && (allow_used_addresses || !wallet.IsSpentKey(hashTx, i))) {\r\n```",
      "commit_id" : "46ac311e0bf706482bb8d7001f6ff6825620caff",
      "created_at" : "2022-06-02T15:58:31Z",
      "diff_hunk" : "@@ -204,9 +204,9 @@ CAmount CachedTxGetAvailableCredit(const CWallet& wallet, const CWalletTx& wtx,\n     bool allow_used_addresses = (filter & ISMINE_USED) || !wallet.IsWalletFlagSet(WALLET_FLAG_AVOID_REUSE);\n     CAmount nCredit = 0;\n     uint256 hashTx = wtx.GetHash();\n-    for (unsigned int i = 0; i < wtx.tx->vout.size(); i++)\n-    {\n-        if (!wallet.IsSpent(hashTx, i) && (allow_used_addresses || !wallet.IsSpentKey(hashTx, i))) {\n+    for (unsigned int i = 0; i < wtx.tx->vout.size(); i++)  {\n+        COutPoint outpoint(hashTx, i);\n+        if (!wallet.IsSpent(outpoint) && (allow_used_addresses || !wallet.IsSpentKey(hashTx, i))) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r888123040",
      "id" : 888123040,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5840766g",
      "original_commit_id" : "da875e6e8008f9b7053b5ce42fade49a322e0a50",
      "original_line" : 209,
      "original_position" : 9,
      "original_start_line" : 208,
      "path" : "src/wallet/receive.cpp",
      "position" : null,
      "pull_request_review_id" : 993779961,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/888123040/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-06-02T16:00:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/888123040",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r888153750"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/888153750"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I was doing it there first but the `CCoinControl` arg of `CreateTransactionInternal` is const. Options were (1) modify it by copying the coin control object to a temp variable or (2) change the function signature.\r\n\r\nAnd at least in this case, I wasn't totally good with those two options (not against neither, it was a \"maybe\"). But open for new thoughts, would you prefer option 1 more?",
      "commit_id" : "46ac311e0bf706482bb8d7001f6ff6825620caff",
      "created_at" : "2022-06-02T16:25:22Z",
      "diff_hunk" : "@@ -395,6 +396,8 @@ RPCHelpMan sendmany()\n         coin_control.m_signal_bip125_rbf = request.params[5].get_bool();\n     }\n \n+    coin_control.m_include_only_spendable_outputs = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r888153750",
      "id" : 888153750,
      "in_reply_to_id" : 888117918,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58408CaW",
      "original_commit_id" : "3082f2270fa96eaf2bd1d5e69d56fce9588a4f79",
      "original_line" : 399,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 993829928,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/888153750/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-02T16:25:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/888153750",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r888192137"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/888192137"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Actually, since this option is really just for `AvailableCoins` itself, it might make more sense to make it a parameter to `AvailableCoins` rather than having it in `CCoinControl`.",
      "commit_id" : "46ac311e0bf706482bb8d7001f6ff6825620caff",
      "created_at" : "2022-06-02T17:08:27Z",
      "diff_hunk" : "@@ -395,6 +396,8 @@ RPCHelpMan sendmany()\n         coin_control.m_signal_bip125_rbf = request.params[5].get_bool();\n     }\n \n+    coin_control.m_include_only_spendable_outputs = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r888192137",
      "id" : 888192137,
      "in_reply_to_id" : 888117918,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58408LyJ",
      "original_commit_id" : "3082f2270fa96eaf2bd1d5e69d56fce9588a4f79",
      "original_line" : 399,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 993884505,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/888192137/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-02T17:08:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/888192137",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r888245468"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/888245468"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ðð¼ , added it in 8daa58b.",
      "commit_id" : "5646ccf4af89bd77953030dedabb1545b851d3ea",
      "created_at" : "2022-06-02T18:02:46Z",
      "diff_hunk" : "@@ -395,6 +396,8 @@ RPCHelpMan sendmany()\n         coin_control.m_signal_bip125_rbf = request.params[5].get_bool();\n     }\n \n+    coin_control.m_include_only_spendable_outputs = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r888245468",
      "id" : 888245468,
      "in_reply_to_id" : 888117918,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58408Yzc",
      "original_commit_id" : "3082f2270fa96eaf2bd1d5e69d56fce9588a4f79",
      "original_line" : 399,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 993957994,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/888245468/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-05T14:21:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/888245468",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Ready, feedback applied:\r\n\r\n- Moved `only_spendable` from be a `CoinControl` field to be a `AvailableCoins` param.\r\n- Nits tackled.",
      "created_at" : "2022-06-02T18:06:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#issuecomment-1145160959",
      "id" : 1145160959,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25005",
      "node_id" : "IC_kwDOABII585EQcT_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1145160959/reactions"
      },
      "updated_at" : "2022-06-02T18:06:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1145160959",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2022-06-05T20:18:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#issuecomment-1146877116",
      "id" : 1146877116,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25005",
      "node_id" : "IC_kwDOABII585EW_S8",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1146877116/reactions"
      },
      "updated_at" : "2022-06-05T20:18:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1146877116",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r891477877"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891477877"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The `vCoins` parameter doesn't exist anymore, i.e. the comment should be adapted accordingly. E.g.\r\n```suggestion\r\n * Return vector of available COutputs.\r\n```",
      "commit_id" : "5646ccf4af89bd77953030dedabb1545b851d3ea",
      "created_at" : "2022-06-07T16:44:01Z",
      "diff_hunk" : "@@ -34,16 +34,28 @@ struct TxSize {\n TxSize CalculateMaximumSignedTxSize(const CTransaction& tx, const CWallet* wallet, const std::vector<CTxOut>& txouts, const CCoinControl* coin_control = nullptr);\n TxSize CalculateMaximumSignedTxSize(const CTransaction& tx, const CWallet* wallet, const CCoinControl* coin_control = nullptr) EXCLUSIVE_LOCKS_REQUIRED(wallet->cs_wallet);\n \n+struct CoinsResult {\n+    std::vector<COutput> coins;\n+    // Sum of all the coins amounts\n+    CAmount total_amount{0};\n+};\n /**\n- * populate vCoins with vector of available COutputs.\n+ * Populate vCoins with vector of available COutputs.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r891477877",
      "id" : 891477877,
      "line" : 43,
      "node_id" : "PRRC_kwDOABII5841It91",
      "original_commit_id" : "5646ccf4af89bd77953030dedabb1545b851d3ea",
      "original_line" : 43,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/wallet/spend.h",
      "position" : 11,
      "pull_request_review_id" : 998508682,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891477877/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-07T17:12:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891477877",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r891482704"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891482704"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: unnecessary whitespace\r\n```suggestion\r\n    for (unsigned int i = 0; i < wtx.tx->vout.size(); i++) {\r\n```",
      "commit_id" : "5646ccf4af89bd77953030dedabb1545b851d3ea",
      "created_at" : "2022-06-07T16:48:19Z",
      "diff_hunk" : "@@ -204,10 +204,9 @@ CAmount CachedTxGetAvailableCredit(const CWallet& wallet, const CWalletTx& wtx,\n     bool allow_used_addresses = (filter & ISMINE_USED) || !wallet.IsWalletFlagSet(WALLET_FLAG_AVOID_REUSE);\n     CAmount nCredit = 0;\n     uint256 hashTx = wtx.GetHash();\n-    for (unsigned int i = 0; i < wtx.tx->vout.size(); i++)\n-    {\n-        if (!wallet.IsSpent(hashTx, i) && (allow_used_addresses || !wallet.IsSpentKey(hashTx, i))) {\n-            const CTxOut &txout = wtx.tx->vout[i];\n+    for (unsigned int i = 0; i < wtx.tx->vout.size(); i++)  {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r891482704",
      "id" : 891482704,
      "line" : 207,
      "node_id" : "PRRC_kwDOABII5841IvJQ",
      "original_commit_id" : "5646ccf4af89bd77953030dedabb1545b851d3ea",
      "original_line" : 207,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/wallet/receive.cpp",
      "position" : 8,
      "pull_request_review_id" : 998508682,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891482704/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-07T17:12:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891482704",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r891498739"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891498739"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Not tested, but would it make sense to set the default parameter of `spendable_only` of `AvailableCoins` to `true` rather than `false`? Then this call would simply be\r\n```suggestion\r\n    return AvailableCoins(wallet, coinControl).total_amount;\r\n```\r\nAs far as I can see, there are only 4 instances in total that call `AvailableCoins`, so it should be quite easy to find out where `false` has to be passed explicitly for the `spendable_only` parameter.",
      "commit_id" : "5646ccf4af89bd77953030dedabb1545b851d3ea",
      "created_at" : "2022-06-07T17:05:25Z",
      "diff_hunk" : "@@ -159,76 +165,82 @@ void AvailableCoins(const CWallet& wallet, std::vector<COutput>& vCoins, const C\n         bool tx_from_me = CachedTxIsFromMe(wallet, wtx, ISMINE_ALL);\n \n         for (unsigned int i = 0; i < wtx.tx->vout.size(); i++) {\n+            const CTxOut& output = wtx.tx->vout[i];\n+            const COutPoint outpoint(wtxid, i);\n+\n             // Only consider selected coins if add_inputs is false\n-            if (coinControl && !coinControl->m_add_inputs && !coinControl->IsSelected(COutPoint(entry.first, i))) {\n+            if (coinControl && !coinControl->m_add_inputs && !coinControl->IsSelected(outpoint)) {\n                 continue;\n             }\n \n-            if (wtx.tx->vout[i].nValue < nMinimumAmount || wtx.tx->vout[i].nValue > nMaximumAmount)\n+            if (output.nValue < nMinimumAmount || output.nValue > nMaximumAmount)\n                 continue;\n \n-            if (coinControl && coinControl->HasSelected() && !coinControl->fAllowOtherInputs && !coinControl->IsSelected(COutPoint(entry.first, i)))\n+            if (coinControl && coinControl->HasSelected() && !coinControl->fAllowOtherInputs && !coinControl->IsSelected(outpoint))\n                 continue;\n \n-            if (wallet.IsLockedCoin(entry.first, i))\n+            if (wallet.IsLockedCoin(outpoint))\n                 continue;\n \n-            if (wallet.IsSpent(wtxid, i))\n+            if (wallet.IsSpent(outpoint))\n                 continue;\n \n-            isminetype mine = wallet.IsMine(wtx.tx->vout[i]);\n+            isminetype mine = wallet.IsMine(output);\n \n             if (mine == ISMINE_NO) {\n                 continue;\n             }\n \n-            if (!allow_used_addresses && wallet.IsSpentKey(wtxid, i)) {\n+            if (!allow_used_addresses && wallet.IsSpentKey(output.scriptPubKey)) {\n                 continue;\n             }\n \n-            std::unique_ptr<SigningProvider> provider = wallet.GetSolvingProvider(wtx.tx->vout[i].scriptPubKey);\n+            std::unique_ptr<SigningProvider> provider = wallet.GetSolvingProvider(output.scriptPubKey);\n \n-            bool solvable = provider ? IsSolvable(*provider, wtx.tx->vout[i].scriptPubKey) : false;\n+            bool solvable = provider ? IsSolvable(*provider, output.scriptPubKey) : false;\n             bool spendable = ((mine & ISMINE_SPENDABLE) != ISMINE_NO) || (((mine & ISMINE_WATCH_ONLY) != ISMINE_NO) && (coinControl && coinControl->fAllowWatchOnly && solvable));\n-            int input_bytes = GetTxSpendSize(wallet, wtx, i, (coinControl && coinControl->fAllowWatchOnly));\n \n-            vCoins.emplace_back(COutPoint(wtx.GetHash(), i), wtx.tx->vout.at(i), nDepth, input_bytes, spendable, solvable, safeTx, wtx.GetTxTime(), tx_from_me, feerate);\n+            // Filter by spendable outputs only\n+            if (!spendable && only_spendable) continue;\n+\n+            int input_bytes = GetTxSpendSize(wallet, wtx, i, (coinControl && coinControl->fAllowWatchOnly));\n+            result.coins.emplace_back(outpoint, output, nDepth, input_bytes, spendable, solvable, safeTx, wtx.GetTxTime(), tx_from_me, feerate);\n+            result.total_amount += output.nValue;\n \n             // Checks the sum amount of all UTXO's.\n             if (nMinimumSumAmount != MAX_MONEY) {\n-                nTotal += wtx.tx->vout[i].nValue;\n-\n-                if (nTotal >= nMinimumSumAmount) {\n-                    return;\n+                if (result.total_amount >= nMinimumSumAmount) {\n+                    return result;\n                 }\n             }\n \n             // Checks the maximum number of UTXO's.\n-            if (nMaximumCount > 0 && vCoins.size() >= nMaximumCount) {\n-                return;\n+            if (nMaximumCount > 0 && result.coins.size() >= nMaximumCount) {\n+                return result;\n             }\n         }\n     }\n+\n+    return result;\n }\n \n-void AvailableCoinsListUnspent(const CWallet& wallet, std::vector<COutput>& vCoins, const CCoinControl* coinControl, const CAmount& nMinimumAmount, const CAmount& nMaximumAmount, const CAmount& nMinimumSumAmount, const uint64_t nMaximumCount)\n+CoinsResult AvailableCoinsListUnspent(const CWallet& wallet, const CCoinControl* coinControl, const CAmount& nMinimumAmount, const CAmount& nMaximumAmount, const CAmount& nMinimumSumAmount, const uint64_t nMaximumCount)\n {\n-    AvailableCoins(wallet, vCoins, coinControl, /*feerate=*/ std::nullopt, nMinimumAmount, nMaximumAmount, nMinimumSumAmount, nMaximumCount);\n+    return AvailableCoins(wallet, coinControl, /*feerate=*/ std::nullopt, nMinimumAmount, nMaximumAmount, nMinimumSumAmount, nMaximumCount);\n }\n \n CAmount GetAvailableBalance(const CWallet& wallet, const CCoinControl* coinControl)\n {\n     LOCK(wallet.cs_wallet);\n-\n-    CAmount balance = 0;\n-    std::vector<COutput> vCoins;\n-    AvailableCoinsListUnspent(wallet, vCoins, coinControl);\n-    for (const COutput& out : vCoins) {\n-        if (out.spendable) {\n-            balance += out.txout.nValue;\n-        }\n-    }\n-    return balance;\n+    return AvailableCoins(wallet,\n+                          coinControl,\n+                          std::nullopt, /*feerate=*/\n+                          1,            /*nMinimumAmount*/\n+                          MAX_MONEY,    /*nMaximumAmount*/\n+                          MAX_MONEY,    /*nMinimumSumAmount*/\n+                          0,            /*nMaximumCount*/\n+                          true          /*spendable_only*/\n+                          ).total_amount;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r891498739",
      "id" : 891498739,
      "line" : 243,
      "node_id" : "PRRC_kwDOABII5841IzDz",
      "original_commit_id" : "5646ccf4af89bd77953030dedabb1545b851d3ea",
      "original_line" : 243,
      "original_position" : 130,
      "original_start_line" : 235,
      "path" : "src/wallet/spend.cpp",
      "position" : 130,
      "pull_request_review_id" : 998508682,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891498739/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 235,
      "start_side" : "RIGHT",
      "updated_at" : "2022-06-07T17:12:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/891498739",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r892438732"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892438732"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "You found an existing issue in the RPC `sendall` command :).\r\n\r\nWhen `send_max` is set, `sendall` uses all the coins returned from `AvailableCoins` as inputs for a new transaction, without checking if the coin are spendable/solvable first.\r\n\r\nSo.. this command should be always failing in master if the user sets the `send_max` param and the wallet has at least one non-spendable or non-solvable coin.\r\n\r\nNote:\r\nThis is easily solved passing the new `spendable_only=false` flag to `AvailableCoins` here.",
      "commit_id" : "fd5c996d1609e6f88769f6f3ef0c322e3435b3aa",
      "created_at" : "2022-06-08T14:14:51Z",
      "diff_hunk" : "@@ -159,76 +165,82 @@ void AvailableCoins(const CWallet& wallet, std::vector<COutput>& vCoins, const C\n         bool tx_from_me = CachedTxIsFromMe(wallet, wtx, ISMINE_ALL);\n \n         for (unsigned int i = 0; i < wtx.tx->vout.size(); i++) {\n+            const CTxOut& output = wtx.tx->vout[i];\n+            const COutPoint outpoint(wtxid, i);\n+\n             // Only consider selected coins if add_inputs is false\n-            if (coinControl && !coinControl->m_add_inputs && !coinControl->IsSelected(COutPoint(entry.first, i))) {\n+            if (coinControl && !coinControl->m_add_inputs && !coinControl->IsSelected(outpoint)) {\n                 continue;\n             }\n \n-            if (wtx.tx->vout[i].nValue < nMinimumAmount || wtx.tx->vout[i].nValue > nMaximumAmount)\n+            if (output.nValue < nMinimumAmount || output.nValue > nMaximumAmount)\n                 continue;\n \n-            if (coinControl && coinControl->HasSelected() && !coinControl->fAllowOtherInputs && !coinControl->IsSelected(COutPoint(entry.first, i)))\n+            if (coinControl && coinControl->HasSelected() && !coinControl->fAllowOtherInputs && !coinControl->IsSelected(outpoint))\n                 continue;\n \n-            if (wallet.IsLockedCoin(entry.first, i))\n+            if (wallet.IsLockedCoin(outpoint))\n                 continue;\n \n-            if (wallet.IsSpent(wtxid, i))\n+            if (wallet.IsSpent(outpoint))\n                 continue;\n \n-            isminetype mine = wallet.IsMine(wtx.tx->vout[i]);\n+            isminetype mine = wallet.IsMine(output);\n \n             if (mine == ISMINE_NO) {\n                 continue;\n             }\n \n-            if (!allow_used_addresses && wallet.IsSpentKey(wtxid, i)) {\n+            if (!allow_used_addresses && wallet.IsSpentKey(output.scriptPubKey)) {\n                 continue;\n             }\n \n-            std::unique_ptr<SigningProvider> provider = wallet.GetSolvingProvider(wtx.tx->vout[i].scriptPubKey);\n+            std::unique_ptr<SigningProvider> provider = wallet.GetSolvingProvider(output.scriptPubKey);\n \n-            bool solvable = provider ? IsSolvable(*provider, wtx.tx->vout[i].scriptPubKey) : false;\n+            bool solvable = provider ? IsSolvable(*provider, output.scriptPubKey) : false;\n             bool spendable = ((mine & ISMINE_SPENDABLE) != ISMINE_NO) || (((mine & ISMINE_WATCH_ONLY) != ISMINE_NO) && (coinControl && coinControl->fAllowWatchOnly && solvable));\n-            int input_bytes = GetTxSpendSize(wallet, wtx, i, (coinControl && coinControl->fAllowWatchOnly));\n \n-            vCoins.emplace_back(COutPoint(wtx.GetHash(), i), wtx.tx->vout.at(i), nDepth, input_bytes, spendable, solvable, safeTx, wtx.GetTxTime(), tx_from_me, feerate);\n+            // Filter by spendable outputs only\n+            if (!spendable && only_spendable) continue;\n+\n+            int input_bytes = GetTxSpendSize(wallet, wtx, i, (coinControl && coinControl->fAllowWatchOnly));\n+            result.coins.emplace_back(outpoint, output, nDepth, input_bytes, spendable, solvable, safeTx, wtx.GetTxTime(), tx_from_me, feerate);\n+            result.total_amount += output.nValue;\n \n             // Checks the sum amount of all UTXO's.\n             if (nMinimumSumAmount != MAX_MONEY) {\n-                nTotal += wtx.tx->vout[i].nValue;\n-\n-                if (nTotal >= nMinimumSumAmount) {\n-                    return;\n+                if (result.total_amount >= nMinimumSumAmount) {\n+                    return result;\n                 }\n             }\n \n             // Checks the maximum number of UTXO's.\n-            if (nMaximumCount > 0 && vCoins.size() >= nMaximumCount) {\n-                return;\n+            if (nMaximumCount > 0 && result.coins.size() >= nMaximumCount) {\n+                return result;\n             }\n         }\n     }\n+\n+    return result;\n }\n \n-void AvailableCoinsListUnspent(const CWallet& wallet, std::vector<COutput>& vCoins, const CCoinControl* coinControl, const CAmount& nMinimumAmount, const CAmount& nMaximumAmount, const CAmount& nMinimumSumAmount, const uint64_t nMaximumCount)\n+CoinsResult AvailableCoinsListUnspent(const CWallet& wallet, const CCoinControl* coinControl, const CAmount& nMinimumAmount, const CAmount& nMaximumAmount, const CAmount& nMinimumSumAmount, const uint64_t nMaximumCount)\n {\n-    AvailableCoins(wallet, vCoins, coinControl, /*feerate=*/ std::nullopt, nMinimumAmount, nMaximumAmount, nMinimumSumAmount, nMaximumCount);\n+    return AvailableCoins(wallet, coinControl, /*feerate=*/ std::nullopt, nMinimumAmount, nMaximumAmount, nMinimumSumAmount, nMaximumCount);\n }\n \n CAmount GetAvailableBalance(const CWallet& wallet, const CCoinControl* coinControl)\n {\n     LOCK(wallet.cs_wallet);\n-\n-    CAmount balance = 0;\n-    std::vector<COutput> vCoins;\n-    AvailableCoinsListUnspent(wallet, vCoins, coinControl);\n-    for (const COutput& out : vCoins) {\n-        if (out.spendable) {\n-            balance += out.txout.nValue;\n-        }\n-    }\n-    return balance;\n+    return AvailableCoins(wallet,\n+                          coinControl,\n+                          std::nullopt, /*feerate=*/\n+                          1,            /*nMinimumAmount*/\n+                          MAX_MONEY,    /*nMaximumAmount*/\n+                          MAX_MONEY,    /*nMinimumSumAmount*/\n+                          0,            /*nMaximumCount*/\n+                          true          /*spendable_only*/\n+                          ).total_amount;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r892438732",
      "id" : 892438732,
      "in_reply_to_id" : 891498739,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5841MYjM",
      "original_commit_id" : "5646ccf4af89bd77953030dedabb1545b851d3ea",
      "original_line" : 242,
      "original_position" : 130,
      "original_start_line" : 235,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 999842474,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892438732/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-06-08T14:39:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892438732",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "thanks for the feedback theStack!\r\n\r\nApplied the following changes:\r\n\r\n1) Re-wrote commits titles to be 72-80 characters long.\r\n2) Moved the `only_spendable` arg of `AvailableCoins` to be true by default.\r\n3) By having `spendable_only=true` by default, fixed an already existent hidden issue in `sendall` RPC command -> [description](https://github.com/bitcoin/bitcoin/pull/25005#discussion_r892438732)",
      "created_at" : "2022-06-08T14:36:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#issuecomment-1150006470",
      "id" : 1150006470,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25005",
      "node_id" : "IC_kwDOABII585Ei7TG",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1150006470/reactions"
      },
      "updated_at" : "2022-06-08T14:37:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1150006470",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2022-06-15T20:42:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#issuecomment-1156910573",
      "id" : 1156910573,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25005",
      "node_id" : "IC_kwDOABII585E9Q3t",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1156910573/reactions"
      },
      "updated_at" : "2022-06-15T20:42:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1156910573",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK fd5c996d1609e6f88769f6f3ef0c322e3435b3aa",
      "created_at" : "2022-06-16T20:52:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#issuecomment-1158118362",
      "id" : 1158118362,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25005",
      "node_id" : "IC_kwDOABII585FB3va",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1158118362/reactions"
      },
      "updated_at" : "2022-06-16T20:52:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1158118362",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "https://cirrus-ci.com/task/4885942589718528?logs=ci#L6616\r\n\r\n```\r\nwallet/spend.cpp:237:41: error: argument name 'feerate' in comment does not match parameter name 'nMinimumAmount' [bugprone-argument-comment,-warnings-as-errors]\r\n                          std::nullopt, /*feerate=*/\r\n                                        ^\r\n./wallet/spend.h:49:43: note: 'nMinimumAmount' declared here\r\n                           const CAmount& nMinimumAmount = 1,\r\n                                          ^\r\nwallet/spend.cpp:87:13: note: actual callee ('AvailableCoins') is declared here\r\nCoinsResult AvailableCoins(const CWallet& wallet,\r\n            ^",
      "created_at" : "2022-06-18T09:11:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#issuecomment-1159403854",
      "id" : 1159403854,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25005",
      "node_id" : "IC_kwDOABII585FGxlO",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1159403854/reactions"
      },
      "updated_at" : "2022-06-18T09:11:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1159403854",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
