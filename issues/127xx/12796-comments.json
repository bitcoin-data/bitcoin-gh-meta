[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Looks like this is a consequence of the address being entered  into `mapAddressBook` with `purpose=\"receive\"` when the receiving address is created, and then [filtering address book display for `purpose=\"send\"` rows](https://github.com/bitcoin/bitcoin/blob/c948dc8f4285e27d8c0f3553d9d427b2a7b01b77/src/qt/addressbookpage.cpp#L43-L47). We then [don't allow the addition of duplicate addresses](https://github.com/bitcoin/bitcoin/blob/c948dc8f4285e27d8c0f3553d9d427b2a7b01b77/src/qt/addresstablemodel.cpp#L357-L365) to the address book, even when the purposes differ.\r\n\r\nOne option is to simply not filter addresses for purpose when we're displaying the address book, e.g.\r\n```diff\r\ndiff --git a/src/qt/addressbookpage.cpp b/src/qt/addressbookpage.cpp\r\nindex f2ddbf259b..16f96abb73 100644\r\n--- a/src/qt/addressbookpage.cpp\r\n+++ b/src/qt/addressbookpage.cpp\r\n@@ -40,11 +40,6 @@ protected:\r\n     {\r\n         auto model = sourceModel();\r\n         auto label = model->index(row, AddressTableModel::Label, parent);\r\n-\r\n-        if (model->data(label, AddressTableModel::TypeRole).toString() != m_type) {\r\n-            return false;\r\n-        }\r\n-\r\n         auto address = model->index(row, AddressTableModel::Address, parent);\r\n\r\n         if (filterRegExp().indexIn(model->data(address).toString()) < 0 &&\r\n```\r\nbut that may get kinda dumb for cases when the number of receiving addresses in the book is large.\r\n\r\nAnother approach is to rekey `mapAddressBook` by `std::pair<CTxDestination, std::string>` where the string is purpose, but that's more work.",
      "created_at" : "2018-03-26T20:30:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/12796#issuecomment-376301533",
      "id" : 376301533,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12796",
      "updated_at" : "2018-03-26T20:30:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/376301533",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "The kind of repeated pay-to-self behavior that the address book would support probably is edge-casey and not recommended, so this may not be worth fixing.",
      "created_at" : "2018-03-26T20:55:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/12796#issuecomment-376308581",
      "id" : 376308581,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12796",
      "updated_at" : "2018-03-26T20:55:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/376308581",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe just clarifying the error message would be a good fix? I think\r\n\r\n> Can't add receiving address 2N3... (\"ruh roh\") to the sending address book\r\n\r\ncould be an improvement over \"The entered address 2N3... is already in the address book.\"\r\n\r\n> One option is to simply not filter addresses for purpose when we're displaying the address book, e.g.\r\n\r\nIt seems like it would be confusing to show receiving addresses in the send dialog by default, but maybe there could be a checkbox giving the option to display them.\r\n\r\n> Another approach is to rekey mapAddressBook by std::pair<CTxDestination, std::string> where the string is purpose, but that's more work.\r\n\r\nI don't think this would be great, because it would also allow associating different names with the same address. But one way you could allow addresses to be used for both sending and receiving would be to extend purpose field with a \"receive+send\" option. Or make purpose a set of strings instead of a single string.\r\n\r\n",
      "created_at" : "2018-03-27T00:01:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/12796#issuecomment-376350743",
      "id" : 376350743,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12796",
      "updated_at" : "2018-03-27T00:01:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/376350743",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "You're right - this is a design constrain due to how the address book is handled internally. It has always been the case and is not a bug:\r\n\r\n- *Sending* addresses concern external addresses, to be sent to\r\n- *Receiving* addresses are always your own addresses. The receiving address book contains all *non-change* receiving addresses.\r\n\r\nThere has been talk (in #7729) about supporting multiple labels per address (as a future idea). The same underlying infrastructure could be used to support this.\r\n\r\nAlso: \"address book\" has always been the wrong name for the functionality (it's inherited from Satoshi's original GUI). It's a list of historically used (sending/receiving) addresses, not intended to be re-used.\r\n\r\nFor the short term it's IMO best to fix the error message as @ryanofsky says, and regard this as expected behavior.",
      "created_at" : "2018-03-27T14:23:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/12796#issuecomment-376544019",
      "id" : 376544019,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12796",
      "updated_at" : "2018-03-27T14:34:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/376544019",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Roger that. Thanks for the input, @ryanofsky @laanwj. I'll file a PR clarifying the error messages.",
      "created_at" : "2018-03-27T15:06:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/12796#issuecomment-376559997",
      "id" : 376559997,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12796",
      "updated_at" : "2018-03-27T15:06:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/376559997",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   }
]
