[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#26154](https://github.com/bitcoin/bitcoin/pull/26154) (refactor: Move coin_control variable to test setup section by yancyribbens)\n* [#26152](https://github.com/bitcoin/bitcoin/pull/26152) (Bump unconfirmed ancestor transactions to target feerate by Xekyo)\n* [#26066](https://github.com/bitcoin/bitcoin/pull/26066) (wallet: Refactor and document CoinControl by aureleoules)\n* [#26008](https://github.com/bitcoin/bitcoin/pull/26008) (wallet: cache IsMine scriptPubKeys to improve performance of wallets with a lot of non-ranged descriptors by achow101)\n* [#25730](https://github.com/bitcoin/bitcoin/pull/25730) (RPC: listunspent, add \"include immature coinbase\" flag by furszy)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-07-23T15:16:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#issuecomment-1193141240",
      "id" : 1193141240,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25685",
      "node_id" : "IC_kwDOABII585HHeP4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1193141240/reactions"
      },
      "updated_at" : "2022-10-20T12:30:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1193141240",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-07-28T23:00:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#issuecomment-1198707202",
      "id" : 1198707202,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25685",
      "node_id" : "IC_kwDOABII585HctIC",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1198707202/reactions"
      },
      "updated_at" : "2022-07-28T23:00:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1198707202",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "rebased, conflicts solved.",
      "created_at" : "2022-07-29T17:19:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#issuecomment-1199775546",
      "id" : 1199775546,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25685",
      "node_id" : "IC_kwDOABII585Hgx86",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1199775546/reactions"
      },
      "updated_at" : "2022-07-29T17:19:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1199775546",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK, this seems like a good improvement.",
      "created_at" : "2022-08-01T21:41:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#issuecomment-1201751800",
      "id" : 1201751800,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25685",
      "node_id" : "IC_kwDOABII585HoUb4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1201751800/reactions"
      },
      "updated_at" : "2022-08-01T21:41:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1201751800",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "It's not clear to me that this provides any significant benefit over a much simpler change of just excluding pre-selected inputs from AvailableCoins. The only other improvement this provides is better error reporting, but I think it would be better to just go through SelectCoins and improve its error reporting instead of pulling things out so that errors are reported elsewhere.",
      "created_at" : "2022-08-02T19:51:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#issuecomment-1203150120",
      "id" : 1203150120,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25685",
      "node_id" : "IC_kwDOABII585Htp0o",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1203150120/reactions"
      },
      "updated_at" : "2022-08-02T19:51:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1203150120",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> It's not clear to me that this provides any significant benefit over a much simpler change of just excluding pre-selected inputs from AvailableCoins. The only other improvement this provides is better error reporting, but I think it would be better to just go through SelectCoins and improve its error reporting instead of pulling things out so that errors are reported elsewhere.\r\n\r\nThere are several benefits, (aside from what I wrote in the PR description):\r\n\r\n#### Sources Architecture:\r\n\r\n - Do make sense for you to be fetching, and verifying, coins in a function whose main responsibility is perform the Coin Selection process?\r\n \r\n    The Coin Selection should receive coins, and certain user/wallet parameters, so it can produce all the possible solutions for a certain target amount, picking and returning the best of them.\r\n\r\n\tJust imagine how this would looks like if Coin Selection would be a separated library (which, for its increasing specialization, could easily be one in the future). You would never include the pre-selected-inputs fetching and verification process into the Coin Selection responsibilities at all because cannot/shouldn't do it there.\r\n\r\n#### Tangible Improvements:\r\n\r\n1.  As we will do the pre-selected-inputs fetching and verification prior to calling `AvailableCoins`, if there is an error when the wallet fetches any of the preset-inputs, the transaction creation process can fail right away without calling `AvailableCoins` (Function that, as we know, walks-through the entire wallet's transactions map and performs all the internal available coins checks).\r\n \r\n     This prevents us from wasting resources that we are currently wasting for, literally, no reason.\r\n\r\n\tIn master, we are first looping-through the entire wallet's map inside  `AvailableCoins`, which is a resource intensive task if you have a big wallet, just to fail right after it finishes, discarding the coins result, because one of the pre-set inputs has an error.\r\n\r\n3.  If the user disallowed the \"other inputs selection\" by setting `m_allow_other_inputs=false` (which means: âno coins from the AvailableCoins result function will be used during Coin Selectionâ):â¨\r\n\r\n\tIn master: we loop-through the entire wallet's map inside `AvailableCoins` first, then we discard the computed result (because we will not use it..), then we fetch and use the pre-selected-inputs only.\r\n\tWhich is time and processing power wasted for no reason.\r\n\r\n\tIn this PR: we simply select the preset inputs, skip `AvailableCoins` if `m_allow_other_inputs=false` and provides them to `SelectCoins`.\r\n\r\n-------------------\r\n\r\n> but I think it would be better to just go through SelectCoins and improve its error reporting instead of pulling things out so that errors are reported elsewhere.\r\n\r\nWe are currently failing inside the Coin Selection process due:\r\n* âInvalid pre-selected inputâ\r\n* âNot found pre-selected inputâ\r\n* âNot solvable pre-selected inputâ\r\n\r\nThese errors have nothing to do with the Coin Selection process. Why keep them there?\r\n\r\nIt's not that I located these errors on a random place. I placed them inside a \"Fetch Coins\" procedure whose main responsibility is fetch the coins that the user pre-selected and fetch the available coins in the wallet. Which seems totally reasonable for me.\r\n\r\nI mean, this errors have been obscured inside Coin Selection all this time, not being properly notified, because they should had never been placed there in the first place. It's all about a proper responsibility division to make the process clearer and cleaner so it's less error-prone (and in this case, in some occasions, actually faster and less resource consuming).",
      "created_at" : "2022-08-02T22:16:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#issuecomment-1203267086",
      "id" : 1203267086,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25685",
      "node_id" : "IC_kwDOABII585HuGYO",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1203267086/reactions"
      },
      "updated_at" : "2022-08-02T23:27:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1203267086",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "To make the speed improvements more visible, pushed a new benchmark f6d0bb2d.\r\n\r\nBasically, the new bench measures the transaction creation process, for a wallet with ~250k UTXO, only using the pre-selected-inputs inside coin control. Setting `m_allow_other_inputs=false` to disallow the wallet to include coins automatically.\r\n\r\n#### This is the result on this PR (tip f6d0bb2d):\r\n\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|        1,048,675.00 |              953.58 |    0.3% |      0.06 | `WalletCreateTransaction`\r\n\r\nvs\r\n\r\n#### This is the result on current master (tip 4a4289e2):\r\n\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|       96,373,458.20 |               10.38 |    0.2% |      5.30 | `WalletCreateTransaction`\r\n\r\n#### Summary\r\n\r\nThe benchmark took to run in master: **96.37 milliseconds**, while in this PR: **1 millisecond**  ð .\r\n\r\n-------------\r\n\r\nUpdated PR description with the benchmark results.",
      "created_at" : "2022-08-03T18:23:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#issuecomment-1204322868",
      "id" : 1204322868,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25685",
      "node_id" : "IC_kwDOABII585HyII0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1204322868/reactions"
      },
      "updated_at" : "2022-08-04T17:39:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1204322868",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r937198427"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/937198427"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 23448cae6f4a5f00766df9220860b16311266417 \"wallet: encapsulate pre-selected-inputs lookup into its own function\"\r\n\r\nI think this should return a `SelectionResult` rather than `CoinsResult`. It would elimiate the second iteration inside of `SelectCoins`.\r\n\r\nIt could also return the selected value too so the caller could reduce the target before `SelectCoins` and eliminate an additional iteration of the preselcted inputs.",
      "commit_id" : "f6d0bb2dbf3945bdb2896492824fccdb12136e3b",
      "created_at" : "2022-08-03T22:49:58Z",
      "diff_hunk" : "@@ -105,6 +105,54 @@ void CoinsResult::clear()\n     other.clear();\n }\n \n+// Fetch the coin control selected inputs and wrap them inside a COutput.\n+// Coins could be internal (from the wallet) or external.\n+BResult<CoinsResult> FetchSelectedInputs(const CWallet& wallet, const CCoinControl& coin_control,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r937198427",
      "id" : 937198427,
      "line" : 110,
      "node_id" : "PRRC_kwDOABII58433INb",
      "original_commit_id" : "23448cae6f4a5f00766df9220860b16311266417",
      "original_line" : 110,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 6,
      "pull_request_review_id" : 1061090900,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/937198427/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-03T22:59:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/937198427",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r937199343"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/937199343"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 84b4ffe85ba0267c49080e9a096e45d6af63e720 \"wallet: remove fetch pre-selected-inputs responsibility from SelectCoins\"\r\n\r\nI don't think it's necessary to have another function here to wrap these two calls. They could just be in `CreateTransactionInternal`",
      "commit_id" : "f6d0bb2dbf3945bdb2896492824fccdb12136e3b",
      "created_at" : "2022-08-03T22:51:55Z",
      "diff_hunk" : "@@ -153,6 +153,31 @@ BResult<CoinsResult> FetchSelectedInputs(const CWallet& wallet, const CCoinContr\n     return result;\n }\n \n+BResult<CoinsFund> FetchCoins(const CWallet& wallet, const CCoinControl& coin_control,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r937199343",
      "id" : 937199343,
      "line" : 156,
      "node_id" : "PRRC_kwDOABII58433Ibv",
      "original_commit_id" : "84b4ffe85ba0267c49080e9a096e45d6af63e720",
      "original_line" : 156,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 4,
      "pull_request_review_id" : 1061090900,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/937199343/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-03T22:59:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/937199343",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r937199609"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/937199609"
         }
      },
      "author_association" : "MEMBER",
      "body" : "M\r\nIn 84b4ffe85ba0267c49080e9a096e45d6af63e720 \"wallet: remove fetch pre-selected-inputs responsibility from SelectCoins\"\r\n\r\nThis check could be moved to the top of `AvailableCoins` and it would achieve the same effect. Doing so would also not change `AvailableCoins`'s semantics.",
      "commit_id" : "f6d0bb2dbf3945bdb2896492824fccdb12136e3b",
      "created_at" : "2022-08-03T22:52:26Z",
      "diff_hunk" : "@@ -153,6 +153,31 @@ BResult<CoinsResult> FetchSelectedInputs(const CWallet& wallet, const CCoinContr\n     return result;\n }\n \n+BResult<CoinsFund> FetchCoins(const CWallet& wallet, const CCoinControl& coin_control,\n+                              const CoinSelectionParams& coin_selection_params) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet)\n+{\n+    CoinsFund result;\n+\n+    // Fetch manually select coins\n+    if (coin_control.HasSelected()) {\n+        result.pre_selected_inputs = FetchSelectedInputs(wallet, coin_control, coin_selection_params);\n+        if (!result.pre_selected_inputs) return result.pre_selected_inputs.GetError();\n+\n+        // If no other inputs are allowed, return early\n+        if (!coin_control.m_allow_other_inputs) return result;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r937199609",
      "id" : 937199609,
      "line" : 167,
      "node_id" : "PRRC_kwDOABII58433If5",
      "original_commit_id" : "84b4ffe85ba0267c49080e9a096e45d6af63e720",
      "original_line" : 167,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 15,
      "pull_request_review_id" : 1061090900,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/937199609/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-03T22:59:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/937199609",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r937201516"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/937201516"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 84b4ffe85ba0267c49080e9a096e45d6af63e720 \"wallet: remove fetch pre-selected-inputs responsibility from SelectCoins\"\r\n\r\nI'm wondering if we should just make this function only return a `SelectionResult` for the automatic coin selection and move the preset input stuff to the caller. If `FetchSelectedInputs` made a `SelectionResult` for the preset inputs, then the only preset input things left in `SelectCoins` would be the merging of the `SelectionResult`s, and that can be done in the caller too.",
      "commit_id" : "f6d0bb2dbf3945bdb2896492824fccdb12136e3b",
      "created_at" : "2022-08-03T22:56:50Z",
      "diff_hunk" : "@@ -575,24 +602,17 @@ std::optional<SelectionResult> ChooseSelectionResult(const CWallet& wallet, cons\n     return best_result;\n }\n \n-std::optional<SelectionResult> SelectCoins(const CWallet& wallet, CoinsResult& available_coins, const CAmount& nTargetValue, const CCoinControl& coin_control, const CoinSelectionParams& coin_selection_params)\n+std::optional<SelectionResult> SelectCoins(const CWallet& wallet, CoinsFund& coins, const CAmount& nTargetValue, const CCoinControl& coin_control, const CoinSelectionParams& coin_selection_params)\n {\n     CAmount value_to_select = nTargetValue;\n \n+    // Add the manually selected coins first",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r937201516",
      "id" : 937201516,
      "line" : 609,
      "node_id" : "PRRC_kwDOABII58433I9s",
      "original_commit_id" : "84b4ffe85ba0267c49080e9a096e45d6af63e720",
      "original_line" : 609,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 52,
      "pull_request_review_id" : 1061090900,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/937201516/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-03T22:59:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/937201516",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r938067217"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/938067217"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "good thought ðð¼ \r\n\r\nMost likely, will need to do this change incrementally (right after 23448cae) because if `FetchSelectedInputs` returns a `SelectionResult`, need to add a method for merging two `SelectionResult` objects (the pre-set-inputs result and the wallet's selection result).\r\n\r\nWe are currently creating an `OutputGroup` at the beginning of `SelectCoins` with the pre-set-inputs just to merge it at the end of the function with the wallet's selection algorithm result. The reason is that `SelectResult` only has a function `AddInputs(OutputGroups)` and not an `AddInputs(set<COutputs>)` nor a merge method.\r\n\r\nSide note, based on a quick code review: the selection result built from the combination of pre-set-inputs and the wallet selected ones should be having an inaccurate waste calculation -- will do some tests in another PR --).",
      "commit_id" : "f6d0bb2dbf3945bdb2896492824fccdb12136e3b",
      "created_at" : "2022-08-04T17:27:03Z",
      "diff_hunk" : "@@ -105,6 +105,54 @@ void CoinsResult::clear()\n     other.clear();\n }\n \n+// Fetch the coin control selected inputs and wrap them inside a COutput.\n+// Coins could be internal (from the wallet) or external.\n+BResult<CoinsResult> FetchSelectedInputs(const CWallet& wallet, const CCoinControl& coin_control,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r938067217",
      "id" : 938067217,
      "in_reply_to_id" : 937198427,
      "line" : 110,
      "node_id" : "PRRC_kwDOABII58436cUR",
      "original_commit_id" : "23448cae6f4a5f00766df9220860b16311266417",
      "original_line" : 110,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 6,
      "pull_request_review_id" : 1062333921,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/938067217/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-04T17:27:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/938067217",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-08-05T13:55:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#issuecomment-1206486135",
      "id" : 1206486135,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25685",
      "node_id" : "IC_kwDOABII585H6YR3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1206486135/reactions"
      },
      "updated_at" : "2022-08-05T13:55:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1206486135",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r938977841"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/938977841"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I added it here (inside the `coin_control.HasSelected()` block) to not change the current behavior and minimize the amount of changes.\r\n\r\nIn master, even if `m_allow_other_inputs` is false, we are automatically falling back to select coins from the wallet if there are no pre-set inputs inside coin control.\r\n\r\nThis basically is because the default value for `m_allow_other_inputs` is false, and some RPC commands that don't allow inputs manual selection such as `sendtoaddress` and `sendmany` are not setting it to true. So.. they are always falling back to select coins from the wallet.\r\n\r\nSo.. if I move this check below, will need to set `m_allow_other_inputs=true` in every caller that does not add any input manually (or.. change the default value to be true inside coin control).\r\n\r\nbut.. let me see if those two RPC commands are the only affected ones. Maybe it's a straightforward change.\r\nI do agree that the current master behavior of automatically falling back to select coins from the wallet even when `m_allow_other_inputs=false` is messy and not an expected behavior.",
      "commit_id" : "f6d0bb2dbf3945bdb2896492824fccdb12136e3b",
      "created_at" : "2022-08-05T16:28:07Z",
      "diff_hunk" : "@@ -153,6 +153,31 @@ BResult<CoinsResult> FetchSelectedInputs(const CWallet& wallet, const CCoinContr\n     return result;\n }\n \n+BResult<CoinsFund> FetchCoins(const CWallet& wallet, const CCoinControl& coin_control,\n+                              const CoinSelectionParams& coin_selection_params) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet)\n+{\n+    CoinsFund result;\n+\n+    // Fetch manually select coins\n+    if (coin_control.HasSelected()) {\n+        result.pre_selected_inputs = FetchSelectedInputs(wallet, coin_control, coin_selection_params);\n+        if (!result.pre_selected_inputs) return result.pre_selected_inputs.GetError();\n+\n+        // If no other inputs are allowed, return early\n+        if (!coin_control.m_allow_other_inputs) return result;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r938977841",
      "id" : 938977841,
      "in_reply_to_id" : 937199609,
      "line" : 167,
      "node_id" : "PRRC_kwDOABII584396ox",
      "original_commit_id" : "84b4ffe85ba0267c49080e9a096e45d6af63e720",
      "original_line" : 167,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 15,
      "pull_request_review_id" : 1063597940,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/938977841/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-05T16:28:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/938977841",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r939527188"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/939527188"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Been thinking about this and pushed some refactoring that you might like a bit more.\r\n\r\nThe idea was based on try to not mix the Coin Selection code with the inputs fetching while still be able to remove the manual coins selection stuff from the automatic coin selection, the extra loops for the pre-set inputs and  the `FetchCoins` wrapper function.\r\n\r\nSo, have decoupled the `SelectCoins` into two functions:\r\n\r\n1) AutomaticCoinSelection:\r\nWhich is basically the previously called `SelectCoins` without the manually selected inputs stuff.\r\nSo, it will purely receive a set of coins and be in charge of selecting the best subset of them to\r\ncover the target amount.\r\n\r\n2) SelectCoins:\r\nIn charge of selecting all the user manually selected coins first (\"pre-set inputs\"), and\r\nif coin_control 'm_allow_other_inputs=true', call 'AutomaticCoinSelection' to select a\r\nset of coins such that the target - pre_set_inputs.total_amount is met. Then merge\r\nboth results.",
      "commit_id" : "eec31a164bbe7b05c160edd912cff8bf2e0adbb2",
      "created_at" : "2022-08-06T13:11:59Z",
      "diff_hunk" : "@@ -575,24 +602,17 @@ std::optional<SelectionResult> ChooseSelectionResult(const CWallet& wallet, cons\n     return best_result;\n }\n \n-std::optional<SelectionResult> SelectCoins(const CWallet& wallet, CoinsResult& available_coins, const CAmount& nTargetValue, const CCoinControl& coin_control, const CoinSelectionParams& coin_selection_params)\n+std::optional<SelectionResult> SelectCoins(const CWallet& wallet, CoinsFund& coins, const CAmount& nTargetValue, const CCoinControl& coin_control, const CoinSelectionParams& coin_selection_params)\n {\n     CAmount value_to_select = nTargetValue;\n \n+    // Add the manually selected coins first",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r939527188",
      "id" : 939527188,
      "in_reply_to_id" : 937201516,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5844AAwU",
      "original_commit_id" : "84b4ffe85ba0267c49080e9a096e45d6af63e720",
      "original_line" : 609,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 1064306382,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/939527188/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-06T13:11:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/939527188",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r939527292"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/939527292"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "True. It's not used anywhere else for now.\r\nHave removed the function and the `CoinsFunds` struct as well.",
      "commit_id" : "eec31a164bbe7b05c160edd912cff8bf2e0adbb2",
      "created_at" : "2022-08-06T13:13:27Z",
      "diff_hunk" : "@@ -153,6 +153,31 @@ BResult<CoinsResult> FetchSelectedInputs(const CWallet& wallet, const CCoinContr\n     return result;\n }\n \n+BResult<CoinsFund> FetchCoins(const CWallet& wallet, const CCoinControl& coin_control,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r939527292",
      "id" : 939527292,
      "in_reply_to_id" : 937199343,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5844AAx8",
      "original_commit_id" : "84b4ffe85ba0267c49080e9a096e45d6af63e720",
      "original_line" : 156,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 1064306476,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/939527292/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-06T13:13:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/939527292",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Took me a bit but, while was tackling the feedback, ended up re-organizing the commits changes better. The rationale for each modification should be clearer now.\r\n\r\nWhat did was:\r\n\r\n1) Eliminate the pre-set inputs second iteration inside `SelectCoins` by adding an `AddInputs(std::vector<COutput>&)` method to `SelectionResult` (so we don't need to iterate over the inputs just to insert them inside an ephemeral `OutputGroup` whom is simply not used --> `SelectionResult::AddInput(OutputGroup&)` takes directly the `m_outputs` internal field..).\r\n\r\n2) Remove the `FetchCoins` wrapper function and the `CoinsFund` struct:\r\n    Moved the internals to `CreateTransactionInternal`, who will first call `FetchSelectedInputs` then call `AvailableCoins`.\r\n\r\n3)  Decouple the SelectCoins into two functions:\r\n\r\n    * `AutomaticCoinSelection`:\r\nWhich is basically the previously called SelectCoins without the manually selected inputs stuff.\r\nSo, it will purely receive a set of coins and be in charge of selecting the best subset of them to\r\ncover the target amount.\r\n\r\n    * `SelectCoins`:\r\nIn charge of selecting all the user manually selected coins first (\"pre-set inputs\"), and\r\nif coin_control 'm_allow_other_inputs=true', call 'AutomaticCoinSelection' to select a\r\nset of coins such that the target - pre_set_inputs.total_amount is met. Then merge\r\nboth results.\r\n\r\n4) Have set `CoinControl::m_allow_other_inputs` default value to `true` to correct\r\na misleading behavior (convo started [here](https://github.com/bitcoin/bitcoin/pull/25685#discussion_r938977841)):\r\n    - As several flows in the wallet such as `sendtoaddress`, `sendmany`\r\nand even the GUI don't change the `m_allow_other_inputs` param,\r\nand the default value for it has been `false`. The process was having \r\na workaround patch to automatically fall back to select coins from the\r\nwallet if `m_allow_other_inputs=false` and no manual inputs were selected.\r\n",
      "created_at" : "2022-08-06T13:29:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#issuecomment-1207215318",
      "id" : 1207215318,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25685",
      "node_id" : "IC_kwDOABII585H9KTW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1207215318/reactions"
      },
      "updated_at" : "2022-08-09T20:04:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1207215318",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r941723753"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/941723753"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 4946384e2f56333274baf7fab1dfd41b046e12a1 \"wallet: encapsulate pre-selected-inputs lookup into its own function\"\r\n\r\nThis comment is backwards. The total amount uses the effective value normally, and real value when SFFO.",
      "commit_id" : "eec31a164bbe7b05c160edd912cff8bf2e0adbb2",
      "created_at" : "2022-08-09T19:25:08Z",
      "diff_hunk" : "@@ -105,6 +105,61 @@ void CoinsResult::clear()\n     other.clear();\n }\n \n+struct SelectedInputs\n+{\n+    std::set<COutput> coins;\n+    // If subtract fee from outputs is active, the 'total_amount'\n+    // will be the sum of each output effective value\n+    // instead of the sum of the outputs amount",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r941723753",
      "id" : 941723753,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5844IZBp",
      "original_commit_id" : "4946384e2f56333274baf7fab1dfd41b046e12a1",
      "original_line" : 113,
      "original_position" : 9,
      "original_start_line" : 111,
      "path" : "src/wallet/spend.cpp",
      "position" : 9,
      "pull_request_review_id" : 1067271776,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/941723753/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-09T19:58:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/941723753",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r941726842"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/941726842"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In bc16c074cac96e2ee9a2f3e5d2705b6168f76f80 \"wallet: remove fetch pre-selected-inputs responsibility from SelectCoins\"\r\n\r\nISTM This should just be in the previous commit.",
      "commit_id" : "eec31a164bbe7b05c160edd912cff8bf2e0adbb2",
      "created_at" : "2022-08-09T19:29:20Z",
      "diff_hunk" : "@@ -136,9 +135,36 @@ std::optional<SelectionResult> ChooseSelectionResult(const CWallet& wallet, cons\n  * returns                             If successful, a SelectionResult containing the selected coins\n  *                                     If failed, a nullopt.\n  */\n-std::optional<SelectionResult> SelectCoins(const CWallet& wallet, CoinsResult& available_coins, const CAmount& nTargetValue, const CCoinControl& coin_control,\n+std::optional<SelectionResult> AutomaticCoinSelection(const CWallet& wallet, CoinsResult& available_coins, const CAmount& nTargetValue, const CCoinControl& coin_control,\n                  const CoinSelectionParams& coin_selection_params) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet);\n \n+struct SelectedInputs\n+{\n+    std::set<COutput> coins;\n+    // If subtract fee from outputs is active, the 'total_amount'\n+    // will be the sum of each output effective value\n+    // instead of the sum of the outputs amount\n+    CAmount total_amount{0};\n+\n+    void Insert(const COutput& output, bool subtract_fee_outputs)\n+    {\n+        if (subtract_fee_outputs) {\n+            total_amount += output.txout.nValue;\n+        } else {\n+            total_amount += output.GetEffectiveValue();\n+        }\n+        coins.insert(output);\n+    }\n+};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r941726842",
      "id" : 941726842,
      "line" : 158,
      "node_id" : "PRRC_kwDOABII5844IZx6",
      "original_commit_id" : "bc16c074cac96e2ee9a2f3e5d2705b6168f76f80",
      "original_line" : 158,
      "original_position" : 35,
      "original_start_line" : 141,
      "path" : "src/wallet/spend.h",
      "position" : 35,
      "pull_request_review_id" : 1067271776,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/941726842/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 141,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-09T19:58:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/941726842",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r941871246"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/941871246"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ups, pushed.",
      "commit_id" : "c8f3be406deeda72212f764d0156b47b26dbd1b3",
      "created_at" : "2022-08-09T23:01:39Z",
      "diff_hunk" : "@@ -105,6 +105,61 @@ void CoinsResult::clear()\n     other.clear();\n }\n \n+struct SelectedInputs\n+{\n+    std::set<COutput> coins;\n+    // If subtract fee from outputs is active, the 'total_amount'\n+    // will be the sum of each output effective value\n+    // instead of the sum of the outputs amount",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r941871246",
      "id" : 941871246,
      "in_reply_to_id" : 941723753,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5844I9CO",
      "original_commit_id" : "4946384e2f56333274baf7fab1dfd41b046e12a1",
      "original_line" : 113,
      "original_position" : 9,
      "original_start_line" : 111,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 1067476230,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/941871246/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-09T23:01:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/941871246",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r941871296"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/941871296"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "c8f3be406deeda72212f764d0156b47b26dbd1b3",
      "created_at" : "2022-08-09T23:01:46Z",
      "diff_hunk" : "@@ -136,9 +135,36 @@ std::optional<SelectionResult> ChooseSelectionResult(const CWallet& wallet, cons\n  * returns                             If successful, a SelectionResult containing the selected coins\n  *                                     If failed, a nullopt.\n  */\n-std::optional<SelectionResult> SelectCoins(const CWallet& wallet, CoinsResult& available_coins, const CAmount& nTargetValue, const CCoinControl& coin_control,\n+std::optional<SelectionResult> AutomaticCoinSelection(const CWallet& wallet, CoinsResult& available_coins, const CAmount& nTargetValue, const CCoinControl& coin_control,\n                  const CoinSelectionParams& coin_selection_params) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet);\n \n+struct SelectedInputs\n+{\n+    std::set<COutput> coins;\n+    // If subtract fee from outputs is active, the 'total_amount'\n+    // will be the sum of each output effective value\n+    // instead of the sum of the outputs amount\n+    CAmount total_amount{0};\n+\n+    void Insert(const COutput& output, bool subtract_fee_outputs)\n+    {\n+        if (subtract_fee_outputs) {\n+            total_amount += output.txout.nValue;\n+        } else {\n+            total_amount += output.GetEffectiveValue();\n+        }\n+        coins.insert(output);\n+    }\n+};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r941871296",
      "id" : 941871296,
      "in_reply_to_id" : 941726842,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5844I9DA",
      "original_commit_id" : "bc16c074cac96e2ee9a2f3e5d2705b6168f76f80",
      "original_line" : 146,
      "original_position" : 35,
      "original_start_line" : 141,
      "path" : "src/wallet/spend.h",
      "position" : null,
      "pull_request_review_id" : 1067476299,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/941871296/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-09T23:01:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/941871296",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "thanks achow101, feedback tackled.",
      "created_at" : "2022-08-09T23:02:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#issuecomment-1209975969",
      "id" : 1209975969,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25685",
      "node_id" : "IC_kwDOABII585IHsSh",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1209975969/reactions"
      },
      "updated_at" : "2022-08-09T23:02:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1209975969",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r943422954"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943422954"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n    // Fetch manually selected coins\r\n```",
      "commit_id" : "c8f3be406deeda72212f764d0156b47b26dbd1b3",
      "created_at" : "2022-08-11T12:25:52Z",
      "diff_hunk" : "@@ -885,17 +878,29 @@ static util::Result<CreatedTransactionResult> CreateTransactionInternal(\n     const CAmount not_input_fees = coin_selection_params.m_effective_feerate.GetFee(coin_selection_params.tx_noinputs_size);\n     CAmount selection_target = recipients_sum + not_input_fees;\n \n-    // Get available coins\n-    auto available_coins = AvailableCoins(wallet,\n-                                              &coin_control,\n-                                              coin_selection_params.m_effective_feerate,\n-                                              1,            /*nMinimumAmount*/\n-                                              MAX_MONEY,    /*nMaximumAmount*/\n-                                              MAX_MONEY,    /*nMinimumSumAmount*/\n-                                              0);           /*nMaximumCount*/\n+    // Fetch manually select coins",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r943422954",
      "id" : 943422954,
      "line" : 881,
      "node_id" : "PRRC_kwDOABII5844O33q",
      "original_commit_id" : "c8f3be406deeda72212f764d0156b47b26dbd1b3",
      "original_line" : 881,
      "original_position" : 198,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 198,
      "pull_request_review_id" : 1069629761,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943422954/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-11T16:17:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943422954",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r943428008"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943428008"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'd recommend calling this `GetPreSelectedInputs`. we tend to use `Get*` throughout the codebase and since this function is for pre-selected inputs only, it makes sense to make the function name specific",
      "commit_id" : "c8f3be406deeda72212f764d0156b47b26dbd1b3",
      "created_at" : "2022-08-11T12:31:02Z",
      "diff_hunk" : "@@ -105,6 +105,47 @@ void CoinsResult::clear()\n     other.clear();\n }\n \n+// Fetch and validate the coin control selected inputs.\n+// Coins could be internal (from the wallet) or external.\n+util::Result<SelectedInputs> FetchSelectedInputs(const CWallet& wallet, const CCoinControl& coin_control,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r943428008",
      "id" : 943428008,
      "line" : 110,
      "node_id" : "PRRC_kwDOABII5844O5Go",
      "original_commit_id" : "a53748e3323a33829134cb575830933ac1893323",
      "original_line" : 110,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 6,
      "pull_request_review_id" : 1069636850,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943428008/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-11T12:39:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943428008",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r943429632"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943429632"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "why not call this `PreSelectedInputs` or `ManualInputs`? `SelectedInputs` doesn't really tell me who selected them and could easily be confused with a `SelectionResult`",
      "commit_id" : "c8f3be406deeda72212f764d0156b47b26dbd1b3",
      "created_at" : "2022-08-11T12:32:47Z",
      "diff_hunk" : "@@ -125,6 +125,26 @@ std::optional<SelectionResult> AttemptSelection(const CWallet& wallet, const CAm\n std::optional<SelectionResult> ChooseSelectionResult(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, const std::vector<COutput>& available_coins,\n                         const CoinSelectionParams& coin_selection_params);\n \n+// User manually selected inputs that must be part of the transaction\n+struct SelectedInputs",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r943429632",
      "id" : 943429632,
      "line" : 129,
      "node_id" : "PRRC_kwDOABII5844O5gA",
      "original_commit_id" : "a53748e3323a33829134cb575830933ac1893323",
      "original_line" : 129,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/spend.h",
      "position" : 5,
      "pull_request_review_id" : 1069636850,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943429632/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-11T12:39:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943429632",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Regarding the bench, it would be nice to have a benchmark for when a user has a few pre-selected inputs and _also_ uses automatic coin selection. My hunch is that that is the more representative scenario ",
      "created_at" : "2022-08-11T12:44:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#issuecomment-1211939325",
      "id" : 1211939325,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25685",
      "node_id" : "IC_kwDOABII585IPLn9",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1211939325/reactions"
      },
      "updated_at" : "2022-08-11T12:44:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1211939325",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r943608656"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943608656"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "if I'm not mistaken this would avoid a default initialization of a `CoinsResult`.\r\n```suggestion\r\n    CoinsResult available_coins{coin_control.m_allow_other_inputs ? AvailableCoins(wallet,\r\n                                         &coin_control,\r\n                                         coin_selection_params.m_effective_feerate,\r\n                                         1,            /*nMinimumAmount*/\r\n                                         MAX_MONEY,    /*nMaximumAmount*/\r\n                                         MAX_MONEY,    /*nMinimumSumAmount*/\r\n                                         0)            /*nMaximumCount*/\r\n    : CoinsResult{}};\r\n```",
      "commit_id" : "c8f3be406deeda72212f764d0156b47b26dbd1b3",
      "created_at" : "2022-08-11T15:14:06Z",
      "diff_hunk" : "@@ -885,17 +878,29 @@ static util::Result<CreatedTransactionResult> CreateTransactionInternal(\n     const CAmount not_input_fees = coin_selection_params.m_effective_feerate.GetFee(coin_selection_params.tx_noinputs_size);\n     CAmount selection_target = recipients_sum + not_input_fees;\n \n-    // Get available coins\n-    auto available_coins = AvailableCoins(wallet,\n-                                              &coin_control,\n-                                              coin_selection_params.m_effective_feerate,\n-                                              1,            /*nMinimumAmount*/\n-                                              MAX_MONEY,    /*nMaximumAmount*/\n-                                              MAX_MONEY,    /*nMinimumSumAmount*/\n-                                              0);           /*nMaximumCount*/\n+    // Fetch manually select coins\n+    SelectedInputs preset_inputs;\n+    if (coin_control.HasSelected()) {\n+        auto res_fetch_inputs = FetchSelectedInputs(wallet, coin_control, coin_selection_params);\n+        if (!res_fetch_inputs) return util::Error{util::ErrorString(res_fetch_inputs)};\n+        preset_inputs = *res_fetch_inputs;\n+    }\n+\n+    // Fetch wallet available coins if \"other inputs\" are\n+    // allowed (coins automatically selected by the wallet)\n+    CoinsResult available_coins;\n+    if (coin_control.m_allow_other_inputs) {\n+        available_coins = AvailableCoins(wallet,\n+                                         &coin_control,\n+                                         coin_selection_params.m_effective_feerate,\n+                                         1,            /*nMinimumAmount*/\n+                                         MAX_MONEY,    /*nMaximumAmount*/\n+                                         MAX_MONEY,    /*nMinimumSumAmount*/\n+                                         0);           /*nMaximumCount*/\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r943608656",
      "id" : 943608656,
      "line" : 900,
      "node_id" : "PRRC_kwDOABII5844PlNQ",
      "original_commit_id" : "c8f3be406deeda72212f764d0156b47b26dbd1b3",
      "original_line" : 900,
      "original_position" : 217,
      "original_start_line" : 891,
      "path" : "src/wallet/spend.cpp",
      "position" : 217,
      "pull_request_review_id" : 1069629761,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943608656/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 891,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-11T16:17:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943608656",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r943619677"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943619677"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "i think you can remove the `value_to_select` variable and use `nTargetValue` directly",
      "commit_id" : "c8f3be406deeda72212f764d0156b47b26dbd1b3",
      "created_at" : "2022-08-11T15:24:31Z",
      "diff_hunk" : "@@ -529,75 +571,37 @@ std::optional<SelectionResult> ChooseSelectionResult(const CWallet& wallet, cons\n     return best_result;\n }\n \n-std::optional<SelectionResult> SelectCoins(const CWallet& wallet, CoinsResult& available_coins, const CAmount& nTargetValue, const CCoinControl& coin_control, const CoinSelectionParams& coin_selection_params)\n+std::optional<SelectionResult> SelectCoins(const CWallet& wallet, CoinsResult& available_coins, const SelectedInputs& pre_set_inputs,\n+                                           const CAmount& nTargetValue, const CCoinControl& coin_control,\n+                                           const CoinSelectionParams& coin_selection_params)\n {\n-    CAmount value_to_select = nTargetValue;\n-\n-    OutputGroup preset_inputs(coin_selection_params);\n-\n-    // calculate value from preset inputs and store them\n-    std::set<COutPoint> preset_coins;\n-\n-    std::vector<COutPoint> vPresetInputs;\n-    coin_control.ListSelected(vPresetInputs);\n-    for (const COutPoint& outpoint : vPresetInputs) {\n-        int input_bytes = -1;\n-        CTxOut txout;\n-        auto ptr_wtx = wallet.GetWalletTx(outpoint.hash);\n-        if (ptr_wtx) {\n-            // Clearly invalid input, fail\n-            if (ptr_wtx->tx->vout.size() <= outpoint.n) {\n-                return std::nullopt;\n-            }\n-            txout = ptr_wtx->tx->vout.at(outpoint.n);\n-            input_bytes = CalculateMaximumSignedInputSize(txout, &wallet, &coin_control);\n-        } else {\n-            // The input is external. We did not find the tx in mapWallet.\n-            if (!coin_control.GetExternalOutput(outpoint, txout)) {\n-                return std::nullopt;\n-            }\n-            input_bytes = CalculateMaximumSignedInputSize(txout, outpoint, &coin_control.m_external_provider, &coin_control);\n-        }\n-        // If available, override calculated size with coin control specified size\n-        if (coin_control.HasInputWeight(outpoint)) {\n-            input_bytes = GetVirtualTransactionSize(coin_control.GetInputWeight(outpoint), 0, 0);\n-        }\n-\n-        if (input_bytes == -1) {\n-            return std::nullopt; // Not solvable, can't estimate size for fee\n-        }\n-\n-        /* Set some defaults for depth, spendable, solvable, safe, time, and from_me as these don't matter for preset inputs since no selection is being done. */\n-        COutput output(outpoint, txout, /*depth=*/ 0, input_bytes, /*spendable=*/ true, /*solvable=*/ true, /*safe=*/ true, /*time=*/ 0, /*from_me=*/ false, coin_selection_params.m_effective_feerate);\n-        if (coin_selection_params.m_subtract_fee_outputs) {\n-            value_to_select -= output.txout.nValue;\n-        } else {\n-            value_to_select -= output.GetEffectiveValue();\n-        }\n-        preset_coins.insert(outpoint);\n-        /* Set ancestors and descendants to 0 as they don't matter for preset inputs since no actual selection is being done.\n-         * positive_only is set to false because we want to include all preset inputs, even if they are dust.\n-         */\n-        preset_inputs.Insert(output, /*ancestors=*/ 0, /*descendants=*/ 0, /*positive_only=*/ false);\n+    // Set the pre-set inputs first (no-op if no input was manually selected)\n+    SelectionResult preset_inputs_selection(nTargetValue, SelectionAlgorithm::MANUAL);\n+    preset_inputs_selection.AddInputs(pre_set_inputs.coins);\n+\n+    // Decrease the selection target\n+    CAmount selection_target = nTargetValue - pre_set_inputs.total_amount;\n+\n+    // If automatic coin selection was disabled or if we already covered the\n+    // target with the pre-set inputs, we just want to return the preset inputs result\n+    if (!coin_control.m_allow_other_inputs || selection_target <= 0) {\n+        if (selection_target > 0) return std::nullopt; // fails only if 'allow_other_inputs=false'\n+        preset_inputs_selection.ComputeAndSetWaste(coin_selection_params.m_cost_of_change);\n+        return preset_inputs_selection;\n     }\n \n-    // coin control -> return all selected outputs (we want all selected to go into the transaction for sure)\n-    if (coin_control.HasSelected() && !coin_control.m_allow_other_inputs) {\n-        SelectionResult result(nTargetValue, SelectionAlgorithm::MANUAL);\n-        result.AddInput(preset_inputs);\n-        if (result.GetSelectedValue() < nTargetValue) return std::nullopt;\n-        result.ComputeAndSetWaste(coin_selection_params.m_cost_of_change);\n-        return result;\n-    }\n+    // Start wallet Coin Selection procedure\n+    auto op_selection_result = AutomaticCoinSelection(wallet, available_coins, selection_target, coin_control, coin_selection_params);\n+    if (!op_selection_result) return op_selection_result;\n \n-    // remove preset inputs from coins so that Coin Selection doesn't pick them.\n-    if (coin_control.HasSelected()) {\n-        available_coins.legacy.erase(remove_if(available_coins.legacy.begin(), available_coins.legacy.end(), [&](const COutput& c) { return preset_coins.count(c.outpoint); }), available_coins.legacy.end());\n-        available_coins.P2SH_segwit.erase(remove_if(available_coins.P2SH_segwit.begin(), available_coins.P2SH_segwit.end(), [&](const COutput& c) { return preset_coins.count(c.outpoint); }), available_coins.P2SH_segwit.end());\n-        available_coins.bech32.erase(remove_if(available_coins.bech32.begin(), available_coins.bech32.end(), [&](const COutput& c) { return preset_coins.count(c.outpoint); }), available_coins.bech32.end());\n-        available_coins.bech32m.erase(remove_if(available_coins.bech32m.begin(), available_coins.bech32m.end(), [&](const COutput& c) { return preset_coins.count(c.outpoint); }), available_coins.bech32m.end());\n-        available_coins.other.erase(remove_if(available_coins.other.begin(), available_coins.other.end(), [&](const COutput& c) { return preset_coins.count(c.outpoint); }), available_coins.other.end());\n-    }\n+    // Add preset inputs to the automatic coin selection result\n+    op_selection_result->AddInputs(preset_inputs_selection.GetInputSet());\n+    return op_selection_result;\n+}\n+\n+std::optional<SelectionResult> AutomaticCoinSelection(const CWallet& wallet, CoinsResult& available_coins, const CAmount& nTargetValue, const CCoinControl& coin_control, const CoinSelectionParams& coin_selection_params)\n+{\n+    CAmount value_to_select = nTargetValue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r943619677",
      "id" : 943619677,
      "line" : 604,
      "node_id" : "PRRC_kwDOABII5844Pn5d",
      "original_commit_id" : "c8f3be406deeda72212f764d0156b47b26dbd1b3",
      "original_line" : 604,
      "original_position" : 157,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 157,
      "pull_request_review_id" : 1069629761,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943619677/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-11T16:19:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943619677",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r943839827"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943839827"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The rationale behind the `Fetch*` prefix instead of `Get*` was that we aren't only accessing wallet's UTXOs. We are fetching external UTXO provided by the coin control object as well.\r\n\r\nSo, with the `Fetch*` prefix I aimed to make that distinction clear.\r\nIf the function would be only getting wallet internal data, then yeah, this should had been a `Get*` for sure.",
      "commit_id" : "053b76569a28d4361ed0835dbd96b31d08595671",
      "created_at" : "2022-08-11T19:13:00Z",
      "diff_hunk" : "@@ -105,6 +105,47 @@ void CoinsResult::clear()\n     other.clear();\n }\n \n+// Fetch and validate the coin control selected inputs.\n+// Coins could be internal (from the wallet) or external.\n+util::Result<SelectedInputs> FetchSelectedInputs(const CWallet& wallet, const CCoinControl& coin_control,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r943839827",
      "id" : 943839827,
      "in_reply_to_id" : 943428008,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5844QdpT",
      "original_commit_id" : "a53748e3323a33829134cb575830933ac1893323",
      "original_line" : 110,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 1070226380,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943839827/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-11T20:38:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943839827",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r943996953"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943996953"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "sure",
      "commit_id" : "053b76569a28d4361ed0835dbd96b31d08595671",
      "created_at" : "2022-08-11T22:47:52Z",
      "diff_hunk" : "@@ -125,6 +125,26 @@ std::optional<SelectionResult> AttemptSelection(const CWallet& wallet, const CAm\n std::optional<SelectionResult> ChooseSelectionResult(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, const std::vector<COutput>& available_coins,\n                         const CoinSelectionParams& coin_selection_params);\n \n+// User manually selected inputs that must be part of the transaction\n+struct SelectedInputs",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r943996953",
      "id" : 943996953,
      "in_reply_to_id" : 943429632,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5844REAZ",
      "original_commit_id" : "a53748e3323a33829134cb575830933ac1893323",
      "original_line" : 129,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/spend.h",
      "position" : null,
      "pull_request_review_id" : 1070443775,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943996953/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-11T22:47:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943996953",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r944013468"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/944013468"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yeah, it would.\r\n\r\nBut, I'm a ~0 there, as `CoinsResult` will only have a map and a `CAmount` after #25734, this will make the code a bit harder to read for a little benefit (`AvailableCoins` has too many params so you could easily get confused by one of them and don't read the `CoinsResult` default initialization at the end).\r\n\r\nProbably with something like da44df91 the readability wouldn't be a problem anymore. And we could initialize `CoinsResults` in a single line.",
      "commit_id" : "053b76569a28d4361ed0835dbd96b31d08595671",
      "created_at" : "2022-08-11T23:30:22Z",
      "diff_hunk" : "@@ -885,17 +878,29 @@ static util::Result<CreatedTransactionResult> CreateTransactionInternal(\n     const CAmount not_input_fees = coin_selection_params.m_effective_feerate.GetFee(coin_selection_params.tx_noinputs_size);\n     CAmount selection_target = recipients_sum + not_input_fees;\n \n-    // Get available coins\n-    auto available_coins = AvailableCoins(wallet,\n-                                              &coin_control,\n-                                              coin_selection_params.m_effective_feerate,\n-                                              1,            /*nMinimumAmount*/\n-                                              MAX_MONEY,    /*nMaximumAmount*/\n-                                              MAX_MONEY,    /*nMinimumSumAmount*/\n-                                              0);           /*nMaximumCount*/\n+    // Fetch manually select coins\n+    SelectedInputs preset_inputs;\n+    if (coin_control.HasSelected()) {\n+        auto res_fetch_inputs = FetchSelectedInputs(wallet, coin_control, coin_selection_params);\n+        if (!res_fetch_inputs) return util::Error{util::ErrorString(res_fetch_inputs)};\n+        preset_inputs = *res_fetch_inputs;\n+    }\n+\n+    // Fetch wallet available coins if \"other inputs\" are\n+    // allowed (coins automatically selected by the wallet)\n+    CoinsResult available_coins;\n+    if (coin_control.m_allow_other_inputs) {\n+        available_coins = AvailableCoins(wallet,\n+                                         &coin_control,\n+                                         coin_selection_params.m_effective_feerate,\n+                                         1,            /*nMinimumAmount*/\n+                                         MAX_MONEY,    /*nMaximumAmount*/\n+                                         MAX_MONEY,    /*nMinimumSumAmount*/\n+                                         0);           /*nMaximumCount*/\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r944013468",
      "id" : 944013468,
      "in_reply_to_id" : 943608656,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5844RICc",
      "original_commit_id" : "c8f3be406deeda72212f764d0156b47b26dbd1b3",
      "original_line" : 900,
      "original_position" : 217,
      "original_start_line" : 891,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 1070466238,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/944013468/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-11T23:30:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/944013468",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r944014195"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/944014195"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "yeah great, less changes if we use `value_to_select` instead. (`value_to_select` is used in every `AttemptSelection` call)",
      "commit_id" : "053b76569a28d4361ed0835dbd96b31d08595671",
      "created_at" : "2022-08-11T23:32:19Z",
      "diff_hunk" : "@@ -529,75 +571,37 @@ std::optional<SelectionResult> ChooseSelectionResult(const CWallet& wallet, cons\n     return best_result;\n }\n \n-std::optional<SelectionResult> SelectCoins(const CWallet& wallet, CoinsResult& available_coins, const CAmount& nTargetValue, const CCoinControl& coin_control, const CoinSelectionParams& coin_selection_params)\n+std::optional<SelectionResult> SelectCoins(const CWallet& wallet, CoinsResult& available_coins, const SelectedInputs& pre_set_inputs,\n+                                           const CAmount& nTargetValue, const CCoinControl& coin_control,\n+                                           const CoinSelectionParams& coin_selection_params)\n {\n-    CAmount value_to_select = nTargetValue;\n-\n-    OutputGroup preset_inputs(coin_selection_params);\n-\n-    // calculate value from preset inputs and store them\n-    std::set<COutPoint> preset_coins;\n-\n-    std::vector<COutPoint> vPresetInputs;\n-    coin_control.ListSelected(vPresetInputs);\n-    for (const COutPoint& outpoint : vPresetInputs) {\n-        int input_bytes = -1;\n-        CTxOut txout;\n-        auto ptr_wtx = wallet.GetWalletTx(outpoint.hash);\n-        if (ptr_wtx) {\n-            // Clearly invalid input, fail\n-            if (ptr_wtx->tx->vout.size() <= outpoint.n) {\n-                return std::nullopt;\n-            }\n-            txout = ptr_wtx->tx->vout.at(outpoint.n);\n-            input_bytes = CalculateMaximumSignedInputSize(txout, &wallet, &coin_control);\n-        } else {\n-            // The input is external. We did not find the tx in mapWallet.\n-            if (!coin_control.GetExternalOutput(outpoint, txout)) {\n-                return std::nullopt;\n-            }\n-            input_bytes = CalculateMaximumSignedInputSize(txout, outpoint, &coin_control.m_external_provider, &coin_control);\n-        }\n-        // If available, override calculated size with coin control specified size\n-        if (coin_control.HasInputWeight(outpoint)) {\n-            input_bytes = GetVirtualTransactionSize(coin_control.GetInputWeight(outpoint), 0, 0);\n-        }\n-\n-        if (input_bytes == -1) {\n-            return std::nullopt; // Not solvable, can't estimate size for fee\n-        }\n-\n-        /* Set some defaults for depth, spendable, solvable, safe, time, and from_me as these don't matter for preset inputs since no selection is being done. */\n-        COutput output(outpoint, txout, /*depth=*/ 0, input_bytes, /*spendable=*/ true, /*solvable=*/ true, /*safe=*/ true, /*time=*/ 0, /*from_me=*/ false, coin_selection_params.m_effective_feerate);\n-        if (coin_selection_params.m_subtract_fee_outputs) {\n-            value_to_select -= output.txout.nValue;\n-        } else {\n-            value_to_select -= output.GetEffectiveValue();\n-        }\n-        preset_coins.insert(outpoint);\n-        /* Set ancestors and descendants to 0 as they don't matter for preset inputs since no actual selection is being done.\n-         * positive_only is set to false because we want to include all preset inputs, even if they are dust.\n-         */\n-        preset_inputs.Insert(output, /*ancestors=*/ 0, /*descendants=*/ 0, /*positive_only=*/ false);\n+    // Set the pre-set inputs first (no-op if no input was manually selected)\n+    SelectionResult preset_inputs_selection(nTargetValue, SelectionAlgorithm::MANUAL);\n+    preset_inputs_selection.AddInputs(pre_set_inputs.coins);\n+\n+    // Decrease the selection target\n+    CAmount selection_target = nTargetValue - pre_set_inputs.total_amount;\n+\n+    // If automatic coin selection was disabled or if we already covered the\n+    // target with the pre-set inputs, we just want to return the preset inputs result\n+    if (!coin_control.m_allow_other_inputs || selection_target <= 0) {\n+        if (selection_target > 0) return std::nullopt; // fails only if 'allow_other_inputs=false'\n+        preset_inputs_selection.ComputeAndSetWaste(coin_selection_params.m_cost_of_change);\n+        return preset_inputs_selection;\n     }\n \n-    // coin control -> return all selected outputs (we want all selected to go into the transaction for sure)\n-    if (coin_control.HasSelected() && !coin_control.m_allow_other_inputs) {\n-        SelectionResult result(nTargetValue, SelectionAlgorithm::MANUAL);\n-        result.AddInput(preset_inputs);\n-        if (result.GetSelectedValue() < nTargetValue) return std::nullopt;\n-        result.ComputeAndSetWaste(coin_selection_params.m_cost_of_change);\n-        return result;\n-    }\n+    // Start wallet Coin Selection procedure\n+    auto op_selection_result = AutomaticCoinSelection(wallet, available_coins, selection_target, coin_control, coin_selection_params);\n+    if (!op_selection_result) return op_selection_result;\n \n-    // remove preset inputs from coins so that Coin Selection doesn't pick them.\n-    if (coin_control.HasSelected()) {\n-        available_coins.legacy.erase(remove_if(available_coins.legacy.begin(), available_coins.legacy.end(), [&](const COutput& c) { return preset_coins.count(c.outpoint); }), available_coins.legacy.end());\n-        available_coins.P2SH_segwit.erase(remove_if(available_coins.P2SH_segwit.begin(), available_coins.P2SH_segwit.end(), [&](const COutput& c) { return preset_coins.count(c.outpoint); }), available_coins.P2SH_segwit.end());\n-        available_coins.bech32.erase(remove_if(available_coins.bech32.begin(), available_coins.bech32.end(), [&](const COutput& c) { return preset_coins.count(c.outpoint); }), available_coins.bech32.end());\n-        available_coins.bech32m.erase(remove_if(available_coins.bech32m.begin(), available_coins.bech32m.end(), [&](const COutput& c) { return preset_coins.count(c.outpoint); }), available_coins.bech32m.end());\n-        available_coins.other.erase(remove_if(available_coins.other.begin(), available_coins.other.end(), [&](const COutput& c) { return preset_coins.count(c.outpoint); }), available_coins.other.end());\n-    }\n+    // Add preset inputs to the automatic coin selection result\n+    op_selection_result->AddInputs(preset_inputs_selection.GetInputSet());\n+    return op_selection_result;\n+}\n+\n+std::optional<SelectionResult> AutomaticCoinSelection(const CWallet& wallet, CoinsResult& available_coins, const CAmount& nTargetValue, const CCoinControl& coin_control, const CoinSelectionParams& coin_selection_params)\n+{\n+    CAmount value_to_select = nTargetValue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r944014195",
      "id" : 944014195,
      "in_reply_to_id" : 943619677,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5844RINz",
      "original_commit_id" : "c8f3be406deeda72212f764d0156b47b26dbd1b3",
      "original_line" : 604,
      "original_position" : 157,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 1070467167,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/944014195/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-11T23:32:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/944014195",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r944016599"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/944016599"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "pushed",
      "commit_id" : "053b76569a28d4361ed0835dbd96b31d08595671",
      "created_at" : "2022-08-11T23:38:47Z",
      "diff_hunk" : "@@ -885,17 +878,29 @@ static util::Result<CreatedTransactionResult> CreateTransactionInternal(\n     const CAmount not_input_fees = coin_selection_params.m_effective_feerate.GetFee(coin_selection_params.tx_noinputs_size);\n     CAmount selection_target = recipients_sum + not_input_fees;\n \n-    // Get available coins\n-    auto available_coins = AvailableCoins(wallet,\n-                                              &coin_control,\n-                                              coin_selection_params.m_effective_feerate,\n-                                              1,            /*nMinimumAmount*/\n-                                              MAX_MONEY,    /*nMaximumAmount*/\n-                                              MAX_MONEY,    /*nMinimumSumAmount*/\n-                                              0);           /*nMaximumCount*/\n+    // Fetch manually select coins",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r944016599",
      "id" : 944016599,
      "in_reply_to_id" : 943422954,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5844RIzX",
      "original_commit_id" : "c8f3be406deeda72212f764d0156b47b26dbd1b3",
      "original_line" : 881,
      "original_position" : 198,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 1070470279,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/944016599/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-11T23:38:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/944016599",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for the review guys :smile:.\r\n\r\n> Regarding the bench, it would be nice to have a benchmark for when a user has a few pre-selected inputs and also uses automatic coin selection. My hunch is that that is the more representative scenario\r\n\r\nYou know @josibake, I didn't add it here mainly because this PR improves a particular scenario; when the user pre-selected inputs and disallowed the wallet automatic coin selection.\r\nThis PR doesn't improve, at least not directly, the preset inputs + automatic coin selection scenario.\r\n\r\nBut sure, will add another bench case for it :). Was planning to push it on a follow-up work to measure other changes but can sneak it here as well.\r\n\r\n> As a side note, I think it would be great to add comments to the functions below to explain that these are user pre-selected coins.\r\n\r\nAgree @aureleoules, shouldn't be called `setSelected` and have some comments there. But would say to tackle it in a separate PR so the entire `CCoinControl` class receives some love.",
      "created_at" : "2022-08-12T00:10:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#issuecomment-1212607967",
      "id" : 1212607967,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25685",
      "node_id" : "IC_kwDOABII585IRu3f",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1212607967/reactions"
      },
      "updated_at" : "2022-08-12T00:10:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1212607967",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "As requested, added a basic benchmark for the preset inputs + automatic coin selection scenario in 631f766.\r\nIn future PRs, we could continue expanding the bechmarks, adding cases for different parts of the transaction creation process.",
      "created_at" : "2022-08-12T18:40:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#issuecomment-1213410209",
      "id" : 1213410209,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25685",
      "node_id" : "IC_kwDOABII585IUyuh",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1213410209/reactions"
      },
      "updated_at" : "2022-08-12T18:40:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1213410209",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-08-17T00:44:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#issuecomment-1217313236",
      "id" : 1217313236,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25685",
      "node_id" : "IC_kwDOABII585IjrnU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1217313236/reactions"
      },
      "updated_at" : "2022-08-17T00:44:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1217313236",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "rebased on master, conflict solves. Ready to go",
      "created_at" : "2022-08-17T18:03:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#issuecomment-1218335611",
      "id" : 1218335611,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25685",
      "node_id" : "IC_kwDOABII585InlN7",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1218335611/reactions"
      },
      "updated_at" : "2022-08-17T18:03:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1218335611",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-08-19T09:22:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#issuecomment-1220453055",
      "id" : 1220453055,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25685",
      "node_id" : "IC_kwDOABII585IvqK_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1220453055/reactions"
      },
      "updated_at" : "2022-08-19T09:22:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1220453055",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "rebased, conflicts solved.",
      "created_at" : "2022-08-19T13:03:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#issuecomment-1220654165",
      "id" : 1220654165,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25685",
      "node_id" : "IC_kwDOABII585IwbRV",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1220654165/reactions"
      },
      "updated_at" : "2022-08-19T13:03:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1220654165",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-08-22T16:56:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#issuecomment-1222636834",
      "id" : 1222636834,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25685",
      "node_id" : "IC_kwDOABII585I3_Ui",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1222636834/reactions"
      },
      "updated_at" : "2022-08-22T16:56:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1222636834",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "rebased, conflicts solved. Wasn't so simple this time.",
      "created_at" : "2022-08-24T18:33:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#issuecomment-1226089360",
      "id" : 1226089360,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25685",
      "node_id" : "IC_kwDOABII585JFKOQ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1226089360/reactions"
      },
      "updated_at" : "2022-08-24T18:33:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1226089360",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Friendly ping to previous reviewers @aureleoules @josibake @achow101.\r\nWould be nice to move forward with this one, it will unlock #25806 which will unlock #24845.",
      "created_at" : "2022-09-06T13:58:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#issuecomment-1238191124",
      "id" : 1238191124,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25685",
      "node_id" : "IC_kwDOABII585JzUwU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1238191124/reactions"
      },
      "updated_at" : "2022-09-06T13:58:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1238191124",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r963893002"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963893002"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 0d6da1668d6762b1071529c39658812ba68720d8 \"wallet: skip available coins fetch if \"other inputs\" are disallowed\"\r\n\r\nWe should avoid changing the defaults of the RPC interface as that may result in users scripts breaking/doing unexpected things. While the default value of `CCoinControl` can be changed, the RPCs that actually used the default of `false` should now be setting that rather than their defaults also changing.",
      "commit_id" : "08012f03bf2cc9ec4f8b21d5643f3423acb1b5d8",
      "created_at" : "2022-09-06T15:58:58Z",
      "diff_hunk" : "@@ -1137,7 +1137,7 @@ RPCHelpMan send()\n             {\"options\", RPCArg::Type::OBJ, RPCArg::Optional::OMITTED_NAMED_ARG, \"\",\n                 Cat<std::vector<RPCArg>>(\n                 {\n-                    {\"add_inputs\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"If inputs are specified, automatically include more if they are not enough.\"},\n+                    {\"add_inputs\", RPCArg::Type::BOOL, RPCArg::Default{true}, \"If inputs are specified, automatically include more if they are not enough.\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r963893002",
      "id" : 963893002,
      "line" : 1140,
      "node_id" : "PRRC_kwDOABII5845c9cK",
      "original_commit_id" : "0d6da1668d6762b1071529c39658812ba68720d8",
      "original_line" : 1140,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : 5,
      "pull_request_review_id" : 1097871282,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963893002/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-06T16:07:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963893002",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r963895180"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963895180"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In e6b9e23699a5dc8e08711004f51c877fa3912db1 \"wallet: encapsulate pre-selected-inputs lookup into its own function\"\r\n\r\nnit: only member variables should have the `m_` prefix.",
      "commit_id" : "08012f03bf2cc9ec4f8b21d5643f3423acb1b5d8",
      "created_at" : "2022-09-06T16:00:20Z",
      "diff_hunk" : "@@ -444,6 +444,12 @@ void SelectionResult::AddInput(const OutputGroup& group)\n     m_use_effective = !group.m_subtract_fee_outputs;\n }\n \n+void SelectionResult::AddInputs(const std::set<COutput>& inputs, bool m_subtract_fee_outputs)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r963895180",
      "id" : 963895180,
      "line" : 447,
      "node_id" : "PRRC_kwDOABII5845c9-M",
      "original_commit_id" : "e6b9e23699a5dc8e08711004f51c877fa3912db1",
      "original_line" : 447,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.cpp",
      "position" : 4,
      "pull_request_review_id" : 1097871282,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963895180/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-06T16:07:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963895180",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r963902491"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963902491"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 08012f03bf2cc9ec4f8b21d5643f3423acb1b5d8 \"bench: add benchmark for tx creation using pre-set inputs and coin selection\"\r\n\r\nnit: This should be in the previous commit.",
      "commit_id" : "08012f03bf2cc9ec4f8b21d5643f3423acb1b5d8",
      "created_at" : "2022-09-06T16:05:43Z",
      "diff_hunk" : "@@ -115,6 +132,11 @@ static void WalletCreateTx(benchmark::Bench& bench, const OutputType output_type\n     });\n }\n \n-static void WalletCreateTxUseOnlyPresetInputs(benchmark::Bench& bench) { WalletCreateTx(bench, OutputType::BECH32); }\n+static void WalletCreateTxUseOnlyPresetInputs(benchmark::Bench& bench) { WalletCreateTx(bench, OutputType::BECH32, /*allow_other_inputs=*/false,\n+                                                                                        {{/*num_of_internal_inputs=*/4}}); }\n+\n+static void WalletCreateTxUsePresetInputsAndCoinSelection(benchmark::Bench& bench) { WalletCreateTx(bench, OutputType::BECH32, /*allow_other_inputs=*/true,\n+                                                                                                    {{/*num_of_internal_inputs=*/4}}); }\n \n-BENCHMARK(WalletCreateTxUseOnlyPresetInputs);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r963902491",
      "id" : 963902491,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845c_wb",
      "original_commit_id" : "08012f03bf2cc9ec4f8b21d5643f3423acb1b5d8",
      "original_line" : 120,
      "original_position" : 58,
      "original_start_line" : null,
      "path" : "src/bench/wallet_create_tx.cpp",
      "position" : 58,
      "pull_request_review_id" : 1097871282,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963902491/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-06T16:07:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963902491",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r966416860"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/966416860"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This is more a bugfix than a behavior change actually. Let me expand:\r\n\r\nBefore, the default value was not `false` all the time, it was a hidden `true`. We were having a bug/workaround to always select coins automatically from the wallet even when the user explicitly set `add_inputs=false` (which means \"don't select coins automatically\").\r\n\r\nThis is why, even when I changed the field default value inside coin control, I didn't need to change any test on that commit. They actually were all depending on the bug to work properly! (including the GUI..).\r\n\r\nCan try it by setting `add_inputs=false` in any of the fund* RPC commands without pre-setting any input. The process will automatically select coins from the wallet even when you are explicitly blocking it (the proper expected behavior is fail due \"insufficient funds\").\r\nI'm going to add test coverage for this.. so the previous bad behavior and the fix commit can be contrasted. It was a truly misleading behavior.\r\n\r\n~~Side from that:\r\nI know what you mean, if the user pre-set inputs, the previous default value was `false`. So, to not change behavior in this scenario, by default, no automatic coin selection should be performed on the RPC commands.\r\nWill add coverage for this as well.~~. --> not needed since #26053.\r\nThanks.",
      "commit_id" : "2d9ea15fe9773c3efe349579413b4a4e56c30454",
      "created_at" : "2022-09-08T21:01:52Z",
      "diff_hunk" : "@@ -1137,7 +1137,7 @@ RPCHelpMan send()\n             {\"options\", RPCArg::Type::OBJ, RPCArg::Optional::OMITTED_NAMED_ARG, \"\",\n                 Cat<std::vector<RPCArg>>(\n                 {\n-                    {\"add_inputs\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"If inputs are specified, automatically include more if they are not enough.\"},\n+                    {\"add_inputs\", RPCArg::Type::BOOL, RPCArg::Default{true}, \"If inputs are specified, automatically include more if they are not enough.\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r966416860",
      "id" : 966416860,
      "in_reply_to_id" : 963893002,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845mlnc",
      "original_commit_id" : "0d6da1668d6762b1071529c39658812ba68720d8",
      "original_line" : 1140,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 1101411676,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/966416860/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-15T16:42:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/966416860",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r966421568"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/966421568"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ok, squashing it.",
      "commit_id" : "08012f03bf2cc9ec4f8b21d5643f3423acb1b5d8",
      "created_at" : "2022-09-08T21:07:44Z",
      "diff_hunk" : "@@ -115,6 +132,11 @@ static void WalletCreateTx(benchmark::Bench& bench, const OutputType output_type\n     });\n }\n \n-static void WalletCreateTxUseOnlyPresetInputs(benchmark::Bench& bench) { WalletCreateTx(bench, OutputType::BECH32); }\n+static void WalletCreateTxUseOnlyPresetInputs(benchmark::Bench& bench) { WalletCreateTx(bench, OutputType::BECH32, /*allow_other_inputs=*/false,\n+                                                                                        {{/*num_of_internal_inputs=*/4}}); }\n+\n+static void WalletCreateTxUsePresetInputsAndCoinSelection(benchmark::Bench& bench) { WalletCreateTx(bench, OutputType::BECH32, /*allow_other_inputs=*/true,\n+                                                                                                    {{/*num_of_internal_inputs=*/4}}); }\n \n-BENCHMARK(WalletCreateTxUseOnlyPresetInputs);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r966421568",
      "id" : 966421568,
      "in_reply_to_id" : 963902491,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845mmxA",
      "original_commit_id" : "08012f03bf2cc9ec4f8b21d5643f3423acb1b5d8",
      "original_line" : 120,
      "original_position" : 58,
      "original_start_line" : null,
      "path" : "src/bench/wallet_create_tx.cpp",
      "position" : 58,
      "pull_request_review_id" : 1101423405,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/966421568/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-08T21:07:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/966421568",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r966421713"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/966421713"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "yeah, removing it..",
      "commit_id" : "08012f03bf2cc9ec4f8b21d5643f3423acb1b5d8",
      "created_at" : "2022-09-08T21:07:52Z",
      "diff_hunk" : "@@ -444,6 +444,12 @@ void SelectionResult::AddInput(const OutputGroup& group)\n     m_use_effective = !group.m_subtract_fee_outputs;\n }\n \n+void SelectionResult::AddInputs(const std::set<COutput>& inputs, bool m_subtract_fee_outputs)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r966421713",
      "id" : 966421713,
      "in_reply_to_id" : 963895180,
      "line" : 447,
      "node_id" : "PRRC_kwDOABII5845mmzR",
      "original_commit_id" : "e6b9e23699a5dc8e08711004f51c877fa3912db1",
      "original_line" : 447,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.cpp",
      "position" : 4,
      "pull_request_review_id" : 1101423543,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/966421713/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-08T21:07:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/966421713",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r967375113"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/967375113"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Pushed #26053 to fulfill this purposes, make the bug visible and to try to fix it for 24.0.\r\nOnce that one gets merged, changes in 0d6da166 will be smaller and simpler to review.",
      "commit_id" : "08012f03bf2cc9ec4f8b21d5643f3423acb1b5d8",
      "created_at" : "2022-09-09T18:49:55Z",
      "diff_hunk" : "@@ -1137,7 +1137,7 @@ RPCHelpMan send()\n             {\"options\", RPCArg::Type::OBJ, RPCArg::Optional::OMITTED_NAMED_ARG, \"\",\n                 Cat<std::vector<RPCArg>>(\n                 {\n-                    {\"add_inputs\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"If inputs are specified, automatically include more if they are not enough.\"},\n+                    {\"add_inputs\", RPCArg::Type::BOOL, RPCArg::Default{true}, \"If inputs are specified, automatically include more if they are not enough.\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r967375113",
      "id" : 967375113,
      "in_reply_to_id" : 963893002,
      "line" : 1140,
      "node_id" : "PRRC_kwDOABII5845qPkJ",
      "original_commit_id" : "0d6da1668d6762b1071529c39658812ba68720d8",
      "original_line" : 1140,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : 5,
      "pull_request_review_id" : 1102764884,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/967375113/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-09T18:49:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/967375113",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased on master, achow101 feedback tackled. Thanks.\r\n\r\nChanges:\r\n* Removed `m_` prefix from `AddInputs` function signature.\r\n* Squashed benchmark 08012f03 inside 2d9ea15.\r\n* Added test case for when the user explicitly disallows the automatic coin selection and does not provide inputs (on master, this test fails because the wallet invalidly fall back to select coins automatically even when the user provided `add_inputs=false`).",
      "created_at" : "2022-09-15T16:59:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#issuecomment-1248370123",
      "id" : 1248370123,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25685",
      "node_id" : "IC_kwDOABII585KaJ3L",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1248370123/reactions"
      },
      "updated_at" : "2022-09-15T16:59:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1248370123",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Here are my bench results (with `sudo pyperf system tune`).\r\n\r\n## PR\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|        3,165,243.33 |              315.93 |    1.6% |   18,936,699.67 |    7,255,808.00 |  2.610 |     507,961.67 |    2.3% |      0.10 | `WalletCreateTxUseOnlyPresetInputs`\r\n|    2,503,088,950.33 |                0.40 |    2.9% |12,628,647,472.00 |5,467,638,592.00 |  2.310 |2,036,987,578.67 |    0.3% |     84.82 | `WalletCreateTxUsePresetInputsAndCoinSelection`\r\n\r\n\r\n## Master\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|       66,423,839.67 |               15.05 |    0.4% |  102,368,093.00 |  152,193,632.00 |  0.673 |  22,866,396.33 |    0.6% |      2.20 | `WalletCreateTxUseOnlyPresetInputs`\r\n|    2,546,070,421.67 |                0.39 |    5.5% |12,710,666,931.00 |5,631,797,760.00 |  2.257 |2,052,977,444.33 |    0.3% |     86.15 | :wavy_dash: `WalletCreateTxUsePresetInputsAndCoinSelection` (Unstable with ~3.0 iters. Increase `minEpochIterations` to e.g. 30)\r\n\r\n> You know josibake, I didn't add it here mainly because this PR improves a particular scenario; when the user pre-selected inputs and disallowed the wallet automatic coin selection.\r\nThis PR doesn't improve, at least not directly, the preset inputs + automatic coin selection scenario.\r\n\r\nIndeed :+1:\r\n`WalletCreateTxUseOnlyPresetInputs` is significantly faster now and `WalletCreateTxUsePresetInputsAndCoinSelection` has not changed.\r\n\r\n> Unstable with ~3.0 iters. Increase `minEpochIterations` to e.g. 30\r\n\r\nnit: maybe increase iterations? not sure how important this is. ",
      "created_at" : "2022-09-16T15:06:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#issuecomment-1249481997",
      "id" : 1249481997,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25685",
      "node_id" : "IC_kwDOABII585KeZUN",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1249481997/reactions"
      },
      "updated_at" : "2022-09-16T15:06:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1249481997",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r973264234"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/973264234"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 2d9ea15fe9773c3efe349579413b4a4e56c30454 \"bench: benchmark transaction creation process\"\r\n\r\n150000 blocks is excessive. This makes the benchmark extremely slow to run. It increases the runtime of `make check` by several orders of magnitude. A few hundred blocks should be enough to illustrate the performance difference, I don't think we need more than a thousand, let alone 150,000.",
      "commit_id" : "2d9ea15fe9773c3efe349579413b4a4e56c30454",
      "created_at" : "2022-09-16T17:49:58Z",
      "diff_hunk" : "@@ -0,0 +1,142 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <chainparams.h>\n+#include <wallet/coincontrol.h>\n+#include <consensus/merkle.h>\n+#include <kernel/chain.h>\n+#include <node/context.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/wallet.h>\n+#include <validation.h>\n+#include <wallet/spend.h>\n+#include <wallet/wallet.h>\n+\n+using wallet::CWallet;\n+using wallet::CreateMockWalletDatabase;\n+using wallet::DBErrors;\n+using wallet::WALLET_FLAG_DESCRIPTORS;\n+\n+struct TipBlock\n+{\n+    uint256 prev_block_hash;\n+    int64_t prev_block_time;\n+    int tip_height;\n+};\n+\n+TipBlock getTip(const CChainParams& params, const node::NodeContext& context)\n+{\n+    auto tip = WITH_LOCK(::cs_main, return context.chainman->ActiveTip());\n+    return (tip) ? TipBlock{tip->GetBlockHash(), tip->GetBlockTime(), tip->nHeight} :\n+           TipBlock{params.GenesisBlock().GetHash(), params.GenesisBlock().GetBlockTime(), 0};\n+}\n+\n+void generateFakeBlock(const CChainParams& params,\n+                       const node::NodeContext& context,\n+                       CWallet& wallet,\n+                       const CScript& coinbase_out_script)\n+{\n+    TipBlock tip{getTip(params, context)};\n+\n+    // Create block\n+    CBlock block;\n+    CMutableTransaction coinbase_tx;\n+    coinbase_tx.vin.resize(1);\n+    coinbase_tx.vin[0].prevout.SetNull();\n+    coinbase_tx.vout.resize(2);\n+    coinbase_tx.vout[0].scriptPubKey = coinbase_out_script;\n+    coinbase_tx.vout[0].nValue = 49 * COIN;\n+    coinbase_tx.vin[0].scriptSig = CScript() << ++tip.tip_height << OP_0;\n+    coinbase_tx.vout[1].scriptPubKey = coinbase_out_script; // extra output\n+    coinbase_tx.vout[1].nValue = 1 * COIN;\n+    block.vtx = {MakeTransactionRef(std::move(coinbase_tx))};\n+\n+    block.nVersion = VERSIONBITS_LAST_OLD_BLOCK_VERSION;\n+    block.hashPrevBlock = tip.prev_block_hash;\n+    block.hashMerkleRoot = BlockMerkleRoot(block);\n+    block.nTime = ++tip.prev_block_time;\n+    block.nBits = params.GenesisBlock().nBits;\n+    block.nNonce = 0;\n+\n+    {\n+        LOCK(::cs_main);\n+        // Add it to the index\n+        CBlockIndex* pindex{context.chainman->m_blockman.AddToBlockIndex(block, context.chainman->m_best_header)};\n+        // add it to the chain\n+        context.chainman->ActiveChain().SetTip(*pindex);\n+    }\n+\n+    // notify wallet\n+    const auto& pindex = WITH_LOCK(::cs_main, return context.chainman->ActiveChain().Tip());\n+    wallet.blockConnected(kernel::MakeBlockInfo(pindex, &block));\n+}\n+\n+struct PreSelectInputs {\n+    // How many coins from the wallet the process should select\n+    int num_of_internal_inputs;\n+    // future: this could have external inputs as well.\n+};\n+\n+static void WalletCreateTx(benchmark::Bench& bench, const OutputType output_type, bool allow_other_inputs, std::optional<PreSelectInputs> preset_inputs)\n+{\n+    const auto test_setup = MakeNoLogFileContext<const TestingSetup>();\n+\n+    CWallet wallet{test_setup->m_node.chain.get(), \"\", gArgs, CreateMockWalletDatabase()};\n+    {\n+        LOCK(wallet.cs_wallet);\n+        wallet.SetWalletFlag(WALLET_FLAG_DESCRIPTORS);\n+        wallet.SetupDescriptorScriptPubKeyMans();\n+        if (wallet.LoadWallet() != DBErrors::LOAD_OK) assert(false);\n+    }\n+\n+    // Generate destinations\n+    CScript dest = GetScriptForDestination(getNewDestination(wallet, output_type));\n+\n+    // Generate chain; each coinbase will have two outputs to fill-up the wallet\n+    const auto& params = Params();\n+    unsigned int chain_size = 150000; // 150k blocks means 300k UTXO for the wallet (minus 200 due COINBASE_MATURITY)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r973264234",
      "id" : 973264234,
      "line" : 99,
      "node_id" : "PRRC_kwDOABII5846AtVq",
      "original_commit_id" : "2d9ea15fe9773c3efe349579413b4a4e56c30454",
      "original_line" : 99,
      "original_position" : 99,
      "original_start_line" : null,
      "path" : "src/bench/wallet_create_tx.cpp",
      "position" : 99,
      "pull_request_review_id" : 1111036386,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/973264234/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-16T17:50:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/973264234",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r973304073"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/973304073"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I initially set it low, at 2k (4k utxo), but it wasn't really illustrative. This becomes a problem when your wallet has a high tx volume. Otherwise, traverse 4k utxo is quite fast, almost imperceptible.\r\ne.g.\r\n### PR\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|        1,427,966.60 |              700.30 |    1.2% |      0.08 | `WalletCreateTxUseOnlyPresetInputs`\r\n\r\n### Master\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|        1,576,250.00 |              634.42 |    0.5% |      0.09 | `WalletCreateTxUseOnlyPresetInputs`\r\n----\r\n\r\nLet me try with 20k instead. We should try to get a middle-ground between the high value (agree that it's too high) and a number that can provide meaningful information on the context where this becomes a real problem for the user.",
      "commit_id" : "1c7417711d2b9353350a8b5b2e580850cd1b5d3b",
      "created_at" : "2022-09-16T18:49:45Z",
      "diff_hunk" : "@@ -0,0 +1,142 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <chainparams.h>\n+#include <wallet/coincontrol.h>\n+#include <consensus/merkle.h>\n+#include <kernel/chain.h>\n+#include <node/context.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/wallet.h>\n+#include <validation.h>\n+#include <wallet/spend.h>\n+#include <wallet/wallet.h>\n+\n+using wallet::CWallet;\n+using wallet::CreateMockWalletDatabase;\n+using wallet::DBErrors;\n+using wallet::WALLET_FLAG_DESCRIPTORS;\n+\n+struct TipBlock\n+{\n+    uint256 prev_block_hash;\n+    int64_t prev_block_time;\n+    int tip_height;\n+};\n+\n+TipBlock getTip(const CChainParams& params, const node::NodeContext& context)\n+{\n+    auto tip = WITH_LOCK(::cs_main, return context.chainman->ActiveTip());\n+    return (tip) ? TipBlock{tip->GetBlockHash(), tip->GetBlockTime(), tip->nHeight} :\n+           TipBlock{params.GenesisBlock().GetHash(), params.GenesisBlock().GetBlockTime(), 0};\n+}\n+\n+void generateFakeBlock(const CChainParams& params,\n+                       const node::NodeContext& context,\n+                       CWallet& wallet,\n+                       const CScript& coinbase_out_script)\n+{\n+    TipBlock tip{getTip(params, context)};\n+\n+    // Create block\n+    CBlock block;\n+    CMutableTransaction coinbase_tx;\n+    coinbase_tx.vin.resize(1);\n+    coinbase_tx.vin[0].prevout.SetNull();\n+    coinbase_tx.vout.resize(2);\n+    coinbase_tx.vout[0].scriptPubKey = coinbase_out_script;\n+    coinbase_tx.vout[0].nValue = 49 * COIN;\n+    coinbase_tx.vin[0].scriptSig = CScript() << ++tip.tip_height << OP_0;\n+    coinbase_tx.vout[1].scriptPubKey = coinbase_out_script; // extra output\n+    coinbase_tx.vout[1].nValue = 1 * COIN;\n+    block.vtx = {MakeTransactionRef(std::move(coinbase_tx))};\n+\n+    block.nVersion = VERSIONBITS_LAST_OLD_BLOCK_VERSION;\n+    block.hashPrevBlock = tip.prev_block_hash;\n+    block.hashMerkleRoot = BlockMerkleRoot(block);\n+    block.nTime = ++tip.prev_block_time;\n+    block.nBits = params.GenesisBlock().nBits;\n+    block.nNonce = 0;\n+\n+    {\n+        LOCK(::cs_main);\n+        // Add it to the index\n+        CBlockIndex* pindex{context.chainman->m_blockman.AddToBlockIndex(block, context.chainman->m_best_header)};\n+        // add it to the chain\n+        context.chainman->ActiveChain().SetTip(*pindex);\n+    }\n+\n+    // notify wallet\n+    const auto& pindex = WITH_LOCK(::cs_main, return context.chainman->ActiveChain().Tip());\n+    wallet.blockConnected(kernel::MakeBlockInfo(pindex, &block));\n+}\n+\n+struct PreSelectInputs {\n+    // How many coins from the wallet the process should select\n+    int num_of_internal_inputs;\n+    // future: this could have external inputs as well.\n+};\n+\n+static void WalletCreateTx(benchmark::Bench& bench, const OutputType output_type, bool allow_other_inputs, std::optional<PreSelectInputs> preset_inputs)\n+{\n+    const auto test_setup = MakeNoLogFileContext<const TestingSetup>();\n+\n+    CWallet wallet{test_setup->m_node.chain.get(), \"\", gArgs, CreateMockWalletDatabase()};\n+    {\n+        LOCK(wallet.cs_wallet);\n+        wallet.SetWalletFlag(WALLET_FLAG_DESCRIPTORS);\n+        wallet.SetupDescriptorScriptPubKeyMans();\n+        if (wallet.LoadWallet() != DBErrors::LOAD_OK) assert(false);\n+    }\n+\n+    // Generate destinations\n+    CScript dest = GetScriptForDestination(getNewDestination(wallet, output_type));\n+\n+    // Generate chain; each coinbase will have two outputs to fill-up the wallet\n+    const auto& params = Params();\n+    unsigned int chain_size = 150000; // 150k blocks means 300k UTXO for the wallet (minus 200 due COINBASE_MATURITY)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r973304073",
      "id" : 973304073,
      "in_reply_to_id" : 973264234,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5846A3EJ",
      "original_commit_id" : "2d9ea15fe9773c3efe349579413b4a4e56c30454",
      "original_line" : 99,
      "original_position" : 99,
      "original_start_line" : null,
      "path" : "src/bench/wallet_create_tx.cpp",
      "position" : null,
      "pull_request_review_id" : 1111095013,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/973304073/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-16T19:50:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/973304073",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated per feedback, thanks aureleoules and achow101.\r\n\r\n1) Per aureleoules review: \r\n   Increased the bench iterations from 3 to 5.\r\n\r\n2) Per achow101 review: \r\n   Decreased the number of blocks used in the benchmarks from 150k to 20k so `make check` doesn't take too much time on low-end devices and we still continue benchmarking the tx creation process on a wallet with a reasonable amount of txes/utxo.",
      "created_at" : "2022-09-16T20:30:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#issuecomment-1249784908",
      "id" : 1249784908,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25685",
      "node_id" : "IC_kwDOABII585KfjRM",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1249784908/reactions"
      },
      "updated_at" : "2022-09-16T20:30:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1249784908",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r974682988"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974682988"
         }
      },
      "author_association" : "MEMBER",
      "body" : "20k is still a lot and the setup does still take quite a long time. While the real time difference may not be that noticeable, I think `ns/op` and `op/s sufficiently illustrate the difference even when this is run with 2000 blocks.",
      "commit_id" : "1c7417711d2b9353350a8b5b2e580850cd1b5d3b",
      "created_at" : "2022-09-19T20:56:03Z",
      "diff_hunk" : "@@ -0,0 +1,142 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <chainparams.h>\n+#include <wallet/coincontrol.h>\n+#include <consensus/merkle.h>\n+#include <kernel/chain.h>\n+#include <node/context.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/wallet.h>\n+#include <validation.h>\n+#include <wallet/spend.h>\n+#include <wallet/wallet.h>\n+\n+using wallet::CWallet;\n+using wallet::CreateMockWalletDatabase;\n+using wallet::DBErrors;\n+using wallet::WALLET_FLAG_DESCRIPTORS;\n+\n+struct TipBlock\n+{\n+    uint256 prev_block_hash;\n+    int64_t prev_block_time;\n+    int tip_height;\n+};\n+\n+TipBlock getTip(const CChainParams& params, const node::NodeContext& context)\n+{\n+    auto tip = WITH_LOCK(::cs_main, return context.chainman->ActiveTip());\n+    return (tip) ? TipBlock{tip->GetBlockHash(), tip->GetBlockTime(), tip->nHeight} :\n+           TipBlock{params.GenesisBlock().GetHash(), params.GenesisBlock().GetBlockTime(), 0};\n+}\n+\n+void generateFakeBlock(const CChainParams& params,\n+                       const node::NodeContext& context,\n+                       CWallet& wallet,\n+                       const CScript& coinbase_out_script)\n+{\n+    TipBlock tip{getTip(params, context)};\n+\n+    // Create block\n+    CBlock block;\n+    CMutableTransaction coinbase_tx;\n+    coinbase_tx.vin.resize(1);\n+    coinbase_tx.vin[0].prevout.SetNull();\n+    coinbase_tx.vout.resize(2);\n+    coinbase_tx.vout[0].scriptPubKey = coinbase_out_script;\n+    coinbase_tx.vout[0].nValue = 49 * COIN;\n+    coinbase_tx.vin[0].scriptSig = CScript() << ++tip.tip_height << OP_0;\n+    coinbase_tx.vout[1].scriptPubKey = coinbase_out_script; // extra output\n+    coinbase_tx.vout[1].nValue = 1 * COIN;\n+    block.vtx = {MakeTransactionRef(std::move(coinbase_tx))};\n+\n+    block.nVersion = VERSIONBITS_LAST_OLD_BLOCK_VERSION;\n+    block.hashPrevBlock = tip.prev_block_hash;\n+    block.hashMerkleRoot = BlockMerkleRoot(block);\n+    block.nTime = ++tip.prev_block_time;\n+    block.nBits = params.GenesisBlock().nBits;\n+    block.nNonce = 0;\n+\n+    {\n+        LOCK(::cs_main);\n+        // Add it to the index\n+        CBlockIndex* pindex{context.chainman->m_blockman.AddToBlockIndex(block, context.chainman->m_best_header)};\n+        // add it to the chain\n+        context.chainman->ActiveChain().SetTip(*pindex);\n+    }\n+\n+    // notify wallet\n+    const auto& pindex = WITH_LOCK(::cs_main, return context.chainman->ActiveChain().Tip());\n+    wallet.blockConnected(kernel::MakeBlockInfo(pindex, &block));\n+}\n+\n+struct PreSelectInputs {\n+    // How many coins from the wallet the process should select\n+    int num_of_internal_inputs;\n+    // future: this could have external inputs as well.\n+};\n+\n+static void WalletCreateTx(benchmark::Bench& bench, const OutputType output_type, bool allow_other_inputs, std::optional<PreSelectInputs> preset_inputs)\n+{\n+    const auto test_setup = MakeNoLogFileContext<const TestingSetup>();\n+\n+    CWallet wallet{test_setup->m_node.chain.get(), \"\", gArgs, CreateMockWalletDatabase()};\n+    {\n+        LOCK(wallet.cs_wallet);\n+        wallet.SetWalletFlag(WALLET_FLAG_DESCRIPTORS);\n+        wallet.SetupDescriptorScriptPubKeyMans();\n+        if (wallet.LoadWallet() != DBErrors::LOAD_OK) assert(false);\n+    }\n+\n+    // Generate destinations\n+    CScript dest = GetScriptForDestination(getNewDestination(wallet, output_type));\n+\n+    // Generate chain; each coinbase will have two outputs to fill-up the wallet\n+    const auto& params = Params();\n+    unsigned int chain_size = 150000; // 150k blocks means 300k UTXO for the wallet (minus 200 due COINBASE_MATURITY)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r974682988",
      "id" : 974682988,
      "in_reply_to_id" : 973264234,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5846GHts",
      "original_commit_id" : "2d9ea15fe9773c3efe349579413b4a4e56c30454",
      "original_line" : 99,
      "original_position" : 99,
      "original_start_line" : null,
      "path" : "src/bench/wallet_create_tx.cpp",
      "position" : null,
      "pull_request_review_id" : 1112871351,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974682988/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-19T20:56:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974682988",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r975424674"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/975424674"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm not so convinced there. I do understand the `make check` time concern but that is limiting our testing capabilities. Some big issues aren't problems at all in a small scale.\r\n\r\nAs time isn't constant between runs and the difference is so small with 2000 blocks, stuff like this can easily go unnoticed for a really long time. Which kinda break the purpose of having a benchmark for it.\r\n\r\nE.g. lets say that we have this benchmark in the code with the 2000 blocks param. And someone introduces a similar problematic (traverse the whole wallet map and do other stuff for no reason).\r\nWould you care about it if the benchmark returns a time diff between 60-100 ns? or would you just say \"it's ok\"?.\r\nWe could be hurting badly big wallets with our changes without noticing it at all.\r\n\r\nSaying that, will decrease the number to 10k blocks. So we get closer to each other's number. Would you be ok with it?\r\nI think that the 2k blocks number is too small to be helpful on this context.\r\n\r\n----------------------\r\n\r\nAs future thoughts, would be nice to be able to re-use setups in the benchmarks. So every `WalletCreateTx*` would not require to create a new chain per run.\r\nPlus, would be good to not run all the benchmarks by default in `make check`. Only people working in the specific area should run them (or even better, maybe only PRs with certain labels should run them and compare the results with master's result).",
      "commit_id" : "f22a671f095780a1e0e296aab2c4d5464d0f683f",
      "created_at" : "2022-09-20T14:15:48Z",
      "diff_hunk" : "@@ -0,0 +1,142 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <chainparams.h>\n+#include <wallet/coincontrol.h>\n+#include <consensus/merkle.h>\n+#include <kernel/chain.h>\n+#include <node/context.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/wallet.h>\n+#include <validation.h>\n+#include <wallet/spend.h>\n+#include <wallet/wallet.h>\n+\n+using wallet::CWallet;\n+using wallet::CreateMockWalletDatabase;\n+using wallet::DBErrors;\n+using wallet::WALLET_FLAG_DESCRIPTORS;\n+\n+struct TipBlock\n+{\n+    uint256 prev_block_hash;\n+    int64_t prev_block_time;\n+    int tip_height;\n+};\n+\n+TipBlock getTip(const CChainParams& params, const node::NodeContext& context)\n+{\n+    auto tip = WITH_LOCK(::cs_main, return context.chainman->ActiveTip());\n+    return (tip) ? TipBlock{tip->GetBlockHash(), tip->GetBlockTime(), tip->nHeight} :\n+           TipBlock{params.GenesisBlock().GetHash(), params.GenesisBlock().GetBlockTime(), 0};\n+}\n+\n+void generateFakeBlock(const CChainParams& params,\n+                       const node::NodeContext& context,\n+                       CWallet& wallet,\n+                       const CScript& coinbase_out_script)\n+{\n+    TipBlock tip{getTip(params, context)};\n+\n+    // Create block\n+    CBlock block;\n+    CMutableTransaction coinbase_tx;\n+    coinbase_tx.vin.resize(1);\n+    coinbase_tx.vin[0].prevout.SetNull();\n+    coinbase_tx.vout.resize(2);\n+    coinbase_tx.vout[0].scriptPubKey = coinbase_out_script;\n+    coinbase_tx.vout[0].nValue = 49 * COIN;\n+    coinbase_tx.vin[0].scriptSig = CScript() << ++tip.tip_height << OP_0;\n+    coinbase_tx.vout[1].scriptPubKey = coinbase_out_script; // extra output\n+    coinbase_tx.vout[1].nValue = 1 * COIN;\n+    block.vtx = {MakeTransactionRef(std::move(coinbase_tx))};\n+\n+    block.nVersion = VERSIONBITS_LAST_OLD_BLOCK_VERSION;\n+    block.hashPrevBlock = tip.prev_block_hash;\n+    block.hashMerkleRoot = BlockMerkleRoot(block);\n+    block.nTime = ++tip.prev_block_time;\n+    block.nBits = params.GenesisBlock().nBits;\n+    block.nNonce = 0;\n+\n+    {\n+        LOCK(::cs_main);\n+        // Add it to the index\n+        CBlockIndex* pindex{context.chainman->m_blockman.AddToBlockIndex(block, context.chainman->m_best_header)};\n+        // add it to the chain\n+        context.chainman->ActiveChain().SetTip(*pindex);\n+    }\n+\n+    // notify wallet\n+    const auto& pindex = WITH_LOCK(::cs_main, return context.chainman->ActiveChain().Tip());\n+    wallet.blockConnected(kernel::MakeBlockInfo(pindex, &block));\n+}\n+\n+struct PreSelectInputs {\n+    // How many coins from the wallet the process should select\n+    int num_of_internal_inputs;\n+    // future: this could have external inputs as well.\n+};\n+\n+static void WalletCreateTx(benchmark::Bench& bench, const OutputType output_type, bool allow_other_inputs, std::optional<PreSelectInputs> preset_inputs)\n+{\n+    const auto test_setup = MakeNoLogFileContext<const TestingSetup>();\n+\n+    CWallet wallet{test_setup->m_node.chain.get(), \"\", gArgs, CreateMockWalletDatabase()};\n+    {\n+        LOCK(wallet.cs_wallet);\n+        wallet.SetWalletFlag(WALLET_FLAG_DESCRIPTORS);\n+        wallet.SetupDescriptorScriptPubKeyMans();\n+        if (wallet.LoadWallet() != DBErrors::LOAD_OK) assert(false);\n+    }\n+\n+    // Generate destinations\n+    CScript dest = GetScriptForDestination(getNewDestination(wallet, output_type));\n+\n+    // Generate chain; each coinbase will have two outputs to fill-up the wallet\n+    const auto& params = Params();\n+    unsigned int chain_size = 150000; // 150k blocks means 300k UTXO for the wallet (minus 200 due COINBASE_MATURITY)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r975424674",
      "id" : 975424674,
      "in_reply_to_id" : 973264234,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5846I8yi",
      "original_commit_id" : "2d9ea15fe9773c3efe349579413b4a4e56c30454",
      "original_line" : 99,
      "original_position" : 99,
      "original_start_line" : null,
      "path" : "src/bench/wallet_create_tx.cpp",
      "position" : null,
      "pull_request_review_id" : 1113912987,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/975424674/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-20T16:00:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/975424674",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 40452b8be29c85fbd2e96f93fa1b9ad37e6d44d8\r\n\r\n## PR\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|        3,252,252.20 |              307.48 |    0.7% |   19,062,206.80 |    7,444,723.20 |  2.560 |     504,438.20 |    2.5% |      0.18 | `WalletCreateTxUseOnlyPresetInputs`\r\n\r\n## Master\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|        7,162,568.40 |              139.61 |    1.1% |   24,654,767.60 |   16,410,489.60 |  1.502 |   1,935,246.40 |    1.3% |      0.39 | `WalletCreateTxUseOnlyPresetInputs`",
      "created_at" : "2022-09-20T14:43:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#issuecomment-1252461415",
      "id" : 1252461415,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25685",
      "node_id" : "IC_kwDOABII585Kpwtn",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1252461415/reactions"
      },
      "updated_at" : "2022-09-20T14:43:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1252461415",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-09-21T11:14:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#issuecomment-1253556057",
      "id" : 1253556057,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25685",
      "node_id" : "IC_kwDOABII585Kt79Z",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 1,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1253556057/reactions"
      },
      "updated_at" : "2022-09-21T11:14:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1253556057",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "rebased, conflicts solved.",
      "created_at" : "2022-09-21T13:14:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#issuecomment-1253694259",
      "id" : 1253694259,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25685",
      "node_id" : "IC_kwDOABII585Kudsz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1253694259/reactions"
      },
      "updated_at" : "2022-09-21T13:14:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1253694259",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r976884473"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/976884473"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Even with 2000 blocks I am still able to measure a difference. It's also a lot more noticeable (and everything is a lot slower) if configured with `--enable-debug`.\r\n\r\nUsing 5000 is quite a bit faster than 10000, and the improvement is still quite noticeable without debug.",
      "commit_id" : "f22a671f095780a1e0e296aab2c4d5464d0f683f",
      "created_at" : "2022-09-21T18:54:50Z",
      "diff_hunk" : "@@ -0,0 +1,142 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <chainparams.h>\n+#include <wallet/coincontrol.h>\n+#include <consensus/merkle.h>\n+#include <kernel/chain.h>\n+#include <node/context.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/wallet.h>\n+#include <validation.h>\n+#include <wallet/spend.h>\n+#include <wallet/wallet.h>\n+\n+using wallet::CWallet;\n+using wallet::CreateMockWalletDatabase;\n+using wallet::DBErrors;\n+using wallet::WALLET_FLAG_DESCRIPTORS;\n+\n+struct TipBlock\n+{\n+    uint256 prev_block_hash;\n+    int64_t prev_block_time;\n+    int tip_height;\n+};\n+\n+TipBlock getTip(const CChainParams& params, const node::NodeContext& context)\n+{\n+    auto tip = WITH_LOCK(::cs_main, return context.chainman->ActiveTip());\n+    return (tip) ? TipBlock{tip->GetBlockHash(), tip->GetBlockTime(), tip->nHeight} :\n+           TipBlock{params.GenesisBlock().GetHash(), params.GenesisBlock().GetBlockTime(), 0};\n+}\n+\n+void generateFakeBlock(const CChainParams& params,\n+                       const node::NodeContext& context,\n+                       CWallet& wallet,\n+                       const CScript& coinbase_out_script)\n+{\n+    TipBlock tip{getTip(params, context)};\n+\n+    // Create block\n+    CBlock block;\n+    CMutableTransaction coinbase_tx;\n+    coinbase_tx.vin.resize(1);\n+    coinbase_tx.vin[0].prevout.SetNull();\n+    coinbase_tx.vout.resize(2);\n+    coinbase_tx.vout[0].scriptPubKey = coinbase_out_script;\n+    coinbase_tx.vout[0].nValue = 49 * COIN;\n+    coinbase_tx.vin[0].scriptSig = CScript() << ++tip.tip_height << OP_0;\n+    coinbase_tx.vout[1].scriptPubKey = coinbase_out_script; // extra output\n+    coinbase_tx.vout[1].nValue = 1 * COIN;\n+    block.vtx = {MakeTransactionRef(std::move(coinbase_tx))};\n+\n+    block.nVersion = VERSIONBITS_LAST_OLD_BLOCK_VERSION;\n+    block.hashPrevBlock = tip.prev_block_hash;\n+    block.hashMerkleRoot = BlockMerkleRoot(block);\n+    block.nTime = ++tip.prev_block_time;\n+    block.nBits = params.GenesisBlock().nBits;\n+    block.nNonce = 0;\n+\n+    {\n+        LOCK(::cs_main);\n+        // Add it to the index\n+        CBlockIndex* pindex{context.chainman->m_blockman.AddToBlockIndex(block, context.chainman->m_best_header)};\n+        // add it to the chain\n+        context.chainman->ActiveChain().SetTip(*pindex);\n+    }\n+\n+    // notify wallet\n+    const auto& pindex = WITH_LOCK(::cs_main, return context.chainman->ActiveChain().Tip());\n+    wallet.blockConnected(kernel::MakeBlockInfo(pindex, &block));\n+}\n+\n+struct PreSelectInputs {\n+    // How many coins from the wallet the process should select\n+    int num_of_internal_inputs;\n+    // future: this could have external inputs as well.\n+};\n+\n+static void WalletCreateTx(benchmark::Bench& bench, const OutputType output_type, bool allow_other_inputs, std::optional<PreSelectInputs> preset_inputs)\n+{\n+    const auto test_setup = MakeNoLogFileContext<const TestingSetup>();\n+\n+    CWallet wallet{test_setup->m_node.chain.get(), \"\", gArgs, CreateMockWalletDatabase()};\n+    {\n+        LOCK(wallet.cs_wallet);\n+        wallet.SetWalletFlag(WALLET_FLAG_DESCRIPTORS);\n+        wallet.SetupDescriptorScriptPubKeyMans();\n+        if (wallet.LoadWallet() != DBErrors::LOAD_OK) assert(false);\n+    }\n+\n+    // Generate destinations\n+    CScript dest = GetScriptForDestination(getNewDestination(wallet, output_type));\n+\n+    // Generate chain; each coinbase will have two outputs to fill-up the wallet\n+    const auto& params = Params();\n+    unsigned int chain_size = 150000; // 150k blocks means 300k UTXO for the wallet (minus 200 due COINBASE_MATURITY)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r976884473",
      "id" : 976884473,
      "in_reply_to_id" : 973264234,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5846OhL5",
      "original_commit_id" : "2d9ea15fe9773c3efe349579413b4a4e56c30454",
      "original_line" : 99,
      "original_position" : 99,
      "original_start_line" : null,
      "path" : "src/bench/wallet_create_tx.cpp",
      "position" : null,
      "pull_request_review_id" : 1115945646,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/976884473/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-21T18:56:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/976884473",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r977063795"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/977063795"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Interesting, that is why we have been seeing different pictures of this. Without the debug mode, the difference that have been seeing locally is almost imperceptible with 2k (less than 100 ns).\r\nThat also explains why the CI was timing out before, benchmarks there are running on debug mode too.",
      "commit_id" : "044953de5905d722fe07d0fb529125574bdb4902",
      "created_at" : "2022-09-21T23:33:59Z",
      "diff_hunk" : "@@ -0,0 +1,142 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <chainparams.h>\n+#include <wallet/coincontrol.h>\n+#include <consensus/merkle.h>\n+#include <kernel/chain.h>\n+#include <node/context.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/wallet.h>\n+#include <validation.h>\n+#include <wallet/spend.h>\n+#include <wallet/wallet.h>\n+\n+using wallet::CWallet;\n+using wallet::CreateMockWalletDatabase;\n+using wallet::DBErrors;\n+using wallet::WALLET_FLAG_DESCRIPTORS;\n+\n+struct TipBlock\n+{\n+    uint256 prev_block_hash;\n+    int64_t prev_block_time;\n+    int tip_height;\n+};\n+\n+TipBlock getTip(const CChainParams& params, const node::NodeContext& context)\n+{\n+    auto tip = WITH_LOCK(::cs_main, return context.chainman->ActiveTip());\n+    return (tip) ? TipBlock{tip->GetBlockHash(), tip->GetBlockTime(), tip->nHeight} :\n+           TipBlock{params.GenesisBlock().GetHash(), params.GenesisBlock().GetBlockTime(), 0};\n+}\n+\n+void generateFakeBlock(const CChainParams& params,\n+                       const node::NodeContext& context,\n+                       CWallet& wallet,\n+                       const CScript& coinbase_out_script)\n+{\n+    TipBlock tip{getTip(params, context)};\n+\n+    // Create block\n+    CBlock block;\n+    CMutableTransaction coinbase_tx;\n+    coinbase_tx.vin.resize(1);\n+    coinbase_tx.vin[0].prevout.SetNull();\n+    coinbase_tx.vout.resize(2);\n+    coinbase_tx.vout[0].scriptPubKey = coinbase_out_script;\n+    coinbase_tx.vout[0].nValue = 49 * COIN;\n+    coinbase_tx.vin[0].scriptSig = CScript() << ++tip.tip_height << OP_0;\n+    coinbase_tx.vout[1].scriptPubKey = coinbase_out_script; // extra output\n+    coinbase_tx.vout[1].nValue = 1 * COIN;\n+    block.vtx = {MakeTransactionRef(std::move(coinbase_tx))};\n+\n+    block.nVersion = VERSIONBITS_LAST_OLD_BLOCK_VERSION;\n+    block.hashPrevBlock = tip.prev_block_hash;\n+    block.hashMerkleRoot = BlockMerkleRoot(block);\n+    block.nTime = ++tip.prev_block_time;\n+    block.nBits = params.GenesisBlock().nBits;\n+    block.nNonce = 0;\n+\n+    {\n+        LOCK(::cs_main);\n+        // Add it to the index\n+        CBlockIndex* pindex{context.chainman->m_blockman.AddToBlockIndex(block, context.chainman->m_best_header)};\n+        // add it to the chain\n+        context.chainman->ActiveChain().SetTip(*pindex);\n+    }\n+\n+    // notify wallet\n+    const auto& pindex = WITH_LOCK(::cs_main, return context.chainman->ActiveChain().Tip());\n+    wallet.blockConnected(kernel::MakeBlockInfo(pindex, &block));\n+}\n+\n+struct PreSelectInputs {\n+    // How many coins from the wallet the process should select\n+    int num_of_internal_inputs;\n+    // future: this could have external inputs as well.\n+};\n+\n+static void WalletCreateTx(benchmark::Bench& bench, const OutputType output_type, bool allow_other_inputs, std::optional<PreSelectInputs> preset_inputs)\n+{\n+    const auto test_setup = MakeNoLogFileContext<const TestingSetup>();\n+\n+    CWallet wallet{test_setup->m_node.chain.get(), \"\", gArgs, CreateMockWalletDatabase()};\n+    {\n+        LOCK(wallet.cs_wallet);\n+        wallet.SetWalletFlag(WALLET_FLAG_DESCRIPTORS);\n+        wallet.SetupDescriptorScriptPubKeyMans();\n+        if (wallet.LoadWallet() != DBErrors::LOAD_OK) assert(false);\n+    }\n+\n+    // Generate destinations\n+    CScript dest = GetScriptForDestination(getNewDestination(wallet, output_type));\n+\n+    // Generate chain; each coinbase will have two outputs to fill-up the wallet\n+    const auto& params = Params();\n+    unsigned int chain_size = 150000; // 150k blocks means 300k UTXO for the wallet (minus 200 due COINBASE_MATURITY)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r977063795",
      "id" : 977063795,
      "in_reply_to_id" : 973264234,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5846PM9z",
      "original_commit_id" : "2d9ea15fe9773c3efe349579413b4a4e56c30454",
      "original_line" : 99,
      "original_position" : 99,
      "original_start_line" : null,
      "path" : "src/bench/wallet_create_tx.cpp",
      "position" : null,
      "pull_request_review_id" : 1116197111,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/977063795/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-21T23:34:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/977063795",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated per feedback.\r\nOnly changed the benchmark chain size, from 10k to 5k. Tiny [diff](https://github.com/bitcoin/bitcoin/compare/f22a671f095780a1e0e296aab2c4d5464d0f683f..044953de5905d722fe07d0fb529125574bdb4902).",
      "created_at" : "2022-09-21T23:40:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#issuecomment-1254339371",
      "id" : 1254339371,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25685",
      "node_id" : "IC_kwDOABII585Kw7Mr",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1254339371/reactions"
      },
      "updated_at" : "2022-09-21T23:40:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1254339371",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-10-04T09:47:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#issuecomment-1266686380",
      "id" : 1266686380,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25685",
      "node_id" : "IC_kwDOABII585LgBms",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1266686380/reactions"
      },
      "updated_at" : "2022-10-04T09:47:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1266686380",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased after #26203 merge.\r\n\r\nPlus, to be clear over https://github.com/bitcoin/bitcoin/pull/26203#pullrequestreview-1128801074, have decoupled what previously was in aa5fdbad in two commits: 71f5817 and 8326d17.\r\n\r\nReady to go.",
      "created_at" : "2022-10-05T00:00:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#issuecomment-1267743723",
      "id" : 1267743723,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25685",
      "node_id" : "IC_kwDOABII585LkDvr",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1267743723/reactions"
      },
      "updated_at" : "2022-10-05T00:00:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1267743723",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2022-10-05T23:58:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#issuecomment-1269122641",
      "id" : 1269122641,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25685",
      "node_id" : "IC_kwDOABII585LpUZR",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1269122641/reactions"
      },
      "updated_at" : "2022-10-05T23:58:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1269122641",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r989230651"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/989230651"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in d54606dad097ac050dfdd1c820e3d7172b036146\r\nIMO this boolean logic:\r\n```cpp\r\n    // If automatic coin selection was disabled or if we already covered the\r\n    // target with the preset inputs: try to return the result right away\r\n    if (!coin_control.m_allow_other_inputs && selection_target > 0) return std::nullopt;\r\n\r\n    if (selection_target <= 0) {\r\n        SelectionResult result(nTargetValue, SelectionAlgorithm::MANUAL);\r\n        result.AddInputs(pre_set_inputs.coins, coin_selection_params.m_subtract_fee_outputs);\r\n        result.ComputeAndSetWaste(coin_selection_params.min_viable_change, coin_selection_params.m_cost_of_change, coin_selection_params.m_change_fee);\r\n        return result;\r\n    }\r\n```\r\nis easier to understand than this one:\r\n```cpp\r\n    // If automatic coin selection was disabled or if we already covered the\r\n    // target with the preset inputs: try to return the result right away\r\n    if (!coin_control.m_allow_other_inputs || selection_target <= 0) {\r\n        // 'selection_target' is computed on `PreSelectedInputs::Insert` which decides whether to use the effective value\r\n        // or the raw output value based on the 'subtract_fee_outputs' flag.\r\n        if (selection_target > 0) return std::nullopt; // fails only if 'allow_other_inputs=false'\r\n        SelectionResult result(nTargetValue, SelectionAlgorithm::MANUAL);\r\n        result.AddInputs(pre_set_inputs.coins, coin_selection_params.m_subtract_fee_outputs);\r\n        result.ComputeAndSetWaste(coin_selection_params.min_viable_change, coin_selection_params.m_cost_of_change, coin_selection_params.m_change_fee);\r\n        return result;\r\n    }\r\n```",
      "commit_id" : "176969420e94e720cd9c4ee94520db923bc3204e",
      "created_at" : "2022-10-06T16:01:27Z",
      "diff_hunk" : "@@ -575,11 +575,12 @@ std::optional<SelectionResult> SelectCoins(const CWallet& wallet, CoinsResult& a\n     // Deduct preset inputs amount from the search target\n     CAmount selection_target = nTargetValue - pre_set_inputs.total_amount;\n \n-    // If automatic coin selection was disabled, we just want to return the preset inputs result\n-    if (!coin_control.m_allow_other_inputs) {\n+    // If automatic coin selection was disabled or if we already covered the\n+    // target with the preset inputs: try to return the result right away\n+    if (!coin_control.m_allow_other_inputs || selection_target <= 0) {\n         // 'selection_target' is computed on `PreSelectedInputs::Insert` which decides whether to use the effective value\n         // or the raw output value based on the 'subtract_fee_outputs' flag.\n-        if (selection_target > 0) return std::nullopt;\n+        if (selection_target > 0) return std::nullopt; // fails only if 'allow_other_inputs=false'\n         SelectionResult result(nTargetValue, SelectionAlgorithm::MANUAL);\n         result.AddInputs(pre_set_inputs.coins, coin_selection_params.m_subtract_fee_outputs);\n         result.ComputeAndSetWaste(coin_selection_params.min_viable_change, coin_selection_params.m_cost_of_change, coin_selection_params.m_change_fee);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r989230651",
      "id" : 989230651,
      "line" : 586,
      "node_id" : "PRRC_kwDOABII58469nY7",
      "original_commit_id" : "d54606dad097ac050dfdd1c820e3d7172b036146",
      "original_line" : 586,
      "original_position" : 15,
      "original_start_line" : 578,
      "path" : "src/wallet/spend.cpp",
      "position" : 15,
      "pull_request_review_id" : 1133274033,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/989230651/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-10-06T16:06:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/989230651",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r989467217"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/989467217"
         }
      },
      "author_association" : "MEMBER",
      "body" : "yeah, better.",
      "commit_id" : "1c137b577130b9669db9a7b167f44f6304f7df42",
      "created_at" : "2022-10-06T20:44:26Z",
      "diff_hunk" : "@@ -575,11 +575,12 @@ std::optional<SelectionResult> SelectCoins(const CWallet& wallet, CoinsResult& a\n     // Deduct preset inputs amount from the search target\n     CAmount selection_target = nTargetValue - pre_set_inputs.total_amount;\n \n-    // If automatic coin selection was disabled, we just want to return the preset inputs result\n-    if (!coin_control.m_allow_other_inputs) {\n+    // If automatic coin selection was disabled or if we already covered the\n+    // target with the preset inputs: try to return the result right away\n+    if (!coin_control.m_allow_other_inputs || selection_target <= 0) {\n         // 'selection_target' is computed on `PreSelectedInputs::Insert` which decides whether to use the effective value\n         // or the raw output value based on the 'subtract_fee_outputs' flag.\n-        if (selection_target > 0) return std::nullopt;\n+        if (selection_target > 0) return std::nullopt; // fails only if 'allow_other_inputs=false'\n         SelectionResult result(nTargetValue, SelectionAlgorithm::MANUAL);\n         result.AddInputs(pre_set_inputs.coins, coin_selection_params.m_subtract_fee_outputs);\n         result.ComputeAndSetWaste(coin_selection_params.min_viable_change, coin_selection_params.m_cost_of_change, coin_selection_params.m_change_fee);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r989467217",
      "id" : 989467217,
      "in_reply_to_id" : 989230651,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5846-hJR",
      "original_commit_id" : "d54606dad097ac050dfdd1c820e3d7172b036146",
      "original_line" : 585,
      "original_position" : 15,
      "original_start_line" : 578,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 1133616536,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/989467217/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-10-06T20:44:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/989467217",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks @aureleoules, feedback applied.\r\n\r\nSimplified the `SelectCoins` early return logic. Small [diff](https://github.com/bitcoin/bitcoin/compare/176969420e94e720cd9c4ee94520db923bc3204e..1c137b577130b9669db9a7b167f44f6304f7df42).",
      "created_at" : "2022-10-06T20:57:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#issuecomment-1270689822",
      "id" : 1270689822,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25685",
      "node_id" : "IC_kwDOABII585LvTAe",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1270689822/reactions"
      },
      "updated_at" : "2022-10-06T20:57:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1270689822",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased after #26158 merge.\r\n\r\nOnly diff is inside the benchmarks, where both of them were marked as `low` priority to not run them in `make check`.\r\n\r\nReady for another review round.",
      "created_at" : "2022-10-20T20:14:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#issuecomment-1286089436",
      "id" : 1286089436,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25685",
      "node_id" : "IC_kwDOABII585MqCrc",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1286089436/reactions"
      },
      "updated_at" : "2022-10-20T20:14:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1286089436",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 5bea640cfb29a7d4e2edaa2a24c0457dbda41b0a",
      "created_at" : "2022-10-25T23:03:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#issuecomment-1291229049",
      "id" : 1291229049,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25685",
      "node_id" : "IC_kwDOABII585M9pd5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1291229049/reactions"
      },
      "updated_at" : "2022-10-25T23:03:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1291229049",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r1005288935"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005288935"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: Can we just use `SelectionResult` here? All we do we preset input is just copy them to `SelectionResult` anyway. ",
      "commit_id" : "5bea640cfb29a7d4e2edaa2a24c0457dbda41b0a",
      "created_at" : "2022-10-26T06:55:39Z",
      "diff_hunk" : "@@ -121,6 +121,26 @@ std::optional<SelectionResult> AttemptSelection(const CWallet& wallet, const CAm\n std::optional<SelectionResult> ChooseSelectionResult(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, const std::vector<COutput>& available_coins,\n                         const CoinSelectionParams& coin_selection_params);\n \n+// User manually selected inputs that must be part of the transaction\n+struct PreSelectedInputs",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r1005288935",
      "id" : 1005288935,
      "line" : 125,
      "node_id" : "PRRC_kwDOABII5847633n",
      "original_commit_id" : "a67d26509db982e7ad49431fdb90a0a8728b97b5",
      "original_line" : 125,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/spend.h",
      "position" : 5,
      "pull_request_review_id" : 1155953166,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005288935/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T07:35:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005288935",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r1005293825"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005293825"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: I'd suggest to create `SelectionResult` for preselected inputs unconditionally. This way use can reuse it later when you need to merge it with automatic coin selection.",
      "commit_id" : "5bea640cfb29a7d4e2edaa2a24c0457dbda41b0a",
      "created_at" : "2022-10-26T07:02:18Z",
      "diff_hunk" : "@@ -575,11 +575,11 @@ std::optional<SelectionResult> SelectCoins(const CWallet& wallet, CoinsResult& a\n     // Deduct preset inputs amount from the search target\n     CAmount selection_target = nTargetValue - pre_set_inputs.total_amount;\n \n-    // If automatic coin selection was disabled, we just want to return the preset inputs result\n-    if (!coin_control.m_allow_other_inputs) {\n-        // 'selection_target' is computed on `PreSelectedInputs::Insert` which decides whether to use the effective value\n-        // or the raw output value based on the 'subtract_fee_outputs' flag.\n-        if (selection_target > 0) return std::nullopt;\n+    // Return if automatic coin selection is disabled, and we don't cover the selection target\n+    if (!coin_control.m_allow_other_inputs && selection_target > 0) return std::nullopt;\n+\n+    // Return if we can cover the target only with the preset inputs\n+    if (selection_target <= 0) {\n         SelectionResult result(nTargetValue, SelectionAlgorithm::MANUAL);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r1005293825",
      "id" : 1005293825,
      "line" : 583,
      "node_id" : "PRRC_kwDOABII584765EB",
      "original_commit_id" : "36707c81372fd613689ed0ea70a147e351561239",
      "original_line" : 583,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 14,
      "pull_request_review_id" : 1155953166,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005293825/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T07:35:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005293825",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r1005294598"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005294598"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: I'd say we need to recalculate waste after adding preselected inputs because otherwise wronge waste score would be passed to USDT",
      "commit_id" : "5bea640cfb29a7d4e2edaa2a24c0457dbda41b0a",
      "created_at" : "2022-10-26T07:03:22Z",
      "diff_hunk" : "@@ -594,9 +594,6 @@ std::optional<SelectionResult> SelectCoins(const CWallet& wallet, CoinsResult& a\n     SelectionResult preselected(pre_set_inputs.total_amount, SelectionAlgorithm::MANUAL);\n     preselected.AddInputs(pre_set_inputs.coins, coin_selection_params.m_subtract_fee_outputs);\n     op_selection_result->Merge(preselected);\n-    if (op_selection_result->GetAlgo() == SelectionAlgorithm::MANUAL) {\n-        op_selection_result->ComputeAndSetWaste(coin_selection_params.min_viable_change, coin_selection_params.m_cost_of_change, coin_selection_params.m_change_fee);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r1005294598",
      "id" : 1005294598,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584765QG",
      "original_commit_id" : "36707c81372fd613689ed0ea70a147e351561239",
      "original_line" : 598,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 22,
      "pull_request_review_id" : 1155953166,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005294598/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T07:35:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005294598",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r1005954007"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005954007"
         }
      },
      "author_association" : "MEMBER",
      "body" : "We actually had this convo at the beginning of the PR (https://github.com/bitcoin/bitcoin/pull/25685#discussion_r938067217).\r\n\r\nI implemented it two/three months ago and the end result wasn't so satisfactory.\r\n\r\nIf my memory doesnât fail me, the reasons were:\r\n\r\n1. We would be mixing responsibilities if we do that. The `SelectionResult` class is particular to the coin selection process (in the future, it might even be decoupled into a separated library) and `FetchSelectedInputs` is a wallet method that we use to obtain a set of outputs (similar to `AvailableCoins` but instead of traversing the whole wallet tx map, it fetches the specific outputs directly), which could be used in different contexts and not only inside the tx creation process (places where the `SelectionResult` class wouldn't make much sense).\r\n\r\n2. The `SelectionResult` constructor requires a target, which we donât have up until we fetch and sum-up all the manually selected outputs. So, we would end up doing the same that we do inside `SelectCoins` but inside `FetchSelectedInputs`: (1) first fetch and store all the outputs in a vector, then at the end of the method, create a `SelectionResult` with the accurate target and return it (so there would really be no difference with the current approach unless we add another constructor and a new `AddInput` method inside `SelectionResult` that keeps track of target etc or.. pass the tx target to `FetchSelectedInputs` which I think that is ugly as the tx target has nothing to do with a fetching-only function).â¨\r\n3. Plus, the new struct caches the total amount and contemplates the effective/raw amount distinction. Which, for example, made #26203 issue a non-issue here.\r\n.\r\n\r\nWith this Iâm not saying that we should marry to this struct (we could also use `CoinsResult` instead) but I donât think that changing it to `SelectionResult` will make the code better (at least for now). It would probably just continue entangling the coin selection code inside wallet general functions that we should be able to re-use in other processes.\r\n\r\nPlus, after the next PR in the line #25806, I think that this process will be in a much better shape to re-do this convo once more. Mainly because the coin selection process will not be so attached to the wallet internals. So, we might be able to decouple it into a different module or an external library.",
      "commit_id" : "3fcb545ab26be3e785b5e5654be0bdc77099d827",
      "created_at" : "2022-10-26T17:03:32Z",
      "diff_hunk" : "@@ -121,6 +121,26 @@ std::optional<SelectionResult> AttemptSelection(const CWallet& wallet, const CAm\n std::optional<SelectionResult> ChooseSelectionResult(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, const std::vector<COutput>& available_coins,\n                         const CoinSelectionParams& coin_selection_params);\n \n+// User manually selected inputs that must be part of the transaction\n+struct PreSelectedInputs",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r1005954007",
      "id" : 1005954007,
      "in_reply_to_id" : 1005288935,
      "line" : 125,
      "node_id" : "PRRC_kwDOABII58479aPX",
      "original_commit_id" : "a67d26509db982e7ad49431fdb90a0a8728b97b5",
      "original_line" : 125,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/spend.h",
      "position" : 5,
      "pull_request_review_id" : 1156963474,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005954007/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T17:03:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005954007",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r1005955681"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005955681"
         }
      },
      "author_association" : "MEMBER",
      "body" : "funny that I mentioned this here https://github.com/bitcoin/bitcoin/pull/25685#discussion_r938067217 (last sentence) almost 3 months ago.\r\n\r\nWill re-check it.",
      "commit_id" : "3fcb545ab26be3e785b5e5654be0bdc77099d827",
      "created_at" : "2022-10-26T17:05:05Z",
      "diff_hunk" : "@@ -594,9 +594,6 @@ std::optional<SelectionResult> SelectCoins(const CWallet& wallet, CoinsResult& a\n     SelectionResult preselected(pre_set_inputs.total_amount, SelectionAlgorithm::MANUAL);\n     preselected.AddInputs(pre_set_inputs.coins, coin_selection_params.m_subtract_fee_outputs);\n     op_selection_result->Merge(preselected);\n-    if (op_selection_result->GetAlgo() == SelectionAlgorithm::MANUAL) {\n-        op_selection_result->ComputeAndSetWaste(coin_selection_params.min_viable_change, coin_selection_params.m_cost_of_change, coin_selection_params.m_change_fee);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r1005955681",
      "id" : 1005955681,
      "in_reply_to_id" : 1005294598,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58479aph",
      "original_commit_id" : "36707c81372fd613689ed0ea70a147e351561239",
      "original_line" : 598,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 1156965517,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005955681/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T17:05:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005955681",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I'm a bit late to the party.\r\n\r\nIt's never late if you come with beers and/or food.\r\n\r\n",
      "created_at" : "2022-10-26T17:07:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#issuecomment-1292348271",
      "id" : 1292348271,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25685",
      "node_id" : "IC_kwDOABII585NB6tv",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 2,
         "rocket" : 0,
         "total_count" : 2,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1292348271/reactions"
      },
      "updated_at" : "2022-10-26T17:07:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1292348271",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r1006060231"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1006060231"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I thought about it but It's not that straightforward. The `SelectionResult` target is provided on the constructor and then only modified by the `Merge` function (which adds the merged selection target to the base one).\r\n\r\nSo, it's not clear with which target the selection result should be initialized:\r\n\r\n1) If the preset inputs cover the target amount, then it needs to be initialized to the target amount, not to the preset inputs total amount. So the selection result can be returned early.\r\n\r\n2) If the preset inputs don't cover the target amount, then it needs to be initialized to the preset inputs total amount, because we need to cover the total amount when we merge it with the `SelectionResult` that comes from `AutomaticCoinSelection` (which contains a selection for the target amount minus the preset inputs total).",
      "commit_id" : "3fcb545ab26be3e785b5e5654be0bdc77099d827",
      "created_at" : "2022-10-26T18:40:40Z",
      "diff_hunk" : "@@ -575,11 +575,11 @@ std::optional<SelectionResult> SelectCoins(const CWallet& wallet, CoinsResult& a\n     // Deduct preset inputs amount from the search target\n     CAmount selection_target = nTargetValue - pre_set_inputs.total_amount;\n \n-    // If automatic coin selection was disabled, we just want to return the preset inputs result\n-    if (!coin_control.m_allow_other_inputs) {\n-        // 'selection_target' is computed on `PreSelectedInputs::Insert` which decides whether to use the effective value\n-        // or the raw output value based on the 'subtract_fee_outputs' flag.\n-        if (selection_target > 0) return std::nullopt;\n+    // Return if automatic coin selection is disabled, and we don't cover the selection target\n+    if (!coin_control.m_allow_other_inputs && selection_target > 0) return std::nullopt;\n+\n+    // Return if we can cover the target only with the preset inputs\n+    if (selection_target <= 0) {\n         SelectionResult result(nTargetValue, SelectionAlgorithm::MANUAL);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r1006060231",
      "id" : 1006060231,
      "in_reply_to_id" : 1005293825,
      "line" : 583,
      "node_id" : "PRRC_kwDOABII584790LH",
      "original_commit_id" : "36707c81372fd613689ed0ea70a147e351561239",
      "original_line" : 583,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 133,
      "pull_request_review_id" : 1157102842,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1006060231/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T18:40:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1006060231",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r1006076773"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1006076773"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Pushed. Squashed inside a8a75346. Thanks",
      "commit_id" : "3fcb545ab26be3e785b5e5654be0bdc77099d827",
      "created_at" : "2022-10-26T18:56:27Z",
      "diff_hunk" : "@@ -594,9 +594,6 @@ std::optional<SelectionResult> SelectCoins(const CWallet& wallet, CoinsResult& a\n     SelectionResult preselected(pre_set_inputs.total_amount, SelectionAlgorithm::MANUAL);\n     preselected.AddInputs(pre_set_inputs.coins, coin_selection_params.m_subtract_fee_outputs);\n     op_selection_result->Merge(preselected);\n-    if (op_selection_result->GetAlgo() == SelectionAlgorithm::MANUAL) {\n-        op_selection_result->ComputeAndSetWaste(coin_selection_params.min_viable_change, coin_selection_params.m_cost_of_change, coin_selection_params.m_change_fee);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r1006076773",
      "id" : 1006076773,
      "in_reply_to_id" : 1005294598,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584794Nl",
      "original_commit_id" : "36707c81372fd613689ed0ea70a147e351561239",
      "original_line" : 598,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 1157123145,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1006076773/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T18:56:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1006076773",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Updated per @S3RK feedback, thanks.\r\n\r\nOnly change is the `ComputeAndSetWaste` call after the merge of the two selection results (preset and automatic selection results). So the waste score is properly calculated for the USDT logging. Small [diff](https://github.com/bitcoin/bitcoin/compare/5bea640cfb29a7d4e2edaa2a24c0457dbda41b0a..3fcb545ab26be3e785b5e5654be0bdc77099d827)",
      "created_at" : "2022-10-26T18:58:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#issuecomment-1292475834",
      "id" : 1292475834,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25685",
      "node_id" : "IC_kwDOABII585NCZ26",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1292475834/reactions"
      },
      "updated_at" : "2022-10-26T18:58:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1292475834",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r1006081208"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1006081208"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yap, agreed.",
      "commit_id" : "3fcb545ab26be3e785b5e5654be0bdc77099d827",
      "created_at" : "2022-10-26T19:01:45Z",
      "diff_hunk" : "@@ -575,11 +575,11 @@ std::optional<SelectionResult> SelectCoins(const CWallet& wallet, CoinsResult& a\n     // Deduct preset inputs amount from the search target\n     CAmount selection_target = nTargetValue - pre_set_inputs.total_amount;\n \n-    // If automatic coin selection was disabled, we just want to return the preset inputs result\n-    if (!coin_control.m_allow_other_inputs) {\n-        // 'selection_target' is computed on `PreSelectedInputs::Insert` which decides whether to use the effective value\n-        // or the raw output value based on the 'subtract_fee_outputs' flag.\n-        if (selection_target > 0) return std::nullopt;\n+    // Return if automatic coin selection is disabled, and we don't cover the selection target\n+    if (!coin_control.m_allow_other_inputs && selection_target > 0) return std::nullopt;\n+\n+    // Return if we can cover the target only with the preset inputs\n+    if (selection_target <= 0) {\n         SelectionResult result(nTargetValue, SelectionAlgorithm::MANUAL);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#discussion_r1006081208",
      "id" : 1006081208,
      "in_reply_to_id" : 1005293825,
      "line" : 583,
      "node_id" : "PRRC_kwDOABII584795S4",
      "original_commit_id" : "36707c81372fd613689ed0ea70a147e351561239",
      "original_line" : 583,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 133,
      "pull_request_review_id" : 1157130006,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25685",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1006081208/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T19:01:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1006081208",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Code Review ACK 3fcb545ab26be3e785b5e5654be0bdc77099d827",
      "created_at" : "2022-10-27T07:26:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#issuecomment-1293106341",
      "id" : 1293106341,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25685",
      "node_id" : "IC_kwDOABII585NEzyl",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1293106341/reactions"
      },
      "updated_at" : "2022-10-27T07:26:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1293106341",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 3fcb545ab26be3e785b5e5654be0bdc77099d827",
      "created_at" : "2022-10-27T21:48:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25685#issuecomment-1294113841",
      "id" : 1294113841,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25685",
      "node_id" : "IC_kwDOABII585NIpwx",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1294113841/reactions"
      },
      "updated_at" : "2022-10-27T21:48:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1294113841",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   }
]
