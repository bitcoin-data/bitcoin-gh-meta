[
   {
      "author_association" : "NONE",
      "body" : "à¸à¸¥à¹à¸­à¸à¸à¸¡à¹à¸à¸à¹à¸®à¸à¸«à¹à¸²à¸¡à¹à¸­bità¸­à¸­à¸à¸à¸£à¸±à¸",
      "created_at" : "2021-10-17T16:19:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/23297#issuecomment-945153009",
      "id" : 945153009,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23297",
      "node_id" : "IC_kwDOABII5844VePx",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/945153009/reactions"
      },
      "updated_at" : "2021-10-17T16:20:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/945153009",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/92610699?v=4",
         "events_url" : "https://api.github.com/users/MooCricket/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MooCricket/followers",
         "following_url" : "https://api.github.com/users/MooCricket/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MooCricket/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MooCricket",
         "id" : 92610699,
         "login" : "MooCricket",
         "node_id" : "U_kgDOBYUgiw",
         "organizations_url" : "https://api.github.com/users/MooCricket/orgs",
         "received_events_url" : "https://api.github.com/users/MooCricket/received_events",
         "repos_url" : "https://api.github.com/users/MooCricket/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MooCricket/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MooCricket/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MooCricket"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> There is a slight chance that the GUIX build on the current master already includes the tracepoints. I have not done an GUIX build on a branch with the tracepoints merged yet. This can be tested on a `bitcoind` binary using one of the methods mentioned in the [tracing documentation section \"Listing avaliable tracepoints\"](https://github.com/bitcoin/bitcoin/blob/master/doc/tracing.md#listing-available-tracepoints).\r\n\r\nA GUIX build on 76392b042e98 didn't include the tracepoints. The systemtap headers need to be added.\r\n",
      "created_at" : "2021-11-26T10:46:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/23297#issuecomment-979874121",
      "id" : 979874121,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23297",
      "node_id" : "IC_kwDOABII5846Z7FJ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/979874121/reactions"
      },
      "updated_at" : "2021-11-26T10:46:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/979874121",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I've been exploring this a bit more. Currently two approaches, non of them really great. \r\n\r\n- a) Package the systemtap `sys/sdt.h` header as GUIX package in [manifest.scm](https://github.com/bitcoin/bitcoin/blob/master/contrib/guix/manifest.scm) and make it available as _include_ during configure and build.\r\n  - See GUIX package definition below.\r\n  - While the package is available during configure and build, the header includes not are picked up automatically. Likely, an additional include needs to be set. \r\n- b) Include systemtap as package in `depends`\r\n  - We don't need systemtap. We only need the `sys/sdt.h` header file.\r\n  - depends are usually compiled, we don't want and need to compile systemtap here.\r\n\r\n```patch\r\ndiff --git a/contrib/guix/manifest.scm b/contrib/guix/manifest.scm\r\nindex 580500605..3f4814ba3 100644\r\n--- a/contrib/guix/manifest.scm\r\n+++ b/contrib/guix/manifest.scm\r\n@@ -30,6 +30,7 @@\r\n              (gnu packages shells)\r\n              (gnu packages tls)\r\n              (gnu packages version-control)\r\n+             (guix build-system copy)\r\n              (guix build-system font)\r\n              (guix build-system gnu)\r\n              (guix build-system python)\r\n@@ -597,6 +598,27 @@ inspecting signatures in Mach-O binaries.\")\r\n   (package-with-extra-patches glibc-2.27\r\n     (search-our-patches \"glibc-2.27-riscv64-Use-__has_include__-to-include-asm-syscalls.h.patch\")))\r\n\r\n+(define-public systemtap-sdt\r\n+  (package\r\n+    (name \"systemtap-sdt\")\r\n+    (version \"4.6\")\r\n+    (source (origin\r\n+              (method url-fetch)\r\n+              (uri (string-append \"https://sourceware.org/systemtap/ftp/releases/systemtap-\" version\r\n+                                  \".tar.gz\"))\r\n+              (sha256\r\n+               (base32\r\n+                \"1bps2926x9m8mp2684wwwwjm4yb12mpylbnvnffk889b4c4p7yw0\"))))\r\n+    (build-system copy-build-system)\r\n+    (arguments\r\n+      '(#:install-plan\r\n+        '((\"includes/sys/sdt.h\" \"include/sys/sdt.h\"))))\r\n+    (synopsis \"Systemtap header files defining tracing probe marcos\")\r\n+    (description \"This package includes the <sys/sdt.h> header file used for static instrumentation compiled into userspace programs and libraries\")\r\n+    (home-page \"https://sourceware.org/systemtap/\")\r\n+    (license license:gpl2)))\r\n+\r\n (packages->manifest\r\n  (append\r\n   (list ;; The Basics\r\n@@ -637,7 +659,9 @@ inspecting signatures in Mach-O binaries.\")\r\n         lief\r\n         ;; Native gcc 7 toolchain\r\n         gcc-toolchain-7\r\n-        (list gcc-toolchain-7 \"static\"))\r\n+        (list gcc-toolchain-7 \"static\")\r\n+        ;; Tracing\r\n+        systemtap-sdt)\r\n   (let ((target (getenv \"HOST\")))\r\n     (cond ((string-suffix? \"-mingw32\" target)\r\n            ;; Windows\r\n```",
      "created_at" : "2021-12-03T09:04:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/23297#issuecomment-985334877",
      "id" : 985334877,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23297",
      "node_id" : "IC_kwDOABII5846uwRd",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/985334877/reactions"
      },
      "updated_at" : "2021-12-03T09:11:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/985334877",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Seems to be possible with option b) too. The configure/build/postprocess steps in the depends are optional and normal shell commands can be used. I haven't figured out where to copy the `includes/sys/sdt.h` file from systemtap so that it makes it into `depends/x86_64-linux-gnu/include/`. \r\n\r\nI think option b) is cleaner than option a).",
      "created_at" : "2021-12-05T19:17:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/23297#issuecomment-986285049",
      "id" : 986285049,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23297",
      "node_id" : "IC_kwDOABII5846yYP5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/986285049/reactions"
      },
      "updated_at" : "2021-12-05T19:17:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/986285049",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@fanquake helped getting the includes copied. In this case it was: (note the `&& \\` as only the first command has the correct ENV var set)\r\n\r\n``` Makefile\r\ndefine $(package)_preprocess_cmds\r\n  mkdir -p $($(package)_staging_prefix_dir)/include/sys && \\\r\n  cp -r includes/sys $($(package)_staging_prefix_dir)/include\r\nendef\r\n```\r\n\r\nHe also commented:\r\n\r\n> One catch is that if we don't run configure and make, then we don't end up with a properly named and filled out sdt-config.h. That is included from sdt.h, and determines whether the probes can use certain assembly, see _SDT_ASM_AUTOGROUP.\r\n\r\n> Maybe this is mostly a legacy check, and we can assume that we can use it, although then we'd still have to modify the sdt.h header to drop the include and make sure _SDT_ASM_SECTION_AUTOGROUP_SUPPORT is defined ourselves.\r\n\r\n> The annoying thing about having to run configure and make is that we'll need to install a bunch of dependencies.\r\n\r\nThe relevant section from sdt.h is\r\n\r\n``` h\r\n/* If the assembler supports the necessary feature, then we can play\r\n nice with code in COMDAT sections, which comes up in C++ code.\r\n Without that assembler support, some combinations of probe placements\r\n in certain kinds of C++ code may produce link-time errors.  */\r\n#include \"sdt-config.h\"\r\n#if _SDT_ASM_SECTION_AUTOGROUP_SUPPORT\r\n# define _SDT_ASM_AUTOGROUP \"?\"\r\n#else\r\n# define _SDT_ASM_AUTOGROUP \"\"\r\n#endif\r\n```\r\n\r\nAs we don't need Systemtap itself, running configure and make would require additional dependencies and slow the depends build down. Both, the include of `sdt-config.h` in `sdt.h` and the `sdt-config.h.in` file were added and last touched in 2010 ( \r\n[blame sdt.h](https://sourceware.org/git/?p=systemtap.git;a=blame;f=includes/sys/sdt.h;h=48cb7263f325ff8094b4288249a24b65dd00ab84;hb=HEAD), [blame sdt-config.h.in](https://sourceware.org/git/?p=systemtap.git;a=blame;f=includes/sys/sdt-config.h.in;h=7a3373cca0d9d52e74c9096a9db48cc37d897c5e;hb=HEAD)), so it's likely that the feature is supported by now and it should be possible to drop the include in a patch.",
      "created_at" : "2021-12-07T17:11:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/23297#issuecomment-988116618",
      "id" : 988116618,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23297",
      "node_id" : "IC_kwDOABII58465XaK",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/988116618/reactions"
      },
      "updated_at" : "2021-12-07T17:11:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/988116618",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "gcc seems to have a problem with Systemtap 4.6 (Nov 2021). I'll be using Systemtap 4.5 (May 2021) for now. From what I can tell, this is a know problem and it should be fixed in 4.7:\r\n\r\nhttps://sourceware.org/git/?p=systemtap.git;a=commit;h=1d3653936fc1fd13135a723a27e6c7e959793ad0\r\nhttps://bugzilla.redhat.com/show_bug.cgi?id=2028798\r\n\r\n",
      "created_at" : "2021-12-07T17:25:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/23297#issuecomment-988126706",
      "id" : 988126706,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23297",
      "node_id" : "IC_kwDOABII58465Z3y",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/988126706/reactions"
      },
      "updated_at" : "2021-12-07T17:25:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/988126706",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   }
]
