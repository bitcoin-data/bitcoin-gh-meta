[
   {
      "author_association" : "MEMBER",
      "body" : "approach ACK :) ",
      "created_at" : "2021-07-25T19:07:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#issuecomment-886244568",
      "id" : 886244568,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22543",
      "node_id" : "IC_kwDOABII58400wTY",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-25T19:07:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/886244568",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2021-07-25T20:05:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#issuecomment-886251008",
      "id" : 886251008,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22543",
      "node_id" : "IC_kwDOABII58400x4A",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-25T20:05:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/886251008",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.",
      "created_at" : "2021-07-28T10:28:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#issuecomment-888200225",
      "id" : 888200225,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22543",
      "node_id" : "IC_kwDOABII58408Nwh",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-11T05:55:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/888200225",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r678248900"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/678248900"
         }
      },
      "author_association" : "MEMBER",
      "body" : "please don't commit large style changes in the same commit as refactors/features. This makes review harder because it is not clear what is a refactor/style-change/feature\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#committing-patches",
      "commit_id" : "8ac10d8e1596bd2766fc9470467aba7c0e691353",
      "created_at" : "2021-07-28T12:22:39Z",
      "diff_hunk" : "@@ -20,55 +23,65 @@ def set_test_params(self):\n         ]]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n         txouts = gen_return_txouts()\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-\n-        self.log.info('Check that mempoolminfee is minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_equal(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n-\n-        txids = []\n-        utxos = create_confirmed_utxos(relayfee, self.nodes[0], 91)\n-\n-        self.log.info('Create a mempool tx that will be evicted')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        self.nodes[0].settxfee(relayfee) # specifically fund this tx with low fee\n-        txF = self.nodes[0].fundrawtransaction(tx)\n-        self.nodes[0].settxfee(0) # return to automatic fee selection\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        txid = self.nodes[0].sendrawtransaction(txFS['hex'])\n-\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-        base_fee = relayfee*100\n-        for i in range (3):\n-            txids.append([])\n-            txids[i] = create_lots_of_big_transactions(self.nodes[0], txouts, utxos[30*i:30*i+30], 30, (i+1)*base_fee)\n-\n-        self.log.info('The tx should be evicted by now')\n-        assert txid not in self.nodes[0].getrawmempool()\n-        txdata = self.nodes[0].gettransaction(txid)\n-        assert txdata['confirmations'] ==  0  #confirmation should still be 0\n-\n-        self.log.info('Check that mempoolminfee is larger than minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_greater_than(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n-\n-        self.log.info('Create a mempool tx that will not pass mempoolminfee')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        # specifically fund this tx with a fee < mempoolminfee, >= than minrelaytxfee\n-        txF = self.nodes[0].fundrawtransaction(tx, {'feeRate': relayfee})\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        assert_raises_rpc_error(-26, \"mempool min fee not met\", self.nodes[0].sendrawtransaction, txFS['hex'])\n+\n+        node = self.nodes[0]\n+        miniwallet = MiniWallet(node)\n+        relayfee = node.getnetworkinfo()[\"relayfee\"]\n+\n+        self.log.info(\"Check that mempoolminfee is minrelaytxfee\")\n+        assert_equal(node.getmempoolinfo()[\"minrelaytxfee\"], Decimal(\"0.00001000\"))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r678248900",
      "id" : 678248900,
      "line" : 34,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3ODI0ODkwMA==",
      "original_commit_id" : "8ac10d8e1596bd2766fc9470467aba7c0e691353",
      "original_line" : 34,
      "original_position" : 73,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : 73,
      "pull_request_review_id" : 716930706,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-28T12:35:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/678248900",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2021-07-31T20:18:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#issuecomment-890399777",
      "id" : 890399777,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22543",
      "node_id" : "IC_kwDOABII5841Emwh",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-31T20:18:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/890399777",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r681830378"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/681830378"
         }
      },
      "author_association" : "NONE",
      "body" : "Thanks for the feedback, I've appended the commit with the code changes only (removed any \"only style changes\") as of now, hope this makes reviewing the PR easier now.\r\n\r\nLooking forward to your review",
      "commit_id" : "4dea1875b1c5ff4436eb3ecdf5bbd5372179b899",
      "created_at" : "2021-08-03T14:45:41Z",
      "diff_hunk" : "@@ -20,55 +23,65 @@ def set_test_params(self):\n         ]]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n         txouts = gen_return_txouts()\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-\n-        self.log.info('Check that mempoolminfee is minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_equal(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n-\n-        txids = []\n-        utxos = create_confirmed_utxos(relayfee, self.nodes[0], 91)\n-\n-        self.log.info('Create a mempool tx that will be evicted')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        self.nodes[0].settxfee(relayfee) # specifically fund this tx with low fee\n-        txF = self.nodes[0].fundrawtransaction(tx)\n-        self.nodes[0].settxfee(0) # return to automatic fee selection\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        txid = self.nodes[0].sendrawtransaction(txFS['hex'])\n-\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-        base_fee = relayfee*100\n-        for i in range (3):\n-            txids.append([])\n-            txids[i] = create_lots_of_big_transactions(self.nodes[0], txouts, utxos[30*i:30*i+30], 30, (i+1)*base_fee)\n-\n-        self.log.info('The tx should be evicted by now')\n-        assert txid not in self.nodes[0].getrawmempool()\n-        txdata = self.nodes[0].gettransaction(txid)\n-        assert txdata['confirmations'] ==  0  #confirmation should still be 0\n-\n-        self.log.info('Check that mempoolminfee is larger than minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_greater_than(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n-\n-        self.log.info('Create a mempool tx that will not pass mempoolminfee')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        # specifically fund this tx with a fee < mempoolminfee, >= than minrelaytxfee\n-        txF = self.nodes[0].fundrawtransaction(tx, {'feeRate': relayfee})\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        assert_raises_rpc_error(-26, \"mempool min fee not met\", self.nodes[0].sendrawtransaction, txFS['hex'])\n+\n+        node = self.nodes[0]\n+        miniwallet = MiniWallet(node)\n+        relayfee = node.getnetworkinfo()[\"relayfee\"]\n+\n+        self.log.info(\"Check that mempoolminfee is minrelaytxfee\")\n+        assert_equal(node.getmempoolinfo()[\"minrelaytxfee\"], Decimal(\"0.00001000\"))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r681830378",
      "id" : 681830378,
      "in_reply_to_id" : 678248900,
      "line" : 40,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4MTgzMDM3OA==",
      "original_commit_id" : "8ac10d8e1596bd2766fc9470467aba7c0e691353",
      "original_line" : 40,
      "original_position" : 73,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : 91,
      "pull_request_review_id" : 721293358,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-03T14:45:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/681830378",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/55556994?v=4",
         "events_url" : "https://api.github.com/users/ShubhamPalriwala/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ShubhamPalriwala/followers",
         "following_url" : "https://api.github.com/users/ShubhamPalriwala/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ShubhamPalriwala/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ShubhamPalriwala",
         "id" : 55556994,
         "login" : "ShubhamPalriwala",
         "node_id" : "MDQ6VXNlcjU1NTU2OTk0",
         "organizations_url" : "https://api.github.com/users/ShubhamPalriwala/orgs",
         "received_events_url" : "https://api.github.com/users/ShubhamPalriwala/received_events",
         "repos_url" : "https://api.github.com/users/ShubhamPalriwala/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ShubhamPalriwala/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ShubhamPalriwala/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ShubhamPalriwala"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2021-08-03T15:22:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#issuecomment-891938056",
      "id" : 891938056,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22543",
      "node_id" : "IC_kwDOABII5841KeUI",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-03T15:22:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/891938056",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23586626?v=4",
         "events_url" : "https://api.github.com/users/Zero-1729/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Zero-1729/followers",
         "following_url" : "https://api.github.com/users/Zero-1729/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Zero-1729/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Zero-1729",
         "id" : 23586626,
         "login" : "Zero-1729",
         "node_id" : "MDQ6VXNlcjIzNTg2NjI2",
         "organizations_url" : "https://api.github.com/users/Zero-1729/orgs",
         "received_events_url" : "https://api.github.com/users/Zero-1729/received_events",
         "repos_url" : "https://api.github.com/users/Zero-1729/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Zero-1729/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Zero-1729/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Zero-1729"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Concept ACK",
      "created_at" : "2021-08-05T18:45:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#issuecomment-893695959",
      "id" : 893695959,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22543",
      "node_id" : "IC_kwDOABII5841RLfX",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-05T18:45:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/893695959",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/58947326?v=4",
         "events_url" : "https://api.github.com/users/Shubhankar-Gambhir/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Shubhankar-Gambhir/followers",
         "following_url" : "https://api.github.com/users/Shubhankar-Gambhir/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Shubhankar-Gambhir/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Shubhankar-Gambhir",
         "id" : 58947326,
         "login" : "Shubhankar-Gambhir",
         "node_id" : "MDQ6VXNlcjU4OTQ3MzI2",
         "organizations_url" : "https://api.github.com/users/Shubhankar-Gambhir/orgs",
         "received_events_url" : "https://api.github.com/users/Shubhankar-Gambhir/received_events",
         "repos_url" : "https://api.github.com/users/Shubhankar-Gambhir/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Shubhankar-Gambhir/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Shubhankar-Gambhir/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Shubhankar-Gambhir"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-08-09T06:06:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#issuecomment-894971923",
      "id" : 894971923,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22543",
      "node_id" : "IC_kwDOABII5841WDAT",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-09T06:06:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/894971923",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r686312386"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686312386"
         }
      },
      "author_association" : "NONE",
      "body" : "Hey, any specific reason that we are not checking whether the confirmations of the original `tx` are still 0 or not. I couldn't understand looking at the PR updates, so if you could explain :)",
      "commit_id" : "dcd75d87eef701b1214699fcad79328f06801176",
      "created_at" : "2021-08-10T20:50:05Z",
      "diff_hunk" : "@@ -5,70 +5,90 @@\n \"\"\"Test mempool limiting together/eviction with the wallet.\"\"\"\n \n from decimal import Decimal\n+from test_framework.blocktools import COINBASE_MATURITY\n \n from test_framework.test_framework import BitcoinTestFramework\n-from test_framework.util import assert_equal, assert_greater_than, assert_raises_rpc_error, create_confirmed_utxos, create_lots_of_big_transactions, gen_return_txouts\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than,\n+    assert_raises_rpc_error,\n+    gen_return_txouts,\n+)\n+from test_framework.wallet import MiniWallet\n+\n \n class MempoolLimitTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.setup_clean_chain = True\n         self.num_nodes = 1\n-        self.extra_args = [[\n-            \"-acceptnonstdtxn=1\",\n-            \"-maxmempool=5\",\n-            \"-spendzeroconfchange=0\",\n-        ]]\n+        self.extra_args = [\n+            [\n+                \"-acceptnonstdtxn=1\",\n+                \"-maxmempool=5\",\n+                \"-spendzeroconfchange=0\",\n+            ]\n+        ]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n         txouts = gen_return_txouts()\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-\n-        self.log.info('Check that mempoolminfee is minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_equal(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n-\n-        txids = []\n-        utxos = create_confirmed_utxos(relayfee, self.nodes[0], 91)\n-\n-        self.log.info('Create a mempool tx that will be evicted')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        self.nodes[0].settxfee(relayfee) # specifically fund this tx with low fee\n-        txF = self.nodes[0].fundrawtransaction(tx)\n-        self.nodes[0].settxfee(0) # return to automatic fee selection\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        txid = self.nodes[0].sendrawtransaction(txFS['hex'])\n-\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-        base_fee = relayfee*100\n-        for i in range (3):\n-            txids.append([])\n-            txids[i] = create_lots_of_big_transactions(self.nodes[0], txouts, utxos[30*i:30*i+30], 30, (i+1)*base_fee)\n-\n-        self.log.info('The tx should be evicted by now')\n-        assert txid not in self.nodes[0].getrawmempool()\n-        txdata = self.nodes[0].gettransaction(txid)\n-        assert txdata['confirmations'] ==  0  #confirmation should still be 0",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r686312386",
      "id" : 686312386,
      "line" : 57,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NjMxMjM4Ng==",
      "original_commit_id" : "dcd75d87eef701b1214699fcad79328f06801176",
      "original_line" : 57,
      "original_position" : 69,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : 69,
      "pull_request_review_id" : 726833540,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-10T20:50:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686312386",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/42388668?v=4",
         "events_url" : "https://api.github.com/users/NikhilBartwal/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NikhilBartwal/followers",
         "following_url" : "https://api.github.com/users/NikhilBartwal/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NikhilBartwal/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NikhilBartwal",
         "id" : 42388668,
         "login" : "NikhilBartwal",
         "node_id" : "MDQ6VXNlcjQyMzg4NjY4",
         "organizations_url" : "https://api.github.com/users/NikhilBartwal/orgs",
         "received_events_url" : "https://api.github.com/users/NikhilBartwal/received_events",
         "repos_url" : "https://api.github.com/users/NikhilBartwal/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NikhilBartwal/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NikhilBartwal/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NikhilBartwal"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r686313503"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686313503"
         }
      },
      "author_association" : "NONE",
      "body" : "nit: Type-o in `basee_fee` -> `base_fee` :)",
      "commit_id" : "dcd75d87eef701b1214699fcad79328f06801176",
      "created_at" : "2021-08-10T20:51:50Z",
      "diff_hunk" : "@@ -5,70 +5,90 @@\n \"\"\"Test mempool limiting together/eviction with the wallet.\"\"\"\n \n from decimal import Decimal\n+from test_framework.blocktools import COINBASE_MATURITY\n \n from test_framework.test_framework import BitcoinTestFramework\n-from test_framework.util import assert_equal, assert_greater_than, assert_raises_rpc_error, create_confirmed_utxos, create_lots_of_big_transactions, gen_return_txouts\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than,\n+    assert_raises_rpc_error,\n+    gen_return_txouts,\n+)\n+from test_framework.wallet import MiniWallet\n+\n \n class MempoolLimitTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.setup_clean_chain = True\n         self.num_nodes = 1\n-        self.extra_args = [[\n-            \"-acceptnonstdtxn=1\",\n-            \"-maxmempool=5\",\n-            \"-spendzeroconfchange=0\",\n-        ]]\n+        self.extra_args = [\n+            [\n+                \"-acceptnonstdtxn=1\",\n+                \"-maxmempool=5\",\n+                \"-spendzeroconfchange=0\",\n+            ]\n+        ]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n         txouts = gen_return_txouts()\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-\n-        self.log.info('Check that mempoolminfee is minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_equal(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n-\n-        txids = []\n-        utxos = create_confirmed_utxos(relayfee, self.nodes[0], 91)\n-\n-        self.log.info('Create a mempool tx that will be evicted')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        self.nodes[0].settxfee(relayfee) # specifically fund this tx with low fee\n-        txF = self.nodes[0].fundrawtransaction(tx)\n-        self.nodes[0].settxfee(0) # return to automatic fee selection\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        txid = self.nodes[0].sendrawtransaction(txFS['hex'])\n-\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-        base_fee = relayfee*100\n-        for i in range (3):\n-            txids.append([])\n-            txids[i] = create_lots_of_big_transactions(self.nodes[0], txouts, utxos[30*i:30*i+30], 30, (i+1)*base_fee)\n-\n-        self.log.info('The tx should be evicted by now')\n-        assert txid not in self.nodes[0].getrawmempool()\n-        txdata = self.nodes[0].gettransaction(txid)\n-        assert txdata['confirmations'] ==  0  #confirmation should still be 0\n-\n-        self.log.info('Check that mempoolminfee is larger than minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_greater_than(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n-\n-        self.log.info('Create a mempool tx that will not pass mempoolminfee')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        # specifically fund this tx with a fee < mempoolminfee, >= than minrelaytxfee\n-        txF = self.nodes[0].fundrawtransaction(tx, {'feeRate': relayfee})\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        assert_raises_rpc_error(-26, \"mempool min fee not met\", self.nodes[0].sendrawtransaction, txFS['hex'])\n-\n-if __name__ == '__main__':\n+\n+        node = self.nodes[0]\n+        miniwallet = MiniWallet(node)\n+        relayfee = node.getnetworkinfo()[\"relayfee\"]\n+\n+        self.log.info(\"Check that mempoolminfee is minrelytxfee\")\n+        assert_equal(node.getmempoolinfo()[\"minrelaytxfee\"], Decimal(\"0.00001000\"))\n+        assert_equal(node.getmempoolinfo()[\"mempoolminfee\"], Decimal(\"0.00001000\"))\n+\n+        # Generate 92 UTXOs to flood the mempool\n+        # 1 to create a tx initially that will be evicted from the mempool later\n+        # 90 with a fee rate much higher than the previous UTXO (3 batches of 30 with increasing fee rate)\n+        # And 1 more to verify that this tx does not get added to the mempool with a fee rate less than the mempoolminfee\n+        miniwallet.generate(1 + (3 * 30) + 1)\n+\n+        # Mine 99 blocks so that the UTXOs are allowed to be spent\n+        node.generate(COINBASE_MATURITY - 1)\n+\n+        self.log.info(\"Create a mempool tx that will be evicted\")\n+        tx_to_be_evicted_id = miniwallet.send_self_transfer(\n+            from_node=node, fee_rate=relayfee\n+        )[\"txid\"]\n+\n+        # Increase the tx fee rate massively now to give the next transactions a higher priority in the mempool\n+        base_fee = relayfee * 1000\n+\n+        self.log.info(\"Fill up the mempool with txs with higher fee rate\")\n+        no_of_large_tx_created = 0\n+        for batch_of_txid in range(3):\n+            # Increment the tx fee rate gradually by a factor of (basee_fee) for each batch of 30 transactions",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r686313503",
      "id" : 686313503,
      "line" : 64,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NjMxMzUwMw==",
      "original_commit_id" : "dcd75d87eef701b1214699fcad79328f06801176",
      "original_line" : 64,
      "original_position" : 115,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : 115,
      "pull_request_review_id" : 726834907,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-10T20:59:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686313503",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/42388668?v=4",
         "events_url" : "https://api.github.com/users/NikhilBartwal/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NikhilBartwal/followers",
         "following_url" : "https://api.github.com/users/NikhilBartwal/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NikhilBartwal/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NikhilBartwal",
         "id" : 42388668,
         "login" : "NikhilBartwal",
         "node_id" : "MDQ6VXNlcjQyMzg4NjY4",
         "organizations_url" : "https://api.github.com/users/NikhilBartwal/orgs",
         "received_events_url" : "https://api.github.com/users/NikhilBartwal/received_events",
         "repos_url" : "https://api.github.com/users/NikhilBartwal/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NikhilBartwal/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NikhilBartwal/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NikhilBartwal"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r686315551"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686315551"
         }
      },
      "author_association" : "NONE",
      "body" : "nit: Since, we are bumping up the `fee_rate` as a factor of `base_fee` with the `batch_of_txid`, IMO it would be more intuitive to use `for batch_of_txid in range(1,4):` so that we can simply use:\r\n```\r\nminiwallet.create_large_transactions(\r\n                node, txouts, 30, batch_of_txid * base_fee\r\n)\r\n```",
      "commit_id" : "dcd75d87eef701b1214699fcad79328f06801176",
      "created_at" : "2021-08-10T20:55:08Z",
      "diff_hunk" : "@@ -5,70 +5,90 @@\n \"\"\"Test mempool limiting together/eviction with the wallet.\"\"\"\n \n from decimal import Decimal\n+from test_framework.blocktools import COINBASE_MATURITY\n \n from test_framework.test_framework import BitcoinTestFramework\n-from test_framework.util import assert_equal, assert_greater_than, assert_raises_rpc_error, create_confirmed_utxos, create_lots_of_big_transactions, gen_return_txouts\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than,\n+    assert_raises_rpc_error,\n+    gen_return_txouts,\n+)\n+from test_framework.wallet import MiniWallet\n+\n \n class MempoolLimitTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.setup_clean_chain = True\n         self.num_nodes = 1\n-        self.extra_args = [[\n-            \"-acceptnonstdtxn=1\",\n-            \"-maxmempool=5\",\n-            \"-spendzeroconfchange=0\",\n-        ]]\n+        self.extra_args = [\n+            [\n+                \"-acceptnonstdtxn=1\",\n+                \"-maxmempool=5\",\n+                \"-spendzeroconfchange=0\",\n+            ]\n+        ]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n         txouts = gen_return_txouts()\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-\n-        self.log.info('Check that mempoolminfee is minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_equal(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n-\n-        txids = []\n-        utxos = create_confirmed_utxos(relayfee, self.nodes[0], 91)\n-\n-        self.log.info('Create a mempool tx that will be evicted')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        self.nodes[0].settxfee(relayfee) # specifically fund this tx with low fee\n-        txF = self.nodes[0].fundrawtransaction(tx)\n-        self.nodes[0].settxfee(0) # return to automatic fee selection\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        txid = self.nodes[0].sendrawtransaction(txFS['hex'])\n-\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-        base_fee = relayfee*100\n-        for i in range (3):\n-            txids.append([])\n-            txids[i] = create_lots_of_big_transactions(self.nodes[0], txouts, utxos[30*i:30*i+30], 30, (i+1)*base_fee)\n-\n-        self.log.info('The tx should be evicted by now')\n-        assert txid not in self.nodes[0].getrawmempool()\n-        txdata = self.nodes[0].gettransaction(txid)\n-        assert txdata['confirmations'] ==  0  #confirmation should still be 0\n-\n-        self.log.info('Check that mempoolminfee is larger than minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_greater_than(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n-\n-        self.log.info('Create a mempool tx that will not pass mempoolminfee')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        # specifically fund this tx with a fee < mempoolminfee, >= than minrelaytxfee\n-        txF = self.nodes[0].fundrawtransaction(tx, {'feeRate': relayfee})\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        assert_raises_rpc_error(-26, \"mempool min fee not met\", self.nodes[0].sendrawtransaction, txFS['hex'])\n-\n-if __name__ == '__main__':\n+\n+        node = self.nodes[0]\n+        miniwallet = MiniWallet(node)\n+        relayfee = node.getnetworkinfo()[\"relayfee\"]\n+\n+        self.log.info(\"Check that mempoolminfee is minrelytxfee\")\n+        assert_equal(node.getmempoolinfo()[\"minrelaytxfee\"], Decimal(\"0.00001000\"))\n+        assert_equal(node.getmempoolinfo()[\"mempoolminfee\"], Decimal(\"0.00001000\"))\n+\n+        # Generate 92 UTXOs to flood the mempool\n+        # 1 to create a tx initially that will be evicted from the mempool later\n+        # 90 with a fee rate much higher than the previous UTXO (3 batches of 30 with increasing fee rate)\n+        # And 1 more to verify that this tx does not get added to the mempool with a fee rate less than the mempoolminfee\n+        miniwallet.generate(1 + (3 * 30) + 1)\n+\n+        # Mine 99 blocks so that the UTXOs are allowed to be spent\n+        node.generate(COINBASE_MATURITY - 1)\n+\n+        self.log.info(\"Create a mempool tx that will be evicted\")\n+        tx_to_be_evicted_id = miniwallet.send_self_transfer(\n+            from_node=node, fee_rate=relayfee\n+        )[\"txid\"]\n+\n+        # Increase the tx fee rate massively now to give the next transactions a higher priority in the mempool\n+        base_fee = relayfee * 1000\n+\n+        self.log.info(\"Fill up the mempool with txs with higher fee rate\")\n+        no_of_large_tx_created = 0\n+        for batch_of_txid in range(3):\n+            # Increment the tx fee rate gradually by a factor of (basee_fee) for each batch of 30 transactions\n+            no_of_large_tx_created += miniwallet.create_large_transactions(\n+                node, txouts, 30, (batch_of_txid + 1) * base_fee",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r686315551",
      "id" : 686315551,
      "line" : 66,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NjMxNTU1MQ==",
      "original_commit_id" : "dcd75d87eef701b1214699fcad79328f06801176",
      "original_line" : 66,
      "original_position" : 117,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : 117,
      "pull_request_review_id" : 726837605,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-10T20:55:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686315551",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/42388668?v=4",
         "events_url" : "https://api.github.com/users/NikhilBartwal/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NikhilBartwal/followers",
         "following_url" : "https://api.github.com/users/NikhilBartwal/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NikhilBartwal/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NikhilBartwal",
         "id" : 42388668,
         "login" : "NikhilBartwal",
         "node_id" : "MDQ6VXNlcjQyMzg4NjY4",
         "organizations_url" : "https://api.github.com/users/NikhilBartwal/orgs",
         "received_events_url" : "https://api.github.com/users/NikhilBartwal/received_events",
         "repos_url" : "https://api.github.com/users/NikhilBartwal/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NikhilBartwal/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NikhilBartwal/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NikhilBartwal"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r686317188"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686317188"
         }
      },
      "author_association" : "NONE",
      "body" : "In extension to the corresponding comment above, maybe we should add the confirmation test, something on the lines of:\r\n```\r\ntxdata = node.gettransaction(tx_to_be_evicted)\r\nassert txdata['confirmations'] == 0\r\n```",
      "commit_id" : "dcd75d87eef701b1214699fcad79328f06801176",
      "created_at" : "2021-08-10T20:57:46Z",
      "diff_hunk" : "@@ -5,70 +5,90 @@\n \"\"\"Test mempool limiting together/eviction with the wallet.\"\"\"\n \n from decimal import Decimal\n+from test_framework.blocktools import COINBASE_MATURITY\n \n from test_framework.test_framework import BitcoinTestFramework\n-from test_framework.util import assert_equal, assert_greater_than, assert_raises_rpc_error, create_confirmed_utxos, create_lots_of_big_transactions, gen_return_txouts\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than,\n+    assert_raises_rpc_error,\n+    gen_return_txouts,\n+)\n+from test_framework.wallet import MiniWallet\n+\n \n class MempoolLimitTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.setup_clean_chain = True\n         self.num_nodes = 1\n-        self.extra_args = [[\n-            \"-acceptnonstdtxn=1\",\n-            \"-maxmempool=5\",\n-            \"-spendzeroconfchange=0\",\n-        ]]\n+        self.extra_args = [\n+            [\n+                \"-acceptnonstdtxn=1\",\n+                \"-maxmempool=5\",\n+                \"-spendzeroconfchange=0\",\n+            ]\n+        ]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n         txouts = gen_return_txouts()\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-\n-        self.log.info('Check that mempoolminfee is minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_equal(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n-\n-        txids = []\n-        utxos = create_confirmed_utxos(relayfee, self.nodes[0], 91)\n-\n-        self.log.info('Create a mempool tx that will be evicted')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        self.nodes[0].settxfee(relayfee) # specifically fund this tx with low fee\n-        txF = self.nodes[0].fundrawtransaction(tx)\n-        self.nodes[0].settxfee(0) # return to automatic fee selection\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        txid = self.nodes[0].sendrawtransaction(txFS['hex'])\n-\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-        base_fee = relayfee*100\n-        for i in range (3):\n-            txids.append([])\n-            txids[i] = create_lots_of_big_transactions(self.nodes[0], txouts, utxos[30*i:30*i+30], 30, (i+1)*base_fee)\n-\n-        self.log.info('The tx should be evicted by now')\n-        assert txid not in self.nodes[0].getrawmempool()\n-        txdata = self.nodes[0].gettransaction(txid)\n-        assert txdata['confirmations'] ==  0  #confirmation should still be 0\n-\n-        self.log.info('Check that mempoolminfee is larger than minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_greater_than(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n-\n-        self.log.info('Create a mempool tx that will not pass mempoolminfee')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        # specifically fund this tx with a fee < mempoolminfee, >= than minrelaytxfee\n-        txF = self.nodes[0].fundrawtransaction(tx, {'feeRate': relayfee})\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        assert_raises_rpc_error(-26, \"mempool min fee not met\", self.nodes[0].sendrawtransaction, txFS['hex'])\n-\n-if __name__ == '__main__':\n+\n+        node = self.nodes[0]\n+        miniwallet = MiniWallet(node)\n+        relayfee = node.getnetworkinfo()[\"relayfee\"]\n+\n+        self.log.info(\"Check that mempoolminfee is minrelytxfee\")\n+        assert_equal(node.getmempoolinfo()[\"minrelaytxfee\"], Decimal(\"0.00001000\"))\n+        assert_equal(node.getmempoolinfo()[\"mempoolminfee\"], Decimal(\"0.00001000\"))\n+\n+        # Generate 92 UTXOs to flood the mempool\n+        # 1 to create a tx initially that will be evicted from the mempool later\n+        # 90 with a fee rate much higher than the previous UTXO (3 batches of 30 with increasing fee rate)\n+        # And 1 more to verify that this tx does not get added to the mempool with a fee rate less than the mempoolminfee\n+        miniwallet.generate(1 + (3 * 30) + 1)\n+\n+        # Mine 99 blocks so that the UTXOs are allowed to be spent\n+        node.generate(COINBASE_MATURITY - 1)\n+\n+        self.log.info(\"Create a mempool tx that will be evicted\")\n+        tx_to_be_evicted_id = miniwallet.send_self_transfer(\n+            from_node=node, fee_rate=relayfee\n+        )[\"txid\"]\n+\n+        # Increase the tx fee rate massively now to give the next transactions a higher priority in the mempool\n+        base_fee = relayfee * 1000\n+\n+        self.log.info(\"Fill up the mempool with txs with higher fee rate\")\n+        no_of_large_tx_created = 0\n+        for batch_of_txid in range(3):\n+            # Increment the tx fee rate gradually by a factor of (basee_fee) for each batch of 30 transactions\n+            no_of_large_tx_created += miniwallet.create_large_transactions(\n+                node, txouts, 30, (batch_of_txid + 1) * base_fee\n+            )\n+\n+        self.log.info(\"The tx should be evicted by now\")\n+        # The number of transactions created should be greater than the ones present in the mempool\n+        assert_greater_than(no_of_large_tx_created, len(node.getrawmempool()))\n+        # Initial tx created should not be present in the mempool anymore as it had a lower fee rate\n+        assert tx_to_be_evicted_id not in node.getrawmempool()\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r686317188",
      "id" : 686317188,
      "line" : 74,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NjMxNzE4OA==",
      "original_commit_id" : "dcd75d87eef701b1214699fcad79328f06801176",
      "original_line" : 74,
      "original_position" : 125,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : 125,
      "pull_request_review_id" : 726839637,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-10T20:57:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686317188",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/42388668?v=4",
         "events_url" : "https://api.github.com/users/NikhilBartwal/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NikhilBartwal/followers",
         "following_url" : "https://api.github.com/users/NikhilBartwal/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NikhilBartwal/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NikhilBartwal",
         "id" : 42388668,
         "login" : "NikhilBartwal",
         "node_id" : "MDQ6VXNlcjQyMzg4NjY4",
         "organizations_url" : "https://api.github.com/users/NikhilBartwal/orgs",
         "received_events_url" : "https://api.github.com/users/NikhilBartwal/received_events",
         "repos_url" : "https://api.github.com/users/NikhilBartwal/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NikhilBartwal/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NikhilBartwal/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NikhilBartwal"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r686322985"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686322985"
         }
      },
      "author_association" : "NONE",
      "body" : "nit: Type-o in `minrelytxfee` -> `minrelaytxfee` :)",
      "commit_id" : "dcd75d87eef701b1214699fcad79328f06801176",
      "created_at" : "2021-08-10T21:07:21Z",
      "diff_hunk" : "@@ -5,70 +5,90 @@\n \"\"\"Test mempool limiting together/eviction with the wallet.\"\"\"\n \n from decimal import Decimal\n+from test_framework.blocktools import COINBASE_MATURITY\n \n from test_framework.test_framework import BitcoinTestFramework\n-from test_framework.util import assert_equal, assert_greater_than, assert_raises_rpc_error, create_confirmed_utxos, create_lots_of_big_transactions, gen_return_txouts\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than,\n+    assert_raises_rpc_error,\n+    gen_return_txouts,\n+)\n+from test_framework.wallet import MiniWallet\n+\n \n class MempoolLimitTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.setup_clean_chain = True\n         self.num_nodes = 1\n-        self.extra_args = [[\n-            \"-acceptnonstdtxn=1\",\n-            \"-maxmempool=5\",\n-            \"-spendzeroconfchange=0\",\n-        ]]\n+        self.extra_args = [\n+            [\n+                \"-acceptnonstdtxn=1\",\n+                \"-maxmempool=5\",\n+                \"-spendzeroconfchange=0\",\n+            ]\n+        ]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n         txouts = gen_return_txouts()\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-\n-        self.log.info('Check that mempoolminfee is minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_equal(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n-\n-        txids = []\n-        utxos = create_confirmed_utxos(relayfee, self.nodes[0], 91)\n-\n-        self.log.info('Create a mempool tx that will be evicted')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        self.nodes[0].settxfee(relayfee) # specifically fund this tx with low fee\n-        txF = self.nodes[0].fundrawtransaction(tx)\n-        self.nodes[0].settxfee(0) # return to automatic fee selection\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        txid = self.nodes[0].sendrawtransaction(txFS['hex'])\n-\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-        base_fee = relayfee*100\n-        for i in range (3):\n-            txids.append([])\n-            txids[i] = create_lots_of_big_transactions(self.nodes[0], txouts, utxos[30*i:30*i+30], 30, (i+1)*base_fee)\n-\n-        self.log.info('The tx should be evicted by now')\n-        assert txid not in self.nodes[0].getrawmempool()\n-        txdata = self.nodes[0].gettransaction(txid)\n-        assert txdata['confirmations'] ==  0  #confirmation should still be 0\n-\n-        self.log.info('Check that mempoolminfee is larger than minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_greater_than(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n-\n-        self.log.info('Create a mempool tx that will not pass mempoolminfee')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        # specifically fund this tx with a fee < mempoolminfee, >= than minrelaytxfee\n-        txF = self.nodes[0].fundrawtransaction(tx, {'feeRate': relayfee})\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        assert_raises_rpc_error(-26, \"mempool min fee not met\", self.nodes[0].sendrawtransaction, txFS['hex'])\n-\n-if __name__ == '__main__':\n+\n+        node = self.nodes[0]\n+        miniwallet = MiniWallet(node)\n+        relayfee = node.getnetworkinfo()[\"relayfee\"]\n+\n+        self.log.info(\"Check that mempoolminfee is minrelytxfee\")\n+        assert_equal(node.getmempoolinfo()[\"minrelaytxfee\"], Decimal(\"0.00001000\"))\n+        assert_equal(node.getmempoolinfo()[\"mempoolminfee\"], Decimal(\"0.00001000\"))\n+\n+        # Generate 92 UTXOs to flood the mempool\n+        # 1 to create a tx initially that will be evicted from the mempool later\n+        # 90 with a fee rate much higher than the previous UTXO (3 batches of 30 with increasing fee rate)\n+        # And 1 more to verify that this tx does not get added to the mempool with a fee rate less than the mempoolminfee\n+        miniwallet.generate(1 + (3 * 30) + 1)\n+\n+        # Mine 99 blocks so that the UTXOs are allowed to be spent\n+        node.generate(COINBASE_MATURITY - 1)\n+\n+        self.log.info(\"Create a mempool tx that will be evicted\")\n+        tx_to_be_evicted_id = miniwallet.send_self_transfer(\n+            from_node=node, fee_rate=relayfee\n+        )[\"txid\"]\n+\n+        # Increase the tx fee rate massively now to give the next transactions a higher priority in the mempool\n+        base_fee = relayfee * 1000\n+\n+        self.log.info(\"Fill up the mempool with txs with higher fee rate\")\n+        no_of_large_tx_created = 0\n+        for batch_of_txid in range(3):\n+            # Increment the tx fee rate gradually by a factor of (basee_fee) for each batch of 30 transactions\n+            no_of_large_tx_created += miniwallet.create_large_transactions(\n+                node, txouts, 30, (batch_of_txid + 1) * base_fee\n+            )\n+\n+        self.log.info(\"The tx should be evicted by now\")\n+        # The number of transactions created should be greater than the ones present in the mempool\n+        assert_greater_than(no_of_large_tx_created, len(node.getrawmempool()))\n+        # Initial tx created should not be present in the mempool anymore as it had a lower fee rate\n+        assert tx_to_be_evicted_id not in node.getrawmempool()\n+\n+        self.log.info(\"Check that mempoolminfee is larger than minrelytxfee\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r686322985",
      "id" : 686322985,
      "line" : 75,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NjMyMjk4NQ==",
      "original_commit_id" : "dcd75d87eef701b1214699fcad79328f06801176",
      "original_line" : 75,
      "original_position" : 126,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : 126,
      "pull_request_review_id" : 726847190,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-10T21:07:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686322985",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/42388668?v=4",
         "events_url" : "https://api.github.com/users/NikhilBartwal/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NikhilBartwal/followers",
         "following_url" : "https://api.github.com/users/NikhilBartwal/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NikhilBartwal/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NikhilBartwal",
         "id" : 42388668,
         "login" : "NikhilBartwal",
         "node_id" : "MDQ6VXNlcjQyMzg4NjY4",
         "organizations_url" : "https://api.github.com/users/NikhilBartwal/orgs",
         "received_events_url" : "https://api.github.com/users/NikhilBartwal/received_events",
         "repos_url" : "https://api.github.com/users/NikhilBartwal/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NikhilBartwal/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NikhilBartwal/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NikhilBartwal"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r686491618"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686491618"
         }
      },
      "author_association" : "NONE",
      "body" : "With respect to this and the above comment, `gettransaction(tx_to_be_evicted)` is a method that requires a wallet to be loaded, contradictory to the purpose of this PR. Hence, we're just verifying if it's evicted from the mempool!",
      "commit_id" : "bec7849f5dc4a9fa75b440ddcad9b90e3ebae138",
      "created_at" : "2021-08-11T04:58:21Z",
      "diff_hunk" : "@@ -5,70 +5,90 @@\n \"\"\"Test mempool limiting together/eviction with the wallet.\"\"\"\n \n from decimal import Decimal\n+from test_framework.blocktools import COINBASE_MATURITY\n \n from test_framework.test_framework import BitcoinTestFramework\n-from test_framework.util import assert_equal, assert_greater_than, assert_raises_rpc_error, create_confirmed_utxos, create_lots_of_big_transactions, gen_return_txouts\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than,\n+    assert_raises_rpc_error,\n+    gen_return_txouts,\n+)\n+from test_framework.wallet import MiniWallet\n+\n \n class MempoolLimitTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.setup_clean_chain = True\n         self.num_nodes = 1\n-        self.extra_args = [[\n-            \"-acceptnonstdtxn=1\",\n-            \"-maxmempool=5\",\n-            \"-spendzeroconfchange=0\",\n-        ]]\n+        self.extra_args = [\n+            [\n+                \"-acceptnonstdtxn=1\",\n+                \"-maxmempool=5\",\n+                \"-spendzeroconfchange=0\",\n+            ]\n+        ]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n         txouts = gen_return_txouts()\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-\n-        self.log.info('Check that mempoolminfee is minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_equal(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n-\n-        txids = []\n-        utxos = create_confirmed_utxos(relayfee, self.nodes[0], 91)\n-\n-        self.log.info('Create a mempool tx that will be evicted')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        self.nodes[0].settxfee(relayfee) # specifically fund this tx with low fee\n-        txF = self.nodes[0].fundrawtransaction(tx)\n-        self.nodes[0].settxfee(0) # return to automatic fee selection\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        txid = self.nodes[0].sendrawtransaction(txFS['hex'])\n-\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-        base_fee = relayfee*100\n-        for i in range (3):\n-            txids.append([])\n-            txids[i] = create_lots_of_big_transactions(self.nodes[0], txouts, utxos[30*i:30*i+30], 30, (i+1)*base_fee)\n-\n-        self.log.info('The tx should be evicted by now')\n-        assert txid not in self.nodes[0].getrawmempool()\n-        txdata = self.nodes[0].gettransaction(txid)\n-        assert txdata['confirmations'] ==  0  #confirmation should still be 0\n-\n-        self.log.info('Check that mempoolminfee is larger than minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_greater_than(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n-\n-        self.log.info('Create a mempool tx that will not pass mempoolminfee')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        # specifically fund this tx with a fee < mempoolminfee, >= than minrelaytxfee\n-        txF = self.nodes[0].fundrawtransaction(tx, {'feeRate': relayfee})\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        assert_raises_rpc_error(-26, \"mempool min fee not met\", self.nodes[0].sendrawtransaction, txFS['hex'])\n-\n-if __name__ == '__main__':\n+\n+        node = self.nodes[0]\n+        miniwallet = MiniWallet(node)\n+        relayfee = node.getnetworkinfo()[\"relayfee\"]\n+\n+        self.log.info(\"Check that mempoolminfee is minrelytxfee\")\n+        assert_equal(node.getmempoolinfo()[\"minrelaytxfee\"], Decimal(\"0.00001000\"))\n+        assert_equal(node.getmempoolinfo()[\"mempoolminfee\"], Decimal(\"0.00001000\"))\n+\n+        # Generate 92 UTXOs to flood the mempool\n+        # 1 to create a tx initially that will be evicted from the mempool later\n+        # 90 with a fee rate much higher than the previous UTXO (3 batches of 30 with increasing fee rate)\n+        # And 1 more to verify that this tx does not get added to the mempool with a fee rate less than the mempoolminfee\n+        miniwallet.generate(1 + (3 * 30) + 1)\n+\n+        # Mine 99 blocks so that the UTXOs are allowed to be spent\n+        node.generate(COINBASE_MATURITY - 1)\n+\n+        self.log.info(\"Create a mempool tx that will be evicted\")\n+        tx_to_be_evicted_id = miniwallet.send_self_transfer(\n+            from_node=node, fee_rate=relayfee\n+        )[\"txid\"]\n+\n+        # Increase the tx fee rate massively now to give the next transactions a higher priority in the mempool\n+        base_fee = relayfee * 1000\n+\n+        self.log.info(\"Fill up the mempool with txs with higher fee rate\")\n+        no_of_large_tx_created = 0\n+        for batch_of_txid in range(3):\n+            # Increment the tx fee rate gradually by a factor of (basee_fee) for each batch of 30 transactions\n+            no_of_large_tx_created += miniwallet.create_large_transactions(\n+                node, txouts, 30, (batch_of_txid + 1) * base_fee\n+            )\n+\n+        self.log.info(\"The tx should be evicted by now\")\n+        # The number of transactions created should be greater than the ones present in the mempool\n+        assert_greater_than(no_of_large_tx_created, len(node.getrawmempool()))\n+        # Initial tx created should not be present in the mempool anymore as it had a lower fee rate\n+        assert tx_to_be_evicted_id not in node.getrawmempool()\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r686491618",
      "id" : 686491618,
      "in_reply_to_id" : 686317188,
      "line" : 74,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NjQ5MTYxOA==",
      "original_commit_id" : "dcd75d87eef701b1214699fcad79328f06801176",
      "original_line" : 67,
      "original_position" : 125,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : 125,
      "pull_request_review_id" : 727042456,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-11T04:58:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686491618",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/55556994?v=4",
         "events_url" : "https://api.github.com/users/ShubhamPalriwala/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ShubhamPalriwala/followers",
         "following_url" : "https://api.github.com/users/ShubhamPalriwala/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ShubhamPalriwala/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ShubhamPalriwala",
         "id" : 55556994,
         "login" : "ShubhamPalriwala",
         "node_id" : "MDQ6VXNlcjU1NTU2OTk0",
         "organizations_url" : "https://api.github.com/users/ShubhamPalriwala/orgs",
         "received_events_url" : "https://api.github.com/users/ShubhamPalriwala/received_events",
         "repos_url" : "https://api.github.com/users/ShubhamPalriwala/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ShubhamPalriwala/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ShubhamPalriwala/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ShubhamPalriwala"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r686491848"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686491848"
         }
      },
      "author_association" : "NONE",
      "body" : "Thread has been continued [here](https://github.com/bitcoin/bitcoin/pull/22543#discussion_r686491618)\r\n",
      "commit_id" : "bec7849f5dc4a9fa75b440ddcad9b90e3ebae138",
      "created_at" : "2021-08-11T04:59:07Z",
      "diff_hunk" : "@@ -5,70 +5,90 @@\n \"\"\"Test mempool limiting together/eviction with the wallet.\"\"\"\n \n from decimal import Decimal\n+from test_framework.blocktools import COINBASE_MATURITY\n \n from test_framework.test_framework import BitcoinTestFramework\n-from test_framework.util import assert_equal, assert_greater_than, assert_raises_rpc_error, create_confirmed_utxos, create_lots_of_big_transactions, gen_return_txouts\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than,\n+    assert_raises_rpc_error,\n+    gen_return_txouts,\n+)\n+from test_framework.wallet import MiniWallet\n+\n \n class MempoolLimitTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.setup_clean_chain = True\n         self.num_nodes = 1\n-        self.extra_args = [[\n-            \"-acceptnonstdtxn=1\",\n-            \"-maxmempool=5\",\n-            \"-spendzeroconfchange=0\",\n-        ]]\n+        self.extra_args = [\n+            [\n+                \"-acceptnonstdtxn=1\",\n+                \"-maxmempool=5\",\n+                \"-spendzeroconfchange=0\",\n+            ]\n+        ]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n         txouts = gen_return_txouts()\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-\n-        self.log.info('Check that mempoolminfee is minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_equal(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n-\n-        txids = []\n-        utxos = create_confirmed_utxos(relayfee, self.nodes[0], 91)\n-\n-        self.log.info('Create a mempool tx that will be evicted')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        self.nodes[0].settxfee(relayfee) # specifically fund this tx with low fee\n-        txF = self.nodes[0].fundrawtransaction(tx)\n-        self.nodes[0].settxfee(0) # return to automatic fee selection\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        txid = self.nodes[0].sendrawtransaction(txFS['hex'])\n-\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-        base_fee = relayfee*100\n-        for i in range (3):\n-            txids.append([])\n-            txids[i] = create_lots_of_big_transactions(self.nodes[0], txouts, utxos[30*i:30*i+30], 30, (i+1)*base_fee)\n-\n-        self.log.info('The tx should be evicted by now')\n-        assert txid not in self.nodes[0].getrawmempool()\n-        txdata = self.nodes[0].gettransaction(txid)\n-        assert txdata['confirmations'] ==  0  #confirmation should still be 0",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r686491848",
      "id" : 686491848,
      "in_reply_to_id" : 686312386,
      "line" : 57,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NjQ5MTg0OA==",
      "original_commit_id" : "dcd75d87eef701b1214699fcad79328f06801176",
      "original_line" : 57,
      "original_position" : 69,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : 69,
      "pull_request_review_id" : 727042733,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-11T04:59:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686491848",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/55556994?v=4",
         "events_url" : "https://api.github.com/users/ShubhamPalriwala/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ShubhamPalriwala/followers",
         "following_url" : "https://api.github.com/users/ShubhamPalriwala/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ShubhamPalriwala/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ShubhamPalriwala",
         "id" : 55556994,
         "login" : "ShubhamPalriwala",
         "node_id" : "MDQ6VXNlcjU1NTU2OTk0",
         "organizations_url" : "https://api.github.com/users/ShubhamPalriwala/orgs",
         "received_events_url" : "https://api.github.com/users/ShubhamPalriwala/received_events",
         "repos_url" : "https://api.github.com/users/ShubhamPalriwala/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ShubhamPalriwala/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ShubhamPalriwala/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ShubhamPalriwala"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r686495941"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686495941"
         }
      },
      "author_association" : "NONE",
      "body" : "Done",
      "commit_id" : "bec7849f5dc4a9fa75b440ddcad9b90e3ebae138",
      "created_at" : "2021-08-11T05:11:29Z",
      "diff_hunk" : "@@ -5,70 +5,90 @@\n \"\"\"Test mempool limiting together/eviction with the wallet.\"\"\"\n \n from decimal import Decimal\n+from test_framework.blocktools import COINBASE_MATURITY\n \n from test_framework.test_framework import BitcoinTestFramework\n-from test_framework.util import assert_equal, assert_greater_than, assert_raises_rpc_error, create_confirmed_utxos, create_lots_of_big_transactions, gen_return_txouts\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than,\n+    assert_raises_rpc_error,\n+    gen_return_txouts,\n+)\n+from test_framework.wallet import MiniWallet\n+\n \n class MempoolLimitTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.setup_clean_chain = True\n         self.num_nodes = 1\n-        self.extra_args = [[\n-            \"-acceptnonstdtxn=1\",\n-            \"-maxmempool=5\",\n-            \"-spendzeroconfchange=0\",\n-        ]]\n+        self.extra_args = [\n+            [\n+                \"-acceptnonstdtxn=1\",\n+                \"-maxmempool=5\",\n+                \"-spendzeroconfchange=0\",\n+            ]\n+        ]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n         txouts = gen_return_txouts()\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-\n-        self.log.info('Check that mempoolminfee is minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_equal(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n-\n-        txids = []\n-        utxos = create_confirmed_utxos(relayfee, self.nodes[0], 91)\n-\n-        self.log.info('Create a mempool tx that will be evicted')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        self.nodes[0].settxfee(relayfee) # specifically fund this tx with low fee\n-        txF = self.nodes[0].fundrawtransaction(tx)\n-        self.nodes[0].settxfee(0) # return to automatic fee selection\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        txid = self.nodes[0].sendrawtransaction(txFS['hex'])\n-\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-        base_fee = relayfee*100\n-        for i in range (3):\n-            txids.append([])\n-            txids[i] = create_lots_of_big_transactions(self.nodes[0], txouts, utxos[30*i:30*i+30], 30, (i+1)*base_fee)\n-\n-        self.log.info('The tx should be evicted by now')\n-        assert txid not in self.nodes[0].getrawmempool()\n-        txdata = self.nodes[0].gettransaction(txid)\n-        assert txdata['confirmations'] ==  0  #confirmation should still be 0\n-\n-        self.log.info('Check that mempoolminfee is larger than minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_greater_than(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n-\n-        self.log.info('Create a mempool tx that will not pass mempoolminfee')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        # specifically fund this tx with a fee < mempoolminfee, >= than minrelaytxfee\n-        txF = self.nodes[0].fundrawtransaction(tx, {'feeRate': relayfee})\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        assert_raises_rpc_error(-26, \"mempool min fee not met\", self.nodes[0].sendrawtransaction, txFS['hex'])\n-\n-if __name__ == '__main__':\n+\n+        node = self.nodes[0]\n+        miniwallet = MiniWallet(node)\n+        relayfee = node.getnetworkinfo()[\"relayfee\"]\n+\n+        self.log.info(\"Check that mempoolminfee is minrelytxfee\")\n+        assert_equal(node.getmempoolinfo()[\"minrelaytxfee\"], Decimal(\"0.00001000\"))\n+        assert_equal(node.getmempoolinfo()[\"mempoolminfee\"], Decimal(\"0.00001000\"))\n+\n+        # Generate 92 UTXOs to flood the mempool\n+        # 1 to create a tx initially that will be evicted from the mempool later\n+        # 90 with a fee rate much higher than the previous UTXO (3 batches of 30 with increasing fee rate)\n+        # And 1 more to verify that this tx does not get added to the mempool with a fee rate less than the mempoolminfee\n+        miniwallet.generate(1 + (3 * 30) + 1)\n+\n+        # Mine 99 blocks so that the UTXOs are allowed to be spent\n+        node.generate(COINBASE_MATURITY - 1)\n+\n+        self.log.info(\"Create a mempool tx that will be evicted\")\n+        tx_to_be_evicted_id = miniwallet.send_self_transfer(\n+            from_node=node, fee_rate=relayfee\n+        )[\"txid\"]\n+\n+        # Increase the tx fee rate massively now to give the next transactions a higher priority in the mempool\n+        base_fee = relayfee * 1000\n+\n+        self.log.info(\"Fill up the mempool with txs with higher fee rate\")\n+        no_of_large_tx_created = 0\n+        for batch_of_txid in range(3):\n+            # Increment the tx fee rate gradually by a factor of (basee_fee) for each batch of 30 transactions\n+            no_of_large_tx_created += miniwallet.create_large_transactions(\n+                node, txouts, 30, (batch_of_txid + 1) * base_fee\n+            )\n+\n+        self.log.info(\"The tx should be evicted by now\")\n+        # The number of transactions created should be greater than the ones present in the mempool\n+        assert_greater_than(no_of_large_tx_created, len(node.getrawmempool()))\n+        # Initial tx created should not be present in the mempool anymore as it had a lower fee rate\n+        assert tx_to_be_evicted_id not in node.getrawmempool()\n+\n+        self.log.info(\"Check that mempoolminfee is larger than minrelytxfee\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r686495941",
      "id" : 686495941,
      "in_reply_to_id" : 686322985,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NjQ5NTk0MQ==",
      "original_commit_id" : "dcd75d87eef701b1214699fcad79328f06801176",
      "original_line" : 75,
      "original_position" : 126,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : null,
      "pull_request_review_id" : 727047795,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-11T05:11:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686495941",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/55556994?v=4",
         "events_url" : "https://api.github.com/users/ShubhamPalriwala/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ShubhamPalriwala/followers",
         "following_url" : "https://api.github.com/users/ShubhamPalriwala/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ShubhamPalriwala/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ShubhamPalriwala",
         "id" : 55556994,
         "login" : "ShubhamPalriwala",
         "node_id" : "MDQ6VXNlcjU1NTU2OTk0",
         "organizations_url" : "https://api.github.com/users/ShubhamPalriwala/orgs",
         "received_events_url" : "https://api.github.com/users/ShubhamPalriwala/received_events",
         "repos_url" : "https://api.github.com/users/ShubhamPalriwala/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ShubhamPalriwala/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ShubhamPalriwala/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ShubhamPalriwala"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r686496041"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686496041"
         }
      },
      "author_association" : "NONE",
      "body" : "Done! Thanks",
      "commit_id" : "bec7849f5dc4a9fa75b440ddcad9b90e3ebae138",
      "created_at" : "2021-08-11T05:11:44Z",
      "diff_hunk" : "@@ -5,70 +5,90 @@\n \"\"\"Test mempool limiting together/eviction with the wallet.\"\"\"\n \n from decimal import Decimal\n+from test_framework.blocktools import COINBASE_MATURITY\n \n from test_framework.test_framework import BitcoinTestFramework\n-from test_framework.util import assert_equal, assert_greater_than, assert_raises_rpc_error, create_confirmed_utxos, create_lots_of_big_transactions, gen_return_txouts\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than,\n+    assert_raises_rpc_error,\n+    gen_return_txouts,\n+)\n+from test_framework.wallet import MiniWallet\n+\n \n class MempoolLimitTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.setup_clean_chain = True\n         self.num_nodes = 1\n-        self.extra_args = [[\n-            \"-acceptnonstdtxn=1\",\n-            \"-maxmempool=5\",\n-            \"-spendzeroconfchange=0\",\n-        ]]\n+        self.extra_args = [\n+            [\n+                \"-acceptnonstdtxn=1\",\n+                \"-maxmempool=5\",\n+                \"-spendzeroconfchange=0\",\n+            ]\n+        ]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n         txouts = gen_return_txouts()\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-\n-        self.log.info('Check that mempoolminfee is minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_equal(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n-\n-        txids = []\n-        utxos = create_confirmed_utxos(relayfee, self.nodes[0], 91)\n-\n-        self.log.info('Create a mempool tx that will be evicted')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        self.nodes[0].settxfee(relayfee) # specifically fund this tx with low fee\n-        txF = self.nodes[0].fundrawtransaction(tx)\n-        self.nodes[0].settxfee(0) # return to automatic fee selection\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        txid = self.nodes[0].sendrawtransaction(txFS['hex'])\n-\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-        base_fee = relayfee*100\n-        for i in range (3):\n-            txids.append([])\n-            txids[i] = create_lots_of_big_transactions(self.nodes[0], txouts, utxos[30*i:30*i+30], 30, (i+1)*base_fee)\n-\n-        self.log.info('The tx should be evicted by now')\n-        assert txid not in self.nodes[0].getrawmempool()\n-        txdata = self.nodes[0].gettransaction(txid)\n-        assert txdata['confirmations'] ==  0  #confirmation should still be 0\n-\n-        self.log.info('Check that mempoolminfee is larger than minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_greater_than(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n-\n-        self.log.info('Create a mempool tx that will not pass mempoolminfee')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        # specifically fund this tx with a fee < mempoolminfee, >= than minrelaytxfee\n-        txF = self.nodes[0].fundrawtransaction(tx, {'feeRate': relayfee})\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        assert_raises_rpc_error(-26, \"mempool min fee not met\", self.nodes[0].sendrawtransaction, txFS['hex'])\n-\n-if __name__ == '__main__':\n+\n+        node = self.nodes[0]\n+        miniwallet = MiniWallet(node)\n+        relayfee = node.getnetworkinfo()[\"relayfee\"]\n+\n+        self.log.info(\"Check that mempoolminfee is minrelytxfee\")\n+        assert_equal(node.getmempoolinfo()[\"minrelaytxfee\"], Decimal(\"0.00001000\"))\n+        assert_equal(node.getmempoolinfo()[\"mempoolminfee\"], Decimal(\"0.00001000\"))\n+\n+        # Generate 92 UTXOs to flood the mempool\n+        # 1 to create a tx initially that will be evicted from the mempool later\n+        # 90 with a fee rate much higher than the previous UTXO (3 batches of 30 with increasing fee rate)\n+        # And 1 more to verify that this tx does not get added to the mempool with a fee rate less than the mempoolminfee\n+        miniwallet.generate(1 + (3 * 30) + 1)\n+\n+        # Mine 99 blocks so that the UTXOs are allowed to be spent\n+        node.generate(COINBASE_MATURITY - 1)\n+\n+        self.log.info(\"Create a mempool tx that will be evicted\")\n+        tx_to_be_evicted_id = miniwallet.send_self_transfer(\n+            from_node=node, fee_rate=relayfee\n+        )[\"txid\"]\n+\n+        # Increase the tx fee rate massively now to give the next transactions a higher priority in the mempool\n+        base_fee = relayfee * 1000\n+\n+        self.log.info(\"Fill up the mempool with txs with higher fee rate\")\n+        no_of_large_tx_created = 0\n+        for batch_of_txid in range(3):\n+            # Increment the tx fee rate gradually by a factor of (basee_fee) for each batch of 30 transactions\n+            no_of_large_tx_created += miniwallet.create_large_transactions(\n+                node, txouts, 30, (batch_of_txid + 1) * base_fee",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r686496041",
      "id" : 686496041,
      "in_reply_to_id" : 686315551,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NjQ5NjA0MQ==",
      "original_commit_id" : "dcd75d87eef701b1214699fcad79328f06801176",
      "original_line" : 66,
      "original_position" : 117,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : null,
      "pull_request_review_id" : 727047897,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-11T05:11:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686496041",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/55556994?v=4",
         "events_url" : "https://api.github.com/users/ShubhamPalriwala/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ShubhamPalriwala/followers",
         "following_url" : "https://api.github.com/users/ShubhamPalriwala/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ShubhamPalriwala/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ShubhamPalriwala",
         "id" : 55556994,
         "login" : "ShubhamPalriwala",
         "node_id" : "MDQ6VXNlcjU1NTU2OTk0",
         "organizations_url" : "https://api.github.com/users/ShubhamPalriwala/orgs",
         "received_events_url" : "https://api.github.com/users/ShubhamPalriwala/received_events",
         "repos_url" : "https://api.github.com/users/ShubhamPalriwala/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ShubhamPalriwala/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ShubhamPalriwala/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ShubhamPalriwala"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r686496119"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686496119"
         }
      },
      "author_association" : "NONE",
      "body" : "Done!",
      "commit_id" : "bec7849f5dc4a9fa75b440ddcad9b90e3ebae138",
      "created_at" : "2021-08-11T05:11:58Z",
      "diff_hunk" : "@@ -5,70 +5,90 @@\n \"\"\"Test mempool limiting together/eviction with the wallet.\"\"\"\n \n from decimal import Decimal\n+from test_framework.blocktools import COINBASE_MATURITY\n \n from test_framework.test_framework import BitcoinTestFramework\n-from test_framework.util import assert_equal, assert_greater_than, assert_raises_rpc_error, create_confirmed_utxos, create_lots_of_big_transactions, gen_return_txouts\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than,\n+    assert_raises_rpc_error,\n+    gen_return_txouts,\n+)\n+from test_framework.wallet import MiniWallet\n+\n \n class MempoolLimitTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.setup_clean_chain = True\n         self.num_nodes = 1\n-        self.extra_args = [[\n-            \"-acceptnonstdtxn=1\",\n-            \"-maxmempool=5\",\n-            \"-spendzeroconfchange=0\",\n-        ]]\n+        self.extra_args = [\n+            [\n+                \"-acceptnonstdtxn=1\",\n+                \"-maxmempool=5\",\n+                \"-spendzeroconfchange=0\",\n+            ]\n+        ]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n         txouts = gen_return_txouts()\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-\n-        self.log.info('Check that mempoolminfee is minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_equal(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n-\n-        txids = []\n-        utxos = create_confirmed_utxos(relayfee, self.nodes[0], 91)\n-\n-        self.log.info('Create a mempool tx that will be evicted')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        self.nodes[0].settxfee(relayfee) # specifically fund this tx with low fee\n-        txF = self.nodes[0].fundrawtransaction(tx)\n-        self.nodes[0].settxfee(0) # return to automatic fee selection\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        txid = self.nodes[0].sendrawtransaction(txFS['hex'])\n-\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-        base_fee = relayfee*100\n-        for i in range (3):\n-            txids.append([])\n-            txids[i] = create_lots_of_big_transactions(self.nodes[0], txouts, utxos[30*i:30*i+30], 30, (i+1)*base_fee)\n-\n-        self.log.info('The tx should be evicted by now')\n-        assert txid not in self.nodes[0].getrawmempool()\n-        txdata = self.nodes[0].gettransaction(txid)\n-        assert txdata['confirmations'] ==  0  #confirmation should still be 0\n-\n-        self.log.info('Check that mempoolminfee is larger than minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_greater_than(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n-\n-        self.log.info('Create a mempool tx that will not pass mempoolminfee')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        # specifically fund this tx with a fee < mempoolminfee, >= than minrelaytxfee\n-        txF = self.nodes[0].fundrawtransaction(tx, {'feeRate': relayfee})\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        assert_raises_rpc_error(-26, \"mempool min fee not met\", self.nodes[0].sendrawtransaction, txFS['hex'])\n-\n-if __name__ == '__main__':\n+\n+        node = self.nodes[0]\n+        miniwallet = MiniWallet(node)\n+        relayfee = node.getnetworkinfo()[\"relayfee\"]\n+\n+        self.log.info(\"Check that mempoolminfee is minrelytxfee\")\n+        assert_equal(node.getmempoolinfo()[\"minrelaytxfee\"], Decimal(\"0.00001000\"))\n+        assert_equal(node.getmempoolinfo()[\"mempoolminfee\"], Decimal(\"0.00001000\"))\n+\n+        # Generate 92 UTXOs to flood the mempool\n+        # 1 to create a tx initially that will be evicted from the mempool later\n+        # 90 with a fee rate much higher than the previous UTXO (3 batches of 30 with increasing fee rate)\n+        # And 1 more to verify that this tx does not get added to the mempool with a fee rate less than the mempoolminfee\n+        miniwallet.generate(1 + (3 * 30) + 1)\n+\n+        # Mine 99 blocks so that the UTXOs are allowed to be spent\n+        node.generate(COINBASE_MATURITY - 1)\n+\n+        self.log.info(\"Create a mempool tx that will be evicted\")\n+        tx_to_be_evicted_id = miniwallet.send_self_transfer(\n+            from_node=node, fee_rate=relayfee\n+        )[\"txid\"]\n+\n+        # Increase the tx fee rate massively now to give the next transactions a higher priority in the mempool\n+        base_fee = relayfee * 1000\n+\n+        self.log.info(\"Fill up the mempool with txs with higher fee rate\")\n+        no_of_large_tx_created = 0\n+        for batch_of_txid in range(3):\n+            # Increment the tx fee rate gradually by a factor of (basee_fee) for each batch of 30 transactions",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r686496119",
      "id" : 686496119,
      "in_reply_to_id" : 686313503,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NjQ5NjExOQ==",
      "original_commit_id" : "dcd75d87eef701b1214699fcad79328f06801176",
      "original_line" : 64,
      "original_position" : 115,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : null,
      "pull_request_review_id" : 727047980,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-11T05:11:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686496119",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/55556994?v=4",
         "events_url" : "https://api.github.com/users/ShubhamPalriwala/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ShubhamPalriwala/followers",
         "following_url" : "https://api.github.com/users/ShubhamPalriwala/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ShubhamPalriwala/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ShubhamPalriwala",
         "id" : 55556994,
         "login" : "ShubhamPalriwala",
         "node_id" : "MDQ6VXNlcjU1NTU2OTk0",
         "organizations_url" : "https://api.github.com/users/ShubhamPalriwala/orgs",
         "received_events_url" : "https://api.github.com/users/ShubhamPalriwala/received_events",
         "repos_url" : "https://api.github.com/users/ShubhamPalriwala/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ShubhamPalriwala/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ShubhamPalriwala/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ShubhamPalriwala"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r687413483"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687413483"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why is it sufficient to mine 99 blocks?",
      "commit_id" : "bec7849f5dc4a9fa75b440ddcad9b90e3ebae138",
      "created_at" : "2021-08-12T06:06:10Z",
      "diff_hunk" : "@@ -5,70 +5,90 @@\n \"\"\"Test mempool limiting together/eviction with the wallet.\"\"\"\n \n from decimal import Decimal\n+from test_framework.blocktools import COINBASE_MATURITY\n \n from test_framework.test_framework import BitcoinTestFramework\n-from test_framework.util import assert_equal, assert_greater_than, assert_raises_rpc_error, create_confirmed_utxos, create_lots_of_big_transactions, gen_return_txouts\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than,\n+    assert_raises_rpc_error,\n+    gen_return_txouts,\n+)\n+from test_framework.wallet import MiniWallet\n+\n \n class MempoolLimitTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.setup_clean_chain = True\n         self.num_nodes = 1\n-        self.extra_args = [[\n-            \"-acceptnonstdtxn=1\",\n-            \"-maxmempool=5\",\n-            \"-spendzeroconfchange=0\",\n-        ]]\n+        self.extra_args = [\n+            [\n+                \"-acceptnonstdtxn=1\",\n+                \"-maxmempool=5\",\n+                \"-spendzeroconfchange=0\",\n+            ]\n+        ]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n         txouts = gen_return_txouts()\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-\n-        self.log.info('Check that mempoolminfee is minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_equal(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n-\n-        txids = []\n-        utxos = create_confirmed_utxos(relayfee, self.nodes[0], 91)\n-\n-        self.log.info('Create a mempool tx that will be evicted')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        self.nodes[0].settxfee(relayfee) # specifically fund this tx with low fee\n-        txF = self.nodes[0].fundrawtransaction(tx)\n-        self.nodes[0].settxfee(0) # return to automatic fee selection\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        txid = self.nodes[0].sendrawtransaction(txFS['hex'])\n-\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-        base_fee = relayfee*100\n-        for i in range (3):\n-            txids.append([])\n-            txids[i] = create_lots_of_big_transactions(self.nodes[0], txouts, utxos[30*i:30*i+30], 30, (i+1)*base_fee)\n-\n-        self.log.info('The tx should be evicted by now')\n-        assert txid not in self.nodes[0].getrawmempool()\n-        txdata = self.nodes[0].gettransaction(txid)\n-        assert txdata['confirmations'] ==  0  #confirmation should still be 0\n-\n-        self.log.info('Check that mempoolminfee is larger than minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_greater_than(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n-\n-        self.log.info('Create a mempool tx that will not pass mempoolminfee')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        # specifically fund this tx with a fee < mempoolminfee, >= than minrelaytxfee\n-        txF = self.nodes[0].fundrawtransaction(tx, {'feeRate': relayfee})\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        assert_raises_rpc_error(-26, \"mempool min fee not met\", self.nodes[0].sendrawtransaction, txFS['hex'])\n-\n-if __name__ == '__main__':\n+\n+        node = self.nodes[0]\n+        miniwallet = MiniWallet(node)\n+        relayfee = node.getnetworkinfo()[\"relayfee\"]\n+\n+        self.log.info(\"Check that mempoolminfee is minrelytxfee\")\n+        assert_equal(node.getmempoolinfo()[\"minrelaytxfee\"], Decimal(\"0.00001000\"))\n+        assert_equal(node.getmempoolinfo()[\"mempoolminfee\"], Decimal(\"0.00001000\"))\n+\n+        # Generate 92 UTXOs to flood the mempool\n+        # 1 to create a tx initially that will be evicted from the mempool later\n+        # 90 with a fee rate much higher than the previous UTXO (3 batches of 30 with increasing fee rate)\n+        # And 1 more to verify that this tx does not get added to the mempool with a fee rate less than the mempoolminfee\n+        miniwallet.generate(1 + (3 * 30) + 1)\n+\n+        # Mine 99 blocks so that the UTXOs are allowed to be spent",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r687413483",
      "id" : 687413483,
      "line" : 50,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NzQxMzQ4Mw==",
      "original_commit_id" : "bec7849f5dc4a9fa75b440ddcad9b90e3ebae138",
      "original_line" : 50,
      "original_position" : 101,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : 101,
      "pull_request_review_id" : 728209810,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-12T06:06:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/687413483",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/44291592?v=4",
         "events_url" : "https://api.github.com/users/hg333/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hg333/followers",
         "following_url" : "https://api.github.com/users/hg333/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hg333/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hg333",
         "id" : 44291592,
         "login" : "hg333",
         "node_id" : "MDQ6VXNlcjQ0MjkxNTky",
         "organizations_url" : "https://api.github.com/users/hg333/orgs",
         "received_events_url" : "https://api.github.com/users/hg333/received_events",
         "repos_url" : "https://api.github.com/users/hg333/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hg333/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hg333/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hg333"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r688979803"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/688979803"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: Maybe just me but I think `miniwallet.generate(92)` is easier to read since the comment already describes where the 92 comes from. ",
      "commit_id" : "bec7849f5dc4a9fa75b440ddcad9b90e3ebae138",
      "created_at" : "2021-08-14T18:51:12Z",
      "diff_hunk" : "@@ -5,70 +5,90 @@\n \"\"\"Test mempool limiting together/eviction with the wallet.\"\"\"\n \n from decimal import Decimal\n+from test_framework.blocktools import COINBASE_MATURITY\n \n from test_framework.test_framework import BitcoinTestFramework\n-from test_framework.util import assert_equal, assert_greater_than, assert_raises_rpc_error, create_confirmed_utxos, create_lots_of_big_transactions, gen_return_txouts\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than,\n+    assert_raises_rpc_error,\n+    gen_return_txouts,\n+)\n+from test_framework.wallet import MiniWallet\n+\n \n class MempoolLimitTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.setup_clean_chain = True\n         self.num_nodes = 1\n-        self.extra_args = [[\n-            \"-acceptnonstdtxn=1\",\n-            \"-maxmempool=5\",\n-            \"-spendzeroconfchange=0\",\n-        ]]\n+        self.extra_args = [\n+            [\n+                \"-acceptnonstdtxn=1\",\n+                \"-maxmempool=5\",\n+                \"-spendzeroconfchange=0\",\n+            ]\n+        ]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n         txouts = gen_return_txouts()\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-\n-        self.log.info('Check that mempoolminfee is minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_equal(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n-\n-        txids = []\n-        utxos = create_confirmed_utxos(relayfee, self.nodes[0], 91)\n-\n-        self.log.info('Create a mempool tx that will be evicted')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        self.nodes[0].settxfee(relayfee) # specifically fund this tx with low fee\n-        txF = self.nodes[0].fundrawtransaction(tx)\n-        self.nodes[0].settxfee(0) # return to automatic fee selection\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        txid = self.nodes[0].sendrawtransaction(txFS['hex'])\n-\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-        base_fee = relayfee*100\n-        for i in range (3):\n-            txids.append([])\n-            txids[i] = create_lots_of_big_transactions(self.nodes[0], txouts, utxos[30*i:30*i+30], 30, (i+1)*base_fee)\n-\n-        self.log.info('The tx should be evicted by now')\n-        assert txid not in self.nodes[0].getrawmempool()\n-        txdata = self.nodes[0].gettransaction(txid)\n-        assert txdata['confirmations'] ==  0  #confirmation should still be 0\n-\n-        self.log.info('Check that mempoolminfee is larger than minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_greater_than(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n-\n-        self.log.info('Create a mempool tx that will not pass mempoolminfee')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        # specifically fund this tx with a fee < mempoolminfee, >= than minrelaytxfee\n-        txF = self.nodes[0].fundrawtransaction(tx, {'feeRate': relayfee})\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        assert_raises_rpc_error(-26, \"mempool min fee not met\", self.nodes[0].sendrawtransaction, txFS['hex'])\n-\n-if __name__ == '__main__':\n+\n+        node = self.nodes[0]\n+        miniwallet = MiniWallet(node)\n+        relayfee = node.getnetworkinfo()[\"relayfee\"]\n+\n+        self.log.info(\"Check that mempoolminfee is minrelytxfee\")\n+        assert_equal(node.getmempoolinfo()[\"minrelaytxfee\"], Decimal(\"0.00001000\"))\n+        assert_equal(node.getmempoolinfo()[\"mempoolminfee\"], Decimal(\"0.00001000\"))\n+\n+        # Generate 92 UTXOs to flood the mempool\n+        # 1 to create a tx initially that will be evicted from the mempool later\n+        # 90 with a fee rate much higher than the previous UTXO (3 batches of 30 with increasing fee rate)\n+        # And 1 more to verify that this tx does not get added to the mempool with a fee rate less than the mempoolminfee\n+        miniwallet.generate(1 + (3 * 30) + 1)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r688979803",
      "id" : 688979803,
      "line" : 48,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4ODk3OTgwMw==",
      "original_commit_id" : "bec7849f5dc4a9fa75b440ddcad9b90e3ebae138",
      "original_line" : 48,
      "original_position" : 99,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : 99,
      "pull_request_review_id" : 730126293,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-16T07:08:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/688979803",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/41220998?v=4",
         "events_url" : "https://api.github.com/users/DariusParvin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DariusParvin/followers",
         "following_url" : "https://api.github.com/users/DariusParvin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DariusParvin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DariusParvin",
         "id" : 41220998,
         "login" : "DariusParvin",
         "node_id" : "MDQ6VXNlcjQxMjIwOTk4",
         "organizations_url" : "https://api.github.com/users/DariusParvin/orgs",
         "received_events_url" : "https://api.github.com/users/DariusParvin/received_events",
         "repos_url" : "https://api.github.com/users/DariusParvin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DariusParvin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DariusParvin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DariusParvin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r689280712"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689280712"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think it would be more consistent with other functions (`send_self_transfer`, `create_self_transfer`, `sendrawtransaction`) for this to be named `send_large_transactions` since it is also broadcasting them. \r\n\r\nNote that it would also make sense to change `no_of_large_tx_created` to `no_of_large_tx_sent` or `no_of_large_tx_broadcasted`.",
      "commit_id" : "bec7849f5dc4a9fa75b440ddcad9b90e3ebae138",
      "created_at" : "2021-08-16T06:55:45Z",
      "diff_hunk" : "@@ -182,6 +183,26 @@ def sendrawtransaction(self, *, from_node, tx_hex):\n         from_node.sendrawtransaction(tx_hex)\n         self.scan_tx(from_node.decoderawtransaction(tx_hex))\n \n+    def create_large_transactions(",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r689280712",
      "id" : 689280712,
      "line" : 186,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4OTI4MDcxMg==",
      "original_commit_id" : "bec7849f5dc4a9fa75b440ddcad9b90e3ebae138",
      "original_line" : 186,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 12,
      "pull_request_review_id" : 730126293,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-16T07:08:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689280712",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/41220998?v=4",
         "events_url" : "https://api.github.com/users/DariusParvin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DariusParvin/followers",
         "following_url" : "https://api.github.com/users/DariusParvin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DariusParvin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DariusParvin",
         "id" : 41220998,
         "login" : "DariusParvin",
         "node_id" : "MDQ6VXNlcjQxMjIwOTk4",
         "organizations_url" : "https://api.github.com/users/DariusParvin/orgs",
         "received_events_url" : "https://api.github.com/users/DariusParvin/received_events",
         "repos_url" : "https://api.github.com/users/DariusParvin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DariusParvin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DariusParvin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DariusParvin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r689282534"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689282534"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I tried smaller values instead of 30 transactions per batch, and the tests pass with 22 transactions. Is there a specific reason for it to be 30? If not then it seems like 22 is better since it is faster.",
      "commit_id" : "bec7849f5dc4a9fa75b440ddcad9b90e3ebae138",
      "created_at" : "2021-08-16T06:59:07Z",
      "diff_hunk" : "@@ -5,70 +5,90 @@\n \"\"\"Test mempool limiting together/eviction with the wallet.\"\"\"\n \n from decimal import Decimal\n+from test_framework.blocktools import COINBASE_MATURITY\n \n from test_framework.test_framework import BitcoinTestFramework\n-from test_framework.util import assert_equal, assert_greater_than, assert_raises_rpc_error, create_confirmed_utxos, create_lots_of_big_transactions, gen_return_txouts\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than,\n+    assert_raises_rpc_error,\n+    gen_return_txouts,\n+)\n+from test_framework.wallet import MiniWallet\n+\n \n class MempoolLimitTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.setup_clean_chain = True\n         self.num_nodes = 1\n-        self.extra_args = [[\n-            \"-acceptnonstdtxn=1\",\n-            \"-maxmempool=5\",\n-            \"-spendzeroconfchange=0\",\n-        ]]\n+        self.extra_args = [\n+            [\n+                \"-acceptnonstdtxn=1\",\n+                \"-maxmempool=5\",\n+                \"-spendzeroconfchange=0\",\n+            ]\n+        ]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n         txouts = gen_return_txouts()\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-\n-        self.log.info('Check that mempoolminfee is minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_equal(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n-\n-        txids = []\n-        utxos = create_confirmed_utxos(relayfee, self.nodes[0], 91)\n-\n-        self.log.info('Create a mempool tx that will be evicted')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        self.nodes[0].settxfee(relayfee) # specifically fund this tx with low fee\n-        txF = self.nodes[0].fundrawtransaction(tx)\n-        self.nodes[0].settxfee(0) # return to automatic fee selection\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        txid = self.nodes[0].sendrawtransaction(txFS['hex'])\n-\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-        base_fee = relayfee*100\n-        for i in range (3):\n-            txids.append([])\n-            txids[i] = create_lots_of_big_transactions(self.nodes[0], txouts, utxos[30*i:30*i+30], 30, (i+1)*base_fee)\n-\n-        self.log.info('The tx should be evicted by now')\n-        assert txid not in self.nodes[0].getrawmempool()\n-        txdata = self.nodes[0].gettransaction(txid)\n-        assert txdata['confirmations'] ==  0  #confirmation should still be 0\n-\n-        self.log.info('Check that mempoolminfee is larger than minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_greater_than(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n-\n-        self.log.info('Create a mempool tx that will not pass mempoolminfee')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        # specifically fund this tx with a fee < mempoolminfee, >= than minrelaytxfee\n-        txF = self.nodes[0].fundrawtransaction(tx, {'feeRate': relayfee})\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        assert_raises_rpc_error(-26, \"mempool min fee not met\", self.nodes[0].sendrawtransaction, txFS['hex'])\n-\n-if __name__ == '__main__':\n+\n+        node = self.nodes[0]\n+        miniwallet = MiniWallet(node)\n+        relayfee = node.getnetworkinfo()[\"relayfee\"]\n+\n+        self.log.info(\"Check that mempoolminfee is minrelytxfee\")\n+        assert_equal(node.getmempoolinfo()[\"minrelaytxfee\"], Decimal(\"0.00001000\"))\n+        assert_equal(node.getmempoolinfo()[\"mempoolminfee\"], Decimal(\"0.00001000\"))\n+\n+        # Generate 92 UTXOs to flood the mempool\n+        # 1 to create a tx initially that will be evicted from the mempool later\n+        # 90 with a fee rate much higher than the previous UTXO (3 batches of 30 with increasing fee rate)\n+        # And 1 more to verify that this tx does not get added to the mempool with a fee rate less than the mempoolminfee\n+        miniwallet.generate(1 + (3 * 30) + 1)\n+\n+        # Mine 99 blocks so that the UTXOs are allowed to be spent\n+        node.generate(COINBASE_MATURITY - 1)\n+\n+        self.log.info(\"Create a mempool tx that will be evicted\")\n+        tx_to_be_evicted_id = miniwallet.send_self_transfer(\n+            from_node=node, fee_rate=relayfee\n+        )[\"txid\"]\n+\n+        # Increase the tx fee rate massively now to give the next transactions a higher priority in the mempool\n+        base_fee = relayfee * 1000\n+\n+        self.log.info(\"Fill up the mempool with txs with higher fee rate\")\n+        no_of_large_tx_created = 0\n+        for batch_of_txid in range(1, 4):\n+            # Increment the tx fee rate gradually by a factor of (base_fee) for each batch of 30 transactions\n+            no_of_large_tx_created += miniwallet.create_large_transactions(\n+                node, txouts, 30, batch_of_txid * base_fee",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r689282534",
      "id" : 689282534,
      "line" : 66,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4OTI4MjUzNA==",
      "original_commit_id" : "bec7849f5dc4a9fa75b440ddcad9b90e3ebae138",
      "original_line" : 66,
      "original_position" : 117,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : 117,
      "pull_request_review_id" : 730126293,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-16T07:08:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689282534",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/41220998?v=4",
         "events_url" : "https://api.github.com/users/DariusParvin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DariusParvin/followers",
         "following_url" : "https://api.github.com/users/DariusParvin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DariusParvin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DariusParvin",
         "id" : 41220998,
         "login" : "DariusParvin",
         "node_id" : "MDQ6VXNlcjQxMjIwOTk4",
         "organizations_url" : "https://api.github.com/users/DariusParvin/orgs",
         "received_events_url" : "https://api.github.com/users/DariusParvin/received_events",
         "repos_url" : "https://api.github.com/users/DariusParvin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DariusParvin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DariusParvin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DariusParvin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r689354565"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689354565"
         }
      },
      "author_association" : "NONE",
      "body" : "Valid points! Will make suggested changes here to maintain the consistency\r\nEdit: Done",
      "commit_id" : "30a68532035821cc7ca325c61259094e415b7de5",
      "created_at" : "2021-08-16T08:53:21Z",
      "diff_hunk" : "@@ -182,6 +183,26 @@ def sendrawtransaction(self, *, from_node, tx_hex):\n         from_node.sendrawtransaction(tx_hex)\n         self.scan_tx(from_node.decoderawtransaction(tx_hex))\n \n+    def create_large_transactions(",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r689354565",
      "id" : 689354565,
      "in_reply_to_id" : 689280712,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4OTM1NDU2NQ==",
      "original_commit_id" : "bec7849f5dc4a9fa75b440ddcad9b90e3ebae138",
      "original_line" : 186,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : null,
      "pull_request_review_id" : 730475080,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-16T09:41:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689354565",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/55556994?v=4",
         "events_url" : "https://api.github.com/users/ShubhamPalriwala/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ShubhamPalriwala/followers",
         "following_url" : "https://api.github.com/users/ShubhamPalriwala/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ShubhamPalriwala/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ShubhamPalriwala",
         "id" : 55556994,
         "login" : "ShubhamPalriwala",
         "node_id" : "MDQ6VXNlcjU1NTU2OTk0",
         "organizations_url" : "https://api.github.com/users/ShubhamPalriwala/orgs",
         "received_events_url" : "https://api.github.com/users/ShubhamPalriwala/received_events",
         "repos_url" : "https://api.github.com/users/ShubhamPalriwala/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ShubhamPalriwala/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ShubhamPalriwala/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ShubhamPalriwala"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r689355334"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689355334"
         }
      },
      "author_association" : "NONE",
      "body" : "Just wanted to populate the mempool that's why went for 30, let's do 22 then!\r\nEdit: Done",
      "commit_id" : "30a68532035821cc7ca325c61259094e415b7de5",
      "created_at" : "2021-08-16T08:54:26Z",
      "diff_hunk" : "@@ -5,70 +5,90 @@\n \"\"\"Test mempool limiting together/eviction with the wallet.\"\"\"\n \n from decimal import Decimal\n+from test_framework.blocktools import COINBASE_MATURITY\n \n from test_framework.test_framework import BitcoinTestFramework\n-from test_framework.util import assert_equal, assert_greater_than, assert_raises_rpc_error, create_confirmed_utxos, create_lots_of_big_transactions, gen_return_txouts\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than,\n+    assert_raises_rpc_error,\n+    gen_return_txouts,\n+)\n+from test_framework.wallet import MiniWallet\n+\n \n class MempoolLimitTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.setup_clean_chain = True\n         self.num_nodes = 1\n-        self.extra_args = [[\n-            \"-acceptnonstdtxn=1\",\n-            \"-maxmempool=5\",\n-            \"-spendzeroconfchange=0\",\n-        ]]\n+        self.extra_args = [\n+            [\n+                \"-acceptnonstdtxn=1\",\n+                \"-maxmempool=5\",\n+                \"-spendzeroconfchange=0\",\n+            ]\n+        ]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n         txouts = gen_return_txouts()\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-\n-        self.log.info('Check that mempoolminfee is minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_equal(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n-\n-        txids = []\n-        utxos = create_confirmed_utxos(relayfee, self.nodes[0], 91)\n-\n-        self.log.info('Create a mempool tx that will be evicted')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        self.nodes[0].settxfee(relayfee) # specifically fund this tx with low fee\n-        txF = self.nodes[0].fundrawtransaction(tx)\n-        self.nodes[0].settxfee(0) # return to automatic fee selection\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        txid = self.nodes[0].sendrawtransaction(txFS['hex'])\n-\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-        base_fee = relayfee*100\n-        for i in range (3):\n-            txids.append([])\n-            txids[i] = create_lots_of_big_transactions(self.nodes[0], txouts, utxos[30*i:30*i+30], 30, (i+1)*base_fee)\n-\n-        self.log.info('The tx should be evicted by now')\n-        assert txid not in self.nodes[0].getrawmempool()\n-        txdata = self.nodes[0].gettransaction(txid)\n-        assert txdata['confirmations'] ==  0  #confirmation should still be 0\n-\n-        self.log.info('Check that mempoolminfee is larger than minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_greater_than(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n-\n-        self.log.info('Create a mempool tx that will not pass mempoolminfee')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        # specifically fund this tx with a fee < mempoolminfee, >= than minrelaytxfee\n-        txF = self.nodes[0].fundrawtransaction(tx, {'feeRate': relayfee})\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        assert_raises_rpc_error(-26, \"mempool min fee not met\", self.nodes[0].sendrawtransaction, txFS['hex'])\n-\n-if __name__ == '__main__':\n+\n+        node = self.nodes[0]\n+        miniwallet = MiniWallet(node)\n+        relayfee = node.getnetworkinfo()[\"relayfee\"]\n+\n+        self.log.info(\"Check that mempoolminfee is minrelytxfee\")\n+        assert_equal(node.getmempoolinfo()[\"minrelaytxfee\"], Decimal(\"0.00001000\"))\n+        assert_equal(node.getmempoolinfo()[\"mempoolminfee\"], Decimal(\"0.00001000\"))\n+\n+        # Generate 92 UTXOs to flood the mempool\n+        # 1 to create a tx initially that will be evicted from the mempool later\n+        # 90 with a fee rate much higher than the previous UTXO (3 batches of 30 with increasing fee rate)\n+        # And 1 more to verify that this tx does not get added to the mempool with a fee rate less than the mempoolminfee\n+        miniwallet.generate(1 + (3 * 30) + 1)\n+\n+        # Mine 99 blocks so that the UTXOs are allowed to be spent\n+        node.generate(COINBASE_MATURITY - 1)\n+\n+        self.log.info(\"Create a mempool tx that will be evicted\")\n+        tx_to_be_evicted_id = miniwallet.send_self_transfer(\n+            from_node=node, fee_rate=relayfee\n+        )[\"txid\"]\n+\n+        # Increase the tx fee rate massively now to give the next transactions a higher priority in the mempool\n+        base_fee = relayfee * 1000\n+\n+        self.log.info(\"Fill up the mempool with txs with higher fee rate\")\n+        no_of_large_tx_created = 0\n+        for batch_of_txid in range(1, 4):\n+            # Increment the tx fee rate gradually by a factor of (base_fee) for each batch of 30 transactions\n+            no_of_large_tx_created += miniwallet.create_large_transactions(\n+                node, txouts, 30, batch_of_txid * base_fee",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r689355334",
      "id" : 689355334,
      "in_reply_to_id" : 689282534,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4OTM1NTMzNA==",
      "original_commit_id" : "bec7849f5dc4a9fa75b440ddcad9b90e3ebae138",
      "original_line" : 66,
      "original_position" : 117,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : null,
      "pull_request_review_id" : 730476068,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-16T09:41:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689355334",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/55556994?v=4",
         "events_url" : "https://api.github.com/users/ShubhamPalriwala/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ShubhamPalriwala/followers",
         "following_url" : "https://api.github.com/users/ShubhamPalriwala/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ShubhamPalriwala/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ShubhamPalriwala",
         "id" : 55556994,
         "login" : "ShubhamPalriwala",
         "node_id" : "MDQ6VXNlcjU1NTU2OTk0",
         "organizations_url" : "https://api.github.com/users/ShubhamPalriwala/orgs",
         "received_events_url" : "https://api.github.com/users/ShubhamPalriwala/received_events",
         "repos_url" : "https://api.github.com/users/ShubhamPalriwala/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ShubhamPalriwala/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ShubhamPalriwala/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ShubhamPalriwala"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r689689263"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689689263"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think it might be because the block that the coinbase utxo is included in is counted as the first block, so you'd need 99 additional blocks for it to be 100 blocks deep?\r\n\r\nBut also, is it necessary to use `generate`? I think this test can be sped up using the miniwallet function `scan_blocks` instead. There are a few examples of other functional tests using it. Note that you'd need to remove `self.setup_clean_chain = True` to benefit from it. ",
      "commit_id" : "30a68532035821cc7ca325c61259094e415b7de5",
      "created_at" : "2021-08-16T16:34:54Z",
      "diff_hunk" : "@@ -5,70 +5,90 @@\n \"\"\"Test mempool limiting together/eviction with the wallet.\"\"\"\n \n from decimal import Decimal\n+from test_framework.blocktools import COINBASE_MATURITY\n \n from test_framework.test_framework import BitcoinTestFramework\n-from test_framework.util import assert_equal, assert_greater_than, assert_raises_rpc_error, create_confirmed_utxos, create_lots_of_big_transactions, gen_return_txouts\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than,\n+    assert_raises_rpc_error,\n+    gen_return_txouts,\n+)\n+from test_framework.wallet import MiniWallet\n+\n \n class MempoolLimitTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.setup_clean_chain = True\n         self.num_nodes = 1\n-        self.extra_args = [[\n-            \"-acceptnonstdtxn=1\",\n-            \"-maxmempool=5\",\n-            \"-spendzeroconfchange=0\",\n-        ]]\n+        self.extra_args = [\n+            [\n+                \"-acceptnonstdtxn=1\",\n+                \"-maxmempool=5\",\n+                \"-spendzeroconfchange=0\",\n+            ]\n+        ]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n         txouts = gen_return_txouts()\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-\n-        self.log.info('Check that mempoolminfee is minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_equal(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n-\n-        txids = []\n-        utxos = create_confirmed_utxos(relayfee, self.nodes[0], 91)\n-\n-        self.log.info('Create a mempool tx that will be evicted')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        self.nodes[0].settxfee(relayfee) # specifically fund this tx with low fee\n-        txF = self.nodes[0].fundrawtransaction(tx)\n-        self.nodes[0].settxfee(0) # return to automatic fee selection\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        txid = self.nodes[0].sendrawtransaction(txFS['hex'])\n-\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-        base_fee = relayfee*100\n-        for i in range (3):\n-            txids.append([])\n-            txids[i] = create_lots_of_big_transactions(self.nodes[0], txouts, utxos[30*i:30*i+30], 30, (i+1)*base_fee)\n-\n-        self.log.info('The tx should be evicted by now')\n-        assert txid not in self.nodes[0].getrawmempool()\n-        txdata = self.nodes[0].gettransaction(txid)\n-        assert txdata['confirmations'] ==  0  #confirmation should still be 0\n-\n-        self.log.info('Check that mempoolminfee is larger than minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_greater_than(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n-\n-        self.log.info('Create a mempool tx that will not pass mempoolminfee')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        # specifically fund this tx with a fee < mempoolminfee, >= than minrelaytxfee\n-        txF = self.nodes[0].fundrawtransaction(tx, {'feeRate': relayfee})\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        assert_raises_rpc_error(-26, \"mempool min fee not met\", self.nodes[0].sendrawtransaction, txFS['hex'])\n-\n-if __name__ == '__main__':\n+\n+        node = self.nodes[0]\n+        miniwallet = MiniWallet(node)\n+        relayfee = node.getnetworkinfo()[\"relayfee\"]\n+\n+        self.log.info(\"Check that mempoolminfee is minrelytxfee\")\n+        assert_equal(node.getmempoolinfo()[\"minrelaytxfee\"], Decimal(\"0.00001000\"))\n+        assert_equal(node.getmempoolinfo()[\"mempoolminfee\"], Decimal(\"0.00001000\"))\n+\n+        # Generate 92 UTXOs to flood the mempool\n+        # 1 to create a tx initially that will be evicted from the mempool later\n+        # 90 with a fee rate much higher than the previous UTXO (3 batches of 30 with increasing fee rate)\n+        # And 1 more to verify that this tx does not get added to the mempool with a fee rate less than the mempoolminfee\n+        miniwallet.generate(1 + (3 * 30) + 1)\n+\n+        # Mine 99 blocks so that the UTXOs are allowed to be spent",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r689689263",
      "id" : 689689263,
      "in_reply_to_id" : 687413483,
      "line" : 50,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4OTY4OTI2Mw==",
      "original_commit_id" : "bec7849f5dc4a9fa75b440ddcad9b90e3ebae138",
      "original_line" : 43,
      "original_position" : 101,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : 101,
      "pull_request_review_id" : 730917165,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-16T16:39:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689689263",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/41220998?v=4",
         "events_url" : "https://api.github.com/users/DariusParvin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DariusParvin/followers",
         "following_url" : "https://api.github.com/users/DariusParvin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DariusParvin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DariusParvin",
         "id" : 41220998,
         "login" : "DariusParvin",
         "node_id" : "MDQ6VXNlcjQxMjIwOTk4",
         "organizations_url" : "https://api.github.com/users/DariusParvin/orgs",
         "received_events_url" : "https://api.github.com/users/DariusParvin/received_events",
         "repos_url" : "https://api.github.com/users/DariusParvin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DariusParvin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DariusParvin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DariusParvin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r689692932"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689692932"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n        self.log.info(\"Check that mempoolminfee is minrelaytxfee\")\r\n```",
      "commit_id" : "30a68532035821cc7ca325c61259094e415b7de5",
      "created_at" : "2021-08-16T16:40:10Z",
      "diff_hunk" : "@@ -5,70 +5,90 @@\n \"\"\"Test mempool limiting together/eviction with the wallet.\"\"\"\n \n from decimal import Decimal\n+from test_framework.blocktools import COINBASE_MATURITY\n \n from test_framework.test_framework import BitcoinTestFramework\n-from test_framework.util import assert_equal, assert_greater_than, assert_raises_rpc_error, create_confirmed_utxos, create_lots_of_big_transactions, gen_return_txouts\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than,\n+    assert_raises_rpc_error,\n+    gen_return_txouts,\n+)\n+from test_framework.wallet import MiniWallet\n+\n \n class MempoolLimitTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.setup_clean_chain = True\n         self.num_nodes = 1\n-        self.extra_args = [[\n-            \"-acceptnonstdtxn=1\",\n-            \"-maxmempool=5\",\n-            \"-spendzeroconfchange=0\",\n-        ]]\n+        self.extra_args = [\n+            [\n+                \"-acceptnonstdtxn=1\",\n+                \"-maxmempool=5\",\n+                \"-spendzeroconfchange=0\",\n+            ]\n+        ]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n         txouts = gen_return_txouts()\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-\n-        self.log.info('Check that mempoolminfee is minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_equal(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n-\n-        txids = []\n-        utxos = create_confirmed_utxos(relayfee, self.nodes[0], 91)\n-\n-        self.log.info('Create a mempool tx that will be evicted')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        self.nodes[0].settxfee(relayfee) # specifically fund this tx with low fee\n-        txF = self.nodes[0].fundrawtransaction(tx)\n-        self.nodes[0].settxfee(0) # return to automatic fee selection\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        txid = self.nodes[0].sendrawtransaction(txFS['hex'])\n-\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-        base_fee = relayfee*100\n-        for i in range (3):\n-            txids.append([])\n-            txids[i] = create_lots_of_big_transactions(self.nodes[0], txouts, utxos[30*i:30*i+30], 30, (i+1)*base_fee)\n-\n-        self.log.info('The tx should be evicted by now')\n-        assert txid not in self.nodes[0].getrawmempool()\n-        txdata = self.nodes[0].gettransaction(txid)\n-        assert txdata['confirmations'] ==  0  #confirmation should still be 0\n-\n-        self.log.info('Check that mempoolminfee is larger than minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_greater_than(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n-\n-        self.log.info('Create a mempool tx that will not pass mempoolminfee')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        # specifically fund this tx with a fee < mempoolminfee, >= than minrelaytxfee\n-        txF = self.nodes[0].fundrawtransaction(tx, {'feeRate': relayfee})\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        assert_raises_rpc_error(-26, \"mempool min fee not met\", self.nodes[0].sendrawtransaction, txFS['hex'])\n-\n-if __name__ == '__main__':\n+\n+        node = self.nodes[0]\n+        miniwallet = MiniWallet(node)\n+        relayfee = node.getnetworkinfo()[\"relayfee\"]\n+\n+        self.log.info(\"Check that mempoolminfee is minrelytxfee\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r689692932",
      "id" : 689692932,
      "line" : 40,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4OTY5MjkzMg==",
      "original_commit_id" : "30a68532035821cc7ca325c61259094e415b7de5",
      "original_line" : 40,
      "original_position" : 91,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : 91,
      "pull_request_review_id" : 730921885,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-16T17:54:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689692932",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Not sure why CI failed at L71 in mempool_limit.py, locally it checks out (see screenshot below). It looks like CI is reporting 67 for the no of txs in the mempool.\r\n\r\nCan't reproduce that locally here either. All the functional tests pass running master with this merged on top. It might be a rare race condition, or something specific to the 32-bit platform though.",
      "created_at" : "2021-08-16T16:47:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#issuecomment-899659135",
      "id" : 899659135,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22543",
      "node_id" : "IC_kwDOABII5841n7V_",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-16T16:47:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/899659135",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r689706218"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689706218"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n        assert_equal(no_of_tx_created, no_of_tx_ids)\r\n```",
      "commit_id" : "30a68532035821cc7ca325c61259094e415b7de5",
      "created_at" : "2021-08-16T16:59:17Z",
      "diff_hunk" : "@@ -182,6 +183,26 @@ def sendrawtransaction(self, *, from_node, tx_hex):\n         from_node.sendrawtransaction(tx_hex)\n         self.scan_tx(from_node.decoderawtransaction(tx_hex))\n \n+    def send_large_transactions(\n+        self, node, array_of_large_tx, no_of_tx_ids, fee_rate\n+    ):\n+        # Create large transactions by appending txouts in vout\n+        no_of_tx_created = 0\n+        for _ in range(no_of_tx_ids):\n+            # Create a self transfer here to get the tx details and then append the vout to increase the tx size\n+            hex = self.create_self_transfer(from_node=node, fee_rate=fee_rate)['hex']\n+            # Converts it into a CTransaction() instance to append the vouts\n+            tx_instance = from_hex(CTransaction(), hex)\n+            for txout in array_of_large_tx:\n+                tx_instance.vout.append(txout)\n+            tx_hex = tx_instance.serialize().hex()\n+            # Serializes and sends the tx to the nodes\n+            self.sendrawtransaction(from_node=node, tx_hex=tx_hex)\n+            no_of_tx_created += 1\n+        assert_equal(no_of_tx_created,no_of_tx_ids)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r689706218",
      "id" : 689706218,
      "line" : 202,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4OTcwNjIxOA==",
      "original_commit_id" : "30a68532035821cc7ca325c61259094e415b7de5",
      "original_line" : 202,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 28,
      "pull_request_review_id" : 730921885,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-16T17:54:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689706218",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r689710851"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689710851"
         }
      },
      "author_association" : "MEMBER",
      "body" : "variable naming suggestion: replacing `no_of_tx_ids` with `num_txns` ",
      "commit_id" : "30a68532035821cc7ca325c61259094e415b7de5",
      "created_at" : "2021-08-16T17:06:22Z",
      "diff_hunk" : "@@ -182,6 +183,26 @@ def sendrawtransaction(self, *, from_node, tx_hex):\n         from_node.sendrawtransaction(tx_hex)\n         self.scan_tx(from_node.decoderawtransaction(tx_hex))\n \n+    def send_large_transactions(\n+        self, node, array_of_large_tx, no_of_tx_ids, fee_rate",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r689710851",
      "id" : 689710851,
      "line" : 187,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4OTcxMDg1MQ==",
      "original_commit_id" : "30a68532035821cc7ca325c61259094e415b7de5",
      "original_line" : 187,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 13,
      "pull_request_review_id" : 730921885,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-16T17:54:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689710851",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r689712720"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689712720"
         }
      },
      "author_association" : "MEMBER",
      "body" : "since this is being added as a shared helper, would be nice to add a docstring to explain what this function is doing & possibly guidance on how the callers should provide the params. ",
      "commit_id" : "30a68532035821cc7ca325c61259094e415b7de5",
      "created_at" : "2021-08-16T17:09:18Z",
      "diff_hunk" : "@@ -182,6 +183,26 @@ def sendrawtransaction(self, *, from_node, tx_hex):\n         from_node.sendrawtransaction(tx_hex)\n         self.scan_tx(from_node.decoderawtransaction(tx_hex))\n \n+    def send_large_transactions(",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r689712720",
      "id" : 689712720,
      "line" : 186,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4OTcxMjcyMA==",
      "original_commit_id" : "30a68532035821cc7ca325c61259094e415b7de5",
      "original_line" : 186,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 12,
      "pull_request_review_id" : 730921885,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-16T17:54:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689712720",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r689714991"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689714991"
         }
      },
      "author_association" : "MEMBER",
      "body" : "did you mean this comment to be a line prior? since the serialization is the previous line & the sending is the next line. \r\n\r\nbut you could just get rid of this comment. generally we want to add comments if we can explain _why_ we're doing something. and let the code explain _what_ is happening. so in this case, this comment isn't adding any new information. ",
      "commit_id" : "30a68532035821cc7ca325c61259094e415b7de5",
      "created_at" : "2021-08-16T17:12:32Z",
      "diff_hunk" : "@@ -182,6 +183,26 @@ def sendrawtransaction(self, *, from_node, tx_hex):\n         from_node.sendrawtransaction(tx_hex)\n         self.scan_tx(from_node.decoderawtransaction(tx_hex))\n \n+    def send_large_transactions(\n+        self, node, array_of_large_tx, no_of_tx_ids, fee_rate\n+    ):\n+        # Create large transactions by appending txouts in vout\n+        no_of_tx_created = 0\n+        for _ in range(no_of_tx_ids):\n+            # Create a self transfer here to get the tx details and then append the vout to increase the tx size\n+            hex = self.create_self_transfer(from_node=node, fee_rate=fee_rate)['hex']\n+            # Converts it into a CTransaction() instance to append the vouts\n+            tx_instance = from_hex(CTransaction(), hex)\n+            for txout in array_of_large_tx:\n+                tx_instance.vout.append(txout)\n+            tx_hex = tx_instance.serialize().hex()\n+            # Serializes and sends the tx to the nodes",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r689714991",
      "id" : 689714991,
      "line" : 199,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4OTcxNDk5MQ==",
      "original_commit_id" : "30a68532035821cc7ca325c61259094e415b7de5",
      "original_line" : 199,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 25,
      "pull_request_review_id" : 730921885,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-16T17:54:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689714991",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r689722737"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689722737"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm not really seeing the value of this local variable. if there was a way to return early in the for loop, incrementing the number could be a way to keep track of successes. but since there isn't any logic of the sort, any unsuccessful attempts would simply cause an error (eg. by `sendrawtransaction` throwing an exception). so `assert_equal(no_of_tx_created,no_of_tx_ids)` isn't actually increasing any guarantees from this code. \r\n\r\nmy suggestion would be to remove the `no_of_tx_created` logic from this function. you could return `no_of_tx_ids` if you want to maintain the current return value, or just update the call site since that is where the number of transactions to create gets passed in anyways. ",
      "commit_id" : "30a68532035821cc7ca325c61259094e415b7de5",
      "created_at" : "2021-08-16T17:24:26Z",
      "diff_hunk" : "@@ -182,6 +183,26 @@ def sendrawtransaction(self, *, from_node, tx_hex):\n         from_node.sendrawtransaction(tx_hex)\n         self.scan_tx(from_node.decoderawtransaction(tx_hex))\n \n+    def send_large_transactions(\n+        self, node, array_of_large_tx, no_of_tx_ids, fee_rate\n+    ):\n+        # Create large transactions by appending txouts in vout\n+        no_of_tx_created = 0",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r689722737",
      "id" : 689722737,
      "line" : 190,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4OTcyMjczNw==",
      "original_commit_id" : "30a68532035821cc7ca325c61259094e415b7de5",
      "original_line" : 190,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 16,
      "pull_request_review_id" : 730921885,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-16T17:54:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689722737",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r689727241"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689727241"
         }
      },
      "author_association" : "MEMBER",
      "body" : "you could move this line down to right before the for loop where it gets used \r\n\r\nto clarify, I'm talking about: `txouts = gen_return_txouts()`",
      "commit_id" : "30a68532035821cc7ca325c61259094e415b7de5",
      "created_at" : "2021-08-16T17:31:07Z",
      "diff_hunk" : "@@ -5,70 +5,90 @@\n \"\"\"Test mempool limiting together/eviction with the wallet.\"\"\"\n \n from decimal import Decimal\n+from test_framework.blocktools import COINBASE_MATURITY\n \n from test_framework.test_framework import BitcoinTestFramework\n-from test_framework.util import assert_equal, assert_greater_than, assert_raises_rpc_error, create_confirmed_utxos, create_lots_of_big_transactions, gen_return_txouts\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than,\n+    assert_raises_rpc_error,\n+    gen_return_txouts,\n+)\n+from test_framework.wallet import MiniWallet\n+\n \n class MempoolLimitTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.setup_clean_chain = True\n         self.num_nodes = 1\n-        self.extra_args = [[\n-            \"-acceptnonstdtxn=1\",\n-            \"-maxmempool=5\",\n-            \"-spendzeroconfchange=0\",\n-        ]]\n+        self.extra_args = [\n+            [\n+                \"-acceptnonstdtxn=1\",\n+                \"-maxmempool=5\",\n+                \"-spendzeroconfchange=0\",\n+            ]\n+        ]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n         txouts = gen_return_txouts()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r689727241",
      "id" : 689727241,
      "line" : 34,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4OTcyNzI0MQ==",
      "original_commit_id" : "30a68532035821cc7ca325c61259094e415b7de5",
      "original_line" : 34,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : 39,
      "pull_request_review_id" : 730921885,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-16T17:56:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689727241",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r689851379"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689851379"
         }
      },
      "author_association" : "NONE",
      "body" : "This assertion is itself removed now!",
      "commit_id" : "5b5fc338a1d7bc471066819e57b12c3593fddf5a",
      "created_at" : "2021-08-16T20:51:57Z",
      "diff_hunk" : "@@ -182,6 +183,26 @@ def sendrawtransaction(self, *, from_node, tx_hex):\n         from_node.sendrawtransaction(tx_hex)\n         self.scan_tx(from_node.decoderawtransaction(tx_hex))\n \n+    def send_large_transactions(\n+        self, node, array_of_large_tx, no_of_tx_ids, fee_rate\n+    ):\n+        # Create large transactions by appending txouts in vout\n+        no_of_tx_created = 0\n+        for _ in range(no_of_tx_ids):\n+            # Create a self transfer here to get the tx details and then append the vout to increase the tx size\n+            hex = self.create_self_transfer(from_node=node, fee_rate=fee_rate)['hex']\n+            # Converts it into a CTransaction() instance to append the vouts\n+            tx_instance = from_hex(CTransaction(), hex)\n+            for txout in array_of_large_tx:\n+                tx_instance.vout.append(txout)\n+            tx_hex = tx_instance.serialize().hex()\n+            # Serializes and sends the tx to the nodes\n+            self.sendrawtransaction(from_node=node, tx_hex=tx_hex)\n+            no_of_tx_created += 1\n+        assert_equal(no_of_tx_created,no_of_tx_ids)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r689851379",
      "id" : 689851379,
      "in_reply_to_id" : 689706218,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4OTg1MTM3OQ==",
      "original_commit_id" : "30a68532035821cc7ca325c61259094e415b7de5",
      "original_line" : 202,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : null,
      "pull_request_review_id" : 731123657,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-16T20:51:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689851379",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/55556994?v=4",
         "events_url" : "https://api.github.com/users/ShubhamPalriwala/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ShubhamPalriwala/followers",
         "following_url" : "https://api.github.com/users/ShubhamPalriwala/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ShubhamPalriwala/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ShubhamPalriwala",
         "id" : 55556994,
         "login" : "ShubhamPalriwala",
         "node_id" : "MDQ6VXNlcjU1NTU2OTk0",
         "organizations_url" : "https://api.github.com/users/ShubhamPalriwala/orgs",
         "received_events_url" : "https://api.github.com/users/ShubhamPalriwala/received_events",
         "repos_url" : "https://api.github.com/users/ShubhamPalriwala/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ShubhamPalriwala/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ShubhamPalriwala/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ShubhamPalriwala"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r689851680"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689851680"
         }
      },
      "author_association" : "NONE",
      "body" : "Done! Thanks",
      "commit_id" : "5b5fc338a1d7bc471066819e57b12c3593fddf5a",
      "created_at" : "2021-08-16T20:52:30Z",
      "diff_hunk" : "@@ -182,6 +183,26 @@ def sendrawtransaction(self, *, from_node, tx_hex):\n         from_node.sendrawtransaction(tx_hex)\n         self.scan_tx(from_node.decoderawtransaction(tx_hex))\n \n+    def send_large_transactions(\n+        self, node, array_of_large_tx, no_of_tx_ids, fee_rate\n+    ):\n+        # Create large transactions by appending txouts in vout\n+        no_of_tx_created = 0",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r689851680",
      "id" : 689851680,
      "in_reply_to_id" : 689722737,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4OTg1MTY4MA==",
      "original_commit_id" : "30a68532035821cc7ca325c61259094e415b7de5",
      "original_line" : 190,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : null,
      "pull_request_review_id" : 731124031,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-16T20:52:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689851680",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/55556994?v=4",
         "events_url" : "https://api.github.com/users/ShubhamPalriwala/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ShubhamPalriwala/followers",
         "following_url" : "https://api.github.com/users/ShubhamPalriwala/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ShubhamPalriwala/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ShubhamPalriwala",
         "id" : 55556994,
         "login" : "ShubhamPalriwala",
         "node_id" : "MDQ6VXNlcjU1NTU2OTk0",
         "organizations_url" : "https://api.github.com/users/ShubhamPalriwala/orgs",
         "received_events_url" : "https://api.github.com/users/ShubhamPalriwala/received_events",
         "repos_url" : "https://api.github.com/users/ShubhamPalriwala/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ShubhamPalriwala/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ShubhamPalriwala/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ShubhamPalriwala"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "hm, unfortunately looks like the 32-bit + dash [gui] run is failing on the same assertion ð ",
      "created_at" : "2021-08-16T23:24:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#issuecomment-899881987",
      "id" : 899881987,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22543",
      "node_id" : "IC_kwDOABII5841oxwD",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-16T23:24:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/899881987",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "It's failing when we take the minimum batch size of 22 transactions, increasing this will increase the test duration but the CI will pass as earlier",
      "created_at" : "2021-08-17T04:20:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#issuecomment-899982010",
      "id" : 899982010,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22543",
      "node_id" : "IC_kwDOABII5841pKK6",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-17T04:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/899982010",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/55556994?v=4",
         "events_url" : "https://api.github.com/users/ShubhamPalriwala/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ShubhamPalriwala/followers",
         "following_url" : "https://api.github.com/users/ShubhamPalriwala/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ShubhamPalriwala/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ShubhamPalriwala",
         "id" : 55556994,
         "login" : "ShubhamPalriwala",
         "node_id" : "MDQ6VXNlcjU1NTU2OTk0",
         "organizations_url" : "https://api.github.com/users/ShubhamPalriwala/orgs",
         "received_events_url" : "https://api.github.com/users/ShubhamPalriwala/received_events",
         "repos_url" : "https://api.github.com/users/ShubhamPalriwala/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ShubhamPalriwala/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ShubhamPalriwala/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ShubhamPalriwala"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r690702210"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/690702210"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Minor nit:\r\n\r\n```suggestion\r\n        # Deliberately tries to create a tx with a fee less than the minimum mempool fee to assert that it does not get added to the mempool\r\n```",
      "commit_id" : "5dbe0df05c443db1923bec73d094b3813fd0be24",
      "created_at" : "2021-08-17T20:33:44Z",
      "diff_hunk" : "@@ -20,55 +23,59 @@ def set_test_params(self):\n         ]]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n-        txouts = gen_return_txouts()\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n \n-        self.log.info('Check that mempoolminfee is minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_equal(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n+        node = self.nodes[0]\n+        miniwallet = MiniWallet(node)\n+        relayfee = node.getnetworkinfo()['relayfee']\n+\n+        self.log.info('Check that mempoolminfee is minrelaytxfee')\n+        assert_equal(node.getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n+        assert_equal(node.getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n+\n+        # Generate 68 UTXOs to flood the mempool\n+        # 1 to create a tx initially that will be evicted from the mempool later\n+        # 75 with a fee rate much higher than the previous UTXO (3 batches of 25 with increasing fee rate)\n+        # And 1 more to verify that this tx does not get added to the mempool with a fee rate less than the mempoolminfee\n+        miniwallet.generate(77)\n \n-        txids = []\n-        utxos = create_confirmed_utxos(relayfee, self.nodes[0], 91)\n+        # Mine 99 blocks so that the UTXOs are allowed to be spent\n+        node.generate(COINBASE_MATURITY - 1)\n \n         self.log.info('Create a mempool tx that will be evicted')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        self.nodes[0].settxfee(relayfee) # specifically fund this tx with low fee\n-        txF = self.nodes[0].fundrawtransaction(tx)\n-        self.nodes[0].settxfee(0) # return to automatic fee selection\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        txid = self.nodes[0].sendrawtransaction(txFS['hex'])\n-\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-        base_fee = relayfee*100\n-        for i in range (3):\n-            txids.append([])\n-            txids[i] = create_lots_of_big_transactions(self.nodes[0], txouts, utxos[30*i:30*i+30], 30, (i+1)*base_fee)\n+        tx_to_be_evicted_id = miniwallet.send_self_transfer(\n+            from_node=node, fee_rate=relayfee\n+        )[\"txid\"]\n+\n+        # Increase the tx fee rate massively now to give the next transactions a higher priority in the mempool\n+        base_fee = relayfee * 1000\n+\n+        self.log.info('Fill up the mempool with txs with higher fee rate')\n+        no_of_large_tx_sent = 0\n+        txouts = gen_return_txouts()\n+\n+        for batch_of_txid in range(1, 4):\n+            # Increment the tx fee rate gradually by a factor of (base_fee) for each batch of 25 transactions\n+            no_of_large_tx_sent += miniwallet.send_large_transactions(\n+                node, txouts, 25, batch_of_txid * base_fee\n+            )\n \n         self.log.info('The tx should be evicted by now')\n-        assert txid not in self.nodes[0].getrawmempool()\n-        txdata = self.nodes[0].gettransaction(txid)\n-        assert txdata['confirmations'] ==  0  #confirmation should still be 0\n+        # The number of transactions created should be greater than the ones present in the mempool\n+        assert_greater_than(no_of_large_tx_sent, len(node.getrawmempool()))\n+        # Initial tx created should not be present in the mempool anymore as it had a lower fee rate\n+        assert tx_to_be_evicted_id not in node.getrawmempool()\n \n-        self.log.info('Check that mempoolminfee is larger than minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_greater_than(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n+        self.log.info('Check that mempoolminfee is larger than minrelaytxfee')\n+        assert_equal(node.getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n+        assert_greater_than(\n+            node.getmempoolinfo()['mempoolminfee'], Decimal('0.00001000')\n+        )\n \n+        # Deliberately tries to create a tx with a fee less that the minimum mempool fee to assert that it does not get added to the mempool",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r690702210",
      "id" : 690702210,
      "line" : 75,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MDcwMjIxMA==",
      "original_commit_id" : "5dbe0df05c443db1923bec73d094b3813fd0be24",
      "original_line" : 75,
      "original_position" : 98,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : 98,
      "pull_request_review_id" : 732198935,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-17T20:33:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/690702210",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23586626?v=4",
         "events_url" : "https://api.github.com/users/Zero-1729/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Zero-1729/followers",
         "following_url" : "https://api.github.com/users/Zero-1729/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Zero-1729/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Zero-1729",
         "id" : 23586626,
         "login" : "Zero-1729",
         "node_id" : "MDQ6VXNlcjIzNTg2NjI2",
         "organizations_url" : "https://api.github.com/users/Zero-1729/orgs",
         "received_events_url" : "https://api.github.com/users/Zero-1729/received_events",
         "repos_url" : "https://api.github.com/users/Zero-1729/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Zero-1729/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Zero-1729/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Zero-1729"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r690712721"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/690712721"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Could consider rewording to:\r\n\r\n```suggestion\r\n        # Increase the tx fee rate massively to give subsequent transactions a higher priority in the mempool\r\n```",
      "commit_id" : "5dbe0df05c443db1923bec73d094b3813fd0be24",
      "created_at" : "2021-08-17T20:49:54Z",
      "diff_hunk" : "@@ -20,55 +23,59 @@ def set_test_params(self):\n         ]]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n-        txouts = gen_return_txouts()\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n \n-        self.log.info('Check that mempoolminfee is minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_equal(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n+        node = self.nodes[0]\n+        miniwallet = MiniWallet(node)\n+        relayfee = node.getnetworkinfo()['relayfee']\n+\n+        self.log.info('Check that mempoolminfee is minrelaytxfee')\n+        assert_equal(node.getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n+        assert_equal(node.getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n+\n+        # Generate 68 UTXOs to flood the mempool\n+        # 1 to create a tx initially that will be evicted from the mempool later\n+        # 75 with a fee rate much higher than the previous UTXO (3 batches of 25 with increasing fee rate)\n+        # And 1 more to verify that this tx does not get added to the mempool with a fee rate less than the mempoolminfee\n+        miniwallet.generate(77)\n \n-        txids = []\n-        utxos = create_confirmed_utxos(relayfee, self.nodes[0], 91)\n+        # Mine 99 blocks so that the UTXOs are allowed to be spent\n+        node.generate(COINBASE_MATURITY - 1)\n \n         self.log.info('Create a mempool tx that will be evicted')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        self.nodes[0].settxfee(relayfee) # specifically fund this tx with low fee\n-        txF = self.nodes[0].fundrawtransaction(tx)\n-        self.nodes[0].settxfee(0) # return to automatic fee selection\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        txid = self.nodes[0].sendrawtransaction(txFS['hex'])\n-\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-        base_fee = relayfee*100\n-        for i in range (3):\n-            txids.append([])\n-            txids[i] = create_lots_of_big_transactions(self.nodes[0], txouts, utxos[30*i:30*i+30], 30, (i+1)*base_fee)\n+        tx_to_be_evicted_id = miniwallet.send_self_transfer(\n+            from_node=node, fee_rate=relayfee\n+        )[\"txid\"]\n+\n+        # Increase the tx fee rate massively now to give the next transactions a higher priority in the mempool",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r690712721",
      "id" : 690712721,
      "line" : 50,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MDcxMjcyMQ==",
      "original_commit_id" : "5dbe0df05c443db1923bec73d094b3813fd0be24",
      "original_line" : 50,
      "original_position" : 67,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : 67,
      "pull_request_review_id" : 732212272,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-17T20:49:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/690712721",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23586626?v=4",
         "events_url" : "https://api.github.com/users/Zero-1729/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Zero-1729/followers",
         "following_url" : "https://api.github.com/users/Zero-1729/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Zero-1729/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Zero-1729",
         "id" : 23586626,
         "login" : "Zero-1729",
         "node_id" : "MDQ6VXNlcjIzNTg2NjI2",
         "organizations_url" : "https://api.github.com/users/Zero-1729/orgs",
         "received_events_url" : "https://api.github.com/users/Zero-1729/received_events",
         "repos_url" : "https://api.github.com/users/Zero-1729/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Zero-1729/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Zero-1729/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Zero-1729"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "The CI passes now\r\nPS: Updated the batch size to 25 transactions below\r\nhttps://github.com/bitcoin/bitcoin/blob/3773532d682a3bfb0cea8898da10caa5f444a23e/test/functional/mempool_limit.py#L67\r\n\r\nThe PR is ready for a review",
      "created_at" : "2021-08-18T10:28:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#issuecomment-901002209",
      "id" : 901002209,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22543",
      "node_id" : "IC_kwDOABII5841tDPh",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-18T10:31:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/901002209",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/55556994?v=4",
         "events_url" : "https://api.github.com/users/ShubhamPalriwala/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ShubhamPalriwala/followers",
         "following_url" : "https://api.github.com/users/ShubhamPalriwala/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ShubhamPalriwala/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ShubhamPalriwala",
         "id" : 55556994,
         "login" : "ShubhamPalriwala",
         "node_id" : "MDQ6VXNlcjU1NTU2OTk0",
         "organizations_url" : "https://api.github.com/users/ShubhamPalriwala/orgs",
         "received_events_url" : "https://api.github.com/users/ShubhamPalriwala/received_events",
         "repos_url" : "https://api.github.com/users/ShubhamPalriwala/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ShubhamPalriwala/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ShubhamPalriwala/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ShubhamPalriwala"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r691510124"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691510124"
         }
      },
      "author_association" : "MEMBER",
      "body" : "unnecessary new line",
      "commit_id" : "3773532d682a3bfb0cea8898da10caa5f444a23e",
      "created_at" : "2021-08-18T18:36:59Z",
      "diff_hunk" : "@@ -5,70 +5,91 @@\n \"\"\"Test mempool limiting together/eviction with the wallet.\"\"\"\n \n from decimal import Decimal\n+from test_framework.blocktools import COINBASE_MATURITY\n \n from test_framework.test_framework import BitcoinTestFramework\n-from test_framework.util import assert_equal, assert_greater_than, assert_raises_rpc_error, create_confirmed_utxos, create_lots_of_big_transactions, gen_return_txouts\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than,\n+    assert_raises_rpc_error,\n+    gen_return_txouts,\n+)\n+from test_framework.wallet import MiniWallet\n+\n \n class MempoolLimitTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.setup_clean_chain = True\n         self.num_nodes = 1\n-        self.extra_args = [[\n-            \"-acceptnonstdtxn=1\",\n-            \"-maxmempool=5\",\n-            \"-spendzeroconfchange=0\",\n-        ]]\n+        self.extra_args = [\n+            [\n+                \"-acceptnonstdtxn=1\",\n+                \"-maxmempool=5\",\n+                \"-spendzeroconfchange=0\",\n+            ]\n+        ]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r691510124",
      "id" : 691510124,
      "line" : 34,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MTUxMDEyNA==",
      "original_commit_id" : "3773532d682a3bfb0cea8898da10caa5f444a23e",
      "original_line" : 34,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : 39,
      "pull_request_review_id" : 733230435,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-18T18:49:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691510124",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r691512702"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691512702"
         }
      },
      "author_association" : "MEMBER",
      "body" : "68 is no longer accurate\r\n\r\n```suggestion\r\n        # Generate 77 UTXOs to flood the mempool\r\n```\r\n\r\nthis demonstrates one of the reasons it's better for comments to supplement reasoning rather than what the code is doing- if the code changes, it's easy for the comments to fall out of date.\r\n\r\nSo a better option would be to remove the hardcoding of the UTXO number from these comments. ",
      "commit_id" : "3773532d682a3bfb0cea8898da10caa5f444a23e",
      "created_at" : "2021-08-18T18:40:50Z",
      "diff_hunk" : "@@ -5,70 +5,91 @@\n \"\"\"Test mempool limiting together/eviction with the wallet.\"\"\"\n \n from decimal import Decimal\n+from test_framework.blocktools import COINBASE_MATURITY\n \n from test_framework.test_framework import BitcoinTestFramework\n-from test_framework.util import assert_equal, assert_greater_than, assert_raises_rpc_error, create_confirmed_utxos, create_lots_of_big_transactions, gen_return_txouts\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than,\n+    assert_raises_rpc_error,\n+    gen_return_txouts,\n+)\n+from test_framework.wallet import MiniWallet\n+\n \n class MempoolLimitTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.setup_clean_chain = True\n         self.num_nodes = 1\n-        self.extra_args = [[\n-            \"-acceptnonstdtxn=1\",\n-            \"-maxmempool=5\",\n-            \"-spendzeroconfchange=0\",\n-        ]]\n+        self.extra_args = [\n+            [\n+                \"-acceptnonstdtxn=1\",\n+                \"-maxmempool=5\",\n+                \"-spendzeroconfchange=0\",\n+            ]\n+        ]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n+\n+        node = self.nodes[0]\n+        miniwallet = MiniWallet(node)\n+        relayfee = node.getnetworkinfo()[\"relayfee\"]\n+\n+        self.log.info(\"Check that mempoolminfee is minrelaytxfee\")\n+        assert_equal(node.getmempoolinfo()[\"minrelaytxfee\"], Decimal(\"0.00001000\"))\n+        assert_equal(node.getmempoolinfo()[\"mempoolminfee\"], Decimal(\"0.00001000\"))\n+\n+        # Generate 68 UTXOs to flood the mempool",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r691512702",
      "id" : 691512702,
      "line" : 43,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MTUxMjcwMg==",
      "original_commit_id" : "3773532d682a3bfb0cea8898da10caa5f444a23e",
      "original_line" : 43,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : 48,
      "pull_request_review_id" : 733230435,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-18T18:49:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691512702",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r691517640"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691517640"
         }
      },
      "author_association" : "MEMBER",
      "body" : "since you introduced this code in the last commit, it would make more sense to just style it properly there & then not retouch in the subsequent commit ",
      "commit_id" : "3773532d682a3bfb0cea8898da10caa5f444a23e",
      "created_at" : "2021-08-18T18:48:13Z",
      "diff_hunk" : "@@ -60,22 +67,29 @@ def run_test(self):\n                 node, txouts, 25, batch_of_txid * base_fee\n             )\n \n-        self.log.info('The tx should be evicted by now')\n+        self.log.info(\"The tx should be evicted by now\")\n         # The number of transactions created should be greater than the ones present in the mempool\n         assert_greater_than(no_of_large_tx_sent, len(node.getrawmempool()))\n         # Initial tx created should not be present in the mempool anymore as it had a lower fee rate\n         assert tx_to_be_evicted_id not in node.getrawmempool()\n \n-        self.log.info('Check that mempoolminfee is larger than minrelaytxfee')\n-        assert_equal(node.getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n+        self.log.info(\"Check that mempoolminfee is larger than minrelaytxfee\")\n+        assert_equal(node.getmempoolinfo()[\"minrelaytxfee\"], Decimal(\"0.00001000\"))\n         assert_greater_than(\n-            node.getmempoolinfo()['mempoolminfee'], Decimal('0.00001000')\n+            node.getmempoolinfo()[\"mempoolminfee\"], Decimal(\"0.00001000\")\n         )\n \n         # Deliberately tries to create a tx with a fee less than the minimum mempool fee to assert that it does not get added to the mempool\n-        self.log.info('Create a mempool tx that will not pass mempoolminfee')\n-        assert_raises_rpc_error(-26,\"mempool min fee not met\",miniwallet.send_self_transfer,from_node=node,fee_rate=relayfee,mempool_valid=False)\n+        self.log.info(\"Create a mempool tx that will not pass mempoolminfee\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r691517640",
      "id" : 691517640,
      "line" : 83,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MTUxNzY0MA==",
      "original_commit_id" : "3773532d682a3bfb0cea8898da10caa5f444a23e",
      "original_line" : 83,
      "original_position" : 89,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : 134,
      "pull_request_review_id" : 733230435,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-18T18:49:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691517640",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r693041377"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693041377"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Listing the parameters in an extra line is a style that we don't follow for function definitions, as the following search in the codebase shows:\r\n```\r\n$ cd ./test/functional\r\n$ git grep \"def .*($\"\r\ntest_framework/wallet.py:    def send_large_transactions(\r\n```\r\n(the only result is the one introduced in this commit)\r\n\r\n```suggestion\r\n    def send_large_transactions(self, node, array_of_large_tx, num_txns, fee_rate):\r\n```\r\n",
      "commit_id" : "a198207b4930fa091e8737ec96969868a7ded659",
      "created_at" : "2021-08-20T15:37:57Z",
      "diff_hunk" : "@@ -182,6 +183,23 @@ def sendrawtransaction(self, *, from_node, tx_hex):\n         from_node.sendrawtransaction(tx_hex)\n         self.scan_tx(from_node.decoderawtransaction(tx_hex))\n \n+    def send_large_transactions(\n+        self, node, array_of_large_tx, num_txns, fee_rate\n+    ):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r693041377",
      "id" : 693041377,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MzA0MTM3Nw==",
      "original_commit_id" : "f0afb33dd8868f6d40e64d57ce299518d9ff3444",
      "original_line" : 188,
      "original_position" : 14,
      "original_start_line" : 186,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : null,
      "pull_request_review_id" : 735155616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-08-20T16:10:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693041377",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r693048747"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693048747"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "For the CTransaction case, we have an explicit helper `tx_from_hex` that is already imported (i.e. you can remove the `from_hex` import again):\r\n```suggestion\r\n            tx_instance = tx_from_hex(hex)\r\n```",
      "commit_id" : "a198207b4930fa091e8737ec96969868a7ded659",
      "created_at" : "2021-08-20T15:48:54Z",
      "diff_hunk" : "@@ -182,6 +183,23 @@ def sendrawtransaction(self, *, from_node, tx_hex):\n         from_node.sendrawtransaction(tx_hex)\n         self.scan_tx(from_node.decoderawtransaction(tx_hex))\n \n+    def send_large_transactions(\n+        self, node, array_of_large_tx, num_txns, fee_rate\n+    ):\n+        \"\"\"Creates and sends large transactions with the passed fee rate.\"\"\"\n+        # Create large transactions by appending txouts in vout\n+        for _ in range(num_txns):\n+            # Create a self transfer here to get the tx details and then append the vout to increase the tx size\n+            hex = self.create_self_transfer(from_node=node, fee_rate=fee_rate)['hex']\n+            # Converts it into a CTransaction() instance to append the vouts\n+            tx_instance = from_hex(CTransaction(), hex)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r693048747",
      "id" : 693048747,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MzA0ODc0Nw==",
      "original_commit_id" : "f0afb33dd8868f6d40e64d57ce299518d9ff3444",
      "original_line" : 195,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : null,
      "pull_request_review_id" : 735155616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-20T16:10:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693048747",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r693050011"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693050011"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: probably a matter of taste, but there's no need for introducing a temporary variable:\r\n```suggestion\r\n            self.sendrawtransaction(from_node=node, tx_hex=tx_instance.serialize().hex())\r\n```",
      "commit_id" : "a198207b4930fa091e8737ec96969868a7ded659",
      "created_at" : "2021-08-20T15:50:53Z",
      "diff_hunk" : "@@ -182,6 +183,23 @@ def sendrawtransaction(self, *, from_node, tx_hex):\n         from_node.sendrawtransaction(tx_hex)\n         self.scan_tx(from_node.decoderawtransaction(tx_hex))\n \n+    def send_large_transactions(\n+        self, node, array_of_large_tx, num_txns, fee_rate\n+    ):\n+        \"\"\"Creates and sends large transactions with the passed fee rate.\"\"\"\n+        # Create large transactions by appending txouts in vout\n+        for _ in range(num_txns):\n+            # Create a self transfer here to get the tx details and then append the vout to increase the tx size\n+            hex = self.create_self_transfer(from_node=node, fee_rate=fee_rate)['hex']\n+            # Converts it into a CTransaction() instance to append the vouts\n+            tx_instance = from_hex(CTransaction(), hex)\n+            for txout in array_of_large_tx:\n+                tx_instance.vout.append(txout)\n+            tx_hex = tx_instance.serialize().hex()\n+            self.sendrawtransaction(from_node=node, tx_hex=tx_hex)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r693050011",
      "id" : 693050011,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MzA1MDAxMQ==",
      "original_commit_id" : "f0afb33dd8868f6d40e64d57ce299518d9ff3444",
      "original_line" : 199,
      "original_position" : 25,
      "original_start_line" : 198,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : null,
      "pull_request_review_id" : 735155616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-08-20T16:10:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693050011",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r693053005"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693053005"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'd suggest grouping the `COINBASE_MATURITY` import to the (test-framework related) ones below, i.e.:\r\n```suggestion\r\nfrom decimal import Decimal\r\n\r\nfrom test_framework.blocktools import COINBASE_MATURITY\r\nfrom test_framework.test_framework import BitcoinTestFramework\r\n```",
      "commit_id" : "a198207b4930fa091e8737ec96969868a7ded659",
      "created_at" : "2021-08-20T15:55:42Z",
      "diff_hunk" : "@@ -5,9 +5,12 @@\n \"\"\"Test mempool limiting together/eviction with the wallet.\"\"\"\n \n from decimal import Decimal\n+from test_framework.blocktools import COINBASE_MATURITY\n \n from test_framework.test_framework import BitcoinTestFramework",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r693053005",
      "id" : 693053005,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MzA1MzAwNQ==",
      "original_commit_id" : "f0afb33dd8868f6d40e64d57ce299518d9ff3444",
      "original_line" : 10,
      "original_position" : 6,
      "original_start_line" : 7,
      "path" : "test/functional/mempool_limit.py",
      "position" : null,
      "pull_request_review_id" : 735155616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-08-20T16:10:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693053005",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r693061654"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693061654"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'd in some way mention here that each batch consists of 25 transactions -- without that it is not immedately clear how you end up with the number 77.",
      "commit_id" : "a198207b4930fa091e8737ec96969868a7ded659",
      "created_at" : "2021-08-20T16:09:24Z",
      "diff_hunk" : "@@ -20,55 +23,58 @@ def set_test_params(self):\n         ]]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n-        txouts = gen_return_txouts()\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n+        node = self.nodes[0]\n+        miniwallet = MiniWallet(node)\n+        relayfee = node.getnetworkinfo()['relayfee']\n \n-        self.log.info('Check that mempoolminfee is minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_equal(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n+        self.log.info('Check that mempoolminfee is minrelaytxfee')\n+        assert_equal(node.getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n+        assert_equal(node.getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n \n-        txids = []\n-        utxos = create_confirmed_utxos(relayfee, self.nodes[0], 91)\n+        # Generate UTXOs to flood the mempool\n+        # 1 to create a tx initially that will be evicted from the mempool later\n+        # 3 batches of multiple transactions with a fee rate much higher than the previous UTXO",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r693061654",
      "id" : 693061654,
      "line" : 37,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MzA2MTY1NA==",
      "original_commit_id" : "f0afb33dd8868f6d40e64d57ce299518d9ff3444",
      "original_line" : 37,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : 38,
      "pull_request_review_id" : 735155616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-20T16:10:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693061654",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r693061901"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693061901"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n        # Deliberately try to create a tx with a fee less than the minimum mempool fee to assert that it does not get added to the mempool\r\n```",
      "commit_id" : "a198207b4930fa091e8737ec96969868a7ded659",
      "created_at" : "2021-08-20T16:09:51Z",
      "diff_hunk" : "@@ -20,55 +23,58 @@ def set_test_params(self):\n         ]]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n-        txouts = gen_return_txouts()\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n+        node = self.nodes[0]\n+        miniwallet = MiniWallet(node)\n+        relayfee = node.getnetworkinfo()['relayfee']\n \n-        self.log.info('Check that mempoolminfee is minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_equal(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n+        self.log.info('Check that mempoolminfee is minrelaytxfee')\n+        assert_equal(node.getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n+        assert_equal(node.getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n \n-        txids = []\n-        utxos = create_confirmed_utxos(relayfee, self.nodes[0], 91)\n+        # Generate UTXOs to flood the mempool\n+        # 1 to create a tx initially that will be evicted from the mempool later\n+        # 3 batches of multiple transactions with a fee rate much higher than the previous UTXO\n+        # And 1 more to verify that this tx does not get added to the mempool with a fee rate less than the mempoolminfee\n+        miniwallet.generate(77)\n+\n+        # Mine 99 blocks so that the UTXOs are allowed to be spent\n+        node.generate(COINBASE_MATURITY - 1)\n \n         self.log.info('Create a mempool tx that will be evicted')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        self.nodes[0].settxfee(relayfee) # specifically fund this tx with low fee\n-        txF = self.nodes[0].fundrawtransaction(tx)\n-        self.nodes[0].settxfee(0) # return to automatic fee selection\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        txid = self.nodes[0].sendrawtransaction(txFS['hex'])\n-\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-        base_fee = relayfee*100\n-        for i in range (3):\n-            txids.append([])\n-            txids[i] = create_lots_of_big_transactions(self.nodes[0], txouts, utxos[30*i:30*i+30], 30, (i+1)*base_fee)\n+        tx_to_be_evicted_id = miniwallet.send_self_transfer(\n+            from_node=node, fee_rate=relayfee\n+        )[\"txid\"]\n+\n+        # Increase the tx fee rate massively to give the subsequent transactions a higher priority in the mempool\n+        base_fee = relayfee * 1000\n+\n+        self.log.info('Fill up the mempool with txs with higher fee rate')\n+        no_of_large_tx_sent = 0\n+        txouts = gen_return_txouts()\n+\n+        for batch_of_txid in range(1, 4):\n+            # Increment the tx fee rate gradually by a factor of (base_fee) for each batch\n+            no_of_large_tx_sent += miniwallet.send_large_transactions(\n+                node, txouts, 25, batch_of_txid * base_fee\n+            )\n \n         self.log.info('The tx should be evicted by now')\n-        assert txid not in self.nodes[0].getrawmempool()\n-        txdata = self.nodes[0].gettransaction(txid)\n-        assert txdata['confirmations'] ==  0  #confirmation should still be 0\n+        # The number of transactions created should be greater than the ones present in the mempool\n+        assert_greater_than(no_of_large_tx_sent, len(node.getrawmempool()))\n+        # Initial tx created should not be present in the mempool anymore as it had a lower fee rate\n+        assert tx_to_be_evicted_id not in node.getrawmempool()\n \n-        self.log.info('Check that mempoolminfee is larger than minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_greater_than(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n+        self.log.info('Check that mempoolminfee is larger than minrelaytxfee')\n+        assert_equal(node.getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n+        assert_greater_than(\n+            node.getmempoolinfo()['mempoolminfee'], Decimal('0.00001000')\n+        )\n \n+        # Deliberately tries to create a tx with a fee less than the minimum mempool fee to assert that it does not get added to the mempool",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r693061901",
      "id" : 693061901,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MzA2MTkwMQ==",
      "original_commit_id" : "f0afb33dd8868f6d40e64d57ce299518d9ff3444",
      "original_line" : 74,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : null,
      "pull_request_review_id" : 735155616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-20T16:10:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693061901",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r693085854"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693085854"
         }
      },
      "author_association" : "NONE",
      "body" : "Updated the code below the comments as `miniwallet.generate(1 + (3 * 25) + 1)` to make it clear",
      "commit_id" : "a198207b4930fa091e8737ec96969868a7ded659",
      "created_at" : "2021-08-20T16:48:57Z",
      "diff_hunk" : "@@ -20,55 +23,58 @@ def set_test_params(self):\n         ]]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n-        txouts = gen_return_txouts()\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n+        node = self.nodes[0]\n+        miniwallet = MiniWallet(node)\n+        relayfee = node.getnetworkinfo()['relayfee']\n \n-        self.log.info('Check that mempoolminfee is minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_equal(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n+        self.log.info('Check that mempoolminfee is minrelaytxfee')\n+        assert_equal(node.getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n+        assert_equal(node.getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n \n-        txids = []\n-        utxos = create_confirmed_utxos(relayfee, self.nodes[0], 91)\n+        # Generate UTXOs to flood the mempool\n+        # 1 to create a tx initially that will be evicted from the mempool later\n+        # 3 batches of multiple transactions with a fee rate much higher than the previous UTXO",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r693085854",
      "id" : 693085854,
      "in_reply_to_id" : 693061654,
      "line" : 37,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MzA4NTg1NA==",
      "original_commit_id" : "f0afb33dd8868f6d40e64d57ce299518d9ff3444",
      "original_line" : 37,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : 38,
      "pull_request_review_id" : 735213847,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-20T16:48:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693085854",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/55556994?v=4",
         "events_url" : "https://api.github.com/users/ShubhamPalriwala/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ShubhamPalriwala/followers",
         "following_url" : "https://api.github.com/users/ShubhamPalriwala/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ShubhamPalriwala/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ShubhamPalriwala",
         "id" : 55556994,
         "login" : "ShubhamPalriwala",
         "node_id" : "MDQ6VXNlcjU1NTU2OTk0",
         "organizations_url" : "https://api.github.com/users/ShubhamPalriwala/orgs",
         "received_events_url" : "https://api.github.com/users/ShubhamPalriwala/received_events",
         "repos_url" : "https://api.github.com/users/ShubhamPalriwala/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ShubhamPalriwala/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ShubhamPalriwala/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ShubhamPalriwala"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@ShubhamPalriwala: Thanks for the changes. Currently the second commit (subject \"style: mempool_limit.py\") is not showing up any more, you probably forgot it in your latest force-push?",
      "created_at" : "2021-08-21T21:24:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#issuecomment-903178101",
      "id" : 903178101,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22543",
      "node_id" : "IC_kwDOABII58411Wd1",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-21T21:24:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/903178101",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-08-24T09:58:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#issuecomment-904499720",
      "id" : 904499720,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22543",
      "node_id" : "IC_kwDOABII58416ZII",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-24T09:58:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/904499720",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "The PR has been rebased and is ready to be reviewed",
      "created_at" : "2021-08-24T20:27:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#issuecomment-904951021",
      "id" : 904951021,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22543",
      "node_id" : "IC_kwDOABII58418HTt",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-24T20:27:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/904951021",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/55556994?v=4",
         "events_url" : "https://api.github.com/users/ShubhamPalriwala/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ShubhamPalriwala/followers",
         "following_url" : "https://api.github.com/users/ShubhamPalriwala/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ShubhamPalriwala/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ShubhamPalriwala",
         "id" : 55556994,
         "login" : "ShubhamPalriwala",
         "node_id" : "MDQ6VXNlcjU1NTU2OTk0",
         "organizations_url" : "https://api.github.com/users/ShubhamPalriwala/orgs",
         "received_events_url" : "https://api.github.com/users/ShubhamPalriwala/received_events",
         "repos_url" : "https://api.github.com/users/ShubhamPalriwala/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ShubhamPalriwala/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ShubhamPalriwala/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ShubhamPalriwala"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r695649626"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695649626"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Sorry for not noticing this earlier in my last review round, but it looks like the conversion from hex-to-tx is not necessary here, since `create_self_transfer` already provides you a `CTransaction` instance (can be accessed via `['tx']`). I.e. the method can even be shorter:\r\n\r\n```diff\r\n--- a/test/functional/test_framework/wallet.py\r\n+++ b/test/functional/test_framework/wallet.py\r\n@@ -187,12 +187,10 @@ class MiniWallet:\r\n         # Create large transactions by appending txouts in vout\r\n         for _ in range(num_txns):\r\n             # Create a self transfer here to get the tx details and then append the vout to increase the tx size\r\n-            hex = self.create_self_transfer(from_node=node, fee_rate=fee_rate)['hex']\r\n-            # Converts it into a CTransaction() instance to append the vouts\r\n-            tx_instance = tx_from_hex(hex)\r\n+            tx = self.create_self_transfer(from_node=node, fee_rate=fee_rate)['tx']\r\n             for txout in array_of_large_tx:\r\n-                tx_instance.vout.append(txout)\r\n-            self.sendrawtransaction(from_node=node, tx_hex=tx_instance.serialize().hex())\r\n+                tx.vout.append(txout)\r\n+            self.sendrawtransaction(from_node=node, tx_hex=tx.serialize().hex())\r\n         return num_txns\r\n```",
      "commit_id" : "53283a6b278c183124bb766e72ee33a9fd79a74b",
      "created_at" : "2021-08-25T11:11:38Z",
      "diff_hunk" : "@@ -182,6 +182,19 @@ def sendrawtransaction(self, *, from_node, tx_hex):\n         from_node.sendrawtransaction(tx_hex)\n         self.scan_tx(from_node.decoderawtransaction(tx_hex))\n \n+    def send_large_transactions(self, node, array_of_large_tx, num_txns, fee_rate):\n+        \"\"\"Creates and sends large transactions with the passed fee rate.\"\"\"\n+        # Create large transactions by appending txouts in vout\n+        for _ in range(num_txns):\n+            # Create a self transfer here to get the tx details and then append the vout to increase the tx size\n+            hex = self.create_self_transfer(from_node=node, fee_rate=fee_rate)['hex']",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r695649626",
      "id" : 695649626,
      "line" : 190,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NTY0OTYyNg==",
      "original_commit_id" : "eb0ff37956ea3f823e9155a5a259e17f37e0da0b",
      "original_line" : 190,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 9,
      "pull_request_review_id" : 738216589,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-25T11:11:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695649626",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r695653992"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695653992"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Would be nice to use `self.generate(miniwallet, ...)` for new code",
      "commit_id" : "53283a6b278c183124bb766e72ee33a9fd79a74b",
      "created_at" : "2021-08-25T11:18:24Z",
      "diff_hunk" : "@@ -6,69 +6,76 @@\n \n from decimal import Decimal\n \n+from test_framework.blocktools import COINBASE_MATURITY\n from test_framework.test_framework import BitcoinTestFramework\n-from test_framework.util import assert_equal, assert_greater_than, assert_raises_rpc_error, create_confirmed_utxos, create_lots_of_big_transactions, gen_return_txouts\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than,\n+    assert_raises_rpc_error,\n+    gen_return_txouts,\n+)\n+from test_framework.wallet import MiniWallet\n+\n \n class MempoolLimitTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.setup_clean_chain = True\n         self.num_nodes = 1\n-        self.extra_args = [[\n-            \"-acceptnonstdtxn=1\",\n-            \"-maxmempool=5\",\n-            \"-spendzeroconfchange=0\",\n-        ]]\n+        self.extra_args = [\n+            [\n+                \"-acceptnonstdtxn=1\",\n+                \"-maxmempool=5\",\n+                \"-spendzeroconfchange=0\",\n+            ]\n+        ]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n+        node = self.nodes[0]\n+        miniwallet = MiniWallet(node)\n+        relayfee = node.getnetworkinfo()[\"relayfee\"]\n+\n+        self.log.info(\"Check that mempoolminfee is minrelaytxfee\")\n+        assert_equal(node.getmempoolinfo()[\"minrelaytxfee\"], Decimal(\"0.00001000\"))\n+        assert_equal(node.getmempoolinfo()[\"mempoolminfee\"], Decimal(\"0.00001000\"))\n+\n+        # Generate UTXOs to flood the mempool\n+        # 1 to create a tx initially that will be evicted from the mempool later\n+        # 3 batches of multiple transactions with a fee rate much higher than the previous UTXO\n+        # And 1 more to verify that this tx does not get added to the mempool with a fee rate less than the mempoolminfee\n+        miniwallet.generate(1 + (3 * 25) + 1)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r695653992",
      "id" : 695653992,
      "line" : 46,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NTY1Mzk5Mg==",
      "original_commit_id" : "53283a6b278c183124bb766e72ee33a9fd79a74b",
      "original_line" : 46,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : 50,
      "pull_request_review_id" : 738222355,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-25T11:18:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695653992",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r695654053"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695654053"
         }
      },
      "author_association" : "MEMBER",
      "body" : "same",
      "commit_id" : "53283a6b278c183124bb766e72ee33a9fd79a74b",
      "created_at" : "2021-08-25T11:18:30Z",
      "diff_hunk" : "@@ -6,69 +6,76 @@\n \n from decimal import Decimal\n \n+from test_framework.blocktools import COINBASE_MATURITY\n from test_framework.test_framework import BitcoinTestFramework\n-from test_framework.util import assert_equal, assert_greater_than, assert_raises_rpc_error, create_confirmed_utxos, create_lots_of_big_transactions, gen_return_txouts\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than,\n+    assert_raises_rpc_error,\n+    gen_return_txouts,\n+)\n+from test_framework.wallet import MiniWallet\n+\n \n class MempoolLimitTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.setup_clean_chain = True\n         self.num_nodes = 1\n-        self.extra_args = [[\n-            \"-acceptnonstdtxn=1\",\n-            \"-maxmempool=5\",\n-            \"-spendzeroconfchange=0\",\n-        ]]\n+        self.extra_args = [\n+            [\n+                \"-acceptnonstdtxn=1\",\n+                \"-maxmempool=5\",\n+                \"-spendzeroconfchange=0\",\n+            ]\n+        ]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n+        node = self.nodes[0]\n+        miniwallet = MiniWallet(node)\n+        relayfee = node.getnetworkinfo()[\"relayfee\"]\n+\n+        self.log.info(\"Check that mempoolminfee is minrelaytxfee\")\n+        assert_equal(node.getmempoolinfo()[\"minrelaytxfee\"], Decimal(\"0.00001000\"))\n+        assert_equal(node.getmempoolinfo()[\"mempoolminfee\"], Decimal(\"0.00001000\"))\n+\n+        # Generate UTXOs to flood the mempool\n+        # 1 to create a tx initially that will be evicted from the mempool later\n+        # 3 batches of multiple transactions with a fee rate much higher than the previous UTXO\n+        # And 1 more to verify that this tx does not get added to the mempool with a fee rate less than the mempoolminfee\n+        miniwallet.generate(1 + (3 * 25) + 1)\n+\n+        # Mine 99 blocks so that the UTXOs are allowed to be spent\n+        node.generate(COINBASE_MATURITY - 1)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r695654053",
      "id" : 695654053,
      "line" : 49,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NTY1NDA1Mw==",
      "original_commit_id" : "53283a6b278c183124bb766e72ee33a9fd79a74b",
      "original_line" : 49,
      "original_position" : 53,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : 53,
      "pull_request_review_id" : 738222355,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-25T11:18:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695654053",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Thanks for the suggestions @theStack and @MarcoFalke!\r\n\r\nI've made, tested, and pushed the subsequent commits!\r\nThe PR is ready to be reviewed again :)",
      "created_at" : "2021-08-26T09:40:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#issuecomment-906253222",
      "id" : 906253222,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22543",
      "node_id" : "IC_kwDOABII5842BFOm",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-26T09:40:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/906253222",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/55556994?v=4",
         "events_url" : "https://api.github.com/users/ShubhamPalriwala/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ShubhamPalriwala/followers",
         "following_url" : "https://api.github.com/users/ShubhamPalriwala/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ShubhamPalriwala/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ShubhamPalriwala",
         "id" : 55556994,
         "login" : "ShubhamPalriwala",
         "node_id" : "MDQ6VXNlcjU1NTU2OTk0",
         "organizations_url" : "https://api.github.com/users/ShubhamPalriwala/orgs",
         "received_events_url" : "https://api.github.com/users/ShubhamPalriwala/received_events",
         "repos_url" : "https://api.github.com/users/ShubhamPalriwala/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ShubhamPalriwala/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ShubhamPalriwala/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ShubhamPalriwala"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r699204455"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/699204455"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "in https://github.com/bitcoin/bitcoin/pull/22543/commits/4902ce86afc6b9c8a7a72b1c91466fe26a00f9b9:\r\n\r\nid suggest using a named variable (instead of just 25) to make this more clear. also, `no_of_large...` should be `num_of_large...`:\r\n\r\n```suggestion\r\ntx_batch_size = 25\r\nfor batch_of_txid in range(1, 4):\r\n    # Increment the tx fee rate gradually by a factor of (base_fee) for each batch\r\n    miniwallet.send_large_transactions(node, txouts, tx_batch_size, batch_of_txid * base_fee) \r\n    num_of_large_tx_sent += tx_batch_size",
      "commit_id" : "4c5c9d6ee6c079dd51661ed6b97f7916759399bf",
      "created_at" : "2021-08-31T10:46:35Z",
      "diff_hunk" : "@@ -20,55 +23,52 @@ def set_test_params(self):\n         ]]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n-        txouts = gen_return_txouts()\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n+        node = self.nodes[0]\n+        miniwallet = MiniWallet(node)\n+        relayfee = node.getnetworkinfo()['relayfee']\n \n-        self.log.info('Check that mempoolminfee is minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_equal(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n+        self.log.info('Check that mempoolminfee is minrelaytxfee')\n+        assert_equal(node.getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n+        assert_equal(node.getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n \n-        txids = []\n-        utxos = create_confirmed_utxos(self, relayfee, self.nodes[0], 91)\n+        # Generate UTXOs to flood the mempool\n+        # 1 to create a tx initially that will be evicted from the mempool later\n+        # 3 batches of multiple transactions with a fee rate much higher than the previous UTXO\n+        # And 1 more to verify that this tx does not get added to the mempool with a fee rate less than the mempoolminfee\n+        self.generate(miniwallet,1 + (3 * 25) + 1)\n+\n+        # Mine 99 blocks so that the UTXOs are allowed to be spent\n+        self.generate(node,COINBASE_MATURITY - 1)\n \n         self.log.info('Create a mempool tx that will be evicted')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        self.nodes[0].settxfee(relayfee) # specifically fund this tx with low fee\n-        txF = self.nodes[0].fundrawtransaction(tx)\n-        self.nodes[0].settxfee(0) # return to automatic fee selection\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        txid = self.nodes[0].sendrawtransaction(txFS['hex'])\n-\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-        base_fee = relayfee*100\n-        for i in range (3):\n-            txids.append([])\n-            txids[i] = create_lots_of_big_transactions(self.nodes[0], txouts, utxos[30*i:30*i+30], 30, (i+1)*base_fee)\n+        tx_to_be_evicted_id = miniwallet.send_self_transfer(from_node=node, fee_rate=relayfee)[\"txid\"]\n+\n+        # Increase the tx fee rate massively to give the subsequent transactions a higher priority in the mempool\n+        base_fee = relayfee * 1000\n+\n+        self.log.info('Fill up the mempool with txs with higher fee rate')\n+        no_of_large_tx_sent = 0\n+        txouts = gen_return_txouts()\n+\n+        for batch_of_txid in range(1, 4):\n+            # Increment the tx fee rate gradually by a factor of (base_fee) for each batch\n+            no_of_large_tx_sent += miniwallet.send_large_transactions(node, txouts, 25, batch_of_txid * base_fee)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r699204455",
      "id" : 699204455,
      "line" : 63,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5OTIwNDQ1NQ==",
      "original_commit_id" : "4902ce86afc6b9c8a7a72b1c91466fe26a00f9b9",
      "original_line" : 56,
      "original_position" : 72,
      "original_start_line" : 54,
      "path" : "test/functional/mempool_limit.py",
      "position" : 113,
      "pull_request_review_id" : 742567370,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : 61,
      "start_side" : "RIGHT",
      "updated_at" : "2021-08-31T10:55:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/699204455",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r699207130"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/699207130"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "is there a reason you have this helper function returning the same variable that was passed in? personally, i find this confusing and would not expect to have to handle a returned value if i were using this in another test",
      "commit_id" : "4c5c9d6ee6c079dd51661ed6b97f7916759399bf",
      "created_at" : "2021-08-31T10:50:12Z",
      "diff_hunk" : "@@ -182,6 +182,17 @@ def sendrawtransaction(self, *, from_node, tx_hex):\n         from_node.sendrawtransaction(tx_hex)\n         self.scan_tx(from_node.decoderawtransaction(tx_hex))\n \n+    def send_large_transactions(self, node, array_of_large_tx, num_txns, fee_rate):\n+        \"\"\"Creates and sends large transactions with the passed fee rate.\"\"\"\n+        # Create large transactions by appending txouts in vout\n+        for _ in range(num_txns):\n+            # Create a self transfer here to get the tx details and then append the vout to increase the tx size\n+            tx = self.create_self_transfer(from_node=node, fee_rate=fee_rate)['tx']\n+            for txout in array_of_large_tx:\n+                tx.vout.append(txout)\n+            self.sendrawtransaction(from_node=node, tx_hex=tx.serialize().hex())\n+        return num_txns",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r699207130",
      "id" : 699207130,
      "line" : 194,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5OTIwNzEzMA==",
      "original_commit_id" : "4902ce86afc6b9c8a7a72b1c91466fe26a00f9b9",
      "original_line" : 194,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 13,
      "pull_request_review_id" : 742567370,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-31T10:55:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/699207130",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r700956653"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700956653"
         }
      },
      "author_association" : "NONE",
      "body" : "Thank you for the naming suggestion. Has been fixed",
      "commit_id" : "e8a3ff3b586beb4e2bb2d77a3bf4d7b98a1a2df2",
      "created_at" : "2021-09-02T10:30:06Z",
      "diff_hunk" : "@@ -20,55 +23,52 @@ def set_test_params(self):\n         ]]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n-        txouts = gen_return_txouts()\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n+        node = self.nodes[0]\n+        miniwallet = MiniWallet(node)\n+        relayfee = node.getnetworkinfo()['relayfee']\n \n-        self.log.info('Check that mempoolminfee is minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_equal(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n+        self.log.info('Check that mempoolminfee is minrelaytxfee')\n+        assert_equal(node.getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n+        assert_equal(node.getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n \n-        txids = []\n-        utxos = create_confirmed_utxos(self, relayfee, self.nodes[0], 91)\n+        # Generate UTXOs to flood the mempool\n+        # 1 to create a tx initially that will be evicted from the mempool later\n+        # 3 batches of multiple transactions with a fee rate much higher than the previous UTXO\n+        # And 1 more to verify that this tx does not get added to the mempool with a fee rate less than the mempoolminfee\n+        self.generate(miniwallet,1 + (3 * 25) + 1)\n+\n+        # Mine 99 blocks so that the UTXOs are allowed to be spent\n+        self.generate(node,COINBASE_MATURITY - 1)\n \n         self.log.info('Create a mempool tx that will be evicted')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        self.nodes[0].settxfee(relayfee) # specifically fund this tx with low fee\n-        txF = self.nodes[0].fundrawtransaction(tx)\n-        self.nodes[0].settxfee(0) # return to automatic fee selection\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        txid = self.nodes[0].sendrawtransaction(txFS['hex'])\n-\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-        base_fee = relayfee*100\n-        for i in range (3):\n-            txids.append([])\n-            txids[i] = create_lots_of_big_transactions(self.nodes[0], txouts, utxos[30*i:30*i+30], 30, (i+1)*base_fee)\n+        tx_to_be_evicted_id = miniwallet.send_self_transfer(from_node=node, fee_rate=relayfee)[\"txid\"]\n+\n+        # Increase the tx fee rate massively to give the subsequent transactions a higher priority in the mempool\n+        base_fee = relayfee * 1000\n+\n+        self.log.info('Fill up the mempool with txs with higher fee rate')\n+        no_of_large_tx_sent = 0\n+        txouts = gen_return_txouts()\n+\n+        for batch_of_txid in range(1, 4):\n+            # Increment the tx fee rate gradually by a factor of (base_fee) for each batch\n+            no_of_large_tx_sent += miniwallet.send_large_transactions(node, txouts, 25, batch_of_txid * base_fee)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r700956653",
      "id" : 700956653,
      "in_reply_to_id" : 699204455,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMDk1NjY1Mw==",
      "original_commit_id" : "4902ce86afc6b9c8a7a72b1c91466fe26a00f9b9",
      "original_line" : 56,
      "original_position" : 72,
      "original_start_line" : 54,
      "path" : "test/functional/mempool_limit.py",
      "position" : null,
      "pull_request_review_id" : 744890237,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-09-02T10:30:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700956653",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/55556994?v=4",
         "events_url" : "https://api.github.com/users/ShubhamPalriwala/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ShubhamPalriwala/followers",
         "following_url" : "https://api.github.com/users/ShubhamPalriwala/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ShubhamPalriwala/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ShubhamPalriwala",
         "id" : 55556994,
         "login" : "ShubhamPalriwala",
         "node_id" : "MDQ6VXNlcjU1NTU2OTk0",
         "organizations_url" : "https://api.github.com/users/ShubhamPalriwala/orgs",
         "received_events_url" : "https://api.github.com/users/ShubhamPalriwala/received_events",
         "repos_url" : "https://api.github.com/users/ShubhamPalriwala/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ShubhamPalriwala/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ShubhamPalriwala/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ShubhamPalriwala"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r700957832"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700957832"
         }
      },
      "author_association" : "NONE",
      "body" : "Makes sense, as pointed out by other reviewers too, I have taken this into consideration, and converted this into a void function.",
      "commit_id" : "e8a3ff3b586beb4e2bb2d77a3bf4d7b98a1a2df2",
      "created_at" : "2021-09-02T10:31:54Z",
      "diff_hunk" : "@@ -182,6 +182,17 @@ def sendrawtransaction(self, *, from_node, tx_hex):\n         from_node.sendrawtransaction(tx_hex)\n         self.scan_tx(from_node.decoderawtransaction(tx_hex))\n \n+    def send_large_transactions(self, node, array_of_large_tx, num_txns, fee_rate):\n+        \"\"\"Creates and sends large transactions with the passed fee rate.\"\"\"\n+        # Create large transactions by appending txouts in vout\n+        for _ in range(num_txns):\n+            # Create a self transfer here to get the tx details and then append the vout to increase the tx size\n+            tx = self.create_self_transfer(from_node=node, fee_rate=fee_rate)['tx']\n+            for txout in array_of_large_tx:\n+                tx.vout.append(txout)\n+            self.sendrawtransaction(from_node=node, tx_hex=tx.serialize().hex())\n+        return num_txns",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r700957832",
      "id" : 700957832,
      "in_reply_to_id" : 699207130,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMDk1NzgzMg==",
      "original_commit_id" : "4902ce86afc6b9c8a7a72b1c91466fe26a00f9b9",
      "original_line" : 194,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : null,
      "pull_request_review_id" : 744891755,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-02T10:31:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700957832",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/55556994?v=4",
         "events_url" : "https://api.github.com/users/ShubhamPalriwala/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ShubhamPalriwala/followers",
         "following_url" : "https://api.github.com/users/ShubhamPalriwala/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ShubhamPalriwala/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ShubhamPalriwala",
         "id" : 55556994,
         "login" : "ShubhamPalriwala",
         "node_id" : "MDQ6VXNlcjU1NTU2OTk0",
         "organizations_url" : "https://api.github.com/users/ShubhamPalriwala/orgs",
         "received_events_url" : "https://api.github.com/users/ShubhamPalriwala/received_events",
         "repos_url" : "https://api.github.com/users/ShubhamPalriwala/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ShubhamPalriwala/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ShubhamPalriwala/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ShubhamPalriwala"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "## PR ready for review\r\n\r\nThis PR has been made more understandable by the recent reviews! Changes have been made as suggested and it's once again Up for Review.",
      "created_at" : "2021-09-02T10:50:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#issuecomment-911529668",
      "id" : 911529668,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22543",
      "node_id" : "IC_kwDOABII5842VNbE",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-02T10:50:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/911529668",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/55556994?v=4",
         "events_url" : "https://api.github.com/users/ShubhamPalriwala/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ShubhamPalriwala/followers",
         "following_url" : "https://api.github.com/users/ShubhamPalriwala/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ShubhamPalriwala/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ShubhamPalriwala",
         "id" : 55556994,
         "login" : "ShubhamPalriwala",
         "node_id" : "MDQ6VXNlcjU1NTU2OTk0",
         "organizations_url" : "https://api.github.com/users/ShubhamPalriwala/orgs",
         "received_events_url" : "https://api.github.com/users/ShubhamPalriwala/received_events",
         "repos_url" : "https://api.github.com/users/ShubhamPalriwala/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ShubhamPalriwala/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ShubhamPalriwala/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ShubhamPalriwala"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r700978781"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700978781"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "this should be \r\n```suggestion\r\n            num_of_large_tx_sent += tx_batch_size\r\n```\r\nper https://www.python.org/dev/peps/pep-0008/#other-recommendations",
      "commit_id" : "e8a3ff3b586beb4e2bb2d77a3bf4d7b98a1a2df2",
      "created_at" : "2021-09-02T11:04:44Z",
      "diff_hunk" : "@@ -20,55 +23,55 @@ def set_test_params(self):\n         ]]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n-        txouts = gen_return_txouts()\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n+        node = self.nodes[0]\n+        miniwallet = MiniWallet(node)\n+        relayfee = node.getnetworkinfo()['relayfee']\n \n-        self.log.info('Check that mempoolminfee is minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_equal(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n+        self.log.info('Check that mempoolminfee is minrelaytxfee')\n+        assert_equal(node.getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n+        assert_equal(node.getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n \n-        txids = []\n-        utxos = create_confirmed_utxos(self, relayfee, self.nodes[0], 91)\n+        tx_batch_size = 25\n+        num_of_batches = 3\n+        # Generate UTXOs to flood the mempool\n+        # 1 to create a tx initially that will be evicted from the mempool later\n+        # 3 batches of multiple transactions with a fee rate much higher than the previous UTXO\n+        # And 1 more to verify that this tx does not get added to the mempool with a fee rate less than the mempoolminfee\n+        self.generate(miniwallet,1 + (num_of_batches * tx_batch_size) + 1)\n+\n+        # Mine 99 blocks so that the UTXOs are allowed to be spent\n+        self.generate(node,COINBASE_MATURITY - 1)\n \n         self.log.info('Create a mempool tx that will be evicted')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        self.nodes[0].settxfee(relayfee) # specifically fund this tx with low fee\n-        txF = self.nodes[0].fundrawtransaction(tx)\n-        self.nodes[0].settxfee(0) # return to automatic fee selection\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        txid = self.nodes[0].sendrawtransaction(txFS['hex'])\n-\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-        base_fee = relayfee*100\n-        for i in range (3):\n-            txids.append([])\n-            txids[i] = create_lots_of_big_transactions(self.nodes[0], txouts, utxos[30*i:30*i+30], 30, (i+1)*base_fee)\n+        tx_to_be_evicted_id = miniwallet.send_self_transfer(from_node=node, fee_rate=relayfee)[\"txid\"]\n+\n+        # Increase the tx fee rate massively to give the subsequent transactions a higher priority in the mempool\n+        base_fee = relayfee * 1000\n+\n+        self.log.info('Fill up the mempool with txs with higher fee rate')\n+        num_of_large_tx_sent = 0\n+        txouts = gen_return_txouts()\n+\n+        for batch_of_txid in range(num_of_batches):\n+            # Increment the tx fee rate gradually by a factor of (base_fee) for each batch\n+            miniwallet.send_large_transactions(node, txouts, tx_batch_size, (batch_of_txid+1) * base_fee)\n+            num_of_large_tx_sent +=tx_batch_size",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r700978781",
      "id" : 700978781,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMDk3ODc4MQ==",
      "original_commit_id" : "0b361fe5b841f7c96b6dcfe805ee695ea49a1935",
      "original_line" : 59,
      "original_position" : 75,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : null,
      "pull_request_review_id" : 744919729,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-02T11:05:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700978781",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r700998339"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700998339"
         }
      },
      "author_association" : "NONE",
      "body" : "All the styling changes have been handled in e8a3ff3b586beb4e2bb2d77a3bf4d7b98a1a2df2 :))\r\n\r\nHope this answers the query",
      "commit_id" : "e8a3ff3b586beb4e2bb2d77a3bf4d7b98a1a2df2",
      "created_at" : "2021-09-02T11:35:38Z",
      "diff_hunk" : "@@ -20,55 +23,55 @@ def set_test_params(self):\n         ]]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n-        txouts = gen_return_txouts()\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n+        node = self.nodes[0]\n+        miniwallet = MiniWallet(node)\n+        relayfee = node.getnetworkinfo()['relayfee']\n \n-        self.log.info('Check that mempoolminfee is minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_equal(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n+        self.log.info('Check that mempoolminfee is minrelaytxfee')\n+        assert_equal(node.getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n+        assert_equal(node.getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n \n-        txids = []\n-        utxos = create_confirmed_utxos(self, relayfee, self.nodes[0], 91)\n+        tx_batch_size = 25\n+        num_of_batches = 3\n+        # Generate UTXOs to flood the mempool\n+        # 1 to create a tx initially that will be evicted from the mempool later\n+        # 3 batches of multiple transactions with a fee rate much higher than the previous UTXO\n+        # And 1 more to verify that this tx does not get added to the mempool with a fee rate less than the mempoolminfee\n+        self.generate(miniwallet,1 + (num_of_batches * tx_batch_size) + 1)\n+\n+        # Mine 99 blocks so that the UTXOs are allowed to be spent\n+        self.generate(node,COINBASE_MATURITY - 1)\n \n         self.log.info('Create a mempool tx that will be evicted')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        self.nodes[0].settxfee(relayfee) # specifically fund this tx with low fee\n-        txF = self.nodes[0].fundrawtransaction(tx)\n-        self.nodes[0].settxfee(0) # return to automatic fee selection\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        txid = self.nodes[0].sendrawtransaction(txFS['hex'])\n-\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-        base_fee = relayfee*100\n-        for i in range (3):\n-            txids.append([])\n-            txids[i] = create_lots_of_big_transactions(self.nodes[0], txouts, utxos[30*i:30*i+30], 30, (i+1)*base_fee)\n+        tx_to_be_evicted_id = miniwallet.send_self_transfer(from_node=node, fee_rate=relayfee)[\"txid\"]\n+\n+        # Increase the tx fee rate massively to give the subsequent transactions a higher priority in the mempool\n+        base_fee = relayfee * 1000\n+\n+        self.log.info('Fill up the mempool with txs with higher fee rate')\n+        num_of_large_tx_sent = 0\n+        txouts = gen_return_txouts()\n+\n+        for batch_of_txid in range(num_of_batches):\n+            # Increment the tx fee rate gradually by a factor of (base_fee) for each batch\n+            miniwallet.send_large_transactions(node, txouts, tx_batch_size, (batch_of_txid+1) * base_fee)\n+            num_of_large_tx_sent +=tx_batch_size",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r700998339",
      "id" : 700998339,
      "in_reply_to_id" : 700978781,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMDk5ODMzOQ==",
      "original_commit_id" : "0b361fe5b841f7c96b6dcfe805ee695ea49a1935",
      "original_line" : 59,
      "original_position" : 75,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : null,
      "pull_request_review_id" : 744946025,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-02T11:35:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700998339",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/55556994?v=4",
         "events_url" : "https://api.github.com/users/ShubhamPalriwala/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ShubhamPalriwala/followers",
         "following_url" : "https://api.github.com/users/ShubhamPalriwala/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ShubhamPalriwala/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ShubhamPalriwala",
         "id" : 55556994,
         "login" : "ShubhamPalriwala",
         "node_id" : "MDQ6VXNlcjU1NTU2OTk0",
         "organizations_url" : "https://api.github.com/users/ShubhamPalriwala/orgs",
         "received_events_url" : "https://api.github.com/users/ShubhamPalriwala/received_events",
         "repos_url" : "https://api.github.com/users/ShubhamPalriwala/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ShubhamPalriwala/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ShubhamPalriwala/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ShubhamPalriwala"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r701022511"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701022511"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ah, gotcha, i missed that in the second commit.\r\n\r\nin general, I would avoid re-editing the same line multiple times in different commits as it requires the reviewer to look at the same line multiple times. not a big deal tho",
      "commit_id" : "e8a3ff3b586beb4e2bb2d77a3bf4d7b98a1a2df2",
      "created_at" : "2021-09-02T12:12:26Z",
      "diff_hunk" : "@@ -20,55 +23,55 @@ def set_test_params(self):\n         ]]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n-        txouts = gen_return_txouts()\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n+        node = self.nodes[0]\n+        miniwallet = MiniWallet(node)\n+        relayfee = node.getnetworkinfo()['relayfee']\n \n-        self.log.info('Check that mempoolminfee is minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_equal(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n+        self.log.info('Check that mempoolminfee is minrelaytxfee')\n+        assert_equal(node.getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n+        assert_equal(node.getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n \n-        txids = []\n-        utxos = create_confirmed_utxos(self, relayfee, self.nodes[0], 91)\n+        tx_batch_size = 25\n+        num_of_batches = 3\n+        # Generate UTXOs to flood the mempool\n+        # 1 to create a tx initially that will be evicted from the mempool later\n+        # 3 batches of multiple transactions with a fee rate much higher than the previous UTXO\n+        # And 1 more to verify that this tx does not get added to the mempool with a fee rate less than the mempoolminfee\n+        self.generate(miniwallet,1 + (num_of_batches * tx_batch_size) + 1)\n+\n+        # Mine 99 blocks so that the UTXOs are allowed to be spent\n+        self.generate(node,COINBASE_MATURITY - 1)\n \n         self.log.info('Create a mempool tx that will be evicted')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        self.nodes[0].settxfee(relayfee) # specifically fund this tx with low fee\n-        txF = self.nodes[0].fundrawtransaction(tx)\n-        self.nodes[0].settxfee(0) # return to automatic fee selection\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        txid = self.nodes[0].sendrawtransaction(txFS['hex'])\n-\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-        base_fee = relayfee*100\n-        for i in range (3):\n-            txids.append([])\n-            txids[i] = create_lots_of_big_transactions(self.nodes[0], txouts, utxos[30*i:30*i+30], 30, (i+1)*base_fee)\n+        tx_to_be_evicted_id = miniwallet.send_self_transfer(from_node=node, fee_rate=relayfee)[\"txid\"]\n+\n+        # Increase the tx fee rate massively to give the subsequent transactions a higher priority in the mempool\n+        base_fee = relayfee * 1000\n+\n+        self.log.info('Fill up the mempool with txs with higher fee rate')\n+        num_of_large_tx_sent = 0\n+        txouts = gen_return_txouts()\n+\n+        for batch_of_txid in range(num_of_batches):\n+            # Increment the tx fee rate gradually by a factor of (base_fee) for each batch\n+            miniwallet.send_large_transactions(node, txouts, tx_batch_size, (batch_of_txid+1) * base_fee)\n+            num_of_large_tx_sent +=tx_batch_size",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r701022511",
      "id" : 701022511,
      "in_reply_to_id" : 700978781,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMTAyMjUxMQ==",
      "original_commit_id" : "0b361fe5b841f7c96b6dcfe805ee695ea49a1935",
      "original_line" : 59,
      "original_position" : 75,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : null,
      "pull_request_review_id" : 744978622,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-02T12:13:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701022511",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ACK https://github.com/bitcoin/bitcoin/commit/e8a3ff3b586beb4e2bb2d77a3bf4d7b98a1a2df2\r\n\r\nnicely done, happy to see the `send_large_transactions` helper function being added to miniwallet!",
      "created_at" : "2021-09-02T12:14:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#issuecomment-911607555",
      "id" : 911607555,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22543",
      "node_id" : "IC_kwDOABII5842VgcD",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-02T12:16:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/911607555",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r701210709"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701210709"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It is a bit confusing to mess with the style in unrelated lines in the first commit and then fix it up in the second commit. Why touch the lines in the first place?\r\n\r\n",
      "commit_id" : "e8a3ff3b586beb4e2bb2d77a3bf4d7b98a1a2df2",
      "created_at" : "2021-09-02T15:45:05Z",
      "diff_hunk" : "@@ -20,55 +23,55 @@ def set_test_params(self):\n         ]]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n-        txouts = gen_return_txouts()\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n+        node = self.nodes[0]\n+        miniwallet = MiniWallet(node)\n+        relayfee = node.getnetworkinfo()['relayfee']\n \n-        self.log.info('Check that mempoolminfee is minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_equal(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n+        self.log.info('Check that mempoolminfee is minrelaytxfee')\n+        assert_equal(node.getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n+        assert_equal(node.getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n \n-        txids = []\n-        utxos = create_confirmed_utxos(self, relayfee, self.nodes[0], 91)\n+        tx_batch_size = 25\n+        num_of_batches = 3\n+        # Generate UTXOs to flood the mempool\n+        # 1 to create a tx initially that will be evicted from the mempool later\n+        # 3 batches of multiple transactions with a fee rate much higher than the previous UTXO\n+        # And 1 more to verify that this tx does not get added to the mempool with a fee rate less than the mempoolminfee\n+        self.generate(miniwallet,1 + (num_of_batches * tx_batch_size) + 1)\n+\n+        # Mine 99 blocks so that the UTXOs are allowed to be spent\n+        self.generate(node,COINBASE_MATURITY - 1)\n \n         self.log.info('Create a mempool tx that will be evicted')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        self.nodes[0].settxfee(relayfee) # specifically fund this tx with low fee\n-        txF = self.nodes[0].fundrawtransaction(tx)\n-        self.nodes[0].settxfee(0) # return to automatic fee selection\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        txid = self.nodes[0].sendrawtransaction(txFS['hex'])\n-\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-        base_fee = relayfee*100\n-        for i in range (3):\n-            txids.append([])\n-            txids[i] = create_lots_of_big_transactions(self.nodes[0], txouts, utxos[30*i:30*i+30], 30, (i+1)*base_fee)\n+        tx_to_be_evicted_id = miniwallet.send_self_transfer(from_node=node, fee_rate=relayfee)[\"txid\"]\n+\n+        # Increase the tx fee rate massively to give the subsequent transactions a higher priority in the mempool\n+        base_fee = relayfee * 1000\n+\n+        self.log.info('Fill up the mempool with txs with higher fee rate')\n+        num_of_large_tx_sent = 0\n+        txouts = gen_return_txouts()\n+\n+        for batch_of_txid in range(num_of_batches):\n+            # Increment the tx fee rate gradually by a factor of (base_fee) for each batch\n+            miniwallet.send_large_transactions(node, txouts, tx_batch_size, (batch_of_txid+1) * base_fee)\n+            num_of_large_tx_sent +=tx_batch_size\n \n         self.log.info('The tx should be evicted by now')\n-        assert txid not in self.nodes[0].getrawmempool()\n-        txdata = self.nodes[0].gettransaction(txid)\n-        assert txdata['confirmations'] ==  0  #confirmation should still be 0\n+        # The number of transactions created should be greater than the ones present in the mempool\n+        assert_greater_than(num_of_large_tx_sent, len(node.getrawmempool()))\n+        # Initial tx created should not be present in the mempool anymore as it had a lower fee rate\n+        assert tx_to_be_evicted_id not in node.getrawmempool()\n \n-        self.log.info('Check that mempoolminfee is larger than minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_greater_than(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n+        self.log.info('Check that mempoolminfee is larger than minrelaytxfee')\n+        assert_equal(node.getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n+        assert_greater_than(node.getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n \n+        # Deliberately try to create a tx with a fee less than the minimum mempool fee to assert that it does not get added to the mempool\n         self.log.info('Create a mempool tx that will not pass mempoolminfee')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        # specifically fund this tx with a fee < mempoolminfee, >= than minrelaytxfee\n-        txF = self.nodes[0].fundrawtransaction(tx, {'feeRate': relayfee})\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        assert_raises_rpc_error(-26, \"mempool min fee not met\", self.nodes[0].sendrawtransaction, txFS['hex'])\n+        assert_raises_rpc_error(-26,\"mempool min fee not met\",miniwallet.send_self_transfer,from_node=node,fee_rate=relayfee,mempool_valid=False)\n+\n \n if __name__ == '__main__':\n-    MempoolLimitTest().main()\n+    MempoolLimitTest().main()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r701210709",
      "id" : 701210709,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMTIxMDcwOQ==",
      "original_commit_id" : "0b361fe5b841f7c96b6dcfe805ee695ea49a1935",
      "original_line" : 77,
      "original_position" : 108,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : null,
      "pull_request_review_id" : 745236839,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-02T15:49:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701210709",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r701211151"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701211151"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It is a bit confusing to add new code in the wrong style and then fix it up in the second commit. Why not add it with the right style from the beginning?",
      "commit_id" : "e8a3ff3b586beb4e2bb2d77a3bf4d7b98a1a2df2",
      "created_at" : "2021-09-02T15:45:35Z",
      "diff_hunk" : "@@ -20,55 +23,55 @@ def set_test_params(self):\n         ]]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n-        txouts = gen_return_txouts()\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n+        node = self.nodes[0]\n+        miniwallet = MiniWallet(node)\n+        relayfee = node.getnetworkinfo()['relayfee']\n \n-        self.log.info('Check that mempoolminfee is minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_equal(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n+        self.log.info('Check that mempoolminfee is minrelaytxfee')\n+        assert_equal(node.getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n+        assert_equal(node.getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n \n-        txids = []\n-        utxos = create_confirmed_utxos(self, relayfee, self.nodes[0], 91)\n+        tx_batch_size = 25\n+        num_of_batches = 3\n+        # Generate UTXOs to flood the mempool\n+        # 1 to create a tx initially that will be evicted from the mempool later\n+        # 3 batches of multiple transactions with a fee rate much higher than the previous UTXO\n+        # And 1 more to verify that this tx does not get added to the mempool with a fee rate less than the mempoolminfee\n+        self.generate(miniwallet,1 + (num_of_batches * tx_batch_size) + 1)\n+\n+        # Mine 99 blocks so that the UTXOs are allowed to be spent\n+        self.generate(node,COINBASE_MATURITY - 1)\n \n         self.log.info('Create a mempool tx that will be evicted')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        self.nodes[0].settxfee(relayfee) # specifically fund this tx with low fee\n-        txF = self.nodes[0].fundrawtransaction(tx)\n-        self.nodes[0].settxfee(0) # return to automatic fee selection\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        txid = self.nodes[0].sendrawtransaction(txFS['hex'])\n-\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-        base_fee = relayfee*100\n-        for i in range (3):\n-            txids.append([])\n-            txids[i] = create_lots_of_big_transactions(self.nodes[0], txouts, utxos[30*i:30*i+30], 30, (i+1)*base_fee)\n+        tx_to_be_evicted_id = miniwallet.send_self_transfer(from_node=node, fee_rate=relayfee)[\"txid\"]\n+\n+        # Increase the tx fee rate massively to give the subsequent transactions a higher priority in the mempool\n+        base_fee = relayfee * 1000\n+\n+        self.log.info('Fill up the mempool with txs with higher fee rate')\n+        num_of_large_tx_sent = 0\n+        txouts = gen_return_txouts()\n+\n+        for batch_of_txid in range(num_of_batches):\n+            # Increment the tx fee rate gradually by a factor of (base_fee) for each batch\n+            miniwallet.send_large_transactions(node, txouts, tx_batch_size, (batch_of_txid+1) * base_fee)\n+            num_of_large_tx_sent +=tx_batch_size\n \n         self.log.info('The tx should be evicted by now')\n-        assert txid not in self.nodes[0].getrawmempool()\n-        txdata = self.nodes[0].gettransaction(txid)\n-        assert txdata['confirmations'] ==  0  #confirmation should still be 0\n+        # The number of transactions created should be greater than the ones present in the mempool\n+        assert_greater_than(num_of_large_tx_sent, len(node.getrawmempool()))\n+        # Initial tx created should not be present in the mempool anymore as it had a lower fee rate\n+        assert tx_to_be_evicted_id not in node.getrawmempool()\n \n-        self.log.info('Check that mempoolminfee is larger than minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_greater_than(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n+        self.log.info('Check that mempoolminfee is larger than minrelaytxfee')\n+        assert_equal(node.getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n+        assert_greater_than(node.getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n \n+        # Deliberately try to create a tx with a fee less than the minimum mempool fee to assert that it does not get added to the mempool\n         self.log.info('Create a mempool tx that will not pass mempoolminfee')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        # specifically fund this tx with a fee < mempoolminfee, >= than minrelaytxfee\n-        txF = self.nodes[0].fundrawtransaction(tx, {'feeRate': relayfee})\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        assert_raises_rpc_error(-26, \"mempool min fee not met\", self.nodes[0].sendrawtransaction, txFS['hex'])\n+        assert_raises_rpc_error(-26,\"mempool min fee not met\",miniwallet.send_self_transfer,from_node=node,fee_rate=relayfee,mempool_valid=False)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r701211151",
      "id" : 701211151,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMTIxMTE1MQ==",
      "original_commit_id" : "0b361fe5b841f7c96b6dcfe805ee695ea49a1935",
      "original_line" : 73,
      "original_position" : 103,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : null,
      "pull_request_review_id" : 745236839,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-02T15:49:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701211151",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r701213066"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701213066"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is this needed to be put into miniwallet?\r\n\r\nIf not, it would be better suited in the test that uses it. Either as function or inline, because it is only called once.\r\n\r\nRegardless, the interface should be cleaned up. `array_of_large_tx` is *not* an array of txs, but of txouts.",
      "commit_id" : "e8a3ff3b586beb4e2bb2d77a3bf4d7b98a1a2df2",
      "created_at" : "2021-09-02T15:47:57Z",
      "diff_hunk" : "@@ -182,6 +182,16 @@ def sendrawtransaction(self, *, from_node, tx_hex):\n         from_node.sendrawtransaction(tx_hex)\n         self.scan_tx(from_node.decoderawtransaction(tx_hex))\n \n+    def send_large_transactions(self, node, array_of_large_tx, num_txns, fee_rate):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r701213066",
      "id" : 701213066,
      "line" : 185,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMTIxMzA2Ng==",
      "original_commit_id" : "0b361fe5b841f7c96b6dcfe805ee695ea49a1935",
      "original_line" : 185,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 4,
      "pull_request_review_id" : 745236839,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-02T15:49:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701213066",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r701213849"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701213849"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It is a bit confusing to review if the `self.node[0]` -> `node` replacement is done in the same commit as the miniwallet changes. Maybe split it up?",
      "commit_id" : "e8a3ff3b586beb4e2bb2d77a3bf4d7b98a1a2df2",
      "created_at" : "2021-09-02T15:48:49Z",
      "diff_hunk" : "@@ -20,55 +23,55 @@ def set_test_params(self):\n         ]]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n-        txouts = gen_return_txouts()\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n+        node = self.nodes[0]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r701213849",
      "id" : 701213849,
      "line" : 34,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMTIxMzg0OQ==",
      "original_commit_id" : "0b361fe5b841f7c96b6dcfe805ee695ea49a1935",
      "original_line" : 27,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : 38,
      "pull_request_review_id" : 745236839,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-02T15:49:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701213849",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r701214260"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701214260"
         }
      },
      "author_association" : "MEMBER",
      "body" : "\r\n\r\nIt is a bit confusing to add new code in the wrong style and then fix it up in the second commit. Why not add it with the right style from the beginning?\r\n",
      "commit_id" : "e8a3ff3b586beb4e2bb2d77a3bf4d7b98a1a2df2",
      "created_at" : "2021-09-02T15:49:20Z",
      "diff_hunk" : "@@ -20,55 +23,55 @@ def set_test_params(self):\n         ]]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n-        txouts = gen_return_txouts()\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n+        node = self.nodes[0]\n+        miniwallet = MiniWallet(node)\n+        relayfee = node.getnetworkinfo()['relayfee']\n \n-        self.log.info('Check that mempoolminfee is minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_equal(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n+        self.log.info('Check that mempoolminfee is minrelaytxfee')\n+        assert_equal(node.getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n+        assert_equal(node.getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n \n-        txids = []\n-        utxos = create_confirmed_utxos(self, relayfee, self.nodes[0], 91)\n+        tx_batch_size = 25\n+        num_of_batches = 3\n+        # Generate UTXOs to flood the mempool\n+        # 1 to create a tx initially that will be evicted from the mempool later\n+        # 3 batches of multiple transactions with a fee rate much higher than the previous UTXO\n+        # And 1 more to verify that this tx does not get added to the mempool with a fee rate less than the mempoolminfee\n+        self.generate(miniwallet,1 + (num_of_batches * tx_batch_size) + 1)\n+\n+        # Mine 99 blocks so that the UTXOs are allowed to be spent\n+        self.generate(node,COINBASE_MATURITY - 1)\n \n         self.log.info('Create a mempool tx that will be evicted')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        self.nodes[0].settxfee(relayfee) # specifically fund this tx with low fee\n-        txF = self.nodes[0].fundrawtransaction(tx)\n-        self.nodes[0].settxfee(0) # return to automatic fee selection\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        txid = self.nodes[0].sendrawtransaction(txFS['hex'])\n-\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-        base_fee = relayfee*100\n-        for i in range (3):\n-            txids.append([])\n-            txids[i] = create_lots_of_big_transactions(self.nodes[0], txouts, utxos[30*i:30*i+30], 30, (i+1)*base_fee)\n+        tx_to_be_evicted_id = miniwallet.send_self_transfer(from_node=node, fee_rate=relayfee)[\"txid\"]\n+\n+        # Increase the tx fee rate massively to give the subsequent transactions a higher priority in the mempool\n+        base_fee = relayfee * 1000\n+\n+        self.log.info('Fill up the mempool with txs with higher fee rate')\n+        num_of_large_tx_sent = 0\n+        txouts = gen_return_txouts()\n+\n+        for batch_of_txid in range(num_of_batches):\n+            # Increment the tx fee rate gradually by a factor of (base_fee) for each batch\n+            miniwallet.send_large_transactions(node, txouts, tx_batch_size, (batch_of_txid+1) * base_fee)\n+            num_of_large_tx_sent +=tx_batch_size",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r701214260",
      "id" : 701214260,
      "in_reply_to_id" : 700978781,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMTIxNDI2MA==",
      "original_commit_id" : "0b361fe5b841f7c96b6dcfe805ee695ea49a1935",
      "original_line" : 59,
      "original_position" : 75,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : null,
      "pull_request_review_id" : 745236839,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-02T15:49:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701214260",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r701342916"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701342916"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I thought it could make sense as a shared helper since I expected the functionality to be useful in different tests as well. Although this only introduces one caller, would make it easier for others to find.",
      "commit_id" : "e8a3ff3b586beb4e2bb2d77a3bf4d7b98a1a2df2",
      "created_at" : "2021-09-02T18:54:38Z",
      "diff_hunk" : "@@ -182,6 +182,16 @@ def sendrawtransaction(self, *, from_node, tx_hex):\n         from_node.sendrawtransaction(tx_hex)\n         self.scan_tx(from_node.decoderawtransaction(tx_hex))\n \n+    def send_large_transactions(self, node, array_of_large_tx, num_txns, fee_rate):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r701342916",
      "id" : 701342916,
      "in_reply_to_id" : 701213066,
      "line" : 185,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMTM0MjkxNg==",
      "original_commit_id" : "0b361fe5b841f7c96b6dcfe805ee695ea49a1935",
      "original_line" : 185,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 4,
      "pull_request_review_id" : 745413326,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-02T18:54:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701342916",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r701685136"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701685136"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The issue I see is that the interface isn't correct in that the passed `fee_rate` won't be the fee rate of the tx returned. Inlining it would avoid the confusion in the interface.",
      "commit_id" : "e8a3ff3b586beb4e2bb2d77a3bf4d7b98a1a2df2",
      "created_at" : "2021-09-03T07:59:36Z",
      "diff_hunk" : "@@ -182,6 +182,16 @@ def sendrawtransaction(self, *, from_node, tx_hex):\n         from_node.sendrawtransaction(tx_hex)\n         self.scan_tx(from_node.decoderawtransaction(tx_hex))\n \n+    def send_large_transactions(self, node, array_of_large_tx, num_txns, fee_rate):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r701685136",
      "id" : 701685136,
      "in_reply_to_id" : 701213066,
      "line" : 185,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMTY4NTEzNg==",
      "original_commit_id" : "0b361fe5b841f7c96b6dcfe805ee695ea49a1935",
      "original_line" : 185,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 4,
      "pull_request_review_id" : 745829769,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-03T07:59:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701685136",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r702300385"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702300385"
         }
      },
      "author_association" : "MEMBER",
      "body" : "gotcha, yeah agreed that the interface should be self-evident if the function is kept here, or moving it over would be another option. ",
      "commit_id" : "e8a3ff3b586beb4e2bb2d77a3bf4d7b98a1a2df2",
      "created_at" : "2021-09-04T16:03:19Z",
      "diff_hunk" : "@@ -182,6 +182,16 @@ def sendrawtransaction(self, *, from_node, tx_hex):\n         from_node.sendrawtransaction(tx_hex)\n         self.scan_tx(from_node.decoderawtransaction(tx_hex))\n \n+    def send_large_transactions(self, node, array_of_large_tx, num_txns, fee_rate):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r702300385",
      "id" : 702300385,
      "in_reply_to_id" : 701213066,
      "line" : 185,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMjMwMDM4NQ==",
      "original_commit_id" : "0b361fe5b841f7c96b6dcfe805ee695ea49a1935",
      "original_line" : 185,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 4,
      "pull_request_review_id" : 746579848,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-04T16:03:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702300385",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r706117202"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706117202"
         }
      },
      "author_association" : "NONE",
      "body" : "Thank you for the suggestion. I have split up the commits",
      "commit_id" : "22c73921c5c753c2e97fefbd207b163e610af158",
      "created_at" : "2021-09-10T11:49:14Z",
      "diff_hunk" : "@@ -20,55 +23,55 @@ def set_test_params(self):\n         ]]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n-\n     def run_test(self):\n-        txouts = gen_return_txouts()\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n+        node = self.nodes[0]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r706117202",
      "id" : 706117202,
      "in_reply_to_id" : 701213849,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNjExNzIwMg==",
      "original_commit_id" : "0b361fe5b841f7c96b6dcfe805ee695ea49a1935",
      "original_line" : 27,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : null,
      "pull_request_review_id" : 751326542,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-10T11:49:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706117202",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/55556994?v=4",
         "events_url" : "https://api.github.com/users/ShubhamPalriwala/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ShubhamPalriwala/followers",
         "following_url" : "https://api.github.com/users/ShubhamPalriwala/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ShubhamPalriwala/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ShubhamPalriwala",
         "id" : 55556994,
         "login" : "ShubhamPalriwala",
         "node_id" : "MDQ6VXNlcjU1NTU2OTk0",
         "organizations_url" : "https://api.github.com/users/ShubhamPalriwala/orgs",
         "received_events_url" : "https://api.github.com/users/ShubhamPalriwala/received_events",
         "repos_url" : "https://api.github.com/users/ShubhamPalriwala/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ShubhamPalriwala/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ShubhamPalriwala/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ShubhamPalriwala"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r706117878"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706117878"
         }
      },
      "author_association" : "NONE",
      "body" : "Makes sense, this is a very specific case hence I have moved the helper function to the `mempool_limit.py`\r\nThanks for the suggestion",
      "commit_id" : "22c73921c5c753c2e97fefbd207b163e610af158",
      "created_at" : "2021-09-10T11:50:19Z",
      "diff_hunk" : "@@ -182,6 +182,16 @@ def sendrawtransaction(self, *, from_node, tx_hex):\n         from_node.sendrawtransaction(tx_hex)\n         self.scan_tx(from_node.decoderawtransaction(tx_hex))\n \n+    def send_large_transactions(self, node, array_of_large_tx, num_txns, fee_rate):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r706117878",
      "id" : 706117878,
      "in_reply_to_id" : 701213066,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNjExNzg3OA==",
      "original_commit_id" : "0b361fe5b841f7c96b6dcfe805ee695ea49a1935",
      "original_line" : 185,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : null,
      "pull_request_review_id" : 751327357,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-10T11:50:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706117878",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/55556994?v=4",
         "events_url" : "https://api.github.com/users/ShubhamPalriwala/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ShubhamPalriwala/followers",
         "following_url" : "https://api.github.com/users/ShubhamPalriwala/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ShubhamPalriwala/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ShubhamPalriwala",
         "id" : 55556994,
         "login" : "ShubhamPalriwala",
         "node_id" : "MDQ6VXNlcjU1NTU2OTk0",
         "organizations_url" : "https://api.github.com/users/ShubhamPalriwala/orgs",
         "received_events_url" : "https://api.github.com/users/ShubhamPalriwala/received_events",
         "repos_url" : "https://api.github.com/users/ShubhamPalriwala/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ShubhamPalriwala/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ShubhamPalriwala/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ShubhamPalriwala"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "## PR ready for review\r\n\r\nThank you to everybody who has reviewed it. However, the recent suggestions made the PR better and more helpful hence the changes as suggested have been implemented.",
      "created_at" : "2021-09-10T11:52:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#issuecomment-916845226",
      "id" : 916845226,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22543",
      "node_id" : "IC_kwDOABII5842pfKq",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-10T11:52:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/916845226",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/55556994?v=4",
         "events_url" : "https://api.github.com/users/ShubhamPalriwala/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ShubhamPalriwala/followers",
         "following_url" : "https://api.github.com/users/ShubhamPalriwala/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ShubhamPalriwala/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ShubhamPalriwala",
         "id" : 55556994,
         "login" : "ShubhamPalriwala",
         "node_id" : "MDQ6VXNlcjU1NTU2OTk0",
         "organizations_url" : "https://api.github.com/users/ShubhamPalriwala/orgs",
         "received_events_url" : "https://api.github.com/users/ShubhamPalriwala/received_events",
         "repos_url" : "https://api.github.com/users/ShubhamPalriwala/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ShubhamPalriwala/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ShubhamPalriwala/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ShubhamPalriwala"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r707108902"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/707108902"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit in the first commit:\r\n\r\nIt could make sense to drop the `batch_of_txid` argument and instead pass the calculated fee rate. This reduces the number of arguments passed to the function and increases its flexibility.\r\n\r\nThough, an alternative would be to simply inline the function.\r\n\r\n```suggestion\r\n            self.send_large_txs(node, miniwallet, txouts, (batch_of_txid + 1) * base_fee, tx_batch_size)\r\n```",
      "commit_id" : "22c73921c5c753c2e97fefbd207b163e610af158",
      "created_at" : "2021-09-13T08:20:43Z",
      "diff_hunk" : "@@ -20,55 +23,60 @@ def set_test_params(self):\n         ]]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n+    def send_large_txs(self, node, miniwallet, txouts, batch_of_txid, base_fee, tx_batch_size):\n+        for _ in range(tx_batch_size):\n+            tx = miniwallet.create_self_transfer(from_node=node, fee_rate=(batch_of_txid + 1) * base_fee)['tx']\n+            for txout in txouts:\n+                tx.vout.append(txout)\n+            miniwallet.sendrawtransaction(from_node=node, tx_hex=tx.serialize().hex())\n \n     def run_test(self):\n         txouts = gen_return_txouts()\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n+        node=self.nodes[0]\n+        miniwallet = MiniWallet(node)\n+        relayfee = node.getnetworkinfo()['relayfee']\n+\n+        self.log.info('Check that mempoolminfee is minrelaytxfee')\n+        assert_equal(node.getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n+        assert_equal(node.getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n \n-        self.log.info('Check that mempoolminfee is minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_equal(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n+        tx_batch_size = 25\n+        num_of_batches = 3\n+        # Generate UTXOs to flood the mempool\n+        # 1 to create a tx initially that will be evicted from the mempool later\n+        # 3 batches of multiple transactions with a fee rate much higher than the previous UTXO\n+        # And 1 more to verify that this tx does not get added to the mempool with a fee rate less than the mempoolminfee\n+        self.generate(miniwallet, 1 + (num_of_batches * tx_batch_size) + 1)\n \n-        txids = []\n-        utxos = create_confirmed_utxos(self, relayfee, self.nodes[0], 91)\n+        # Mine 99 blocks so that the UTXOs are allowed to be spent\n+        self.generate(node, COINBASE_MATURITY - 1)\n \n         self.log.info('Create a mempool tx that will be evicted')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        self.nodes[0].settxfee(relayfee) # specifically fund this tx with low fee\n-        txF = self.nodes[0].fundrawtransaction(tx)\n-        self.nodes[0].settxfee(0) # return to automatic fee selection\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        txid = self.nodes[0].sendrawtransaction(txFS['hex'])\n-\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-        base_fee = relayfee*100\n-        for i in range (3):\n-            txids.append([])\n-            txids[i] = create_lots_of_big_transactions(self.nodes[0], txouts, utxos[30*i:30*i+30], 30, (i+1)*base_fee)\n+        tx_to_be_evicted_id = miniwallet.send_self_transfer(from_node=node, fee_rate=relayfee)[\"txid\"]\n+\n+        # Increase the tx fee rate massively to give the subsequent transactions a higher priority in the mempool\n+        base_fee = relayfee * 1000\n+\n+        self.log.info(\"Fill up the mempool with txs with higher fee rate\")\n+        num_of_large_tx_sent = 0\n+        for batch_of_txid in range(num_of_batches):\n+            self.send_large_txs(node, miniwallet, txouts, batch_of_txid, base_fee, tx_batch_size)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r707108902",
      "id" : 707108902,
      "line" : 63,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNzEwODkwMg==",
      "original_commit_id" : "22c73921c5c753c2e97fefbd207b163e610af158",
      "original_line" : 63,
      "original_position" : 77,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : 77,
      "pull_request_review_id" : 752448027,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-13T08:20:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/707108902",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r707114717"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/707114717"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in the first commit: Is the `num_of_large_tx_sent` really needed?  Wouldn't this be equal to `num_of_batches * tx_batch_size`?\r\n\r\nAlso, the mempool should be deterministic, so it could make sense to check the exact number and mention in a comment that it should be less than `90` or `num_of_batches * tx_batch_size`?",
      "commit_id" : "22c73921c5c753c2e97fefbd207b163e610af158",
      "created_at" : "2021-09-13T08:28:23Z",
      "diff_hunk" : "@@ -20,55 +23,60 @@ def set_test_params(self):\n         ]]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n+    def send_large_txs(self, node, miniwallet, txouts, batch_of_txid, base_fee, tx_batch_size):\n+        for _ in range(tx_batch_size):\n+            tx = miniwallet.create_self_transfer(from_node=node, fee_rate=(batch_of_txid + 1) * base_fee)['tx']\n+            for txout in txouts:\n+                tx.vout.append(txout)\n+            miniwallet.sendrawtransaction(from_node=node, tx_hex=tx.serialize().hex())\n \n     def run_test(self):\n         txouts = gen_return_txouts()\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n+        node=self.nodes[0]\n+        miniwallet = MiniWallet(node)\n+        relayfee = node.getnetworkinfo()['relayfee']\n+\n+        self.log.info('Check that mempoolminfee is minrelaytxfee')\n+        assert_equal(node.getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n+        assert_equal(node.getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n \n-        self.log.info('Check that mempoolminfee is minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_equal(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n+        tx_batch_size = 25\n+        num_of_batches = 3\n+        # Generate UTXOs to flood the mempool\n+        # 1 to create a tx initially that will be evicted from the mempool later\n+        # 3 batches of multiple transactions with a fee rate much higher than the previous UTXO\n+        # And 1 more to verify that this tx does not get added to the mempool with a fee rate less than the mempoolminfee\n+        self.generate(miniwallet, 1 + (num_of_batches * tx_batch_size) + 1)\n \n-        txids = []\n-        utxos = create_confirmed_utxos(self, relayfee, self.nodes[0], 91)\n+        # Mine 99 blocks so that the UTXOs are allowed to be spent\n+        self.generate(node, COINBASE_MATURITY - 1)\n \n         self.log.info('Create a mempool tx that will be evicted')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        self.nodes[0].settxfee(relayfee) # specifically fund this tx with low fee\n-        txF = self.nodes[0].fundrawtransaction(tx)\n-        self.nodes[0].settxfee(0) # return to automatic fee selection\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        txid = self.nodes[0].sendrawtransaction(txFS['hex'])\n-\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-        base_fee = relayfee*100\n-        for i in range (3):\n-            txids.append([])\n-            txids[i] = create_lots_of_big_transactions(self.nodes[0], txouts, utxos[30*i:30*i+30], 30, (i+1)*base_fee)\n+        tx_to_be_evicted_id = miniwallet.send_self_transfer(from_node=node, fee_rate=relayfee)[\"txid\"]\n+\n+        # Increase the tx fee rate massively to give the subsequent transactions a higher priority in the mempool\n+        base_fee = relayfee * 1000\n+\n+        self.log.info(\"Fill up the mempool with txs with higher fee rate\")\n+        num_of_large_tx_sent = 0\n+        for batch_of_txid in range(num_of_batches):\n+            self.send_large_txs(node, miniwallet, txouts, batch_of_txid, base_fee, tx_batch_size)\n+            num_of_large_tx_sent += tx_batch_size\n \n         self.log.info('The tx should be evicted by now')\n-        assert txid not in self.nodes[0].getrawmempool()\n-        txdata = self.nodes[0].gettransaction(txid)\n-        assert txdata['confirmations'] ==  0  #confirmation should still be 0\n+        # The number of transactions created should be greater than the ones present in the mempool\n+        assert_greater_than(num_of_large_tx_sent, len(node.getrawmempool()))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r707114717",
      "id" : 707114717,
      "line" : 68,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNzExNDcxNw==",
      "original_commit_id" : "22c73921c5c753c2e97fefbd207b163e610af158",
      "original_line" : 68,
      "original_position" : 85,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : 85,
      "pull_request_review_id" : 752455775,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-13T08:29:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/707114717",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "lmk if you want this merged or address the nits",
      "created_at" : "2021-09-13T08:31:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#issuecomment-917963111",
      "id" : 917963111,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22543",
      "node_id" : "IC_kwDOABII5842twFn",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-13T08:31:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/917963111",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r707239936"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/707239936"
         }
      },
      "author_association" : "NONE",
      "body" : "Makes sense! On it",
      "commit_id" : "41fa226d27ab224d02bc21a47f560c32298612ab",
      "created_at" : "2021-09-13T11:20:50Z",
      "diff_hunk" : "@@ -20,55 +23,60 @@ def set_test_params(self):\n         ]]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n+    def send_large_txs(self, node, miniwallet, txouts, batch_of_txid, base_fee, tx_batch_size):\n+        for _ in range(tx_batch_size):\n+            tx = miniwallet.create_self_transfer(from_node=node, fee_rate=(batch_of_txid + 1) * base_fee)['tx']\n+            for txout in txouts:\n+                tx.vout.append(txout)\n+            miniwallet.sendrawtransaction(from_node=node, tx_hex=tx.serialize().hex())\n \n     def run_test(self):\n         txouts = gen_return_txouts()\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n+        node=self.nodes[0]\n+        miniwallet = MiniWallet(node)\n+        relayfee = node.getnetworkinfo()['relayfee']\n+\n+        self.log.info('Check that mempoolminfee is minrelaytxfee')\n+        assert_equal(node.getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n+        assert_equal(node.getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n \n-        self.log.info('Check that mempoolminfee is minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_equal(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n+        tx_batch_size = 25\n+        num_of_batches = 3\n+        # Generate UTXOs to flood the mempool\n+        # 1 to create a tx initially that will be evicted from the mempool later\n+        # 3 batches of multiple transactions with a fee rate much higher than the previous UTXO\n+        # And 1 more to verify that this tx does not get added to the mempool with a fee rate less than the mempoolminfee\n+        self.generate(miniwallet, 1 + (num_of_batches * tx_batch_size) + 1)\n \n-        txids = []\n-        utxos = create_confirmed_utxos(self, relayfee, self.nodes[0], 91)\n+        # Mine 99 blocks so that the UTXOs are allowed to be spent\n+        self.generate(node, COINBASE_MATURITY - 1)\n \n         self.log.info('Create a mempool tx that will be evicted')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        self.nodes[0].settxfee(relayfee) # specifically fund this tx with low fee\n-        txF = self.nodes[0].fundrawtransaction(tx)\n-        self.nodes[0].settxfee(0) # return to automatic fee selection\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        txid = self.nodes[0].sendrawtransaction(txFS['hex'])\n-\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-        base_fee = relayfee*100\n-        for i in range (3):\n-            txids.append([])\n-            txids[i] = create_lots_of_big_transactions(self.nodes[0], txouts, utxos[30*i:30*i+30], 30, (i+1)*base_fee)\n+        tx_to_be_evicted_id = miniwallet.send_self_transfer(from_node=node, fee_rate=relayfee)[\"txid\"]\n+\n+        # Increase the tx fee rate massively to give the subsequent transactions a higher priority in the mempool\n+        base_fee = relayfee * 1000\n+\n+        self.log.info(\"Fill up the mempool with txs with higher fee rate\")\n+        num_of_large_tx_sent = 0\n+        for batch_of_txid in range(num_of_batches):\n+            self.send_large_txs(node, miniwallet, txouts, batch_of_txid, base_fee, tx_batch_size)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r707239936",
      "id" : 707239936,
      "in_reply_to_id" : 707108902,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNzIzOTkzNg==",
      "original_commit_id" : "22c73921c5c753c2e97fefbd207b163e610af158",
      "original_line" : 63,
      "original_position" : 77,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : null,
      "pull_request_review_id" : 752620921,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-13T11:20:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/707239936",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/55556994?v=4",
         "events_url" : "https://api.github.com/users/ShubhamPalriwala/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ShubhamPalriwala/followers",
         "following_url" : "https://api.github.com/users/ShubhamPalriwala/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ShubhamPalriwala/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ShubhamPalriwala",
         "id" : 55556994,
         "login" : "ShubhamPalriwala",
         "node_id" : "MDQ6VXNlcjU1NTU2OTk0",
         "organizations_url" : "https://api.github.com/users/ShubhamPalriwala/orgs",
         "received_events_url" : "https://api.github.com/users/ShubhamPalriwala/received_events",
         "repos_url" : "https://api.github.com/users/ShubhamPalriwala/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ShubhamPalriwala/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ShubhamPalriwala/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ShubhamPalriwala"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r707262139"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/707262139"
         }
      },
      "author_association" : "NONE",
      "body" : "Done! Assuming one can understand that `tx_batch_size * num_of_batches` is equal to the number of transactions created, works!",
      "commit_id" : "41fa226d27ab224d02bc21a47f560c32298612ab",
      "created_at" : "2021-09-13T11:54:31Z",
      "diff_hunk" : "@@ -20,55 +23,60 @@ def set_test_params(self):\n         ]]\n         self.supports_cli = False\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n+    def send_large_txs(self, node, miniwallet, txouts, batch_of_txid, base_fee, tx_batch_size):\n+        for _ in range(tx_batch_size):\n+            tx = miniwallet.create_self_transfer(from_node=node, fee_rate=(batch_of_txid + 1) * base_fee)['tx']\n+            for txout in txouts:\n+                tx.vout.append(txout)\n+            miniwallet.sendrawtransaction(from_node=node, tx_hex=tx.serialize().hex())\n \n     def run_test(self):\n         txouts = gen_return_txouts()\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n+        node=self.nodes[0]\n+        miniwallet = MiniWallet(node)\n+        relayfee = node.getnetworkinfo()['relayfee']\n+\n+        self.log.info('Check that mempoolminfee is minrelaytxfee')\n+        assert_equal(node.getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n+        assert_equal(node.getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n \n-        self.log.info('Check that mempoolminfee is minrelytxfee')\n-        assert_equal(self.nodes[0].getmempoolinfo()['minrelaytxfee'], Decimal('0.00001000'))\n-        assert_equal(self.nodes[0].getmempoolinfo()['mempoolminfee'], Decimal('0.00001000'))\n+        tx_batch_size = 25\n+        num_of_batches = 3\n+        # Generate UTXOs to flood the mempool\n+        # 1 to create a tx initially that will be evicted from the mempool later\n+        # 3 batches of multiple transactions with a fee rate much higher than the previous UTXO\n+        # And 1 more to verify that this tx does not get added to the mempool with a fee rate less than the mempoolminfee\n+        self.generate(miniwallet, 1 + (num_of_batches * tx_batch_size) + 1)\n \n-        txids = []\n-        utxos = create_confirmed_utxos(self, relayfee, self.nodes[0], 91)\n+        # Mine 99 blocks so that the UTXOs are allowed to be spent\n+        self.generate(node, COINBASE_MATURITY - 1)\n \n         self.log.info('Create a mempool tx that will be evicted')\n-        us0 = utxos.pop()\n-        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n-        outputs = {self.nodes[0].getnewaddress() : 0.0001}\n-        tx = self.nodes[0].createrawtransaction(inputs, outputs)\n-        self.nodes[0].settxfee(relayfee) # specifically fund this tx with low fee\n-        txF = self.nodes[0].fundrawtransaction(tx)\n-        self.nodes[0].settxfee(0) # return to automatic fee selection\n-        txFS = self.nodes[0].signrawtransactionwithwallet(txF['hex'])\n-        txid = self.nodes[0].sendrawtransaction(txFS['hex'])\n-\n-        relayfee = self.nodes[0].getnetworkinfo()['relayfee']\n-        base_fee = relayfee*100\n-        for i in range (3):\n-            txids.append([])\n-            txids[i] = create_lots_of_big_transactions(self.nodes[0], txouts, utxos[30*i:30*i+30], 30, (i+1)*base_fee)\n+        tx_to_be_evicted_id = miniwallet.send_self_transfer(from_node=node, fee_rate=relayfee)[\"txid\"]\n+\n+        # Increase the tx fee rate massively to give the subsequent transactions a higher priority in the mempool\n+        base_fee = relayfee * 1000\n+\n+        self.log.info(\"Fill up the mempool with txs with higher fee rate\")\n+        num_of_large_tx_sent = 0\n+        for batch_of_txid in range(num_of_batches):\n+            self.send_large_txs(node, miniwallet, txouts, batch_of_txid, base_fee, tx_batch_size)\n+            num_of_large_tx_sent += tx_batch_size\n \n         self.log.info('The tx should be evicted by now')\n-        assert txid not in self.nodes[0].getrawmempool()\n-        txdata = self.nodes[0].gettransaction(txid)\n-        assert txdata['confirmations'] ==  0  #confirmation should still be 0\n+        # The number of transactions created should be greater than the ones present in the mempool\n+        assert_greater_than(num_of_large_tx_sent, len(node.getrawmempool()))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#discussion_r707262139",
      "id" : 707262139,
      "in_reply_to_id" : 707114717,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNzI2MjEzOQ==",
      "original_commit_id" : "22c73921c5c753c2e97fefbd207b163e610af158",
      "original_line" : 68,
      "original_position" : 85,
      "original_start_line" : null,
      "path" : "test/functional/mempool_limit.py",
      "position" : null,
      "pull_request_review_id" : 752650146,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22543",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-13T11:54:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/707262139",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/55556994?v=4",
         "events_url" : "https://api.github.com/users/ShubhamPalriwala/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ShubhamPalriwala/followers",
         "following_url" : "https://api.github.com/users/ShubhamPalriwala/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ShubhamPalriwala/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ShubhamPalriwala",
         "id" : 55556994,
         "login" : "ShubhamPalriwala",
         "node_id" : "MDQ6VXNlcjU1NTU2OTk0",
         "organizations_url" : "https://api.github.com/users/ShubhamPalriwala/orgs",
         "received_events_url" : "https://api.github.com/users/ShubhamPalriwala/received_events",
         "repos_url" : "https://api.github.com/users/ShubhamPalriwala/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ShubhamPalriwala/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ShubhamPalriwala/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ShubhamPalriwala"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@MarcoFalke the nits have been addressed! PTAL.\r\nThe PR is ready to be merged from my end :)",
      "created_at" : "2021-09-13T11:58:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#issuecomment-918119451",
      "id" : 918119451,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22543",
      "node_id" : "IC_kwDOABII5842uWQb",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-13T11:58:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/918119451",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/55556994?v=4",
         "events_url" : "https://api.github.com/users/ShubhamPalriwala/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ShubhamPalriwala/followers",
         "following_url" : "https://api.github.com/users/ShubhamPalriwala/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ShubhamPalriwala/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ShubhamPalriwala",
         "id" : 55556994,
         "login" : "ShubhamPalriwala",
         "node_id" : "MDQ6VXNlcjU1NTU2OTk0",
         "organizations_url" : "https://api.github.com/users/ShubhamPalriwala/orgs",
         "received_events_url" : "https://api.github.com/users/ShubhamPalriwala/received_events",
         "repos_url" : "https://api.github.com/users/ShubhamPalriwala/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ShubhamPalriwala/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ShubhamPalriwala/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ShubhamPalriwala"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ack",
      "created_at" : "2021-09-13T12:26:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#issuecomment-918140536",
      "id" : 918140536,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22543",
      "node_id" : "IC_kwDOABII5842ubZ4",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-13T12:26:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/918140536",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Thank you for the git suggestions @amitiuttarwar \r\nUpdated and force-pushed the commits for a more clear understanding of the changes.\r\n\r\n## The PR is once again up for review. Hopefully one last time",
      "created_at" : "2021-09-13T19:33:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#issuecomment-918511490",
      "id" : 918511490,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22543",
      "node_id" : "IC_kwDOABII5842v1-C",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-13T19:33:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/918511490",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/55556994?v=4",
         "events_url" : "https://api.github.com/users/ShubhamPalriwala/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ShubhamPalriwala/followers",
         "following_url" : "https://api.github.com/users/ShubhamPalriwala/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ShubhamPalriwala/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ShubhamPalriwala",
         "id" : 55556994,
         "login" : "ShubhamPalriwala",
         "node_id" : "MDQ6VXNlcjU1NTU2OTk0",
         "organizations_url" : "https://api.github.com/users/ShubhamPalriwala/orgs",
         "received_events_url" : "https://api.github.com/users/ShubhamPalriwala/received_events",
         "repos_url" : "https://api.github.com/users/ShubhamPalriwala/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ShubhamPalriwala/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ShubhamPalriwala/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ShubhamPalriwala"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 08634e8, only git changes since last push (and one new line). ",
      "created_at" : "2021-09-13T20:02:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#issuecomment-918530519",
      "id" : 918530519,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22543",
      "node_id" : "IC_kwDOABII5842v6nX",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-13T20:02:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/918530519",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for taking the feedback. Looks good now.",
      "created_at" : "2021-09-14T09:12:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#issuecomment-918966286",
      "id" : 918966286,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22543",
      "node_id" : "IC_kwDOABII5842xlAO",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-14T09:12:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/918966286",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Note that the helper `send_large_txs` with its current interface is misleading, as the passed fee_rate is not respected. It is merely passed to MiniWallet's `create_self_transfer`, but this function can't look in the future and thus is unable to know that several outputs are appended to the transaction after, modifying its size and hence also decreasing it's feerate. I'd suggest to either pass an absolute fee that is simply deducted from tx.vout[0].nValue before the transaction is sent (simple solution), or keep the interface, but fix the fee calculation by deducting dependend on the tx's final vsize (a little more complex solution). In both cases, `create_self_transfer` needs to be called with a zero fee_rate first. Will take a look into that later.",
      "created_at" : "2021-09-14T09:32:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#issuecomment-918981930",
      "id" : 918981930,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22543",
      "node_id" : "IC_kwDOABII5842xo0q",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-14T09:32:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/918981930",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@theStack See also https://github.com/bitcoin/bitcoin/pull/22543#discussion_r701685136 , where I mentioned in-lining helps. I think we should pick the simplest/shortest code to achieve the goal of creating txs with different fee levels. The feerate doesn't need to be exact for the purposes of mempool eviction. The current code achieves its goal, but improvements are welcome if there are any.",
      "created_at" : "2021-09-14T09:38:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#issuecomment-918986896",
      "id" : 918986896,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22543",
      "node_id" : "IC_kwDOABII5842xqCQ",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-14T09:38:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/918986896",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@MarcoFalke: Sure, but in this case the fee-rate is not just \"not exact\", but off by several orders of magnitute, considering that the tx's vsize changes from 96 to 67552 vbytes (>700x), and MiniWallet only calculates the fee based on the 96 vbytes. So the value passed to this function is neither really a fee-rate nor an absolute fee, but something weird in-between that has just been increased (by 10x) until the test passes. I tried to increase the clarity of the test in #22972.",
      "created_at" : "2021-09-14T14:10:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22543#issuecomment-919189698",
      "id" : 919189698,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22543",
      "node_id" : "IC_kwDOABII5842ybjC",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-14T14:10:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/919189698",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   }
]
