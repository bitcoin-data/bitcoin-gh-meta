[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#23077](https://github.com/bitcoin/bitcoin/pull/23077) (Full CJDNS support by vasild)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-10-19T08:26:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#issuecomment-946479992",
      "id" : 946479992,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23306",
      "node_id" : "IC_kwDOABII5844aiN4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/946479992/reactions"
      },
      "updated_at" : "2021-10-19T08:26:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/946479992",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> For a long part of Bitcoin's history, this codebase has aggressively avoided making automatic connections to anything but nodes running on port 8333. I'd like to propose changing that, and this is a first PR necessary for that.\r\n\r\nConcept ACK for allowing automatic connections to nodes which are not using default ports\r\n\r\n> This concern is (a) no different than what is possible with IPv6 (where large ranges of IP addresses are very cheaply available), and (b) already hopefully sufficiently addressed by addrman's design (which limits access through based selected based on network groups).\r\n\r\nAgree \r\n\r\n> And this policy has downsides too; in particular, a fixed port is easy to detect, and a very obvious sign a Bitcoin node is running there.\r\n\r\nI found UA string as the easiest way to look for Bitcoin nodes while using [shodan](https://www.shodan.io/search/facet?query=User-Agent%3A%2FSatoshi%2F&facet=port) in which I could also see few nodes using non-default ports:\r\n\r\n![image](https://user-images.githubusercontent.com/13405205/137878976-98a5b408-d803-4e8a-9569-4e13b6c1ce18.png)\r\n\r\n![image](https://user-images.githubusercontent.com/13405205/137878986-a0b31970-82c1-487a-8299-333e380780c8.png)\r\n\r\n```\r\n    \"addr\": \"193.32.127.161:58477\",\r\n    \"addrbind\": \"192.168.1.4:60877\",\r\n    \"network\": \"ipv4\",\r\n```\r\n\r\nIgnore if its not related: Few users use Tor hidden services and different ports for RPC as explained in [Learning-Bitcoin-from-the-Command-Line/Verifying_Your_Tor_Setup.md](https://github.com/BlockchainCommons/Learning-Bitcoin-from-the-Command-Line/blob/master/14_1_Verifying_Your_Tor_Setup.md)",
      "created_at" : "2021-10-19T09:15:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#issuecomment-946520083",
      "id" : 946520083,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23306",
      "node_id" : "IC_kwDOABII5844asAT",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/946520083/reactions"
      },
      "updated_at" : "2021-10-19T09:15:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/946520083",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK\r\n\r\n> For a long part of Bitcoin's history, this codebase has aggressively avoided making automatic connections to anything but nodes running on port 8333. I'd like to propose changing that, and this is a first PR necessary for that.\r\n\r\nPort 8333 is the cheapest fingerprint for a Bitcoin node. The _possibility_ of port randomization is quite exciting as we will be able to use the raised floor of fingerprinting cost from BIP324.",
      "created_at" : "2021-10-19T14:32:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#issuecomment-946785776",
      "id" : 946785776,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23306",
      "node_id" : "IC_kwDOABII5844bs3w",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/946785776/reactions"
      },
      "updated_at" : "2021-10-22T16:19:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/946785776",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. Changes look pretty straightforward.",
      "created_at" : "2021-10-19T18:04:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#issuecomment-946971010",
      "id" : 946971010,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23306",
      "node_id" : "IC_kwDOABII5844caGC",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/946971010/reactions"
      },
      "updated_at" : "2021-10-19T18:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/946971010",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r732613976"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732613976"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why cast to reference? Is that not the same as `static_cast<const CService>(...)`?",
      "commit_id" : "5697d6054a1aaec0f89a8c8ce792d5e9f5c02314",
      "created_at" : "2021-10-20T10:01:38Z",
      "diff_hunk" : "@@ -137,24 +137,31 @@ class AddrManDeterministic : public AddrMan\n         // Check that all values in `mapInfo` are equal to all values in `other.mapInfo`.\n         // Keys may be different.\n \n-        using AddrInfoHasher = std::function<size_t(const AddrInfo&)>;\n         using AddrInfoEq = std::function<bool(const AddrInfo&, const AddrInfo&)>;\n \n-        CNetAddrHash netaddr_hasher;\n-\n-        AddrInfoHasher addrinfo_hasher = [&netaddr_hasher](const AddrInfo& a) {\n-            return netaddr_hasher(static_cast<CNetAddr>(a)) ^ netaddr_hasher(a.source) ^\n-                   a.nLastSuccess ^ a.nAttempts ^ a.nRefCount ^ a.fInTried;\n+        auto addrinfo_hasher = [](const AddrInfo& a) {\n+            CSipHasher hasher(0, 0);\n+            auto addr_key = a.GetKey();\n+            auto source_key = a.source.GetAddrBytes();\n+            hasher.Write(a.nLastSuccess);\n+            hasher.Write(a.nAttempts);\n+            hasher.Write(a.nRefCount);\n+            hasher.Write(a.fInTried);\n+            hasher.Write(addr_key.size());\n+            hasher.Write(source_key.size());\n+            hasher.Write(addr_key.data(), addr_key.size());\n+            hasher.Write(source_key.data(), source_key.size());\n+            return (size_t)hasher.Finalize();\n         };\n \n         AddrInfoEq addrinfo_eq = [](const AddrInfo& lhs, const AddrInfo& rhs) {\n-            return static_cast<CNetAddr>(lhs) == static_cast<CNetAddr>(rhs) &&\n+            return static_cast<const CService&>(lhs) == static_cast<const CService&>(rhs) &&",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r732613976",
      "id" : 732613976,
      "line" : 158,
      "node_id" : "PRRC_kwDOABII584rqs1Y",
      "original_commit_id" : "5697d6054a1aaec0f89a8c8ce792d5e9f5c02314",
      "original_line" : 158,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/test/fuzz/addrman.cpp",
      "position" : 29,
      "pull_request_review_id" : 784266773,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732613976/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-20T12:31:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732613976",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> The folklore justification (eventually actually added as a comment to the codebase in #20668) is that this is to prevent the Bitcoin P2P network from being leveraged to perform a DoS attack on other services, if their IP/port would get rumoured. [â¦]Â  Another possible justification would be a risk that treating different IP:port combinations separately would help perform Eclipse attacks (by an attacker rumouring their own IP with many ports). \r\n\r\nA third concern (which I think can be addressed: see below) could be that Bitcoin Core users would risk having to deal with bogus complaints along the lines of \"why am I seeing a failed SSH-login to my server on port 22 from your IP-address `w.x.y.z`?\" if we allowed for automatic outgoing connections on _all_ ports by default.\r\n\r\nWhen opening up for additional port numbers we might want to look at how browsers are tackling \"bad ports\":\r\n* [`kRestrictedPorts` in Chromium](https://chromium.googlesource.com/chromium/src.git/+/refs/heads/main/net/base/port_util.cc)\r\n* [`gBadPortList` in Firefox](https://hg.mozilla.org/mozilla-central/file/tip/netwerk/base/nsIOService.cpp)\r\n* [Definition of \"bad port\" in whatwg's Fetch standard](https://fetch.spec.whatwg.org/#port-blocking)\r\n\r\nAvoiding \"bad ports\" (or a subset of these ports) by default is probably a cheap way to reduce the likelihood of  Bitcoin Core users having to deal with these types of bogus complaints.\r\n\r\nAn alternative route would be to explicitly whitelist (by default) a set of \"good ports\" which a.) have low likelihood of causing said type of complaints, and b.) are unlikely to be firewalled.\r\n",
      "created_at" : "2021-10-20T10:01:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#issuecomment-947516736",
      "id" : 947516736,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23306",
      "node_id" : "IC_kwDOABII5844efVA",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/947516736/reactions"
      },
      "updated_at" : "2021-10-20T10:05:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/947516736",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r732619057"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732619057"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This does not take into account `CNetAddr::m_net`. So, two addresses from different networks with the same address bytes would hash the same. I think this is fine coz IPv4 and IPv6 have different length of the address. It could happen that a Tor address hashes the same as I2P address if they have identical 32 bytes :eyes:. I think this is ok for tests.",
      "commit_id" : "5697d6054a1aaec0f89a8c8ce792d5e9f5c02314",
      "created_at" : "2021-10-20T10:08:17Z",
      "diff_hunk" : "@@ -137,24 +137,31 @@ class AddrManDeterministic : public AddrMan\n         // Check that all values in `mapInfo` are equal to all values in `other.mapInfo`.\n         // Keys may be different.\n \n-        using AddrInfoHasher = std::function<size_t(const AddrInfo&)>;\n         using AddrInfoEq = std::function<bool(const AddrInfo&, const AddrInfo&)>;\n \n-        CNetAddrHash netaddr_hasher;\n-\n-        AddrInfoHasher addrinfo_hasher = [&netaddr_hasher](const AddrInfo& a) {\n-            return netaddr_hasher(static_cast<CNetAddr>(a)) ^ netaddr_hasher(a.source) ^\n-                   a.nLastSuccess ^ a.nAttempts ^ a.nRefCount ^ a.fInTried;\n+        auto addrinfo_hasher = [](const AddrInfo& a) {\n+            CSipHasher hasher(0, 0);\n+            auto addr_key = a.GetKey();\n+            auto source_key = a.source.GetAddrBytes();\n+            hasher.Write(a.nLastSuccess);\n+            hasher.Write(a.nAttempts);\n+            hasher.Write(a.nRefCount);\n+            hasher.Write(a.fInTried);\n+            hasher.Write(addr_key.size());\n+            hasher.Write(source_key.size());\n+            hasher.Write(addr_key.data(), addr_key.size());\n+            hasher.Write(source_key.data(), source_key.size());\n+            return (size_t)hasher.Finalize();\n         };",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r732619057",
      "id" : 732619057,
      "line" : 155,
      "node_id" : "PRRC_kwDOABII584rquEx",
      "original_commit_id" : "5697d6054a1aaec0f89a8c8ce792d5e9f5c02314",
      "original_line" : 155,
      "original_position" : 25,
      "original_start_line" : 142,
      "path" : "src/test/fuzz/addrman.cpp",
      "position" : 25,
      "pull_request_review_id" : 784266773,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732619057/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 142,
      "start_side" : "RIGHT",
      "updated_at" : "2021-10-20T12:31:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732619057",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r732619501"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732619501"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why write the size? Is it not unnecessary given that we also write the data?",
      "commit_id" : "5697d6054a1aaec0f89a8c8ce792d5e9f5c02314",
      "created_at" : "2021-10-20T10:08:52Z",
      "diff_hunk" : "@@ -137,24 +137,31 @@ class AddrManDeterministic : public AddrMan\n         // Check that all values in `mapInfo` are equal to all values in `other.mapInfo`.\n         // Keys may be different.\n \n-        using AddrInfoHasher = std::function<size_t(const AddrInfo&)>;\n         using AddrInfoEq = std::function<bool(const AddrInfo&, const AddrInfo&)>;\n \n-        CNetAddrHash netaddr_hasher;\n-\n-        AddrInfoHasher addrinfo_hasher = [&netaddr_hasher](const AddrInfo& a) {\n-            return netaddr_hasher(static_cast<CNetAddr>(a)) ^ netaddr_hasher(a.source) ^\n-                   a.nLastSuccess ^ a.nAttempts ^ a.nRefCount ^ a.fInTried;\n+        auto addrinfo_hasher = [](const AddrInfo& a) {\n+            CSipHasher hasher(0, 0);\n+            auto addr_key = a.GetKey();\n+            auto source_key = a.source.GetAddrBytes();\n+            hasher.Write(a.nLastSuccess);\n+            hasher.Write(a.nAttempts);\n+            hasher.Write(a.nRefCount);\n+            hasher.Write(a.fInTried);\n+            hasher.Write(addr_key.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r732619501",
      "id" : 732619501,
      "line" : 150,
      "node_id" : "PRRC_kwDOABII584rquLt",
      "original_commit_id" : "5697d6054a1aaec0f89a8c8ce792d5e9f5c02314",
      "original_line" : 150,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/test/fuzz/addrman.cpp",
      "position" : 20,
      "pull_request_review_id" : 784266773,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732619501/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-20T12:31:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732619501",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r732708382"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732708382"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n    //! find an nId based on its network address and port\r\n```",
      "commit_id" : "5697d6054a1aaec0f89a8c8ce792d5e9f5c02314",
      "created_at" : "2021-10-20T12:10:13Z",
      "diff_hunk" : "@@ -180,7 +180,7 @@ class AddrManImpl\n     std::unordered_map<int, AddrInfo> mapInfo GUARDED_BY(cs);\n \n     //! find an nId based on its network address",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r732708382",
      "id" : 732708382,
      "line" : 182,
      "node_id" : "PRRC_kwDOABII584rrD4e",
      "original_commit_id" : "5697d6054a1aaec0f89a8c8ce792d5e9f5c02314",
      "original_line" : 182,
      "original_position" : 3,
      "original_start_line" : null,
      "path" : "src/addrman_impl.h",
      "position" : 3,
      "pull_request_review_id" : 784266773,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732708382/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-20T12:31:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732708382",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r733185755"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733185755"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "comment is outdated, it does get added because the IP will now make it to new, and then to tried",
      "commit_id" : "5697d6054a1aaec0f89a8c8ce792d5e9f5c02314",
      "created_at" : "2021-10-20T22:16:32Z",
      "diff_hunk" : "@@ -222,15 +222,15 @@ BOOST_AUTO_TEST_CASE(addrman_ports)\n     BOOST_CHECK_EQUAL(addrman.size(), 1U);\n \n     CService addr1_port = ResolveService(\"250.1.1.1\", 8334);\n-    BOOST_CHECK(!addrman.Add({CAddress(addr1_port, NODE_NONE)}, source));\n-    BOOST_CHECK_EQUAL(addrman.size(), 1U);\n+    BOOST_CHECK(addrman.Add({CAddress(addr1_port, NODE_NONE)}, source));\n+    BOOST_CHECK_EQUAL(addrman.size(), 2U);\n     auto addr_ret2 = addrman.Select().first;\n-    BOOST_CHECK_EQUAL(addr_ret2.ToString(), \"250.1.1.1:8333\");\n+    BOOST_CHECK(addr_ret2.ToString() == \"250.1.1.1:8333\" || addr_ret2.ToString() == \"250.1.1.1:8334\");\n \n     // Test: Add same IP but diff port to tried table, it doesn't get added.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r733185755",
      "id" : 733185755,
      "line" : 230,
      "node_id" : "PRRC_kwDOABII584rs4bb",
      "original_commit_id" : "5697d6054a1aaec0f89a8c8ce792d5e9f5c02314",
      "original_line" : 230,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/test/addrman_tests.cpp",
      "position" : 21,
      "pull_request_review_id" : 785045855,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733185755/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-21T18:01:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733185755",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK.\r\nInterested in addressing the [point](https://github.com/bitcoin/bitcoin/pull/23306#issuecomment-947516736) by practicalswift (either dismissing or accepting, but with rationale).\r\n\r\nOtherwise, I agree this change is beneficial and I don't see any real harm.",
      "created_at" : "2021-10-21T12:13:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#issuecomment-948553223",
      "id" : 948553223,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23306",
      "node_id" : "IC_kwDOABII5844icYH",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/948553223/reactions"
      },
      "updated_at" : "2021-10-21T12:13:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/948553223",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r733627448"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733627448"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`static_cast<const CService>` constructs a new `CService` object which is a copy of the `CService` inside the `AddrInfo`. `static_cast<const CService&>` just constructs a reference to that `CService` object.",
      "commit_id" : "5697d6054a1aaec0f89a8c8ce792d5e9f5c02314",
      "created_at" : "2021-10-21T12:32:49Z",
      "diff_hunk" : "@@ -137,24 +137,31 @@ class AddrManDeterministic : public AddrMan\n         // Check that all values in `mapInfo` are equal to all values in `other.mapInfo`.\n         // Keys may be different.\n \n-        using AddrInfoHasher = std::function<size_t(const AddrInfo&)>;\n         using AddrInfoEq = std::function<bool(const AddrInfo&, const AddrInfo&)>;\n \n-        CNetAddrHash netaddr_hasher;\n-\n-        AddrInfoHasher addrinfo_hasher = [&netaddr_hasher](const AddrInfo& a) {\n-            return netaddr_hasher(static_cast<CNetAddr>(a)) ^ netaddr_hasher(a.source) ^\n-                   a.nLastSuccess ^ a.nAttempts ^ a.nRefCount ^ a.fInTried;\n+        auto addrinfo_hasher = [](const AddrInfo& a) {\n+            CSipHasher hasher(0, 0);\n+            auto addr_key = a.GetKey();\n+            auto source_key = a.source.GetAddrBytes();\n+            hasher.Write(a.nLastSuccess);\n+            hasher.Write(a.nAttempts);\n+            hasher.Write(a.nRefCount);\n+            hasher.Write(a.fInTried);\n+            hasher.Write(addr_key.size());\n+            hasher.Write(source_key.size());\n+            hasher.Write(addr_key.data(), addr_key.size());\n+            hasher.Write(source_key.data(), source_key.size());\n+            return (size_t)hasher.Finalize();\n         };\n \n         AddrInfoEq addrinfo_eq = [](const AddrInfo& lhs, const AddrInfo& rhs) {\n-            return static_cast<CNetAddr>(lhs) == static_cast<CNetAddr>(rhs) &&\n+            return static_cast<const CService&>(lhs) == static_cast<const CService&>(rhs) &&",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r733627448",
      "id" : 733627448,
      "in_reply_to_id" : 732613976,
      "line" : 158,
      "node_id" : "PRRC_kwDOABII584rukQ4",
      "original_commit_id" : "5697d6054a1aaec0f89a8c8ce792d5e9f5c02314",
      "original_line" : 158,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/test/fuzz/addrman.cpp",
      "position" : 29,
      "pull_request_review_id" : 785626517,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733627448/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-21T12:32:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733627448",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@practicalswift That's a reasonable concern. I think as a first step, the policy could e.g. still maintain the deprioritization of connections to ports numbered < 1024.",
      "created_at" : "2021-10-21T20:49:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#issuecomment-948991979",
      "id" : 948991979,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23306",
      "node_id" : "IC_kwDOABII5844kHfr",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/948991979/reactions"
      },
      "updated_at" : "2021-10-21T20:49:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/948991979",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I like the idea of \"bad ports\", especially if popular softwares like Firefox and Chromium agree on what is a \"bad port\". Trying to open http://bitcoin.org:22/ in Firefox gives me \"This address is restricted\" error.\r\n\r\nThis discussion belongs to the next PR, which removes the 8333 preference:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/9469ffcb17f0018b61f85f835cc8b49370d26d1f/src/net.cpp#L2070\r\n\r\nMaybe when removing that, in the same PR, we should introduce the concept for \"bad ports\". I wonder if it would be as easy as adding `CService::IsValid()` which calls the parent's `CNetAddr::IsValid()` and does an extra check like:\r\n```cpp\r\nswitch (port) {\r\ncase 1: return false; // tcpmux\r\ncase 7: return false; // echo\r\ncase 9: return false; // discard\r\n...\r\n}\r\nreturn true;\r\n```\r\n",
      "created_at" : "2021-10-22T07:58:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#issuecomment-949381508",
      "id" : 949381508,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23306",
      "node_id" : "IC_kwDOABII5844lmmE",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/949381508/reactions"
      },
      "updated_at" : "2021-10-22T07:58:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/949381508",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r734390747"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/734390747"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    // Test: ensure Find returns an IP/port matching what we searched on.\r\n```",
      "commit_id" : "5697d6054a1aaec0f89a8c8ce792d5e9f5c02314",
      "created_at" : "2021-10-22T09:40:21Z",
      "diff_hunk" : "@@ -369,18 +369,18 @@ BOOST_AUTO_TEST_CASE(addrman_find)\n     CNetAddr source2 = ResolveIP(\"250.1.2.2\");\n \n     BOOST_CHECK(addrman.Add({addr1}, source1));\n-    BOOST_CHECK(!addrman.Add({addr2}, source2));\n+    BOOST_CHECK(addrman.Add({addr2}, source2));\n     BOOST_CHECK(addrman.Add({addr3}, source1));\n \n     // Test: ensure Find returns an IP matching what we searched on.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r734390747",
      "id" : 734390747,
      "line" : 375,
      "node_id" : "PRRC_kwDOABII584rxenb",
      "original_commit_id" : "5697d6054a1aaec0f89a8c8ce792d5e9f5c02314",
      "original_line" : 375,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/test/addrman_tests.cpp",
      "position" : 37,
      "pull_request_review_id" : 786638306,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/734390747/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-22T09:49:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/734390747",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r734391435"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/734391435"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    // Test: Find discriminates by port number.\r\n```",
      "commit_id" : "5697d6054a1aaec0f89a8c8ce792d5e9f5c02314",
      "created_at" : "2021-10-22T09:41:18Z",
      "diff_hunk" : "@@ -369,18 +369,18 @@ BOOST_AUTO_TEST_CASE(addrman_find)\n     CNetAddr source2 = ResolveIP(\"250.1.2.2\");\n \n     BOOST_CHECK(addrman.Add({addr1}, source1));\n-    BOOST_CHECK(!addrman.Add({addr2}, source2));\n+    BOOST_CHECK(addrman.Add({addr2}, source2));\n     BOOST_CHECK(addrman.Add({addr3}, source1));\n \n     // Test: ensure Find returns an IP matching what we searched on.\n     AddrInfo* info1 = addrman.Find(addr1);\n     BOOST_REQUIRE(info1);\n     BOOST_CHECK_EQUAL(info1->ToString(), \"250.1.2.1:8333\");\n \n-    // Test 18; Find does not discriminate by port number.\n+    // Test 18; Find does discriminate by port number.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r734391435",
      "id" : 734391435,
      "line" : 380,
      "node_id" : "PRRC_kwDOABII584rxeyL",
      "original_commit_id" : "5697d6054a1aaec0f89a8c8ce792d5e9f5c02314",
      "original_line" : 380,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/test/addrman_tests.cpp",
      "position" : 43,
      "pull_request_review_id" : 786638306,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/734391435/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-22T09:49:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/734391435",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r734395617"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/734395617"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe clearer (or maybe not):\r\n\r\n```\r\n            return std::tie(static_cast<const CService&>(lhs), lhs.source, lhs.nLastSuccess, lhs.nAttempts, lhs.nRefCount, lhs.fInTried) ==\r\n                   std::tie(static_cast<const CService&>(rhs), rhs.source, rhs.nLastSuccess, rhs.nAttempts, rhs.nRefCount, rhs.fInTried);\r\n```",
      "commit_id" : "5697d6054a1aaec0f89a8c8ce792d5e9f5c02314",
      "created_at" : "2021-10-22T09:47:14Z",
      "diff_hunk" : "@@ -137,24 +137,31 @@ class AddrManDeterministic : public AddrMan\n         // Check that all values in `mapInfo` are equal to all values in `other.mapInfo`.\n         // Keys may be different.\n \n-        using AddrInfoHasher = std::function<size_t(const AddrInfo&)>;\n         using AddrInfoEq = std::function<bool(const AddrInfo&, const AddrInfo&)>;\n \n-        CNetAddrHash netaddr_hasher;\n-\n-        AddrInfoHasher addrinfo_hasher = [&netaddr_hasher](const AddrInfo& a) {\n-            return netaddr_hasher(static_cast<CNetAddr>(a)) ^ netaddr_hasher(a.source) ^\n-                   a.nLastSuccess ^ a.nAttempts ^ a.nRefCount ^ a.fInTried;\n+        auto addrinfo_hasher = [](const AddrInfo& a) {\n+            CSipHasher hasher(0, 0);\n+            auto addr_key = a.GetKey();\n+            auto source_key = a.source.GetAddrBytes();\n+            hasher.Write(a.nLastSuccess);\n+            hasher.Write(a.nAttempts);\n+            hasher.Write(a.nRefCount);\n+            hasher.Write(a.fInTried);\n+            hasher.Write(addr_key.size());\n+            hasher.Write(source_key.size());\n+            hasher.Write(addr_key.data(), addr_key.size());\n+            hasher.Write(source_key.data(), source_key.size());\n+            return (size_t)hasher.Finalize();\n         };\n \n         AddrInfoEq addrinfo_eq = [](const AddrInfo& lhs, const AddrInfo& rhs) {\n-            return static_cast<CNetAddr>(lhs) == static_cast<CNetAddr>(rhs) &&\n+            return static_cast<const CService&>(lhs) == static_cast<const CService&>(rhs) &&",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r734395617",
      "id" : 734395617,
      "in_reply_to_id" : 732613976,
      "line" : 158,
      "node_id" : "PRRC_kwDOABII584rxfzh",
      "original_commit_id" : "5697d6054a1aaec0f89a8c8ce792d5e9f5c02314",
      "original_line" : 158,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/test/fuzz/addrman.cpp",
      "position" : 29,
      "pull_request_review_id" : 786638306,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/734395617/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-22T09:49:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/734395617",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, I think this makes sense. More flexibility with regard to ports is better, allows people to accept incoming connections on their node even if they can't bind to specific port 8333 (e.g. on a shared router). Also, it allows to route around the dumbest kind of ISP firewall blocking.\r\n\r\n> @practicalswift That's a reasonable concern. I think as a first step, the policy could e.g. still maintain the deprioritization of connections to ports numbered < 1024.\r\n\r\nI like this idea. Labeling specific \"bad ports\" could work too, but I don't see any problems with de-prioritizing the entire <1024 range, after all, to use them one would have to run `bitcoind` as root on many operating systems, which is inadvisable.",
      "created_at" : "2021-10-22T12:55:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#issuecomment-949605491",
      "id" : 949605491,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23306",
      "node_id" : "IC_kwDOABII5844mdRz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/949605491/reactions"
      },
      "updated_at" : "2021-10-22T12:55:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/949605491",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@sipa \r\n\r\n> > A third concern (which I think can be addressed: see below) could be that Bitcoin Core users would risk having to deal with bogus complaints along the lines of \"why am I seeing a failed SSH-login to my server on port 22 from your IP-address `w.x.y.z`?\" if we allowed for automatic outgoing connections on _all_ ports by default.\r\n\r\n> @practicalswift That's a reasonable concern. I think as a first step, the policy could e.g. still maintain the deprioritization of connections to ports numbered < 1024.\r\n\r\nSounds resonable. That should resolve this concern. Perhaps port 80 and 443 could be allowed too (in addition to >= 1024) in order to accommodate users behind very strict firewalls.\r\n\r\nFWIW, IETF Network Working Group's [\"Implications of running Internet over ports 80 and 443\"](https://tools.ietf.org/id/draft-blanchet-iab-internetoverport443-00.html): _\"Users are often connected to Internet with very few outgoing ports available, such as only port 80 and 443 over TCP. This situation has many implications on designing, deploying and using IETF protocols, such as encaspulating protocols within HTTP, difficulty to do traffic engineering, quality of service, peer-to-peer, multi-channel protocols or deploying new transport protocols. This document describes the situation and its implications.\"_\r\n\r\nFrom the same paper:\r\n* _\"A trend started many years ago has been to provide Internet access to end-users with limited outgoing ports. The most constraint but common case is to only have outgoing TCP port 80 and port 443 opened.\"_\r\n* _\"A consequence of this trend is that Internet statistics show [[Labovitz]](https://www.ietf.org/proceedings/77/slides/plenaryt-4.pdf) that a majority of the Internet traffic is over port 80 and 443. And the concentration on these ports are further increasing every year.\"_\r\n",
      "created_at" : "2021-10-22T15:20:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#issuecomment-949728023",
      "id" : 949728023,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23306",
      "node_id" : "IC_kwDOABII5844m7MX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 1,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/949728023/reactions"
      },
      "updated_at" : "2021-10-22T15:27:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/949728023",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "There are good ports <1024 (e.g. 80, 443) and bad ports >1024 (e.g. 6000). I think that if we are going to do `if (port < 1024 && port != 80 && port != 443)` (poor man bad ports approximation) we might as well do the proper `if (port == 1 || port == 7 || ...)` (or the `switch` from [above](https://github.com/bitcoin/bitcoin/pull/23306#issuecomment-949381508)).",
      "created_at" : "2021-10-22T15:30:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#issuecomment-949736271",
      "id" : 949736271,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23306",
      "node_id" : "IC_kwDOABII5844m9NP",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/949736271/reactions"
      },
      "updated_at" : "2021-10-22T15:30:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/949736271",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r734673274"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/734673274"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@jnewbery I like that; done.",
      "commit_id" : "92617b7a758c0425330fba4b886296730567927c",
      "created_at" : "2021-10-22T16:09:00Z",
      "diff_hunk" : "@@ -137,24 +137,31 @@ class AddrManDeterministic : public AddrMan\n         // Check that all values in `mapInfo` are equal to all values in `other.mapInfo`.\n         // Keys may be different.\n \n-        using AddrInfoHasher = std::function<size_t(const AddrInfo&)>;\n         using AddrInfoEq = std::function<bool(const AddrInfo&, const AddrInfo&)>;\n \n-        CNetAddrHash netaddr_hasher;\n-\n-        AddrInfoHasher addrinfo_hasher = [&netaddr_hasher](const AddrInfo& a) {\n-            return netaddr_hasher(static_cast<CNetAddr>(a)) ^ netaddr_hasher(a.source) ^\n-                   a.nLastSuccess ^ a.nAttempts ^ a.nRefCount ^ a.fInTried;\n+        auto addrinfo_hasher = [](const AddrInfo& a) {\n+            CSipHasher hasher(0, 0);\n+            auto addr_key = a.GetKey();\n+            auto source_key = a.source.GetAddrBytes();\n+            hasher.Write(a.nLastSuccess);\n+            hasher.Write(a.nAttempts);\n+            hasher.Write(a.nRefCount);\n+            hasher.Write(a.fInTried);\n+            hasher.Write(addr_key.size());\n+            hasher.Write(source_key.size());\n+            hasher.Write(addr_key.data(), addr_key.size());\n+            hasher.Write(source_key.data(), source_key.size());\n+            return (size_t)hasher.Finalize();\n         };\n \n         AddrInfoEq addrinfo_eq = [](const AddrInfo& lhs, const AddrInfo& rhs) {\n-            return static_cast<CNetAddr>(lhs) == static_cast<CNetAddr>(rhs) &&\n+            return static_cast<const CService&>(lhs) == static_cast<const CService&>(rhs) &&",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r734673274",
      "id" : 734673274,
      "in_reply_to_id" : 732613976,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584ryjl6",
      "original_commit_id" : "5697d6054a1aaec0f89a8c8ce792d5e9f5c02314",
      "original_line" : 158,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/test/fuzz/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 787036139,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/734673274/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-22T16:09:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/734673274",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r734673553"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/734673553"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed; I added a `GetNetwork` call to both the address and the source.",
      "commit_id" : "92617b7a758c0425330fba4b886296730567927c",
      "created_at" : "2021-10-22T16:09:21Z",
      "diff_hunk" : "@@ -137,24 +137,31 @@ class AddrManDeterministic : public AddrMan\n         // Check that all values in `mapInfo` are equal to all values in `other.mapInfo`.\n         // Keys may be different.\n \n-        using AddrInfoHasher = std::function<size_t(const AddrInfo&)>;\n         using AddrInfoEq = std::function<bool(const AddrInfo&, const AddrInfo&)>;\n \n-        CNetAddrHash netaddr_hasher;\n-\n-        AddrInfoHasher addrinfo_hasher = [&netaddr_hasher](const AddrInfo& a) {\n-            return netaddr_hasher(static_cast<CNetAddr>(a)) ^ netaddr_hasher(a.source) ^\n-                   a.nLastSuccess ^ a.nAttempts ^ a.nRefCount ^ a.fInTried;\n+        auto addrinfo_hasher = [](const AddrInfo& a) {\n+            CSipHasher hasher(0, 0);\n+            auto addr_key = a.GetKey();\n+            auto source_key = a.source.GetAddrBytes();\n+            hasher.Write(a.nLastSuccess);\n+            hasher.Write(a.nAttempts);\n+            hasher.Write(a.nRefCount);\n+            hasher.Write(a.fInTried);\n+            hasher.Write(addr_key.size());\n+            hasher.Write(source_key.size());\n+            hasher.Write(addr_key.data(), addr_key.size());\n+            hasher.Write(source_key.data(), source_key.size());\n+            return (size_t)hasher.Finalize();\n         };",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r734673553",
      "id" : 734673553,
      "in_reply_to_id" : 732619057,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584ryjqR",
      "original_commit_id" : "5697d6054a1aaec0f89a8c8ce792d5e9f5c02314",
      "original_line" : 155,
      "original_position" : 25,
      "original_start_line" : 142,
      "path" : "src/test/fuzz/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 787036487,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/734673553/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-10-22T16:09:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/734673553",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r734674839"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/734674839"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Just a general principle: when serializing data, always do it in a way that would be deserializable (even if it is being fed to a hasher where that doesn't matter). This avoids the situation where you have multiple variant-length fields, and you get collisions between (shorter+longer) and (longer+shorter).",
      "commit_id" : "92617b7a758c0425330fba4b886296730567927c",
      "created_at" : "2021-10-22T16:11:08Z",
      "diff_hunk" : "@@ -137,24 +137,31 @@ class AddrManDeterministic : public AddrMan\n         // Check that all values in `mapInfo` are equal to all values in `other.mapInfo`.\n         // Keys may be different.\n \n-        using AddrInfoHasher = std::function<size_t(const AddrInfo&)>;\n         using AddrInfoEq = std::function<bool(const AddrInfo&, const AddrInfo&)>;\n \n-        CNetAddrHash netaddr_hasher;\n-\n-        AddrInfoHasher addrinfo_hasher = [&netaddr_hasher](const AddrInfo& a) {\n-            return netaddr_hasher(static_cast<CNetAddr>(a)) ^ netaddr_hasher(a.source) ^\n-                   a.nLastSuccess ^ a.nAttempts ^ a.nRefCount ^ a.fInTried;\n+        auto addrinfo_hasher = [](const AddrInfo& a) {\n+            CSipHasher hasher(0, 0);\n+            auto addr_key = a.GetKey();\n+            auto source_key = a.source.GetAddrBytes();\n+            hasher.Write(a.nLastSuccess);\n+            hasher.Write(a.nAttempts);\n+            hasher.Write(a.nRefCount);\n+            hasher.Write(a.fInTried);\n+            hasher.Write(addr_key.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r734674839",
      "id" : 734674839,
      "in_reply_to_id" : 732619501,
      "line" : 150,
      "node_id" : "PRRC_kwDOABII584ryj-X",
      "original_commit_id" : "5697d6054a1aaec0f89a8c8ce792d5e9f5c02314",
      "original_line" : 150,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/test/fuzz/addrman.cpp",
      "position" : 22,
      "pull_request_review_id" : 787038185,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/734674839/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-22T16:11:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/734674839",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r734674925"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/734674925"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed.",
      "commit_id" : "92617b7a758c0425330fba4b886296730567927c",
      "created_at" : "2021-10-22T16:11:16Z",
      "diff_hunk" : "@@ -180,7 +180,7 @@ class AddrManImpl\n     std::unordered_map<int, AddrInfo> mapInfo GUARDED_BY(cs);\n \n     //! find an nId based on its network address",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r734674925",
      "id" : 734674925,
      "in_reply_to_id" : 732708382,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584ryj_t",
      "original_commit_id" : "5697d6054a1aaec0f89a8c8ce792d5e9f5c02314",
      "original_line" : 182,
      "original_position" : 3,
      "original_start_line" : null,
      "path" : "src/addrman_impl.h",
      "position" : null,
      "pull_request_review_id" : 787038309,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/734674925/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-22T16:11:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/734674925",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r734675227"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/734675227"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed.",
      "commit_id" : "92617b7a758c0425330fba4b886296730567927c",
      "created_at" : "2021-10-22T16:11:44Z",
      "diff_hunk" : "@@ -222,15 +222,15 @@ BOOST_AUTO_TEST_CASE(addrman_ports)\n     BOOST_CHECK_EQUAL(addrman.size(), 1U);\n \n     CService addr1_port = ResolveService(\"250.1.1.1\", 8334);\n-    BOOST_CHECK(!addrman.Add({CAddress(addr1_port, NODE_NONE)}, source));\n-    BOOST_CHECK_EQUAL(addrman.size(), 1U);\n+    BOOST_CHECK(addrman.Add({CAddress(addr1_port, NODE_NONE)}, source));\n+    BOOST_CHECK_EQUAL(addrman.size(), 2U);\n     auto addr_ret2 = addrman.Select().first;\n-    BOOST_CHECK_EQUAL(addr_ret2.ToString(), \"250.1.1.1:8333\");\n+    BOOST_CHECK(addr_ret2.ToString() == \"250.1.1.1:8333\" || addr_ret2.ToString() == \"250.1.1.1:8334\");\n \n     // Test: Add same IP but diff port to tried table, it doesn't get added.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r734675227",
      "id" : 734675227,
      "in_reply_to_id" : 733185755,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584rykEb",
      "original_commit_id" : "5697d6054a1aaec0f89a8c8ce792d5e9f5c02314",
      "original_line" : 230,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/test/addrman_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 787038750,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/734675227/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-22T16:11:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/734675227",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r734675327"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/734675327"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed.",
      "commit_id" : "92617b7a758c0425330fba4b886296730567927c",
      "created_at" : "2021-10-22T16:11:54Z",
      "diff_hunk" : "@@ -369,18 +369,18 @@ BOOST_AUTO_TEST_CASE(addrman_find)\n     CNetAddr source2 = ResolveIP(\"250.1.2.2\");\n \n     BOOST_CHECK(addrman.Add({addr1}, source1));\n-    BOOST_CHECK(!addrman.Add({addr2}, source2));\n+    BOOST_CHECK(addrman.Add({addr2}, source2));\n     BOOST_CHECK(addrman.Add({addr3}, source1));\n \n     // Test: ensure Find returns an IP matching what we searched on.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r734675327",
      "id" : 734675327,
      "in_reply_to_id" : 734390747,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584rykF_",
      "original_commit_id" : "5697d6054a1aaec0f89a8c8ce792d5e9f5c02314",
      "original_line" : 375,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/test/addrman_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 787038903,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/734675327/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-22T16:11:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/734675327",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r734675399"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/734675399"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "92617b7a758c0425330fba4b886296730567927c",
      "created_at" : "2021-10-22T16:12:01Z",
      "diff_hunk" : "@@ -369,18 +369,18 @@ BOOST_AUTO_TEST_CASE(addrman_find)\n     CNetAddr source2 = ResolveIP(\"250.1.2.2\");\n \n     BOOST_CHECK(addrman.Add({addr1}, source1));\n-    BOOST_CHECK(!addrman.Add({addr2}, source2));\n+    BOOST_CHECK(addrman.Add({addr2}, source2));\n     BOOST_CHECK(addrman.Add({addr3}, source1));\n \n     // Test: ensure Find returns an IP matching what we searched on.\n     AddrInfo* info1 = addrman.Find(addr1);\n     BOOST_REQUIRE(info1);\n     BOOST_CHECK_EQUAL(info1->ToString(), \"250.1.2.1:8333\");\n \n-    // Test 18; Find does not discriminate by port number.\n+    // Test 18; Find does discriminate by port number.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r734675399",
      "id" : 734675399,
      "in_reply_to_id" : 734391435,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584rykHH",
      "original_commit_id" : "5697d6054a1aaec0f89a8c8ce792d5e9f5c02314",
      "original_line" : 380,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/test/addrman_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 787039005,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/734675399/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-22T16:12:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/734675399",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK 92617b7a758c0425330fba4b886296730567927c",
      "created_at" : "2021-10-22T17:22:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#issuecomment-949825570",
      "id" : 949825570,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23306",
      "node_id" : "IC_kwDOABII5844nTAi",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/949825570/reactions"
      },
      "updated_at" : "2021-10-22T17:22:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/949825570",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "There is plenty to discuss still on exactly how the relax the peer port preference policy practically, which is probably best left for an actual PR that implements that. ",
      "created_at" : "2021-10-22T18:49:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#issuecomment-949883540",
      "id" : 949883540,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23306",
      "node_id" : "IC_kwDOABII5844nhKU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/949883540/reactions"
      },
      "updated_at" : "2021-10-22T18:49:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/949883540",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 92617b7a758c0425330fba4b886296730567927c",
      "created_at" : "2021-10-25T07:21:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#issuecomment-950604021",
      "id" : 950604021,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23306",
      "node_id" : "IC_kwDOABII5844qRD1",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/950604021/reactions"
      },
      "updated_at" : "2021-10-25T07:21:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/950604021",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ACK 92617b7a758c0425330fba4b886296730567927c\r\n\r\nIf I'm reading it right, it seems like ~5% of addresses in my addrman use non-default ports (and none of them seem to be bad ports like ssh or ircd), so moving towards more egalitarian treatment of those nodes seems like a good thing to me. I agree we should have some check for bad ports as part of the next PR that moves towards enabling that.",
      "created_at" : "2021-10-25T14:41:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#issuecomment-950999045",
      "id" : 950999045,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23306",
      "node_id" : "IC_kwDOABII5844rxgF",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/950999045/reactions"
      },
      "updated_at" : "2021-10-25T14:41:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/950999045",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Mental note: investigate what happens when downgrading, and you have a peers.dat with multiple entries for the same IP?",
      "created_at" : "2021-10-25T14:44:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#issuecomment-951002472",
      "id" : 951002472,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23306",
      "node_id" : "IC_kwDOABII5844ryVo",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/951002472/reactions"
      },
      "updated_at" : "2021-10-25T14:44:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/951002472",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Looks like a downgrade will fail with:\r\n\r\n`Error: Invalid or corrupt peers.dat (Corrupt data. Consistency check failed with code -5: iostream error). If you believe this is a bug, please report it to https://github.com/bitcoin/bitcoin/issues. As a workaround, you can move the file (\"/tmp/regtest/peers.dat\") out of the way (rename, move, or delete) to have a new one created on the next start.`\r\n",
      "created_at" : "2021-10-25T15:05:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#issuecomment-951022051",
      "id" : 951022051,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23306",
      "node_id" : "IC_kwDOABII5844r3Hj",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/951022051/reactions"
      },
      "updated_at" : "2021-10-26T12:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/951022051",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Looks like a downgrade will fail with:\r\n> \r\n> `Error: Invalid or corrupt peers.dat (Corrupt data. Consistency check failed with code -5: iostream error). If you believe this is a bug, please report it to https://github.com/bitcoin/bitcoin/issues. As a workaround, you can move the file (\"/tmp/regtest/peers.dat\") out of the way (rename, move, or delete) to have a new one created on the next start.`\r\n\r\nChanged in https://github.com/bitcoin/bitcoin/pull/23382",
      "created_at" : "2021-10-28T14:46:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#issuecomment-953919089",
      "id" : 953919089,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23306",
      "node_id" : "IC_kwDOABII584426Zx",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/953919089/reactions"
      },
      "updated_at" : "2021-10-28T14:46:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/953919089",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "A followup to this, that removes the strong preference for 8333 is in https://github.com/bitcoin/bitcoin/pull/23542.",
      "created_at" : "2021-11-18T10:17:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#issuecomment-972727530",
      "id" : 972727530,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23306",
      "node_id" : "IC_kwDOABII5845-qTq",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/972727530/reactions"
      },
      "updated_at" : "2021-11-18T10:17:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/972727530",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   }
]
