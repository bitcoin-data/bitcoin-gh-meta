[
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2021-10-27T14:30:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23365#issuecomment-952989643",
      "id" : 952989643,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23365",
      "node_id" : "IC_kwDOABII5844zXfL",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/952989643/reactions"
      },
      "updated_at" : "2021-10-27T14:30:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/952989643",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "The proposed change would also mean that it would now be possible to prune up to the best block of an index without needing to reindex (+1 block compared to master). I hope I'm not missing something, but I don't see why we still need the full data of `block->pprev` in the case where `block` is the best block of the index and `block->pprev`  was indexed in the past.\r\nI added a test for this edge case to `feature_blockfilterindex_prune.py`.",
      "created_at" : "2021-10-27T23:17:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23365#issuecomment-953378550",
      "id" : 953378550,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23365",
      "node_id" : "IC_kwDOABII584402b2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/953378550/reactions"
      },
      "updated_at" : "2021-10-27T23:17:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/953378550",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#23474](https://github.com/bitcoin/bitcoin/pull/23474) (test: scripted-diff cleanups after generate* changes by MarcoFalke)\n* [#21726](https://github.com/bitcoin/bitcoin/pull/21726) (Improve Indices on pruned nodes via prune blockers by fjahr)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-10-28T01:35:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23365#issuecomment-953430094",
      "id" : 953430094,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23365",
      "node_id" : "IC_kwDOABII58441DBO",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/953430094/reactions"
      },
      "updated_at" : "2021-11-10T05:13:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/953430094",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Moved out of draft and added steps to reproduce to OP.\r\nNot sure if the second commit (test) should be merged, maybe it's too detailed, plus the test gets reworked in #21726 anyway. \r\n\r\nNote that the last commit of #21726 would partly \"fix\" the issue too by just not running the affected code unless `-prune=1` is specified but doesn't address the root cause.",
      "created_at" : "2021-11-09T00:20:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23365#issuecomment-963694506",
      "id" : 963694506,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23365",
      "node_id" : "IC_kwDOABII5845cM-q",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/963694506/reactions"
      },
      "updated_at" : "2021-11-09T00:20:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/963694506",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23365#discussion_r745454407"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23365"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/745454407"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why is this change correct?",
      "commit_id" : "a36e23b183a6b8d1c60598618f2a5c8f31da02e0",
      "created_at" : "2021-11-09T09:54:34Z",
      "diff_hunk" : "@@ -24,11 +24,7 @@ def run_test(self):\n         self.log.info(\"check if we can access a blockfilter when pruning is enabled but no blocks are actually pruned\")\n         self.sync_index(height=200)\n         assert_greater_than(len(self.nodes[0].getblockfilter(self.nodes[0].getbestblockhash())['filter']), 0)\n-        # Mine two batches of blocks to avoid hitting NODE_NETWORK_LIMITED_MIN_BLOCKS disconnection\n-        self.generate(self.nodes[0], 250)\n-        self.sync_all()\n-        self.generate(self.nodes[0], 250)\n-        self.sync_all()\n+        self.generate(self.nodes[0], 500)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23365#discussion_r745454407",
      "id" : 745454407,
      "line" : 27,
      "node_id" : "PRRC_kwDOABII584sbrtH",
      "original_commit_id" : "a36e23b183a6b8d1c60598618f2a5c8f31da02e0",
      "original_line" : 27,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "test/functional/feature_blockfilterindex_prune.py",
      "position" : 9,
      "pull_request_review_id" : 801063611,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23365",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/745454407/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-09T09:54:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/745454407",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23365#discussion_r745466739"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23365"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/745466739"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Because preventing disconnections due to NODE_NETWORK_LIMITED_MIN_BLOCKS makes little sense  when there is just one node involved in the test. ",
      "commit_id" : "a36e23b183a6b8d1c60598618f2a5c8f31da02e0",
      "created_at" : "2021-11-09T10:09:37Z",
      "diff_hunk" : "@@ -24,11 +24,7 @@ def run_test(self):\n         self.log.info(\"check if we can access a blockfilter when pruning is enabled but no blocks are actually pruned\")\n         self.sync_index(height=200)\n         assert_greater_than(len(self.nodes[0].getblockfilter(self.nodes[0].getbestblockhash())['filter']), 0)\n-        # Mine two batches of blocks to avoid hitting NODE_NETWORK_LIMITED_MIN_BLOCKS disconnection\n-        self.generate(self.nodes[0], 250)\n-        self.sync_all()\n-        self.generate(self.nodes[0], 250)\n-        self.sync_all()\n+        self.generate(self.nodes[0], 500)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23365#discussion_r745466739",
      "id" : 745466739,
      "in_reply_to_id" : 745454407,
      "line" : 27,
      "node_id" : "PRRC_kwDOABII584sbutz",
      "original_commit_id" : "a36e23b183a6b8d1c60598618f2a5c8f31da02e0",
      "original_line" : 27,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "test/functional/feature_blockfilterindex_prune.py",
      "position" : 9,
      "pull_request_review_id" : 801080315,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23365",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/745466739/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-09T10:09:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/745466739",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2021-11-10T12:45:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23365#issuecomment-965098191",
      "id" : 965098191,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23365",
      "node_id" : "IC_kwDOABII5845hjrP",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/965098191/reactions"
      },
      "updated_at" : "2021-11-10T12:45:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/965098191",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-11-16T04:02:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23365#issuecomment-969836721",
      "id" : 969836721,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23365",
      "node_id" : "IC_kwDOABII5845zoix",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/969836721/reactions"
      },
      "updated_at" : "2021-11-16T04:02:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/969836721",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> The `block = block->pprev;` does make me a little nervous (although as-written the code would never cause any problems given how we initialize `block_to_test`), so if you wanted to you could include an assertion like\r\n\r\nThanks - I added the assertion as suggested, and rebased. Note that adding the assert only changes the kind of error: Before, if `block->pprev` had not existed (which I agree shouldn't be possible), the InitError would have been thrown  (because the while condition includes a check for `block`).\r\n",
      "created_at" : "2021-11-26T15:43:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23365#issuecomment-980067148",
      "id" : 980067148,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23365",
      "node_id" : "IC_kwDOABII5846aqNM",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/980067148/reactions"
      },
      "updated_at" : "2021-11-26T15:43:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/980067148",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23365#discussion_r763981042"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23365"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763981042"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It may be worth adding a comment here on _why_ `block->pprev` must exist (because we're walking backwards from the active chain tip to a block index in the active chain. If a block index that we encounter doesn't have a backwards pointer, then the chain is malformed).",
      "commit_id" : "9600ea01450b0d39be90eb2971c1ac5c9b69a66e",
      "created_at" : "2021-12-07T13:16:06Z",
      "diff_hunk" : "@@ -91,11 +91,12 @@ bool BaseIndex::Init()\n             const CBlockIndex* block = active_chain.Tip();\n             prune_violation = true;\n             // check backwards from the tip if we have all block data until we reach the indexes bestblock\n-            while (block_to_test && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA)) {\n+            while (block_to_test && block && (block->nStatus & BLOCK_HAVE_DATA)) {\n                 if (block_to_test == block) {\n                     prune_violation = false;\n                     break;\n                 }\n+                assert(block->pprev);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23365#discussion_r763981042",
      "id" : 763981042,
      "line" : 99,
      "node_id" : "PRRC_kwDOABII584tiWzy",
      "original_commit_id" : "9600ea01450b0d39be90eb2971c1ac5c9b69a66e",
      "original_line" : 99,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/index/base.cpp",
      "position" : 10,
      "pull_request_review_id" : 825258964,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23365",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763981042/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-07T13:18:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763981042",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23365#discussion_r763982639"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23365"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763982639"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is there a specific reason why calling `pruneblockchain(1000)` prunes up to exactly block 998? Is it because that's where the block file happens to wrap (i.e. blocks 999 and 1000 are in the same file as later blocks and so can't be pruned). If so, that seems a bit brittle (e.g. if the default block file size of disk serialization changes, then this test will fail), and definitely seems worthy of a comment.",
      "commit_id" : "9600ea01450b0d39be90eb2971c1ac5c9b69a66e",
      "created_at" : "2021-12-07T13:18:15Z",
      "diff_hunk" : "@@ -39,16 +37,29 @@ def run_test(self):\n         self.log.info(\"check if we can access the blockfilter of a pruned block\")\n         assert_greater_than(len(self.nodes[0].getblockfilter(self.nodes[0].getblockhash(2))['filter']), 0)\n \n+        # mine and sync index up to a height that will later be the pruneheight\n+        self.generate(self.nodes[0], 298)\n+        self.sync_index(height=998)\n+\n         self.log.info(\"start node without blockfilterindex\")\n         self.restart_node(0, extra_args=[\"-fastprune\", \"-prune=1\"])\n \n         self.log.info(\"make sure accessing the blockfilters throws an error\")\n         assert_raises_rpc_error(-1, \"Index is not enabled for filtertype basic\", self.nodes[0].getblockfilter, self.nodes[0].getblockhash(2))\n-        self.generate(self.nodes[0], 1000)\n+        self.generate(self.nodes[0], 502)\n+\n+        self.log.info(\"prune exactly up to the blockfilterindexes best block while blockfilters are disabled\")\n+        pruneheight_2 = self.nodes[0].pruneblockchain(1000)\n+        assert_equal(pruneheight_2, 998)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23365#discussion_r763982639",
      "id" : 763982639,
      "line" : 53,
      "node_id" : "PRRC_kwDOABII584tiXMv",
      "original_commit_id" : "9600ea01450b0d39be90eb2971c1ac5c9b69a66e",
      "original_line" : 53,
      "original_position" : 29,
      "original_start_line" : 52,
      "path" : "test/functional/feature_blockfilterindex_prune.py",
      "position" : 29,
      "pull_request_review_id" : 825258964,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23365",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763982639/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 52,
      "start_side" : "RIGHT",
      "updated_at" : "2021-12-07T13:18:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763982639",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23365#discussion_r764056096"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23365"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764056096"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This isn't actually a correct explanation (the genesis block is in the active chain and doesn't have `pprev` set). The reason this assertion will hold is because of how `block` and `block_to_test` are chosen; the conditional above this line is guaranteed to break at-or-higher-than genesis because of the few lines of logic above (which, if summarized in a comment, would just end up repeating the fairly-straightforward code above).",
      "commit_id" : "9600ea01450b0d39be90eb2971c1ac5c9b69a66e",
      "created_at" : "2021-12-07T14:37:17Z",
      "diff_hunk" : "@@ -91,11 +91,12 @@ bool BaseIndex::Init()\n             const CBlockIndex* block = active_chain.Tip();\n             prune_violation = true;\n             // check backwards from the tip if we have all block data until we reach the indexes bestblock\n-            while (block_to_test && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA)) {\n+            while (block_to_test && block && (block->nStatus & BLOCK_HAVE_DATA)) {\n                 if (block_to_test == block) {\n                     prune_violation = false;\n                     break;\n                 }\n+                assert(block->pprev);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23365#discussion_r764056096",
      "id" : 764056096,
      "in_reply_to_id" : 763981042,
      "line" : 99,
      "node_id" : "PRRC_kwDOABII584tipIg",
      "original_commit_id" : "9600ea01450b0d39be90eb2971c1ac5c9b69a66e",
      "original_line" : 99,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/index/base.cpp",
      "position" : 10,
      "pull_request_review_id" : 825365003,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23365",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764056096/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-07T14:37:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764056096",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23365#discussion_r764126299"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23365"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764126299"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think you're saying the same thing as I am. Because of the way `block` and `block_to_test` are chosen, if we walk backwards from `block`, we're guaranteed to encounter `block_to_test` (either at or before the genesis block).",
      "commit_id" : "9600ea01450b0d39be90eb2971c1ac5c9b69a66e",
      "created_at" : "2021-12-07T15:46:53Z",
      "diff_hunk" : "@@ -91,11 +91,12 @@ bool BaseIndex::Init()\n             const CBlockIndex* block = active_chain.Tip();\n             prune_violation = true;\n             // check backwards from the tip if we have all block data until we reach the indexes bestblock\n-            while (block_to_test && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA)) {\n+            while (block_to_test && block && (block->nStatus & BLOCK_HAVE_DATA)) {\n                 if (block_to_test == block) {\n                     prune_violation = false;\n                     break;\n                 }\n+                assert(block->pprev);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23365#discussion_r764126299",
      "id" : 764126299,
      "in_reply_to_id" : 763981042,
      "line" : 99,
      "node_id" : "PRRC_kwDOABII584ti6Rb",
      "original_commit_id" : "9600ea01450b0d39be90eb2971c1ac5c9b69a66e",
      "original_line" : 99,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/index/base.cpp",
      "position" : 10,
      "pull_request_review_id" : 825462123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23365",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764126299/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-07T15:46:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764126299",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23365#discussion_r768146262"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23365"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/768146262"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Is it because that's where the block file happens to wrap\r\n\r\nYes, I believe that is the reason, and I agree it's brittle (although the test relied before on this, e.g. at `assert_equal(pruneheight, 248)` - I'm not sure though if there is a better way to test pruning in a detailed way.",
      "commit_id" : "9600ea01450b0d39be90eb2971c1ac5c9b69a66e",
      "created_at" : "2021-12-13T21:45:32Z",
      "diff_hunk" : "@@ -39,16 +37,29 @@ def run_test(self):\n         self.log.info(\"check if we can access the blockfilter of a pruned block\")\n         assert_greater_than(len(self.nodes[0].getblockfilter(self.nodes[0].getblockhash(2))['filter']), 0)\n \n+        # mine and sync index up to a height that will later be the pruneheight\n+        self.generate(self.nodes[0], 298)\n+        self.sync_index(height=998)\n+\n         self.log.info(\"start node without blockfilterindex\")\n         self.restart_node(0, extra_args=[\"-fastprune\", \"-prune=1\"])\n \n         self.log.info(\"make sure accessing the blockfilters throws an error\")\n         assert_raises_rpc_error(-1, \"Index is not enabled for filtertype basic\", self.nodes[0].getblockfilter, self.nodes[0].getblockhash(2))\n-        self.generate(self.nodes[0], 1000)\n+        self.generate(self.nodes[0], 502)\n+\n+        self.log.info(\"prune exactly up to the blockfilterindexes best block while blockfilters are disabled\")\n+        pruneheight_2 = self.nodes[0].pruneblockchain(1000)\n+        assert_equal(pruneheight_2, 998)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23365#discussion_r768146262",
      "id" : 768146262,
      "in_reply_to_id" : 763982639,
      "line" : 53,
      "node_id" : "PRRC_kwDOABII584tyPtW",
      "original_commit_id" : "9600ea01450b0d39be90eb2971c1ac5c9b69a66e",
      "original_line" : 53,
      "original_position" : 29,
      "original_start_line" : 52,
      "path" : "test/functional/feature_blockfilterindex_prune.py",
      "position" : 29,
      "pull_request_review_id" : 830789846,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23365",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/768146262/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 52,
      "start_side" : "RIGHT",
      "updated_at" : "2021-12-13T21:45:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/768146262",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23365#discussion_r768149008"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23365"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/768149008"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Sorry I didn't get to this earlier, would have added a comment, do people think that this warrants a follow-up?",
      "commit_id" : "9600ea01450b0d39be90eb2971c1ac5c9b69a66e",
      "created_at" : "2021-12-13T21:50:01Z",
      "diff_hunk" : "@@ -91,11 +91,12 @@ bool BaseIndex::Init()\n             const CBlockIndex* block = active_chain.Tip();\n             prune_violation = true;\n             // check backwards from the tip if we have all block data until we reach the indexes bestblock\n-            while (block_to_test && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA)) {\n+            while (block_to_test && block && (block->nStatus & BLOCK_HAVE_DATA)) {\n                 if (block_to_test == block) {\n                     prune_violation = false;\n                     break;\n                 }\n+                assert(block->pprev);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23365#discussion_r768149008",
      "id" : 768149008,
      "in_reply_to_id" : 763981042,
      "line" : 99,
      "node_id" : "PRRC_kwDOABII584tyQYQ",
      "original_commit_id" : "9600ea01450b0d39be90eb2971c1ac5c9b69a66e",
      "original_line" : 99,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/index/base.cpp",
      "position" : 10,
      "pull_request_review_id" : 830793611,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23365",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/768149008/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-13T21:50:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/768149008",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23365#discussion_r768248831"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23365"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/768248831"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@mzumsande sounds like it could be.",
      "commit_id" : "9600ea01450b0d39be90eb2971c1ac5c9b69a66e",
      "created_at" : "2021-12-14T01:30:52Z",
      "diff_hunk" : "@@ -91,11 +91,12 @@ bool BaseIndex::Init()\n             const CBlockIndex* block = active_chain.Tip();\n             prune_violation = true;\n             // check backwards from the tip if we have all block data until we reach the indexes bestblock\n-            while (block_to_test && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA)) {\n+            while (block_to_test && block && (block->nStatus & BLOCK_HAVE_DATA)) {\n                 if (block_to_test == block) {\n                     prune_violation = false;\n                     break;\n                 }\n+                assert(block->pprev);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23365#discussion_r768248831",
      "id" : 768248831,
      "in_reply_to_id" : 763981042,
      "line" : 99,
      "node_id" : "PRRC_kwDOABII584tyov_",
      "original_commit_id" : "9600ea01450b0d39be90eb2971c1ac5c9b69a66e",
      "original_line" : 99,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/index/base.cpp",
      "position" : 10,
      "pull_request_review_id" : 830927740,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23365",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/768248831/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-14T01:30:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/768248831",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23365#discussion_r769095589"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23365"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/769095589"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done in #23777",
      "commit_id" : "9600ea01450b0d39be90eb2971c1ac5c9b69a66e",
      "created_at" : "2021-12-14T22:28:08Z",
      "diff_hunk" : "@@ -91,11 +91,12 @@ bool BaseIndex::Init()\n             const CBlockIndex* block = active_chain.Tip();\n             prune_violation = true;\n             // check backwards from the tip if we have all block data until we reach the indexes bestblock\n-            while (block_to_test && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA)) {\n+            while (block_to_test && block && (block->nStatus & BLOCK_HAVE_DATA)) {\n                 if (block_to_test == block) {\n                     prune_violation = false;\n                     break;\n                 }\n+                assert(block->pprev);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23365#discussion_r769095589",
      "id" : 769095589,
      "in_reply_to_id" : 763981042,
      "line" : 99,
      "node_id" : "PRRC_kwDOABII584t13el",
      "original_commit_id" : "9600ea01450b0d39be90eb2971c1ac5c9b69a66e",
      "original_line" : 99,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/index/base.cpp",
      "position" : 10,
      "pull_request_review_id" : 832110992,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23365",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/769095589/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-14T22:28:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/769095589",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23365#discussion_r769095728"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23365"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/769095728"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "comment added in #23777",
      "commit_id" : "9600ea01450b0d39be90eb2971c1ac5c9b69a66e",
      "created_at" : "2021-12-14T22:28:21Z",
      "diff_hunk" : "@@ -39,16 +37,29 @@ def run_test(self):\n         self.log.info(\"check if we can access the blockfilter of a pruned block\")\n         assert_greater_than(len(self.nodes[0].getblockfilter(self.nodes[0].getblockhash(2))['filter']), 0)\n \n+        # mine and sync index up to a height that will later be the pruneheight\n+        self.generate(self.nodes[0], 298)\n+        self.sync_index(height=998)\n+\n         self.log.info(\"start node without blockfilterindex\")\n         self.restart_node(0, extra_args=[\"-fastprune\", \"-prune=1\"])\n \n         self.log.info(\"make sure accessing the blockfilters throws an error\")\n         assert_raises_rpc_error(-1, \"Index is not enabled for filtertype basic\", self.nodes[0].getblockfilter, self.nodes[0].getblockhash(2))\n-        self.generate(self.nodes[0], 1000)\n+        self.generate(self.nodes[0], 502)\n+\n+        self.log.info(\"prune exactly up to the blockfilterindexes best block while blockfilters are disabled\")\n+        pruneheight_2 = self.nodes[0].pruneblockchain(1000)\n+        assert_equal(pruneheight_2, 998)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23365#discussion_r769095728",
      "id" : 769095728,
      "in_reply_to_id" : 763982639,
      "line" : 53,
      "node_id" : "PRRC_kwDOABII584t13gw",
      "original_commit_id" : "9600ea01450b0d39be90eb2971c1ac5c9b69a66e",
      "original_line" : 53,
      "original_position" : 29,
      "original_start_line" : 52,
      "path" : "test/functional/feature_blockfilterindex_prune.py",
      "position" : 29,
      "pull_request_review_id" : 832111163,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23365",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/769095728/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 52,
      "start_side" : "RIGHT",
      "updated_at" : "2021-12-14T22:28:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/769095728",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23365#discussion_r769096938"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23365"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/769096938"
         }
      },
      "author_association" : "NONE",
      "body" : "Star\r\n",
      "commit_id" : "9600ea01450b0d39be90eb2971c1ac5c9b69a66e",
      "created_at" : "2021-12-14T22:30:40Z",
      "diff_hunk" : "@@ -39,16 +37,29 @@ def run_test(self):\n         self.log.info(\"check if we can access the blockfilter of a pruned block\")\n         assert_greater_than(len(self.nodes[0].getblockfilter(self.nodes[0].getblockhash(2))['filter']), 0)\n \n+        # mine and sync index up to a height that will later be the pruneheight\n+        self.generate(self.nodes[0], 298)\n+        self.sync_index(height=998)\n+\n         self.log.info(\"start node without blockfilterindex\")\n         self.restart_node(0, extra_args=[\"-fastprune\", \"-prune=1\"])\n \n         self.log.info(\"make sure accessing the blockfilters throws an error\")\n         assert_raises_rpc_error(-1, \"Index is not enabled for filtertype basic\", self.nodes[0].getblockfilter, self.nodes[0].getblockhash(2))\n-        self.generate(self.nodes[0], 1000)\n+        self.generate(self.nodes[0], 502)\n+\n+        self.log.info(\"prune exactly up to the blockfilterindexes best block while blockfilters are disabled\")\n+        pruneheight_2 = self.nodes[0].pruneblockchain(1000)\n+        assert_equal(pruneheight_2, 998)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23365#discussion_r769096938",
      "id" : 769096938,
      "in_reply_to_id" : 763982639,
      "line" : 53,
      "node_id" : "PRRC_kwDOABII584t13zq",
      "original_commit_id" : "9600ea01450b0d39be90eb2971c1ac5c9b69a66e",
      "original_line" : 53,
      "original_position" : 29,
      "original_start_line" : 52,
      "path" : "test/functional/feature_blockfilterindex_prune.py",
      "position" : 29,
      "pull_request_review_id" : 832112850,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23365",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/769096938/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 52,
      "start_side" : "RIGHT",
      "updated_at" : "2021-12-14T22:30:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/769096938",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/90076990?v=4",
         "events_url" : "https://api.github.com/users/2310Mas/events{/privacy}",
         "followers_url" : "https://api.github.com/users/2310Mas/followers",
         "following_url" : "https://api.github.com/users/2310Mas/following{/other_user}",
         "gists_url" : "https://api.github.com/users/2310Mas/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/2310Mas",
         "id" : 90076990,
         "login" : "2310Mas",
         "node_id" : "MDQ6VXNlcjkwMDc2OTkw",
         "organizations_url" : "https://api.github.com/users/2310Mas/orgs",
         "received_events_url" : "https://api.github.com/users/2310Mas/received_events",
         "repos_url" : "https://api.github.com/users/2310Mas/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/2310Mas/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/2310Mas/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/2310Mas"
      }
   }
]
