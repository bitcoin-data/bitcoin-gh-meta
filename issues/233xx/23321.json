{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "NONE",
   "body" : "\r\nBitcoin v22.0, tested on both self compiled and official release\r\nFirst of all, this happens on **regtest** only.\r\n\r\nHow to reproduce: \r\n- run regtest instance of btc\r\n```\r\n$ bitcoin-cli -named createwallet wallet_name=wallet descriptors=true blank=true\r\n$ cat regtest-descriptors.txt\r\n[\r\n  {\r\n    \"desc\": \"tr([e4445899/49'/1'/0']tprv8ZgxMBicQKsPd8jCeBWsYLEoWxbVgzJDatJ7XkwQ6G3uF4FsHuaziHQ5JZAW4K515nj6kVVwPaNWZSMEcR7aFCwL4tQqTcaoprMKTTtm6Zg/1/*)#mr3llm7f\",\r\n    \"timestamp\": 1634652324,\r\n    \"active\": true,\r\n    \"internal\": true,\r\n    \"range\": [\r\n      0,\r\n      999\r\n    ],\r\n    \"next\": 0\r\n  }\r\n]\r\n$ bitcoin-cli importdescriptors \"$(cat regtest-descriptors.txt)\"\r\n``` \r\n\r\ngdb log:\r\n```\r\nStarting program: /usr/local/bin/bitcoind > debug.log\r\nwarning: Error disabling address space randomization: Operation not permitted\r\n[Thread debugging using libthread_db enabled]\r\nUsing host libthread_db library \"/lib/x86_64-linux-gnu/libthread_db.so.1\".\r\n[New Thread 0x7f111c182700 (LWP 2672)]\r\n[New Thread 0x7f111b981700 (LWP 2673)]\r\n[New Thread 0x7f111b180700 (LWP 2674)]\r\n[New Thread 0x7f111a97f700 (LWP 2675)]\r\n[New Thread 0x7f111a17e700 (LWP 2676)]\r\n[New Thread 0x7f111997d700 (LWP 2677)]\r\n[New Thread 0x7f111917c700 (LWP 2678)]\r\n[New Thread 0x7f111897b700 (LWP 2679)]\r\n[New Thread 0x7f10fbfff700 (LWP 2680)]\r\n[New Thread 0x7f10fb7fe700 (LWP 2681)]\r\n[New Thread 0x7f10faffd700 (LWP 2682)]\r\n[New Thread 0x7f10fa7fc700 (LWP 2683)]\r\n[New Thread 0x7f10f9ffb700 (LWP 2684)]\r\n[New Thread 0x7f10f96be700 (LWP 2685)]\r\n[Thread 0x7f10f96be700 (LWP 2685) exited]\r\n[New Thread 0x7f10f8ebd700 (LWP 2686)]\r\n[New Thread 0x7f10dffff700 (LWP 2687)]\r\n[New Thread 0x7f10df7fe700 (LWP 2688)]\r\n[Thread 0x7f10dffff700 (LWP 2687) exited]\r\n[New Thread 0x7f10deffd700 (LWP 2689)]\r\n[New Thread 0x7f10de7fc700 (LWP 2690)]\r\n\r\nThread 13 \"b-httpworker.2\" received signal SIGSEGV, Segmentation fault.\r\n[Switching to Thread 0x7f10fa7fc700 (LWP 2683)]\r\nCWallet::KeypoolCountExternalKeys (this=0x7f10e0024040) at wallet/wallet.cpp:2104\r\n2104    wallet/wallet.cpp: No such file or directory.\r\n#0  CWallet::KeypoolCountExternalKeys (this=0x7f10e0024040) at wallet/wallet.cpp:2104\r\n#1  0x0000563a086e76a3 in <lambda(const RPCHelpMan&, const JSONRPCRequest&)>::operator()(const JSONRPCRequest &, const RPCHelpMan &) (request=..., self=..., __closure=<optimized out>)\r\n    at /usr/include/c++/8/bits/shared_ptr_base.h:1018\r\n#2  0x0000563a086e8464 in std::_Function_handler<UniValue(const RPCHelpMan&, const JSONRPCRequest&), getwalletinfo()::<lambda(const RPCHelpMan&, const JSONRPCRequest&)> >::_M_invoke(const std::_Any_data &, const RPCHelpMan &, const JSONRPCRequest &) (__functor=..., __args#0=..., __args#1=...) at /usr/include/c++/8/bits/std_function.h:88\r\n#3  0x0000563a0880a352 in std::function<UniValue (RPCHelpMan const&, JSONRPCRequest const&)>::operator()(RPCHelpMan const&, JSONRPCRequest const&) const (__args#1=..., __args#0=..., \r\n    this=0x7f10fa7fa700) at /usr/include/c++/8/bits/std_function.h:682\r\n#4  RPCHelpMan::HandleRequest (this=this@entry=0x7f10fa7fa6e0, request=...) at rpc/util.cpp:575\r\n#5  0x0000563a084ecf4e in CRPCCommand::CRPCCommand(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, RPCHelpMan (*)())::{lambda(JSONRPCRequest const&, UniValue&, bool)#1}::operator()(JSONRPCRequest const&, UniValue&, bool) const (__closure=<optimized out>, request=..., result=...) at ./rpc/server.h:110\r\n#6  0x0000563a086726f8 in std::function<bool (JSONRPCRequest const&, UniValue&, bool)>::operator()(JSONRPCRequest const&, UniValue&, bool) const (__args#2=<optimized out>, __args#1=..., \r\n    __args#0=..., this=<optimized out>) at /usr/include/c++/8/bits/std_function.h:682\r\n#7  wallet::(anonymous namespace)::WalletClientImpl::<lambda(const JSONRPCRequest&, UniValue&, bool)>::operator()(const JSONRPCRequest &, UniValue &, bool) const (\r\n    __closure=0x563a0a0ed950, request=..., result=..., last_handler=<optimized out>) at wallet/interfaces.cpp:516\r\n#8  0x0000563a0846fdf3 in std::function<bool (JSONRPCRequest const&, UniValue&, bool)>::operator()(JSONRPCRequest const&, UniValue&, bool) const (__args#2=<optimized out>, __args#1=..., \r\n    __args#0=..., this=<optimized out>) at /usr/include/c++/8/bits/std_function.h:682\r\n#9  node::(anonymous namespace)::RpcHandlerImpl::<lambda(const JSONRPCRequest&, UniValue&, bool)>::operator() (last_handler=true, result=..., request=..., __closure=<optimized out>)\r\n    at node/interfaces.cpp:397\r\n#10 std::_Function_handler<bool(const JSONRPCRequest&, UniValue&, bool), node::(anonymous namespace)::RpcHandlerImpl::RpcHandlerImpl(const CRPCCommand&)::<lambda(const JSONRPCRequest&, UniValue&, bool)> >::_M_invoke(const std::_Any_data &, const JSONRPCRequest &, UniValue &, bool &&) (__functor=..., __args#0=..., __args#1=..., __args#2=<optimized out>)\r\n    at /usr/include/c++/8/bits/std_function.h:282\r\n#11 0x0000563a08570a1e in std::function<bool (JSONRPCRequest const&, UniValue&, bool)>::operator()(JSONRPCRequest const&, UniValue&, bool) const (__args#2=<optimized out>, __args#1=..., \r\n    __args#0=..., this=0x563a0a0ed9e8) at /usr/include/c++/8/bits/std_function.h:682\r\n#12 ExecuteCommand (command=..., request=..., result=..., last_handler=<optimized out>) at rpc/server.cpp:480\r\n#13 0x0000563a08571408 in ExecuteCommands (commands=std::vector of length 1, capacity 1 = {...}, request=..., result=...) at /usr/include/c++/8/bits/stl_iterator.h:844\r\n#14 0x0000563a085718e8 in CRPCTable::execute (this=0x563a08c35260 <tableRPC>, request=...) at rpc/server.cpp:464\r\n#15 0x0000563a08630c04 in HTTPReq_JSONRPC (context=..., req=0x7f10f00022f0) at httprpc.cpp:202\r\n#16 0x0000563a08634b99 in std::function<bool (HTTPRequest*, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&)>::operator()(HTTPRequest*, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&) const (__args#1=\"\", __args#0=<optimized out>, this=0x7f10f0001060) at /usr/include/c++/8/bits/std_function.h:682\r\n#17 HTTPWorkItem::operator() (this=0x7f10f0001030) at httpserver.cpp:49\r\n#18 WorkQueue<HTTPClosure>::Run (this=0x563a0a0de5e0) at httpserver.cpp:107\r\n#19 HTTPWorkQueueRun (queue=0x563a0a0de5e0, worker_num=<optimized out>) at httpserver.cpp:335\r\n#20 0x00007f111ea90b2f in ?? () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\r\n#21 0x00007f111f1a9fa3 in start_thread () from /lib/x86_64-linux-gnu/libpthread.so.0\r\n#22 0x00007f111e7704cf in clone () from /lib/x86_64-linux-gnu/libc.so.6\r\n```\r\n\r\nfull debug log https://pastebin.com/9nz6xi5V",
   "closed_at" : "2021-10-22T12:35:51Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
      "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
      "followers_url" : "https://api.github.com/users/fanquake/followers",
      "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/fanquake",
      "id" : 863730,
      "login" : "fanquake",
      "node_id" : "MDQ6VXNlcjg2MzczMA==",
      "organizations_url" : "https://api.github.com/users/fanquake/orgs",
      "received_events_url" : "https://api.github.com/users/fanquake/received_events",
      "repos_url" : "https://api.github.com/users/fanquake/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/fanquake"
   },
   "comments" : 4,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23321/comments",
   "created_at" : "2021-10-20T09:19:57Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23321/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/23321",
   "id" : 1031174292,
   "labels" : [
      {
         "color" : "FBBAAB",
         "default" : false,
         "description" : null,
         "id" : 64585,
         "name" : "Bug",
         "node_id" : "MDU6TGFiZWw2NDU4NQ==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23321/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "I_kwDOABII5849dniU",
   "number" : 23321,
   "performed_via_github_app" : null,
   "reactions" : {
      "+1" : 0,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 0,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23321/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23321/timeline",
   "title" : "bitcoind segfault's while loading tr descriptor on regtest v22.0",
   "updated_at" : "2021-10-22T12:35:51Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23321",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/52073977?v=4",
      "events_url" : "https://api.github.com/users/josef-v/events{/privacy}",
      "followers_url" : "https://api.github.com/users/josef-v/followers",
      "following_url" : "https://api.github.com/users/josef-v/following{/other_user}",
      "gists_url" : "https://api.github.com/users/josef-v/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/josef-v",
      "id" : 52073977,
      "login" : "josef-v",
      "node_id" : "MDQ6VXNlcjUyMDczOTc3",
      "organizations_url" : "https://api.github.com/users/josef-v/orgs",
      "received_events_url" : "https://api.github.com/users/josef-v/received_events",
      "repos_url" : "https://api.github.com/users/josef-v/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/josef-v/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/josef-v/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/josef-v"
   }
}
