[
   {
      "author_association" : "MEMBER",
      "body" : "Not sure if this is useful. Otherwise you could also create a \"default from node\" for `sendrawtransaction` or other RPCs. However, this will make tests harder to read and understand, as it is unclear which node the tx was sent from.\r\n\r\nThe MiniWallet acts as a shared wallet between all nodes spun up in the test (as opposed to a wallet that is attached and managed by a specific node).\r\n\r\nI think the only place where this makes sense is for tests that only spin up one node.",
      "created_at" : "2022-01-11T08:55:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24025#issuecomment-1009727691",
      "id" : 1009727691,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24025",
      "node_id" : "IC_kwDOABII5848LzjL",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1009727691/reactions"
      },
      "updated_at" : "2022-01-11T08:55:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1009727691",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@MarcoFalke: Fair points, though I would counter the general \"will make tests harder to read and understand\" argument with the fact that for the vast majority of tests the origin of a tx is not relevant at all, as we just want to fill the mempools of all nodes (in the rare cases where different mempool- or policy-related settings are used, or the nodes are not all connected, `from_node` could still be passed explicitly). In a personal experience it feels odd to already need to pass a specific node on the MiniWallet instance but then still having to pass `from_node` again and again for trivial tests.\r\n\r\nAs a possibly less controversial suggestion, would it at least make sense to introduce the default parameter for `create_self_transfer`? The node parameter is only used for the `testmempoolaccept` RPC and the tx is not sent yet, i.e. using `self._test_node` as default for that purpose seems to be fine. `send_self_transfer` and `send_to` would of course still call `create_self_transfer` with the still mandatory `from_node` argument.",
      "created_at" : "2022-01-11T12:06:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24025#issuecomment-1009900630",
      "id" : 1009900630,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24025",
      "node_id" : "IC_kwDOABII5848MdxW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1009900630/reactions"
      },
      "updated_at" : "2022-01-11T12:06:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1009900630",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> want to fill the mempools of all nodes\r\n\r\nOk, unrelated, but I think we should make that explicit. Not sure how successful such a patch would be, considering that https://github.com/bitcoin/bitcoin/pull/23300 took two years (https://github.com/bitcoin/bitcoin/pull/20362). But overall we should be moving into that direction, given that racy tests will inevitably lead to bugs (https://github.com/bitcoin/bitcoin/pull/22437#discussion_r779593489).\r\n\r\n> less controversial\r\n\r\nYeah, should be uncontroversial",
      "created_at" : "2022-01-11T12:32:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24025#issuecomment-1009921200",
      "id" : 1009921200,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24025",
      "node_id" : "IC_kwDOABII5848Miyw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1009921200/reactions"
      },
      "updated_at" : "2022-01-11T12:32:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1009921200",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Closing this now, as there are good arguments against it and it's very unlikely to get merged; #24035 includes a stripped-down variant of this PR that only changes `create_self_transfer` (commit https://github.com/bitcoin/bitcoin/pull/24035/commits/fb26175b27cf5c873d196642b757271b8e670a70).",
      "created_at" : "2022-01-11T15:06:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24025#issuecomment-1010053984",
      "id" : 1010053984,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24025",
      "node_id" : "IC_kwDOABII5848NDNg",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1010053984/reactions"
      },
      "updated_at" : "2022-01-11T15:06:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1010053984",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "As I raised the same issue on https://github.com/bitcoin/bitcoin/pull/25435#issuecomment-1161571980 and without being aware of this PR, I'll reply here, as a more suitable discussion thread.\r\n\r\n> In a personal experience it feels odd to already need to pass a specific node on the MiniWallet instance but then still having to pass from_node again and again for trivial tests\r\n\r\n~~After https://github.com/bitcoin/bitcoin/pull/25435 there will be no usage of `test_node` in the MiniWallet logic, so one approach that will also make clear that \"The MiniWallet acts as a shared wallet between all nodes spun up in the test\" could be to remove the `test_node` argument. Therefore having the shared wallet and `from_node` indicating the node that each tx is send.~~\r\nEDIT: NOT TRUE\r\n\r\n> I think it can be done by explicitly passing a default_send_node to MiniWallet, with the disclaimer that it should only be used where no ambiguity exists. For example, for tests that only have one node? ([src](https://github.com/bitcoin/bitcoin/pull/25435#issuecomment-1161739480))\r\n\r\nThat would make sense. I was thinking that a way to be sure that this is used where no ambiguity exists could be the introduction of a `use_miniwallet` set_test_param that will create an instance of the MiniWallet that will only have a default_send_node when there is only one node. This will also allow for one less import on each test file that is using the MiniWallet. However, this approach has an issue as it does not take into consideration the different modes that the MiniWallet can have.",
      "created_at" : "2022-06-21T15:12:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24025#issuecomment-1161897910",
      "id" : 1161897910,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24025",
      "node_id" : "IC_kwDOABII585FQSe2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1161897910/reactions"
      },
      "updated_at" : "2022-06-21T18:32:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1161897910",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/18506343?v=4",
         "events_url" : "https://api.github.com/users/kouloumos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kouloumos/followers",
         "following_url" : "https://api.github.com/users/kouloumos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kouloumos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kouloumos",
         "id" : 18506343,
         "login" : "kouloumos",
         "node_id" : "MDQ6VXNlcjE4NTA2MzQz",
         "organizations_url" : "https://api.github.com/users/kouloumos/orgs",
         "received_events_url" : "https://api.github.com/users/kouloumos/received_events",
         "repos_url" : "https://api.github.com/users/kouloumos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kouloumos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kouloumos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kouloumos"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> After https://github.com/bitcoin/bitcoin/pull/25435 there will be no usage of test_node in the MiniWallet logic\r\n\r\nI don't think this is true. Those will remain:\r\n\r\n```\r\ntest/functional/test_framework/wallet.py:            self._scriptPubKey = bytes.fromhex(self._test_node.validateaddress(self._address)['scriptPubKey'])\r\ntest/functional/test_framework/wallet.py:        res = self._test_node.scantxoutset(action=\"start\", scanobjects=[self.get_descriptor()])\r\ntest/functional/test_framework/wallet.py:        blocks = self._test_node.generatetodescriptor(num_blocks, self.get_descriptor(), **kwargs)\r\ntest/functional/test_framework/wallet.py:            block_info = self._test_node.getblock(blockhash=b, verbosity=2)\r\n",
      "created_at" : "2022-06-21T15:30:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24025#issuecomment-1161918756",
      "id" : 1161918756,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24025",
      "node_id" : "IC_kwDOABII585FQXkk",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1161918756/reactions"
      },
      "updated_at" : "2022-06-21T15:30:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1161918756",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> I don't think this is true. Those will remain:\r\n\r\nYes, I'm not sure what I was thinkingð",
      "created_at" : "2022-06-21T18:33:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24025#issuecomment-1162166932",
      "id" : 1162166932,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24025",
      "node_id" : "IC_kwDOABII585FRUKU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1162166932/reactions"
      },
      "updated_at" : "2022-06-21T18:33:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1162166932",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/18506343?v=4",
         "events_url" : "https://api.github.com/users/kouloumos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kouloumos/followers",
         "following_url" : "https://api.github.com/users/kouloumos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kouloumos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kouloumos",
         "id" : 18506343,
         "login" : "kouloumos",
         "node_id" : "MDQ6VXNlcjE4NTA2MzQz",
         "organizations_url" : "https://api.github.com/users/kouloumos/orgs",
         "received_events_url" : "https://api.github.com/users/kouloumos/received_events",
         "repos_url" : "https://api.github.com/users/kouloumos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kouloumos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kouloumos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kouloumos"
      }
   }
]
