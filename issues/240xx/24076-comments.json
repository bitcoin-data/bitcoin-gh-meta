[
   {
      "author_association" : "MEMBER",
      "body" : "cc @fjahr: can we add a test for an unclean shutdown to the indexer? ",
      "created_at" : "2022-01-19T09:41:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24076#issuecomment-1016256049",
      "id" : 1016256049,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24076",
      "node_id" : "IC_kwDOABII5848ktYx",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1016256049/reactions"
      },
      "updated_at" : "2022-01-19T09:41:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1016256049",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Not sure if that is the same cause because the unclean shutdown is initiated already during init there, but if I use `-coinstatsindex` instead of `-txindex` in `feature_init.py`, that test fails for me.",
      "created_at" : "2022-01-19T11:51:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24076#issuecomment-1016392954",
      "id" : 1016392954,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24076",
      "node_id" : "IC_kwDOABII5848lOz6",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1016392954/reactions"
      },
      "updated_at" : "2022-01-19T11:51:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1016392954",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Oh, interesting, I am investigating, thanks for tagging me @Sjors ",
      "created_at" : "2022-01-19T20:06:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24076#issuecomment-1016825504",
      "id" : 1016825504,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24076",
      "node_id" : "IC_kwDOABII5848m4ag",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1016825504/reactions"
      },
      "updated_at" : "2022-01-19T20:06:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1016825504",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "just fyi, the `feature_init` fail I mentioned is unrelated to this and not so serious.\r\n(The problem there is that `BaseIndex::CommitInternal` doesn't check if `m_best_block_index == nullptr`, which can happen if init is interrupted very early before indexing anything. In that case, DB_BEST_BLOCK is written with a block locator corresponding to the [tip](https://github.com/bitcoin/bitcoin/blob/06b6369766137756648b3cb62c8f385cca234e69/src/chain.cpp#L31-L32), and on the next start we think the index is fully synced when we actually aren't synced at all. Might still open a small fix for this in the next days.)",
      "created_at" : "2022-01-20T00:17:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24076#issuecomment-1016989638",
      "id" : 1016989638,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24076",
      "node_id" : "IC_kwDOABII5848ngfG",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1016989638/reactions"
      },
      "updated_at" : "2022-01-20T00:17:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1016989638",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I have tried to reproduce this by `kill -9`ing the process but was not successful so far. I think something like this is also the best we could do in an automated test. However I opened #24133 that should address the issue by failing loudly if the restart is indeed the source of the issue.\r\n\r\n@akovalenko Thanks a lot for reporting, you have already given a lot of information but since I couldn't reproduce the issue yet it would be great if you could give me more details. Any of the following would be very helpful:\r\n\r\n- Was only the `muhash` value out of sync or also the other outputs of the index that are also returned with the non index `gettxoutsetinfo muhash null false`?\r\n- If you have any real outputs of the `gettxoutsetinfo` calls after it got out of sync that would be great!\r\n- If you could dissect or observe the next time if the index got indeed out of sync at the restart or at another point that would be even better. If you still have the corrupted index you could use https://github.com/bitcoin/bitcoin/pull/19792 to dump the whole index and upload the result, then I could go search for the offending height as well.\r\n- If you do these planned failures regularly you could also maybe run #24133 with one of them to see if that catches the issue.",
      "created_at" : "2022-01-23T16:49:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24076#issuecomment-1019523468",
      "id" : 1019523468,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24076",
      "node_id" : "IC_kwDOABII5848xLGM",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1019523468/reactions"
      },
      "updated_at" : "2022-01-23T16:49:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1019523468",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I could reproduce this manually on regtest with the standard 200 chain used in the functional tests - adding a sleep to `ThreadSync()` after block 100 so I could conveniently `kill -9` the process. See #24138 for an explanation and a fix.",
      "created_at" : "2022-01-24T14:13:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24076#issuecomment-1020143731",
      "id" : 1020143731,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24076",
      "node_id" : "IC_kwDOABII5848zihz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1020143731/reactions"
      },
      "updated_at" : "2022-01-24T14:13:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1020143731",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   }
]
