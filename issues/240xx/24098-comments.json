[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#24456](https://github.com/bitcoin/bitcoin/pull/24456) (blockman: Properly guard blockfile members by dongcarl)\n* [#23599](https://github.com/bitcoin/bitcoin/pull/23599) (Tidy up RPCTxSerializationFlags by MarcoFalke)\n* [#23507](https://github.com/bitcoin/bitcoin/pull/23507) (Refactor: Improve API design of `ScriptToUniv`, `TxToUniv` etc to return the `UniValue` instead of mutating a parameter/reference by mjdietzx)\n* [#22953](https://github.com/bitcoin/bitcoin/pull/22953) (refactor: introduce single-separator split helper (boost::split replacement) by theStack)\n* [#22564](https://github.com/bitcoin/bitcoin/pull/22564) (refactor: Move mutable globals cleared in `::UnloadBlockIndex` to `BlockManager` by dongcarl)\n* [#21422](https://github.com/bitcoin/bitcoin/pull/21422) (Add feerate histogram to getmempoolinfo by kiminuo)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-01-19T05:48:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#issuecomment-1016106985",
      "id" : 1016106985,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24098",
      "node_id" : "IC_kwDOABII5848kI_p",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1016106985/reactions"
      },
      "updated_at" : "2022-04-05T17:46:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1016106985",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-01-19T08:40:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#issuecomment-1016205759",
      "id" : 1016205759,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24098",
      "node_id" : "IC_kwDOABII5848khG_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1016205759/reactions"
      },
      "updated_at" : "2022-01-19T08:40:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1016205759",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Force pushed to rebase after #24054 was merged; no other changes.",
      "created_at" : "2022-01-19T10:29:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#issuecomment-1016296840",
      "id" : 1016296840,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24098",
      "node_id" : "IC_kwDOABII5848k3WI",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1016296840/reactions"
      },
      "updated_at" : "2022-01-19T10:29:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1016296840",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Is there a large cost to maintaining both ways? If not, it might be better to keep both to not upset users for a weak motivation.",
      "created_at" : "2022-01-19T11:30:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#issuecomment-1016369472",
      "id" : 1016369472,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24098",
      "node_id" : "IC_kwDOABII5848lJFA",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1016369472/reactions"
      },
      "updated_at" : "2022-01-19T11:30:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1016369472",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r787655265"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/787655265"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "if I try to pass a blockhash without the extension (.<bin|hex|json>) in `/headers`, like:\r\n`/rest/headers/000000001aeae195809d120b5d66a39c83eb48792e068f8ea1fea19d84a4278a?count=5`\r\nreturns: `Invalid hash: 000000001aeae195809d120b5d66a39c83eb48792e068f8ea1fea19d84a4278a?count=5`\r\n\r\nIn the deprecated, `/rest/headers/5/000000001aeae195809d120b5d66a39c83eb48792e068f8ea1fea19d84a4278a`\r\nreturns: `output format not found (available: .bin, .hex, .json)`\r\n\r\n\r\n",
      "commit_id" : "f861b6df054f5ebfe7a86d4b453ff95dabf3e178",
      "created_at" : "2022-01-19T11:31:21Z",
      "diff_hunk" : "@@ -195,15 +193,27 @@ static bool rest_headers(const std::any& context,\n     std::vector<std::string> path;\n     boost::split(path, param, boost::is_any_of(\"/\"));\n \n-    if (path.size() != 2)\n-        return RESTERR(req, HTTP_BAD_REQUEST, \"No header count specified. Use /rest/headers/<count>/<hash>.<ext>.\");\n+    std::string raw_count {};\n+    std::string hashStr {};\n+    if (path.size() == 2) {\n+        // deprecated path: /rest/headers/<count>/<hash>\n+        hashStr = path[1];\n+        raw_count = path[0];\n+    }\n+    else if (path.size() == 1) {\n+        // new path with query parameter: /rest/headers/<hash>?count=<count>\n+        hashStr = path[0];\n+        raw_count = req->GetQueryParameter(\"count\", \"5\");;\n+    }\n+    else {\n+        return RESTERR(req, HTTP_BAD_REQUEST, \"Invalid request. Use /rest/headers/<hash>.<ext>?count=<count>\");\n+    }\n \n-    const auto parsed_count{ToIntegral<size_t>(path[0])};\n+    auto parsed_count = ToIntegral<size_t>(raw_count);\n     if (!parsed_count.has_value() || *parsed_count < 1 || *parsed_count > MAX_REST_HEADERS_RESULTS) {\n-        return RESTERR(req, HTTP_BAD_REQUEST, strprintf(\"Header count is invalid or out of acceptable range (1-%u): %s\", MAX_REST_HEADERS_RESULTS, path[0]));\n+        return RESTERR(req, HTTP_BAD_REQUEST, strprintf(\"Header count is invalid or out of acceptable range (1-%u): %s\", MAX_REST_HEADERS_RESULTS, raw_count));\n     }\n \n-    std::string hashStr = path[1];\n     uint256 hash;\n     if (!ParseHashStr(hashStr, hash))\n         return RESTERR(req, HTTP_BAD_REQUEST, \"Invalid hash: \" + hashStr);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r787655265",
      "id" : 787655265,
      "line" : 219,
      "node_id" : "PRRC_kwDOABII584u8qph",
      "original_commit_id" : "f861b6df054f5ebfe7a86d4b453ff95dabf3e178",
      "original_line" : 219,
      "original_position" : 88,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : 88,
      "pull_request_review_id" : 856666265,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/787655265/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-19T11:31:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/787655265",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r787750681"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/787750681"
         }
      },
      "author_association" : "NONE",
      "body" : "You're right, that should be handled better. I've:\r\n- updated `ParseDataFormat` to ignore the query string even when no data format is found\r\n- updated documentation on `ParseDataFormat` in `rest.h` to document existing and new behaviour\r\n- added a test case to `test_query_string` to capture what you've found\r\n\r\nRebased and pushed to 0415aaa",
      "commit_id" : "0415aaafb2f7206c117f58cc7a4a967cee0fa619",
      "created_at" : "2022-01-19T13:36:46Z",
      "diff_hunk" : "@@ -195,15 +193,27 @@ static bool rest_headers(const std::any& context,\n     std::vector<std::string> path;\n     boost::split(path, param, boost::is_any_of(\"/\"));\n \n-    if (path.size() != 2)\n-        return RESTERR(req, HTTP_BAD_REQUEST, \"No header count specified. Use /rest/headers/<count>/<hash>.<ext>.\");\n+    std::string raw_count {};\n+    std::string hashStr {};\n+    if (path.size() == 2) {\n+        // deprecated path: /rest/headers/<count>/<hash>\n+        hashStr = path[1];\n+        raw_count = path[0];\n+    }\n+    else if (path.size() == 1) {\n+        // new path with query parameter: /rest/headers/<hash>?count=<count>\n+        hashStr = path[0];\n+        raw_count = req->GetQueryParameter(\"count\", \"5\");;\n+    }\n+    else {\n+        return RESTERR(req, HTTP_BAD_REQUEST, \"Invalid request. Use /rest/headers/<hash>.<ext>?count=<count>\");\n+    }\n \n-    const auto parsed_count{ToIntegral<size_t>(path[0])};\n+    auto parsed_count = ToIntegral<size_t>(raw_count);\n     if (!parsed_count.has_value() || *parsed_count < 1 || *parsed_count > MAX_REST_HEADERS_RESULTS) {\n-        return RESTERR(req, HTTP_BAD_REQUEST, strprintf(\"Header count is invalid or out of acceptable range (1-%u): %s\", MAX_REST_HEADERS_RESULTS, path[0]));\n+        return RESTERR(req, HTTP_BAD_REQUEST, strprintf(\"Header count is invalid or out of acceptable range (1-%u): %s\", MAX_REST_HEADERS_RESULTS, raw_count));\n     }\n \n-    std::string hashStr = path[1];\n     uint256 hash;\n     if (!ParseHashStr(hashStr, hash))\n         return RESTERR(req, HTTP_BAD_REQUEST, \"Invalid hash: \" + hashStr);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r787750681",
      "id" : 787750681,
      "in_reply_to_id" : 787655265,
      "line" : 221,
      "node_id" : "PRRC_kwDOABII584u9B8Z",
      "original_commit_id" : "f861b6df054f5ebfe7a86d4b453ff95dabf3e178",
      "original_line" : 221,
      "original_position" : 88,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : 102,
      "pull_request_review_id" : 856801988,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/787750681/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-19T13:37:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/787750681",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> Is there a large cost to maintaining both ways? If not, it might be better to keep both to not upset users for a weak motivation.\r\n\r\nThe PR is already setup to maintain both ways, so anyone using the (to be) deprecated endpoints should not be affected. This is documented in REST-interface.md too, so users are aware it is still supported but that they should probably use the new endpoint for new applications. The maintenance overhead is minimal, basically in [`rest_headers`](https://github.com/bitcoin/bitcoin/pull/24098/files#diff-590507deaf686d6571f73979df5f3c6da6013a13e597f390b8facce39f7c69d1R200-R204) and [`rest_filter_header`](https://github.com/bitcoin/bitcoin/pull/24098/files#diff-590507deaf686d6571f73979df5f3c6da6013a13e597f390b8facce39f7c69d1R372-R376) we have an if/else branch that adds 3 LoC to maintain the old endpoints too. Some additional refactoring could be done to simplify without the two branches, but it's no big deal.\r\n\r\nPersonally, I would definitely not remove the old endpoints in the next release, and probably not until some bigger API refactoring would make this desirable, in which case we should notify users more explicitly. I did not add any deprecation logging to avoid behaviour change, and because I think we don't have to push users away from the old endpoints yet.",
      "created_at" : "2022-01-19T13:47:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#issuecomment-1016482318",
      "id" : 1016482318,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24098",
      "node_id" : "IC_kwDOABII5848lkoO",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1016482318/reactions"
      },
      "updated_at" : "2022-01-19T13:47:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1016482318",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> I didn't understand `Deprecated (but not removed) since 23.0:`, will both ways be kept?\r\n\r\nThank you for the review! Correct, I argue both should be kept at least for now, and that's how it's currently implemented. I'm open to suggestions for better phrasing, but typically deprecated means a feature is no longer developed and may be removed in the future, but is still available. See e.g. [Microsoft's definition](https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/migration-upgrade/deprecated-features). Does that clear things up?",
      "created_at" : "2022-01-19T13:53:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#issuecomment-1016486748",
      "id" : 1016486748,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24098",
      "node_id" : "IC_kwDOABII5848lltc",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1016486748/reactions"
      },
      "updated_at" : "2022-01-19T13:53:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1016486748",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@stickies-v instead of deprecating the old behavior the new can be just called backwards-compatible. By the way, an example of an externalized backward-compatible REST-service (in a way similar to what you have here) using Caddy webserver can be seen at https://github.com/jsarenik/bitcoin-faucet-shell/blob/master/Caddyfile.txt",
      "created_at" : "2022-01-19T16:46:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#issuecomment-1016657935",
      "id" : 1016657935,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24098",
      "node_id" : "IC_kwDOABII5848mPgP",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1016657935/reactions"
      },
      "updated_at" : "2022-01-19T16:46:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1016657935",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/244565?v=4",
         "events_url" : "https://api.github.com/users/jsarenik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jsarenik/followers",
         "following_url" : "https://api.github.com/users/jsarenik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jsarenik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jsarenik",
         "id" : 244565,
         "login" : "jsarenik",
         "node_id" : "MDQ6VXNlcjI0NDU2NQ==",
         "organizations_url" : "https://api.github.com/users/jsarenik/orgs",
         "received_events_url" : "https://api.github.com/users/jsarenik/received_events",
         "repos_url" : "https://api.github.com/users/jsarenik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jsarenik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jsarenik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jsarenik"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> @stickies-v instead of deprecating the old behavior the new can be just called backwards-compatible.\r\n\r\nWe can, but I'm not convinced we should? I think deprecating the old endpoints has a clear benefit of keeping the documented interface simpler and better adhering to common REST API practices. Simultaneously, since they're not removed, existing users are not affected, just gently nudged towards the new interface if and when it suits them. \r\nThank you for your review!",
      "created_at" : "2022-01-20T10:30:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#issuecomment-1017331461",
      "id" : 1017331461,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24098",
      "node_id" : "IC_kwDOABII5848oz8F",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1017331461/reactions"
      },
      "updated_at" : "2022-01-20T10:30:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1017331461",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r790169294"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/790169294"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Tested! Works! ",
      "commit_id" : "0415aaafb2f7206c117f58cc7a4a967cee0fa619",
      "created_at" : "2022-01-22T18:10:58Z",
      "diff_hunk" : "@@ -195,15 +193,27 @@ static bool rest_headers(const std::any& context,\n     std::vector<std::string> path;\n     boost::split(path, param, boost::is_any_of(\"/\"));\n \n-    if (path.size() != 2)\n-        return RESTERR(req, HTTP_BAD_REQUEST, \"No header count specified. Use /rest/headers/<count>/<hash>.<ext>.\");\n+    std::string raw_count {};\n+    std::string hashStr {};\n+    if (path.size() == 2) {\n+        // deprecated path: /rest/headers/<count>/<hash>\n+        hashStr = path[1];\n+        raw_count = path[0];\n+    }\n+    else if (path.size() == 1) {\n+        // new path with query parameter: /rest/headers/<hash>?count=<count>\n+        hashStr = path[0];\n+        raw_count = req->GetQueryParameter(\"count\", \"5\");;\n+    }\n+    else {\n+        return RESTERR(req, HTTP_BAD_REQUEST, \"Invalid request. Use /rest/headers/<hash>.<ext>?count=<count>\");\n+    }\n \n-    const auto parsed_count{ToIntegral<size_t>(path[0])};\n+    auto parsed_count = ToIntegral<size_t>(raw_count);\n     if (!parsed_count.has_value() || *parsed_count < 1 || *parsed_count > MAX_REST_HEADERS_RESULTS) {\n-        return RESTERR(req, HTTP_BAD_REQUEST, strprintf(\"Header count is invalid or out of acceptable range (1-%u): %s\", MAX_REST_HEADERS_RESULTS, path[0]));\n+        return RESTERR(req, HTTP_BAD_REQUEST, strprintf(\"Header count is invalid or out of acceptable range (1-%u): %s\", MAX_REST_HEADERS_RESULTS, raw_count));\n     }\n \n-    std::string hashStr = path[1];\n     uint256 hash;\n     if (!ParseHashStr(hashStr, hash))\n         return RESTERR(req, HTTP_BAD_REQUEST, \"Invalid hash: \" + hashStr);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r790169294",
      "id" : 790169294,
      "in_reply_to_id" : 787655265,
      "line" : 221,
      "node_id" : "PRRC_kwDOABII584vGQbO",
      "original_commit_id" : "f861b6df054f5ebfe7a86d4b453ff95dabf3e178",
      "original_line" : 221,
      "original_position" : 88,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : 102,
      "pull_request_review_id" : 860229304,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/790169294/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-22T18:10:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/790169294",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r790336549"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/790336549"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why only `count` as a query parameter? How about\r\n```\r\nGET /rest/headers?block_hash=&count=&format=\r\n\r\nblock_hash defaults to tip\r\ncount defaults to 5\r\nformat defaults to request accept header, JSON if not specified\r\n```",
      "commit_id" : "0415aaafb2f7206c117f58cc7a4a967cee0fa619",
      "created_at" : "2022-01-23T22:00:12Z",
      "diff_hunk" : "@@ -47,18 +47,24 @@ The HTTP request and response are both handled entirely in-memory.\n With the /notxdetails/ option JSON response will only contain the transaction hash instead of the complete transaction details. The option only affects the JSON response.\n \n #### Blockheaders\n-`GET /rest/headers/<COUNT>/<BLOCK-HASH>.<bin|hex|json>`\n+`GET /rest/headers/<BLOCK-HASH>.<bin|hex|json>?count=<COUNT=5>`",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r790336549",
      "id" : 790336549,
      "line" : 50,
      "node_id" : "PRRC_kwDOABII584vG5Ql",
      "original_commit_id" : "0415aaafb2f7206c117f58cc7a4a967cee0fa619",
      "original_line" : 50,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "doc/REST-interface.md",
      "position" : 5,
      "pull_request_review_id" : 860377099,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/790336549/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-23T22:29:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/790336549",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r790336836"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/790336836"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe use std::optional because an empty string could be the default?",
      "commit_id" : "0415aaafb2f7206c117f58cc7a4a967cee0fa619",
      "created_at" : "2022-01-23T22:03:00Z",
      "diff_hunk" : "@@ -639,6 +640,42 @@ HTTPRequest::RequestMethod HTTPRequest::GetRequestMethod() const\n     }\n }\n \n+std::string HTTPRequest::GetQueryParameter(const std::string& key, const std::string& default_val) const\n+{\n+    std::string uri = evhttp_request_get_uri(req);\n+    auto result = GetQueryParameterFromUri(uri, key, default_val);\n+\n+    return result;\n+}\n+\n+std::string GetQueryParameterFromUri(const std::string& uri, const std::string& key, const std::string& default_val)\n+{\n+    auto query_start = uri.rfind('?');\n+    if (query_start != std::string::npos) {\n+        // Capture everything after the '?' sign, i.e. the query string\n+        auto query_string = uri.substr(query_start + 1, uri.size() - (query_start + 1));\n+\n+        // Parse the query string into a key-value queue and iterate over it\n+        struct evkeyvalq params_q;\n+        evhttp_parse_query_str(query_string.c_str(), &params_q);\n+\n+        struct evkeyval* param;\n+        for (param = params_q.tqh_first; param; param = param->next.tqe_next) {\n+            if (param->key == key) {\n+                std::string result = param->value;\n+                evhttp_clear_headers(&params_q);\n+                return result;\n+            }\n+        }\n+        evhttp_clear_headers(&params_q);\n+    }\n+\n+    if (default_val != \"\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r790336836",
      "id" : 790336836,
      "line" : 673,
      "node_id" : "PRRC_kwDOABII584vG5VE",
      "original_commit_id" : "0415aaafb2f7206c117f58cc7a4a967cee0fa619",
      "original_line" : 673,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/httpserver.cpp",
      "position" : 42,
      "pull_request_review_id" : 860377099,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/790336836/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-23T22:29:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/790336836",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r790338713"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/790338713"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should use `evhttp_uri_parse`.",
      "commit_id" : "0415aaafb2f7206c117f58cc7a4a967cee0fa619",
      "created_at" : "2022-01-23T22:21:27Z",
      "diff_hunk" : "@@ -639,6 +640,42 @@ HTTPRequest::RequestMethod HTTPRequest::GetRequestMethod() const\n     }\n }\n \n+std::string HTTPRequest::GetQueryParameter(const std::string& key, const std::string& default_val) const\n+{\n+    std::string uri = evhttp_request_get_uri(req);\n+    auto result = GetQueryParameterFromUri(uri, key, default_val);\n+\n+    return result;\n+}\n+\n+std::string GetQueryParameterFromUri(const std::string& uri, const std::string& key, const std::string& default_val)\n+{\n+    auto query_start = uri.rfind('?');",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r790338713",
      "id" : 790338713,
      "line" : 653,
      "node_id" : "PRRC_kwDOABII584vG5yZ",
      "original_commit_id" : "0415aaafb2f7206c117f58cc7a4a967cee0fa619",
      "original_line" : 653,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/httpserver.cpp",
      "position" : 22,
      "pull_request_review_id" : 860377099,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/790338713/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-23T22:29:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/790338713",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r790766518"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/790766518"
         }
      },
      "author_association" : "NONE",
      "body" : "Agreed and done, for both `GetQueryParameterFromUri` and `HTTPRequest:GetQueryParameter`.",
      "commit_id" : "0415aaafb2f7206c117f58cc7a4a967cee0fa619",
      "created_at" : "2022-01-24T13:56:27Z",
      "diff_hunk" : "@@ -639,6 +640,42 @@ HTTPRequest::RequestMethod HTTPRequest::GetRequestMethod() const\n     }\n }\n \n+std::string HTTPRequest::GetQueryParameter(const std::string& key, const std::string& default_val) const\n+{\n+    std::string uri = evhttp_request_get_uri(req);\n+    auto result = GetQueryParameterFromUri(uri, key, default_val);\n+\n+    return result;\n+}\n+\n+std::string GetQueryParameterFromUri(const std::string& uri, const std::string& key, const std::string& default_val)\n+{\n+    auto query_start = uri.rfind('?');\n+    if (query_start != std::string::npos) {\n+        // Capture everything after the '?' sign, i.e. the query string\n+        auto query_string = uri.substr(query_start + 1, uri.size() - (query_start + 1));\n+\n+        // Parse the query string into a key-value queue and iterate over it\n+        struct evkeyvalq params_q;\n+        evhttp_parse_query_str(query_string.c_str(), &params_q);\n+\n+        struct evkeyval* param;\n+        for (param = params_q.tqh_first; param; param = param->next.tqe_next) {\n+            if (param->key == key) {\n+                std::string result = param->value;\n+                evhttp_clear_headers(&params_q);\n+                return result;\n+            }\n+        }\n+        evhttp_clear_headers(&params_q);\n+    }\n+\n+    if (default_val != \"\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r790766518",
      "id" : 790766518,
      "in_reply_to_id" : 790336836,
      "line" : 673,
      "node_id" : "PRRC_kwDOABII584vIiO2",
      "original_commit_id" : "0415aaafb2f7206c117f58cc7a4a967cee0fa619",
      "original_line" : 673,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/httpserver.cpp",
      "position" : 42,
      "pull_request_review_id" : 860991881,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/790766518/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-24T13:56:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/790766518",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r790768636"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/790768636"
         }
      },
      "author_association" : "NONE",
      "body" : "I agree and considered that, but decided to omit this for now to keep this PR's scope limited. Would you be okay with this being incorporated in a follow up PR (which I'm happy to take on right away?)\r\n\r\nEdit: after reading jnewbery's [comment](https://github.com/bitcoin/bitcoin/pull/24098#pullrequestreview-863331148), I realized I didn't see you also converted `block_hash` into a query parameter, which I don't agree with as per his arguments. I still agree with your suggestion for `format`.\r\n\r\nEdit 2: after reading your [latest comment](https://github.com/bitcoin/bitcoin/pull/24098#issuecomment-1027755825), I realize I did not fully think this through. I have some further thoughts but will hold off on sharing these until after the [PR review club](https://bitcoincore.reviews/24098) to encourage open discussion.",
      "commit_id" : "6628e8f3b0578ec09611c82011dd2e282ed42064",
      "created_at" : "2022-01-24T13:58:54Z",
      "diff_hunk" : "@@ -47,18 +47,24 @@ The HTTP request and response are both handled entirely in-memory.\n With the /notxdetails/ option JSON response will only contain the transaction hash instead of the complete transaction details. The option only affects the JSON response.\n \n #### Blockheaders\n-`GET /rest/headers/<COUNT>/<BLOCK-HASH>.<bin|hex|json>`\n+`GET /rest/headers/<BLOCK-HASH>.<bin|hex|json>?count=<COUNT=5>`",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r790768636",
      "id" : 790768636,
      "in_reply_to_id" : 790336549,
      "line" : 50,
      "node_id" : "PRRC_kwDOABII584vIiv8",
      "original_commit_id" : "0415aaafb2f7206c117f58cc7a4a967cee0fa619",
      "original_line" : 50,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "doc/REST-interface.md",
      "position" : 5,
      "pull_request_review_id" : 860995025,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/790768636/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-17T05:51:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/790768636",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r790920772"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/790920772"
         }
      },
      "author_association" : "NONE",
      "body" : "Agreed and done.",
      "commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "created_at" : "2022-01-24T16:26:54Z",
      "diff_hunk" : "@@ -639,6 +640,42 @@ HTTPRequest::RequestMethod HTTPRequest::GetRequestMethod() const\n     }\n }\n \n+std::string HTTPRequest::GetQueryParameter(const std::string& key, const std::string& default_val) const\n+{\n+    std::string uri = evhttp_request_get_uri(req);\n+    auto result = GetQueryParameterFromUri(uri, key, default_val);\n+\n+    return result;\n+}\n+\n+std::string GetQueryParameterFromUri(const std::string& uri, const std::string& key, const std::string& default_val)\n+{\n+    auto query_start = uri.rfind('?');",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r790920772",
      "id" : 790920772,
      "in_reply_to_id" : 790338713,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584vJH5E",
      "original_commit_id" : "0415aaafb2f7206c117f58cc7a4a967cee0fa619",
      "original_line" : 653,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/httpserver.cpp",
      "position" : null,
      "pull_request_review_id" : 861215930,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/790920772/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-24T16:26:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/790920772",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Rebased and:\r\n- fixed wrong indentation of [GetQueryParameter](https://github.com/bitcoin/bitcoin/compare/0415aaafb2f7206c117f58cc7a4a967cee0fa619..e1822e79b3d5230f976360e5500d7ef59dd8783c#diff-aa9c90add56b31a60e0d574fa9025945be2b01306c265d00e3aa0a27c6b4bc3fL132-R146) documentation\r\n- incorporated promag's comments on [std::optional](https://github.com/bitcoin/bitcoin/pull/24098#discussion_r790336836) and [evhttp_uri_parse](https://github.com/bitcoin/bitcoin/pull/24098#discussion_r790338713)\r\n\r\nThank you @promag for your review. To address your comment:\r\n> I don't see a strong reason for this change TBH\r\n\r\nI agree this is not a critical issue. However, I think everyone can agree my proposal is the more standard way of organizing API endpoints. If that's true (and so far no one argued the opposite), it's better to refactor this earlier rather than later, because for example in [#17631](https://github.com/bitcoin/bitcoin/pull/17631#discussion_r733031180) we (I think rightfully) preferred internal consistency over adhering to best practices. We now also have the functionality in place for other existing or new endpoints to easily accept query parameters, including your [proposal](https://github.com/bitcoin/bitcoin/pull/24098#discussion_r790336549) for the data format.\r\n\r\n_Note: I've just learned I should only rebase in case of merge conflicts. My apologies for the added review difficulty, won't happen going forward._",
      "created_at" : "2022-01-24T16:27:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#issuecomment-1020285387",
      "id" : 1020285387,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24098",
      "node_id" : "IC_kwDOABII58480FHL",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1020285387/reactions"
      },
      "updated_at" : "2022-01-24T16:27:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1020285387",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r792480603"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792480603"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: most of the .cpp translation units include their own header file first, before all other includes, i.e.:\r\n\r\n```c++\r\n#include <rest.h>\r\n\r\n#include <blockfilter.h>\r\n#include <chain.h>\r\n#include <chainparams.h>\r\n...\r\n```",
      "commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "created_at" : "2022-01-26T10:05:38Z",
      "diff_hunk" : "@@ -14,6 +14,7 @@\n #include <node/context.h>\n #include <primitives/block.h>\n #include <primitives/transaction.h>\n+#include <rest.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r792480603",
      "id" : 792480603,
      "line" : 17,
      "node_id" : "PRRC_kwDOABII584vPEtb",
      "original_commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "original_line" : 17,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : 4,
      "pull_request_review_id" : 863331148,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792480603/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-26T12:18:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792480603",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r792505218"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792505218"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Now that this enum is exposed in the header, consider using a slightly more descriptive name such as `RESTRequestFormat` or similar.",
      "commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "created_at" : "2022-01-26T10:35:55Z",
      "diff_hunk" : "@@ -0,0 +1,28 @@\n+// Copyright (c) 2015-2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_REST_H\n+#define BITCOIN_REST_H\n+\n+#include <string>\n+\n+enum class RetFormat {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r792505218",
      "id" : 792505218,
      "line" : 10,
      "node_id" : "PRRC_kwDOABII584vPKuC",
      "original_commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "original_line" : 10,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/rest.h",
      "position" : 10,
      "pull_request_review_id" : 863331148,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792505218/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-26T12:18:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792505218",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r792506087"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792506087"
         }
      },
      "author_association" : "MEMBER",
      "body" : "While touching this line:\r\n\r\n```suggestion\r\n    if (pos_format == std::string::npos) {\r\n```",
      "commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "created_at" : "2022-01-26T10:37:03Z",
      "diff_hunk" : "@@ -137,25 +132,30 @@ static ChainstateManager* GetChainman(const std::any& context, HTTPRequest* req)\n     return node_context->chainman.get();\n }\n \n-static RetFormat ParseDataFormat(std::string& param, const std::string& strReq)\n+RetFormat ParseDataFormat(std::string& param, const std::string& strReq)\n {\n-    const std::string::size_type pos = strReq.rfind('.');\n-    if (pos == std::string::npos)\n+    // Remove query string (if any, separated with '?') as it should not interfere with\n+    // parsing param and data format\n+    const std::string::size_type pos_querystr = strReq.rfind('?');\n+    const std::string::size_type pos_format = strReq.rfind('.');\n+    param = strReq.substr(0, std::min(pos_format, pos_querystr));\n+\n+    // No format string is found\n+    if (pos_format == std::string::npos)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r792506087",
      "id" : 792506087,
      "line" : 144,
      "node_id" : "PRRC_kwDOABII584vPK7n",
      "original_commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "original_line" : 144,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : 46,
      "pull_request_review_id" : 863331148,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792506087/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-26T12:18:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792506087",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r792560203"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792560203"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Perhaps also test a URI that contains a `?` before `.`, eg `\"/rest/endpoint/someresource?p1=v1.json\")`",
      "commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "created_at" : "2022-01-26T11:51:30Z",
      "diff_hunk" : "@@ -0,0 +1,43 @@\n+// Copyright (c) 2012-2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <rest.h>\n+#include <test/util/setup_common.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+#include <string>\n+\n+BOOST_FIXTURE_TEST_SUITE(rest_tests, BasicTestingSetup)\n+\n+BOOST_AUTO_TEST_CASE(test_query_string)\n+{\n+    std::string param;\n+    RetFormat rf;\n+    // No query string\n+    rf = ParseDataFormat(param, \"/rest/endpoint/someresource.json\");\n+    BOOST_CHECK_EQUAL(param, \"/rest/endpoint/someresource\");\n+    BOOST_CHECK_EQUAL(rf, RetFormat::JSON);\n+\n+    // Query string with single parameter\n+    rf = ParseDataFormat(param, \"/rest/endpoint/someresource.json?p1=v1\");\n+    BOOST_CHECK_EQUAL(param, \"/rest/endpoint/someresource\");\n+    BOOST_CHECK_EQUAL(rf, RetFormat::JSON);\n+\n+    // Query string with multiple parameters\n+    rf = ParseDataFormat(param, \"/rest/endpoint/someresource.json?p1=v1&p2=v2\");\n+    BOOST_CHECK_EQUAL(param, \"/rest/endpoint/someresource\");\n+    BOOST_CHECK_EQUAL(rf, RetFormat::JSON);\n+\n+    // Incorrectly formed query string will not be handled",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r792560203",
      "id" : 792560203,
      "line" : 33,
      "node_id" : "PRRC_kwDOABII584vPYJL",
      "original_commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "original_line" : 33,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/test/rest_tests.cpp",
      "position" : 33,
      "pull_request_review_id" : 863331148,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792560203/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-26T12:18:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792560203",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r792564751"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792564751"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    } else if (uri_parts.size() == 2) {\r\n```",
      "commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "created_at" : "2022-01-26T11:58:10Z",
      "diff_hunk" : "@@ -355,13 +367,30 @@ static bool rest_filter_header(const std::any& context, HTTPRequest* req, const\n \n     std::vector<std::string> uri_parts;\n     boost::split(uri_parts, param, boost::is_any_of(\"/\"));\n-    if (uri_parts.size() != 3) {\n-        return RESTERR(req, HTTP_BAD_REQUEST, \"Invalid URI format. Expected /rest/blockfilterheaders/<filtertype>/<count>/<blockhash>\");\n+    std::string raw_count {};\n+    size_t blockhash_index {};\n+    if (uri_parts.size() == 3) {\n+        // deprecated path: /rest/blockfilterheaders/<filtertype>/<count>/<blockhash>\n+        blockhash_index = 2;\n+        raw_count = uri_parts[1];\n+    }\n+    else if (uri_parts.size() == 2) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r792564751",
      "id" : 792564751,
      "line" : 377,
      "node_id" : "PRRC_kwDOABII584vPZQP",
      "original_commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "original_line" : 377,
      "original_position" : 116,
      "original_start_line" : 376,
      "path" : "src/rest.cpp",
      "position" : 116,
      "pull_request_review_id" : 863331148,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792564751/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 376,
      "start_side" : "RIGHT",
      "updated_at" : "2022-01-26T12:18:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792564751",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r792564863"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792564863"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    } else {\r\n```",
      "commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "created_at" : "2022-01-26T11:58:19Z",
      "diff_hunk" : "@@ -355,13 +367,30 @@ static bool rest_filter_header(const std::any& context, HTTPRequest* req, const\n \n     std::vector<std::string> uri_parts;\n     boost::split(uri_parts, param, boost::is_any_of(\"/\"));\n-    if (uri_parts.size() != 3) {\n-        return RESTERR(req, HTTP_BAD_REQUEST, \"Invalid URI format. Expected /rest/blockfilterheaders/<filtertype>/<count>/<blockhash>\");\n+    std::string raw_count {};\n+    size_t blockhash_index {};\n+    if (uri_parts.size() == 3) {\n+        // deprecated path: /rest/blockfilterheaders/<filtertype>/<count>/<blockhash>\n+        blockhash_index = 2;\n+        raw_count = uri_parts[1];\n+    }\n+    else if (uri_parts.size() == 2) {\n+        // new path with query parameter: /rest/blockfilterheaders/<filtertype>/<blockhash>?count=<count>\n+        blockhash_index = 1;\n+        raw_count = req->GetQueryParameter(\"count\", \"5\");\n+    }\n+    else {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r792564863",
      "id" : 792564863,
      "line" : 382,
      "node_id" : "PRRC_kwDOABII584vPZR_",
      "original_commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "original_line" : 382,
      "original_position" : 121,
      "original_start_line" : 381,
      "path" : "src/rest.cpp",
      "position" : 121,
      "pull_request_review_id" : 863331148,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792564863/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 381,
      "start_side" : "RIGHT",
      "updated_at" : "2022-01-26T12:18:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792564863",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r792571528"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792571528"
         }
      },
      "author_association" : "MEMBER",
      "body" : "We don't usually use exceptions to return error conditions in the Bitcoin Core codebase. If you do this, wherever there's a key that doesn't have a default, the calling code will have to wrap this call in a try/except, and then catch the runtime_error and return it as a RESTERR.\r\n\r\nDid you consider returning a `std::optional<std::string>`, and then using [std::optional<t>::value_or()](https://en.cppreference.com/w/cpp/utility/optional/value_or) to add the default, and [std::optional<t>::has_value()](https://en.cppreference.com/w/cpp/utility/optional/operator_bool) to catch if a non-default option hasn't been set?",
      "commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "created_at" : "2022-01-26T12:06:41Z",
      "diff_hunk" : "@@ -83,6 +84,19 @@ class HTTPRequest\n      */\n     RequestMethod GetRequestMethod() const;\n \n+    /** Get the query parameter value from request uri for a specified key.\n+     * Throws std::runtime_error if key does not exist and no default_val is specified.\n+     *\n+     * If the query string contains duplicate keys, the first value is returned. Many web frameworks\n+     * would instead parse this as an array of values, but this is not (yet) implemented as it is\n+     * currently not needed in any of the endpoints.\n+     *\n+     * @param[in] key represents the query parameter of which the value is returned\n+     * @param[in] default_val (optional) is returned if key is not in query string\n+     * @throws std::runtime_error if key is not in query string and no default_val was provided",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r792571528",
      "id" : 792571528,
      "line" : 96,
      "node_id" : "PRRC_kwDOABII584vPa6I",
      "original_commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "original_line" : 96,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/httpserver.h",
      "position" : 24,
      "pull_request_review_id" : 863331148,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792571528/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-26T12:18:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792571528",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r792574341"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792574341"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Any reason to lose the `const` here?",
      "commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "created_at" : "2022-01-26T12:10:01Z",
      "diff_hunk" : "@@ -355,13 +367,30 @@ static bool rest_filter_header(const std::any& context, HTTPRequest* req, const\n \n     std::vector<std::string> uri_parts;\n     boost::split(uri_parts, param, boost::is_any_of(\"/\"));\n-    if (uri_parts.size() != 3) {\n-        return RESTERR(req, HTTP_BAD_REQUEST, \"Invalid URI format. Expected /rest/blockfilterheaders/<filtertype>/<count>/<blockhash>\");\n+    std::string raw_count {};\n+    size_t blockhash_index {};\n+    if (uri_parts.size() == 3) {\n+        // deprecated path: /rest/blockfilterheaders/<filtertype>/<count>/<blockhash>\n+        blockhash_index = 2;\n+        raw_count = uri_parts[1];\n+    }\n+    else if (uri_parts.size() == 2) {\n+        // new path with query parameter: /rest/blockfilterheaders/<filtertype>/<blockhash>?count=<count>\n+        blockhash_index = 1;\n+        raw_count = req->GetQueryParameter(\"count\", \"5\");\n+    }\n+    else {\n+        return RESTERR(req, HTTP_BAD_REQUEST, \"Invalid URI format. Expected /rest/blockfilterheaders/<filtertype>/<blockhash>.<ext>?count=<count>\");\n+    }\n+\n+    auto parsed_count = ToIntegral<size_t>(raw_count);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r792574341",
      "id" : 792574341,
      "line" : 386,
      "node_id" : "PRRC_kwDOABII584vPbmF",
      "original_commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "original_line" : 386,
      "original_position" : 125,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : 125,
      "pull_request_review_id" : 863331148,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792574341/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-26T12:18:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792574341",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r792575674"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792575674"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Did you consider making `query_string` an optional argument to `test_rest_request()`? It seems a bit contrived to pass the URI without the `req_type` as part of the string, but with the query_string.",
      "commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "created_at" : "2022-01-26T12:11:56Z",
      "diff_hunk" : "@@ -53,12 +53,13 @@ def skip_test_if_missing_module(self):\n \n     def test_rest_request(self, uri, http_method='GET', req_type=ReqType.JSON, body='', status=200, ret_type=RetType.JSON):\n         rest_uri = '/rest' + uri\n-        if req_type == ReqType.JSON:\n-            rest_uri += '.json'\n-        elif req_type == ReqType.BIN:\n-            rest_uri += '.bin'\n-        elif req_type == ReqType.HEX:\n-            rest_uri += '.hex'\n+        query_string = ''",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r792575674",
      "id" : 792575674,
      "line" : 56,
      "node_id" : "PRRC_kwDOABII584vPb66",
      "original_commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "original_line" : 56,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "test/functional/interface_rest.py",
      "position" : 10,
      "pull_request_review_id" : 863331148,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792575674/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-26T12:18:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792575674",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r792640696"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792640696"
         }
      },
      "author_association" : "NONE",
      "body" : "Done",
      "commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "created_at" : "2022-01-26T13:34:37Z",
      "diff_hunk" : "@@ -14,6 +14,7 @@\n #include <node/context.h>\n #include <primitives/block.h>\n #include <primitives/transaction.h>\n+#include <rest.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r792640696",
      "id" : 792640696,
      "in_reply_to_id" : 792480603,
      "line" : 17,
      "node_id" : "PRRC_kwDOABII584vPry4",
      "original_commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "original_line" : 17,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : 4,
      "pull_request_review_id" : 863546474,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792640696/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-26T13:34:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792640696",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r792641514"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792641514"
         }
      },
      "author_association" : "NONE",
      "body" : "Done",
      "commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "created_at" : "2022-01-26T13:35:24Z",
      "diff_hunk" : "@@ -137,25 +132,30 @@ static ChainstateManager* GetChainman(const std::any& context, HTTPRequest* req)\n     return node_context->chainman.get();\n }\n \n-static RetFormat ParseDataFormat(std::string& param, const std::string& strReq)\n+RetFormat ParseDataFormat(std::string& param, const std::string& strReq)\n {\n-    const std::string::size_type pos = strReq.rfind('.');\n-    if (pos == std::string::npos)\n+    // Remove query string (if any, separated with '?') as it should not interfere with\n+    // parsing param and data format\n+    const std::string::size_type pos_querystr = strReq.rfind('?');\n+    const std::string::size_type pos_format = strReq.rfind('.');\n+    param = strReq.substr(0, std::min(pos_format, pos_querystr));\n+\n+    // No format string is found\n+    if (pos_format == std::string::npos)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r792641514",
      "id" : 792641514,
      "in_reply_to_id" : 792506087,
      "line" : 144,
      "node_id" : "PRRC_kwDOABII584vPr_q",
      "original_commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "original_line" : 144,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : 46,
      "pull_request_review_id" : 863547266,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792641514/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-26T13:35:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792641514",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r792642855"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792642855"
         }
      },
      "author_association" : "NONE",
      "body" : "Done",
      "commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "created_at" : "2022-01-26T13:36:42Z",
      "diff_hunk" : "@@ -355,13 +367,30 @@ static bool rest_filter_header(const std::any& context, HTTPRequest* req, const\n \n     std::vector<std::string> uri_parts;\n     boost::split(uri_parts, param, boost::is_any_of(\"/\"));\n-    if (uri_parts.size() != 3) {\n-        return RESTERR(req, HTTP_BAD_REQUEST, \"Invalid URI format. Expected /rest/blockfilterheaders/<filtertype>/<count>/<blockhash>\");\n+    std::string raw_count {};\n+    size_t blockhash_index {};\n+    if (uri_parts.size() == 3) {\n+        // deprecated path: /rest/blockfilterheaders/<filtertype>/<count>/<blockhash>\n+        blockhash_index = 2;\n+        raw_count = uri_parts[1];\n+    }\n+    else if (uri_parts.size() == 2) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r792642855",
      "id" : 792642855,
      "in_reply_to_id" : 792564751,
      "line" : 377,
      "node_id" : "PRRC_kwDOABII584vPsUn",
      "original_commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "original_line" : 377,
      "original_position" : 116,
      "original_start_line" : 376,
      "path" : "src/rest.cpp",
      "position" : 116,
      "pull_request_review_id" : 863548668,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792642855/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 376,
      "start_side" : "RIGHT",
      "updated_at" : "2022-01-26T13:36:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792642855",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r792643188"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792643188"
         }
      },
      "author_association" : "NONE",
      "body" : "Done",
      "commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "created_at" : "2022-01-26T13:37:00Z",
      "diff_hunk" : "@@ -355,13 +367,30 @@ static bool rest_filter_header(const std::any& context, HTTPRequest* req, const\n \n     std::vector<std::string> uri_parts;\n     boost::split(uri_parts, param, boost::is_any_of(\"/\"));\n-    if (uri_parts.size() != 3) {\n-        return RESTERR(req, HTTP_BAD_REQUEST, \"Invalid URI format. Expected /rest/blockfilterheaders/<filtertype>/<count>/<blockhash>\");\n+    std::string raw_count {};\n+    size_t blockhash_index {};\n+    if (uri_parts.size() == 3) {\n+        // deprecated path: /rest/blockfilterheaders/<filtertype>/<count>/<blockhash>\n+        blockhash_index = 2;\n+        raw_count = uri_parts[1];\n+    }\n+    else if (uri_parts.size() == 2) {\n+        // new path with query parameter: /rest/blockfilterheaders/<filtertype>/<blockhash>?count=<count>\n+        blockhash_index = 1;\n+        raw_count = req->GetQueryParameter(\"count\", \"5\");\n+    }\n+    else {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r792643188",
      "id" : 792643188,
      "in_reply_to_id" : 792564863,
      "line" : 382,
      "node_id" : "PRRC_kwDOABII584vPsZ0",
      "original_commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "original_line" : 382,
      "original_position" : 121,
      "original_start_line" : 381,
      "path" : "src/rest.cpp",
      "position" : 121,
      "pull_request_review_id" : 863548989,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792643188/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 381,
      "start_side" : "RIGHT",
      "updated_at" : "2022-01-26T13:37:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792643188",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r794018163"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/794018163"
         }
      },
      "author_association" : "NONE",
      "body" : "That's a good idea. I've scripted-diff renamed `RetFormat` to `RESTResponseFormat`, since this enum is currently only used to describe response format.",
      "commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "created_at" : "2022-01-27T21:36:05Z",
      "diff_hunk" : "@@ -0,0 +1,28 @@\n+// Copyright (c) 2015-2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_REST_H\n+#define BITCOIN_REST_H\n+\n+#include <string>\n+\n+enum class RetFormat {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r794018163",
      "id" : 794018163,
      "in_reply_to_id" : 792505218,
      "line" : 10,
      "node_id" : "PRRC_kwDOABII584vU8Fz",
      "original_commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "original_line" : 10,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/rest.h",
      "position" : 10,
      "pull_request_review_id" : 865456047,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/794018163/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-27T21:36:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/794018163",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r794057503"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/794057503"
         }
      },
      "author_association" : "NONE",
      "body" : "Good catch, this is leftover from before I introduced the new `raw_count` variable but indeed should be `const` now. Fixed in both `rest_headers` and `rest_filter_header`.",
      "commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "created_at" : "2022-01-27T22:34:05Z",
      "diff_hunk" : "@@ -355,13 +367,30 @@ static bool rest_filter_header(const std::any& context, HTTPRequest* req, const\n \n     std::vector<std::string> uri_parts;\n     boost::split(uri_parts, param, boost::is_any_of(\"/\"));\n-    if (uri_parts.size() != 3) {\n-        return RESTERR(req, HTTP_BAD_REQUEST, \"Invalid URI format. Expected /rest/blockfilterheaders/<filtertype>/<count>/<blockhash>\");\n+    std::string raw_count {};\n+    size_t blockhash_index {};\n+    if (uri_parts.size() == 3) {\n+        // deprecated path: /rest/blockfilterheaders/<filtertype>/<count>/<blockhash>\n+        blockhash_index = 2;\n+        raw_count = uri_parts[1];\n+    }\n+    else if (uri_parts.size() == 2) {\n+        // new path with query parameter: /rest/blockfilterheaders/<filtertype>/<blockhash>?count=<count>\n+        blockhash_index = 1;\n+        raw_count = req->GetQueryParameter(\"count\", \"5\");\n+    }\n+    else {\n+        return RESTERR(req, HTTP_BAD_REQUEST, \"Invalid URI format. Expected /rest/blockfilterheaders/<filtertype>/<blockhash>.<ext>?count=<count>\");\n+    }\n+\n+    auto parsed_count = ToIntegral<size_t>(raw_count);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r794057503",
      "id" : 794057503,
      "in_reply_to_id" : 792574341,
      "line" : 386,
      "node_id" : "PRRC_kwDOABII584vVFsf",
      "original_commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "original_line" : 386,
      "original_position" : 125,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : 125,
      "pull_request_review_id" : 865510840,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/794057503/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-27T22:34:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/794057503",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r794060223"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/794060223"
         }
      },
      "author_association" : "NONE",
      "body" : "I did not consider that, but that's a great idea. I've taken it a bit further, and removed the `default_val` optional argument from GetQueryParameter, since this functionality can now just as easily be achieved in the headers endpoints by using `std::optional::value_or()` as you suggested, slightly reducing complexity of the code.",
      "commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "created_at" : "2022-01-27T22:38:51Z",
      "diff_hunk" : "@@ -83,6 +84,19 @@ class HTTPRequest\n      */\n     RequestMethod GetRequestMethod() const;\n \n+    /** Get the query parameter value from request uri for a specified key.\n+     * Throws std::runtime_error if key does not exist and no default_val is specified.\n+     *\n+     * If the query string contains duplicate keys, the first value is returned. Many web frameworks\n+     * would instead parse this as an array of values, but this is not (yet) implemented as it is\n+     * currently not needed in any of the endpoints.\n+     *\n+     * @param[in] key represents the query parameter of which the value is returned\n+     * @param[in] default_val (optional) is returned if key is not in query string\n+     * @throws std::runtime_error if key is not in query string and no default_val was provided",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r794060223",
      "id" : 794060223,
      "in_reply_to_id" : 792571528,
      "line" : 96,
      "node_id" : "PRRC_kwDOABII584vVGW_",
      "original_commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "original_line" : 96,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/httpserver.h",
      "position" : 24,
      "pull_request_review_id" : 865514316,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/794060223/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-27T22:38:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/794060223",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r794117941"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/794117941"
         }
      },
      "author_association" : "NONE",
      "body" : "Added an additional test case. More importantly, the handling of this edge case led me to simplify `ParseDataFormat` by refactoring out the `pos_querystr` variable.",
      "commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "created_at" : "2022-01-28T00:52:06Z",
      "diff_hunk" : "@@ -0,0 +1,43 @@\n+// Copyright (c) 2012-2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <rest.h>\n+#include <test/util/setup_common.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+#include <string>\n+\n+BOOST_FIXTURE_TEST_SUITE(rest_tests, BasicTestingSetup)\n+\n+BOOST_AUTO_TEST_CASE(test_query_string)\n+{\n+    std::string param;\n+    RetFormat rf;\n+    // No query string\n+    rf = ParseDataFormat(param, \"/rest/endpoint/someresource.json\");\n+    BOOST_CHECK_EQUAL(param, \"/rest/endpoint/someresource\");\n+    BOOST_CHECK_EQUAL(rf, RetFormat::JSON);\n+\n+    // Query string with single parameter\n+    rf = ParseDataFormat(param, \"/rest/endpoint/someresource.json?p1=v1\");\n+    BOOST_CHECK_EQUAL(param, \"/rest/endpoint/someresource\");\n+    BOOST_CHECK_EQUAL(rf, RetFormat::JSON);\n+\n+    // Query string with multiple parameters\n+    rf = ParseDataFormat(param, \"/rest/endpoint/someresource.json?p1=v1&p2=v2\");\n+    BOOST_CHECK_EQUAL(param, \"/rest/endpoint/someresource\");\n+    BOOST_CHECK_EQUAL(rf, RetFormat::JSON);\n+\n+    // Incorrectly formed query string will not be handled",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r794117941",
      "id" : 794117941,
      "in_reply_to_id" : 792560203,
      "line" : 33,
      "node_id" : "PRRC_kwDOABII584vVUc1",
      "original_commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "original_line" : 33,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/test/rest_tests.cpp",
      "position" : 33,
      "pull_request_review_id" : 865589844,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/794117941/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-28T00:52:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/794117941",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r794155094"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/794155094"
         }
      },
      "author_association" : "NONE",
      "body" : "I agree, that's a more elegant solution. To facilitate dynamic URI creation, I've added a `query_params` kwargs to `test_rest_request()` which is then encoded into a query string.",
      "commit_id" : "9d9f1771d2353cfe9b0c3f00f4a65992faed7855",
      "created_at" : "2022-01-28T02:16:50Z",
      "diff_hunk" : "@@ -53,12 +53,13 @@ def skip_test_if_missing_module(self):\n \n     def test_rest_request(self, uri, http_method='GET', req_type=ReqType.JSON, body='', status=200, ret_type=RetType.JSON):\n         rest_uri = '/rest' + uri\n-        if req_type == ReqType.JSON:\n-            rest_uri += '.json'\n-        elif req_type == ReqType.BIN:\n-            rest_uri += '.bin'\n-        elif req_type == ReqType.HEX:\n-            rest_uri += '.hex'\n+        query_string = ''",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r794155094",
      "id" : 794155094,
      "in_reply_to_id" : 792575674,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584vVdhW",
      "original_commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "original_line" : 56,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "test/functional/interface_rest.py",
      "position" : null,
      "pull_request_review_id" : 865633185,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/794155094/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-28T02:16:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/794155094",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Thank you for the extensive review jnewbery, I've incorporated all of your comments into the latest force push 9d9f177. \r\n\r\n> Each `/headers/block` is a unique resource, so I think it makes sense to keep the block hash as part of the URI path. Making `format` a query string key seems ok to me.\r\n>\r\n> I also think that the `/rest/block/notxdetails/` endpoint could be deprecated and merged into `/rest/block/<BLOCKHASH>?txdetails=true|false` or similar in a follow up.\r\n\r\nI agree with both of your comments, and am happy to take them on in a follow up PR. Since all of the query parameter logic is already in place now, this should be quite limited in scope too.\r\n",
      "created_at" : "2022-01-28T03:02:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#issuecomment-1023841023",
      "id" : 1023841023,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24098",
      "node_id" : "IC_kwDOABII5849BpL_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1023841023/reactions"
      },
      "updated_at" : "2022-01-28T03:02:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1023841023",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-02-02T08:41:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#issuecomment-1027703081",
      "id" : 1027703081,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24098",
      "node_id" : "IC_kwDOABII5849QYEp",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1027703081/reactions"
      },
      "updated_at" : "2022-02-02T08:41:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1027703081",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Each `/headers/block` is a unique resource, so I think it makes sense to keep the block hash as part of the URI path.\r\n\r\n@jnewbery this endpoint returns a list of `count` headers, not the unique resource.\r\n\r\n```\r\n// list of headers\r\nGET /rest/headers?block_hash=&count=&format=\r\n\r\nVS\r\n\r\n// an header\r\nGET /rest/headers/block_hash?format=\r\n```\r\n\r\nAnyway, just wanted to note my opinion, I'm fine with block hash in the path.",
      "created_at" : "2022-02-02T09:46:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#issuecomment-1027755825",
      "id" : 1027755825,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24098",
      "node_id" : "IC_kwDOABII5849Qk8x",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1027755825/reactions"
      },
      "updated_at" : "2022-02-02T09:46:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1027755825",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Rebased to fix merge conflict from #24223.",
      "created_at" : "2022-02-02T11:02:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#issuecomment-1027820448",
      "id" : 1027820448,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24098",
      "node_id" : "IC_kwDOABII5849Q0ug",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1027820448/reactions"
      },
      "updated_at" : "2022-02-02T11:02:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1027820448",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "It may be helpful to other reviews to note that you can interact with a local `bitcoind`'s REST interface from the command line using `curl`, for example:\r\n```\r\n$ curl -s localhost:8332/rest/blockhashbyheight/723418.json | jq .\r\n{\r\n  \"blockhash\": \"000000000000000000010ce22c300e67d706860e8e883ed108691a903801b0ee\"\r\n}\r\n```\r\nAnother common JSON formatting tool is `json_pp` (if you don't have `jq` installed).",
      "created_at" : "2022-02-23T15:43:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#issuecomment-1048919474",
      "id" : 1048919474,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24098",
      "node_id" : "IC_kwDOABII584-hT2y",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1048919474/reactions"
      },
      "updated_at" : "2022-02-23T15:43:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1048919474",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK\r\n\r\nMakes sense to follow best practices of REST API design.",
      "created_at" : "2022-02-23T16:55:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#issuecomment-1048995206",
      "id" : 1048995206,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24098",
      "node_id" : "IC_kwDOABII584-hmWG",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1048995206/reactions"
      },
      "updated_at" : "2022-02-23T16:55:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1048995206",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "concept ACK",
      "created_at" : "2022-02-23T17:57:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#issuecomment-1049054758",
      "id" : 1049054758,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24098",
      "node_id" : "IC_kwDOABII584-h04m",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1049054758/reactions"
      },
      "updated_at" : "2022-02-23T17:57:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1049054758",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/84942996?v=4",
         "events_url" : "https://api.github.com/users/OliverOffing/events{/privacy}",
         "followers_url" : "https://api.github.com/users/OliverOffing/followers",
         "following_url" : "https://api.github.com/users/OliverOffing/following{/other_user}",
         "gists_url" : "https://api.github.com/users/OliverOffing/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/OliverOffing",
         "id" : 84942996,
         "login" : "OliverOffing",
         "node_id" : "MDQ6VXNlcjg0OTQyOTk2",
         "organizations_url" : "https://api.github.com/users/OliverOffing/orgs",
         "received_events_url" : "https://api.github.com/users/OliverOffing/received_events",
         "repos_url" : "https://api.github.com/users/OliverOffing/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/OliverOffing/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/OliverOffing/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/OliverOffing"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r813673702"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/813673702"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Calculating the length shouldn't be necessary here, you can simply omit the third parameter of the ctor to get the sub-string from pos_format + 1 to the end:\r\n```suggestion\r\n    const std::string suff(param, pos_format + 1);\r\n```\r\n(I checked that tests still pass after this change)\r\nAlso, I'd suggest to rename \"suff\" to \"suffix\" to make it more clear (nit though)",
      "commit_id" : "6628e8f3b0578ec09611c82011dd2e282ed42064",
      "created_at" : "2022-02-24T09:01:36Z",
      "diff_hunk" : "@@ -133,25 +133,28 @@ static ChainstateManager* GetChainman(const std::any& context, HTTPRequest* req)\n     return node_context->chainman.get();\n }\n \n-static RESTResponseFormat ParseDataFormat(std::string& param, const std::string& strReq)\n+RESTResponseFormat ParseDataFormat(std::string& param, const std::string& strReq)\n {\n-    const std::string::size_type pos = strReq.rfind('.');\n-    if (pos == std::string::npos)\n-    {\n-        param = strReq;\n-        return rf_names[0].rf;\n-    }\n+    // Remove query string (if any, separated with '?') as it should not interfere with\n+    // parsing param and data format\n+    param = strReq.substr(0, strReq.rfind('?'));\n+    const std::string::size_type pos_format = param.rfind('.');\n \n-    param = strReq.substr(0, pos);\n-    const std::string suff(strReq, pos + 1);\n+    // No format string is found\n+    if (pos_format == std::string::npos)\n+        return rf_names[0].rf;\n \n+    // Match format string to available formats\n+    auto len_suff = param.size() - pos_format - 1;  // - 1 so we don't include the leading .\n+    const std::string suff(param, pos_format + 1, len_suff);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r813673702",
      "id" : 813673702,
      "line" : 149,
      "node_id" : "PRRC_kwDOABII584wf6zm",
      "original_commit_id" : "833803e9aa4a107d9b48d0fb51b360b1b3df3b21",
      "original_line" : 149,
      "original_position" : 26,
      "original_start_line" : 148,
      "path" : "src/rest.cpp",
      "position" : 26,
      "pull_request_review_id" : 892152112,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/813673702/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 148,
      "start_side" : "RIGHT",
      "updated_at" : "2022-02-24T09:22:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/813673702",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r813677594"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/813677594"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: no reason to explicitly menton the return type here before the description (we don't do that usually as far as I saw)\r\n```suggestion\r\n * @return      RESTResponseFormat that was parsed from the URI.\r\n```",
      "commit_id" : "6628e8f3b0578ec09611c82011dd2e282ed42064",
      "created_at" : "2022-02-24T09:07:07Z",
      "diff_hunk" : "@@ -14,6 +14,15 @@ enum class RESTResponseFormat {\n     JSON,\n };\n \n+/**\n+ * Parse a URI to get the data format and URI without data format\n+ * and query string.\n+ *\n+ * @param[out]  param       The strReq without the data format string and\n+ *                          without the query string (if any).\n+ * @param[in]   strReq      The URI to be parsed.\n+ * @return      RESTResponseFormat   RESTResponseFormat that was parsed from the URI.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r813677594",
      "id" : 813677594,
      "line" : 24,
      "node_id" : "PRRC_kwDOABII584wf7wa",
      "original_commit_id" : "833803e9aa4a107d9b48d0fb51b360b1b3df3b21",
      "original_line" : 24,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/rest.h",
      "position" : 11,
      "pull_request_review_id" : 892152112,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/813677594/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-24T09:22:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/813677594",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r813684530"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/813684530"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Could use .bin here (and .hex below, or vice versa) to also test all the different response formats.",
      "commit_id" : "6628e8f3b0578ec09611c82011dd2e282ed42064",
      "created_at" : "2022-02-24T09:16:05Z",
      "diff_hunk" : "@@ -0,0 +1,48 @@\n+// Copyright (c) 2012-2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <rest.h>\n+#include <test/util/setup_common.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+#include <string>\n+\n+BOOST_FIXTURE_TEST_SUITE(rest_tests, BasicTestingSetup)\n+\n+BOOST_AUTO_TEST_CASE(test_query_string)\n+{\n+    std::string param;\n+    RESTResponseFormat rf;\n+    // No query string\n+    rf = ParseDataFormat(param, \"/rest/endpoint/someresource.json\");\n+    BOOST_CHECK_EQUAL(param, \"/rest/endpoint/someresource\");\n+    BOOST_CHECK_EQUAL(rf, RESTResponseFormat::JSON);\n+\n+    // Query string with single parameter\n+    rf = ParseDataFormat(param, \"/rest/endpoint/someresource.json?p1=v1\");\n+    BOOST_CHECK_EQUAL(param, \"/rest/endpoint/someresource\");\n+    BOOST_CHECK_EQUAL(rf, RESTResponseFormat::JSON);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r813684530",
      "id" : 813684530,
      "line" : 26,
      "node_id" : "PRRC_kwDOABII584wf9cy",
      "original_commit_id" : "833803e9aa4a107d9b48d0fb51b360b1b3df3b21",
      "original_line" : 26,
      "original_position" : 26,
      "original_start_line" : 24,
      "path" : "src/test/rest_tests.cpp",
      "position" : 26,
      "pull_request_review_id" : 892152112,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/813684530/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 24,
      "start_side" : "RIGHT",
      "updated_at" : "2022-02-24T09:22:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/813684530",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r813689385"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/813689385"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: to be consistent with the headers description above:\r\n```suggestion\r\n  `GET /rest/blockfilterheaders/<FILTERTYPE>/<COUNT>/<BLOCK-HASH>.<bin|hex|json> (deprecated)`\r\n```",
      "commit_id" : "6628e8f3b0578ec09611c82011dd2e282ed42064",
      "created_at" : "2022-02-24T09:21:58Z",
      "diff_hunk" : "@@ -0,0 +1,22 @@\n+Notable changes\n+===============\n+\n+Updated REST APIs\n+-----------------\n+\n+- The `/headers/` and `/blockfilterheaders/` endpoints have been updated to use\n+  a query parameter instead of path parameter to specify the result count. The\n+  count parameter is now optional, and defaults to 5 for both endpoints. The old\n+  endpoints are still functional, and have no documented behaviour change.\n+\n+  For `/headers`, use\n+  `GET /rest/headers/<BLOCK-HASH>.<bin|hex|json>?count=<COUNT=5>`\n+  instead of\n+  `GET /rest/headers/<COUNT>/<BLOCK-HASH>.<bin|hex|json>` (deprecated)\n+\n+  For `/blockfilterheaders/`, use\n+  `GET /rest/blockfilterheaders/<FILTERTYPE>/<BLOCK-HASH>.<bin|hex|json>?count=<COUNT=5>`\n+  instead of\n+  `GET /rest/blockfilterheaders/<FILTERTYPE>/<COUNT>/<BLOCK-HASH>.<bin|hex|json>`",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r813689385",
      "id" : 813689385,
      "line" : 20,
      "node_id" : "PRRC_kwDOABII584wf-op",
      "original_commit_id" : "6628e8f3b0578ec09611c82011dd2e282ed42064",
      "original_line" : 20,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "doc/release-notes-24098.md",
      "position" : 20,
      "pull_request_review_id" : 892152112,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/813689385/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-24T09:22:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/813689385",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r813691095"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/813691095"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This doesn't seem to be resolved?",
      "commit_id" : "6628e8f3b0578ec09611c82011dd2e282ed42064",
      "created_at" : "2022-02-24T09:24:04Z",
      "diff_hunk" : "@@ -137,25 +132,30 @@ static ChainstateManager* GetChainman(const std::any& context, HTTPRequest* req)\n     return node_context->chainman.get();\n }\n \n-static RetFormat ParseDataFormat(std::string& param, const std::string& strReq)\n+RetFormat ParseDataFormat(std::string& param, const std::string& strReq)\n {\n-    const std::string::size_type pos = strReq.rfind('.');\n-    if (pos == std::string::npos)\n+    // Remove query string (if any, separated with '?') as it should not interfere with\n+    // parsing param and data format\n+    const std::string::size_type pos_querystr = strReq.rfind('?');\n+    const std::string::size_type pos_format = strReq.rfind('.');\n+    param = strReq.substr(0, std::min(pos_format, pos_querystr));\n+\n+    // No format string is found\n+    if (pos_format == std::string::npos)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r813691095",
      "id" : 813691095,
      "in_reply_to_id" : 792506087,
      "line" : 144,
      "node_id" : "PRRC_kwDOABII584wf_DX",
      "original_commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "original_line" : 144,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : 65,
      "pull_request_review_id" : 892176455,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/813691095/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-24T09:24:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/813691095",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r814054421"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/814054421"
         }
      },
      "author_association" : "NONE",
      "body" : "Thanks, fixed",
      "commit_id" : "6628e8f3b0578ec09611c82011dd2e282ed42064",
      "created_at" : "2022-02-24T16:27:49Z",
      "diff_hunk" : "@@ -0,0 +1,22 @@\n+Notable changes\n+===============\n+\n+Updated REST APIs\n+-----------------\n+\n+- The `/headers/` and `/blockfilterheaders/` endpoints have been updated to use\n+  a query parameter instead of path parameter to specify the result count. The\n+  count parameter is now optional, and defaults to 5 for both endpoints. The old\n+  endpoints are still functional, and have no documented behaviour change.\n+\n+  For `/headers`, use\n+  `GET /rest/headers/<BLOCK-HASH>.<bin|hex|json>?count=<COUNT=5>`\n+  instead of\n+  `GET /rest/headers/<COUNT>/<BLOCK-HASH>.<bin|hex|json>` (deprecated)\n+\n+  For `/blockfilterheaders/`, use\n+  `GET /rest/blockfilterheaders/<FILTERTYPE>/<BLOCK-HASH>.<bin|hex|json>?count=<COUNT=5>`\n+  instead of\n+  `GET /rest/blockfilterheaders/<FILTERTYPE>/<COUNT>/<BLOCK-HASH>.<bin|hex|json>`",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r814054421",
      "id" : 814054421,
      "in_reply_to_id" : 813689385,
      "line" : 20,
      "node_id" : "PRRC_kwDOABII584whXwV",
      "original_commit_id" : "6628e8f3b0578ec09611c82011dd2e282ed42064",
      "original_line" : 20,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "doc/release-notes-24098.md",
      "position" : 20,
      "pull_request_review_id" : 892688043,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/814054421/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-24T16:27:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/814054421",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r814061217"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/814061217"
         }
      },
      "author_association" : "NONE",
      "body" : "Ah yes, you're right, that is more elegant. Updated to your suggestion, and also renamed `suff` to `suffix`.",
      "commit_id" : "6628e8f3b0578ec09611c82011dd2e282ed42064",
      "created_at" : "2022-02-24T16:35:14Z",
      "diff_hunk" : "@@ -133,25 +133,28 @@ static ChainstateManager* GetChainman(const std::any& context, HTTPRequest* req)\n     return node_context->chainman.get();\n }\n \n-static RESTResponseFormat ParseDataFormat(std::string& param, const std::string& strReq)\n+RESTResponseFormat ParseDataFormat(std::string& param, const std::string& strReq)\n {\n-    const std::string::size_type pos = strReq.rfind('.');\n-    if (pos == std::string::npos)\n-    {\n-        param = strReq;\n-        return rf_names[0].rf;\n-    }\n+    // Remove query string (if any, separated with '?') as it should not interfere with\n+    // parsing param and data format\n+    param = strReq.substr(0, strReq.rfind('?'));\n+    const std::string::size_type pos_format = param.rfind('.');\n \n-    param = strReq.substr(0, pos);\n-    const std::string suff(strReq, pos + 1);\n+    // No format string is found\n+    if (pos_format == std::string::npos)\n+        return rf_names[0].rf;\n \n+    // Match format string to available formats\n+    auto len_suff = param.size() - pos_format - 1;  // - 1 so we don't include the leading .\n+    const std::string suff(param, pos_format + 1, len_suff);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r814061217",
      "id" : 814061217,
      "in_reply_to_id" : 813673702,
      "line" : 149,
      "node_id" : "PRRC_kwDOABII584whZah",
      "original_commit_id" : "833803e9aa4a107d9b48d0fb51b360b1b3df3b21",
      "original_line" : 149,
      "original_position" : 26,
      "original_start_line" : 148,
      "path" : "src/rest.cpp",
      "position" : 26,
      "pull_request_review_id" : 892697994,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/814061217/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 148,
      "start_side" : "RIGHT",
      "updated_at" : "2022-02-24T16:35:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/814061217",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r814068387"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/814068387"
         }
      },
      "author_association" : "NONE",
      "body" : "Okay didn't know, thanks, and you're right, by far most places in this codebase don't include the return type. Fixed",
      "commit_id" : "6628e8f3b0578ec09611c82011dd2e282ed42064",
      "created_at" : "2022-02-24T16:42:31Z",
      "diff_hunk" : "@@ -14,6 +14,15 @@ enum class RESTResponseFormat {\n     JSON,\n };\n \n+/**\n+ * Parse a URI to get the data format and URI without data format\n+ * and query string.\n+ *\n+ * @param[out]  param       The strReq without the data format string and\n+ *                          without the query string (if any).\n+ * @param[in]   strReq      The URI to be parsed.\n+ * @return      RESTResponseFormat   RESTResponseFormat that was parsed from the URI.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r814068387",
      "id" : 814068387,
      "in_reply_to_id" : 813677594,
      "line" : 24,
      "node_id" : "PRRC_kwDOABII584whbKj",
      "original_commit_id" : "833803e9aa4a107d9b48d0fb51b360b1b3df3b21",
      "original_line" : 24,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/rest.h",
      "position" : 11,
      "pull_request_review_id" : 892707128,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/814068387/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-24T16:42:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/814068387",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r814074503"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/814074503"
         }
      },
      "author_association" : "NONE",
      "body" : "Like the idea, incorporated!",
      "commit_id" : "6628e8f3b0578ec09611c82011dd2e282ed42064",
      "created_at" : "2022-02-24T16:49:37Z",
      "diff_hunk" : "@@ -0,0 +1,48 @@\n+// Copyright (c) 2012-2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <rest.h>\n+#include <test/util/setup_common.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+#include <string>\n+\n+BOOST_FIXTURE_TEST_SUITE(rest_tests, BasicTestingSetup)\n+\n+BOOST_AUTO_TEST_CASE(test_query_string)\n+{\n+    std::string param;\n+    RESTResponseFormat rf;\n+    // No query string\n+    rf = ParseDataFormat(param, \"/rest/endpoint/someresource.json\");\n+    BOOST_CHECK_EQUAL(param, \"/rest/endpoint/someresource\");\n+    BOOST_CHECK_EQUAL(rf, RESTResponseFormat::JSON);\n+\n+    // Query string with single parameter\n+    rf = ParseDataFormat(param, \"/rest/endpoint/someresource.json?p1=v1\");\n+    BOOST_CHECK_EQUAL(param, \"/rest/endpoint/someresource\");\n+    BOOST_CHECK_EQUAL(rf, RESTResponseFormat::JSON);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r814074503",
      "id" : 814074503,
      "in_reply_to_id" : 813684530,
      "line" : 26,
      "node_id" : "PRRC_kwDOABII584whcqH",
      "original_commit_id" : "833803e9aa4a107d9b48d0fb51b360b1b3df3b21",
      "original_line" : 26,
      "original_position" : 26,
      "original_start_line" : 24,
      "path" : "src/test/rest_tests.cpp",
      "position" : 26,
      "pull_request_review_id" : 892715938,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/814074503/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 24,
      "start_side" : "RIGHT",
      "updated_at" : "2022-02-24T16:49:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/814074503",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r814074996"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/814074996"
         }
      },
      "author_association" : "NONE",
      "body" : "Like the idea, incorporated!",
      "commit_id" : "6628e8f3b0578ec09611c82011dd2e282ed42064",
      "created_at" : "2022-02-24T16:50:06Z",
      "diff_hunk" : "@@ -0,0 +1,48 @@\n+// Copyright (c) 2012-2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <rest.h>\n+#include <test/util/setup_common.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+#include <string>\n+\n+BOOST_FIXTURE_TEST_SUITE(rest_tests, BasicTestingSetup)\n+\n+BOOST_AUTO_TEST_CASE(test_query_string)\n+{\n+    std::string param;\n+    RESTResponseFormat rf;\n+    // No query string\n+    rf = ParseDataFormat(param, \"/rest/endpoint/someresource.json\");\n+    BOOST_CHECK_EQUAL(param, \"/rest/endpoint/someresource\");\n+    BOOST_CHECK_EQUAL(rf, RESTResponseFormat::JSON);\n+\n+    // Query string with single parameter\n+    rf = ParseDataFormat(param, \"/rest/endpoint/someresource.json?p1=v1\");\n+    BOOST_CHECK_EQUAL(param, \"/rest/endpoint/someresource\");\n+    BOOST_CHECK_EQUAL(rf, RESTResponseFormat::JSON);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r814074996",
      "id" : 814074996,
      "in_reply_to_id" : 813684530,
      "line" : 26,
      "node_id" : "PRRC_kwDOABII584whcx0",
      "original_commit_id" : "833803e9aa4a107d9b48d0fb51b360b1b3df3b21",
      "original_line" : 26,
      "original_position" : 26,
      "original_start_line" : 24,
      "path" : "src/test/rest_tests.cpp",
      "position" : 26,
      "pull_request_review_id" : 892716565,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/814074996/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 24,
      "start_side" : "RIGHT",
      "updated_at" : "2022-02-24T16:50:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/814074996",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r814711077"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/814711077"
         }
      },
      "author_association" : "NONE",
      "body" : "Sorry, I think I refactored it out again after simplifying `ParseDataFormat` a bit more. Didn't realize our coding style preferred brackets for single-statement multi-line `if` statements. Added brackets again, thanks for catching this.",
      "commit_id" : "6628e8f3b0578ec09611c82011dd2e282ed42064",
      "created_at" : "2022-02-25T11:59:23Z",
      "diff_hunk" : "@@ -137,25 +132,30 @@ static ChainstateManager* GetChainman(const std::any& context, HTTPRequest* req)\n     return node_context->chainman.get();\n }\n \n-static RetFormat ParseDataFormat(std::string& param, const std::string& strReq)\n+RetFormat ParseDataFormat(std::string& param, const std::string& strReq)\n {\n-    const std::string::size_type pos = strReq.rfind('.');\n-    if (pos == std::string::npos)\n+    // Remove query string (if any, separated with '?') as it should not interfere with\n+    // parsing param and data format\n+    const std::string::size_type pos_querystr = strReq.rfind('?');\n+    const std::string::size_type pos_format = strReq.rfind('.');\n+    param = strReq.substr(0, std::min(pos_format, pos_querystr));\n+\n+    // No format string is found\n+    if (pos_format == std::string::npos)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r814711077",
      "id" : 814711077,
      "in_reply_to_id" : 792506087,
      "line" : 144,
      "node_id" : "PRRC_kwDOABII584wj4El",
      "original_commit_id" : "e1822e79b3d5230f976360e5500d7ef59dd8783c",
      "original_line" : 144,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : 65,
      "pull_request_review_id" : 893593394,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/814711077/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-25T11:59:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/814711077",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@stickies-v: Seems like you didn't force-push your latest changes yet?",
      "created_at" : "2022-02-25T13:50:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#issuecomment-1050870301",
      "id" : 1050870301,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24098",
      "node_id" : "IC_kwDOABII584-owId",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1050870301/reactions"
      },
      "updated_at" : "2022-02-25T13:50:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1050870301",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r815467602"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/815467602"
         }
      },
      "author_association" : "NONE",
      "body" : "To conclude, I agree with promag that `/headers/` and `/blockfilterheaders/` are collection endpoints since we're not obtaining a resource identified by the specified `block_hash` but rather use it as a pagination parameter. I didn't properly realise this at first. \r\n\r\nGiven that 1) this PR has had quite a bit of review time already which I'd rather not overhaul too much and 2) these and the other updates (moving `format` and `notxdetails` to a query parameter) make sense to implement together, I'll implement this in a follow up PR (I've already briefly started but it will take a bit more time as I'm thinking about ways to minimise the maintenance burden of keeping backwards compatibility).",
      "commit_id" : "6628e8f3b0578ec09611c82011dd2e282ed42064",
      "created_at" : "2022-02-27T17:15:08Z",
      "diff_hunk" : "@@ -47,18 +47,24 @@ The HTTP request and response are both handled entirely in-memory.\n With the /notxdetails/ option JSON response will only contain the transaction hash instead of the complete transaction details. The option only affects the JSON response.\n \n #### Blockheaders\n-`GET /rest/headers/<COUNT>/<BLOCK-HASH>.<bin|hex|json>`\n+`GET /rest/headers/<BLOCK-HASH>.<bin|hex|json>?count=<COUNT=5>`",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r815467602",
      "id" : 815467602,
      "in_reply_to_id" : 790336549,
      "line" : 50,
      "node_id" : "PRRC_kwDOABII584wmwxS",
      "original_commit_id" : "0415aaafb2f7206c117f58cc7a4a967cee0fa619",
      "original_line" : 50,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "doc/REST-interface.md",
      "position" : 5,
      "pull_request_review_id" : 894526815,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/815467602/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-27T17:15:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/815467602",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Force pushed changes to incorporate suggestions from theStack and an re-unresolved comment from jnewbery. As per my [comment](https://github.com/bitcoin/bitcoin/pull/24098#discussion_r815467602) in the thread, I think the best approach is to move the `block_hash` query parameter into the follow up PR along with some more improvements, so I think for now all comments on the content of this PR are resolved.\r\n\r\n> It may be helpful to other reviews to note that you can interact with a local `bitcoind`'s REST interface from the command line using `curl`, for example:\r\n\r\nThanks for the suggestion, I updated the initial post with some instructions.\r\n\r\n> @stickies-v: Seems like you didn't force-push your latest changes yet?\r\n\r\nMy bad, I tended to use the \"Mark as resolved\" as a personal to do list which I now realize is confusing, going forward I'll try to force push first and comment/mark afterwards.\r\n\r\n> I think the commit 833803e can be split in two: one for the change mentioned in the title of commit and other for the test added.\r\n\r\nCould you please explain how that would improve the PR in your view? I think since the test is quite small, so closely linked with the code changes, and wouldn't work without the prior commit, it's quite intuitive to keep it in one? I had a look at other PRs and I couldn't really find consensus between doing tests in the same or separate commits, so I just went for my intuition. _(edit: and to add to that, it would probably complicate the re-review process as `git range-diff` would break_\r\n\r\n",
      "created_at" : "2022-02-27T19:39:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#issuecomment-1053657286",
      "id" : 1053657286,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24098",
      "node_id" : "IC_kwDOABII584-zYjG",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 2,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 2,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1053657286/reactions"
      },
      "updated_at" : "2022-03-02T17:04:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1053657286",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r816327908"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816327908"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: could just directly return the result of the helper instead of storing it in a variable:\r\n```suggestion\r\n    return GetQueryParameterFromUri(uri, key);\r\n```",
      "commit_id" : "aef7c8cb4e92609385eb072c10a64eb2cbf05425",
      "created_at" : "2022-02-28T23:22:34Z",
      "diff_hunk" : "@@ -639,6 +641,39 @@ HTTPRequest::RequestMethod HTTPRequest::GetRequestMethod() const\n     }\n }\n \n+std::optional<std::string> HTTPRequest::GetQueryParameter(const std::string& key) const\n+{\n+    auto uri = evhttp_request_get_uri(req);\n+    auto result = GetQueryParameterFromUri(uri, key);\n+\n+    return result;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r816327908",
      "id" : 816327908,
      "line" : 649,
      "node_id" : "PRRC_kwDOABII584wqCzk",
      "original_commit_id" : "b5d8761251eb7d08f8166593190a0eba8e2304af",
      "original_line" : 649,
      "original_position" : 32,
      "original_start_line" : 647,
      "path" : "src/httpserver.cpp",
      "position" : 32,
      "pull_request_review_id" : 895699215,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816327908/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 647,
      "start_side" : "RIGHT",
      "updated_at" : "2022-03-01T00:04:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816327908",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r816331148"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816331148"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: Personally I'm not a fan of using the auto keyword for results of external C library calls (or any other calls that return pointers to objects, especially if they need further calls to clean up). It's less to type, but overall harder to reason about the code, IMHO.",
      "commit_id" : "aef7c8cb4e92609385eb072c10a64eb2cbf05425",
      "created_at" : "2022-02-28T23:29:31Z",
      "diff_hunk" : "@@ -639,6 +641,39 @@ HTTPRequest::RequestMethod HTTPRequest::GetRequestMethod() const\n     }\n }\n \n+std::optional<std::string> HTTPRequest::GetQueryParameter(const std::string& key) const\n+{\n+    auto uri = evhttp_request_get_uri(req);\n+    auto result = GetQueryParameterFromUri(uri, key);\n+\n+    return result;\n+}\n+\n+std::optional<std::string> GetQueryParameterFromUri(const char* uri, const std::string& key)\n+{\n+    auto uri_parsed = evhttp_uri_parse(uri);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r816331148",
      "id" : 816331148,
      "line" : 654,
      "node_id" : "PRRC_kwDOABII584wqDmM",
      "original_commit_id" : "b5d8761251eb7d08f8166593190a0eba8e2304af",
      "original_line" : 654,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/httpserver.cpp",
      "position" : 37,
      "pull_request_review_id" : 895699215,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816331148/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-01T00:04:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816331148",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r816336581"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816336581"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: As far as I know we usually don't explicitly specify the empty ctor (there are also instances of those in other commits).\r\n```suggestion\r\n    std::optional<std::string> result;\r\n```",
      "commit_id" : "aef7c8cb4e92609385eb072c10a64eb2cbf05425",
      "created_at" : "2022-02-28T23:41:18Z",
      "diff_hunk" : "@@ -639,6 +641,39 @@ HTTPRequest::RequestMethod HTTPRequest::GetRequestMethod() const\n     }\n }\n \n+std::optional<std::string> HTTPRequest::GetQueryParameter(const std::string& key) const\n+{\n+    auto uri = evhttp_request_get_uri(req);\n+    auto result = GetQueryParameterFromUri(uri, key);\n+\n+    return result;\n+}\n+\n+std::optional<std::string> GetQueryParameterFromUri(const char* uri, const std::string& key)\n+{\n+    auto uri_parsed = evhttp_uri_parse(uri);\n+    auto query = evhttp_uri_get_query(uri_parsed);\n+    std::optional<std::string> result {};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r816336581",
      "id" : 816336581,
      "line" : 656,
      "node_id" : "PRRC_kwDOABII584wqE7F",
      "original_commit_id" : "b5d8761251eb7d08f8166593190a0eba8e2304af",
      "original_line" : 656,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/httpserver.cpp",
      "position" : 39,
      "pull_request_review_id" : 895699215,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816336581/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-01T00:04:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816336581",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r816340504"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816340504"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: For consistency reasons, could adapt to the corresponding error message format for blockfilterheaders:\r\n```suggestion\r\n        return RESTERR(req, HTTP_BAD_REQUEST, \"Invalid URI format. Expected /rest/headers/<hash>.<ext>?count=<count>\");\r\n```\r\n",
      "commit_id" : "aef7c8cb4e92609385eb072c10a64eb2cbf05425",
      "created_at" : "2022-02-28T23:50:17Z",
      "diff_hunk" : "@@ -194,15 +194,25 @@ static bool rest_headers(const std::any& context,\n     std::vector<std::string> path;\n     boost::split(path, param, boost::is_any_of(\"/\"));\n \n-    if (path.size() != 2)\n-        return RESTERR(req, HTTP_BAD_REQUEST, \"No header count specified. Use /rest/headers/<count>/<hash>.<ext>.\");\n-\n-    const auto parsed_count{ToIntegral<size_t>(path[0])};\n+    std::string raw_count {};\n+    std::string hashStr {};\n+    if (path.size() == 2) {\n+        // deprecated path: /rest/headers/<count>/<hash>\n+        hashStr = path[1];\n+        raw_count = path[0];\n+    } else if (path.size() == 1) {\n+        // new path with query parameter: /rest/headers/<hash>?count=<count>\n+        hashStr = path[0];\n+        raw_count = req->GetQueryParameter(\"count\").value_or(\"5\");\n+    } else {\n+        return RESTERR(req, HTTP_BAD_REQUEST, \"Invalid request. Use /rest/headers/<hash>.<ext>?count=<count>\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r816340504",
      "id" : 816340504,
      "line" : 208,
      "node_id" : "PRRC_kwDOABII584wqF4Y",
      "original_commit_id" : "e87b32e8eac127de20f0d2ad538f376cb01fc8ef",
      "original_line" : 208,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : 19,
      "pull_request_review_id" : 895699215,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816340504/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-01T00:04:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816340504",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r816721604"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816721604"
         }
      },
      "author_association" : "NONE",
      "body" : "I hadn't considered this but I agree - updated this and in `HTTPRequest::GetQueryParameter`.",
      "commit_id" : "25cd29e6bd368571dd718001e04e4ecf1acf0566",
      "created_at" : "2022-03-01T12:23:29Z",
      "diff_hunk" : "@@ -639,6 +641,39 @@ HTTPRequest::RequestMethod HTTPRequest::GetRequestMethod() const\n     }\n }\n \n+std::optional<std::string> HTTPRequest::GetQueryParameter(const std::string& key) const\n+{\n+    auto uri = evhttp_request_get_uri(req);\n+    auto result = GetQueryParameterFromUri(uri, key);\n+\n+    return result;\n+}\n+\n+std::optional<std::string> GetQueryParameterFromUri(const char* uri, const std::string& key)\n+{\n+    auto uri_parsed = evhttp_uri_parse(uri);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r816721604",
      "id" : 816721604,
      "in_reply_to_id" : 816331148,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584wri7E",
      "original_commit_id" : "b5d8761251eb7d08f8166593190a0eba8e2304af",
      "original_line" : 654,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/httpserver.cpp",
      "position" : null,
      "pull_request_review_id" : 896234865,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816721604/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-01T12:23:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816721604",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r816721799"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816721799"
         }
      },
      "author_association" : "NONE",
      "body" : "Thanks, I wasn't aware of this convention. I've updated this and 3 other zero-inits of `std::string`. I'm still zero-init'ing `size_t blockhash_index {};` as to my understanding `long` doesn't have a default ctor and this could be unsafe otherwise.",
      "commit_id" : "25cd29e6bd368571dd718001e04e4ecf1acf0566",
      "created_at" : "2022-03-01T12:23:47Z",
      "diff_hunk" : "@@ -639,6 +641,39 @@ HTTPRequest::RequestMethod HTTPRequest::GetRequestMethod() const\n     }\n }\n \n+std::optional<std::string> HTTPRequest::GetQueryParameter(const std::string& key) const\n+{\n+    auto uri = evhttp_request_get_uri(req);\n+    auto result = GetQueryParameterFromUri(uri, key);\n+\n+    return result;\n+}\n+\n+std::optional<std::string> GetQueryParameterFromUri(const char* uri, const std::string& key)\n+{\n+    auto uri_parsed = evhttp_uri_parse(uri);\n+    auto query = evhttp_uri_get_query(uri_parsed);\n+    std::optional<std::string> result {};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r816721799",
      "id" : 816721799,
      "in_reply_to_id" : 816336581,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584wri-H",
      "original_commit_id" : "b5d8761251eb7d08f8166593190a0eba8e2304af",
      "original_line" : 656,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/httpserver.cpp",
      "position" : null,
      "pull_request_review_id" : 896235143,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816721799/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-01T12:23:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816721799",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> Left some more review comments, mostly code-style nit-picking though, feel free to ignore. Changes generally LGTM and I think the PR is pretty close to a mergeable state.\r\n\r\nThank you for the thorough review, I've incorporated all of your suggestions. Hoping to get some final ACKs to get this over the line, I agree that it feels like being close to merged ð ",
      "created_at" : "2022-03-01T12:30:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#issuecomment-1055394970",
      "id" : 1055394970,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24098",
      "node_id" : "IC_kwDOABII584-6Aya",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1055394970/reactions"
      },
      "updated_at" : "2022-03-01T12:30:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1055394970",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r816772746"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816772746"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Are you sure this `evhttp_clear_headers()` call is necessary? The `evkeyvalq` struct is destructed immediately after this.",
      "commit_id" : "25cd29e6bd368571dd718001e04e4ecf1acf0566",
      "created_at" : "2022-03-01T13:35:34Z",
      "diff_hunk" : "@@ -639,6 +641,38 @@ HTTPRequest::RequestMethod HTTPRequest::GetRequestMethod() const\n     }\n }\n \n+std::optional<std::string> HTTPRequest::GetQueryParameter(const std::string& key) const\n+{\n+    const char* uri = evhttp_request_get_uri(req);\n+\n+    return GetQueryParameterFromUri(uri, key);\n+}\n+\n+std::optional<std::string> GetQueryParameterFromUri(const char* uri, const std::string& key)\n+{\n+    evhttp_uri* uri_parsed = evhttp_uri_parse(uri);\n+    const char* query = evhttp_uri_get_query(uri_parsed);\n+    std::optional<std::string> result;\n+\n+    if (query) {\n+        // Parse the query string into a key-value queue and iterate over it\n+        struct evkeyvalq params_q;\n+        evhttp_parse_query_str(query, &params_q);\n+\n+        struct evkeyval* param;\n+        for (param = params_q.tqh_first; param; param = param->next.tqe_next) {\n+            if (param->key == key) {\n+                result = param->value;\n+                break;\n+            }\n+        }\n+        evhttp_clear_headers(&params_q);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r816772746",
      "id" : 816772746,
      "line" : 669,
      "node_id" : "PRRC_kwDOABII584wrvaK",
      "original_commit_id" : "25cd29e6bd368571dd718001e04e4ecf1acf0566",
      "original_line" : 669,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/httpserver.cpp",
      "position" : 52,
      "pull_request_review_id" : 896306255,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816772746/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-01T13:47:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816772746",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r816773015"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816773015"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is the `struct` keyword needed here?\r\n\r\n```suggestion\r\n       evkeyvalq params_q;\r\n```",
      "commit_id" : "25cd29e6bd368571dd718001e04e4ecf1acf0566",
      "created_at" : "2022-03-01T13:35:54Z",
      "diff_hunk" : "@@ -639,6 +641,38 @@ HTTPRequest::RequestMethod HTTPRequest::GetRequestMethod() const\n     }\n }\n \n+std::optional<std::string> HTTPRequest::GetQueryParameter(const std::string& key) const\n+{\n+    const char* uri = evhttp_request_get_uri(req);\n+\n+    return GetQueryParameterFromUri(uri, key);\n+}\n+\n+std::optional<std::string> GetQueryParameterFromUri(const char* uri, const std::string& key)\n+{\n+    evhttp_uri* uri_parsed = evhttp_uri_parse(uri);\n+    const char* query = evhttp_uri_get_query(uri_parsed);\n+    std::optional<std::string> result;\n+\n+    if (query) {\n+        // Parse the query string into a key-value queue and iterate over it\n+        struct evkeyvalq params_q;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r816773015",
      "id" : 816773015,
      "line" : 659,
      "node_id" : "PRRC_kwDOABII584wrveX",
      "original_commit_id" : "25cd29e6bd368571dd718001e04e4ecf1acf0566",
      "original_line" : 659,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/httpserver.cpp",
      "position" : 42,
      "pull_request_review_id" : 896306255,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816773015/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-01T13:47:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816773015",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r816776356"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816776356"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'd suggest a couple of changes:\r\n\r\n- put the `param` declaration in the for loop init-statement\r\n- explicitly compare `param` with `nullptr`:\r\n\r\n```suggestion\r\n        for (evkeyval* param{params_q.tqh_first}; param != nullptr; param = param->next.tqe_next) {\r\n```",
      "commit_id" : "25cd29e6bd368571dd718001e04e4ecf1acf0566",
      "created_at" : "2022-03-01T13:39:58Z",
      "diff_hunk" : "@@ -639,6 +641,38 @@ HTTPRequest::RequestMethod HTTPRequest::GetRequestMethod() const\n     }\n }\n \n+std::optional<std::string> HTTPRequest::GetQueryParameter(const std::string& key) const\n+{\n+    const char* uri = evhttp_request_get_uri(req);\n+\n+    return GetQueryParameterFromUri(uri, key);\n+}\n+\n+std::optional<std::string> GetQueryParameterFromUri(const char* uri, const std::string& key)\n+{\n+    evhttp_uri* uri_parsed = evhttp_uri_parse(uri);\n+    const char* query = evhttp_uri_get_query(uri_parsed);\n+    std::optional<std::string> result;\n+\n+    if (query) {\n+        // Parse the query string into a key-value queue and iterate over it\n+        struct evkeyvalq params_q;\n+        evhttp_parse_query_str(query, &params_q);\n+\n+        struct evkeyval* param;\n+        for (param = params_q.tqh_first; param; param = param->next.tqe_next) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r816776356",
      "id" : 816776356,
      "line" : 663,
      "node_id" : "PRRC_kwDOABII584wrwSk",
      "original_commit_id" : "25cd29e6bd368571dd718001e04e4ecf1acf0566",
      "original_line" : 663,
      "original_position" : 46,
      "original_start_line" : 662,
      "path" : "src/httpserver.cpp",
      "position" : 46,
      "pull_request_review_id" : 896306255,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816776356/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 662,
      "start_side" : "RIGHT",
      "updated_at" : "2022-03-01T13:47:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816776356",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r816781335"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816781335"
         }
      },
      "author_association" : "MEMBER",
      "body" : "What do you think about handling the blockhash in the same way as the count:\r\n\r\n```diff\r\n--- a/src/rest.cpp\r\n+++ b/src/rest.cpp\r\n@@ -365,14 +365,14 @@ static bool rest_filter_header(const std::any& context, HTTPRequest* req, const\r\n     std::vector<std::string> uri_parts;\r\n     boost::split(uri_parts, param, boost::is_any_of(\"/\"));\r\n     std::string raw_count;\r\n-    size_t blockhash_index {};\r\n+    std::string raw_blockhash;\r\n     if (uri_parts.size() == 3) {\r\n         // deprecated path: /rest/blockfilterheaders/<filtertype>/<count>/<blockhash>\r\n-        blockhash_index = 2;\r\n+        raw_blockhash = uri_parts[2];\r\n         raw_count = uri_parts[1];\r\n     } else if (uri_parts.size() == 2) {\r\n         // new path with query parameter: /rest/blockfilterheaders/<filtertype>/<blockhash>?count=<count>\r\n-        blockhash_index = 1;\r\n+        raw_blockhash = uri_parts[1];\r\n         raw_count = req->GetQueryParameter(\"count\").value_or(\"5\");\r\n     } else {\r\n         return RESTERR(req, HTTP_BAD_REQUEST, \"Invalid URI format. Expected /rest/blockfilterheaders/<filtertype>/<blockhash>.<ext>?count=<count>\");\r\n@@ -384,8 +384,8 @@ static bool rest_filter_header(const std::any& context, HTTPRequest* req, const\r\n     }\r\n \r\n     uint256 block_hash;\r\n-    if (!ParseHashStr(uri_parts[blockhash_index], block_hash)) {\r\n-        return RESTERR(req, HTTP_BAD_REQUEST, \"Invalid hash: \" + uri_parts[blockhash_index]);\r\n+    if (!ParseHashStr(raw_blockhash, block_hash)) {\r\n+        return RESTERR(req, HTTP_BAD_REQUEST, \"Invalid hash: \" + raw_blockhash);\r\n     }\r\n \r\n     BlockFilterType filtertype;\r\n```",
      "commit_id" : "25cd29e6bd368571dd718001e04e4ecf1acf0566",
      "created_at" : "2022-03-01T13:46:13Z",
      "diff_hunk" : "@@ -351,17 +360,32 @@ static bool rest_filter_header(const std::any& context, HTTPRequest* req, const\n     if (!CheckWarmup(req)) return false;\n \n     std::string param;\n-    const RetFormat rf = ParseDataFormat(param, strURIPart);\n+    const RESTResponseFormat rf = ParseDataFormat(param, strURIPart);\n \n     std::vector<std::string> uri_parts;\n     boost::split(uri_parts, param, boost::is_any_of(\"/\"));\n-    if (uri_parts.size() != 3) {\n-        return RESTERR(req, HTTP_BAD_REQUEST, \"Invalid URI format. Expected /rest/blockfilterheaders/<filtertype>/<count>/<blockhash>\");\n+    std::string raw_count;\n+    size_t blockhash_index {};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r816781335",
      "id" : 816781335,
      "line" : 368,
      "node_id" : "PRRC_kwDOABII584wrxgX",
      "original_commit_id" : "25cd29e6bd368571dd718001e04e4ecf1acf0566",
      "original_line" : 368,
      "original_position" : 196,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : 196,
      "pull_request_review_id" : 896306255,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816781335/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-01T13:47:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816781335",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r816865897"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816865897"
         }
      },
      "author_association" : "NONE",
      "body" : "This confused me too. I don't see how it's necessary to keep it, but that's how libevent [documents](https://libevent.org/doc/http_8h_source.html) it and also how it's already used [everywhere](https://github.com/bitcoin/bitcoin/search?q=evkeyvalq) ([1](https://github.com/bitcoin/bitcoin/blob/767ee2e3a1082468b4e2248bac3ef8bd54bb2ddb/src/httpserver.cpp#L525), [2](https://github.com/bitcoin/bitcoin/blob/767ee2e3a1082468b4e2248bac3ef8bd54bb2ddb/src/httpserver.cpp#L556), [3](https://github.com/bitcoin/bitcoin/blob/3c565302aaa91ae46aa09b8aeb95206711d9d8a6/src/bitcoin-cli.cpp#L766)) in Bitcoin Core, as well as in most (all?) unofficial examples/documentation you can find online. I thought it might be a good idea to keep it to stay in line with libevent conventions. Knowing that, would you still prefer to have it removed? I don't have a strong view either way, but think I prefer sticking with the convention.",
      "commit_id" : "25cd29e6bd368571dd718001e04e4ecf1acf0566",
      "created_at" : "2022-03-01T15:17:00Z",
      "diff_hunk" : "@@ -639,6 +641,38 @@ HTTPRequest::RequestMethod HTTPRequest::GetRequestMethod() const\n     }\n }\n \n+std::optional<std::string> HTTPRequest::GetQueryParameter(const std::string& key) const\n+{\n+    const char* uri = evhttp_request_get_uri(req);\n+\n+    return GetQueryParameterFromUri(uri, key);\n+}\n+\n+std::optional<std::string> GetQueryParameterFromUri(const char* uri, const std::string& key)\n+{\n+    evhttp_uri* uri_parsed = evhttp_uri_parse(uri);\n+    const char* query = evhttp_uri_get_query(uri_parsed);\n+    std::optional<std::string> result;\n+\n+    if (query) {\n+        // Parse the query string into a key-value queue and iterate over it\n+        struct evkeyvalq params_q;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r816865897",
      "id" : 816865897,
      "in_reply_to_id" : 816773015,
      "line" : 659,
      "node_id" : "PRRC_kwDOABII584wsGJp",
      "original_commit_id" : "25cd29e6bd368571dd718001e04e4ecf1acf0566",
      "original_line" : 659,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/httpserver.cpp",
      "position" : 42,
      "pull_request_review_id" : 896438582,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816865897/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-01T15:18:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/816865897",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r817890906"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/817890906"
         }
      },
      "author_association" : "NONE",
      "body" : "As we discussed offline, it looks like it is necessary since `evkeyvalq` is a linked list so we need to make sure that all elements are deleted with `evhttp_clear_headers()`. \r\n\r\nTo my understanding, this is not necessary in e.g. `HTTPRequest::GetHeader()` because we obtain a pointer to `evkeyvalq* headers` where the underlying object is managed by the `evhttp_request* req`, which in turn should properly destroy its associated headers at the end of its lifetime (and not before that). In this case, `evkeyvalq params_q` is managed by `GetQueryParameterFromUri` directly. Does that make sense or am I missing something?",
      "commit_id" : "fe95d30ae4ffd1946823ec3e2d6a59c063d62893",
      "created_at" : "2022-03-02T16:47:10Z",
      "diff_hunk" : "@@ -639,6 +641,38 @@ HTTPRequest::RequestMethod HTTPRequest::GetRequestMethod() const\n     }\n }\n \n+std::optional<std::string> HTTPRequest::GetQueryParameter(const std::string& key) const\n+{\n+    const char* uri = evhttp_request_get_uri(req);\n+\n+    return GetQueryParameterFromUri(uri, key);\n+}\n+\n+std::optional<std::string> GetQueryParameterFromUri(const char* uri, const std::string& key)\n+{\n+    evhttp_uri* uri_parsed = evhttp_uri_parse(uri);\n+    const char* query = evhttp_uri_get_query(uri_parsed);\n+    std::optional<std::string> result;\n+\n+    if (query) {\n+        // Parse the query string into a key-value queue and iterate over it\n+        struct evkeyvalq params_q;\n+        evhttp_parse_query_str(query, &params_q);\n+\n+        struct evkeyval* param;\n+        for (param = params_q.tqh_first; param; param = param->next.tqe_next) {\n+            if (param->key == key) {\n+                result = param->value;\n+                break;\n+            }\n+        }\n+        evhttp_clear_headers(&params_q);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r817890906",
      "id" : 817890906,
      "in_reply_to_id" : 816772746,
      "line" : 668,
      "node_id" : "PRRC_kwDOABII584wwAZa",
      "original_commit_id" : "25cd29e6bd368571dd718001e04e4ecf1acf0566",
      "original_line" : 668,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/httpserver.cpp",
      "position" : 51,
      "pull_request_review_id" : 897856902,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/817890906/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-02T16:47:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/817890906",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r817895375"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/817895375"
         }
      },
      "author_association" : "NONE",
      "body" : "Done - although as per my other [comment](https://github.com/bitcoin/bitcoin/pull/24098#discussion_r816865897) I've kept the `struct` prefix for now to stick with convention.",
      "commit_id" : "fe95d30ae4ffd1946823ec3e2d6a59c063d62893",
      "created_at" : "2022-03-02T16:51:27Z",
      "diff_hunk" : "@@ -639,6 +641,38 @@ HTTPRequest::RequestMethod HTTPRequest::GetRequestMethod() const\n     }\n }\n \n+std::optional<std::string> HTTPRequest::GetQueryParameter(const std::string& key) const\n+{\n+    const char* uri = evhttp_request_get_uri(req);\n+\n+    return GetQueryParameterFromUri(uri, key);\n+}\n+\n+std::optional<std::string> GetQueryParameterFromUri(const char* uri, const std::string& key)\n+{\n+    evhttp_uri* uri_parsed = evhttp_uri_parse(uri);\n+    const char* query = evhttp_uri_get_query(uri_parsed);\n+    std::optional<std::string> result;\n+\n+    if (query) {\n+        // Parse the query string into a key-value queue and iterate over it\n+        struct evkeyvalq params_q;\n+        evhttp_parse_query_str(query, &params_q);\n+\n+        struct evkeyval* param;\n+        for (param = params_q.tqh_first; param; param = param->next.tqe_next) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r817895375",
      "id" : 817895375,
      "in_reply_to_id" : 816776356,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584wwBfP",
      "original_commit_id" : "25cd29e6bd368571dd718001e04e4ecf1acf0566",
      "original_line" : 663,
      "original_position" : 46,
      "original_start_line" : 662,
      "path" : "src/httpserver.cpp",
      "position" : null,
      "pull_request_review_id" : 897862869,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/817895375/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-03-02T16:51:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/817895375",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r822489675"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/822489675"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, that looks correct to me. Thanks for looking into this!",
      "commit_id" : "fe95d30ae4ffd1946823ec3e2d6a59c063d62893",
      "created_at" : "2022-03-09T10:13:19Z",
      "diff_hunk" : "@@ -639,6 +641,38 @@ HTTPRequest::RequestMethod HTTPRequest::GetRequestMethod() const\n     }\n }\n \n+std::optional<std::string> HTTPRequest::GetQueryParameter(const std::string& key) const\n+{\n+    const char* uri = evhttp_request_get_uri(req);\n+\n+    return GetQueryParameterFromUri(uri, key);\n+}\n+\n+std::optional<std::string> GetQueryParameterFromUri(const char* uri, const std::string& key)\n+{\n+    evhttp_uri* uri_parsed = evhttp_uri_parse(uri);\n+    const char* query = evhttp_uri_get_query(uri_parsed);\n+    std::optional<std::string> result;\n+\n+    if (query) {\n+        // Parse the query string into a key-value queue and iterate over it\n+        struct evkeyvalq params_q;\n+        evhttp_parse_query_str(query, &params_q);\n+\n+        struct evkeyval* param;\n+        for (param = params_q.tqh_first; param; param = param->next.tqe_next) {\n+            if (param->key == key) {\n+                result = param->value;\n+                break;\n+            }\n+        }\n+        evhttp_clear_headers(&params_q);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r822489675",
      "id" : 822489675,
      "in_reply_to_id" : 816772746,
      "line" : 668,
      "node_id" : "PRRC_kwDOABII584xBjJL",
      "original_commit_id" : "25cd29e6bd368571dd718001e04e4ecf1acf0566",
      "original_line" : 668,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/httpserver.cpp",
      "position" : 51,
      "pull_request_review_id" : 904139805,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/822489675/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-09T10:13:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/822489675",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r822499972"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/822499972"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ok, I've dug into this a bit more, and it's an [elaborated type specifier](https://en.cppreference.com/w/cpp/language/elaborated_type_specifier). It means that even if we have a local variable named `evkeyvalq`, then this would still compile, since the `struct` class-key would mean the local variable is ignored.\r\n\r\nI think it's fine to leave it.",
      "commit_id" : "fe95d30ae4ffd1946823ec3e2d6a59c063d62893",
      "created_at" : "2022-03-09T10:25:13Z",
      "diff_hunk" : "@@ -639,6 +641,38 @@ HTTPRequest::RequestMethod HTTPRequest::GetRequestMethod() const\n     }\n }\n \n+std::optional<std::string> HTTPRequest::GetQueryParameter(const std::string& key) const\n+{\n+    const char* uri = evhttp_request_get_uri(req);\n+\n+    return GetQueryParameterFromUri(uri, key);\n+}\n+\n+std::optional<std::string> GetQueryParameterFromUri(const char* uri, const std::string& key)\n+{\n+    evhttp_uri* uri_parsed = evhttp_uri_parse(uri);\n+    const char* query = evhttp_uri_get_query(uri_parsed);\n+    std::optional<std::string> result;\n+\n+    if (query) {\n+        // Parse the query string into a key-value queue and iterate over it\n+        struct evkeyvalq params_q;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r822499972",
      "id" : 822499972,
      "in_reply_to_id" : 816773015,
      "line" : 659,
      "node_id" : "PRRC_kwDOABII584xBlqE",
      "original_commit_id" : "25cd29e6bd368571dd718001e04e4ecf1acf0566",
      "original_line" : 659,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/httpserver.cpp",
      "position" : 42,
      "pull_request_review_id" : 904153768,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/822499972/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-09T10:25:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/822499972",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r822504648"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/822504648"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sorry to nitpick, but the normal style is to not put spaces around braces when using braced initialization:\r\n\r\n```suggestion\r\n        for (struct evkeyval* param{params_q.tqh_first}; param != nullptr; param = param->next.tqe_next) {\r\n```",
      "commit_id" : "fe95d30ae4ffd1946823ec3e2d6a59c063d62893",
      "created_at" : "2022-03-09T10:30:39Z",
      "diff_hunk" : "@@ -639,6 +641,37 @@ HTTPRequest::RequestMethod HTTPRequest::GetRequestMethod() const\n     }\n }\n \n+std::optional<std::string> HTTPRequest::GetQueryParameter(const std::string& key) const\n+{\n+    const char* uri = evhttp_request_get_uri(req);\n+\n+    return GetQueryParameterFromUri(uri, key);\n+}\n+\n+std::optional<std::string> GetQueryParameterFromUri(const char* uri, const std::string& key)\n+{\n+    evhttp_uri* uri_parsed = evhttp_uri_parse(uri);\n+    const char* query = evhttp_uri_get_query(uri_parsed);\n+    std::optional<std::string> result;\n+\n+    if (query) {\n+        // Parse the query string into a key-value queue and iterate over it\n+        struct evkeyvalq params_q;\n+        evhttp_parse_query_str(query, &params_q);\n+\n+        for (struct evkeyval* param { params_q.tqh_first }; param != nullptr; param = param->next.tqe_next) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r822504648",
      "id" : 822504648,
      "line" : 662,
      "node_id" : "PRRC_kwDOABII584xBmzI",
      "original_commit_id" : "fe95d30ae4ffd1946823ec3e2d6a59c063d62893",
      "original_line" : 662,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/httpserver.cpp",
      "position" : 45,
      "pull_request_review_id" : 904160333,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/822504648/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-09T12:00:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/822504648",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r822575408"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/822575408"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You remove the `static` keyword in commit 2c84d3916b7 (*Handle query string when parsing data format*), but it should be removed in the earlier commit 1cc759af21 (*Refactoring: move declarations to rest.h*) at the same time that you add the `ParseDataFormat` declaration to rest.h. Without removing that keyword, the commit fails to compile with:\r\n\r\n```\r\nrest.cpp:136:18: error: âRetFormat ParseDataFormat(std::string&, const string&)â was declared âexternâ and later âstaticâ [-fpermissive]\r\n  136 | static RetFormat ParseDataFormat(std::string& param, const std::string& strReq)\r\n      |                  ^~~~~~~~~~~~~~~\r\nIn file included from rest.cpp:6:\r\n./rest.h:17:11: note: previous declaration of âRetFormat ParseDataFormat(std::string&, const string&)â\r\n   17 | RetFormat ParseDataFormat(std::string& param, const std::string& strReq);\r\n      |           ^~~~~~~~~~~~~~~\r\n```",
      "commit_id" : "fe95d30ae4ffd1946823ec3e2d6a59c063d62893",
      "created_at" : "2022-03-09T12:00:02Z",
      "diff_hunk" : "@@ -137,25 +133,28 @@ static ChainstateManager* GetChainman(const std::any& context, HTTPRequest* req)\n     return node_context->chainman.get();\n }\n \n-static RetFormat ParseDataFormat(std::string& param, const std::string& strReq)\n+RESTResponseFormat ParseDataFormat(std::string& param, const std::string& strReq)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r822575408",
      "id" : 822575408,
      "line" : 136,
      "node_id" : "PRRC_kwDOABII584xB4Ew",
      "original_commit_id" : "fe95d30ae4ffd1946823ec3e2d6a59c063d62893",
      "original_line" : 136,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : 49,
      "pull_request_review_id" : 904160333,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/822575408/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-09T12:00:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/822575408",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r822900408"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/822900408"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is there a reason you've changed `parsed_count` from using braced initialization to using `=` initialization?",
      "commit_id" : "fe95d30ae4ffd1946823ec3e2d6a59c063d62893",
      "created_at" : "2022-03-09T17:24:11Z",
      "diff_hunk" : "@@ -191,19 +190,29 @@ static bool rest_headers(const std::any& context,\n     if (!CheckWarmup(req))\n         return false;\n     std::string param;\n-    const RetFormat rf = ParseDataFormat(param, strURIPart);\n+    const RESTResponseFormat rf = ParseDataFormat(param, strURIPart);\n     std::vector<std::string> path;\n     boost::split(path, param, boost::is_any_of(\"/\"));\n \n-    if (path.size() != 2)\n-        return RESTERR(req, HTTP_BAD_REQUEST, \"No header count specified. Use /rest/headers/<count>/<hash>.<ext>.\");\n-\n-    const auto parsed_count{ToIntegral<size_t>(path[0])};\n+    std::string raw_count;\n+    std::string hashStr;\n+    if (path.size() == 2) {\n+        // deprecated path: /rest/headers/<count>/<hash>\n+        hashStr = path[1];\n+        raw_count = path[0];\n+    } else if (path.size() == 1) {\n+        // new path with query parameter: /rest/headers/<hash>?count=<count>\n+        hashStr = path[0];\n+        raw_count = req->GetQueryParameter(\"count\").value_or(\"5\");\n+    } else {\n+        return RESTERR(req, HTTP_BAD_REQUEST, \"Invalid URI format. Expected /rest/headers/<hash>.<ext>?count=<count>\");\n+    }\n+\n+    const auto parsed_count = ToIntegral<size_t>(raw_count);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r822900408",
      "id" : 822900408,
      "line" : 211,
      "node_id" : "PRRC_kwDOABII584xDHa4",
      "original_commit_id" : "fe95d30ae4ffd1946823ec3e2d6a59c063d62893",
      "original_line" : 211,
      "original_position" : 111,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : 111,
      "pull_request_review_id" : 904722602,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/822900408/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-09T17:37:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/822900408",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r822901859"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/822901859"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same question about changing from braced initialization to `=` initialization.",
      "commit_id" : "fe95d30ae4ffd1946823ec3e2d6a59c063d62893",
      "created_at" : "2022-03-09T17:25:42Z",
      "diff_hunk" : "@@ -351,17 +360,32 @@ static bool rest_filter_header(const std::any& context, HTTPRequest* req, const\n     if (!CheckWarmup(req)) return false;\n \n     std::string param;\n-    const RetFormat rf = ParseDataFormat(param, strURIPart);\n+    const RESTResponseFormat rf = ParseDataFormat(param, strURIPart);\n \n     std::vector<std::string> uri_parts;\n     boost::split(uri_parts, param, boost::is_any_of(\"/\"));\n-    if (uri_parts.size() != 3) {\n-        return RESTERR(req, HTTP_BAD_REQUEST, \"Invalid URI format. Expected /rest/blockfilterheaders/<filtertype>/<count>/<blockhash>\");\n+    std::string raw_count;\n+    std::string raw_blockhash;\n+    if (uri_parts.size() == 3) {\n+        // deprecated path: /rest/blockfilterheaders/<filtertype>/<count>/<blockhash>\n+        raw_blockhash = uri_parts[2];\n+        raw_count = uri_parts[1];\n+    } else if (uri_parts.size() == 2) {\n+        // new path with query parameter: /rest/blockfilterheaders/<filtertype>/<blockhash>?count=<count>\n+        raw_blockhash = uri_parts[1];\n+        raw_count = req->GetQueryParameter(\"count\").value_or(\"5\");\n+    } else {\n+        return RESTERR(req, HTTP_BAD_REQUEST, \"Invalid URI format. Expected /rest/blockfilterheaders/<filtertype>/<blockhash>.<ext>?count=<count>\");\n+    }\n+\n+    const auto parsed_count = ToIntegral<size_t>(raw_count);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r822901859",
      "id" : 822901859,
      "line" : 381,
      "node_id" : "PRRC_kwDOABII584xDHxj",
      "original_commit_id" : "fe95d30ae4ffd1946823ec3e2d6a59c063d62893",
      "original_line" : 381,
      "original_position" : 209,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : 209,
      "pull_request_review_id" : 904722602,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/822901859/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-09T17:37:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/822901859",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r823624098"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/823624098"
         }
      },
      "author_association" : "NONE",
      "body" : "Fixed, wasn't aware of this convention, thanks. I really do appreciate the nits, consistent style is important.",
      "commit_id" : "9aac4381897130ce630c4c3f5fca6690cd148330",
      "created_at" : "2022-03-10T11:32:21Z",
      "diff_hunk" : "@@ -639,6 +641,37 @@ HTTPRequest::RequestMethod HTTPRequest::GetRequestMethod() const\n     }\n }\n \n+std::optional<std::string> HTTPRequest::GetQueryParameter(const std::string& key) const\n+{\n+    const char* uri = evhttp_request_get_uri(req);\n+\n+    return GetQueryParameterFromUri(uri, key);\n+}\n+\n+std::optional<std::string> GetQueryParameterFromUri(const char* uri, const std::string& key)\n+{\n+    evhttp_uri* uri_parsed = evhttp_uri_parse(uri);\n+    const char* query = evhttp_uri_get_query(uri_parsed);\n+    std::optional<std::string> result;\n+\n+    if (query) {\n+        // Parse the query string into a key-value queue and iterate over it\n+        struct evkeyvalq params_q;\n+        evhttp_parse_query_str(query, &params_q);\n+\n+        for (struct evkeyval* param { params_q.tqh_first }; param != nullptr; param = param->next.tqe_next) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r823624098",
      "id" : 823624098,
      "in_reply_to_id" : 822504648,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584xF4Gi",
      "original_commit_id" : "fe95d30ae4ffd1946823ec3e2d6a59c063d62893",
      "original_line" : 662,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/httpserver.cpp",
      "position" : null,
      "pull_request_review_id" : 905698942,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/823624098/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-10T11:32:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/823624098",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r823625941"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/823625941"
         }
      },
      "author_association" : "NONE",
      "body" : "Yikes, this shouldn't have happened, thanks for catching that. I've adapted [this](https://blog.ploeh.dk/2013/10/07/verifying-every-single-commit-in-a-git-branch/) script to ensure all commits in the branch build:\r\n\r\n```sh\r\nBRANCH=$(git rev-parse --abbrev-ref HEAD)\r\nCOMMITS=$(git log master..$BRANCH --oneline  --reverse | cut -d \" \" -f 1)\r\n\r\nfor COMMIT in $COMMITS\r\ndo\r\n  git -c advice.detachedHead=false checkout $COMMIT > /dev/null\r\n  make -j \"$(($(sysctl -n hw.physicalcpu)+1))\" > /dev/null  # on linux, use: make -j \"$(($(nproc)+1))\" > /dev/null\r\n  if [ $? -eq 0 ]\r\n  then\r\n        echo $COMMIT - passed\r\n    else\r\n        echo $COMMIT - failed\r\n        git checkout $BRANCH\r\n        exit\r\n    fi\r\ndone\r\necho all commits on $BRANCH built successfully\r\n\r\ngit checkout $BRANCH\r\n```",
      "commit_id" : "9aac4381897130ce630c4c3f5fca6690cd148330",
      "created_at" : "2022-03-10T11:34:52Z",
      "diff_hunk" : "@@ -137,25 +133,28 @@ static ChainstateManager* GetChainman(const std::any& context, HTTPRequest* req)\n     return node_context->chainman.get();\n }\n \n-static RetFormat ParseDataFormat(std::string& param, const std::string& strReq)\n+RESTResponseFormat ParseDataFormat(std::string& param, const std::string& strReq)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r823625941",
      "id" : 823625941,
      "in_reply_to_id" : 822575408,
      "line" : 136,
      "node_id" : "PRRC_kwDOABII584xF4jV",
      "original_commit_id" : "fe95d30ae4ffd1946823ec3e2d6a59c063d62893",
      "original_line" : 136,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : 49,
      "pull_request_review_id" : 905701564,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/823625941/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-10T11:34:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/823625941",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r823626022"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/823626022"
         }
      },
      "author_association" : "NONE",
      "body" : "I don't think this was an intentional change. I've changed both `parsed_count` definitions to use brace initialization.  I've also updated all other new/modified `=` initializations I could find to use brace initialization. Specifically, this is in `ParseDataFormat`, `HTTPRequest::GetQueryParameter` and `GetQueryParameterFromUri`",
      "commit_id" : "9aac4381897130ce630c4c3f5fca6690cd148330",
      "created_at" : "2022-03-10T11:35:00Z",
      "diff_hunk" : "@@ -191,19 +190,29 @@ static bool rest_headers(const std::any& context,\n     if (!CheckWarmup(req))\n         return false;\n     std::string param;\n-    const RetFormat rf = ParseDataFormat(param, strURIPart);\n+    const RESTResponseFormat rf = ParseDataFormat(param, strURIPart);\n     std::vector<std::string> path;\n     boost::split(path, param, boost::is_any_of(\"/\"));\n \n-    if (path.size() != 2)\n-        return RESTERR(req, HTTP_BAD_REQUEST, \"No header count specified. Use /rest/headers/<count>/<hash>.<ext>.\");\n-\n-    const auto parsed_count{ToIntegral<size_t>(path[0])};\n+    std::string raw_count;\n+    std::string hashStr;\n+    if (path.size() == 2) {\n+        // deprecated path: /rest/headers/<count>/<hash>\n+        hashStr = path[1];\n+        raw_count = path[0];\n+    } else if (path.size() == 1) {\n+        // new path with query parameter: /rest/headers/<hash>?count=<count>\n+        hashStr = path[0];\n+        raw_count = req->GetQueryParameter(\"count\").value_or(\"5\");\n+    } else {\n+        return RESTERR(req, HTTP_BAD_REQUEST, \"Invalid URI format. Expected /rest/headers/<hash>.<ext>?count=<count>\");\n+    }\n+\n+    const auto parsed_count = ToIntegral<size_t>(raw_count);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r823626022",
      "id" : 823626022,
      "in_reply_to_id" : 822900408,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584xF4km",
      "original_commit_id" : "fe95d30ae4ffd1946823ec3e2d6a59c063d62893",
      "original_line" : 211,
      "original_position" : 111,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : null,
      "pull_request_review_id" : 905701678,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/823626022/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-10T11:35:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/823626022",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r823626113"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/823626113"
         }
      },
      "author_association" : "NONE",
      "body" : "Fixed",
      "commit_id" : "9aac4381897130ce630c4c3f5fca6690cd148330",
      "created_at" : "2022-03-10T11:35:07Z",
      "diff_hunk" : "@@ -351,17 +360,32 @@ static bool rest_filter_header(const std::any& context, HTTPRequest* req, const\n     if (!CheckWarmup(req)) return false;\n \n     std::string param;\n-    const RetFormat rf = ParseDataFormat(param, strURIPart);\n+    const RESTResponseFormat rf = ParseDataFormat(param, strURIPart);\n \n     std::vector<std::string> uri_parts;\n     boost::split(uri_parts, param, boost::is_any_of(\"/\"));\n-    if (uri_parts.size() != 3) {\n-        return RESTERR(req, HTTP_BAD_REQUEST, \"Invalid URI format. Expected /rest/blockfilterheaders/<filtertype>/<count>/<blockhash>\");\n+    std::string raw_count;\n+    std::string raw_blockhash;\n+    if (uri_parts.size() == 3) {\n+        // deprecated path: /rest/blockfilterheaders/<filtertype>/<count>/<blockhash>\n+        raw_blockhash = uri_parts[2];\n+        raw_count = uri_parts[1];\n+    } else if (uri_parts.size() == 2) {\n+        // new path with query parameter: /rest/blockfilterheaders/<filtertype>/<blockhash>?count=<count>\n+        raw_blockhash = uri_parts[1];\n+        raw_count = req->GetQueryParameter(\"count\").value_or(\"5\");\n+    } else {\n+        return RESTERR(req, HTTP_BAD_REQUEST, \"Invalid URI format. Expected /rest/blockfilterheaders/<filtertype>/<blockhash>.<ext>?count=<count>\");\n+    }\n+\n+    const auto parsed_count = ToIntegral<size_t>(raw_count);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r823626113",
      "id" : 823626113,
      "in_reply_to_id" : 822901859,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584xF4mB",
      "original_commit_id" : "fe95d30ae4ffd1946823ec3e2d6a59c063d62893",
      "original_line" : 381,
      "original_position" : 209,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : null,
      "pull_request_review_id" : 905701803,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/823626113/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-10T11:35:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/823626113",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Force pushed from fe95d30 to 9aac438 to address jnewbery's comments, namely [not each commit being able to compile](https://github.com/bitcoin/bitcoin/pull/24098#discussion_r822575408) and several style updates regarding spaces and brace initialization. There are no functional/behaviour changes.\r\n\r\nThe range-diff (`git range-diff 219d728 fe95d30 9aac438`) is a bit noisy unfortunately, you can also compare the commits individually:\r\n```\r\ngit diff 1cc759af212c91807735e6c9bc2c998468c7252a..9f1c54787c81177dd56a31c881a9ad2834a122dc\r\ngit diff 40830ae7ea72c6ac6082bbfd30d26d1f749c46df..c1aad1b3b95b7c6bdf05e0c2095aba2f2db8310b\r\ngit diff 2c84d3916b710fbf6029858acff941549e875cb7..fff771ee864975cee8c831651239bac95503c37a\r\ngit diff ac3c007a393d3493ad9023c71d4ed3c38a8baabd..a09497614e9bb603fff36286d9611a25b23eeb02\r\ngit diff f610294c449aefc4bdae9175292fedbe5dd1d5f5..46af138c216d5fa7ac512a42c8219706e97d88fa\r\ngit diff fe95d30ae4ffd1946823ec3e2d6a59c063d62893..9aac4381897130ce630c4c3f5fca6690cd148330\r\n```",
      "created_at" : "2022-03-10T11:41:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#issuecomment-1063966673",
      "id" : 1063966673,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24098",
      "node_id" : "IC_kwDOABII584_atfR",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1063966673/reactions"
      },
      "updated_at" : "2022-03-10T11:41:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1063966673",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r823635542"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/823635542"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You don't need a script for that. It is built-in to git already, see https://github.com/bitcoin/bitcoin/blob/master/doc/productivity.md#interactive-dummy-rebases-for-fixups-and-execs-with-git-merge-base \r\n\r\n",
      "commit_id" : "9aac4381897130ce630c4c3f5fca6690cd148330",
      "created_at" : "2022-03-10T11:47:55Z",
      "diff_hunk" : "@@ -137,25 +133,28 @@ static ChainstateManager* GetChainman(const std::any& context, HTTPRequest* req)\n     return node_context->chainman.get();\n }\n \n-static RetFormat ParseDataFormat(std::string& param, const std::string& strReq)\n+RESTResponseFormat ParseDataFormat(std::string& param, const std::string& strReq)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r823635542",
      "id" : 823635542,
      "in_reply_to_id" : 822575408,
      "line" : 136,
      "node_id" : "PRRC_kwDOABII584xF65W",
      "original_commit_id" : "fe95d30ae4ffd1946823ec3e2d6a59c063d62893",
      "original_line" : 136,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : 49,
      "pull_request_review_id" : 905715195,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 1,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/823635542/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-10T11:47:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/823635542",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r830537947"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/830537947"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "FWIW, I agree with @promag that this would be more properly following REST best practices, which seems to be the main point of this PR.\r\n\r\nDo I understand correctly that you want to keep maintaining the old structure, this structure and then also future structures like suggested above @stickies-v ? That does seem more laborious than necessary to me. You could merge these first parts of changes as intermediary steps and then add follow-ups but I would not \"officially\" support it by adding it to docs and release notes yet. You could make the follow-up changes and only afterwards add documentation and release notes when everything is final, so that there are at least only two versions to maintain and not one per follow-up PR since without docs and release notes it can be reasonably assumed that nobody is building a client on top of the intermediary version. \r\n\r\nAlternatively if you really want to include docs I would suggest in this intermediate step instead of marking the old structure as deprecated, add the new structure marked as experimental and add a comment that it is still object to change.",
      "commit_id" : "9aac4381897130ce630c4c3f5fca6690cd148330",
      "created_at" : "2022-03-19T23:25:03Z",
      "diff_hunk" : "@@ -47,18 +47,24 @@ The HTTP request and response are both handled entirely in-memory.\n With the /notxdetails/ option JSON response will only contain the transaction hash instead of the complete transaction details. The option only affects the JSON response.\n \n #### Blockheaders\n-`GET /rest/headers/<COUNT>/<BLOCK-HASH>.<bin|hex|json>`\n+`GET /rest/headers/<BLOCK-HASH>.<bin|hex|json>?count=<COUNT=5>`",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r830537947",
      "id" : 830537947,
      "in_reply_to_id" : 790336549,
      "line" : 50,
      "node_id" : "PRRC_kwDOABII584xgQDb",
      "original_commit_id" : "0415aaafb2f7206c117f58cc7a4a967cee0fa619",
      "original_line" : 50,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "doc/REST-interface.md",
      "position" : 5,
      "pull_request_review_id" : 915042393,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/830537947/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-19T23:26:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/830537947",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK 9aac4381897130ce630c4c3f5fca6690cd148330\r\n\r\nTested range-diff and that all commits build.",
      "created_at" : "2022-03-30T10:15:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#issuecomment-1082897344",
      "id" : 1082897344,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24098",
      "node_id" : "IC_kwDOABII585Ai7PA",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1082897344/reactions"
      },
      "updated_at" : "2022-03-30T10:15:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1082897344",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r843092709"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/843092709"
         }
      },
      "author_association" : "NONE",
      "body" : "I think your approach makes a lot of sense, fjahr. However, since there has already been significant review time spent on this and this PR seems ready for merge, I don't think this is big enough of a problem to ask for another round of review. Even if it's not a huge update, it still would touch quite a few commits (dropping release notes, modifying REST interface docs, updating error return messages and inline docs). I'll definitely consider the approach you suggest for further PRs because I think it is a more careful approach, but for now I'd prefer to leave things as they are and move forward.",
      "commit_id" : "54b39cfb342d10a448d49299c715e3a25c2aca4a",
      "created_at" : "2022-04-05T17:31:56Z",
      "diff_hunk" : "@@ -47,18 +47,24 @@ The HTTP request and response are both handled entirely in-memory.\n With the /notxdetails/ option JSON response will only contain the transaction hash instead of the complete transaction details. The option only affects the JSON response.\n \n #### Blockheaders\n-`GET /rest/headers/<COUNT>/<BLOCK-HASH>.<bin|hex|json>`\n+`GET /rest/headers/<BLOCK-HASH>.<bin|hex|json>?count=<COUNT=5>`",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#discussion_r843092709",
      "id" : 843092709,
      "in_reply_to_id" : 790336549,
      "line" : 50,
      "node_id" : "PRRC_kwDOABII584yQJLl",
      "original_commit_id" : "0415aaafb2f7206c117f58cc7a4a967cee0fa619",
      "original_line" : 50,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "doc/REST-interface.md",
      "position" : 5,
      "pull_request_review_id" : 932272508,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24098",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/843092709/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-05T17:31:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/843092709",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I've had to push a tiny doc update to `REST-interface.md` (`git range-diff 219d728 9aac438 54b39cf`) since this was not merged for v23, but since there are no significant changes beyond theStack and jnewbery's ACKs I think this PR is now ready to be considered for merging? @MarcoFalke \r\n\r\n<details>\r\n    <summary>git range-diff 219d728 9aac438 54b39cf</summary>\r\n\r\n```\r\n1:  9f1c54787 = 1:  9f1c54787 Refactoring: move declarations to rest.h\r\n2:  c1aad1b3b = 2:  c1aad1b3b scripted-diff: rename RetFormat to RESTResponseFormat\r\n3:  fff771ee8 = 3:  fff771ee8 Handle query string when parsing data format\r\n4:  a09497614 = 4:  a09497614 Add GetQueryParameter helper function\r\n5:  46af138c2 ! 5:  f959fc039 Update /<count>/ endpoints to use a '?count=' query parameter instead\r\n    @@ doc/REST-interface.md: The HTTP request and response are both handled entirely i\r\n      Given a block hash: returns <COUNT> amount of blockheaders in upward direction.\r\n      Returns empty if the block doesn't exist or it isn't in the active chain.\r\n      \r\n    -+*Deprecated (but not removed) since 23.0:*\r\n    ++*Deprecated (but not removed) since 24.0:*\r\n     +`GET /rest/headers/<COUNT>/<BLOCK-HASH>.<bin|hex|json>`\r\n     +\r\n      #### Blockfilter Headers\r\n    @@ doc/REST-interface.md: The HTTP request and response are both handled entirely i\r\n      direction for the filter type <FILTERTYPE>.\r\n      Returns empty if the block doesn't exist or it isn't in the active chain.\r\n      \r\n    -+*Deprecated (but not removed) since 23.0:*\r\n    ++*Deprecated (but not removed) since 24.0:*\r\n     +`GET /rest/blockfilterheaders/<FILTERTYPE>/<COUNT>/<BLOCK-HASH>.<bin|hex|json>`\r\n     +\r\n      #### Blockfilters\r\n6:  9aac43818 = 6:  54b39cfb3 Add release notes\r\n```\r\n</details>",
      "created_at" : "2022-04-05T17:33:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24098#issuecomment-1089092771",
      "id" : 1089092771,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24098",
      "node_id" : "IC_kwDOABII585A6jyj",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1089092771/reactions"
      },
      "updated_at" : "2022-04-05T17:33:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1089092771",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   }
]
