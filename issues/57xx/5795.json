{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "I'm building Bitcoin from source and trying to track down a strange test failure. When I run `make check`, `test_bitcoin` crashes with a segmentation fault. But if I actually run it in `gdb` then it completes normally and passes!\n\nHere is a backtrace from the core file:\n\n```\n[error@buildserver2 src]$ ./test/test_bitcoin \nRunning 133 test cases...\nSegmentation fault (core dumped)\n[error@buildserver2 src]$ file core.8246 \ncore.8246: ELF 32-bit LSB core file ARM, version 1 (SYSV), SVR4-style, from './test/test_bitcoin'\n[error@buildserver2 src]$ gdb ./test/test_bitcoin core.8246 \nGNU gdb (GDB) Fedora 7.8.2-38.fc21\nCopyright (C) 2014 Free Software Foundation, Inc.\nLicense GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.  Type \"show copying\"\nand \"show warranty\" for details.\nThis GDB was configured as \"armv7hl-redhat-linux-gnueabi\".\nType \"show configuration\" for configuration details.\nFor bug reporting instructions, please see:\n<http://www.gnu.org/software/gdb/bugs/>.\nFind the GDB manual and other documentation resources online at:\n<http://www.gnu.org/software/gdb/documentation/>.\nFor help, type \"help\".\nType \"apropos word\" to search for commands related to \"word\"...\nReading symbols from ./test/test_bitcoin...done.\n[New LWP 8247]\n[New LWP 8248]\n[New LWP 8246]\n[Thread debugging using libthread_db enabled]\nUsing host libthread_db library \"/lib/libthread_db.so.1\".\nCore was generated by `./test/test_bitcoin'.\nProgram terminated with signal SIGSEGV, Segmentation fault.\n#0  0x00000000 in ?? ()\nMissing separate debuginfos, use: debuginfo-install boost-chrono-1.55.0-8.fc21.armv7hl boost-filesystem-1.55.0-8.fc21.armv7hl boost-program-options-1.55.0-8.fc21.armv7hl boost-system-1.55.0-8.fc21.armv7hl boost-test-1.55.0-8.fc21.armv7hl boost-thread-1.55.0-8.fc21.armv7hl glibc-2.20-7.fc21.armv7hl keyutils-libs-1.5.9-4.fc21.armv7hl krb5-libs-1.12.2-9.fc21.armv7hl libcom_err-1.42.12-1.fc21.armv7hl libdb4-cxx-4.8.30-16.fc21.armv7hl libgcc-4.9.2-1.fc21.armv7hl libselinux-2.3-5.fc21.armv7hl libstdc++-4.9.2-1.fc21.armv7hl miniupnpc-1.9-4.fc21.armv7hl openssl-compat-bitcoin-libs-1.0.1k-1.fc21.armv7hl pcre-8.35-8.fc21.armv7hl xz-libs-5.1.2-14alpha.fc21.armv7hl zlib-1.2.8-7.fc21.armv7hl\n(gdb) thread apply all bt\n\nThread 3 (Thread 0xb5f1a000 (LWP 8246)):\n#0  0xb6507ee4 in BN_rshift1 ()\n   from /opt/openssl-compat-bitcoin/lib/libcrypto.so.10\n#1  0xb650a274 in BN_mod_inverse ()\n   from /opt/openssl-compat-bitcoin/lib/libcrypto.so.10\n#2  0xb6516698 in ec_GFp_simple_points_make_affine ()\n   from /opt/openssl-compat-bitcoin/lib/libcrypto.so.10\n#3  0xb65183f4 in ec_wNAF_mul ()\n   from /opt/openssl-compat-bitcoin/lib/libcrypto.so.10\n#4  0xb651408c in EC_POINT_mul ()\n   from /opt/openssl-compat-bitcoin/lib/libcrypto.so.10\n#5  0xb652e268 in ?? () from /opt/openssl-compat-bitcoin/lib/libcrypto.so.10\n#6  0xb652f020 in ECDSA_verify ()\n   from /opt/openssl-compat-bitcoin/lib/libcrypto.so.10\n#7  0xb6c68b78 in CECKey::Verify (this=this@entry=0xbeab0fc8, hash=..., \n    vchSig=std::vector of length 70, capacity 70 = {...}) at ecwrapper.cpp:145\n#8  0xb6c571f4 in CPubKey::Verify (this=this@entry=0xbeab1038, hash=..., \n    vchSig=std::vector of length 70, capacity 70 = {...}) at pubkey.cpp:25\n#9  0xb6b1e84c in CAlert::CheckSignature (this=this@entry=0xbeab13d0)\n    at alert.cpp:151\n#10 0xb6b1f0f0 in CAlert::ProcessAlert (this=this@entry=0xbeab13d0, \n    fThread=fThread@entry=false) at alert.cpp:174\n#11 0xb698e4d0 in Alert_tests::AlertNotify::test_method (\n    this=this@entry=0xbeab15e0) at test/alert_tests.cpp:167\n#12 0xb699152c in Alert_tests::AlertNotify_invoker ()\n    at test/alert_tests.cpp:157\n#13 0xb6992214 in invoke<void (*)()> (this=<optimized out>, f=<optimized out>)\n    at /usr/include/boost/test/utils/callback.hpp:56\n#14 boost::unit_test::ut_detail::callback0_impl_t<boost::unit_test::ut_detail::unused, void (*)()>::invoke (this=<optimized out>)\n    at /usr/include/boost/test/utils/callback.hpp:89\n#15 0xb682e6a0 in boost::unit_test::ut_detail::callback0_impl_t<int, boost::unit_test::(anonymous namespace)::zero_return_wrapper_t<boost::unit_test::callback0<boost::unit_test::ut_detail::unused> > >::invoke() ()\n   from /lib/libboost_unit_test_framework.so.1.55.0\n#16 0xb68069bc in boost::execution_monitor::catch_signals(boost::unit_test::callback0<int> const&) () from /lib/libboost_unit_test_framework.so.1.55.0\n#17 0xb6807264 in boost::execution_monitor::execute(boost::unit_test::callback0<int> const&) () from /lib/libboost_unit_test_framework.so.1.55.0\n#18 0xb682e7bc in boost::unit_test::unit_test_monitor_t::execute_and_translate(boost::unit_test::test_case const&) ()\n   from /lib/libboost_unit_test_framework.so.1.55.0\n#19 0xb6815dd4 in boost::unit_test::framework_impl::visit(boost::unit_test::test_case const&) () from /lib/libboost_unit_test_framework.so.1.55.0\n#20 0xb6847614 in boost::unit_test::traverse_test_tree(boost::unit_test::test_suite const&, boost::unit_test::test_tree_visitor&) ()\n   from /lib/libboost_unit_test_framework.so.1.55.0\n#21 0xb6847614 in boost::unit_test::traverse_test_tree(boost::unit_test::test_suite const&, boost::unit_test::test_tree_visitor&) ()\n   from /lib/libboost_unit_test_framework.so.1.55.0\n#22 0xb68121bc in boost::unit_test::framework::run(unsigned long, bool) ()\n   from /lib/libboost_unit_test_framework.so.1.55.0\n#23 0xb682cb70 in boost::unit_test::unit_test_main(bool (*)(), int, char**) ()\n   from /lib/libboost_unit_test_framework.so.1.55.0\n#24 0xb61ac4fc in __libc_start_main () from /lib/libc.so.6\n#25 0xb698a928 in _start ()\n\nThread 2 (Thread 0xaf95a3c0 (LWP 8248)):\n#0  0xb62eeb70 in pthread_cond_wait@@GLIBC_2.4 () from /lib/libpthread.so.0\n#1  0xb6a78d3c in boost::condition_variable::wait (\n    this=0xb6f891c0 <scriptcheckqueue+24>, m=...)\n    at /usr/include/boost/thread/pthread/condition_variable.hpp:73\n#2  0xb6b765bc in CCheckQueue<CScriptCheck>::Loop (\n    this=0xb6f891a8 <scriptcheckqueue>, fMaster=<optimized out>)\n    at checkqueue.h:102\n#3  0xb687bef0 in thread_proxy () from /lib/libboost_thread.so.1.55.0\n#4  0xb62e8f4c in start_thread () from /lib/libpthread.so.0\n#5  0xb62774a0 in ?? () from /lib/libc.so.6\nBacktrace stopped: previous frame identical to this frame (corrupt stack?)\n\nThread 1 (Thread 0xb015a3c0 (LWP 8247)):\n#0  0x00000000 in ?? ()\nBacktrace stopped: previous frame identical to this frame (corrupt stack?)\n(gdb) \n```\n\nAnd here is the debugger running `test_bitcoin` with no problems:\n\n```\n[error@buildserver2 src]$ gdb ./test/test_bitcoin \nGNU gdb (GDB) Fedora 7.8.2-38.fc21\nCopyright (C) 2014 Free Software Foundation, Inc.\nLicense GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.  Type \"show copying\"\nand \"show warranty\" for details.\nThis GDB was configured as \"armv7hl-redhat-linux-gnueabi\".\nType \"show configuration\" for configuration details.\nFor bug reporting instructions, please see:\n<http://www.gnu.org/software/gdb/bugs/>.\nFind the GDB manual and other documentation resources online at:\n<http://www.gnu.org/software/gdb/documentation/>.\nFor help, type \"help\".\nType \"apropos word\" to search for commands related to \"word\"...\nReading symbols from ./test/test_bitcoin...done.\n(gdb) run\nStarting program: /home/error/bitcoin-0.10.0/src/test/test_bitcoin \nMissing separate debuginfos, use: debuginfo-install glibc-2.20-7.fc21.armv7hl\n[Thread debugging using libthread_db enabled]\nUsing host libthread_db library \"/lib/libthread_db.so.1\".\n[New Thread 0xb08073c0 (LWP 8346)]\n[New Thread 0xb00073c0 (LWP 8347)]\nRunning 133 test cases...\nDetaching after fork from child process 8348.\nDetaching after fork from child process 8349.\nDetaching after fork from child process 8350.\nDetaching after fork from child process 8351.\n[New Thread 0xb65c3b40 (LWP 8352)]\n[New Thread 0xaf4ff3c0 (LWP 8353)]\n[New Thread 0xaecff3c0 (LWP 8354)]\n[Thread 0xaecff3c0 (LWP 8354) exited]\n[Thread 0xaf4ff3c0 (LWP 8353) exited]\n[Thread 0xb65c3b40 (LWP 8352) exited]\n[Thread 0xb08073c0 (LWP 8346) exited]\n[Thread 0xb00073c0 (LWP 8347) exited]\n\n*** No errors detected\n[Inferior 1 (process 8343) exited normally]\nMissing separate debuginfos, use: debuginfo-install boost-chrono-1.55.0-8.fc21.armv7hl boost-filesystem-1.55.0-8.fc21.armv7hl boost-program-options-1.55.0-8.fc21.armv7hl boost-system-1.55.0-8.fc21.armv7hl boost-test-1.55.0-8.fc21.armv7hl boost-thread-1.55.0-8.fc21.armv7hl keyutils-libs-1.5.9-4.fc21.armv7hl krb5-libs-1.12.2-9.fc21.armv7hl libcom_err-1.42.12-1.fc21.armv7hl libdb4-cxx-4.8.30-16.fc21.armv7hl libgcc-4.9.2-1.fc21.armv7hl libselinux-2.3-5.fc21.armv7hl libstdc++-4.9.2-1.fc21.armv7hl miniupnpc-1.9-4.fc21.armv7hl openssl-compat-bitcoin-libs-1.0.1k-1.fc21.armv7hl pcre-8.35-8.fc21.armv7hl xz-libs-5.1.2-14alpha.fc21.armv7hl zlib-1.2.8-7.fc21.armv7hl\n(gdb) \n```\n\nI'm at a complete loss. What's going on here?\n",
   "closed_at" : "2015-07-28T03:17:04Z",
   "closed_by" : {
      "avatar_url" : "https://avatars2.githubusercontent.com/u/198207?v=4",
      "events_url" : "https://api.github.com/users/error10/events{/privacy}",
      "followers_url" : "https://api.github.com/users/error10/followers",
      "following_url" : "https://api.github.com/users/error10/following{/other_user}",
      "gists_url" : "https://api.github.com/users/error10/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/error10",
      "id" : 198207,
      "login" : "error10",
      "node_id" : "MDQ6VXNlcjE5ODIwNw==",
      "organizations_url" : "https://api.github.com/users/error10/orgs",
      "received_events_url" : "https://api.github.com/users/error10/received_events",
      "repos_url" : "https://api.github.com/users/error10/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/error10/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/error10/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/error10"
   },
   "comments" : 5,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5795/comments",
   "created_at" : "2015-02-15T15:46:13Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5795/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/5795",
   "id" : 57734401,
   "labels" : [],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5795/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDU6SXNzdWU1NzczNDQwMQ==",
   "number" : 5795,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "Bizarre test_bitcoin crash, but passes in debugger",
   "updated_at" : "2015-07-28T03:17:04Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5795",
   "user" : {
      "avatar_url" : "https://avatars2.githubusercontent.com/u/198207?v=4",
      "events_url" : "https://api.github.com/users/error10/events{/privacy}",
      "followers_url" : "https://api.github.com/users/error10/followers",
      "following_url" : "https://api.github.com/users/error10/following{/other_user}",
      "gists_url" : "https://api.github.com/users/error10/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/error10",
      "id" : 198207,
      "login" : "error10",
      "node_id" : "MDQ6VXNlcjE5ODIwNw==",
      "organizations_url" : "https://api.github.com/users/error10/orgs",
      "received_events_url" : "https://api.github.com/users/error10/received_events",
      "repos_url" : "https://api.github.com/users/error10/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/error10/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/error10/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/error10"
   }
}
