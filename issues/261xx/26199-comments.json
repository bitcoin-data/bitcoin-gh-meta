[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "FYI @naumenkogs @dergoegge ",
      "created_at" : "2022-09-28T21:53:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26199#issuecomment-1261503513",
      "id" : 1261503513,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26199",
      "node_id" : "IC_kwDOABII585LMQQZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1261503513/reactions"
      },
      "updated_at" : "2022-09-28T21:53:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1261503513",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2022-09-28T22:05:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26199#issuecomment-1261511669",
      "id" : 1261511669,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26199",
      "node_id" : "IC_kwDOABII585LMSP1",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1261511669/reactions"
      },
      "updated_at" : "2022-09-28T22:05:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1261511669",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [amitiuttarwar](https://github.com/bitcoin/bitcoin/pull/26199#pullrequestreview-1200047783), [stratospher](https://github.com/bitcoin/bitcoin/pull/26199#issuecomment-1334053238), [naumenkogs](https://github.com/bitcoin/bitcoin/pull/26199#issuecomment-1334913081) |\n| Concept ACK | [sipa](https://github.com/bitcoin/bitcoin/pull/26199#issuecomment-1261511669), [dergoegge](https://github.com/bitcoin/bitcoin/pull/26199#issuecomment-1263292453), [glozow](https://github.com/bitcoin/bitcoin/pull/26199#pullrequestreview-1126592748) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#25619](https://github.com/bitcoin/bitcoin/pull/25619) (net: avoid overriding non-virtual ToString() in CService and use better naming by vasild)\n* [#24008](https://github.com/bitcoin/bitcoin/pull/24008) (assumeutxo: net_processing changes by jamesob)\n* [#15606](https://github.com/bitcoin/bitcoin/pull/15606) (assumeutxo by jamesob)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2022-09-28T23:18:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26199#issuecomment-1261562279",
      "id" : 1261562279,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26199",
      "node_id" : "IC_kwDOABII585LMemn",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1261562279/reactions"
      },
      "updated_at" : "2022-12-02T08:41:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1261562279",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26199#discussion_r983176654"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26199"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983176654"
         }
      },
      "author_association" : "MEMBER",
      "body" : "1. `SetupAddressRelay` used to have a misleading comment: \"First addr message we have received from the peer, initialize m_addr_known\". We were not receiving any addr messages from the peer here, yet we initialized it. It seems like this was the case from the beginning.\r\n2. After this PR, calling `SetupAddressRelay` here seems unnecessary. If we drop it, the comment becomes valid :)\r\nAlthough the inconsistency is a good signal the comment is confusing, so perhaps we should drop it. Not very useful anyway, at least the current code is pretty readable.",
      "commit_id" : "3c43d9db1e0f84279b08a93afd730caeece061a9",
      "created_at" : "2022-09-29T07:43:43Z",
      "diff_hunk" : "@@ -3274,39 +3274,16 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             m_num_preferred_download_peers += state->fPreferredDownload;\n         }\n \n-        // Self advertisement & GETADDR logic\n         if (!pfrom.IsInboundConn() && SetupAddressRelay(pfrom, *peer)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26199#discussion_r983176654",
      "id" : 983176654,
      "line" : 3277,
      "node_id" : "PRRC_kwDOABII5846mhXO",
      "original_commit_id" : "3c43d9db1e0f84279b08a93afd730caeece061a9",
      "original_line" : 3277,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 5,
      "pull_request_review_id" : 1124784756,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26199",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983176654/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-29T07:43:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983176654",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26199#discussion_r983177362"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26199"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983177362"
         }
      },
      "author_association" : "MEMBER",
      "body" : "So yeah: 1) Drop `SetupAddressRelay` here; 2) Possibly drop the useless comment from `SetupAddressRelay`?",
      "commit_id" : "3c43d9db1e0f84279b08a93afd730caeece061a9",
      "created_at" : "2022-09-29T07:44:19Z",
      "diff_hunk" : "@@ -3274,39 +3274,16 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             m_num_preferred_download_peers += state->fPreferredDownload;\n         }\n \n-        // Self advertisement & GETADDR logic\n         if (!pfrom.IsInboundConn() && SetupAddressRelay(pfrom, *peer)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26199#discussion_r983177362",
      "id" : 983177362,
      "in_reply_to_id" : 983176654,
      "line" : 3277,
      "node_id" : "PRRC_kwDOABII5846mhiS",
      "original_commit_id" : "3c43d9db1e0f84279b08a93afd730caeece061a9",
      "original_line" : 3277,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 5,
      "pull_request_review_id" : 1124785556,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26199",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983177362/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-29T07:44:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983177362",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26199#discussion_r983186308"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26199"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983186308"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Alright, this has side-effects. `MaybeSendAddr` (another self-ad) will stop working until we get an ADDR message from the peer (not the case before the change i suggest here).\r\n\r\nPerhaps this code should be:\r\n```\r\nif (!pfrom.IsInboundConn()) {\r\n    SetupAddressRelay(pfrom, *peer);\r\n    ....\r\n}",
      "commit_id" : "3c43d9db1e0f84279b08a93afd730caeece061a9",
      "created_at" : "2022-09-29T07:53:38Z",
      "diff_hunk" : "@@ -3274,39 +3274,16 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             m_num_preferred_download_peers += state->fPreferredDownload;\n         }\n \n-        // Self advertisement & GETADDR logic\n         if (!pfrom.IsInboundConn() && SetupAddressRelay(pfrom, *peer)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26199#discussion_r983186308",
      "id" : 983186308,
      "in_reply_to_id" : 983176654,
      "line" : 3277,
      "node_id" : "PRRC_kwDOABII5846mjuE",
      "original_commit_id" : "3c43d9db1e0f84279b08a93afd730caeece061a9",
      "original_line" : 3277,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 5,
      "pull_request_review_id" : 1124798191,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26199",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983186308/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-29T07:53:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983186308",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26199#discussion_r983623845"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26199"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983623845"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think the current code is correct, `SetupAddressRelay` here has three tasks:\r\n1) Initialize `m_addr_known` for outbound peers (unless block-relay-only), see #21528\r\n2) Prevent Self-Advertisements to block-relay-only outbound peers (for which `SetupAddressRelay` returns false)\r\n3) Prevent a GETADDR to block-relay-only outbound peers\r\n\r\nSince 1) and 3) are still valid after this PR, I think we both need to keep calling `SetupAddressRelay` and skip if it returns false.\r\nI think this should be documented better (I had to revisit 21528 to recall how it worked while preparing this PR), so I will add some more documentation for this soon.",
      "commit_id" : "24608c2cc576f548ae43099dd1cc36d5f05399d7",
      "created_at" : "2022-09-29T14:28:37Z",
      "diff_hunk" : "@@ -3274,39 +3274,16 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             m_num_preferred_download_peers += state->fPreferredDownload;\n         }\n \n-        // Self advertisement & GETADDR logic\n         if (!pfrom.IsInboundConn() && SetupAddressRelay(pfrom, *peer)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26199#discussion_r983623845",
      "id" : 983623845,
      "in_reply_to_id" : 983176654,
      "line" : 3279,
      "node_id" : "PRRC_kwDOABII5846oOil",
      "original_commit_id" : "3c43d9db1e0f84279b08a93afd730caeece061a9",
      "original_line" : 3277,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 7,
      "pull_request_review_id" : 1125418187,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26199",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983623845/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-29T14:31:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983623845",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26199#discussion_r984336081"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26199"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/984336081"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The refactoring I suggested in my last message here is indeed wrong, because it ignores the returned value.\r\n\r\nDo you agree that the comment inside `SetupAddressRelay` is wrong though? That's the only thing that remains worrying me.",
      "commit_id" : "24608c2cc576f548ae43099dd1cc36d5f05399d7",
      "created_at" : "2022-09-30T08:18:30Z",
      "diff_hunk" : "@@ -3274,39 +3274,16 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             m_num_preferred_download_peers += state->fPreferredDownload;\n         }\n \n-        // Self advertisement & GETADDR logic\n         if (!pfrom.IsInboundConn() && SetupAddressRelay(pfrom, *peer)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26199#discussion_r984336081",
      "id" : 984336081,
      "in_reply_to_id" : 983176654,
      "line" : 3279,
      "node_id" : "PRRC_kwDOABII5846q8bR",
      "original_commit_id" : "3c43d9db1e0f84279b08a93afd730caeece061a9",
      "original_line" : 3277,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 7,
      "pull_request_review_id" : 1126442738,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26199",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/984336081/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-30T08:18:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/984336081",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2022-09-30T08:47:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26199#issuecomment-1263292453",
      "id" : 1263292453,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26199",
      "node_id" : "IC_kwDOABII585LTFAl",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1263292453/reactions"
      },
      "updated_at" : "2022-09-30T08:47:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1263292453",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I dunno if I'm supposed to ACK this since this is my commit, but I approve the changes 3c43d9db1e0f84279b08a93afd730caeece061a9 I guess :)\r\n\r\nAn easy way to look at this change is to notice that this code is almost entirely a subset of `MaybeSendAddr`. At the same time, it *heavily relies* on `MaybSendAddr` to actually do something, not much would change if you drop the duplicate subset (what this PR does).\r\n\r\nOne real difference this could make is that due to the \"makes a probabilistic decision to either advertise what they think we are or what we think we are\" of this behavior, we could have ended up having two self-ads in one ADDR message (one added here, one added in `MaybeSendAddr` if they are different). I don't think this is a show-stopper for this PR. I don't think we want to preserve this behavior.\r\n\r\nUPD:\r\n\r\nAnother important difference could be the time between the two calls. This might make sense if there's a risk of someone inserting our self-ad (`PushAddress`) with the wrong metadata, eg `nTime`. Then our latter self-ad insertion would be dismissed (because we just look up the key), while the VERSION-one is protected from this issue.\r\nI don't think this is a show-stopper for this PR, although this surface could indeed be improved (e.g., handle duplicates better, or handle other-nodes-announce-us-through-us differently).",
      "created_at" : "2022-09-30T09:39:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26199#issuecomment-1263346134",
      "id" : 1263346134,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26199",
      "node_id" : "IC_kwDOABII585LTSHW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1263346134/reactions"
      },
      "updated_at" : "2022-09-30T09:51:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1263346134",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26199#discussion_r984718823"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26199"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/984718823"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Do you agree that the comment inside `SetupAddressRelay` is wrong though?\r\n\r\nYeah, it's incomplete because it only applies to inbound peers. I added documentation there and before the call to `SetupAddressRelay` during version processing (as a second commit, because it's not directly related to the changes).\r\n",
      "commit_id" : "24608c2cc576f548ae43099dd1cc36d5f05399d7",
      "created_at" : "2022-09-30T15:36:17Z",
      "diff_hunk" : "@@ -3274,39 +3274,16 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             m_num_preferred_download_peers += state->fPreferredDownload;\n         }\n \n-        // Self advertisement & GETADDR logic\n         if (!pfrom.IsInboundConn() && SetupAddressRelay(pfrom, *peer)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26199#discussion_r984718823",
      "id" : 984718823,
      "in_reply_to_id" : 983176654,
      "line" : 3279,
      "node_id" : "PRRC_kwDOABII5846sZ3n",
      "original_commit_id" : "3c43d9db1e0f84279b08a93afd730caeece061a9",
      "original_line" : 3277,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 7,
      "pull_request_review_id" : 1127013347,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26199",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/984718823/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-30T15:36:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/984718823",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> One real difference this could make is that due to the \"makes a probabilistic decision to either advertise what they think we are or what we think we are\" of this behavior, we could have ended up having two self-ads in one ADDR message (one added here, one added in `MaybeSendAddr` if they are different). I don't think this is a show-stopper for this PR. I don't think we want to preserve this behavior.\r\n\r\nYes, advertising both addresses is something that can happen, but only in a few cases:\r\ne.g. if the address during version message processing is AddrV2-only, it is not sent out because we haven't gotten `sendaddrv2` yet. I think it might happen if we discovered a local IPv6 address and our peer sees us under a IPv4 address? \r\nI think that if this is something we really want, we could always advertise both (similar to your commit https://github.com/bitcoin/bitcoin/pull/19843/commits/10fc62f0c29f640fdefc7114576133fbf18c488a) but I'm not sure it is necessary - after all, we have the [nScore](https://github.com/bitcoin/bitcoin/blob/f59e91511a3aa8b2770eeec7034ddc1a9dec918b/src/net.cpp#L245) logic to make an educated guess which address is better.\r\n\r\n>Another important difference could be the time between the two calls. This might make sense if there's a risk of someone inserting our self-ad (PushAddress) with the wrong metadata, eg nTime. Then our latter self-ad insertion would be dismissed (because we just look up the key), while the VERSION-one is protected from this issue.\r\nI don't think this is a show-stopper for this PR, although this surface could indeed be improved (e.g., handle duplicates better, or handle other-nodes-announce-us-through-us differently).\r\n\r\nI think I don't understand this completely, but the time between advertising during version message and `MaybeSendAddr` should usually be negligible, because `m_next_local_addr_send` is initialized to `0`, so `MaybeSendAddr` always advertises right after the version handshake is completed.\r\nAlso, we clear `m_addr_known` right before self-advertising in `MaybeSendAddr` ([code](https://github.com/bitcoin/bitcoin/blob/f59e91511a3aa8b2770eeec7034ddc1a9dec918b/src/net_processing.cpp#L5086)) so it wouldn't be possible for an attacker to do something like preventing us from self-advertising by sending us our own address.  Is that what you meant?\r\n\r\n\r\n",
      "created_at" : "2022-09-30T18:26:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26199#issuecomment-1263886238",
      "id" : 1263886238,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26199",
      "node_id" : "IC_kwDOABII585LVV-e",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1263886238/reactions"
      },
      "updated_at" : "2022-09-30T18:26:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1263886238",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26199#discussion_r985513682"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26199"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/985513682"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: \"Prevent GETADDR from being sent\" sounds very complicated, and also might have additional unnecessary meaning of pro-actively preventing something.\r\n\r\nI'd say \"Don't send GETADDR [...]\" is better. Feel free to ignore.",
      "commit_id" : "24608c2cc576f548ae43099dd1cc36d5f05399d7",
      "created_at" : "2022-10-03T08:33:23Z",
      "diff_hunk" : "@@ -3274,39 +3274,16 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             m_num_preferred_download_peers += state->fPreferredDownload;\n         }\n \n-        // Self advertisement & GETADDR logic\n         if (!pfrom.IsInboundConn() && SetupAddressRelay(pfrom, *peer)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26199#discussion_r985513682",
      "id" : 985513682,
      "in_reply_to_id" : 983176654,
      "line" : 3279,
      "node_id" : "PRRC_kwDOABII5846vb7S",
      "original_commit_id" : "3c43d9db1e0f84279b08a93afd730caeece061a9",
      "original_line" : 3277,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 7,
      "pull_request_review_id" : 1127989220,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26199",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/985513682/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-03T08:33:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/985513682",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 24608c2cc576f548ae43099dd1cc36d5f05399d7",
      "created_at" : "2022-10-03T08:35:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26199#issuecomment-1265113369",
      "id" : 1265113369,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26199",
      "node_id" : "IC_kwDOABII585LaBkZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1265113369/reactions"
      },
      "updated_at" : "2022-10-03T08:35:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1265113369",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26199#discussion_r995140794"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26199"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/995140794"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "missed this comment, changed wording now.",
      "commit_id" : "1002cd193d6f4ae216181aafae80076511645df3",
      "created_at" : "2022-10-13T21:31:10Z",
      "diff_hunk" : "@@ -3274,39 +3274,16 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             m_num_preferred_download_peers += state->fPreferredDownload;\n         }\n \n-        // Self advertisement & GETADDR logic\n         if (!pfrom.IsInboundConn() && SetupAddressRelay(pfrom, *peer)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26199#discussion_r995140794",
      "id" : 995140794,
      "in_reply_to_id" : 983176654,
      "line" : 3279,
      "node_id" : "PRRC_kwDOABII5847UKS6",
      "original_commit_id" : "3c43d9db1e0f84279b08a93afd730caeece061a9",
      "original_line" : 3277,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 7,
      "pull_request_review_id" : 1141535044,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26199",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/995140794/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-13T21:31:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/995140794",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26199#discussion_r1028598561"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26199"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1028598561"
         }
      },
      "author_association" : "MEMBER",
      "body" : "agreed that the comment in `SetupAddressRelay` was misleading. thanks for catching / fixing. I didn't hunt down the history, but I bet that was my fault ð\r\n\r\nRE current comment about \"Don't send GETADDR...\":\r\nI find it a bit confusing, because we're also not sending `GETADDR` message to inbound peers. maybe this code is too dense and is better communicated in a bit more verbose manner? \r\n\r\neg. in non-syntax-adhering code:\r\n```\r\nbool send_getaddr = false;\r\nif (!pfrom.IsInboundConn()) { \r\n\t\tsend_getaddr = SetupAddressRelay();\r\n    }\r\nif (send_getaddr){\r\n\t// do GETADDR stuff\r\n}\r\n```\r\n\r\nalso cool if you want to skip the refactor and just want to update the comment to something like..\r\n```\r\n// Initialize address relay for all outbound peers\r\n// Send GETADDR to non-block-relay-only outbound peers\r\n```\r\n\r\nI wish we had a better way to refer to non-block-relay-only outbound peers ð¬",
      "commit_id" : "956c67059caf3807b3ceacdd5de1caaae538f009",
      "created_at" : "2022-11-21T23:12:22Z",
      "diff_hunk" : "@@ -3274,39 +3274,16 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             m_num_preferred_download_peers += state->fPreferredDownload;\n         }\n \n-        // Self advertisement & GETADDR logic\n         if (!pfrom.IsInboundConn() && SetupAddressRelay(pfrom, *peer)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26199#discussion_r1028598561",
      "id" : 1028598561,
      "in_reply_to_id" : 983176654,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5849Tysh",
      "original_commit_id" : "3c43d9db1e0f84279b08a93afd730caeece061a9",
      "original_line" : 3277,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1189049506,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26199",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1028598561/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-22T17:06:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1028598561",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26199#discussion_r1028606960"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26199"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1028606960"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n            // Do a one-time address fetch to help populate/update our addrman.\r\n            // If we're starting up for the first time, our addrman may be pretty\r\n            // empty, so this mechanism is\r\n```",
      "commit_id" : "956c67059caf3807b3ceacdd5de1caaae538f009",
      "created_at" : "2022-11-21T23:28:39Z",
      "diff_hunk" : "@@ -3274,39 +3274,18 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             m_num_preferred_download_peers += state->fPreferredDownload;\n         }\n \n-        // Self advertisement & GETADDR logic\n+        // Don't send GETADDR to block-relay-only outbound peers\n+        // and initialize address relay for all other outbound peers.\n         if (!pfrom.IsInboundConn() && SetupAddressRelay(pfrom, *peer)) {\n-            // For outbound peers, we try to relay our address (so that other\n-            // nodes can try to find us more quickly, as we have no guarantee\n-            // that an outbound peer is even aware of how to reach us) and do a\n-            // one-time address fetch (to help populate/update our addrman). If\n-            // we're starting up for the first time, our addrman may be pretty\n-            // empty and no one will know who we are, so these mechanisms are\n+            // For outbound peers, we do a one-time address fetch\n+            // (to help populate/update our addrman).\n+            // If we're starting up for the first time, our addrman may be pretty\n+            // empty and no one will know who we are, so this mechanism is",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26199#discussion_r1028606960",
      "id" : 1028606960,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5849T0vw",
      "original_commit_id" : "1002cd193d6f4ae216181aafae80076511645df3",
      "original_line" : 3283,
      "original_position" : 17,
      "original_start_line" : 3280,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1189049506,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26199",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1028606960/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-11-22T17:06:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1028606960",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26199#discussion_r1028609676"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26199"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1028609676"
         }
      },
      "author_association" : "MEMBER",
      "body" : "just deleted the parts that are nuanced & already explained or now handled elsewhere. no big deal either way.",
      "commit_id" : "956c67059caf3807b3ceacdd5de1caaae538f009",
      "created_at" : "2022-11-21T23:34:14Z",
      "diff_hunk" : "@@ -3274,39 +3274,18 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             m_num_preferred_download_peers += state->fPreferredDownload;\n         }\n \n-        // Self advertisement & GETADDR logic\n+        // Don't send GETADDR to block-relay-only outbound peers\n+        // and initialize address relay for all other outbound peers.\n         if (!pfrom.IsInboundConn() && SetupAddressRelay(pfrom, *peer)) {\n-            // For outbound peers, we try to relay our address (so that other\n-            // nodes can try to find us more quickly, as we have no guarantee\n-            // that an outbound peer is even aware of how to reach us) and do a\n-            // one-time address fetch (to help populate/update our addrman). If\n-            // we're starting up for the first time, our addrman may be pretty\n-            // empty and no one will know who we are, so these mechanisms are\n+            // For outbound peers, we do a one-time address fetch\n+            // (to help populate/update our addrman).\n+            // If we're starting up for the first time, our addrman may be pretty\n+            // empty and no one will know who we are, so this mechanism is",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26199#discussion_r1028609676",
      "id" : 1028609676,
      "in_reply_to_id" : 1028606960,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5849T1aM",
      "original_commit_id" : "1002cd193d6f4ae216181aafae80076511645df3",
      "original_line" : 3283,
      "original_position" : 17,
      "original_start_line" : 3280,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1189049506,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26199",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1028609676/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-11-22T17:06:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1028609676",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "code review ACK 1002cd193d6f4ae216181aafae80076511645df3. this PR improves the encapsulation of self-advertisement logic, which simplifies the code as well as our mental models of addr relay on the network.\r\n\r\n@naumenkogs \r\n> Another important difference could be the time between the two calls.\r\n\r\n@mzumsande \r\n> I think I don't understand this completely, but the time between advertising during version message and MaybeSendAddr should usually be negligible, because m_next_local_addr_send is initialized to 0, so MaybeSendAddr always advertises right after the version handshake is completed.\r\n\r\nAgreed, but I'd take it slightly further. I think there is no difference in when the advertisement would actually occur. the `ProcessMessage -> version` logic called `PushAddress` which (at best) adds the address to `m_addrs_to_send`. The actual constructing & sending of the message wouldn't occur until the `SendMessages` loop calls `MaybeSendAddr`.\r\n\r\n----\r\n\r\nMy understanding of this PR is that there would be no tangible behavioral differences in the cases where the `version` logic returned the same address as `MaybeSendAddr` logic. on master, if they result in two different addr, I believe we would advertise both. after this PR, we would only advertise the result of `GetLocalAddrForPeer`, which will select one of the two.\r\n\r\nSince the `version` logic always prioritized `GetLocalAddress` (aka what we think we are), the behavioral difference would occur in instances when `GetLocalAddrForPeer` (aka weighted guess) selects the result from `IsPeerAddrLocalGood` (aka what peer thinks we are). \r\n\r\nI think the only time this would cause a connectivity issue is if your peers are somehow reporting your address to be something that can't be connected to, and you would have advertised something usable with `GetLocalAddress`. I expect this to be quite rare, but additionally your self-identified address would eventually get out when `GetLocalAddrForPeer` selects the result of `GetLocalAddress`.\r\n\r\n> I think that if this is something we really want, we could always advertise both (similar to your commit https://github.com/bitcoin/bitcoin/commit/10fc62f0c29f640fdefc7114576133fbf18c488a) but I'm not sure it is necessary - after all, we have the [nScore](https://github.com/bitcoin/bitcoin/blob/f59e91511a3aa8b2770eeec7034ddc1a9dec918b/src/net.cpp#L245) logic to make an educated guess which address is better.\r\n\r\nFor the reasons I stated above, I agree. Advertising both seems unnecessary, and the worst case should just be slower time for inbounds to connect to you?\r\n\r\n@mzumsande @naumenkogs curious to hear your feedback. do these claims track with your understanding? ",
      "created_at" : "2022-11-22T02:37:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26199#issuecomment-1322941739",
      "id" : 1322941739,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26199",
      "node_id" : "IC_kwDOABII585O2n0r",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1322941739/reactions"
      },
      "updated_at" : "2022-11-22T02:37:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1322941739",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "oops, didn't post last night - just some suggestions around language in the comments. not essential to incorporate. ",
      "created_at" : "2022-11-22T17:08:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26199#issuecomment-1323994691",
      "id" : 1323994691,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26199",
      "node_id" : "IC_kwDOABII585O6o5D",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1323994691/reactions"
      },
      "updated_at" : "2022-11-22T17:08:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1323994691",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : ">Agreed, but I'd take it slightly further. I think there is no difference in when the advertisement would actually occur.\r\n\r\nThis was the initial purpose of the PR, yeah. In my reading of your comment, I'm not sure it \"takes further\" in that sense. My finding was more niche (again, probably very hypothetical) âÂ if only the latter call is in place, the data could be hijacked. Trying to make sure we're on the same page :)\r\n\r\n I agree with the rest of your comment.",
      "created_at" : "2022-11-23T07:49:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26199#issuecomment-1324666309",
      "id" : 1324666309,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26199",
      "node_id" : "IC_kwDOABII585O9M3F",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1324666309/reactions"
      },
      "updated_at" : "2022-11-23T07:49:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1324666309",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26199#discussion_r1030878016"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26199"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1030878016"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I agree that it this would be better to understand if it's a bit more spread out, so I took your suggestion and changed the comment - hopefully it's clear now?",
      "commit_id" : "956c67059caf3807b3ceacdd5de1caaae538f009",
      "created_at" : "2022-11-23T21:19:23Z",
      "diff_hunk" : "@@ -3274,39 +3274,16 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             m_num_preferred_download_peers += state->fPreferredDownload;\n         }\n \n-        // Self advertisement & GETADDR logic\n         if (!pfrom.IsInboundConn() && SetupAddressRelay(pfrom, *peer)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26199#discussion_r1030878016",
      "id" : 1030878016,
      "in_reply_to_id" : 983176654,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5849cfNA",
      "original_commit_id" : "3c43d9db1e0f84279b08a93afd730caeece061a9",
      "original_line" : 3277,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1192275175,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26199",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1030878016/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-23T21:19:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1030878016",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26199#discussion_r1030878281"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26199"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1030878281"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done.",
      "commit_id" : "956c67059caf3807b3ceacdd5de1caaae538f009",
      "created_at" : "2022-11-23T21:19:51Z",
      "diff_hunk" : "@@ -3274,39 +3274,18 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             m_num_preferred_download_peers += state->fPreferredDownload;\n         }\n \n-        // Self advertisement & GETADDR logic\n+        // Don't send GETADDR to block-relay-only outbound peers\n+        // and initialize address relay for all other outbound peers.\n         if (!pfrom.IsInboundConn() && SetupAddressRelay(pfrom, *peer)) {\n-            // For outbound peers, we try to relay our address (so that other\n-            // nodes can try to find us more quickly, as we have no guarantee\n-            // that an outbound peer is even aware of how to reach us) and do a\n-            // one-time address fetch (to help populate/update our addrman). If\n-            // we're starting up for the first time, our addrman may be pretty\n-            // empty and no one will know who we are, so these mechanisms are\n+            // For outbound peers, we do a one-time address fetch\n+            // (to help populate/update our addrman).\n+            // If we're starting up for the first time, our addrman may be pretty\n+            // empty and no one will know who we are, so this mechanism is",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26199#discussion_r1030878281",
      "id" : 1030878281,
      "in_reply_to_id" : 1028606960,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5849cfRJ",
      "original_commit_id" : "1002cd193d6f4ae216181aafae80076511645df3",
      "original_line" : 3283,
      "original_position" : 17,
      "original_start_line" : 3280,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1192275524,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26199",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1030878281/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-11-23T21:19:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1030878281",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "[1002cd1 ](https://github.com/bitcoin/bitcoin/commit/1002cd193d6f4ae216181aafae80076511645df3)to [956c670](https://github.com/bitcoin/bitcoin/commit/956c67059caf3807b3ceacdd5de1caaae538f009): Applied suggestions by @amitiuttarwar to second commit  - thanks!\r\n\r\n> do these claims track with your understanding?\r\n\r\nyes, I agree!\r\n\r\n> the data could be hijacked. \r\n\r\nI didn't understand this the first time, but I think I do now - you mean an attacker could continuously spam us with our own address from other connections (but with bad metadata), and thus prevent us from sending our self-advertisement (with correct metadata) to new peers because they'd inserted a duplicate in between our processing of the version messages and us getting to `MaybeSendAddress()`.\r\n\r\nI will have to think about this a bit more, but even if the timing issues and rate-limiting issues were solved, it would probably be really hard / impossible to that because of the way `RelayAddress()` relays a given address (no matter which peer it is received from) always to the same peers within 24 hours (which might change slightly with peers fluctuating, but not very much). It should be impossible for an attacker to make us relay a specific node in a targeted way to new nodes.\r\n",
      "created_at" : "2022-11-23T22:12:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26199#issuecomment-1325716912",
      "id" : 1325716912,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26199",
      "node_id" : "IC_kwDOABII585PBNWw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1325716912/reactions"
      },
      "updated_at" : "2022-11-23T22:12:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1325716912",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> 1. There were some entries in my node's debug.log where the peer would send incorrect entries(here, the peer's own address/they could be tampered with) for what address the peer thinks we are (`vRecv >> addrMe`).\r\n>    \r\n>    * with the version processing mechanism,  we'd self advertise our correct address at least once. (`GetLocalAddress`)\r\n>    * with the `MaybeSendAddr` mechanism, we'd sometimes self advertise `addrMe` (what peer thinks we are/could be tampered with) only. (`GetLocalAddrForPeer`)\r\n>    * The connections would last for only a short duration though(around 4 mins). Could this scenario be problematic?\r\n\r\nI think that it's not possible to say in general which address (the local or peer's one) is better, or \"correct\". In some cases, the peer may have a better idea how we are reachable than we do. In other cases, it's the other way round, or maybe neither  are working if we're just not reachable by others.\r\n\r\nAlso note that if we overrule our own local address and advertise with the address a peer sees us with, we'll only do that back to that same peer. We never send an `addrMe` address from one peer to other peers.\r\nTherefore, I think that peers can only influence the weight (`nScore`) between multiple local addresses (all of which we detected by ourselves at startup!) via `SeenLocal()` but never insert new ones that they pick - this should make it impossible to trick us into advertising an incorrect address to other peers.  If a peer is malicious, they can just discard the self-announcements we send them anyway, so it's not an attack if such a peer makes us advertise to them with a wrong address.\r\n\r\n> 2. even if we don't accept inbound connections, we still self-advertise. is it because we can't detect them?\r\n\r\nIf we explicitly disable inbound connections (`fListen == false`), we don't self-advertise, see [here](https://github.com/bitcoin/bitcoin/blob/5488dc1eb47783259ba8557c5aaca312c3de0634/src/net_processing.cpp#L5159).\r\nBut yes, it is a very common situation (e.g. if we're behind a NAT, or the port for bitcoin is blocked by our firewall) that bitcoind isn't able to detect that we're actually unreachable - so self-advertisements happen in this case.",
      "created_at" : "2022-11-28T16:58:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26199#issuecomment-1329433776",
      "id" : 1329433776,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26199",
      "node_id" : "IC_kwDOABII585PPYyw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1329433776/reactions"
      },
      "updated_at" : "2022-11-28T16:58:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1329433776",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ACK  956c670",
      "created_at" : "2022-12-01T16:45:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26199#issuecomment-1334053238",
      "id" : 1334053238,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26199",
      "node_id" : "IC_kwDOABII585PhAl2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1334053238/reactions"
      },
      "updated_at" : "2022-12-01T16:45:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1334053238",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/44024636?v=4",
         "events_url" : "https://api.github.com/users/stratospher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stratospher/followers",
         "following_url" : "https://api.github.com/users/stratospher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stratospher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stratospher",
         "id" : 44024636,
         "login" : "stratospher",
         "node_id" : "MDQ6VXNlcjQ0MDI0NjM2",
         "organizations_url" : "https://api.github.com/users/stratospher/orgs",
         "received_events_url" : "https://api.github.com/users/stratospher/received_events",
         "repos_url" : "https://api.github.com/users/stratospher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stratospher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stratospher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stratospher"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 956c67059caf3807b3ceacdd5de1caaae538f009",
      "created_at" : "2022-12-02T08:41:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26199#issuecomment-1334913081",
      "id" : 1334913081,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26199",
      "node_id" : "IC_kwDOABII585PkSg5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1334913081/reactions"
      },
      "updated_at" : "2022-12-02T08:41:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1334913081",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   }
]
