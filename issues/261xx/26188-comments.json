[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "A call to `SyncWithValidationInterfaceQueue()` also fixes it. I am +0.1 on stopping the scheduler thread and flushing the queue - looks more robust to me.",
      "created_at" : "2022-09-27T16:12:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26188#issuecomment-1259730507",
      "id" : 1259730507,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26188",
      "node_id" : "IC_kwDOABII585LFfZL",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1259730507/reactions"
      },
      "updated_at" : "2022-09-28T08:17:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1259730507",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r982751603"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/982751603"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't really like duplicating the shutdown sequence, especially not in the same order. This is just bloating the tests with hard to understand and hard to maintain code.\r\n\r\nThe reason that the bug exits is a presumed silent merge conflict. I already fixed the same bug in fa176e253fb473767c61d4d8cd2d93e87d71a015, but the test here copied the unfixed code.\r\n\r\nMy preference would be to use the same fix in all unit tests and not use a different fix for each unit test.",
      "commit_id" : "eaec74f3b94190d98157888439f9cccd79f79e4a",
      "created_at" : "2022-09-28T18:46:51Z",
      "diff_hunk" : "@@ -79,6 +80,13 @@ BOOST_FIXTURE_TEST_CASE(coinstatsindex_initial_sync, TestChain100Setup)\n     // Shutdown sequence (c.f. Shutdown() in init.cpp)\n     coin_stats_index.Stop();\n \n+    // Make sure coin_stats_index is not used by the scheduler thread after it\n+    // has been destroyed.\n+    if (m_node.scheduler) {\n+        m_node.scheduler->stop();\n+    }\n+    GetMainSignals().FlushBackgroundCallbacks();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r982751603",
      "id" : 982751603,
      "line" : 88,
      "node_id" : "PRRC_kwDOABII5846k5lz",
      "original_commit_id" : "eaec74f3b94190d98157888439f9cccd79f79e4a",
      "original_line" : 88,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/test/coinstatsindex_tests.cpp",
      "position" : 17,
      "pull_request_review_id" : 1124199917,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/982751603/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-28T18:47:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/982751603",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> A call to `SyncWithValidationInterfaceQueue()` also fixes it. I am +0.1 on stopping the scheduler thread and flushing the queue - looks more robust to me.\r\n\r\nHmm, I would think the opposite `SyncWithValidationInterfaceQueue` seems like the more robust approach to me. It forces all events that may have been posted before the index is stopped to be processed before the index destructor is called.\r\n\r\nStopping the scheduler seems more indirect and more error prone because it make additional assumptions that validationinterface uses the scheduler internally and that it is safe to stop the scheduler at all because nothing else depends on it.\r\n\r\nAlso agree with Marco's suggestion that it would be good to stick to consistent approach across tests, which also favors `SyncWithValidationInterfaceQueue`",
      "created_at" : "2022-09-28T19:03:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26188#issuecomment-1261345679",
      "id" : 1261345679,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26188",
      "node_id" : "IC_kwDOABII585LLpuP",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1261345679/reactions"
      },
      "updated_at" : "2022-09-28T19:03:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1261345679",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`eaec74f3b9...40ef8e064d`: @ryanofsky, @MarcoFalke fair enough! Switched to `SyncWithValidationInterfaceQueue()` :-)",
      "created_at" : "2022-09-29T08:22:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26188#issuecomment-1261935631",
      "id" : 1261935631,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26188",
      "node_id" : "IC_kwDOABII585LN5wP",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1261935631/reactions"
      },
      "updated_at" : "2022-09-29T08:22:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1261935631",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r983244094"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983244094"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "3ae1fe44981cabb4bf5e714ccaac4659e8cb3f50",
      "created_at" : "2022-09-29T08:37:54Z",
      "diff_hunk" : "@@ -79,6 +80,13 @@ BOOST_FIXTURE_TEST_CASE(coinstatsindex_initial_sync, TestChain100Setup)\n     // Shutdown sequence (c.f. Shutdown() in init.cpp)\n     coin_stats_index.Stop();\n \n+    // Make sure coin_stats_index is not used by the scheduler thread after it\n+    // has been destroyed.\n+    if (m_node.scheduler) {\n+        m_node.scheduler->stop();\n+    }\n+    GetMainSignals().FlushBackgroundCallbacks();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r983244094",
      "id" : 983244094,
      "in_reply_to_id" : 982751603,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5846mx0-",
      "original_commit_id" : "eaec74f3b94190d98157888439f9cccd79f79e4a",
      "original_line" : 88,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/test/coinstatsindex_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1124872880,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983244094/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-29T08:37:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983244094",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r983290606"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983290606"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe remove this comment as well, or add it to the other places, to mirror fa176e253fb473767c61d4d8cd2d93e87d71a015?",
      "commit_id" : "3ae1fe44981cabb4bf5e714ccaac4659e8cb3f50",
      "created_at" : "2022-09-29T09:18:49Z",
      "diff_hunk" : "@@ -79,6 +79,10 @@ BOOST_FIXTURE_TEST_CASE(coinstatsindex_initial_sync, TestChain100Setup)\n     // Shutdown sequence (c.f. Shutdown() in init.cpp)\n     coin_stats_index.Stop();\n \n+    // Make sure coin_stats_index is not used by the scheduler thread after it\n+    // has been destroyed.\n+    SyncWithValidationInterfaceQueue();\n+\n     // Rest of shutdown sequence and destructors happen in ~TestingSetup()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r983290606",
      "id" : 983290606,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5846m9Lu",
      "original_commit_id" : "40ef8e064d812323d56843f14425497d6b7d800e",
      "original_line" : 86,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/test/coinstatsindex_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1124939794,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983290606/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-29T09:19:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983290606",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r983291568"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983291568"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Unrelated: I think the two `Stop()`, here and in fa176e253fb473767c61d4d8cd2d93e87d71a015 can be removed, as they are done by the destructor anyway.",
      "commit_id" : "3ae1fe44981cabb4bf5e714ccaac4659e8cb3f50",
      "created_at" : "2022-09-29T09:19:44Z",
      "diff_hunk" : "@@ -79,6 +79,10 @@ BOOST_FIXTURE_TEST_CASE(coinstatsindex_initial_sync, TestChain100Setup)\n     // Shutdown sequence (c.f. Shutdown() in init.cpp)\n     coin_stats_index.Stop();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r983291568",
      "id" : 983291568,
      "line" : 80,
      "node_id" : "PRRC_kwDOABII5846m9aw",
      "original_commit_id" : "40ef8e064d812323d56843f14425497d6b7d800e",
      "original_line" : 80,
      "original_position" : 2,
      "original_start_line" : null,
      "path" : "src/test/coinstatsindex_tests.cpp",
      "position" : 2,
      "pull_request_review_id" : 1124939794,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983291568/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-29T09:19:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983291568",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`40ef8e064d...3ae1fe4498`: take suggestion to remove a comment",
      "created_at" : "2022-09-29T09:53:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26188#issuecomment-1262044960",
      "id" : 1262044960,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26188",
      "node_id" : "IC_kwDOABII585LOUcg",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1262044960/reactions"
      },
      "updated_at" : "2022-09-29T09:53:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1262044960",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r983327282"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983327282"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Removed.",
      "commit_id" : "3ae1fe44981cabb4bf5e714ccaac4659e8cb3f50",
      "created_at" : "2022-09-29T09:53:29Z",
      "diff_hunk" : "@@ -79,6 +79,10 @@ BOOST_FIXTURE_TEST_CASE(coinstatsindex_initial_sync, TestChain100Setup)\n     // Shutdown sequence (c.f. Shutdown() in init.cpp)\n     coin_stats_index.Stop();\n \n+    // Make sure coin_stats_index is not used by the scheduler thread after it\n+    // has been destroyed.\n+    SyncWithValidationInterfaceQueue();\n+\n     // Rest of shutdown sequence and destructors happen in ~TestingSetup()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r983327282",
      "id" : 983327282,
      "in_reply_to_id" : 983290606,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5846nGIy",
      "original_commit_id" : "40ef8e064d812323d56843f14425497d6b7d800e",
      "original_line" : 86,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/test/coinstatsindex_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1124992035,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983327282/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-29T09:53:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983327282",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r983331181"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983331181"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It looks like that all calls to `Stop()` are done just before the objects are destroyed (except the call from the destructor itself). Thus `Stop()` can be removed and its (short) body moved inside `BaseIndex::~BaseIndex()`. If this is the case then this deserves a separate PR. Am I missing something?",
      "commit_id" : "3ae1fe44981cabb4bf5e714ccaac4659e8cb3f50",
      "created_at" : "2022-09-29T09:57:14Z",
      "diff_hunk" : "@@ -79,6 +79,10 @@ BOOST_FIXTURE_TEST_CASE(coinstatsindex_initial_sync, TestChain100Setup)\n     // Shutdown sequence (c.f. Shutdown() in init.cpp)\n     coin_stats_index.Stop();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r983331181",
      "id" : 983331181,
      "in_reply_to_id" : 983291568,
      "line" : 80,
      "node_id" : "PRRC_kwDOABII5846nHFt",
      "original_commit_id" : "40ef8e064d812323d56843f14425497d6b7d800e",
      "original_line" : 80,
      "original_position" : 2,
      "original_start_line" : null,
      "path" : "src/test/coinstatsindex_tests.cpp",
      "position" : 2,
      "pull_request_review_id" : 1124997300,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983331181/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-29T09:57:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983331181",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r983718076"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983718076"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The calls to Stop need to happen before the BaseIndex destructor runs because they are responsible for joining the sync thread, which can call virtual methods. By the time the BaseIndex destructor runs, whatever subclass inherited from BaseIndex is partially destroyed and the virtual method calls won't work.\r\n\r\nThe call to Stop() in the destructor was never valid and I have a commit c499c8797e65c66318eb1faa2e36c7c3f3e2ba1a in #24230 which removes it and asserts that it was called previously.",
      "commit_id" : "3ae1fe44981cabb4bf5e714ccaac4659e8cb3f50",
      "created_at" : "2022-09-29T15:46:29Z",
      "diff_hunk" : "@@ -79,6 +79,10 @@ BOOST_FIXTURE_TEST_CASE(coinstatsindex_initial_sync, TestChain100Setup)\n     // Shutdown sequence (c.f. Shutdown() in init.cpp)\n     coin_stats_index.Stop();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r983718076",
      "id" : 983718076,
      "in_reply_to_id" : 983291568,
      "line" : 80,
      "node_id" : "PRRC_kwDOABII5846oli8",
      "original_commit_id" : "40ef8e064d812323d56843f14425497d6b7d800e",
      "original_line" : 80,
      "original_position" : 2,
      "original_start_line" : null,
      "path" : "src/test/coinstatsindex_tests.cpp",
      "position" : 2,
      "pull_request_review_id" : 1125556870,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983718076/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-29T15:46:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983718076",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r983896572"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983896572"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"test: fix race in shutdown code in coinstatsindex_initial_sync\" (3ae1fe44981cabb4bf5e714ccaac4659e8cb3f50)\r\n\r\nI think it would be better to move the `SyncWithValidationInterfaceQueue()` call up one line before the `Stop()` call, and not an introduce an artificial pause between stopping the index and destroying the index. There should be no need for an extra pause between stopping and destroying. Adding the pause in the wrong place in the test could potentially mask real bugs, so better to add it in the right place one line up.\r\n\r\nI also think the code comment \"Make sure coin_stats_index is not used by the scheduler thread\" and PR description \"fix race in shutdown code\" are a little misleading, because this is not really fixing a race condition. This is working around TSAN false positive errors that happen because TSAN doesn't understand our `BaseIndex::BlockUntilSyncedToCurrentChain` and `BaseIndex::BlockConnected` functions.\r\n\r\nTSAN alerts about a race condition because it doesn't see the test thread which the destroys the object explicitly waiting for the scheduler thread which calls `BlockConnected`. But this is because, as an optimization, our `BlockUntilSyncedToCurrentChain` function skips calling `SyncWithValidationInterfaceQueue` when `m_best_block_index` matches the chain tip. This is a valid optimization as long as the `BaseIndex::BlockConnected` implementation does not do any reads or writes to `*this` after it updates `m_best_block_index`. This was the case before f08c9fb0c6a799e3cb75ca5f763a746471625beb from #21726 did add a real race bug by making `AllowPrune()` and `GetName()` calls after updating `m_best_block_index`. I think a fix for this could look like:\r\n\r\n```diff\r\n--- a/src/index/base.cpp\r\n+++ b/src/index/base.cpp\r\n@@ -414,10 +414,18 @@ IndexSummary BaseIndex::GetSummary() const\r\n void BaseIndex::SetBestBlockIndex(const CBlockIndex* block) {\r\n     assert(!node::fPruneMode || AllowPrune());\r\n \r\n-    m_best_block_index = block;\r\n     if (AllowPrune() && block) {\r\n         node::PruneLockInfo prune_lock;\r\n         prune_lock.height_first = block->nHeight;\r\n         WITH_LOCK(::cs_main, m_chainstate->m_blockman.UpdatePruneLock(GetName(), prune_lock));\r\n     }\r\n+    // For thread safety and compatibility with m_best_block_index optimization\r\n+    // in the BlockUntilSyncedToCurrentChain(), update m_best_block_index as\r\n+    // the last step in this function, and avoid updating state or accessing\r\n+    // *this after m_best_block_index is set. If state is updated after\r\n+    // m_best_block_index, external threads won't be able to rely on\r\n+    // BlockUntilSyncedToCurrentChain() to be in sync with that state. And if\r\n+    // *this is accessed, external threads won't be able to use\r\n+    // BlockUntilSyncedToCurrentChain() to safely destroy the index object.\r\n+    m_best_block_index = block;\r\n }\r\n```\r\n\r\nFor this commit, I think a more accurate comment explaining the `SyncWithValidationInterfaceQueue();` call would say something like \"To avoid false positive TSAN errors, explicitly signal the test thread from the validationinterface thread so TSAN does not think there is a race between index shutdown code and BlockConnected notification code. The BlockUntilSyncedToCurrentChain() call above is sufficient to avoid these races in reality, but TSAN can't detect this due to an optimization in that function.\"",
      "commit_id" : "3ae1fe44981cabb4bf5e714ccaac4659e8cb3f50",
      "created_at" : "2022-09-29T18:27:52Z",
      "diff_hunk" : "@@ -79,7 +79,9 @@ BOOST_FIXTURE_TEST_CASE(coinstatsindex_initial_sync, TestChain100Setup)\n     // Shutdown sequence (c.f. Shutdown() in init.cpp)\n     coin_stats_index.Stop();\n \n-    // Rest of shutdown sequence and destructors happen in ~TestingSetup()\n+    // Make sure coin_stats_index is not used by the scheduler thread after it\n+    // has been destroyed.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r983896572",
      "id" : 983896572,
      "line" : 83,
      "node_id" : "PRRC_kwDOABII5846pRH8",
      "original_commit_id" : "3ae1fe44981cabb4bf5e714ccaac4659e8cb3f50",
      "original_line" : 83,
      "original_position" : 6,
      "original_start_line" : 82,
      "path" : "src/test/coinstatsindex_tests.cpp",
      "position" : 6,
      "pull_request_review_id" : 1125812265,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983896572/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 82,
      "start_side" : "RIGHT",
      "updated_at" : "2022-09-29T18:35:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983896572",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r983906690"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983906690"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> This is working around TSAN false positive errors\r\n\r\nNo, this is a real issue (use-after-free), see steps to reproduce without tsan (for example with valgrind): https://github.com/bitcoin/bitcoin/issues/25365#issuecomment-1253337983",
      "commit_id" : "3ae1fe44981cabb4bf5e714ccaac4659e8cb3f50",
      "created_at" : "2022-09-29T18:40:29Z",
      "diff_hunk" : "@@ -79,7 +79,9 @@ BOOST_FIXTURE_TEST_CASE(coinstatsindex_initial_sync, TestChain100Setup)\n     // Shutdown sequence (c.f. Shutdown() in init.cpp)\n     coin_stats_index.Stop();\n \n-    // Rest of shutdown sequence and destructors happen in ~TestingSetup()\n+    // Make sure coin_stats_index is not used by the scheduler thread after it\n+    // has been destroyed.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r983906690",
      "id" : 983906690,
      "in_reply_to_id" : 983896572,
      "line" : 83,
      "node_id" : "PRRC_kwDOABII5846pTmC",
      "original_commit_id" : "3ae1fe44981cabb4bf5e714ccaac4659e8cb3f50",
      "original_line" : 83,
      "original_position" : 6,
      "original_start_line" : 82,
      "path" : "src/test/coinstatsindex_tests.cpp",
      "position" : 6,
      "pull_request_review_id" : 1125827279,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983906690/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 82,
      "start_side" : "RIGHT",
      "updated_at" : "2022-09-29T18:40:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983906690",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r983920925"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983920925"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> > This is working around TSAN false positive errors\r\n> \r\n> No, this is a real issue (use-after-free), see steps to reproduce without tsan (for example with valgrind): [#25365 (comment)](https://github.com/bitcoin/bitcoin/issues/25365#issuecomment-1253337983)\r\n\r\nYes I did see that comment, but it was not reproducing an existing race condition, it was adding a new race condition by calling `this->GetName()` after the `m_best_block_index = block` assignment. If the `m_best_block_index = block;` assignment was done last, there would be no race.\r\n\r\nMy comment above may be a little muddled because I noticed the real race condition caused by f08c9fb0c6a799e3cb75ca5f763a746471625beb from #21726 in the middle of writing it. I think we should fix the real race condition in non-test code making a change to `SetBestBlockIndex` like the one I suggested above. After we do that, the the current change 3ae1fe44981cabb4bf5e714ccaac4659e8cb3f50 in this PR will just be silencing TSAN errors, not avoiding a real race condition anymore.",
      "commit_id" : "3ae1fe44981cabb4bf5e714ccaac4659e8cb3f50",
      "created_at" : "2022-09-29T18:57:47Z",
      "diff_hunk" : "@@ -79,7 +79,9 @@ BOOST_FIXTURE_TEST_CASE(coinstatsindex_initial_sync, TestChain100Setup)\n     // Shutdown sequence (c.f. Shutdown() in init.cpp)\n     coin_stats_index.Stop();\n \n-    // Rest of shutdown sequence and destructors happen in ~TestingSetup()\n+    // Make sure coin_stats_index is not used by the scheduler thread after it\n+    // has been destroyed.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r983920925",
      "id" : 983920925,
      "in_reply_to_id" : 983896572,
      "line" : 83,
      "node_id" : "PRRC_kwDOABII5846pXEd",
      "original_commit_id" : "3ae1fe44981cabb4bf5e714ccaac4659e8cb3f50",
      "original_line" : 83,
      "original_position" : 6,
      "original_start_line" : 82,
      "path" : "src/test/coinstatsindex_tests.cpp",
      "position" : 6,
      "pull_request_review_id" : 1125848492,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983920925/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 82,
      "start_side" : "RIGHT",
      "updated_at" : "2022-09-29T18:58:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983920925",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r984359905"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/984359905"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> it was not reproducing an existing race condition, it was adding a new race condition by calling this->GetName() after the m_best_block_index = block assignment\r\n\r\nOk, but see also https://github.com/bitcoin/bitcoin/issues/25365#issuecomment-1259744133. I could reproduce use-after-free in Valgrind even without adding a call to `GetName()`, just a sleep suffices.\r\n\r\nI got the impression that when `BaseIndex::SetBestBlockIndex()` executes `this` is already freed, but I do not remember if I checked to access a member before the `m_best_block_index` assignment.\r\n\r\nMoving the assignment to the bottom may fix it. Anyway, this whole story looks overly complicated to me. It shouldn't require multiple people discussing whether this is a bug or not and how to fix it exactly! I opened https://github.com/bitcoin/bitcoin/issues/26210 to explore an alternative.",
      "commit_id" : "3ae1fe44981cabb4bf5e714ccaac4659e8cb3f50",
      "created_at" : "2022-09-30T08:42:53Z",
      "diff_hunk" : "@@ -79,7 +79,9 @@ BOOST_FIXTURE_TEST_CASE(coinstatsindex_initial_sync, TestChain100Setup)\n     // Shutdown sequence (c.f. Shutdown() in init.cpp)\n     coin_stats_index.Stop();\n \n-    // Rest of shutdown sequence and destructors happen in ~TestingSetup()\n+    // Make sure coin_stats_index is not used by the scheduler thread after it\n+    // has been destroyed.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r984359905",
      "id" : 984359905,
      "in_reply_to_id" : 983896572,
      "line" : 83,
      "node_id" : "PRRC_kwDOABII5846rCPh",
      "original_commit_id" : "3ae1fe44981cabb4bf5e714ccaac4659e8cb3f50",
      "original_line" : 83,
      "original_position" : 6,
      "original_start_line" : 82,
      "path" : "src/test/coinstatsindex_tests.cpp",
      "position" : 6,
      "pull_request_review_id" : 1126479491,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/984359905/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 82,
      "start_side" : "RIGHT",
      "updated_at" : "2022-09-30T08:42:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/984359905",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r984602718"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/984602718"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Ok, but see also [#25365 (comment)](https://github.com/bitcoin/bitcoin/issues/25365#issuecomment-1259744133). I could reproduce use-after-free in Valgrind even without adding a call to `GetName()`, just a sleep suffices.\r\n\r\nRight. Your reproduction puts the sleep right before the `UpdatePruneLock(GetName(), ...)` call, so it does not need to add a new call to `GetName()` and does reveal an existing race condition in the test. Marco's reproduction puts that sleep after that and adds another `GetName()` call, so it is really adding a new race condition.\r\n \r\n> I got the impression that when `BaseIndex::SetBestBlockIndex()` executes `this` is already freed, but I do not remember if I checked to access a member before the `m_best_block_index` assignment.\r\n\r\nI don't think this is possible because `BlockUntilSyncedToCurrentChain` would not have returned before the  `m_best_block_index` assignment was done.\r\n\r\n> Moving the assignment to the bottom may fix it. Anyway, this whole story looks overly complicated to me. It shouldn't require multiple people discussing whether this is a bug or not and how to fix it exactly! I opened #26210 to explore an alternative.\r\n\r\nYes I agree moving the assignment to the bottom is not the best long term solution for races generally. I just think moving the assignment is the most direct fix for the race condition introduced in #21726. Also I think it makes code more logical and seems like a reliability improvement. I opened a new PR #26215 which moves the assignment, and I think it would be the way to address the real race condition, and turn the TSAN true positives into false positives. After that, this PR would be a good way to fix remaining false positives (again with the suggestion that I think it would be better for test shutdown sequence to be 1-flush 2-stop 3-destroy not 1-stop 2-flush 3-destroy so test behavior is closer to bitcoind shutdown behavior).\r\n\r\n\r\n\r\n",
      "commit_id" : "3ae1fe44981cabb4bf5e714ccaac4659e8cb3f50",
      "created_at" : "2022-09-30T13:37:41Z",
      "diff_hunk" : "@@ -79,7 +79,9 @@ BOOST_FIXTURE_TEST_CASE(coinstatsindex_initial_sync, TestChain100Setup)\n     // Shutdown sequence (c.f. Shutdown() in init.cpp)\n     coin_stats_index.Stop();\n \n-    // Rest of shutdown sequence and destructors happen in ~TestingSetup()\n+    // Make sure coin_stats_index is not used by the scheduler thread after it\n+    // has been destroyed.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r984602718",
      "id" : 984602718,
      "in_reply_to_id" : 983896572,
      "line" : 83,
      "node_id" : "PRRC_kwDOABII5846r9he",
      "original_commit_id" : "3ae1fe44981cabb4bf5e714ccaac4659e8cb3f50",
      "original_line" : 83,
      "original_position" : 6,
      "original_start_line" : 82,
      "path" : "src/test/coinstatsindex_tests.cpp",
      "position" : 6,
      "pull_request_review_id" : 1126839803,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/984602718/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 82,
      "start_side" : "RIGHT",
      "updated_at" : "2022-09-30T13:38:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/984602718",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`3ae1fe4498...d2395c83c4`: rebase + move `SyncWithValidationInterfaceQueue()` before `coin_stats_index.Stop()` as [suggested above](https://github.com/bitcoin/bitcoin/pull/26188#discussion_r983896572).\r\n\r\nI think this should be good to go, unrelated to other PRs, as a minimal change that fixes the problem, to be included in 24.x.",
      "created_at" : "2022-10-04T10:40:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26188#issuecomment-1266751570",
      "id" : 1266751570,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26188",
      "node_id" : "IC_kwDOABII585LgRhS",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1266751570/reactions"
      },
      "updated_at" : "2022-10-04T10:43:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1266751570",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r986713002"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/986713002"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If you move this, it would be good to update the other places as well.\r\n\r\nMy preference would be to use the same fix in all unit tests and not use a different fix for each unit test.",
      "commit_id" : "c4566600be3b3744d0bb7d0747efabd09b29abf3",
      "created_at" : "2022-10-04T10:44:38Z",
      "diff_hunk" : "@@ -76,10 +76,12 @@ BOOST_FIXTURE_TEST_CASE(coinstatsindex_initial_sync, TestChain100Setup)\n \n     BOOST_CHECK(block_index != new_block_index);\n \n+    // Make sure coin_stats_index is not used by the scheduler thread after it\n+    // has been destroyed.\n+    SyncWithValidationInterfaceQueue();\n+\n     // Shutdown sequence (c.f. Shutdown() in init.cpp)\n     coin_stats_index.Stop();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r986713002",
      "id" : 986713002,
      "line" : 84,
      "node_id" : "PRRC_kwDOABII58460Auq",
      "original_commit_id" : "d2395c83c406f96e3c8c3d638684823c7ada493c",
      "original_line" : 84,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/test/coinstatsindex_tests.cpp",
      "position" : 9,
      "pull_request_review_id" : 1129693872,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/986713002/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-04T10:44:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/986713002",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r986714285"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/986714285"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I this is a false positive, I wonder what the steps are to reproduce. After all tsan should be deterministic, assuming manual sleeps are added at the right places?",
      "commit_id" : "c4566600be3b3744d0bb7d0747efabd09b29abf3",
      "created_at" : "2022-10-04T10:46:15Z",
      "diff_hunk" : "@@ -79,7 +79,9 @@ BOOST_FIXTURE_TEST_CASE(coinstatsindex_initial_sync, TestChain100Setup)\n     // Shutdown sequence (c.f. Shutdown() in init.cpp)\n     coin_stats_index.Stop();\n \n-    // Rest of shutdown sequence and destructors happen in ~TestingSetup()\n+    // Make sure coin_stats_index is not used by the scheduler thread after it\n+    // has been destroyed.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r986714285",
      "id" : 986714285,
      "in_reply_to_id" : 983896572,
      "line" : 80,
      "node_id" : "PRRC_kwDOABII58460BCt",
      "original_commit_id" : "3ae1fe44981cabb4bf5e714ccaac4659e8cb3f50",
      "original_line" : 80,
      "original_position" : 6,
      "original_start_line" : 82,
      "path" : "src/test/coinstatsindex_tests.cpp",
      "position" : 5,
      "pull_request_review_id" : 1129695816,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/986714285/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 79,
      "start_side" : "RIGHT",
      "updated_at" : "2022-10-04T10:46:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/986714285",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`d2395c83c4..c4566600be`: use same shutdown order also in `txindex_tests`.",
      "created_at" : "2022-10-04T11:25:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26188#issuecomment-1266811860",
      "id" : 1266811860,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26188",
      "node_id" : "IC_kwDOABII585LggPU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1266811860/reactions"
      },
      "updated_at" : "2022-10-04T11:25:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1266811860",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r986747488"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/986747488"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "That is just in `txindex_tests`, right? Moved.",
      "commit_id" : "c4566600be3b3744d0bb7d0747efabd09b29abf3",
      "created_at" : "2022-10-04T11:25:52Z",
      "diff_hunk" : "@@ -76,10 +76,12 @@ BOOST_FIXTURE_TEST_CASE(coinstatsindex_initial_sync, TestChain100Setup)\n \n     BOOST_CHECK(block_index != new_block_index);\n \n+    // Make sure coin_stats_index is not used by the scheduler thread after it\n+    // has been destroyed.\n+    SyncWithValidationInterfaceQueue();\n+\n     // Shutdown sequence (c.f. Shutdown() in init.cpp)\n     coin_stats_index.Stop();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r986747488",
      "id" : 986747488,
      "in_reply_to_id" : 986713002,
      "line" : 84,
      "node_id" : "PRRC_kwDOABII58460JJg",
      "original_commit_id" : "d2395c83c406f96e3c8c3d638684823c7ada493c",
      "original_line" : 84,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/test/coinstatsindex_tests.cpp",
      "position" : 9,
      "pull_request_review_id" : 1129750242,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/986747488/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-04T11:25:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/986747488",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r986904533"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/986904533"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> I this is a false positive, I wonder what the steps are to reproduce. After all tsan should be deterministic, assuming manual sleeps are added at the right places?\r\n\r\nIf the goal is to reproduce TSAN false positive errors that remain after #26215 fixes the race condition introduced by #21726, maybe a good way would be to put a 2 second sleep at the end of `SetBestBlockIndex` after it assigns `m_best_block_index` and 1 second sleep in the test before it calls `BlockUntilSyncedToCurrentChain`. This way the TSAN should see the scheduler thread reading the vtable ptr, and the test thread writing it, and no apparent synchronization between the two threads because `BlockUntilSyncedToCurrentChain` will return early without ever calling `SyncWithValidationInterfaceQueue`",
      "commit_id" : "c4566600be3b3744d0bb7d0747efabd09b29abf3",
      "created_at" : "2022-10-04T13:58:55Z",
      "diff_hunk" : "@@ -79,7 +79,9 @@ BOOST_FIXTURE_TEST_CASE(coinstatsindex_initial_sync, TestChain100Setup)\n     // Shutdown sequence (c.f. Shutdown() in init.cpp)\n     coin_stats_index.Stop();\n \n-    // Rest of shutdown sequence and destructors happen in ~TestingSetup()\n+    // Make sure coin_stats_index is not used by the scheduler thread after it\n+    // has been destroyed.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r986904533",
      "id" : 986904533,
      "in_reply_to_id" : 983896572,
      "line" : 80,
      "node_id" : "PRRC_kwDOABII58460vfV",
      "original_commit_id" : "3ae1fe44981cabb4bf5e714ccaac4659e8cb3f50",
      "original_line" : 80,
      "original_position" : 6,
      "original_start_line" : 82,
      "path" : "src/test/coinstatsindex_tests.cpp",
      "position" : 5,
      "pull_request_review_id" : 1129988825,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/986904533/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 79,
      "start_side" : "RIGHT",
      "updated_at" : "2022-10-04T14:27:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/986904533",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r986917069"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/986917069"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"test: fix race in shutdown code in coinstatsindex_initial_sync\" (d2395c83c406f96e3c8c3d638684823c7ada493c)\r\n\r\nAfter #26215 is merged, this comment \"Make sure coin_stats_index is not used by the scheduler thread after it has been destroyed\" will be misleading, because the previous `BlockUntilSyncedToCurrentChain` above will already be waiting for the scheduler thread, and the only purpose of this `SyncWithValidationInterfaceQueue` call will be to silence TSAN errors.",
      "commit_id" : "c4566600be3b3744d0bb7d0747efabd09b29abf3",
      "created_at" : "2022-10-04T14:09:10Z",
      "diff_hunk" : "@@ -76,10 +76,12 @@ BOOST_FIXTURE_TEST_CASE(coinstatsindex_initial_sync, TestChain100Setup)\n \n     BOOST_CHECK(block_index != new_block_index);\n \n+    // Make sure coin_stats_index is not used by the scheduler thread after it\n+    // has been destroyed.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r986917069",
      "id" : 986917069,
      "line" : 80,
      "node_id" : "PRRC_kwDOABII58460yjN",
      "original_commit_id" : "d2395c83c406f96e3c8c3d638684823c7ada493c",
      "original_line" : 80,
      "original_position" : 5,
      "original_start_line" : 79,
      "path" : "src/test/coinstatsindex_tests.cpp",
      "position" : 5,
      "pull_request_review_id" : 1129988825,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/986917069/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 79,
      "start_side" : "RIGHT",
      "updated_at" : "2022-10-04T14:27:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/986917069",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "#26215 has been merged. @vasild can you rebase/follow up with @ryanofsky's recent comments here.",
      "created_at" : "2022-10-10T06:28:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26188#issuecomment-1272837890",
      "id" : 1272837890,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26188",
      "node_id" : "IC_kwDOABII585L3fcC",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1272837890/reactions"
      },
      "updated_at" : "2022-10-10T06:28:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1272837890",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`c4566600be...26bef2957f`: rebase and adjust after https://github.com/bitcoin/bitcoin/pull/26215\r\n\r\nNote - I cannot reproduce this with the steps from https://github.com/bitcoin/bitcoin/pull/26188#discussion_r986904533.",
      "created_at" : "2022-10-10T13:31:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26188#issuecomment-1273318015",
      "id" : 1273318015,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26188",
      "node_id" : "IC_kwDOABII585L5Up_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1273318015/reactions"
      },
      "updated_at" : "2022-10-10T13:31:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1273318015",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r991292727"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/991292727"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Reworded.",
      "commit_id" : "26bef2957f3f24b505f133c691ad94832a69dd05",
      "created_at" : "2022-10-10T13:31:50Z",
      "diff_hunk" : "@@ -76,10 +76,12 @@ BOOST_FIXTURE_TEST_CASE(coinstatsindex_initial_sync, TestChain100Setup)\n \n     BOOST_CHECK(block_index != new_block_index);\n \n+    // Make sure coin_stats_index is not used by the scheduler thread after it\n+    // has been destroyed.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r991292727",
      "id" : 991292727,
      "in_reply_to_id" : 986917069,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5847Fe03",
      "original_commit_id" : "d2395c83c406f96e3c8c3d638684823c7ada493c",
      "original_line" : 80,
      "original_position" : 5,
      "original_start_line" : 79,
      "path" : "src/test/coinstatsindex_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1136026818,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/991292727/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-10-10T13:31:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/991292727",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Update title/OP?",
      "created_at" : "2022-10-10T13:44:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26188#issuecomment-1273334656",
      "id" : 1273334656,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26188",
      "node_id" : "IC_kwDOABII585L5YuA",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1273334656/reactions"
      },
      "updated_at" : "2022-10-10T13:44:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1273334656",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Update title/OP?\r\n\r\nDone, sorry.",
      "created_at" : "2022-10-10T14:45:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26188#issuecomment-1273427836",
      "id" : 1273427836,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26188",
      "node_id" : "IC_kwDOABII585L5vd8",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1273427836/reactions"
      },
      "updated_at" : "2022-10-10T14:45:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1273427836",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I can't reproduce this either",
      "created_at" : "2022-10-10T15:45:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26188#issuecomment-1273508567",
      "id" : 1273508567,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26188",
      "node_id" : "IC_kwDOABII585L6DLX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1273508567/reactions"
      },
      "updated_at" : "2022-10-10T15:45:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1273508567",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r991559721"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/991559721"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"test: silence TSAN false positive in coinstatsindex_initial_sync\" (b3e76f92e05da022009ad65a97f8f9f95b4373c5)\r\n\r\nSince we don't have simple reproduction steps anymore, and TSAN implementation details are a little opaque, maybe it is better to say what this is trying to do at a higher level like \"// It is not safe to stop and destroy the index until it finishes handling the last BlockConnected notification. The BlockUntilSyncedToCurrentChain call above is sufficient to ensure this, but the SyncWithValidationInterfaceQueue call below is also needed to ensure TSAN always sees the test thread waiting for the notification thread, and avoid potential false positive reports.\"",
      "commit_id" : "26bef2957f3f24b505f133c691ad94832a69dd05",
      "created_at" : "2022-10-10T18:45:27Z",
      "diff_hunk" : "@@ -76,10 +76,15 @@ BOOST_FIXTURE_TEST_CASE(coinstatsindex_initial_sync, TestChain100Setup)\n \n     BOOST_CHECK(block_index != new_block_index);\n \n+    // Silence false positives from TSAN about unsynchronized calls to",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r991559721",
      "id" : 991559721,
      "line" : 79,
      "node_id" : "PRRC_kwDOABII5847GgAp",
      "original_commit_id" : "26bef2957f3f24b505f133c691ad94832a69dd05",
      "original_line" : 79,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/test/coinstatsindex_tests.cpp",
      "position" : 4,
      "pull_request_review_id" : 1136413928,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/991559721/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-10T19:10:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/991559721",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r991930363"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/991930363"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Changed the comments, thanks!",
      "commit_id" : "861cb3fadce88cfaee27088185a48f03fb9dafe7",
      "created_at" : "2022-10-11T07:48:53Z",
      "diff_hunk" : "@@ -76,10 +76,15 @@ BOOST_FIXTURE_TEST_CASE(coinstatsindex_initial_sync, TestChain100Setup)\n \n     BOOST_CHECK(block_index != new_block_index);\n \n+    // Silence false positives from TSAN about unsynchronized calls to",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26188#discussion_r991930363",
      "id" : 991930363,
      "in_reply_to_id" : 991559721,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5847H6f7",
      "original_commit_id" : "26bef2957f3f24b505f133c691ad94832a69dd05",
      "original_line" : 79,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/test/coinstatsindex_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1136931447,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26188",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/991930363/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-11T07:48:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/991930363",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`26bef2957f...861cb3fadc`: reword the comments\r\n\r\n> ... remove the `SyncWithValidationInterfaceQueue` calls and comments from both tests ...\r\n\r\nI am also ok with this, since it is a test-only and a false positive, to leave it \"unfixed\" until it happens again in CI, if ever. @MarcoFalke, what do you think?",
      "created_at" : "2022-10-11T07:52:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26188#issuecomment-1274246677",
      "id" : 1274246677,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26188",
      "node_id" : "IC_kwDOABII585L83YV",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1274246677/reactions"
      },
      "updated_at" : "2022-10-11T07:52:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1274246677",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "review ACK 861cb3fadce88cfaee27088185a48f03fb9dafe7\r\n\r\nI think anything is fine here. Either keep both or delete both.",
      "created_at" : "2022-10-11T08:00:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26188#issuecomment-1274258156",
      "id" : 1274258156,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26188",
      "node_id" : "IC_kwDOABII585L86Ls",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1274258156/reactions"
      },
      "updated_at" : "2022-10-11T08:00:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1274258156",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
