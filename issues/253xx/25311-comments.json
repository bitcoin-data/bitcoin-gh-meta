[
   {
      "author_association" : "MEMBER",
      "body" : "This can be tested trivially by adding a construction-by-copy somewhere and verifying the compiler rejects it:\r\n```\r\n% make\r\nMaking all in src\r\nmake[1]: Entering directory '/home/james/src/bitcoin/src'\r\nmake[2]: Entering directory '/home/james/src/bitcoin/src'\r\nmake[3]: Entering directory '/home/james/src/bitcoin'\r\nmake[3]: Leaving directory '/home/james/src/bitcoin'\r\n  CXX      libbitcoin_node_a-validation.o\r\n  CXX      libbitcoin_util_a-clientversion.o\r\n  AR       libbitcoin_util.a\r\n  CXXLD    bitcoin-util\r\n  CXXLD    bitcoin-wallet\r\n  CXXLD    bitcoin-cli\r\n  CXXLD    bitcoin-tx\r\nvalidation.cpp:4170:29: error: calling a protected constructor of class 'CBlockIndex'\r\n            auto newblock = CBlockIndex(*block);\r\n                            ^\r\n./chain.h:369:5: note: declared protected here\r\n    CBlockIndex(const CBlockIndex&) = default;\r\n    ^\r\n1 error generated.\r\n```",
      "created_at" : "2022-06-08T17:01:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25311#issuecomment-1150168593",
      "id" : 1150168593,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25311",
      "node_id" : "IC_kwDOABII585Eji4R",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1150168593/reactions"
      },
      "updated_at" : "2022-06-08T17:01:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1150168593",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r892642454"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892642454"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Pretty sure this will later-on result in a use-after-free? ",
      "commit_id" : "62f6e49b20162f7987a446dc3f20d6ebff61bf54",
      "created_at" : "2022-06-08T17:01:30Z",
      "diff_hunk" : "@@ -57,7 +57,7 @@ FUZZ_TARGET_INIT(pow, initialize_pow)\n             } else {\n                 current_block.nChainWork = ConsumeArithUInt256(fuzzed_data_provider);\n             }\n-            blocks.push_back(current_block);\n+            blocks.push_back(&current_block);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r892642454",
      "id" : 892642454,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5841NKSW",
      "original_commit_id" : "28e019236bcfd797e70f59f8a8945e59b0426727",
      "original_line" : 60,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/test/fuzz/pow.cpp",
      "position" : null,
      "pull_request_review_id" : 1000129389,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892642454/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-08T17:03:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892642454",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r892649186"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892649186"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Consider using the rule of five? https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#c21-if-you-define-or-delete-any-copy-move-or-destructor-function-define-or-delete-them-all. Example in https://github.com/bitcoin/bitcoin/pull/22481.\r\n\r\nNot sure (haven't tested), would it be better to define these separately in CBlockIndex (= delete) and CDiskBlockIndex (= default)? ",
      "commit_id" : "62f6e49b20162f7987a446dc3f20d6ebff61bf54",
      "created_at" : "2022-06-08T17:09:20Z",
      "diff_hunk" : "@@ -355,6 +355,19 @@ class CBlockIndex\n     //! Efficiently find an ancestor of this block.\n     CBlockIndex* GetAncestor(int height);\n     const CBlockIndex* GetAncestor(int height) const;\n+\n+protected:\n+    //! CBlockIndex should not allow public copy construction because equality\n+    //! comparison via pointer is very common throughout the codebase, making\n+    //! use of copy a footgun. Also, use of copies do not have the benefit\n+    //! of simplifying lifetime considerations due to attributes like pprev and\n+    //! pskip, which are at risk of becoming dangling pointers in a copied\n+    //! instance.\n+    //!\n+    //! We declare these protected instead of simply deleting them so that\n+    //! CDiskBlockIndex can reuse copy construction.\n+    CBlockIndex(const CBlockIndex&) = default;\n+    CBlockIndex& operator=(const CBlockIndex&) = default;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r892649186",
      "id" : 892649186,
      "line" : 370,
      "node_id" : "PRRC_kwDOABII5841NL7i",
      "original_commit_id" : "28e019236bcfd797e70f59f8a8945e59b0426727",
      "original_line" : 370,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/chain.h",
      "position" : 16,
      "pull_request_review_id" : 1000138811,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892649186/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-08T17:11:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892649186",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2022-06-08T17:09:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25311#issuecomment-1150178297",
      "id" : 1150178297,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25311",
      "node_id" : "IC_kwDOABII585EjlP5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1150178297/reactions"
      },
      "updated_at" : "2022-06-08T17:09:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1150178297",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r892681484"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892681484"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Argh, good catch. Thought I'd checked for that. Fixed.",
      "commit_id" : "62f6e49b20162f7987a446dc3f20d6ebff61bf54",
      "created_at" : "2022-06-08T17:40:50Z",
      "diff_hunk" : "@@ -57,7 +57,7 @@ FUZZ_TARGET_INIT(pow, initialize_pow)\n             } else {\n                 current_block.nChainWork = ConsumeArithUInt256(fuzzed_data_provider);\n             }\n-            blocks.push_back(current_block);\n+            blocks.push_back(&current_block);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r892681484",
      "id" : 892681484,
      "in_reply_to_id" : 892642454,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5841NT0M",
      "original_commit_id" : "28e019236bcfd797e70f59f8a8945e59b0426727",
      "original_line" : 60,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/test/fuzz/pow.cpp",
      "position" : null,
      "pull_request_review_id" : 1000182387,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892681484/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-08T17:40:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892681484",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r892684389"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892684389"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Hmm, the CI fuzz run initially passed on this test: https://cirrus-ci.com/task/5646660507271168?logs=ci#L3420 . I wonder why it didn't catch that.",
      "commit_id" : "62f6e49b20162f7987a446dc3f20d6ebff61bf54",
      "created_at" : "2022-06-08T17:44:27Z",
      "diff_hunk" : "@@ -57,7 +57,7 @@ FUZZ_TARGET_INIT(pow, initialize_pow)\n             } else {\n                 current_block.nChainWork = ConsumeArithUInt256(fuzzed_data_provider);\n             }\n-            blocks.push_back(current_block);\n+            blocks.push_back(&current_block);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r892684389",
      "id" : 892684389,
      "in_reply_to_id" : 892642454,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5841NUhl",
      "original_commit_id" : "28e019236bcfd797e70f59f8a8945e59b0426727",
      "original_line" : 60,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/test/fuzz/pow.cpp",
      "position" : null,
      "pull_request_review_id" : 1000186365,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892684389/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-08T17:44:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892684389",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r892706470"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892706470"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Rule of 5\r\n\r\nSounds good, fixed.\r\n\r\n> Not sure (haven't tested), would it be better to define these separately in CBlockIndex (= delete) and CDiskBlockIndex (= default)?\r\n\r\nThis doesn't work because to get a default copy constructor, the signature needs to look like `T(const T&) = default;`; because the CDiskBlockIndex constructor in question has a reference to a CBlockIndex pointer, we can't make use of a default copy constructor for CDiskBlockIndex. If we define one, we have to spell out all members from CBlockIndex, which is brittle.",
      "commit_id" : "62f6e49b20162f7987a446dc3f20d6ebff61bf54",
      "created_at" : "2022-06-08T18:03:56Z",
      "diff_hunk" : "@@ -355,6 +355,19 @@ class CBlockIndex\n     //! Efficiently find an ancestor of this block.\n     CBlockIndex* GetAncestor(int height);\n     const CBlockIndex* GetAncestor(int height) const;\n+\n+protected:\n+    //! CBlockIndex should not allow public copy construction because equality\n+    //! comparison via pointer is very common throughout the codebase, making\n+    //! use of copy a footgun. Also, use of copies do not have the benefit\n+    //! of simplifying lifetime considerations due to attributes like pprev and\n+    //! pskip, which are at risk of becoming dangling pointers in a copied\n+    //! instance.\n+    //!\n+    //! We declare these protected instead of simply deleting them so that\n+    //! CDiskBlockIndex can reuse copy construction.\n+    CBlockIndex(const CBlockIndex&) = default;\n+    CBlockIndex& operator=(const CBlockIndex&) = default;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r892706470",
      "id" : 892706470,
      "in_reply_to_id" : 892649186,
      "line" : 370,
      "node_id" : "PRRC_kwDOABII5841NZ6m",
      "original_commit_id" : "28e019236bcfd797e70f59f8a8945e59b0426727",
      "original_line" : 370,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/chain.h",
      "position" : 16,
      "pull_request_review_id" : 1000215190,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892706470/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-08T18:03:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892706470",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r893193685"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893193685"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`valgrind` doesn't catch this either. Looks like the compiler will just optimize this UB away and set all objects to the same pointer, even if they are different?\r\n\r\nThis is mildly shocking, as it makes it impossible to catch this kind of bug with any tool.",
      "commit_id" : "62f6e49b20162f7987a446dc3f20d6ebff61bf54",
      "created_at" : "2022-06-09T08:00:39Z",
      "diff_hunk" : "@@ -57,7 +57,7 @@ FUZZ_TARGET_INIT(pow, initialize_pow)\n             } else {\n                 current_block.nChainWork = ConsumeArithUInt256(fuzzed_data_provider);\n             }\n-            blocks.push_back(current_block);\n+            blocks.push_back(&current_block);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r893193685",
      "id" : 893193685,
      "in_reply_to_id" : 892642454,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5841PQ3V",
      "original_commit_id" : "28e019236bcfd797e70f59f8a8945e59b0426727",
      "original_line" : 60,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/test/fuzz/pow.cpp",
      "position" : null,
      "pull_request_review_id" : 1000890206,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893193685/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-09T08:00:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893193685",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r893618339"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893618339"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That's scary. Glad my fuzz-via-idiocy technique is yielding more novel info about C++ compilers.",
      "commit_id" : "62f6e49b20162f7987a446dc3f20d6ebff61bf54",
      "created_at" : "2022-06-09T15:01:07Z",
      "diff_hunk" : "@@ -57,7 +57,7 @@ FUZZ_TARGET_INIT(pow, initialize_pow)\n             } else {\n                 current_block.nChainWork = ConsumeArithUInt256(fuzzed_data_provider);\n             }\n-            blocks.push_back(current_block);\n+            blocks.push_back(&current_block);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r893618339",
      "id" : 893618339,
      "in_reply_to_id" : 892642454,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5841Q4ij",
      "original_commit_id" : "28e019236bcfd797e70f59f8a8945e59b0426727",
      "original_line" : 60,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/test/fuzz/pow.cpp",
      "position" : null,
      "pull_request_review_id" : 1001496734,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893618339/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-09T15:01:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893618339",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r893757851"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893757851"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"remove CBlockIndex copy construction\" (62f6e49b20162f7987a446dc3f20d6ebff61bf54)\r\n\r\nThis looks like it is the only virtual method so it is going to add a vtable pointer to every CBlockIndex instance and waste memory. (I also don't see a reason to declare a destructor here, \"rule of 5\" notwithstanding. If there is a reason, more helpful IMO to just say what the reason is instead of citing a 537 page guidelines document!)",
      "commit_id" : "0497d76a944182b739d9abfd963c032a7d1dbd89",
      "created_at" : "2022-06-09T17:07:53Z",
      "diff_hunk" : "@@ -355,6 +355,25 @@ class CBlockIndex\n     //! Efficiently find an ancestor of this block.\n     CBlockIndex* GetAncestor(int height);\n     const CBlockIndex* GetAncestor(int height) const;\n+\n+protected:\n+    //! CBlockIndex should not allow public copy construction because equality\n+    //! comparison via pointer is very common throughout the codebase, making\n+    //! use of copy a footgun. Also, use of copies do not have the benefit\n+    //! of simplifying lifetime considerations due to attributes like pprev and\n+    //! pskip, which are at risk of becoming dangling pointers in a copied\n+    //! instance.\n+    //!\n+    //! We declare these protected instead of simply deleting them so that\n+    //! CDiskBlockIndex can reuse copy construction.\n+    CBlockIndex(const CBlockIndex&) = default;\n+    CBlockIndex& operator=(const CBlockIndex&) = default;\n+    CBlockIndex(CBlockIndex&&) = delete;\n+    CBlockIndex& operator=(CBlockIndex&&) = delete;\n+\n+public:\n+    // Here to satisfy the \"rule of 5,\" but must be public.\n+    virtual ~CBlockIndex() = default;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r893757851",
      "id" : 893757851,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5841Ramb",
      "original_commit_id" : "62f6e49b20162f7987a446dc3f20d6ebff61bf54",
      "original_line" : 376,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/chain.h",
      "position" : null,
      "pull_request_review_id" : 1001705640,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893757851/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-09T17:07:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893757851",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r893901255"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893901255"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ha, well put. Pushed.",
      "commit_id" : "0497d76a944182b739d9abfd963c032a7d1dbd89",
      "created_at" : "2022-06-09T19:54:39Z",
      "diff_hunk" : "@@ -355,6 +355,25 @@ class CBlockIndex\n     //! Efficiently find an ancestor of this block.\n     CBlockIndex* GetAncestor(int height);\n     const CBlockIndex* GetAncestor(int height) const;\n+\n+protected:\n+    //! CBlockIndex should not allow public copy construction because equality\n+    //! comparison via pointer is very common throughout the codebase, making\n+    //! use of copy a footgun. Also, use of copies do not have the benefit\n+    //! of simplifying lifetime considerations due to attributes like pprev and\n+    //! pskip, which are at risk of becoming dangling pointers in a copied\n+    //! instance.\n+    //!\n+    //! We declare these protected instead of simply deleting them so that\n+    //! CDiskBlockIndex can reuse copy construction.\n+    CBlockIndex(const CBlockIndex&) = default;\n+    CBlockIndex& operator=(const CBlockIndex&) = default;\n+    CBlockIndex(CBlockIndex&&) = delete;\n+    CBlockIndex& operator=(CBlockIndex&&) = delete;\n+\n+public:\n+    // Here to satisfy the \"rule of 5,\" but must be public.\n+    virtual ~CBlockIndex() = default;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r893901255",
      "id" : 893901255,
      "in_reply_to_id" : 893757851,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5841R9nH",
      "original_commit_id" : "62f6e49b20162f7987a446dc3f20d6ebff61bf54",
      "original_line" : 376,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/chain.h",
      "position" : null,
      "pull_request_review_id" : 1001904320,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893901255/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-09T19:54:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893901255",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "IIUC correctly, the issue here is that of (or similar to) slicing: a pointer to a derived class implicitly converts to one to its public base class, and with copy operations this becomes a subtle footgun. Looking through various resources, two solutions appear to be:\r\n\r\n- disallow copying of the base class by deleting the copy operations or making them private or protected, and providing a clone() function if needed to allow a user to request a non-slicing copy, or\r\n- disallow converting a pointer to the derived class to a pointer to a base by making the base class a private or protected base\r\n\r\nThis PR opts for the first solution, which seems fine. This approach is also suggested at the bottom of https://en.cppreference.com/w/cpp/language/rule_of_three and in the guideline [\"A polymorphic class should suppress public copy/move\"](https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md#Rc-copy-virtual).\r\n\r\nThe last push removing the public virtual destructor in the base class involves some tradeoffs that might be discussed. Not declaring it reduces the size of CBlockIndex and CDiskBlockIndex from 152 to 144 and 184 to 176 bytes, respectively, a saving of 8 bytes due to not needing a hidden vptr class data member pointer (as well as avoiding a vtbl + pointer entry and dynamic dispatch in general).  In most cases, those additional costs are considered relatively low, so declaring destructors virtual is a good practice as a safety mechanism for unintended polymorphic destruction (destructing derived class objects through pointers or references of base class types).\r\n\r\nNot declaring the virtual destructor is also only possible due to issues with the current design.  Inherited non-virtual functions should never be redefined to avoid inconsistent behavior (**Scott Meyers, Effective C++, Item 36**), yet that is what we're currently doing with `GetBlockHash()` and `ToString()`, either from oversight or as a hack to avoid making them virtual. Items 34 and 35 in that book suggest alternatives (Template Pattern/NVI Idiom, Strategy Patterns), but as a start it may be prudent and less footgunny for future reviewers and bug avoidance to consider keeping the explicit virtual public destructor in the base and making those two functions `virtual` in CBlockIndex and `override` in the derived CDiskBlockIndex.\r\n\r\nIf the overhead of dynamic dispatch is unacceptable, maybe there is a better/safer design than the current one, but if we intend for CBlockIndex to be inherited from, consider if its destructor and redefined methods ought to be virtual.  If CBlockIndex is not intended to be inherited from, it can be marked as `final` to prevent that in the first place, without imposing any other use restrictions on the class itself.\r\n\r\nI'm not an expert, so have been trying to understand this area better from researching it.  A couple related resources:\r\n\r\nScott Meyers, Effective C++, Item 8: *Polymorphic base classes should declare virtual destructors. If a class has any virtual functions, it should have a virtual destructor. Classes not designed to be base classes or not designed to be used polymorphically should not declare virtual destructors.*\r\n\r\nStroustroup, https://www.stroustrup.com/C++11FAQ.html#default2, *I strongly recommend that if you declare one of these five functions, you explicitly declare all.  Think of copying, moving, and destruction as closely related operations, rather than individual operations that you can freely mix and match - you can specify arbitrary combinations, but only a few combinations make sense semantically.*\r\n\r\nHerb Sutter, http://www.gotw.ca/publications/mill18.htm, *Guideline 4: A base class destructor should be either public and virtual, or protected and nonvirtual. / Don't derive from concrete classes. Or, as Scott Meyers puts it in Item 33 of More Effective C++, \"Make non-leaf classes abstract.\"*",
      "created_at" : "2022-06-10T15:06:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25311#issuecomment-1152460744",
      "id" : 1152460744,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25311",
      "node_id" : "IC_kwDOABII585EsSfI",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1152460744/reactions"
      },
      "updated_at" : "2022-06-11T15:30:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1152460744",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> IIUC correctly, the issue here is that of (or similar to) slicing: a pointer to a derived class implicitly converts to one to its public base class, and with copy operations this becomes a subtle footgun\r\n\r\n\r\nThis may or may not be a problem, but was not the primary motivation I mentioned. The motivation is simply that creating an exact copy will (obviously) create a new memory location where the copy lives (aka pointer). This is problematic when the value of the pointer is used to check for equality/unequality of objects.\r\n\r\nFor example,\r\n\r\n```cpp\r\nbool IsTip(const CBlockIndex& b) { return &b == ::ActiveTip(); }\r\nint main() {\r\n const CBlockIndex tip{*Assert(::ActiveTip())};\r\n Assert(IsTip(&tip));\r\n}\r\n```\r\n\r\nwill fail.",
      "created_at" : "2022-06-10T15:14:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25311#issuecomment-1152468630",
      "id" : 1152468630,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25311",
      "node_id" : "IC_kwDOABII585EsUaW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1152468630/reactions"
      },
      "updated_at" : "2022-06-10T15:14:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1152468630",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Appreciate the thorough response jonatack , and agree declaring a virtual destructor could prevent slicing issues if virtual methods were added in the future, and also agree that use of inheritance in CBlockIndex is pretty sketchy, with overridden nonvirtual methods being a sign of that.\r\n\r\nI may be biased because I tend to think of classes with virtual methods designed to be overridden as pretty different things from simple classes that just encapsulate some state, but I wouldn't think it is a good tradeoff to make class destructors virtual by default just because there is a chance someone may inherit from the class and try to use it polymorphically in the future. I think whoever is doing this later should be able to spot problems and that in the worst case \"class has virtual method but non-virtual destructor\" compiler warnings should help them.\r\n\r\nIt's hard to think about future-bugs that don't yet exist in a complex language like c++, and I think c++ guidelines are good for generating ideas about bugs that may happen. But after you decide to prevent a bug, it should be possible to say what the bug is without citing guidelines as an authority. It is easy to go in circles thinking about guidelines abstractly and I think it is better to keep things concrete.",
      "created_at" : "2022-06-10T16:12:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25311#issuecomment-1152522683",
      "id" : 1152522683,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25311",
      "node_id" : "IC_kwDOABII585Eshm7",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1152522683/reactions"
      },
      "updated_at" : "2022-06-10T16:12:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1152522683",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The last sentence of the commit message needs to be updated, otherwise tested ACK 0497d76a944182b739d9abfd963c032a7d1dbd89 code review, verified that this change fixes both slicing and the failing pointer equality check of an exact copy with the following diff partly derived from https://github.com/bitcoin/bitcoin/pull/25311#issuecomment-1152468630:\r\n\r\n<details><summary>unit test diff</summary><p>\r\n\r\n```diff\r\n--- a/src/test/validation_chainstatemanager_tests.cpp\r\n+++ b/src/test/validation_chainstatemanager_tests.cpp\r\n@@ -24,6 +24,23 @@ using node::SnapshotMetadata;\r\n\r\n+static bool IsTip(const CBlockIndex& b, const ChainstateManager& m)\r\n+{\r\n+    return &b == m.ActiveTip();\r\n+}\r\n+\r\n+static void naive(CBlockIndex* p)\r\n+{\r\n+    CBlockIndex b = *p; // may slice: invokes CBlockIndex:CBlockIndex(const CBlockIndex&), runs on master, raises a build error after this change\r\n+}\r\n+\r\n+static void user()\r\n+{\r\n+    CDiskBlockIndex d;\r\n+    naive(&d);\r\n+    CBlockIndex bb = d; // slices: invokes CBlockIndex:CBlockIndex(const CBlockIndex&) rather than CDiskBlockIndex:CDiskBlockIndex(const CDiskBlockIndex&), runs on master, raises a build error after this change\r\n+}\r\n+\r\n //! Basic tests for ChainstateManager.\r\n@@ -310,6 +327,11 @@ BOOST_FIXTURE_TEST_CASE(chainstatemanager_activate_snapshot, TestChain100Setup)\r\n     BOOST_CHECK_EQUAL(\r\n         *chainman.ActiveChainstate().m_from_snapshot_blockhash,\r\n         loaded_snapshot_blockhash);\r\n+\r\n+    // Pointer equality sanity check after exact copy.\r\n+    const CBlockIndex index{*Assert(chainman.ActiveTip())}; // runs on master, raises a build error after this change\r\n+    BOOST_CHECK(IsTip(index, chainman)); // fails on master\r\n+    user(); // to avoid -Werror for unused function\r\n }\r\n```\r\n</p></details>\r\n",
      "created_at" : "2022-06-11T15:10:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25311#issuecomment-1152947654",
      "id" : 1152947654,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25311",
      "node_id" : "IC_kwDOABII585EuJXG",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1152947654/reactions"
      },
      "updated_at" : "2022-06-11T15:18:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1152947654",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ryanofsky Good points. To follow up on our discussion, I wrote a failing test and implementation of a non-virtual public interface that calls private virtual implementation methods, i.e. the Template pattern via the Non-Virtual Interface (NVI) idiom, that makes the test pass in https://github.com/jonatack/bitcoin/commits/CBlockIndex-CDiskBlockIndex-class-design. Then, based on our discussion here, opted to propose a simpler change in https://github.com/bitcoin/bitcoin/pull/25349 that doesn't add a vptr or vtable.",
      "created_at" : "2022-06-12T14:30:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25311#issuecomment-1153188732",
      "id" : 1153188732,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25311",
      "node_id" : "IC_kwDOABII585EvEN8",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1153188732/reactions"
      },
      "updated_at" : "2022-06-12T14:30:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1153188732",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r895300642"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/895300642"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This code is already buggy if the vector were to ever be moved while being resized? Could have been a `std::array<CBlockIndex, 10000>` perhaps.",
      "commit_id" : "5b84eb8760ee71135950d31739f8cbaa669256b8",
      "created_at" : "2022-06-13T03:32:21Z",
      "diff_hunk" : "@@ -25,17 +25,18 @@ FUZZ_TARGET_INIT(pow, initialize_pow)\n {\n     FuzzedDataProvider fuzzed_data_provider(buffer.data(), buffer.size());\n     const Consensus::Params& consensus_params = Params().GetConsensus();\n-    std::vector<CBlockIndex> blocks;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r895300642",
      "id" : 895300642,
      "line" : 28,
      "node_id" : "PRRC_kwDOABII5841XTQi",
      "original_commit_id" : "0497d76a944182b739d9abfd963c032a7d1dbd89",
      "original_line" : 28,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/test/fuzz/pow.cpp",
      "position" : 4,
      "pull_request_review_id" : 1003749547,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/895300642/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-13T04:35:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/895300642",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r895301995"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/895301995"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`operator=` isn't needed as far as I can see; is there any reason to default rather than delete it?",
      "commit_id" : "5b84eb8760ee71135950d31739f8cbaa669256b8",
      "created_at" : "2022-06-13T03:37:36Z",
      "diff_hunk" : "@@ -355,6 +355,19 @@ class CBlockIndex\n     //! Efficiently find an ancestor of this block.\n     CBlockIndex* GetAncestor(int height);\n     const CBlockIndex* GetAncestor(int height) const;\n+\n+protected:\n+    //! CBlockIndex should not allow public copy construction because equality\n+    //! comparison via pointer is very common throughout the codebase, making\n+    //! use of copy a footgun. Also, use of copies do not have the benefit\n+    //! of simplifying lifetime considerations due to attributes like pprev and\n+    //! pskip, which are at risk of becoming dangling pointers in a copied\n+    //! instance.\n+    //!\n+    //! We declare these protected instead of simply deleting them so that\n+    //! CDiskBlockIndex can reuse copy construction.\n+    CBlockIndex(const CBlockIndex&) = default;\n+    CBlockIndex& operator=(const CBlockIndex&) = default;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r895301995",
      "id" : 895301995,
      "in_reply_to_id" : 892649186,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5841XTlr",
      "original_commit_id" : "28e019236bcfd797e70f59f8a8945e59b0426727",
      "original_line" : 370,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/chain.h",
      "position" : null,
      "pull_request_review_id" : 1003749547,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/895301995/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-13T04:35:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/895301995",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r895318403"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/895318403"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think `CDiskBlockIndex::ToString` is only used in the fuzz test; and renaming `GetBlockHash` to `CalculateBlockHash` would help avoid the \"virtual\" concerns:\r\n\r\n```c++\r\n    uint256 GetBlockHash() const = delete;\r\n    uint256 CalculateBlockHash() const\r\n    {\r\n        CBlockHeader block;\r\n        block.nVersion = nVersion;\r\n        ...\r\n    }\r\n \r\n    std::string ToString() const = delete;\r\n};\r\n```\r\n\r\nAnother alternative might be:\r\n\r\n```c++\r\nclass CDiskBlockIndex\r\n{\r\nprivate:\r\n    CBlockIndex m_cbi;\r\npublic:\r\n    uint256 hashPrev;\r\n    CDiskBlockIndex(const CBlockIndex* pindex)\r\n    {\r\n        m_cbi.pprev = pindex->pprev;\r\n        m_cbi.nHeight = pindex->nHeight;\r\n        ...\r\n    }\r\n    void SetCBlockIndex(CBlockIndex* pindex) const\r\n    {\r\n        pindex->nHeight = m_cbi.nHeight;\r\n        ...\r\n    }\r\n    uint256 CalculateBlockHash() const;\r\n    SERIALIZE_METHODS(...) { ... }\r\n};\r\n```\r\n\r\nie, defining the \"copy\" code explicitly, which would let you move the explicit copy code in `CBlockTreeDB::LoadBlockIndexGuts()` into `diskindex.Set(pindexNew);`. At least they're in one place, that way, and you can prevent any implicit copies of `CBlockIndex`?\r\n\r\nI'm not seeing any other ways of improving on this though -- you can't have `CDiskBlockIndex` use a reference to a `CBlockIndex`, because the ref has to be non-const for deserialization, and const for serialization, and it can't simultaneously be both; and you can't move de/serialization into `CBlockIndex` because it needs to store `hashPrev` on deser, and doesn't have anywhere to do so...",
      "commit_id" : "5b84eb8760ee71135950d31739f8cbaa669256b8",
      "created_at" : "2022-06-13T04:30:25Z",
      "diff_hunk" : "@@ -355,6 +355,21 @@ class CBlockIndex\n     //! Efficiently find an ancestor of this block.\n     CBlockIndex* GetAncestor(int height);\n     const CBlockIndex* GetAncestor(int height) const;\n+\n+protected:\n+    //! CBlockIndex should not allow public copy construction because equality\n+    //! comparison via pointer is very common throughout the codebase, making\n+    //! use of copy a footgun. Also, use of copies do not have the benefit\n+    //! of simplifying lifetime considerations due to attributes like pprev and\n+    //! pskip, which are at risk of becoming dangling pointers in a copied\n+    //! instance.\n+    //!\n+    //! We declare these protected instead of simply deleting them so that\n+    //! CDiskBlockIndex can reuse copy construction.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r895318403",
      "id" : 895318403,
      "line" : 368,
      "node_id" : "PRRC_kwDOABII5841XXmD",
      "original_commit_id" : "0497d76a944182b739d9abfd963c032a7d1dbd89",
      "original_line" : 368,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/chain.h",
      "position" : 14,
      "pull_request_review_id" : 1003749547,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/895318403/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-13T04:35:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/895318403",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r895341595"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/895341595"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> I think `CDiskBlockIndex::ToString` is only used in the fuzz test; and renaming `GetBlockHash` to `CalculateBlockHash` would help avoid the \"virtual\" concerns\n\nYes, done in #25349 mentioned in my comment above.",
      "commit_id" : "5b84eb8760ee71135950d31739f8cbaa669256b8",
      "created_at" : "2022-06-13T05:37:54Z",
      "diff_hunk" : "@@ -355,6 +355,21 @@ class CBlockIndex\n     //! Efficiently find an ancestor of this block.\n     CBlockIndex* GetAncestor(int height);\n     const CBlockIndex* GetAncestor(int height) const;\n+\n+protected:\n+    //! CBlockIndex should not allow public copy construction because equality\n+    //! comparison via pointer is very common throughout the codebase, making\n+    //! use of copy a footgun. Also, use of copies do not have the benefit\n+    //! of simplifying lifetime considerations due to attributes like pprev and\n+    //! pskip, which are at risk of becoming dangling pointers in a copied\n+    //! instance.\n+    //!\n+    //! We declare these protected instead of simply deleting them so that\n+    //! CDiskBlockIndex can reuse copy construction.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r895341595",
      "id" : 895341595,
      "in_reply_to_id" : 895318403,
      "line" : 368,
      "node_id" : "PRRC_kwDOABII5841XdQb",
      "original_commit_id" : "0497d76a944182b739d9abfd963c032a7d1dbd89",
      "original_line" : 368,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/chain.h",
      "position" : 14,
      "pull_request_review_id" : 1003802810,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/895341595/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-13T05:37:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/895341595",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [MarcoFalke](https://github.com/bitcoin/bitcoin/pull/25311#pullrequestreview-1219863156), [ajtowns](https://github.com/bitcoin/bitcoin/pull/25311#issuecomment-1356726699) |\n| Stale ACK | [ryanofsky](https://github.com/bitcoin/bitcoin/pull/25311#pullrequestreview-1003030903), [jonatack](https://github.com/bitcoin/bitcoin/pull/25311#issuecomment-1152947654) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.\n",
      "created_at" : "2022-06-15T08:55:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25311#issuecomment-1156189716",
      "id" : 1156189716,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25311",
      "node_id" : "IC_kwDOABII585E6g4U",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1156189716/reactions"
      },
      "updated_at" : "2022-12-18T08:05:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1156189716",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-07-25T15:18:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25311#issuecomment-1194188777",
      "id" : 1194188777,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25311",
      "node_id" : "IC_kwDOABII585HLd_p",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1194188777/reactions"
      },
      "updated_at" : "2022-07-25T15:18:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1194188777",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jamesob update with @ajtowns  review feedback? The rebase should be trivial.",
      "created_at" : "2022-07-25T16:34:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25311#issuecomment-1194326841",
      "id" : 1194326841,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25311",
      "node_id" : "IC_kwDOABII585HL_s5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1194326841/reactions"
      },
      "updated_at" : "2022-07-25T16:34:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1194326841",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the ping @jonatack, will get back to this in the next day or so.",
      "created_at" : "2022-07-25T19:29:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25311#issuecomment-1194522655",
      "id" : 1194522655,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25311",
      "node_id" : "IC_kwDOABII585HMvgf",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1194522655/reactions"
      },
      "updated_at" : "2022-07-25T19:29:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1194522655",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r965180375"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/965180375"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> operator= isn't needed as far as I can see\r\n\r\nGood point, done. ",
      "commit_id" : "5b84eb8760ee71135950d31739f8cbaa669256b8",
      "created_at" : "2022-09-07T19:02:24Z",
      "diff_hunk" : "@@ -355,6 +355,19 @@ class CBlockIndex\n     //! Efficiently find an ancestor of this block.\n     CBlockIndex* GetAncestor(int height);\n     const CBlockIndex* GetAncestor(int height) const;\n+\n+protected:\n+    //! CBlockIndex should not allow public copy construction because equality\n+    //! comparison via pointer is very common throughout the codebase, making\n+    //! use of copy a footgun. Also, use of copies do not have the benefit\n+    //! of simplifying lifetime considerations due to attributes like pprev and\n+    //! pskip, which are at risk of becoming dangling pointers in a copied\n+    //! instance.\n+    //!\n+    //! We declare these protected instead of simply deleting them so that\n+    //! CDiskBlockIndex can reuse copy construction.\n+    CBlockIndex(const CBlockIndex&) = default;\n+    CBlockIndex& operator=(const CBlockIndex&) = default;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r965180375",
      "id" : 965180375,
      "in_reply_to_id" : 892649186,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845h3vX",
      "original_commit_id" : "28e019236bcfd797e70f59f8a8945e59b0426727",
      "original_line" : 370,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/chain.h",
      "position" : null,
      "pull_request_review_id" : 1099668647,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/965180375/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-07T19:02:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/965180375",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r965180883"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/965180883"
         }
      },
      "author_association" : "MEMBER",
      "body" : "As far as I can tell, this feedback thread has been addressed by @jonatack's merged change - but let me know if not @ajtowns.",
      "commit_id" : "5b84eb8760ee71135950d31739f8cbaa669256b8",
      "created_at" : "2022-09-07T19:03:09Z",
      "diff_hunk" : "@@ -355,6 +355,21 @@ class CBlockIndex\n     //! Efficiently find an ancestor of this block.\n     CBlockIndex* GetAncestor(int height);\n     const CBlockIndex* GetAncestor(int height) const;\n+\n+protected:\n+    //! CBlockIndex should not allow public copy construction because equality\n+    //! comparison via pointer is very common throughout the codebase, making\n+    //! use of copy a footgun. Also, use of copies do not have the benefit\n+    //! of simplifying lifetime considerations due to attributes like pprev and\n+    //! pskip, which are at risk of becoming dangling pointers in a copied\n+    //! instance.\n+    //!\n+    //! We declare these protected instead of simply deleting them so that\n+    //! CDiskBlockIndex can reuse copy construction.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r965180883",
      "id" : 965180883,
      "in_reply_to_id" : 895318403,
      "line" : 368,
      "node_id" : "PRRC_kwDOABII5845h33T",
      "original_commit_id" : "0497d76a944182b739d9abfd963c032a7d1dbd89",
      "original_line" : 368,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/chain.h",
      "position" : 14,
      "pull_request_review_id" : 1099669370,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/965180883/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-07T19:03:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/965180883",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Delete move constructors and declare the destructor to satisfy the\r\n\"rule of 5.\"\r\n\r\nCode doesn't seem to actually declare the destructor. Maybe:\r\n\r\n```diff\r\n-    CBlockIndex()\r\n-    {\r\n-    }\r\n+    CBlockIndex() = default;\r\n+    ~CBlockIndex() = default;\r\n```",
      "created_at" : "2022-09-08T01:25:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25311#issuecomment-1240110932",
      "id" : 1240110932,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25311",
      "node_id" : "IC_kwDOABII585J6pdU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1240110932/reactions"
      },
      "updated_at" : "2022-09-08T01:25:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1240110932",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r966155442"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/966155442"
         }
      },
      "author_association" : "MEMBER",
      "body" : "why?\r\n\r\nIf there is a reason for the change, it would be good to make it in a separate commit, or explain why it needs to be done in this commit.\r\n\r\nIf there is no reason, it would be better to not make the change.",
      "commit_id" : "5b84eb8760ee71135950d31739f8cbaa669256b8",
      "created_at" : "2022-09-08T16:08:00Z",
      "diff_hunk" : "@@ -14,28 +14,32 @@\n FUZZ_TARGET(chain)\n {\n     FuzzedDataProvider fuzzed_data_provider(buffer.data(), buffer.size());\n-    std::optional<CDiskBlockIndex> disk_block_index = ConsumeDeserializable<CDiskBlockIndex>(fuzzed_data_provider);\n-    if (!disk_block_index) {\n+    const std::vector<uint8_t> index_buff = ConsumeRandomLengthByteVector(fuzzed_data_provider);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r966155442",
      "id" : 966155442,
      "line" : 17,
      "node_id" : "PRRC_kwDOABII5845llyy",
      "original_commit_id" : "5b84eb8760ee71135950d31739f8cbaa669256b8",
      "original_line" : 17,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/test/fuzz/chain.cpp",
      "position" : 6,
      "pull_request_review_id" : 1101019483,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/966155442/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-08T16:08:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/966155442",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r967353843"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/967353843"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Huh, weird, can't remember why I did this but as you suggest it does compile without. Removed.",
      "commit_id" : "89fcfc872eebd8a177561189575f67da27752cb1",
      "created_at" : "2022-09-09T18:20:03Z",
      "diff_hunk" : "@@ -14,28 +14,32 @@\n FUZZ_TARGET(chain)\n {\n     FuzzedDataProvider fuzzed_data_provider(buffer.data(), buffer.size());\n-    std::optional<CDiskBlockIndex> disk_block_index = ConsumeDeserializable<CDiskBlockIndex>(fuzzed_data_provider);\n-    if (!disk_block_index) {\n+    const std::vector<uint8_t> index_buff = ConsumeRandomLengthByteVector(fuzzed_data_provider);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r967353843",
      "id" : 967353843,
      "in_reply_to_id" : 966155442,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845qKXz",
      "original_commit_id" : "5b84eb8760ee71135950d31739f8cbaa669256b8",
      "original_line" : 17,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/test/fuzz/chain.cpp",
      "position" : null,
      "pull_request_review_id" : 1102732921,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/967353843/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-09T18:20:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/967353843",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Pushed feedback from @ajtowns, @MarcoFalke. Thanks guys.",
      "created_at" : "2022-09-09T18:20:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25311#issuecomment-1242321144",
      "id" : 1242321144,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25311",
      "node_id" : "IC_kwDOABII585KDFD4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1242321144/reactions"
      },
      "updated_at" : "2022-09-09T18:20:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1242321144",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "cc @jonatack @LarryRuane @ryanofsky ",
      "created_at" : "2022-10-12T19:30:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25311#issuecomment-1276643596",
      "id" : 1276643596,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25311",
      "node_id" : "IC_kwDOABII585MGAkM",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1276643596/reactions"
      },
      "updated_at" : "2022-10-12T19:30:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1276643596",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r1050048907"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1050048907"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n        CBlockIndex& current_block{*blocks.emplace_back(std::make_unique<CBlockIndex>(*block_header))};\r\n```\r\n\r\nnit, can write in one line",
      "commit_id" : "36c201feb74bbb87d22bd956373dbbb9c47fb7e7",
      "created_at" : "2022-12-15T19:21:39Z",
      "diff_hunk" : "@@ -25,17 +25,18 @@ FUZZ_TARGET_INIT(pow, initialize_pow)\n {\n     FuzzedDataProvider fuzzed_data_provider(buffer.data(), buffer.size());\n     const Consensus::Params& consensus_params = Params().GetConsensus();\n-    std::vector<CBlockIndex> blocks;\n+    std::vector<std::unique_ptr<CBlockIndex>> blocks;\n     const uint32_t fixed_time = fuzzed_data_provider.ConsumeIntegral<uint32_t>();\n     const uint32_t fixed_bits = fuzzed_data_provider.ConsumeIntegral<uint32_t>();\n     LIMITED_WHILE(fuzzed_data_provider.remaining_bytes() > 0, 10000) {\n         const std::optional<CBlockHeader> block_header = ConsumeDeserializable<CBlockHeader>(fuzzed_data_provider);\n         if (!block_header) {\n             continue;\n         }\n-        CBlockIndex current_block{*block_header};\n+        blocks.push_back(std::make_unique<CBlockIndex>(*block_header));\n+        CBlockIndex& current_block = *blocks.back();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r1050048907",
      "id" : 1050048907,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-lnmL",
      "original_commit_id" : "89fcfc872eebd8a177561189575f67da27752cb1",
      "original_line" : 37,
      "original_position" : 15,
      "original_start_line" : 36,
      "path" : "src/test/fuzz/pow.cpp",
      "position" : null,
      "pull_request_review_id" : 1219815128,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1050048907/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-12-15T19:28:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1050048907",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r1050053029"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1050053029"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    auto index{std::make_unique<CBlockIndex>()};\r\n```\r\n\r\nnit: No need to repeat the same type redundantly in one line",
      "commit_id" : "36c201feb74bbb87d22bd956373dbbb9c47fb7e7",
      "created_at" : "2022-12-15T19:26:14Z",
      "diff_hunk" : "@@ -78,11 +78,11 @@ constexpr static struct {\n               {0, 792342903},  {6, 678455063},  {6, 773251385},  {5, 186617471}, {6, 883189502},  {7, 396077336},\n               {8, 254702874},  {0, 455592851}};\n \n-static CBlockIndex CreateBlockIndex(int nHeight, CBlockIndex* active_chain_tip) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+static std::unique_ptr<CBlockIndex> CreateBlockIndex(int nHeight, CBlockIndex* active_chain_tip) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n {\n-    CBlockIndex index;\n-    index.nHeight = nHeight;\n-    index.pprev = active_chain_tip;\n+    std::unique_ptr<CBlockIndex> index = std::make_unique<CBlockIndex>();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25311#discussion_r1050053029",
      "id" : 1050053029,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-loml",
      "original_commit_id" : "89fcfc872eebd8a177561189575f67da27752cb1",
      "original_line" : 83,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/test/miner_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1219815128,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25311",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1050053029/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-15T19:28:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1050053029",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ACK 36c201feb74bbb87d22bd956373dbbb9c47fb7e7 - code review only",
      "created_at" : "2022-12-18T08:05:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25311#issuecomment-1356726699",
      "id" : 1356726699,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25311",
      "node_id" : "IC_kwDOABII585Q3gGr",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1356726699/reactions"
      },
      "updated_at" : "2022-12-18T08:05:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1356726699",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   }
]
