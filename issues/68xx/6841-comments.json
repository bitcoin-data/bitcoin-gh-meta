[
   {
      "body" : "utACK. Test is running now.",
      "created_at" : "2015-10-17T06:25:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6841#issuecomment-148889895",
      "id" : 148889895,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6841",
      "updated_at" : "2015-10-17T06:25:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/148889895",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "What about using the \"relayfee\" provided via \"getnetworkinfo\" as suggested by @dexX7? Also you may append \"Fixes #6834\" to the PR's OP.",
      "created_at" : "2015-10-17T11:49:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6841#issuecomment-148910861",
      "id" : 148910861,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6841",
      "updated_at" : "2015-10-17T11:49:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/148910861",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "@MarcoFalke good idea.  done.",
      "created_at" : "2015-10-17T19:54:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6841#issuecomment-148947589",
      "id" : 148947589,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6841",
      "updated_at" : "2015-10-17T19:54:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/148947589",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "utACK b6d5e32",
      "created_at" : "2015-10-18T12:40:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6841#issuecomment-149007730",
      "id" : 149007730,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6841",
      "updated_at" : "2015-10-18T12:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/149007730",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "Hmm... test won't run on my end:\r\n\r\n```\r\n:~/node/bitcoin$ ./qa/pull-tester/rpc-tests.py pruning\r\nRunning 2nd level testscript pruning.py...\r\nInitializing test directory /tmp/testtSK9Jx\r\nWarning! This test requires 4GB of disk space and takes over 30 mins (up to 2 hours)\r\nMining a big blockchain of 995 blocks\r\nCheck that we haven't started pruning yet because we're below PruneAfterHeight\r\nSuccess\r\nThough we're already using more than 550MB, current usage: 590\r\nMining 25 more blocks should cause the first block file to be pruned\r\nSuccess\r\nUsage should be below target: 479  \r\nCheck that we'll exceed disk space target if we have a very high stale block rate\r\nMine 24 (stale) blocks on Node 1, followed by 25 (main chain) block reorg from Node 0, for 12 rounds\r\nUsage can be over target because of high stale rate: 638\r\nCheck that we can survive a 288 block reorg still\r\nCurrent block height: 1320\r\nInvalidating block at height: 1033 2d671d7c2d0bf06c1514b40b6d2e2388f593262020b6c90a99b28f924b340392\r\nNew best height 1032\r\nGenerating new longer chain of 300 more blocks\r\nReconnect nodes\r\nbitcoind: sync.cpp:112: void potential_deadlock_detected(const std::pair<void*, void*>&, const LockStack&, const LockStack&): Assertion `onlyMaybeDeadlock' failed.\r\nUnexpected exception caught during testing: [Errno 111] Connection refused\r\n  File \"/home/gitian/node/bitcoin/qa/rpc-tests/test_framework/test_framework.py\", line 118, in main\r\n    self.run_test()\r\n  File \"/home/gitian/node/bitcoin/qa/rpc-tests/pruning.py\", line 304, in run_test\r\n    (self.forkheight,self.forkhash) = self.reorg_test() #(1033, )\r\n  File \"/home/gitian/node/bitcoin/qa/rpc-tests/pruning.py\", line 172, in reorg_test\r\n    sync_blocks(self.nodes[0:3])\r\n  File \"/home/gitian/node/bitcoin/qa/rpc-tests/test_framework/util.py\", line 40, in sync_blocks\r\n    counts = [ x.getblockcount() for x in rpc_connections ]\r\n  File \"/home/gitian/node/bitcoin/qa/rpc-tests/test_framework/authproxy.py\", line 138, in __call__\r\n    response = self._request('POST', self.__url.path, postdata)\r\n  File \"/home/gitian/node/bitcoin/qa/rpc-tests/test_framework/authproxy.py\", line 124, in _request\r\n    self.__conn.request(method, path, postdata, headers)\r\n  File \"/usr/lib/python2.7/httplib.py\", line 1001, in request\r\n    self._send_request(method, url, body, headers)\r\n  File \"/usr/lib/python2.7/httplib.py\", line 1035, in _send_request\r\n    self.endheaders(body)\r\n  File \"/usr/lib/python2.7/httplib.py\", line 997, in endheaders\r\n    self._send_output(message_body)\r\n  File \"/usr/lib/python2.7/httplib.py\", line 850, in _send_output\r\n    self.send(msg)\r\n  File \"/usr/lib/python2.7/httplib.py\", line 812, in send\r\n    self.connect()\r\n  File \"/usr/lib/python2.7/httplib.py\", line 793, in connect\r\n    self.timeout, self.source_address)\r\n  File \"/usr/lib/python2.7/socket.py\", line 571, in create_connection\r\n    raise err\r\nStopping nodes\r\nTraceback (most recent call last):\r\n  File \"/home/gitian/node/bitcoin/qa/rpc-tests/pruning.py\", line 359, in <module>\r\n    PruneTest().main()\r\n  File \"/home/gitian/node/bitcoin/qa/rpc-tests/test_framework/test_framework.py\", line 134, in main\r\n    stop_nodes(self.nodes)\r\n  File \"/home/gitian/node/bitcoin/qa/rpc-tests/test_framework/util.py\", line 218, in stop_nodes\r\n    node.stop()\r\n  File \"/home/gitian/node/bitcoin/qa/rpc-tests/test_framework/authproxy.py\", line 138, in __call__\r\n    response = self._request('POST', self.__url.path, postdata)\r\n  File \"/home/gitian/node/bitcoin/qa/rpc-tests/test_framework/authproxy.py\", line 119, in _request\r\n    self.__conn.request(method, path, postdata, headers)\r\n  File \"/usr/lib/python2.7/httplib.py\", line 1001, in request\r\n    self._send_request(method, url, body, headers)\r\n  File \"/usr/lib/python2.7/httplib.py\", line 1029, in _send_request\r\n    self.putrequest(method, url, **skips)\r\n  File \"/usr/lib/python2.7/httplib.py\", line 892, in putrequest\r\n    raise CannotSendRequest()\r\nhttplib.CannotSendRequest\r\n```\r\n\r\nMy head is:\r\n```git\r\ncommit b6d5e32e0e5b038c6ff7e2ab5221b10727722341\r\nAuthor: Alex Morcos <morcos@chaincode.com>\r\n```",
      "created_at" : "2015-10-19T08:39:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6841#issuecomment-149146493",
      "id" : 149146493,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6841",
      "updated_at" : "2015-10-19T08:39:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/149146493",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "@jonasschnelli Seems unrelated to this pull. Can you reproduce the above problem?\r\n\r\nI get for b6d5e32:\r\n```\r\n$ git log --oneline -1\r\nb6d5e32 Make fee aware of min relay in pruning.py RPC test\r\n\r\n$ qa/pull-tester/rpc-tests.py pruning --tmpdir=/var/tmp/BTC\r\nRunning 2nd level testscript pruning.py...\r\nInitializing test directory /var/tmp/BTC\r\nWarning! This test requires 4GB of disk space and takes over 30 mins (up to 2 hours)\r\nMining a big blockchain of 995 blocks\r\nCheck that we haven't started pruning yet because we're below PruneAfterHeight\r\nSuccess\r\nThough we're already using more than 550MB, current usage: 590\r\nMining 25 more blocks should cause the first block file to be pruned\r\nSuccess\r\nUsage should be below target: 479\r\nCheck that we'll exceed disk space target if we have a very high stale block rate\r\nMine 24 (stale) blocks on Node 1, followed by 25 (main chain) block reorg from Node 0, for 12 rounds\r\nUsage can be over target because of high stale rate: 638\r\nCheck that we can survive a 288 block reorg still\r\nCurrent block height: 1320\r\nInvalidating block at height: 1033 423699603f0fe282968c6b7705e431aa44a655e2a511854d6cf1750d5505430a\r\nNew best height 1032\r\nGenerating new longer chain of 300 more blocks\r\nReconnect nodes\r\nVerify height on node 2: 1332\r\nUsage possibly still high bc of stale blocks in block files: 638\r\nMine 220 more blocks so we have requisite history (some blocks will be big and cause pruning of previous chain)\r\nUsage should be below target: 447\r\nTest that we can rerequest a block we previously pruned if needed for a reorg\r\nWill need to redownload block 1033\r\nRewind node 0 to prev main chain to mine longer chain to trigger redownload. Blocks needed: 233\r\nVerify node 2 reorged back to the main chain, some blocks of which it had to redownload\r\nDone\r\nStopping nodes\r\nCleaning up\r\nTests successful\r\n\r\n",
      "created_at" : "2015-10-19T14:59:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6841#issuecomment-149240198",
      "id" : 149240198,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6841",
      "updated_at" : "2015-10-19T14:59:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/149240198",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
