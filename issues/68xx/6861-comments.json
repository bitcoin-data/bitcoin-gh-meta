[
   {
      "author_association" : "MEMBER",
      "body" : "The `getheaders` message we send to our peers uses a block locator calculated from `pindexBestHeader`.\n\nOur peers, upon receving a `getheaders` message, should only return headers starting at the latest fork point between their tip and the tip of our locator.  So in the normal case, our peers wouldn't respond to a `getheaders` message by starting at block 1.  However, I think it is possible for a new node starting up to get an `inv` from a peer while its syncing the headers chain from one of its peers, and before `pindexBestHeader` is very far along.  In that situation I would expect that you could end up downloading most or all of the headers chain from two different peers at the same time.  This is similar to what is reported in #6755.\n\nThere is a comment in the code just below the line you linked, which is to continue from `pindexBestHeader` or `chainActive.Tip()` if the last header they send us is an ancestor of one of those.  Come to think of it, that might go a long way towards mitigating the issue in #6755.\n\nAlso it's not okay to disregard a `headers` message that doesn't start with an unknown header -- if our peer is behaving properly, they might well send us a header we already have, if our chain tip happened to be on a different fork at the time we sent them a `getheaders` message, which didn't include the header in question.  So it's possible for a valid headers message that would help us get to a more-work chain could start from a header that we already know about.\n",
      "created_at" : "2015-10-20T18:40:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6861#issuecomment-149660411",
      "id" : 149660411,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6861",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDE0OTY2MDQxMQ==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/149660411/reactions"
      },
      "updated_at" : "2015-10-20T18:40:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/149660411",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Closing and pushing future discussions to #6755 around duplicate getheaders requests.",
      "created_at" : "2022-08-01T17:25:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6861#issuecomment-1201497504",
      "id" : 1201497504,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6861",
      "node_id" : "IC_kwDOABII585HnWWg",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1201497504/reactions"
      },
      "updated_at" : "2022-08-01T17:25:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1201497504",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/755825?v=4",
         "events_url" : "https://api.github.com/users/adamjonas/events{/privacy}",
         "followers_url" : "https://api.github.com/users/adamjonas/followers",
         "following_url" : "https://api.github.com/users/adamjonas/following{/other_user}",
         "gists_url" : "https://api.github.com/users/adamjonas/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/adamjonas",
         "id" : 755825,
         "login" : "adamjonas",
         "node_id" : "MDQ6VXNlcjc1NTgyNQ==",
         "organizations_url" : "https://api.github.com/users/adamjonas/orgs",
         "received_events_url" : "https://api.github.com/users/adamjonas/received_events",
         "repos_url" : "https://api.github.com/users/adamjonas/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/adamjonas/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/adamjonas/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/adamjonas"
      }
   }
]
