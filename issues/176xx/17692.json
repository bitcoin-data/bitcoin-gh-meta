{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "NONE",
   "body" : "Hi !\r\n\r\nThis issue is related to settings that seems to be different when running `bitcoind` and `bitcoin-qt` on my laptop.\r\n\r\nThanks for help !\r\n\r\n**Is your feature request related to a problem? Please describe.**\r\n<!-- A clear and concise description of what the problem is. Ex. I'm always frustrated when [...] -->\r\nWhen settings are changed in `bitcoin-qt`, no configuration file is created. This has several consequences : \r\n   - `bitcoind` cannot work properly anymore, particulary in the case of a pruned node where it shutdown at start returning `You need to rebuild the database using -reindex to go back to unpruned mode. This will redownload the entire blockchain.\r\nPlease restart with -reindex or -reindex-chainstate to recover.`. `bitcoin-qt` will start normally because it knows that the node is pruned, I have no idea how since it did not write it in  any `bitcoin.conf` (there must be a configuration file somewhere).\r\n   - It is hard to review exactly with what settings the node is running if `bitcoin-qt` has been ran once. In my case, I suspect I have difficulties to run Electrum-Personal-Server (EPS) in multiwallet mode because of some hidden configuration settings (related to the issue https://github.com/chris-belcher/electrum-personal-server/issues/111)\r\n\r\n**Describe the solution you'd like**\r\n<!-- A clear and concise description of what you want to happen. -->\r\nIdeally, all settings changes made in GUI should be reported directly in configuration file `bitcoin.conf` but `bitcoin-qt` could have it's own `bitcoin-qt.conf`. We just need to make it clear about what are the settings used by qt.\r\n\r\n**Describe alternatives you've considered**\r\n<!-- A clear and concise description of any alternative solutions or features you've considered. -->\r\nSettings used for `bitcoin-qt` must be stored somewhere. I did not find any related configuration file other than `bitcoin.conf` in datadir and `.bitcoin` folder. It would be enough to add the location of such file in documentation. \r\n\r\nI am on Ubuntu 18.04, I changed the default datadir, it is well detected by `bitcoind` and `bitcoin-qt` (and the GUI is opening my own config file correctly when I asked him to open the file). But `bitcoind` is not working while `bitcoin-qt` does.\r\n\r\n**Additional context**\r\n<!-- Add any other context or screenshots about the feature request here. -->\r\nHere the logs for `bitcoind` where it shutdowns because of pruning : \r\n\r\n\r\n2019-12-07T15:32:36Z Bitcoin Core version v0.19.0.1 (release build)\r\n2019-12-07T15:32:36Z Assuming ancestors of block 00000000000000000005f8920febd3925f8272a6a71237563d78c2edfdd09ddf have valid signatures.\r\n2019-12-07T15:32:36Z Setting nMinimumChainWork=000000000000000000000000000000000000000008ea3cf107ae0dec57f03fe8\r\n2019-12-07T15:32:36Z Using the 'sse4(1way),sse41(4way),avx2(8way)' SHA256 implementation\r\n2019-12-07T15:32:36Z Using RdRand as an additional entropy source\r\n2019-12-07T15:32:36Z Default data directory /home/login/.bitcoin\r\n2019-12-07T15:32:36Z Using data directory /home/login/Bitcoin\r\n2019-12-07T15:32:36Z Config file: /home/login/Bitcoin/bitcoin.conf\r\n2019-12-07T15:32:36Z Using at most 125 automatic connections (1024 file descriptors available)\r\n2019-12-07T15:32:36Z Using 16 MiB out of 32/2 requested for signature cache, able to store 524288 elements\r\n2019-12-07T15:32:36Z Using 16 MiB out of 32/2 requested for script execution cache, able to store 524288 elements\r\n2019-12-07T15:32:36Z Using 8 threads for script verification\r\n2019-12-07T15:32:36Z scheduler thread start\r\n2019-12-07T15:32:36Z HTTP: creating work queue of depth 16\r\n2019-12-07T15:32:36Z No rpcpassword set - using random cookie authentication.\r\n2019-12-07T15:32:36Z Generated RPC authentication cookie /home/login/Bitcoin/.cookie\r\n2019-12-07T15:32:36Z HTTP: starting 4 worker threads\r\n2019-12-07T15:32:36Z Using wallet directory /home/login/Bitcoin\r\n... load wallets ...\r\n2019-12-07T15:32:36Z init message: Loading banlist...\r\n2019-12-07T15:32:36Z Cache configuration:\r\n2019-12-07T15:32:36Z * Using 2.0 MiB for block index database\r\n2019-12-07T15:32:36Z * Using 8.0 MiB for chain state database\r\n2019-12-07T15:32:36Z * Using 440.0 MiB for in-memory UTXO set (plus up to 286.1 MiB of unused mempool space)\r\n2019-12-07T15:32:36Z init message: Loading block index...\r\n2019-12-07T15:32:36Z Opening LevelDB in /home/login/Bitcoin/blocks/index\r\n2019-12-07T15:32:36Z Opened LevelDB successfully\r\n2019-12-07T15:32:36Z Using obfuscation key for /home/login/Bitcoin/blocks/index: 0000000000000000\r\n2019-12-07T15:32:39Z LoadBlockIndexDB: last block file = 1888\r\n2019-12-07T15:32:39Z LoadBlockIndexDB: last block file info: CBlockFileInfo(blocks=61, size=60399390, heights=607007...607067, time=2019-12-07...2019-12-07)\r\n2019-12-07T15:32:39Z Checking all blk files are present...\r\n2019-12-07T15:32:39Z LoadBlockIndexDB(): Block files have previously been pruned\r\n2019-12-07T15:32:39Z : You need to rebuild the database using -reindex to go back to unpruned mode.  This will redownload the entire blockchain.\r\nPlease restart with -reindex or -reindex-chainstate to recover.\r\n2019-12-07T15:32:39Z Aborted block database rebuild. Exiting.\r\n2019-12-07T15:32:39Z Shutdown: In progress...\r\n2019-12-07T15:32:39Z scheduler thread interrupt\r\n2019-12-07T15:32:39Z Shutdown: done\r\n\r\n\r\n`bitcoin-qt` starts normally with the same configuration : \r\n\r\n2019-12-07T15:40:22Z Bitcoin Core version v0.19.0.1 (release build)\r\n2019-12-07T15:40:22Z Assuming ancestors of block 00000000000000000005f8920febd3925f8272a6a71237563d78c2edfdd09ddf have valid signatures.\r\n2019-12-07T15:40:22Z Setting nMinimumChainWork=000000000000000000000000000000000000000008ea3cf107ae0dec57f03fe8\r\n2019-12-07T15:40:22Z Prune configured to target 190734 MiB on disk for block and undo files.\r\n2019-12-07T15:40:22Z Using the 'sse4(1way),sse41(4way),avx2(8way)' SHA256 implementation\r\n2019-12-07T15:40:22Z Using RdRand as an additional entropy source\r\n2019-12-07T15:40:22Z Default data directory /home/login/.bitcoin\r\n2019-12-07T15:40:22Z Using data directory /home/login/Bitcoin\r\n2019-12-07T15:40:22Z Config file: /home/login/Bitcoin/bitcoin.conf\r\n2019-12-07T15:40:22Z Using at most 125 automatic connections (1024 file descriptors available)\r\n2019-12-07T15:40:22Z Using 16 MiB out of 32/2 requested for signature cache, able to store 524288 elements\r\n2019-12-07T15:40:22Z Using 16 MiB out of 32/2 requested for script execution cache, able to store 524288 elements\r\n2019-12-07T15:40:22Z Using 8 threads for script verification\r\n2019-12-07T15:40:22Z scheduler thread start\r\n2019-12-07T15:40:22Z HTTP: creating work queue of depth 16\r\n2019-12-07T15:40:22Z No rpcpassword set - using random cookie authentication.\r\n2019-12-07T15:40:22Z Generated RPC authentication cookie /home/login/Bitcoin/.cookie\r\n2019-12-07T15:40:22Z HTTP: starting 4 worker threads\r\n2019-12-07T15:40:22Z Using wallet directory /home/login/Bitcoin\r\n2019-12-07T15:40:22Z init message: VÃ©rification des porte-monnaie...\r\n... load wallets...\r\n2019-12-07T15:40:22Z init message: Chargement de la liste dâinterdiction...\r\n2019-12-07T15:40:22Z Cache configuration:\r\n2019-12-07T15:40:22Z * Using 2.0 MiB for block index database\r\n2019-12-07T15:40:22Z * Using 8.0 MiB for chain state database\r\n2019-12-07T15:40:22Z * Using 3990.0 MiB for in-memory UTXO set (plus up to 286.1 MiB of unused mempool space)\r\n2019-12-07T15:40:22Z init message: Chargement de lâindex des blocsâ¦\r\n2019-12-07T15:40:22Z Opening LevelDB in /home/login/Bitcoin/blocks/index\r\n2019-12-07T15:40:22Z Opened LevelDB successfully\r\n2019-12-07T15:40:22Z Using obfuscation key for /home/login/Bitcoin/blocks/index: 0000000000000000\r\n2019-12-07T15:40:25Z LoadBlockIndexDB: last block file = 1888\r\n2019-12-07T15:40:25Z LoadBlockIndexDB: last block file info: CBlockFileInfo(blocks=61, size=60399390, heights=607007...607067, time=2019-12-07...2019-12-07)\r\n2019-12-07T15:40:25Z Checking all blk files are present...\r\n2019-12-07T15:40:25Z LoadBlockIndexDB(): Block files have previously been pruned\r\n2019-12-07T15:40:25Z Opening LevelDB in /home/login/Bitcoin/chainstate\r\n2019-12-07T15:40:25Z Opened LevelDB successfully\r\n2019-12-07T15:40:25Z Using obfuscation key for /home/login/Bitcoin/chainstate: d5826331177f4c85\r\n2019-12-07T15:40:25Z Loaded best chain: hashBestChain=00000000000000000008dc07079dc7649636a1a6e127f422a7b617edc15dfd90 height=607067 date=2019-12-07T15:17:46Z progress=0.999989\r\n2019-12-07T15:40:25Z init message: Rebobinage des blocs...\r\n2019-12-07T15:40:26Z init message: VÃ©rification des blocs... \r\n2019-12-07T15:40:26Z Verifying last 6 blocks at level 3\r\n2019-12-07T15:40:26Z [0%]...[16%]...[33%]...[50%]...[66%]...[83%]...[99%]...[DONE].\r\n2019-12-07T15:40:28Z No coin database inconsistencies in last 6 blocks (17252 transactions)\r\n2019-12-07T15:40:28Z  block index            5561ms\r\n2019-12-07T15:40:28Z init message: Chargement du porte-monnaieâ¦\r\n\r\n\r\nThe config file `bitcoin.conf` in my datadir `/home/login/Bitcoin` contains : \r\n\r\nserver=1\r\nrpcport=8332\r\ndisablewallet=0\r\nwallet=Wallet\r\nwallet=Wallet2\r\n\r\nThe config file in `/home/login/.bitcoin` contains only `datadir=/home/login/Bitcoin`\r\nThis shows that `bitcoin-qt` did not report that it has pruned the node, although it knows it.",
   "closed_at" : "2019-12-08T18:54:36Z",
   "closed_by" : {
      "avatar_url" : "https://avatars1.githubusercontent.com/u/13965245?v=4",
      "events_url" : "https://api.github.com/users/Pantamis/events{/privacy}",
      "followers_url" : "https://api.github.com/users/Pantamis/followers",
      "following_url" : "https://api.github.com/users/Pantamis/following{/other_user}",
      "gists_url" : "https://api.github.com/users/Pantamis/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/Pantamis",
      "id" : 13965245,
      "login" : "Pantamis",
      "node_id" : "MDQ6VXNlcjEzOTY1MjQ1",
      "organizations_url" : "https://api.github.com/users/Pantamis/orgs",
      "received_events_url" : "https://api.github.com/users/Pantamis/received_events",
      "repos_url" : "https://api.github.com/users/Pantamis/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/Pantamis/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/Pantamis/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/Pantamis"
   },
   "comments" : 3,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17692/comments",
   "created_at" : "2019-12-07T17:22:34Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17692/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/17692",
   "id" : 534428019,
   "labels" : [
      {
         "color" : "7cf575",
         "default" : false,
         "description" : null,
         "id" : 64583,
         "name" : "Feature",
         "node_id" : "MDU6TGFiZWw2NDU4Mw==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Feature"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17692/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDU6SXNzdWU1MzQ0MjgwMTk=",
   "number" : 17692,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "Configuration file when settings are changed in GUI",
   "updated_at" : "2019-12-08T18:54:54Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17692",
   "user" : {
      "avatar_url" : "https://avatars1.githubusercontent.com/u/13965245?v=4",
      "events_url" : "https://api.github.com/users/Pantamis/events{/privacy}",
      "followers_url" : "https://api.github.com/users/Pantamis/followers",
      "following_url" : "https://api.github.com/users/Pantamis/following{/other_user}",
      "gists_url" : "https://api.github.com/users/Pantamis/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/Pantamis",
      "id" : 13965245,
      "login" : "Pantamis",
      "node_id" : "MDQ6VXNlcjEzOTY1MjQ1",
      "organizations_url" : "https://api.github.com/users/Pantamis/orgs",
      "received_events_url" : "https://api.github.com/users/Pantamis/received_events",
      "repos_url" : "https://api.github.com/users/Pantamis/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/Pantamis/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/Pantamis/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/Pantamis"
   }
}
