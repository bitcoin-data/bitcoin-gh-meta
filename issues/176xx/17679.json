{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "NONE",
   "body" : "My `bitcoin.conf`:\r\n```\r\n$ cat ~/.bitcoin/bitcoin.conf \r\n[regtest]\r\nblockfilterindex=basic\r\n```\r\nAnd if I launch `bitcoind` specifying `..=basic` *again*, like this:\r\n```\r\n$ ./bitcoind -chain=regtest -blockfilterindex=basic\r\n```\r\n\r\nI get this error (full log below):\r\n```\r\nEXCEPTION: 15dbwrapper_error       \r\nFatal LevelDB error: IO error: lock /home/vincas/.bitcoin/regtest/indexes/blockfilter/basic/db/LOCK: already held by process       \r\nbitcoin in AppInit()\r\n```\r\nDoes not reproduce if I use `-blockfilterindex=1` twice.\r\n\r\n**Expected behavior**\r\n\r\nShould not fatal-away due to redundant command line arguments.\r\n\r\n**Actual behavior**\r\n\r\n`bitcoind` exits with Fatal LevelDB error.\r\n\r\n**To reproduce**\r\n\r\n* Debian Sid\r\n* `../configure --with-incompatible-bdb --with-gui=no` (`incompatile` to use Debian's bdb)\r\n* Have `bitcoin.conf` as noted before.\r\n* Run `./bitcoind -chain=regtest -blockfilterindex=basic`\r\n\r\n**System information**\r\n\r\nBitcoin Core v0.19.0.1 and from current master\r\nDebian Sid amd64.\r\nSame with `bitcoind` and `bitcoin-qt`\r\n\r\nFull output:\r\n```\r\n2019-12-05T18:56:30Z Feeding 34499 bytes of environment data into RNG\r\n2019-12-05T18:56:30Z Bitcoin Core version v0.19.99.0-6fff333c9 (release build)\r\n2019-12-05T18:56:30Z Validating signatures for all blocks.\r\n2019-12-05T18:56:30Z Setting nMinimumChainWork=0000000000000000000000000000000000000000000000000000000000000000\r\n2019-12-05T18:56:30Z Using the 'sse4(1way),sse41(4way),avx2(8way)' SHA256 implementation\r\n2019-12-05T18:56:30Z Using RdRand as an additional entropy source\r\n2019-12-05T18:56:30Z Default data directory /home/vincas/.bitcoin\r\n2019-12-05T18:56:30Z Using data directory /home/vincas/.bitcoin/regtest\r\n2019-12-05T18:56:30Z Config file: /home/vincas/.bitcoin/bitcoin.conf\r\n2019-12-05T18:56:30Z Using at most 125 automatic connections (1024 file descriptors available)\r\n2019-12-05T18:56:30Z Using 16 MiB out of 32/2 requested for signature cache, able to store 524288 elements\r\n2019-12-05T18:56:30Z Using 16 MiB out of 32/2 requested for script execution cache, able to store 524288 elements\r\n2019-12-05T18:56:30Z Script verification uses 7 additional threads\r\n2019-12-05T18:56:30Z scheduler thread start\r\n2019-12-05T18:56:30Z HTTP: creating work queue of depth 16\r\n2019-12-05T18:56:30Z No rpcpassword set - using random cookie authentication.\r\n2019-12-05T18:56:30Z Generated RPC authentication cookie /home/vincas/.bitcoin/regtest/.cookie\r\n2019-12-05T18:56:30Z HTTP: starting 4 worker threads\r\n2019-12-05T18:56:30Z Using wallet directory /home/vincas/.bitcoin/regtest/wallets\r\n2019-12-05T18:56:30Z init message: Verifying wallet(s)...\r\n2019-12-05T18:56:30Z Using BerkeleyDB version Berkeley DB 5.3.28: (September  9, 2013)\r\n2019-12-05T18:56:30Z Using wallet /home/vincas/.bitcoin/regtest/wallets\r\n2019-12-05T18:56:30Z BerkeleyEnvironment::Open: LogDir=/home/vincas/.bitcoin/regtest/wallets/database ErrorFile=/home/vincas/.bitcoin/regtest/wallets/db.log\r\n2019-12-05T18:56:30Z init message: Loading banlist...\r\n2019-12-05T18:56:30Z ERROR: DeserializeFileDB: Failed to open file /home/vincas/.bitcoin/regtest/banlist.dat\r\n2019-12-05T18:56:30Z Invalid or missing banlist.dat; recreating\r\n2019-12-05T18:56:30Z Cache configuration:\r\n2019-12-05T18:56:30Z * Using 2.0 MiB for block index database\r\n2019-12-05T18:56:30Z * Using 28.0 MiB for basic block filter index database\r\n2019-12-05T18:56:30Z * Using 28.0 MiB for basic block filter index database\r\n2019-12-05T18:56:30Z * Using 8.0 MiB for chain state database\r\n2019-12-05T18:56:30Z * Using 384.0 MiB for in-memory UTXO set (plus up to 286.1 MiB of unused mempool space)\r\n2019-12-05T18:56:30Z init message: Loading block index...\r\n2019-12-05T18:56:30Z Opening LevelDB in /home/vincas/.bitcoin/regtest/blocks/index\r\n2019-12-05T18:56:30Z Opened LevelDB successfully\r\n2019-12-05T18:56:30Z Using obfuscation key for /home/vincas/.bitcoin/regtest/blocks/index: 0000000000000000\r\n2019-12-05T18:56:30Z LoadBlockIndexDB: last block file = 0\r\n2019-12-05T18:56:30Z LoadBlockIndexDB: last block file info: CBlockFileInfo(blocks=0, size=0, heights=0...0, time=1970-01-01...1970-01-01)\r\n2019-12-05T18:56:30Z Checking all blk files are present...\r\n2019-12-05T18:56:30Z Initializing databases...\r\n2019-12-05T18:56:30Z Pre-allocating up to position 0x1000000 in blk00000.dat\r\n2019-12-05T18:56:30Z Opening LevelDB in /home/vincas/.bitcoin/regtest/chainstate\r\n2019-12-05T18:56:30Z Opened LevelDB successfully\r\n2019-12-05T18:56:30Z Wrote new obfuscate key for /home/vincas/.bitcoin/regtest/chainstate: 531e5e9ac4b7503b\r\n2019-12-05T18:56:30Z Using obfuscation key for /home/vincas/.bitcoin/regtest/chainstate: 531e5e9ac4b7503b\r\n2019-12-05T18:56:30Z init message: Rewinding blocks...\r\n2019-12-05T18:56:30Z  block index              45ms\r\n2019-12-05T18:56:30Z Opening LevelDB in /home/vincas/.bitcoin/regtest/indexes/blockfilter/basic/db\r\n2019-12-05T18:56:30Z Opened LevelDB successfully\r\n2019-12-05T18:56:30Z Using obfuscation key for /home/vincas/.bitcoin/regtest/indexes/blockfilter/basic/db: 0000000000000000\r\n2019-12-05T18:56:30Z Opening LevelDB in /home/vincas/.bitcoin/regtest/indexes/blockfilter/basic/db\r\n2019-12-05T18:56:30Z basic block filter index thread start\r\n2019-12-05T18:56:30Z basic block filter index is enabled\r\n2019-12-05T18:56:30Z basic block filter index thread exit\r\n2019-12-05T18:56:30Z Fatal LevelDB error: IO error: lock /home/vincas/.bitcoin/regtest/indexes/blockfilter/basic/db/LOCK: already held by process\r\n2019-12-05T18:56:30Z You can use -debug=leveldb to get more complete diagnostic messages\r\n2019-12-05T18:56:30Z \r\n\r\n************************\r\nEXCEPTION: 15dbwrapper_error       \r\nFatal LevelDB error: IO error: lock /home/vincas/.bitcoin/regtest/indexes/blockfilter/basic/db/LOCK: already held by process       \r\nbitcoin in AppInit()       \r\n\r\n\r\n\r\n************************\r\nEXCEPTION: 15dbwrapper_error       \r\nFatal LevelDB error: IO error: lock /home/vincas/.bitcoin/regtest/indexes/blockfilter/basic/db/LOCK: already held by process       \r\nbitcoin in AppInit()       \r\n\r\n2019-12-05T18:56:30Z Shutdown: In progress...\r\n2019-12-05T18:56:30Z scheduler thread interrupt\r\n2019-12-05T18:56:30Z Shutdown: done\r\n\r\n```",
   "closed_at" : "2019-12-12T13:04:39Z",
   "closed_by" : {
      "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
      "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
      "followers_url" : "https://api.github.com/users/fanquake/followers",
      "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/fanquake",
      "id" : 863730,
      "login" : "fanquake",
      "node_id" : "MDQ6VXNlcjg2MzczMA==",
      "organizations_url" : "https://api.github.com/users/fanquake/orgs",
      "received_events_url" : "https://api.github.com/users/fanquake/received_events",
      "repos_url" : "https://api.github.com/users/fanquake/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/fanquake"
   },
   "comments" : 4,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17679/comments",
   "created_at" : "2019-12-05T18:59:05Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17679/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/17679",
   "id" : 533534089,
   "labels" : [
      {
         "color" : "FBBAAB",
         "default" : false,
         "description" : null,
         "id" : 64585,
         "name" : "Bug",
         "node_id" : "MDU6TGFiZWw2NDU4NQ==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug"
      },
      {
         "color" : "c2e0c6",
         "default" : true,
         "description" : null,
         "id" : 349312277,
         "name" : "good first issue",
         "node_id" : "MDU6TGFiZWwzNDkzMTIyNzc=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/good%20first%20issue"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17679/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDU6SXNzdWU1MzM1MzQwODk=",
   "number" : 17679,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "\"Fatal LevelDB error\" when specifying -blockfilterindex=basic twice",
   "updated_at" : "2019-12-12T13:04:39Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17679",
   "user" : {
      "avatar_url" : "https://avatars0.githubusercontent.com/u/292191?v=4",
      "events_url" : "https://api.github.com/users/Talkless/events{/privacy}",
      "followers_url" : "https://api.github.com/users/Talkless/followers",
      "following_url" : "https://api.github.com/users/Talkless/following{/other_user}",
      "gists_url" : "https://api.github.com/users/Talkless/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/Talkless",
      "id" : 292191,
      "login" : "Talkless",
      "node_id" : "MDQ6VXNlcjI5MjE5MQ==",
      "organizations_url" : "https://api.github.com/users/Talkless/orgs",
      "received_events_url" : "https://api.github.com/users/Talkless/received_events",
      "repos_url" : "https://api.github.com/users/Talkless/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/Talkless/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/Talkless/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/Talkless"
   }
}
