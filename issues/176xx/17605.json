{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "Once an output has been spent, the public key of output's receiving address is made public. This allows an attacker wishing to damage a user's privacy to generate new addresses with the same public key and send near-dust to those new addresses. Bitcoin Core (as of version 0.19.0.1) won't recognize the dust as reusing an old address, but the attacker knows that the pair of addresses are owned by the same wallet.\r\n\r\nI made a new wallet, and ran `getnewaddress` three times to get three different addresses: one legacy, one p2sh-segwit, and one bech32:\r\n\r\n    > getnewaddress legacy legacy           # m/0'/0'/0' : mgF6uW48rMAtBDfMuNUyYhLZ14srr19vwG\r\n    > getnewaddress p2sh-segwit p2sh-segwit # m/0'/0'/1' : 2MtjDh43Fkot1AgA8cn7XScpvVkJYYbaMvf\r\n    > getnewaddress bech32 bech32           # m/0'/0'/2' : bcrt1qgsr7w7qnagsk540e24sq4l3hvvu0ccq53nlzak\r\n\r\nI sent 1 BTC to each of these addresses, and then spent those 3 BTC to a throwaway address.\r\n\r\nI then used a 3rd party took to look up the other types of addresses for these public keys, ending up with 9 addresses (three for each of the public keys):\r\n\r\n                 legacy                               p2sh-segwit                           bech32\r\n                 ----------------------------------   -----------------------------------   --------------------------------------------\r\n    m/0'/0'/0'   mgF6uW48rMAtBDfMuNUyYhLZ14srr19vwG   2Mu4jiTgDhqMsRm2AtjjF1TX6winUDUiS3P   bcrt1qqlu238za6fcpm3n0cdl3qmaxc9xvpz96y3xzhk\r\n    m/0'/0'/1'   mhj1WrEcTvn1ZyLoxZuFPk95Yqh9P9jkKw   2MtjDh43Fkot1AgA8cn7XScpvVkJYYbaMvf   bcrt1qrqm7u7v65lz32ej5azn8ucpn973w7hsjgegs3a\r\n    m/0'/0'/2'   mmifiHnhw1zcxQTCLmgPDaDKVvaHyTWnmA   2NFifAoVUxTvCPdR5NJ6WpNs2VbBSJNwEYc   bcrt1qgsr7w7qnagsk540e24sq4l3hvvu0ccq53nlzak\r\n\r\nI then sent coins to each of these 9 addresses to see which ones were recognized as 'reuse':\r\n\r\n    > listunspent 0 0 | jq -cM '[.[] | {reused,amount,address}] | sort_by(.amount)[]'\r\n    {\"reused\":true,\"amount\":1,\"address\":\"mgF6uW48rMAtBDfMuNUyYhLZ14srr19vwG\"}\r\n    {\"reused\":false,\"amount\":2,\"address\":\"2Mu4jiTgDhqMsRm2AtjjF1TX6winUDUiS3P\"}\r\n    {\"reused\":false,\"amount\":3,\"address\":\"bcrt1qqlu238za6fcpm3n0cdl3qmaxc9xvpz96y3xzhk\"}\r\n\r\n    {\"reused\":false,\"amount\":4,\"address\":\"mhj1WrEcTvn1ZyLoxZuFPk95Yqh9P9jkKw\"}\r\n    {\"reused\":true,\"amount\":5,\"address\":\"2MtjDh43Fkot1AgA8cn7XScpvVkJYYbaMvf\"}\r\n    {\"reused\":false,\"amount\":6,\"address\":\"bcrt1qrqm7u7v65lz32ej5azn8ucpn973w7hsjgegs3a\"}\r\n\r\n    {\"reused\":false,\"amount\":7,\"address\":\"mmifiHnhw1zcxQTCLmgPDaDKVvaHyTWnmA\"}\r\n    {\"reused\":false,\"amount\":8,\"address\":\"2NFifAoVUxTvCPdR5NJ6WpNs2VbBSJNwEYc\"}\r\n    {\"reused\":true,\"amount\":9,\"address\":\"bcrt1qgsr7w7qnagsk540e24sq4l3hvvu0ccq53nlzak\"}\r\n\r\nOnly 3 of the 9 were recognized as reuse - the 3 which I had been originally given by `getnewaddress`, whereas for all intents and purposes all 9 are really reuse; an attacker can send dust to any of them and gain information when the dust is spent.\r\n\r\nNote: to get the same keys as I used in this example, you can use the following hdseed:\r\n\r\n    > createwallet wallet_name=test blank=true avoid_reuse=true\r\n    > sethdseed true cNonYmUoYqZ2Qyuk3McU3D65p2bMgHNH4cgmu9xdt6b2GXawiTxT\r\n\r\nEdit: To show that the pubkeys are the same for these addresses:\r\n\r\n    $ for addr in mgF6uW48rMAtBDfMuNUyYhLZ14srr19vwG 2Mu4jiTgDhqMsRm2AtjjF1TX6winUDUiS3P bcrt1qqlu238za6fcpm3n0cdl3qmaxc9xvpz96y3xzhk \\\r\n    >             mhj1WrEcTvn1ZyLoxZuFPk95Yqh9P9jkKw 2MtjDh43Fkot1AgA8cn7XScpvVkJYYbaMvf bcrt1qrqm7u7v65lz32ej5azn8ucpn973w7hsjgegs3a \\\r\n    >             mmifiHnhw1zcxQTCLmgPDaDKVvaHyTWnmA 2NFifAoVUxTvCPdR5NJ6WpNs2VbBSJNwEYc bcrt1qgsr7w7qnagsk540e24sq4l3hvvu0ccq53nlzak\r\n    > do\r\n    >     bcrt getaddressinfo $addr | jq -crM '{pubkey,hdkeypath,address}'\r\n    > done\r\n    {\"pubkey\":\"02dc7bd5438c460e74faf57a63c98937bf381eff623977fce9ec8c099434087047\",\"hdkeypath\":\"m/0'/0'/0'\",\"address\":\"mgF6uW48rMAtBDfMuNUyYhLZ14srr19vwG\"}\r\n    {\"pubkey\":\"02dc7bd5438c460e74faf57a63c98937bf381eff623977fce9ec8c099434087047\",\"hdkeypath\":\"m/0'/0'/0'\",\"address\":\"2Mu4jiTgDhqMsRm2AtjjF1TX6winUDUiS3P\"}\r\n    {\"pubkey\":\"02dc7bd5438c460e74faf57a63c98937bf381eff623977fce9ec8c099434087047\",\"hdkeypath\":\"m/0'/0'/0'\",\"address\":\"bcrt1qqlu238za6fcpm3n0cdl3qmaxc9xvpz96y3xzhk\"}\r\n\r\n    {\"pubkey\":\"024cd5841775e7dc334d3739ef52fc2a7e01ef8eaaa1fc503803711a0602107d54\",\"hdkeypath\":\"m/0'/0'/1'\",\"address\":\"mhj1WrEcTvn1ZyLoxZuFPk95Yqh9P9jkKw\"}\r\n    {\"pubkey\":\"024cd5841775e7dc334d3739ef52fc2a7e01ef8eaaa1fc503803711a0602107d54\",\"hdkeypath\":\"m/0'/0'/1'\",\"address\":\"2MtjDh43Fkot1AgA8cn7XScpvVkJYYbaMvf\"}\r\n    {\"pubkey\":\"024cd5841775e7dc334d3739ef52fc2a7e01ef8eaaa1fc503803711a0602107d54\",\"hdkeypath\":\"m/0'/0'/1'\",\"address\":\"bcrt1qrqm7u7v65lz32ej5azn8ucpn973w7hsjgegs3a\"}\r\n\r\n    {\"pubkey\":\"028c4e68ac42a9d0bc7c11591768b8bdbd25e5c7b666e96d452c9756b0d1acd28b\",\"hdkeypath\":\"m/0'/0'/2'\",\"address\":\"mmifiHnhw1zcxQTCLmgPDaDKVvaHyTWnmA\"}\r\n    {\"pubkey\":\"028c4e68ac42a9d0bc7c11591768b8bdbd25e5c7b666e96d452c9756b0d1acd28b\",\"hdkeypath\":\"m/0'/0'/2'\",\"address\":\"2NFifAoVUxTvCPdR5NJ6WpNs2VbBSJNwEYc\"}\r\n    {\"pubkey\":\"028c4e68ac42a9d0bc7c11591768b8bdbd25e5c7b666e96d452c9756b0d1acd28b\",\"hdkeypath\":\"m/0'/0'/2'\",\"address\":\"bcrt1qgsr7w7qnagsk540e24sq4l3hvvu0ccq53nlzak\"}",
   "closed_at" : "2020-01-07T22:13:37Z",
   "closed_by" : {
      "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
      "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
      "followers_url" : "https://api.github.com/users/fanquake/followers",
      "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/fanquake",
      "id" : 863730,
      "login" : "fanquake",
      "node_id" : "MDQ6VXNlcjg2MzczMA==",
      "organizations_url" : "https://api.github.com/users/fanquake/orgs",
      "received_events_url" : "https://api.github.com/users/fanquake/received_events",
      "repos_url" : "https://api.github.com/users/fanquake/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/fanquake"
   },
   "comments" : 4,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17605/comments",
   "created_at" : "2019-11-25T23:13:28Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17605/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/17605",
   "id" : 528391692,
   "labels" : [
      {
         "color" : "FBBAAB",
         "default" : false,
         "description" : null,
         "id" : 64585,
         "name" : "Bug",
         "node_id" : "MDU6TGFiZWw2NDU4NQ==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug"
      },
      {
         "color" : "08a781",
         "default" : false,
         "description" : null,
         "id" : 149424,
         "name" : "Wallet",
         "node_id" : "MDU6TGFiZWwxNDk0MjQ=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17605/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDU6SXNzdWU1MjgzOTE2OTI=",
   "number" : 17605,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "`avoid_reuse=true` can be bypassed by using pubkey in alternate addresses",
   "updated_at" : "2020-01-07T22:13:37Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17605",
   "user" : {
      "avatar_url" : "https://avatars3.githubusercontent.com/u/573356?v=4",
      "events_url" : "https://api.github.com/users/dooglus/events{/privacy}",
      "followers_url" : "https://api.github.com/users/dooglus/followers",
      "following_url" : "https://api.github.com/users/dooglus/following{/other_user}",
      "gists_url" : "https://api.github.com/users/dooglus/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/dooglus",
      "id" : 573356,
      "login" : "dooglus",
      "node_id" : "MDQ6VXNlcjU3MzM1Ng==",
      "organizations_url" : "https://api.github.com/users/dooglus/orgs",
      "received_events_url" : "https://api.github.com/users/dooglus/received_events",
      "repos_url" : "https://api.github.com/users/dooglus/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/dooglus/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/dooglus/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/dooglus"
   }
}
