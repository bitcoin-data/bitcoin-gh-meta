[
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK\n\nSent from my iPhone\n\n> On Oct 30, 2015, at 6:20 PM, Pieter Wuille notifications@github.com wrote:\n> \n> Changes the -maxsigcachesize argument from entries to megabytes\n> Change the default to 40 MiB (as opposed to ~10 MiB before), corresponding to over 500000 entries on 64-bit systems.\n> Store salted SHA256 hashes in the cache, rather than full entries.\n> Switch implementation from std::set to boost::unordered_set (smaller and faster)\n> You can view, comment on, or merge this pull request online at:\n> \n>   https://github.com/bitcoin/bitcoin/pull/6918\n> \n> Commit Summary\n> \n> Make sigcache faster and more efficient\n> File Changes\n> \n> M src/init.cpp (3)\n> M src/script/sigcache.cpp (80)\n> M src/script/sigcache.h (4)\n> Patch Links:\n> \n> https://github.com/bitcoin/bitcoin/pull/6918.patch\n> https://github.com/bitcoin/bitcoin/pull/6918.diff\n> â\n> Reply to this email directly or view it on GitHub.\n",
      "created_at" : "2015-10-30T22:25:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6918#issuecomment-152664401",
      "id" : 152664401,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6918",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDE1MjY2NDQwMQ==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/152664401/reactions"
      },
      "updated_at" : "2015-10-30T22:25:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/152664401",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=4",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "node_id" : "MDQ6VXNlcjQzNjAzNDk=",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "concept ACK\n",
      "created_at" : "2015-10-30T22:30:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6918#issuecomment-152665537",
      "id" : 152665537,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6918",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDE1MjY2NTUzNw==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/152665537/reactions"
      },
      "updated_at" : "2015-10-30T22:30:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/152665537",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=4",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "node_id" : "MDQ6VXNlcjYyMDYxMQ==",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6918#discussion_r43563101"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/43563101"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "OOI, what is the time complexity of `memusage::DynamicUsage`?\n",
      "commit_id" : "69d373ff6693de204bdf58cbc90f8a26d8f711c8",
      "created_at" : "2015-10-30T23:40:54Z",
      "diff_hunk" : "@@ -23,52 +36,55 @@ namespace {\n class CSignatureCache\n {\n private:\n-     //! sigdata_type is (signature hash, signature, public key):\n-    typedef boost::tuple<uint256, std::vector<unsigned char>, CPubKey> sigdata_type;\n-    std::set< sigdata_type> setValid;\n+     //! Entries are SHA256(nonce || signature hash || public key || signature):\n+    uint256 nonce;\n+    size_t nMaxSize;\n+    typedef boost::unordered_set<uint256, CSignatureCacheHasher> map_type;\n+    map_type setValid;\n     boost::shared_mutex cs_sigcache;\n \n+\n public:\n+    CSignatureCache()\n+    {\n+        GetRandBytes(nonce.begin(), 32);\n+        nMaxSize = GetArg(\"-maxsigcachesize\", DEFAULT_MAX_SIG_CACHE_SIZE) * ((size_t) 1 << 20);\n+    }\n+\n+    void\n+    ComputeEntry(uint256& entry, const uint256 &hash, const std::vector<unsigned char>& vchSig, const CPubKey& pubkey)\n+    {\n+        CSHA256().Write(nonce.begin(), 32).Write(hash.begin(), 32).Write(&pubkey[0], pubkey.size()).Write(&vchSig[0], vchSig.size()).Finalize(entry.begin());\n+    }\n+\n     bool\n-    Get(const uint256 &hash, const std::vector<unsigned char>& vchSig, const CPubKey& pubKey)\n+    Get(const uint256& entry)\n     {\n         boost::shared_lock<boost::shared_mutex> lock(cs_sigcache);\n+        return setValid.count(entry);\n+    }\n \n-        sigdata_type k(hash, vchSig, pubKey);\n-        std::set<sigdata_type>::iterator mi = setValid.find(k);\n-        if (mi != setValid.end())\n-            return true;\n-        return false;\n+    void Erase(const uint256& entry)\n+    {\n+        boost::unique_lock<boost::shared_mutex> lock(cs_sigcache);\n+        setValid.erase(entry);\n     }\n \n-    void Set(const uint256 &hash, const std::vector<unsigned char>& vchSig, const CPubKey& pubKey)\n+    void Set(const uint256& entry)\n     {\n-        // DoS prevention: limit cache size to less than 10MB\n-        // (~200 bytes per cache entry times 50,000 entries)\n-        // Since there are a maximum of 20,000 signature operations per block\n-        // 50,000 is a reasonable default.\n-        int64_t nMaxCacheSize = GetArg(\"-maxsigcachesize\", 50000);\n-        if (nMaxCacheSize <= 0) return;\n+        if (nMaxSize <= 0) return;\n \n         boost::unique_lock<boost::shared_mutex> lock(cs_sigcache);\n-\n-        while (static_cast<int64_t>(setValid.size()) > nMaxCacheSize)\n+        while (memusage::DynamicUsage(setValid) > nMaxSize)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6918#discussion_r43563101",
      "id" : 43563101,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTYzMTAx",
      "original_commit_id" : "e15b9beb617bc7ecedb267310dd3cdcd5628c433",
      "original_line" : null,
      "original_position" : 93,
      "original_start_line" : null,
      "path" : "src/script/sigcache.cpp",
      "position" : null,
      "pull_request_review_id" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6918",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/43563101/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2015-11-02T01:01:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/43563101",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=4",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "node_id" : "MDQ6VXNlcjQxMzM5NQ==",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6918#discussion_r43563145"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/43563145"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: technically, this would mean it could briefly be greater than the allowed memory limits.\n",
      "commit_id" : "69d373ff6693de204bdf58cbc90f8a26d8f711c8",
      "created_at" : "2015-10-30T23:41:50Z",
      "diff_hunk" : "@@ -23,52 +36,55 @@ namespace {\n class CSignatureCache\n {\n private:\n-     //! sigdata_type is (signature hash, signature, public key):\n-    typedef boost::tuple<uint256, std::vector<unsigned char>, CPubKey> sigdata_type;\n-    std::set< sigdata_type> setValid;\n+     //! Entries are SHA256(nonce || signature hash || public key || signature):\n+    uint256 nonce;\n+    size_t nMaxSize;\n+    typedef boost::unordered_set<uint256, CSignatureCacheHasher> map_type;\n+    map_type setValid;\n     boost::shared_mutex cs_sigcache;\n \n+\n public:\n+    CSignatureCache()\n+    {\n+        GetRandBytes(nonce.begin(), 32);\n+        nMaxSize = GetArg(\"-maxsigcachesize\", DEFAULT_MAX_SIG_CACHE_SIZE) * ((size_t) 1 << 20);\n+    }\n+\n+    void\n+    ComputeEntry(uint256& entry, const uint256 &hash, const std::vector<unsigned char>& vchSig, const CPubKey& pubkey)\n+    {\n+        CSHA256().Write(nonce.begin(), 32).Write(hash.begin(), 32).Write(&pubkey[0], pubkey.size()).Write(&vchSig[0], vchSig.size()).Finalize(entry.begin());\n+    }\n+\n     bool\n-    Get(const uint256 &hash, const std::vector<unsigned char>& vchSig, const CPubKey& pubKey)\n+    Get(const uint256& entry)\n     {\n         boost::shared_lock<boost::shared_mutex> lock(cs_sigcache);\n+        return setValid.count(entry);\n+    }\n \n-        sigdata_type k(hash, vchSig, pubKey);\n-        std::set<sigdata_type>::iterator mi = setValid.find(k);\n-        if (mi != setValid.end())\n-            return true;\n-        return false;\n+    void Erase(const uint256& entry)\n+    {\n+        boost::unique_lock<boost::shared_mutex> lock(cs_sigcache);\n+        setValid.erase(entry);\n     }\n \n-    void Set(const uint256 &hash, const std::vector<unsigned char>& vchSig, const CPubKey& pubKey)\n+    void Set(const uint256& entry)\n     {\n-        // DoS prevention: limit cache size to less than 10MB\n-        // (~200 bytes per cache entry times 50,000 entries)\n-        // Since there are a maximum of 20,000 signature operations per block\n-        // 50,000 is a reasonable default.\n-        int64_t nMaxCacheSize = GetArg(\"-maxsigcachesize\", 50000);\n-        if (nMaxCacheSize <= 0) return;\n+        if (nMaxSize <= 0) return;\n \n         boost::unique_lock<boost::shared_mutex> lock(cs_sigcache);\n-\n-        while (static_cast<int64_t>(setValid.size()) > nMaxCacheSize)\n+        while (memusage::DynamicUsage(setValid) > nMaxSize)\n         {\n-            // Evict a random entry. Random because that helps\n-            // foil would-be DoS attackers who might try to pre-generate\n-            // and re-use a set of valid signatures just-slightly-greater\n-            // than our cache size.\n-            uint256 randomHash = GetRandHash();\n-            std::vector<unsigned char> unused;\n-            std::set<sigdata_type>::iterator it =\n-                setValid.lower_bound(sigdata_type(randomHash, unused, unused));\n-            if (it == setValid.end())\n-                it = setValid.begin();\n-            setValid.erase(*it);\n+            map_type::size_type s = GetRand(setValid.bucket_count());\n+            map_type::local_iterator it = setValid.begin(s);\n+            if (it != setValid.end(s)) {\n+                setValid.erase(*it);\n+            }\n         }\n \n-        sigdata_type k(hash, vchSig, pubKey);\n-        setValid.insert(k);\n+        setValid.insert(entry);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6918#discussion_r43563145",
      "id" : 43563145,
      "line" : 86,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTYzMTQ1",
      "original_commit_id" : "e15b9beb617bc7ecedb267310dd3cdcd5628c433",
      "original_line" : null,
      "original_position" : 115,
      "original_start_line" : null,
      "path" : "src/script/sigcache.cpp",
      "position" : 113,
      "pull_request_review_id" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6918",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/43563145/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2015-11-02T01:01:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/43563145",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=4",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "node_id" : "MDQ6VXNlcjQxMzM5NQ==",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "concept ACK, utACK :+1: \n",
      "created_at" : "2015-10-30T23:42:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6918#issuecomment-152674483",
      "id" : 152674483,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6918",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDE1MjY3NDQ4Mw==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/152674483/reactions"
      },
      "updated_at" : "2015-10-30T23:42:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/152674483",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=4",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "node_id" : "MDQ6VXNlcjQxMzM5NQ==",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6918#discussion_r43563182"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/43563182"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`Get` is such a weird name, its really more like `Contains`?\n",
      "commit_id" : "69d373ff6693de204bdf58cbc90f8a26d8f711c8",
      "created_at" : "2015-10-30T23:42:50Z",
      "diff_hunk" : "@@ -23,52 +36,55 @@ namespace {\n class CSignatureCache\n {\n private:\n-     //! sigdata_type is (signature hash, signature, public key):\n-    typedef boost::tuple<uint256, std::vector<unsigned char>, CPubKey> sigdata_type;\n-    std::set< sigdata_type> setValid;\n+     //! Entries are SHA256(nonce || signature hash || public key || signature):\n+    uint256 nonce;\n+    size_t nMaxSize;\n+    typedef boost::unordered_set<uint256, CSignatureCacheHasher> map_type;\n+    map_type setValid;\n     boost::shared_mutex cs_sigcache;\n \n+\n public:\n+    CSignatureCache()\n+    {\n+        GetRandBytes(nonce.begin(), 32);\n+        nMaxSize = GetArg(\"-maxsigcachesize\", DEFAULT_MAX_SIG_CACHE_SIZE) * ((size_t) 1 << 20);\n+    }\n+\n+    void\n+    ComputeEntry(uint256& entry, const uint256 &hash, const std::vector<unsigned char>& vchSig, const CPubKey& pubkey)\n+    {\n+        CSHA256().Write(nonce.begin(), 32).Write(hash.begin(), 32).Write(&pubkey[0], pubkey.size()).Write(&vchSig[0], vchSig.size()).Finalize(entry.begin());\n+    }\n+\n     bool\n-    Get(const uint256 &hash, const std::vector<unsigned char>& vchSig, const CPubKey& pubKey)\n+    Get(const uint256& entry)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6918#discussion_r43563182",
      "id" : 43563182,
      "line" : 59,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTYzMTgy",
      "original_commit_id" : "e15b9beb617bc7ecedb267310dd3cdcd5628c433",
      "original_line" : null,
      "original_position" : 62,
      "original_start_line" : null,
      "path" : "src/script/sigcache.cpp",
      "position" : 60,
      "pull_request_review_id" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6918",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/43563182/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2015-11-02T01:01:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/43563182",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=4",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "node_id" : "MDQ6VXNlcjQxMzM5NQ==",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6918#discussion_r43563220"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/43563220"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`std::static_cast<bool>(count)` or `count > 0`?\n",
      "commit_id" : "69d373ff6693de204bdf58cbc90f8a26d8f711c8",
      "created_at" : "2015-10-30T23:43:40Z",
      "diff_hunk" : "@@ -23,52 +36,55 @@ namespace {\n class CSignatureCache\n {\n private:\n-     //! sigdata_type is (signature hash, signature, public key):\n-    typedef boost::tuple<uint256, std::vector<unsigned char>, CPubKey> sigdata_type;\n-    std::set< sigdata_type> setValid;\n+     //! Entries are SHA256(nonce || signature hash || public key || signature):\n+    uint256 nonce;\n+    size_t nMaxSize;\n+    typedef boost::unordered_set<uint256, CSignatureCacheHasher> map_type;\n+    map_type setValid;\n     boost::shared_mutex cs_sigcache;\n \n+\n public:\n+    CSignatureCache()\n+    {\n+        GetRandBytes(nonce.begin(), 32);\n+        nMaxSize = GetArg(\"-maxsigcachesize\", DEFAULT_MAX_SIG_CACHE_SIZE) * ((size_t) 1 << 20);\n+    }\n+\n+    void\n+    ComputeEntry(uint256& entry, const uint256 &hash, const std::vector<unsigned char>& vchSig, const CPubKey& pubkey)\n+    {\n+        CSHA256().Write(nonce.begin(), 32).Write(hash.begin(), 32).Write(&pubkey[0], pubkey.size()).Write(&vchSig[0], vchSig.size()).Finalize(entry.begin());\n+    }\n+\n     bool\n-    Get(const uint256 &hash, const std::vector<unsigned char>& vchSig, const CPubKey& pubKey)\n+    Get(const uint256& entry)\n     {\n         boost::shared_lock<boost::shared_mutex> lock(cs_sigcache);\n+        return setValid.count(entry);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6918#discussion_r43563220",
      "id" : 43563220,
      "line" : 62,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTYzMjIw",
      "original_commit_id" : "e15b9beb617bc7ecedb267310dd3cdcd5628c433",
      "original_line" : null,
      "original_position" : 65,
      "original_start_line" : null,
      "path" : "src/script/sigcache.cpp",
      "position" : 63,
      "pull_request_review_id" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6918",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/43563220/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2015-11-02T01:01:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/43563220",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=4",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "node_id" : "MDQ6VXNlcjQxMzM5NQ==",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6918#discussion_r43563232"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/43563232"
         }
      },
      "author_association" : "MEMBER",
      "body" : "correct, but we're talking about ~80 bytes...\n",
      "commit_id" : "69d373ff6693de204bdf58cbc90f8a26d8f711c8",
      "created_at" : "2015-10-30T23:43:52Z",
      "diff_hunk" : "@@ -23,52 +36,55 @@ namespace {\n class CSignatureCache\n {\n private:\n-     //! sigdata_type is (signature hash, signature, public key):\n-    typedef boost::tuple<uint256, std::vector<unsigned char>, CPubKey> sigdata_type;\n-    std::set< sigdata_type> setValid;\n+     //! Entries are SHA256(nonce || signature hash || public key || signature):\n+    uint256 nonce;\n+    size_t nMaxSize;\n+    typedef boost::unordered_set<uint256, CSignatureCacheHasher> map_type;\n+    map_type setValid;\n     boost::shared_mutex cs_sigcache;\n \n+\n public:\n+    CSignatureCache()\n+    {\n+        GetRandBytes(nonce.begin(), 32);\n+        nMaxSize = GetArg(\"-maxsigcachesize\", DEFAULT_MAX_SIG_CACHE_SIZE) * ((size_t) 1 << 20);\n+    }\n+\n+    void\n+    ComputeEntry(uint256& entry, const uint256 &hash, const std::vector<unsigned char>& vchSig, const CPubKey& pubkey)\n+    {\n+        CSHA256().Write(nonce.begin(), 32).Write(hash.begin(), 32).Write(&pubkey[0], pubkey.size()).Write(&vchSig[0], vchSig.size()).Finalize(entry.begin());\n+    }\n+\n     bool\n-    Get(const uint256 &hash, const std::vector<unsigned char>& vchSig, const CPubKey& pubKey)\n+    Get(const uint256& entry)\n     {\n         boost::shared_lock<boost::shared_mutex> lock(cs_sigcache);\n+        return setValid.count(entry);\n+    }\n \n-        sigdata_type k(hash, vchSig, pubKey);\n-        std::set<sigdata_type>::iterator mi = setValid.find(k);\n-        if (mi != setValid.end())\n-            return true;\n-        return false;\n+    void Erase(const uint256& entry)\n+    {\n+        boost::unique_lock<boost::shared_mutex> lock(cs_sigcache);\n+        setValid.erase(entry);\n     }\n \n-    void Set(const uint256 &hash, const std::vector<unsigned char>& vchSig, const CPubKey& pubKey)\n+    void Set(const uint256& entry)\n     {\n-        // DoS prevention: limit cache size to less than 10MB\n-        // (~200 bytes per cache entry times 50,000 entries)\n-        // Since there are a maximum of 20,000 signature operations per block\n-        // 50,000 is a reasonable default.\n-        int64_t nMaxCacheSize = GetArg(\"-maxsigcachesize\", 50000);\n-        if (nMaxCacheSize <= 0) return;\n+        if (nMaxSize <= 0) return;\n \n         boost::unique_lock<boost::shared_mutex> lock(cs_sigcache);\n-\n-        while (static_cast<int64_t>(setValid.size()) > nMaxCacheSize)\n+        while (memusage::DynamicUsage(setValid) > nMaxSize)\n         {\n-            // Evict a random entry. Random because that helps\n-            // foil would-be DoS attackers who might try to pre-generate\n-            // and re-use a set of valid signatures just-slightly-greater\n-            // than our cache size.\n-            uint256 randomHash = GetRandHash();\n-            std::vector<unsigned char> unused;\n-            std::set<sigdata_type>::iterator it =\n-                setValid.lower_bound(sigdata_type(randomHash, unused, unused));\n-            if (it == setValid.end())\n-                it = setValid.begin();\n-            setValid.erase(*it);\n+            map_type::size_type s = GetRand(setValid.bucket_count());\n+            map_type::local_iterator it = setValid.begin(s);\n+            if (it != setValid.end(s)) {\n+                setValid.erase(*it);\n+            }\n         }\n \n-        sigdata_type k(hash, vchSig, pubKey);\n-        setValid.insert(k);\n+        setValid.insert(entry);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6918#discussion_r43563232",
      "id" : 43563232,
      "line" : 86,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTYzMjMy",
      "original_commit_id" : "e15b9beb617bc7ecedb267310dd3cdcd5628c433",
      "original_line" : null,
      "original_position" : 115,
      "original_start_line" : null,
      "path" : "src/script/sigcache.cpp",
      "position" : 113,
      "pull_request_review_id" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6918",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/43563232/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2015-11-02T01:01:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/43563232",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6918#discussion_r43563293"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/43563293"
         }
      },
      "author_association" : "MEMBER",
      "body" : "O(1).\n",
      "commit_id" : "69d373ff6693de204bdf58cbc90f8a26d8f711c8",
      "created_at" : "2015-10-30T23:44:40Z",
      "diff_hunk" : "@@ -23,52 +36,55 @@ namespace {\n class CSignatureCache\n {\n private:\n-     //! sigdata_type is (signature hash, signature, public key):\n-    typedef boost::tuple<uint256, std::vector<unsigned char>, CPubKey> sigdata_type;\n-    std::set< sigdata_type> setValid;\n+     //! Entries are SHA256(nonce || signature hash || public key || signature):\n+    uint256 nonce;\n+    size_t nMaxSize;\n+    typedef boost::unordered_set<uint256, CSignatureCacheHasher> map_type;\n+    map_type setValid;\n     boost::shared_mutex cs_sigcache;\n \n+\n public:\n+    CSignatureCache()\n+    {\n+        GetRandBytes(nonce.begin(), 32);\n+        nMaxSize = GetArg(\"-maxsigcachesize\", DEFAULT_MAX_SIG_CACHE_SIZE) * ((size_t) 1 << 20);\n+    }\n+\n+    void\n+    ComputeEntry(uint256& entry, const uint256 &hash, const std::vector<unsigned char>& vchSig, const CPubKey& pubkey)\n+    {\n+        CSHA256().Write(nonce.begin(), 32).Write(hash.begin(), 32).Write(&pubkey[0], pubkey.size()).Write(&vchSig[0], vchSig.size()).Finalize(entry.begin());\n+    }\n+\n     bool\n-    Get(const uint256 &hash, const std::vector<unsigned char>& vchSig, const CPubKey& pubKey)\n+    Get(const uint256& entry)\n     {\n         boost::shared_lock<boost::shared_mutex> lock(cs_sigcache);\n+        return setValid.count(entry);\n+    }\n \n-        sigdata_type k(hash, vchSig, pubKey);\n-        std::set<sigdata_type>::iterator mi = setValid.find(k);\n-        if (mi != setValid.end())\n-            return true;\n-        return false;\n+    void Erase(const uint256& entry)\n+    {\n+        boost::unique_lock<boost::shared_mutex> lock(cs_sigcache);\n+        setValid.erase(entry);\n     }\n \n-    void Set(const uint256 &hash, const std::vector<unsigned char>& vchSig, const CPubKey& pubKey)\n+    void Set(const uint256& entry)\n     {\n-        // DoS prevention: limit cache size to less than 10MB\n-        // (~200 bytes per cache entry times 50,000 entries)\n-        // Since there are a maximum of 20,000 signature operations per block\n-        // 50,000 is a reasonable default.\n-        int64_t nMaxCacheSize = GetArg(\"-maxsigcachesize\", 50000);\n-        if (nMaxCacheSize <= 0) return;\n+        if (nMaxSize <= 0) return;\n \n         boost::unique_lock<boost::shared_mutex> lock(cs_sigcache);\n-\n-        while (static_cast<int64_t>(setValid.size()) > nMaxCacheSize)\n+        while (memusage::DynamicUsage(setValid) > nMaxSize)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6918#discussion_r43563293",
      "id" : 43563293,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTYzMjkz",
      "original_commit_id" : "e15b9beb617bc7ecedb267310dd3cdcd5628c433",
      "original_line" : null,
      "original_position" : 93,
      "original_start_line" : null,
      "path" : "src/script/sigcache.cpp",
      "position" : null,
      "pull_request_review_id" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6918",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/43563293/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2015-11-02T01:01:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/43563293",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Added a commit that removes cache entries after they've been seen in a block, so the cache remains fresh.\n",
      "created_at" : "2015-10-31T00:16:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6918#issuecomment-152677533",
      "id" : 152677533,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6918",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDE1MjY3NzUzMw==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/152677533/reactions"
      },
      "updated_at" : "2015-10-31T00:16:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/152677533",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "re-ACK\n",
      "created_at" : "2015-10-31T00:18:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6918#issuecomment-152677679",
      "id" : 152677679,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6918",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDE1MjY3NzY3OQ==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/152677679/reactions"
      },
      "updated_at" : "2015-10-31T00:18:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/152677679",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=4",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "node_id" : "MDQ6VXNlcjQxMzM5NQ==",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6918#discussion_r43569898"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/43569898"
         }
      },
      "author_association" : "NONE",
      "body" : "Just a qustion to understand the motivation, why is here the opening bracket in the same line and below (line 48) it's on a new line?\n",
      "commit_id" : "69d373ff6693de204bdf58cbc90f8a26d8f711c8",
      "created_at" : "2015-10-31T09:20:59Z",
      "diff_hunk" : "@@ -5,17 +5,30 @@\n \n #include \"sigcache.h\"\n \n+#include \"memusage.h\"\n #include \"pubkey.h\"\n #include \"random.h\"\n #include \"uint256.h\"\n #include \"util.h\"\n \n #include <boost/thread.hpp>\n-#include <boost/tuple/tuple_comparison.hpp>\n+#include <boost/unordered_set.hpp>\n \n namespace {\n \n /**\n+ * We're hashing a nonce into the entries themselves, so we don't need extra\n+ * blinding in the set hash computation.\n+ */\n+class CSignatureCacheHasher\n+{\n+public:\n+    size_t operator()(const uint256& key) const {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6918#discussion_r43569898",
      "id" : 43569898,
      "line" : 26,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTY5ODk4",
      "original_commit_id" : "0b9e9dca4e88e41f7dae4fd9cd8e0f93fabafe01",
      "original_line" : null,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/script/sigcache.cpp",
      "position" : 23,
      "pull_request_review_id" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6918",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/43569898/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2015-11-02T01:01:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/43569898",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1419649?v=4",
         "events_url" : "https://api.github.com/users/Diapolo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Diapolo/followers",
         "following_url" : "https://api.github.com/users/Diapolo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Diapolo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Diapolo",
         "id" : 1419649,
         "login" : "Diapolo",
         "node_id" : "MDQ6VXNlcjE0MTk2NDk=",
         "organizations_url" : "https://api.github.com/users/Diapolo/orgs",
         "received_events_url" : "https://api.github.com/users/Diapolo/received_events",
         "repos_url" : "https://api.github.com/users/Diapolo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Diapolo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Diapolo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Diapolo"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Added a commit to not wipe the cache from TBV.\n",
      "created_at" : "2015-11-02T01:02:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6918#issuecomment-152884702",
      "id" : 152884702,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6918",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDE1Mjg4NDcwMg==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/152884702/reactions"
      },
      "updated_at" : "2015-11-02T01:02:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/152884702",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Currently gathering statistics about the cache size - hitrate relation.\n",
      "created_at" : "2015-11-02T07:14:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6918#issuecomment-152939539",
      "id" : 152939539,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6918",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDE1MjkzOTUzOQ==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/152939539/reactions"
      },
      "updated_at" : "2015-11-02T07:14:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/152939539",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6918#discussion_r43690703"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6918"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/43690703"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think it's going for a getter/setter paradigm(see: Set function below), but I think the names could indeed be improved. It's confusing to have \"Set\" be both the type of data structure and the primary way of updating it, imo. \n",
      "commit_id" : "69d373ff6693de204bdf58cbc90f8a26d8f711c8",
      "created_at" : "2015-11-02T22:12:21Z",
      "diff_hunk" : "@@ -23,52 +36,55 @@ namespace {\n class CSignatureCache\n {\n private:\n-     //! sigdata_type is (signature hash, signature, public key):\n-    typedef boost::tuple<uint256, std::vector<unsigned char>, CPubKey> sigdata_type;\n-    std::set< sigdata_type> setValid;\n+     //! Entries are SHA256(nonce || signature hash || public key || signature):\n+    uint256 nonce;\n+    size_t nMaxSize;\n+    typedef boost::unordered_set<uint256, CSignatureCacheHasher> map_type;\n+    map_type setValid;\n     boost::shared_mutex cs_sigcache;\n \n+\n public:\n+    CSignatureCache()\n+    {\n+        GetRandBytes(nonce.begin(), 32);\n+        nMaxSize = GetArg(\"-maxsigcachesize\", DEFAULT_MAX_SIG_CACHE_SIZE) * ((size_t) 1 << 20);\n+    }\n+\n+    void\n+    ComputeEntry(uint256& entry, const uint256 &hash, const std::vector<unsigned char>& vchSig, const CPubKey& pubkey)\n+    {\n+        CSHA256().Write(nonce.begin(), 32).Write(hash.begin(), 32).Write(&pubkey[0], pubkey.size()).Write(&vchSig[0], vchSig.size()).Finalize(entry.begin());\n+    }\n+\n     bool\n-    Get(const uint256 &hash, const std::vector<unsigned char>& vchSig, const CPubKey& pubKey)\n+    Get(const uint256& entry)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6918#discussion_r43690703",
      "id" : 43690703,
      "line" : 59,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjkwNzAz",
      "original_commit_id" : "e15b9beb617bc7ecedb267310dd3cdcd5628c433",
      "original_line" : null,
      "original_position" : 62,
      "original_start_line" : null,
      "path" : "src/script/sigcache.cpp",
      "position" : 60,
      "pull_request_review_id" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6918",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/43690703/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2015-11-02T22:12:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/43690703",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK\n",
      "created_at" : "2015-11-02T22:37:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6918#issuecomment-153180012",
      "id" : 153180012,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6918",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDE1MzE4MDAxMg==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/153180012/reactions"
      },
      "updated_at" : "2015-11-02T22:37:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/153180012",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK.  However in my first attempt at benchmarking I'm not seeing any speedup with this code change (in fact block verification times seem to have gotten very, very slightly slower for some reason).  Will continue to debug and try to see if my benchmarking is broken, or if there's some effect here we're missing.\n",
      "created_at" : "2015-11-06T13:31:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6918#issuecomment-154410373",
      "id" : 154410373,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6918",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDE1NDQxMDM3Mw==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/154410373/reactions"
      },
      "updated_at" : "2015-11-06T13:31:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/154410373",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sdaftuar The results #6976 indicate that this improves things. Does that contradict your earlier findings?\n",
      "created_at" : "2015-11-11T08:33:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6918#issuecomment-155703128",
      "id" : 155703128,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6918",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDE1NTcwMzEyOA==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/155703128/reactions"
      },
      "updated_at" : "2015-11-11T08:33:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/155703128",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Sorry forgot to update with my results. I ran longer studies comparing the old and new behavior more carefully and yes I agree this does improve things.  I saw roughly a 5% speed up in processing all the October historical data using the new default cache size compared with the old implementation (running with a sig cache of approximately the same size).\n\nACK\n",
      "created_at" : "2015-11-11T10:08:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6918#issuecomment-155721822",
      "id" : 155721822,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6918",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDE1NTcyMTgyMg==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/155721822/reactions"
      },
      "updated_at" : "2015-11-11T19:09:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/155721822",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ACK\n",
      "created_at" : "2015-11-11T23:19:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6918#issuecomment-155940692",
      "id" : 155940692,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6918",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDE1NTk0MDY5Mg==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/155940692/reactions"
      },
      "updated_at" : "2015-11-11T23:19:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/155940692",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   }
]
