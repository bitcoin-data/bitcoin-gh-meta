{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "In the net:{inbound,outbound}_message tracepoint, we are calling the\r\nConnectionTypeAsString helper function that converts the enum to a\r\nstring. This has been shown to generate quite a few instructions, even\r\nwhen there is no code hooked into the tracepoint.\r\n\r\nHere's the output from gdb when tracing the number of instructions\r\nbetween two breakpoints around this tracepoint (see [1] for how to do\r\nthis):\r\n\r\n\tRecorded 293 instructions in 27 functions\r\n\r\nTracepoints should be almost zero cost, 293 instructions is a bit much\r\nfor effectively doing nothing most of the time.\r\n\r\nInstead of calling the ConnectionTypeAsString function, simply add a\r\nConnectionType getter that returns the connection type enum directly.\r\nThis way the tracepoint simplifies to nine instructions that load values\r\ninto registers in preparation for a tracepoint call, which may or may\r\nnot be there depending on if there are any attached ebpf programs.\r\n\r\nWith this patch applied:\r\n\r\n\tRecorded 9 instructions in 1 functions\r\n\r\nThis tightens up these tracepoints in preparation for enabling tracing\r\nin release builds[2].\r\n\r\nSigned-off-by: William Casarin <jb55@jb55.com>\r\n\r\n[1] https://github.com/bitcoin/bitcoin/pull/23724#issuecomment-996919963\r\n[2] https://github.com/bitcoin/bitcoin/pull/23724\r\n\r\n",
   "closed_at" : "2022-01-04T17:20:33Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/45598?v=4",
      "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
      "followers_url" : "https://api.github.com/users/jb55/followers",
      "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
      "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/jb55",
      "id" : 45598,
      "login" : "jb55",
      "node_id" : "MDQ6VXNlcjQ1NTk4",
      "organizations_url" : "https://api.github.com/users/jb55/orgs",
      "received_events_url" : "https://api.github.com/users/jb55/received_events",
      "repos_url" : "https://api.github.com/users/jb55/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/jb55"
   },
   "comments" : 9,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23809/comments",
   "created_at" : "2021-12-18T01:30:23Z",
   "draft" : false,
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23809/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/23809",
   "id" : 1083714909,
   "labels" : [
      {
         "color" : "006b75",
         "default" : false,
         "description" : null,
         "id" : 98298007,
         "name" : "P2P",
         "node_id" : "MDU6TGFiZWw5ODI5ODAwNw==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P"
      },
      {
         "color" : "ffffee",
         "default" : false,
         "description" : null,
         "id" : 231994551,
         "name" : "Scripts and tools",
         "node_id" : "MDU6TGFiZWwyMzE5OTQ1NTE=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Scripts%20and%20tools"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23809/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "PR_kwDOABII584wBu3r",
   "number" : 23809,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/23809.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23809",
      "merged_at" : null,
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/23809.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23809"
   },
   "reactions" : {
      "+1" : 1,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 1,
      "total_count" : 2,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23809/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23809/timeline",
   "title" : "tracing: reduce instructions generated by net:message tracepoints",
   "updated_at" : "2022-01-04T17:20:33Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23809",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/45598?v=4",
      "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
      "followers_url" : "https://api.github.com/users/jb55/followers",
      "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
      "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/jb55",
      "id" : 45598,
      "login" : "jb55",
      "node_id" : "MDQ6VXNlcjQ1NTk4",
      "organizations_url" : "https://api.github.com/users/jb55/orgs",
      "received_events_url" : "https://api.github.com/users/jb55/received_events",
      "repos_url" : "https://api.github.com/users/jb55/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/jb55"
   }
}
