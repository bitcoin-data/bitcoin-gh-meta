[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [naumenkogs](https://github.com/bitcoin/bitcoin/pull/26551#issuecomment-1403284006) |\n| Concept ACK | [glozow](https://github.com/bitcoin/bitcoin/pull/26551#pullrequestreview-1195591526), [mzumsande](https://github.com/bitcoin/bitcoin/pull/26551#pullrequestreview-1227872580) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#26247](https://github.com/bitcoin/bitcoin/pull/26247) (refactor: Make m_mempool optional in PeerManager by MarcoFalke)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2022-11-21T19:44:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#issuecomment-1322561699",
      "id" : 1322561699,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26551",
      "node_id" : "IC_kwDOABII585O1LCj",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1322561699/reactions"
      },
      "updated_at" : "2023-01-25T09:00:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1322561699",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2022-11-28T13:09:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#issuecomment-1329064833",
      "id" : 1329064833,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26551",
      "node_id" : "IC_kwDOABII585PN-uB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1329064833/reactions"
      },
      "updated_at" : "2022-11-28T13:09:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1329064833",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Some previous discussion at https://github.com/bitcoin/bitcoin/pull/21527#discussion_r601221165",
      "created_at" : "2022-12-08T03:25:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#issuecomment-1341936477",
      "id" : 1341936477,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26551",
      "node_id" : "IC_kwDOABII585P_FNd",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1341936477/reactions"
      },
      "updated_at" : "2022-12-08T03:25:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1341936477",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1054210259"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1054210259"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should become AssertLockNotHeld? :)",
      "commit_id" : "0a32d4f3c4d8b57690036b0447837afe5f9a0eb3",
      "created_at" : "2022-12-21T10:12:17Z",
      "diff_hunk" : "@@ -2889,7 +2889,7 @@ void PeerManagerImpl::ProcessHeadersMessage(CNode& pfrom, Peer& peer,\n bool PeerManagerImpl::ProcessOrphanTx(Peer& peer)\n {\n     AssertLockHeld(g_msgproc_mutex);\n-    AssertLockHeld(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1054210259",
      "id" : 1054210259,
      "line" : 2892,
      "node_id" : "PRRC_kwDOABII584-1fjT",
      "original_commit_id" : "75b6f8213692f7db5435cdcf15392466dcb92ec9",
      "original_line" : 2892,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 13,
      "pull_request_review_id" : 1225815078,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1054210259/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-21T10:12:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1054210259",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1054223525"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1054223525"
         }
      },
      "author_association" : "MEMBER",
      "body" : "1. I think it should say \"Creates more work if\", as it's less ambiguous (I actually spent time figuring the difference out...).\r\n2. So now `bool fMoreNodeWork = m_msgproc->ProcessMessages(pnode, flagInterruptMsgProc);` should be renamed to `may_have_more_work` right?\r\n",
      "commit_id" : "0a32d4f3c4d8b57690036b0447837afe5f9a0eb3",
      "created_at" : "2022-12-21T10:25:27Z",
      "diff_hunk" : "@@ -585,10 +585,10 @@ class PeerManagerImpl final : public PeerManager\n      * Reconsider orphan transactions after a parent has been accepted to the mempool.\n      *\n      * @peer[in]  peer     The peer whose orphan transactions we will reconsider. Generally only one\n-     *                     orphan will be reconsidered on each call of this function. This set\n-     *                     may be added to if accepting an orphan causes its children to be\n+     *                     orphan will be reconsidered on each call of this function. May",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1054223525",
      "id" : 1054223525,
      "line" : 588,
      "node_id" : "PRRC_kwDOABII584-1iyl",
      "original_commit_id" : "0a32d4f3c4d8b57690036b0447837afe5f9a0eb3",
      "original_line" : 588,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 6,
      "pull_request_review_id" : 1225834248,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1054223525/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-21T10:25:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1054223525",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2022-12-21T10:25:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#issuecomment-1361131400",
      "id" : 1361131400,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26551",
      "node_id" : "IC_kwDOABII585RITeI",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1361131400/reactions"
      },
      "updated_at" : "2022-12-21T10:25:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1361131400",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1054345381"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1054345381"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Seems more reasonable to continue to allow invoking `ProcessOrphanTx` with `cs_main` held, even though we could forbid it. (Before the \"only process orphans before messages\" commit, `ProcessOrphanTx()` was called from `ProcessMessage()` with `cs_main` held)",
      "commit_id" : "0a32d4f3c4d8b57690036b0447837afe5f9a0eb3",
      "created_at" : "2022-12-21T12:43:22Z",
      "diff_hunk" : "@@ -2889,7 +2889,7 @@ void PeerManagerImpl::ProcessHeadersMessage(CNode& pfrom, Peer& peer,\n bool PeerManagerImpl::ProcessOrphanTx(Peer& peer)\n {\n     AssertLockHeld(g_msgproc_mutex);\n-    AssertLockHeld(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1054345381",
      "id" : 1054345381,
      "in_reply_to_id" : 1054210259,
      "line" : 2892,
      "node_id" : "PRRC_kwDOABII584-2Ail",
      "original_commit_id" : "75b6f8213692f7db5435cdcf15392466dcb92ec9",
      "original_line" : 2892,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 13,
      "pull_request_review_id" : 1226016378,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1054345381/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-21T12:43:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1054345381",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1055459343"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055459343"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't think this PR changes whether `fMoreNodeWork` should be renamed -- the bool should have the same properties both before and after this PR.\r\n\r\nBut... I think its current behaviour is technically not quite right? If we process a TX message in `ProcessMessage` now, we'll set `fMoreWork = true` only when `m_getdata_requests` has entries, but I think we should also be doing it if the peer's orphanage work queue isn't empty, as `ProcessMessage` may have added to it. I think this is technically a bug introduced in #15644 -- there should have been an `if (!pfrom->orphan_work_set.empty()) fMoreWork = true;`  added after the `ProcessMessage()` call, as well as after the `// this maintains the order of responses` comment.\r\n\r\nThe only result of the bug is that when a parent comes in, processing its orphaned children will be delayed by 100ms rather than occurring essentially immediately.",
      "commit_id" : "8f9d9ab943c291bdd77ed980adfe14c3a23e04c2",
      "created_at" : "2022-12-22T13:29:02Z",
      "diff_hunk" : "@@ -585,10 +585,10 @@ class PeerManagerImpl final : public PeerManager\n      * Reconsider orphan transactions after a parent has been accepted to the mempool.\n      *\n      * @peer[in]  peer     The peer whose orphan transactions we will reconsider. Generally only one\n-     *                     orphan will be reconsidered on each call of this function. This set\n-     *                     may be added to if accepting an orphan causes its children to be\n+     *                     orphan will be reconsidered on each call of this function. May",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1055459343",
      "id" : 1055459343,
      "in_reply_to_id" : 1054223525,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-6QgP",
      "original_commit_id" : "0a32d4f3c4d8b57690036b0447837afe5f9a0eb3",
      "original_line" : 588,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1227668440,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055459343/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-22T13:29:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055459343",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1055527867"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055527867"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe it would be better to write:\r\n\r\n```c++\r\nwhile (true) {\r\n    bool all_nodes_finished_processing = true;\r\n    for (pnode : nodes) {\r\n        if (m_msgproc->ProcessMessages(pnode)) all_nodes_finished_processing = false;\r\n        m_msgproc->SendMessages(pnode);\r\n    }\r\n    if (all_nodes_finished_processing) wait_for(100ms);\r\n}\r\n```\r\n\r\nThe idea (as I understand it) is just that `ProcessMessages()` returns true if it does some substantial work and exits early, without checking everything. If that's the case for any peer, then it doesn't wait before looping through all peers again. If `ProcessMessages()` completed for all peers, whether it did work or not, then it is okay to sleep briefly before looping over everything again.",
      "commit_id" : "8f9d9ab943c291bdd77ed980adfe14c3a23e04c2",
      "created_at" : "2022-12-22T14:36:44Z",
      "diff_hunk" : "@@ -585,10 +585,10 @@ class PeerManagerImpl final : public PeerManager\n      * Reconsider orphan transactions after a parent has been accepted to the mempool.\n      *\n      * @peer[in]  peer     The peer whose orphan transactions we will reconsider. Generally only one\n-     *                     orphan will be reconsidered on each call of this function. This set\n-     *                     may be added to if accepting an orphan causes its children to be\n+     *                     orphan will be reconsidered on each call of this function. May",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1055527867",
      "id" : 1055527867,
      "in_reply_to_id" : 1054223525,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-6hO7",
      "original_commit_id" : "0a32d4f3c4d8b57690036b0447837afe5f9a0eb3",
      "original_line" : 588,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1227770695,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055527867/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-22T14:36:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055527867",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1055595579"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055595579"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The doc for `GetTxToReconsider` needs an update after both `more` and `originator` are removed.",
      "commit_id" : "6c0a068ea3670bb7a1c955ed6ecde5d050c1a812",
      "created_at" : "2022-12-22T15:45:09Z",
      "diff_hunk" : "@@ -33,7 +33,7 @@ class TxOrphanage {\n      *  the originating peer, and whether there are more orphans for this peer\n      *  to work on after this tx.\n      */\n-    CTransactionRef GetTxToReconsider(NodeId peer, bool& more) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);\n+    CTransactionRef GetTxToReconsider(NodeId peer) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1055595579",
      "id" : 1055595579,
      "line" : 34,
      "node_id" : "PRRC_kwDOABII584-6xw7",
      "original_commit_id" : "8f9d9ab943c291bdd77ed980adfe14c3a23e04c2",
      "original_line" : 34,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txorphanage.h",
      "position" : 14,
      "pull_request_review_id" : 1227872580,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055595579/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-04T21:40:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055595579",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1055673919"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055673919"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit for 10de619ba2bc48de6816b3940509576c575e9ff3 typo \"indidicate\" in commit message",
      "commit_id" : "8f9d9ab943c291bdd77ed980adfe14c3a23e04c2",
      "created_at" : "2022-12-22T17:11:07Z",
      "diff_hunk" : "@@ -4907,6 +4907,7 @@ bool PeerManagerImpl::ProcessMessages(CNode* pfrom, std::atomic<bool>& interrupt\n             LOCK(peer->m_getdata_requests_mutex);\n             if (!peer->m_getdata_requests.empty()) fMoreWork = true;\n         }\n+        if (m_orphanage.HaveTxToReconsider(peer->m_id)) fMoreWork = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1055673919",
      "id" : 1055673919,
      "line" : 4905,
      "node_id" : "PRRC_kwDOABII584-7E4_",
      "original_commit_id" : "10de619ba2bc48de6816b3940509576c575e9ff3",
      "original_line" : 4910,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 4,
      "pull_request_review_id" : 1227986261,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055673919/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-26T18:35:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055673919",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1055956153"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055956153"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This doesn't work after the other changes in this PR -- you might be creating more work for some other peer, so should be checking if any peers have txs to reconsider, and only doing this once after looping through all the peers.",
      "commit_id" : "8f9d9ab943c291bdd77ed980adfe14c3a23e04c2",
      "created_at" : "2022-12-23T00:44:02Z",
      "diff_hunk" : "@@ -4907,6 +4907,7 @@ bool PeerManagerImpl::ProcessMessages(CNode* pfrom, std::atomic<bool>& interrupt\n             LOCK(peer->m_getdata_requests_mutex);\n             if (!peer->m_getdata_requests.empty()) fMoreWork = true;\n         }\n+        if (m_orphanage.HaveTxToReconsider(peer->m_id)) fMoreWork = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1055956153",
      "id" : 1055956153,
      "line" : 4905,
      "node_id" : "PRRC_kwDOABII584-8Jy5",
      "original_commit_id" : "10de619ba2bc48de6816b3940509576c575e9ff3",
      "original_line" : 4910,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 4,
      "pull_request_review_id" : 1228417281,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055956153/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-23T00:44:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055956153",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1056178024"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1056178024"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think you are right. Let's try applying these changes and see whether everything makes sense once again.\r\n\r\nPart of my confusion is that it's unclear whether `has_more_work` applies to a given peer, or to all peers... That variable rename could help. (`peer_has_more_work` vs `node_has_more_work` or something.)",
      "commit_id" : "8f9d9ab943c291bdd77ed980adfe14c3a23e04c2",
      "created_at" : "2022-12-23T09:30:09Z",
      "diff_hunk" : "@@ -585,10 +585,10 @@ class PeerManagerImpl final : public PeerManager\n      * Reconsider orphan transactions after a parent has been accepted to the mempool.\n      *\n      * @peer[in]  peer     The peer whose orphan transactions we will reconsider. Generally only one\n-     *                     orphan will be reconsidered on each call of this function. This set\n-     *                     may be added to if accepting an orphan causes its children to be\n+     *                     orphan will be reconsidered on each call of this function. May",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1056178024",
      "id" : 1056178024,
      "in_reply_to_id" : 1054223525,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-8_9o",
      "original_commit_id" : "0a32d4f3c4d8b57690036b0447837afe5f9a0eb3",
      "original_line" : 588,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1228729197,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1056178024/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-23T09:30:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1056178024",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1056567812"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1056567812"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "So, I guess this raises the question: should we move orphan processing outside of `ProcessMessages` and `SendMessages` entirely, and just do it separately, independent of both who sent the orphan and who sent the parent?\r\n\r\nUnless someone has a good reason not to, I think I might draft that up as an alternative PR so the approaches can be compared more directly.",
      "commit_id" : "8f9d9ab943c291bdd77ed980adfe14c3a23e04c2",
      "created_at" : "2022-12-23T18:40:59Z",
      "diff_hunk" : "@@ -4907,6 +4907,7 @@ bool PeerManagerImpl::ProcessMessages(CNode* pfrom, std::atomic<bool>& interrupt\n             LOCK(peer->m_getdata_requests_mutex);\n             if (!peer->m_getdata_requests.empty()) fMoreWork = true;\n         }\n+        if (m_orphanage.HaveTxToReconsider(peer->m_id)) fMoreWork = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1056567812",
      "id" : 1056567812,
      "in_reply_to_id" : 1055956153,
      "line" : 4905,
      "node_id" : "PRRC_kwDOABII584--fIE",
      "original_commit_id" : "10de619ba2bc48de6816b3940509576c575e9ff3",
      "original_line" : 4910,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 4,
      "pull_request_review_id" : 1229303460,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1056567812/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-23T18:40:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1056567812",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1057317606"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1057317606"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> should we move orphan processing outside of ProcessMessages and SendMessages entirely, and just do it separately, independent of both who sent the orphan and who sent the parent?\r\n\r\nHad a similar thought, mainly I don't see why we should try to process all orphans before moving on to `ProcessMessage()`... afaict we never send a message to a peer as a result of processing an orphan (other than potentially disconnecting) so maintaining the order of responses is not justification like it is for finishing `ProcessGetData()` queue.\r\n\r\nfwiw doing orphan processing independently seems reasonable to me, though I don't have a very strong grasp of all the possible implications.",
      "commit_id" : "8f9d9ab943c291bdd77ed980adfe14c3a23e04c2",
      "created_at" : "2022-12-26T18:33:43Z",
      "diff_hunk" : "@@ -4907,6 +4907,7 @@ bool PeerManagerImpl::ProcessMessages(CNode* pfrom, std::atomic<bool>& interrupt\n             LOCK(peer->m_getdata_requests_mutex);\n             if (!peer->m_getdata_requests.empty()) fMoreWork = true;\n         }\n+        if (m_orphanage.HaveTxToReconsider(peer->m_id)) fMoreWork = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1057317606",
      "id" : 1057317606,
      "in_reply_to_id" : 1055956153,
      "line" : 4905,
      "node_id" : "PRRC_kwDOABII584_BWLm",
      "original_commit_id" : "10de619ba2bc48de6816b3940509576c575e9ff3",
      "original_line" : 4910,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 4,
      "pull_request_review_id" : 1227986261,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1057317606/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-26T18:35:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1057317606",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1058680686"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1058680686"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I thought of it more along the lines of \"if a node gives us a lot of orphans to process, and we're now processing them, we shouldn't do more work for that node until all the orphan work is done; also we shouldn't delay work from other nodes while we're processing that node's orphans\".",
      "commit_id" : "8f9d9ab943c291bdd77ed980adfe14c3a23e04c2",
      "created_at" : "2022-12-29T01:27:23Z",
      "diff_hunk" : "@@ -4907,6 +4907,7 @@ bool PeerManagerImpl::ProcessMessages(CNode* pfrom, std::atomic<bool>& interrupt\n             LOCK(peer->m_getdata_requests_mutex);\n             if (!peer->m_getdata_requests.empty()) fMoreWork = true;\n         }\n+        if (m_orphanage.HaveTxToReconsider(peer->m_id)) fMoreWork = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1058680686",
      "id" : 1058680686,
      "in_reply_to_id" : 1055956153,
      "line" : 4905,
      "node_id" : "PRRC_kwDOABII584_Gi9u",
      "original_commit_id" : "10de619ba2bc48de6816b3940509576c575e9ff3",
      "original_line" : 4910,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 4,
      "pull_request_review_id" : 1232115171,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1058680686/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-29T01:27:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1058680686",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1061904606"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1061904606"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> So, I guess this raises the question: should we move orphan processing outside of `ProcessMessages` and `SendMessages` entirely,\r\n\r\nWhere do you intend to move it? Into a dedicated thread for orphan processing?\r\n\r\n> This doesn't work after the other changes in this PR -- you might be creating more work for some other peer, so should be checking if any peers have txs to reconsider, and only doing this once after looping through all the peers.\r\n\r\nIs this situation (that the peer who sent us an orphan is different from the peer that sent us the parent) typical? Otherwise might it be acceptable to just have a unnecessary 100ms wait if it occurs very rarely?",
      "commit_id" : "6c0a068ea3670bb7a1c955ed6ecde5d050c1a812",
      "created_at" : "2023-01-04T21:39:59Z",
      "diff_hunk" : "@@ -4907,6 +4907,7 @@ bool PeerManagerImpl::ProcessMessages(CNode* pfrom, std::atomic<bool>& interrupt\n             LOCK(peer->m_getdata_requests_mutex);\n             if (!peer->m_getdata_requests.empty()) fMoreWork = true;\n         }\n+        if (m_orphanage.HaveTxToReconsider(peer->m_id)) fMoreWork = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1061904606",
      "id" : 1061904606,
      "in_reply_to_id" : 1055956153,
      "line" : 4910,
      "node_id" : "PRRC_kwDOABII584_S2De",
      "original_commit_id" : "10de619ba2bc48de6816b3940509576c575e9ff3",
      "original_line" : 4910,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 126,
      "pull_request_review_id" : 1227872580,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1061904606/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-04T21:40:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1061904606",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1086251974"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1086251974"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Where do you intend to move it? Into a dedicated thread for orphan processing?\r\n\r\nNo, I was thinking a separate `ProcessOrphans` method like `ProcessMessages` and `SendMessages`.\r\n\r\n> Is this situation (that the peer who sent us an orphan is different from the peer that sent us the parent) typical? Otherwise might it be acceptable to just have a unnecessary 100ms wait if it occurs very rarely?\r\n\r\nOn a long running node, I'm seeing maybe a few hundred orphans being accepted during startup (ie, children whose parent txs were announced while my node was offline) but then perhaps only 20-60 accepted orphans per day. I don't have much of an idea how many of those would have a different node sending the parent compared to the child, but it doesn't seem likely to be a real problem.",
      "commit_id" : "6c0a068ea3670bb7a1c955ed6ecde5d050c1a812",
      "created_at" : "2023-01-25T06:40:34Z",
      "diff_hunk" : "@@ -4907,6 +4907,7 @@ bool PeerManagerImpl::ProcessMessages(CNode* pfrom, std::atomic<bool>& interrupt\n             LOCK(peer->m_getdata_requests_mutex);\n             if (!peer->m_getdata_requests.empty()) fMoreWork = true;\n         }\n+        if (m_orphanage.HaveTxToReconsider(peer->m_id)) fMoreWork = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1086251974",
      "id" : 1086251974,
      "in_reply_to_id" : 1055956153,
      "line" : 4910,
      "node_id" : "PRRC_kwDOABII585AvuPG",
      "original_commit_id" : "10de619ba2bc48de6816b3940509576c575e9ff3",
      "original_line" : 4910,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 126,
      "pull_request_review_id" : 1268775212,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1086251974/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-25T06:40:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1086251974",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated. I left the orphan processing in `ProcessMessage` based on the following thoughts:\r\n\r\n * an attacker could probably create arbitrary amounts of work by sending orphan txs that then gets added to the todo list as soon as the parent becomes available. if they do this, it should only slow down communication with that peer, not any of our other peers.\r\n * avoiding a pretty rare 100ms delay isn't worth the hassle of extending `NetEventsInterface` with new virtual methods for handling orphan txs",
      "created_at" : "2023-01-25T06:45:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#issuecomment-1403166704",
      "id" : 1403166704,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26551",
      "node_id" : "IC_kwDOABII585Top_w",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1403166704/reactions"
      },
      "updated_at" : "2023-01-25T06:45:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1403166704",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1086298144"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1086298144"
         }
      },
      "author_association" : "MEMBER",
      "body" : "048bfe16795e2da18c7bb5bf1137e4370079dc33\r\nnit: does \"with and whether\" make any sense? Not for me, so might be a typo.",
      "commit_id" : "c58c249a5b694c88122589fedbef4e2f13f08bb4",
      "created_at" : "2023-01-25T07:44:36Z",
      "diff_hunk" : "@@ -29,11 +29,11 @@ class TxOrphanage {\n     /** Extract a transaction from a peer's work set\n      *  Returns nullptr and sets more to false if there are no transactions\n      *  to work on. Otherwise returns the transaction reference, removes\n-     *  the transaction from the work set, and populates its arguments with\n-     *  the originating peer, and whether there are more orphans for this peer\n+     *  the transaction from the work set, and populates \"more\" with",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1086298144",
      "id" : 1086298144,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Av5gg",
      "original_commit_id" : "048bfe16795e2da18c7bb5bf1137e4370079dc33",
      "original_line" : 32,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/txorphanage.h",
      "position" : null,
      "pull_request_review_id" : 1268842958,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1086298144/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-25T07:46:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1086298144",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 6c0a068ea3670bb7a1c955ed6ecde5d050c1a812",
      "created_at" : "2023-01-25T08:00:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#issuecomment-1403225731",
      "id" : 1403225731,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26551",
      "node_id" : "IC_kwDOABII585To4aD",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1403225731/reactions"
      },
      "updated_at" : "2023-01-25T08:00:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1403225731",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1086322112"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1086322112"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "fixed",
      "commit_id" : "c58c249a5b694c88122589fedbef4e2f13f08bb4",
      "created_at" : "2023-01-25T08:16:28Z",
      "diff_hunk" : "@@ -29,11 +29,11 @@ class TxOrphanage {\n     /** Extract a transaction from a peer's work set\n      *  Returns nullptr and sets more to false if there are no transactions\n      *  to work on. Otherwise returns the transaction reference, removes\n-     *  the transaction from the work set, and populates its arguments with\n-     *  the originating peer, and whether there are more orphans for this peer\n+     *  the transaction from the work set, and populates \"more\" with",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1086322112",
      "id" : 1086322112,
      "in_reply_to_id" : 1086298144,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Av_XA",
      "original_commit_id" : "048bfe16795e2da18c7bb5bf1137e4370079dc33",
      "original_line" : 32,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/txorphanage.h",
      "position" : null,
      "pull_request_review_id" : 1268876520,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1086322112/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-25T08:16:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1086322112",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK c58c249a5b694c88122589fedbef4e2f13f08bb4",
      "created_at" : "2023-01-25T09:00:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#issuecomment-1403284006",
      "id" : 1403284006,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26551",
      "node_id" : "IC_kwDOABII585TpGom",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1403284006/reactions"
      },
      "updated_at" : "2023-01-25T09:00:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1403284006",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1086695243"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1086695243"
         }
      },
      "author_association" : "MEMBER",
      "body" : "c58c249a5b694c88122589fedbef4e2f13f08bb4 nit: s/has/have",
      "commit_id" : "c58c249a5b694c88122589fedbef4e2f13f08bb4",
      "created_at" : "2023-01-25T14:16:36Z",
      "diff_hunk" : "@@ -4902,6 +4902,12 @@ bool PeerManagerImpl::ProcessMessages(CNode* pfrom, std::atomic<bool>& interrupt\n             LOCK(peer->m_getdata_requests_mutex);\n             if (!peer->m_getdata_requests.empty()) fMoreWork = true;\n         }\n+        // Does this peer has an orphan ready to reconsider?",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1086695243",
      "id" : 1086695243,
      "line" : 4905,
      "node_id" : "PRRC_kwDOABII585AxadL",
      "original_commit_id" : "c58c249a5b694c88122589fedbef4e2f13f08bb4",
      "original_line" : 4905,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 4,
      "pull_request_review_id" : 1269436655,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1086695243/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-25T14:49:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1086695243",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1087260793"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1087260793"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: I think \"Generally only one orphan will be reconsidered\" is misleading. Calling `ProcessTransaction` for a tx once more, getting TX_MISSING_INPUTS again and therefore keeping the orphan would qualify as being \"reconsidered\" for me, whereas what is meant is that the tx is being removed from the orphanage.\r\nBut no need to address here, since this PR didn't change this.",
      "commit_id" : "c58c249a5b694c88122589fedbef4e2f13f08bb4",
      "created_at" : "2023-01-25T22:44:59Z",
      "diff_hunk" : "@@ -584,14 +584,17 @@ class PeerManagerImpl final : public PeerManager\n     /**\n      * Reconsider orphan transactions after a parent has been accepted to the mempool.\n      *\n-     * @peer[in]  peer     The peer whose orphan transactions we will reconsider. Generally only one\n-     *                     orphan will be reconsidered on each call of this function. This set\n-     *                     may be added to if accepting an orphan causes its children to be\n-     *                     reconsidered.\n-     * @return             True if there are still orphans in this peer's work set.\n+     * @peer[in]  peer     The peer whose orphan transactions we will reconsider. Generally only\n+     *                     one orphan will be reconsidered on each call of this function. If an",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1087260793",
      "id" : 1087260793,
      "line" : 588,
      "node_id" : "PRRC_kwDOABII585Azkh5",
      "original_commit_id" : "ecb0a3e4259b81d6bb74d59a58eb65552c17d8d8",
      "original_line" : 588,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 10,
      "pull_request_review_id" : 1270237725,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1087260793/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-25T23:07:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1087260793",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1087271239"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1087271239"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: double `;`",
      "commit_id" : "c58c249a5b694c88122589fedbef4e2f13f08bb4",
      "created_at" : "2023-01-25T23:02:45Z",
      "diff_hunk" : "@@ -48,6 +48,9 @@ class TxOrphanage {\n     /** Add any orphans that list a particular tx as a parent into the from peer's work set */\n     void AddChildrenToWorkSet(const CTransaction& tx) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);;\n \n+    /** Does this peer have any work to do? */\n+    bool HaveTxToReconsider(NodeId peer) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1087271239",
      "id" : 1087271239,
      "line" : 52,
      "node_id" : "PRRC_kwDOABII585AznFH",
      "original_commit_id" : "c58c249a5b694c88122589fedbef4e2f13f08bb4",
      "original_line" : 52,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txorphanage.h",
      "position" : 5,
      "pull_request_review_id" : 1270237725,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1087271239/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-25T23:07:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1087271239",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1170060171"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170060171"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> should we move orphan processing outside of ProcessMessages and SendMessages entirely, and just do it separately, independent of both who sent the orphan and who sent the parent?\r\n> \r\n> Unless someone has a good reason not to, I think I might draft that up as an alternative PR so the approaches can be compared more directly.\r\n\r\nSee #19364",
      "commit_id" : "c58c249a5b694c88122589fedbef4e2f13f08bb4",
      "created_at" : "2023-04-18T13:41:40Z",
      "diff_hunk" : "@@ -4907,6 +4907,7 @@ bool PeerManagerImpl::ProcessMessages(CNode* pfrom, std::atomic<bool>& interrupt\n             LOCK(peer->m_getdata_requests_mutex);\n             if (!peer->m_getdata_requests.empty()) fMoreWork = true;\n         }\n+        if (m_orphanage.HaveTxToReconsider(peer->m_id)) fMoreWork = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1170060171",
      "id" : 1170060171,
      "in_reply_to_id" : 1055956153,
      "line" : 4910,
      "node_id" : "PRRC_kwDOABII585FvbOL",
      "original_commit_id" : "10de619ba2bc48de6816b3940509576c575e9ff3",
      "original_line" : 4910,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 126,
      "pull_request_review_id" : 1390155419,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170060171/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-18T13:41:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170060171",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   }
]
