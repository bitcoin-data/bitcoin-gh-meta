[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#23394](https://github.com/bitcoin/bitcoin/pull/23394) (Taproot wallet test vectors (generation+tests) by sipa)\n* [#23383](https://github.com/bitcoin/bitcoin/pull/23383) (Update libsecp256k1 subtree to current master by sipa)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-09-10T09:48:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22934#issuecomment-916778111",
      "id" : 916778111,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22934",
      "node_id" : "IC_kwDOABII5842pOx_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/916778111/reactions"
      },
      "updated_at" : "2021-10-31T01:09:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/916778111",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2021-09-13T17:42:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22934#issuecomment-918424840",
      "id" : 918424840,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22934",
      "node_id" : "IC_kwDOABII5842vg0I",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-13T17:42:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/918424840",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22934#discussion_r707554273"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22934"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/707554273"
         }
      },
      "author_association" : "MEMBER",
      "body" : "For API safeness it's probably better to clear the output `sig` if ret is `false`.",
      "commit_id" : "b16428cd7996037065c23c20ae7a7df7524a722a",
      "created_at" : "2021-09-13T17:48:20Z",
      "diff_hunk" : "@@ -275,6 +275,13 @@ bool CKey::SignSchnorr(const uint256& hash, Span<unsigned char> sig, const uint2\n         if (!secp256k1_keypair_xonly_tweak_add(GetVerifyContext(), &keypair, tweak.data())) return false;\n     }\n     bool ret = secp256k1_schnorrsig_sign(secp256k1_context_sign, sig.data(), hash.data(), &keypair, aux ? (unsigned char*)aux->data() : nullptr);\n+#ifdef ENABLE_SCHNORR_VERIFY\n+    if(ret){\n+        secp256k1_xonly_pubkey pubkey_verify;\n+        ret = secp256k1_keypair_xonly_pub(GetVerifyContext(), &pubkey_verify, nullptr, &keypair);\n+        ret &= secp256k1_schnorrsig_verify(GetVerifyContext(), sig.data(), hash.begin(), 32, &pubkey_verify);\n+    }\n+#endif",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22934#discussion_r707554273",
      "id" : 707554273,
      "line" : 284,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNzU1NDI3Mw==",
      "original_commit_id" : "b16428cd7996037065c23c20ae7a7df7524a722a",
      "original_line" : 284,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/key.cpp",
      "position" : 10,
      "pull_request_review_id" : 753047125,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22934",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-13T17:49:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/707554273",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22934#discussion_r707554485"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22934"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/707554485"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Style nit: spaces before and after `(ret)`.",
      "commit_id" : "b16428cd7996037065c23c20ae7a7df7524a722a",
      "created_at" : "2021-09-13T17:48:38Z",
      "diff_hunk" : "@@ -275,6 +275,13 @@ bool CKey::SignSchnorr(const uint256& hash, Span<unsigned char> sig, const uint2\n         if (!secp256k1_keypair_xonly_tweak_add(GetVerifyContext(), &keypair, tweak.data())) return false;\n     }\n     bool ret = secp256k1_schnorrsig_sign(secp256k1_context_sign, sig.data(), hash.data(), &keypair, aux ? (unsigned char*)aux->data() : nullptr);\n+#ifdef ENABLE_SCHNORR_VERIFY\n+    if(ret){",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22934#discussion_r707554485",
      "id" : 707554485,
      "line" : 279,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNzU1NDQ4NQ==",
      "original_commit_id" : "b16428cd7996037065c23c20ae7a7df7524a722a",
      "original_line" : 279,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/key.cpp",
      "position" : 5,
      "pull_request_review_id" : 753047125,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22934",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-13T17:49:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/707554485",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22934#discussion_r708316250"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22934"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708316250"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "resolved, thanks",
      "commit_id" : "c660374a37f4a83a774db55e15e4e67d1d33ef3c",
      "created_at" : "2021-09-14T14:15:18Z",
      "diff_hunk" : "@@ -275,6 +275,13 @@ bool CKey::SignSchnorr(const uint256& hash, Span<unsigned char> sig, const uint2\n         if (!secp256k1_keypair_xonly_tweak_add(GetVerifyContext(), &keypair, tweak.data())) return false;\n     }\n     bool ret = secp256k1_schnorrsig_sign(secp256k1_context_sign, sig.data(), hash.data(), &keypair, aux ? (unsigned char*)aux->data() : nullptr);\n+#ifdef ENABLE_SCHNORR_VERIFY\n+    if(ret){",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22934#discussion_r708316250",
      "id" : 708316250,
      "in_reply_to_id" : 707554485,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584qOAxa",
      "original_commit_id" : "b16428cd7996037065c23c20ae7a7df7524a722a",
      "original_line" : 279,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/key.cpp",
      "position" : null,
      "pull_request_review_id" : 754010138,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22934",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-14T14:15:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708316250",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/35263201?v=4",
         "events_url" : "https://api.github.com/users/amadeuszpawlik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amadeuszpawlik/followers",
         "following_url" : "https://api.github.com/users/amadeuszpawlik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amadeuszpawlik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amadeuszpawlik",
         "id" : 35263201,
         "login" : "amadeuszpawlik",
         "node_id" : "MDQ6VXNlcjM1MjYzMjAx",
         "organizations_url" : "https://api.github.com/users/amadeuszpawlik/orgs",
         "received_events_url" : "https://api.github.com/users/amadeuszpawlik/received_events",
         "repos_url" : "https://api.github.com/users/amadeuszpawlik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amadeuszpawlik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amadeuszpawlik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amadeuszpawlik"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22934#discussion_r708318159"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22934"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708318159"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Like [this](https://github.com/bitcoin/bitcoin/pull/22934/commits/c660374a37f4a83a774db55e15e4e67d1d33ef3c)?",
      "commit_id" : "c660374a37f4a83a774db55e15e4e67d1d33ef3c",
      "created_at" : "2021-09-14T14:17:08Z",
      "diff_hunk" : "@@ -275,6 +275,13 @@ bool CKey::SignSchnorr(const uint256& hash, Span<unsigned char> sig, const uint2\n         if (!secp256k1_keypair_xonly_tweak_add(GetVerifyContext(), &keypair, tweak.data())) return false;\n     }\n     bool ret = secp256k1_schnorrsig_sign(secp256k1_context_sign, sig.data(), hash.data(), &keypair, aux ? (unsigned char*)aux->data() : nullptr);\n+#ifdef ENABLE_SCHNORR_VERIFY\n+    if(ret){\n+        secp256k1_xonly_pubkey pubkey_verify;\n+        ret = secp256k1_keypair_xonly_pub(GetVerifyContext(), &pubkey_verify, nullptr, &keypair);\n+        ret &= secp256k1_schnorrsig_verify(GetVerifyContext(), sig.data(), hash.begin(), 32, &pubkey_verify);\n+    }\n+#endif",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22934#discussion_r708318159",
      "id" : 708318159,
      "in_reply_to_id" : 707554273,
      "line" : 284,
      "node_id" : "PRRC_kwDOABII584qOBPP",
      "original_commit_id" : "b16428cd7996037065c23c20ae7a7df7524a722a",
      "original_line" : 284,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/key.cpp",
      "position" : 10,
      "pull_request_review_id" : 754012657,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22934",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-14T14:17:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708318159",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/35263201?v=4",
         "events_url" : "https://api.github.com/users/amadeuszpawlik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amadeuszpawlik/followers",
         "following_url" : "https://api.github.com/users/amadeuszpawlik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amadeuszpawlik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amadeuszpawlik",
         "id" : 35263201,
         "login" : "amadeuszpawlik",
         "node_id" : "MDQ6VXNlcjM1MjYzMjAx",
         "organizations_url" : "https://api.github.com/users/amadeuszpawlik/orgs",
         "received_events_url" : "https://api.github.com/users/amadeuszpawlik/received_events",
         "repos_url" : "https://api.github.com/users/amadeuszpawlik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amadeuszpawlik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amadeuszpawlik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amadeuszpawlik"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "As per @sipa's suggestion, I added verification step to ECDSA signing functions too.\r\nChanged the disable flag name to reflect that.",
      "created_at" : "2021-09-15T15:04:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22934#issuecomment-920102752",
      "id" : 920102752,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22934",
      "node_id" : "IC_kwDOABII584216dg",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-15T15:04:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/920102752",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/35263201?v=4",
         "events_url" : "https://api.github.com/users/amadeuszpawlik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amadeuszpawlik/followers",
         "following_url" : "https://api.github.com/users/amadeuszpawlik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amadeuszpawlik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amadeuszpawlik",
         "id" : 35263201,
         "login" : "amadeuszpawlik",
         "node_id" : "MDQ6VXNlcjM1MjYzMjAx",
         "organizations_url" : "https://api.github.com/users/amadeuszpawlik/orgs",
         "received_events_url" : "https://api.github.com/users/amadeuszpawlik/received_events",
         "repos_url" : "https://api.github.com/users/amadeuszpawlik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amadeuszpawlik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amadeuszpawlik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amadeuszpawlik"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Please squash your commits\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#squashing-commits",
      "created_at" : "2021-09-16T15:10:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22934#issuecomment-920989594",
      "id" : 920989594,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22934",
      "node_id" : "IC_kwDOABII58425S-a",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-16T15:10:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/920989594",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22934#discussion_r711857194"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22934"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711857194"
         }
      },
      "author_association" : "MEMBER",
      "body" : "How about using `memory_cleanse()`.",
      "commit_id" : "67e3138de9e82e2b36a19af4536f776949198e34",
      "created_at" : "2021-09-20T03:21:22Z",
      "diff_hunk" : "@@ -275,6 +275,13 @@ bool CKey::SignSchnorr(const uint256& hash, Span<unsigned char> sig, const uint2\n         if (!secp256k1_keypair_xonly_tweak_add(GetVerifyContext(), &keypair, tweak.data())) return false;\n     }\n     bool ret = secp256k1_schnorrsig_sign(secp256k1_context_sign, sig.data(), hash.data(), &keypair, aux ? (unsigned char*)aux->data() : nullptr);\n+#ifdef ENABLE_SCHNORR_VERIFY\n+    if(ret){\n+        secp256k1_xonly_pubkey pubkey_verify;\n+        ret = secp256k1_keypair_xonly_pub(GetVerifyContext(), &pubkey_verify, nullptr, &keypair);\n+        ret &= secp256k1_schnorrsig_verify(GetVerifyContext(), sig.data(), hash.begin(), 32, &pubkey_verify);\n+    }\n+#endif",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22934#discussion_r711857194",
      "id" : 711857194,
      "in_reply_to_id" : 707554273,
      "line" : 301,
      "node_id" : "PRRC_kwDOABII584qbhQq",
      "original_commit_id" : "b16428cd7996037065c23c20ae7a7df7524a722a",
      "original_line" : 301,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/key.cpp",
      "position" : 51,
      "pull_request_review_id" : 758230632,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22934",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-20T03:21:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711857194",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22934#discussion_r712470152"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22934"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/712470152"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "thanks",
      "commit_id" : "454be064d45d04d5ea80d34cf31926aa25b9cc11",
      "created_at" : "2021-09-20T19:55:27Z",
      "diff_hunk" : "@@ -275,6 +275,13 @@ bool CKey::SignSchnorr(const uint256& hash, Span<unsigned char> sig, const uint2\n         if (!secp256k1_keypair_xonly_tweak_add(GetVerifyContext(), &keypair, tweak.data())) return false;\n     }\n     bool ret = secp256k1_schnorrsig_sign(secp256k1_context_sign, sig.data(), hash.data(), &keypair, aux ? (unsigned char*)aux->data() : nullptr);\n+#ifdef ENABLE_SCHNORR_VERIFY\n+    if(ret){\n+        secp256k1_xonly_pubkey pubkey_verify;\n+        ret = secp256k1_keypair_xonly_pub(GetVerifyContext(), &pubkey_verify, nullptr, &keypair);\n+        ret &= secp256k1_schnorrsig_verify(GetVerifyContext(), sig.data(), hash.begin(), 32, &pubkey_verify);\n+    }\n+#endif",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22934#discussion_r712470152",
      "id" : 712470152,
      "in_reply_to_id" : 707554273,
      "line" : 301,
      "node_id" : "PRRC_kwDOABII584qd26I",
      "original_commit_id" : "b16428cd7996037065c23c20ae7a7df7524a722a",
      "original_line" : 301,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/key.cpp",
      "position" : 51,
      "pull_request_review_id" : 759038650,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22934",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-20T19:55:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/712470152",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/35263201?v=4",
         "events_url" : "https://api.github.com/users/amadeuszpawlik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amadeuszpawlik/followers",
         "following_url" : "https://api.github.com/users/amadeuszpawlik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amadeuszpawlik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amadeuszpawlik",
         "id" : 35263201,
         "login" : "amadeuszpawlik",
         "node_id" : "MDQ6VXNlcjM1MjYzMjAx",
         "organizations_url" : "https://api.github.com/users/amadeuszpawlik/orgs",
         "received_events_url" : "https://api.github.com/users/amadeuszpawlik/received_events",
         "repos_url" : "https://api.github.com/users/amadeuszpawlik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amadeuszpawlik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amadeuszpawlik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amadeuszpawlik"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> at the same time allowing for disabling the extra verification in case this extra step is computationally too expensive (--disable-verify-signing).\r\n\r\nDoes this ever come up in practice? I mean, yes, the secp256k1 library is used on some very low-end hardware. However Bitcoin Core's minimum specifications are a lot higher. The amount of signatures generated is also fairly low, compared to the number of verifications done, so it's important that verification is fast. Does it add that much overhead?\r\n\r\nBut maybe I'm missing something.",
      "created_at" : "2021-09-27T11:32:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22934#issuecomment-927786022",
      "id" : 927786022,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22934",
      "node_id" : "IC_kwDOABII5843TOQm",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-27T11:32:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/927786022",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@amadeuszpawlik Do you have any measurements suggesting that `--disable-verify-signing` might be needed in practice for performance reasons? If not I think it would be better to not introduce that option :)",
      "created_at" : "2021-09-30T08:19:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22934#issuecomment-931009917",
      "id" : 931009917,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22934",
      "node_id" : "IC_kwDOABII5843fhV9",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/931009917/reactions"
      },
      "updated_at" : "2021-10-01T14:21:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/931009917",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@laanwj @practicalswift I got this idea from the original issue: [#22435](https://github.com/bitcoin/bitcoin/issues/22435), but I agree with you both and have thus dropped the \"disable option\".",
      "created_at" : "2021-09-30T17:23:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22934#issuecomment-931517874",
      "id" : 931517874,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22934",
      "node_id" : "IC_kwDOABII5843hdWy",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/931517874/reactions"
      },
      "updated_at" : "2021-09-30T17:23:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/931517874",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/35263201?v=4",
         "events_url" : "https://api.github.com/users/amadeuszpawlik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amadeuszpawlik/followers",
         "following_url" : "https://api.github.com/users/amadeuszpawlik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amadeuszpawlik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amadeuszpawlik",
         "id" : 35263201,
         "login" : "amadeuszpawlik",
         "node_id" : "MDQ6VXNlcjM1MjYzMjAx",
         "organizations_url" : "https://api.github.com/users/amadeuszpawlik/orgs",
         "received_events_url" : "https://api.github.com/users/amadeuszpawlik/received_events",
         "repos_url" : "https://api.github.com/users/amadeuszpawlik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amadeuszpawlik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amadeuszpawlik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amadeuszpawlik"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22934#discussion_r720725253"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22934"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720725253"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "IMHO this cleans the wrong location, since you pass the address of the Span object, not the address it points to. Also, I think it's fine to simply pass the size without multiplying by `sizeof(unsigned char)` which is obviously 1. (We also use .size() on `std::vector<unsigned char>` objects frequently without this multiplication).\r\n```suggestion\r\n    if (!ret) memory_cleanse(sig.data(), sig.size());\r\n```",
      "commit_id" : "9ed9ef2b618cfb13c28ff2ea688a03395e60e607",
      "created_at" : "2021-10-02T20:27:11Z",
      "diff_hunk" : "@@ -275,6 +287,12 @@ bool CKey::SignSchnorr(const uint256& hash, Span<unsigned char> sig, const uint2\n         if (!secp256k1_keypair_xonly_tweak_add(GetVerifyContext(), &keypair, tweak.data())) return false;\n     }\n     bool ret = secp256k1_schnorrsig_sign(secp256k1_context_sign, sig.data(), hash.data(), &keypair, aux ? (unsigned char*)aux->data() : nullptr);\n+    if (ret) {\n+        secp256k1_xonly_pubkey pubkey_verify;\n+        ret = secp256k1_keypair_xonly_pub(GetVerifyContext(), &pubkey_verify, nullptr, &keypair);\n+        ret &= secp256k1_schnorrsig_verify(GetVerifyContext(), sig.data(), hash.begin(), 32, &pubkey_verify);\n+    }\n+    if (!ret) memory_cleanse(&sig, sig.size()*sizeof(unsigned char));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22934#discussion_r720725253",
      "id" : 720725253,
      "line" : 295,
      "node_id" : "PRRC_kwDOABII584q9WUF",
      "original_commit_id" : "9ed9ef2b618cfb13c28ff2ea688a03395e60e607",
      "original_line" : 295,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/key.cpp",
      "position" : 45,
      "pull_request_review_id" : 769524226,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22934",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720725253/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-02T20:34:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/720725253",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@theStack I don't think #23089 is it\r\nCirrusCI: \r\n`TestFramework (ERROR): Unexpected exception caught during testing \r\n File \"C:\\Users\\ContainerAdministrator\\AppData\\Local\\Temp\\cirrus-ci-build\\test\\functional\\wallet_send.py\", line 506, in run_test\r\n ext_utxo = ext_fund.listunspent(addresses=[addr])[0]\r\n IndexError: list index out of range`\r\nCan't reproduce on linux though",
      "created_at" : "2021-10-04T16:44:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22934#issuecomment-933663445",
      "id" : 933663445,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22934",
      "node_id" : "IC_kwDOABII5843ppLV",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/933663445/reactions"
      },
      "updated_at" : "2021-10-04T16:44:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/933663445",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/35263201?v=4",
         "events_url" : "https://api.github.com/users/amadeuszpawlik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amadeuszpawlik/followers",
         "following_url" : "https://api.github.com/users/amadeuszpawlik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amadeuszpawlik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amadeuszpawlik",
         "id" : 35263201,
         "login" : "amadeuszpawlik",
         "node_id" : "MDQ6VXNlcjM1MjYzMjAx",
         "organizations_url" : "https://api.github.com/users/amadeuszpawlik/orgs",
         "received_events_url" : "https://api.github.com/users/amadeuszpawlik/received_events",
         "repos_url" : "https://api.github.com/users/amadeuszpawlik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amadeuszpawlik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amadeuszpawlik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amadeuszpawlik"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@theStack Agree, I reran the Win64 build and it went through just fine ð ",
      "created_at" : "2021-10-05T07:44:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22934#issuecomment-934152607",
      "id" : 934152607,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22934",
      "node_id" : "IC_kwDOABII5843rgmf",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/934152607/reactions"
      },
      "updated_at" : "2021-10-05T07:44:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/934152607",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/35263201?v=4",
         "events_url" : "https://api.github.com/users/amadeuszpawlik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amadeuszpawlik/followers",
         "following_url" : "https://api.github.com/users/amadeuszpawlik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amadeuszpawlik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amadeuszpawlik",
         "id" : 35263201,
         "login" : "amadeuszpawlik",
         "node_id" : "MDQ6VXNlcjM1MjYzMjAx",
         "organizations_url" : "https://api.github.com/users/amadeuszpawlik/orgs",
         "received_events_url" : "https://api.github.com/users/amadeuszpawlik/received_events",
         "repos_url" : "https://api.github.com/users/amadeuszpawlik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amadeuszpawlik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amadeuszpawlik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amadeuszpawlik"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22934#discussion_r740407107"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22934"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740407107"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Instead, you could invoke the recovery operation itself, and verify that the decoded public key matches `pk`. That would verify that the recovery id in the signature is correct as well (`secp256k1_ecdsa_recoverable_signature_convert` throws it away).",
      "commit_id" : "c9a920e378b1c8556ea4a3ca8d2cff01c7855484",
      "created_at" : "2021-11-01T17:45:38Z",
      "diff_hunk" : "@@ -251,13 +257,21 @@ bool CKey::SignCompact(const uint256 &hash, std::vector<unsigned char>& vchSig)\n         return false;\n     vchSig.resize(CPubKey::COMPACT_SIGNATURE_SIZE);\n     int rec = -1;\n-    secp256k1_ecdsa_recoverable_signature sig;\n-    int ret = secp256k1_ecdsa_sign_recoverable(secp256k1_context_sign, &sig, hash.begin(), begin(), secp256k1_nonce_function_rfc6979, nullptr);\n+    secp256k1_ecdsa_recoverable_signature rsig;\n+    int ret = secp256k1_ecdsa_sign_recoverable(secp256k1_context_sign, &rsig, hash.begin(), begin(), secp256k1_nonce_function_rfc6979, nullptr);\n     assert(ret);\n-    ret = secp256k1_ecdsa_recoverable_signature_serialize_compact(secp256k1_context_sign, &vchSig[1], &rec, &sig);\n+    ret = secp256k1_ecdsa_recoverable_signature_serialize_compact(secp256k1_context_sign, &vchSig[1], &rec, &rsig);\n     assert(ret);\n     assert(rec != -1);\n     vchSig[0] = 27 + rec + (fCompressed ? 4 : 0);\n+    // Additional verification step to prevent using a potentially corrupted signature\n+    secp256k1_pubkey pk;\n+    secp256k1_ecdsa_signature sig;\n+    ret = secp256k1_ec_pubkey_create(secp256k1_context_sign, &pk, begin());\n+    assert(ret);\n+    secp256k1_ecdsa_recoverable_signature_convert(GetVerifyContext(), &sig, &rsig);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22934#discussion_r740407107",
      "id" : 740407107,
      "line" : 272,
      "node_id" : "PRRC_kwDOABII584sIbdD",
      "original_commit_id" : "c9a920e378b1c8556ea4a3ca8d2cff01c7855484",
      "original_line" : 272,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "src/key.cpp",
      "position" : 32,
      "pull_request_review_id" : 794481234,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22934",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740407107/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-01T17:45:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740407107",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22934#discussion_r741200452"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22934"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741200452"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hi @sipa, thanks a lot for the input.\r\nLet's see if I understand you right:  _instead_ of computing the `pk` in `secp256k1_ec_pubkey_create`, we recover the `pk` by running `secp256k1_ecdsa_recover` (which gives us the additional checks that you mention).\r\nThe `secp256k1_ecdsa_recoverable_signature_convert` stays because we need a normal signature to do the verification - correct?",
      "commit_id" : "79fd28cacbbcb86ea03d3d468845001f84a76de3",
      "created_at" : "2021-11-02T15:29:59Z",
      "diff_hunk" : "@@ -251,13 +257,21 @@ bool CKey::SignCompact(const uint256 &hash, std::vector<unsigned char>& vchSig)\n         return false;\n     vchSig.resize(CPubKey::COMPACT_SIGNATURE_SIZE);\n     int rec = -1;\n-    secp256k1_ecdsa_recoverable_signature sig;\n-    int ret = secp256k1_ecdsa_sign_recoverable(secp256k1_context_sign, &sig, hash.begin(), begin(), secp256k1_nonce_function_rfc6979, nullptr);\n+    secp256k1_ecdsa_recoverable_signature rsig;\n+    int ret = secp256k1_ecdsa_sign_recoverable(secp256k1_context_sign, &rsig, hash.begin(), begin(), secp256k1_nonce_function_rfc6979, nullptr);\n     assert(ret);\n-    ret = secp256k1_ecdsa_recoverable_signature_serialize_compact(secp256k1_context_sign, &vchSig[1], &rec, &sig);\n+    ret = secp256k1_ecdsa_recoverable_signature_serialize_compact(secp256k1_context_sign, &vchSig[1], &rec, &rsig);\n     assert(ret);\n     assert(rec != -1);\n     vchSig[0] = 27 + rec + (fCompressed ? 4 : 0);\n+    // Additional verification step to prevent using a potentially corrupted signature\n+    secp256k1_pubkey pk;\n+    secp256k1_ecdsa_signature sig;\n+    ret = secp256k1_ec_pubkey_create(secp256k1_context_sign, &pk, begin());\n+    assert(ret);\n+    secp256k1_ecdsa_recoverable_signature_convert(GetVerifyContext(), &sig, &rsig);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22934#discussion_r741200452",
      "id" : 741200452,
      "in_reply_to_id" : 740407107,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584sLdJE",
      "original_commit_id" : "c9a920e378b1c8556ea4a3ca8d2cff01c7855484",
      "original_line" : 272,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "src/key.cpp",
      "position" : null,
      "pull_request_review_id" : 795573856,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22934",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741200452/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-02T15:29:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741200452",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/35263201?v=4",
         "events_url" : "https://api.github.com/users/amadeuszpawlik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amadeuszpawlik/followers",
         "following_url" : "https://api.github.com/users/amadeuszpawlik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amadeuszpawlik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amadeuszpawlik",
         "id" : 35263201,
         "login" : "amadeuszpawlik",
         "node_id" : "MDQ6VXNlcjM1MjYzMjAx",
         "organizations_url" : "https://api.github.com/users/amadeuszpawlik/orgs",
         "received_events_url" : "https://api.github.com/users/amadeuszpawlik/received_events",
         "repos_url" : "https://api.github.com/users/amadeuszpawlik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amadeuszpawlik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amadeuszpawlik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amadeuszpawlik"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22934#discussion_r741220457"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22934"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741220457"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No, the other way around.\r\n\r\nYou still use `secp256k1_ec_pubkey_create` to compute the expected public key. But then instead of verifying it against the normal signature extracted from sig, you run recovery on the message and sig, which gives you the signing public key. Then you can compare the expected pk with the signing one. There is no explicit signature verification in this case; instead you use the recovery operation (which is stricter than verification).",
      "commit_id" : "79fd28cacbbcb86ea03d3d468845001f84a76de3",
      "created_at" : "2021-11-02T15:46:50Z",
      "diff_hunk" : "@@ -251,13 +257,21 @@ bool CKey::SignCompact(const uint256 &hash, std::vector<unsigned char>& vchSig)\n         return false;\n     vchSig.resize(CPubKey::COMPACT_SIGNATURE_SIZE);\n     int rec = -1;\n-    secp256k1_ecdsa_recoverable_signature sig;\n-    int ret = secp256k1_ecdsa_sign_recoverable(secp256k1_context_sign, &sig, hash.begin(), begin(), secp256k1_nonce_function_rfc6979, nullptr);\n+    secp256k1_ecdsa_recoverable_signature rsig;\n+    int ret = secp256k1_ecdsa_sign_recoverable(secp256k1_context_sign, &rsig, hash.begin(), begin(), secp256k1_nonce_function_rfc6979, nullptr);\n     assert(ret);\n-    ret = secp256k1_ecdsa_recoverable_signature_serialize_compact(secp256k1_context_sign, &vchSig[1], &rec, &sig);\n+    ret = secp256k1_ecdsa_recoverable_signature_serialize_compact(secp256k1_context_sign, &vchSig[1], &rec, &rsig);\n     assert(ret);\n     assert(rec != -1);\n     vchSig[0] = 27 + rec + (fCompressed ? 4 : 0);\n+    // Additional verification step to prevent using a potentially corrupted signature\n+    secp256k1_pubkey pk;\n+    secp256k1_ecdsa_signature sig;\n+    ret = secp256k1_ec_pubkey_create(secp256k1_context_sign, &pk, begin());\n+    assert(ret);\n+    secp256k1_ecdsa_recoverable_signature_convert(GetVerifyContext(), &sig, &rsig);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22934#discussion_r741220457",
      "id" : 741220457,
      "in_reply_to_id" : 740407107,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584sLiBp",
      "original_commit_id" : "c9a920e378b1c8556ea4a3ca8d2cff01c7855484",
      "original_line" : 272,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "src/key.cpp",
      "position" : null,
      "pull_request_review_id" : 795596597,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22934",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741220457/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-02T15:47:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741220457",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22934#discussion_r741260486"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22934"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741260486"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Perfect, thanks!",
      "commit_id" : "79fd28cacbbcb86ea03d3d468845001f84a76de3",
      "created_at" : "2021-11-02T16:21:04Z",
      "diff_hunk" : "@@ -251,13 +257,21 @@ bool CKey::SignCompact(const uint256 &hash, std::vector<unsigned char>& vchSig)\n         return false;\n     vchSig.resize(CPubKey::COMPACT_SIGNATURE_SIZE);\n     int rec = -1;\n-    secp256k1_ecdsa_recoverable_signature sig;\n-    int ret = secp256k1_ecdsa_sign_recoverable(secp256k1_context_sign, &sig, hash.begin(), begin(), secp256k1_nonce_function_rfc6979, nullptr);\n+    secp256k1_ecdsa_recoverable_signature rsig;\n+    int ret = secp256k1_ecdsa_sign_recoverable(secp256k1_context_sign, &rsig, hash.begin(), begin(), secp256k1_nonce_function_rfc6979, nullptr);\n     assert(ret);\n-    ret = secp256k1_ecdsa_recoverable_signature_serialize_compact(secp256k1_context_sign, &vchSig[1], &rec, &sig);\n+    ret = secp256k1_ecdsa_recoverable_signature_serialize_compact(secp256k1_context_sign, &vchSig[1], &rec, &rsig);\n     assert(ret);\n     assert(rec != -1);\n     vchSig[0] = 27 + rec + (fCompressed ? 4 : 0);\n+    // Additional verification step to prevent using a potentially corrupted signature\n+    secp256k1_pubkey pk;\n+    secp256k1_ecdsa_signature sig;\n+    ret = secp256k1_ec_pubkey_create(secp256k1_context_sign, &pk, begin());\n+    assert(ret);\n+    secp256k1_ecdsa_recoverable_signature_convert(GetVerifyContext(), &sig, &rsig);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22934#discussion_r741260486",
      "id" : 741260486,
      "in_reply_to_id" : 740407107,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584sLrzG",
      "original_commit_id" : "c9a920e378b1c8556ea4a3ca8d2cff01c7855484",
      "original_line" : 272,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "src/key.cpp",
      "position" : null,
      "pull_request_review_id" : 795641869,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22934",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741260486/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-02T16:21:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741260486",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/35263201?v=4",
         "events_url" : "https://api.github.com/users/amadeuszpawlik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amadeuszpawlik/followers",
         "following_url" : "https://api.github.com/users/amadeuszpawlik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amadeuszpawlik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amadeuszpawlik",
         "id" : 35263201,
         "login" : "amadeuszpawlik",
         "node_id" : "MDQ6VXNlcjM1MjYzMjAx",
         "organizations_url" : "https://api.github.com/users/amadeuszpawlik/orgs",
         "received_events_url" : "https://api.github.com/users/amadeuszpawlik/received_events",
         "repos_url" : "https://api.github.com/users/amadeuszpawlik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amadeuszpawlik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amadeuszpawlik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amadeuszpawlik"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 79fd28cacbbcb86ea03d3d468845001f84a76de3",
      "created_at" : "2021-11-02T21:23:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22934#issuecomment-958177997",
      "id" : 958177997,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22934",
      "node_id" : "IC_kwDOABII5845HKLN",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/958177997/reactions"
      },
      "updated_at" : "2021-11-02T21:23:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/958177997",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK 79fd28cacbbcb86ea03d3d468845001f84a76de3",
      "created_at" : "2021-11-09T13:11:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22934#issuecomment-964138125",
      "id" : 964138125,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22934",
      "node_id" : "IC_kwDOABII5845d5SN",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/964138125/reactions"
      },
      "updated_at" : "2021-11-09T13:11:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/964138125",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
