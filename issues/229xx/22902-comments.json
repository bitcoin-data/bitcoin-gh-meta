[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK.\r\n\r\n@arnabsen1729 is working on this as part of his [summerofbitcoin.org](https://summerofbitcoin.org) project. I've mentored him along the way. Some earlier review is in https://github.com/0xB10C/bitcoin/pull/1.\r\n\r\nI suspect hooking into the `add` and `spend` tracepoints during IBD could have a noticeable performance impact. I'll test this. If is is the case, then it should be documented. Not hooking into the tracepoints shouldn't have any performance impact.\r\n",
      "created_at" : "2021-09-06T15:25:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#issuecomment-913726985",
      "id" : 913726985,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22902",
      "node_id" : "IC_kwDOABII5842dl4J",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-06T16:22:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/913726985",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r703001878"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703001878"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "what's the purpose of this argument? ",
      "commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "created_at" : "2021-09-06T16:26:26Z",
      "diff_hunk" : "@@ -2120,6 +2120,13 @@ bool CChainState::FlushStateToDisk(\n             nLastFlush = nNow;\n             full_flush_completed = true;\n         }\n+        TRACE6(utxocache, flush,\n+               (int64_t)(GetTimeMicros() - nNow.count()), // in microseconds (Âµs)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r703001878",
      "id" : 703001878,
      "line" : 2124,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMzAwMTg3OA==",
      "original_commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "original_line" : 2124,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 5,
      "pull_request_review_id" : 747350284,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-06T16:38:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703001878",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r703005689"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703005689"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "do we need the hash string here (and the ones below)? we should avoid doing non-negligible computations in traces.",
      "commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "created_at" : "2021-09-06T16:36:38Z",
      "diff_hunk" : "@@ -95,6 +96,15 @@ void CCoinsViewCache::AddCoin(const COutPoint &outpoint, Coin&& coin, bool possi\n     it->second.coin = std::move(coin);\n     it->second.flags |= CCoinsCacheEntry::DIRTY | (fresh ? CCoinsCacheEntry::FRESH : 0);\n     cachedCoinsUsage += it->second.coin.DynamicMemoryUsage();\n+    TRACE8(utxocache, add,\n+           outpoint.hash.ToString().c_str(),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r703005689",
      "id" : 703005689,
      "line" : 100,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMzAwNTY4OQ==",
      "original_commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "original_line" : 100,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 13,
      "pull_request_review_id" : 747350284,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-06T16:38:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703005689",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r703013754"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703013754"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "We need if we want to support the current versions of `bpftrace` as it can't print binary data in hex (or at all really).\r\n\r\nrelated discussion https://github.com/bitcoin/bitcoin/pull/22006#discussion_r638775357 \r\n\r\nmight be worth thinking about adding support for this in `bpftrace` rather than this _work around_ here",
      "commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "created_at" : "2021-09-06T17:01:01Z",
      "diff_hunk" : "@@ -95,6 +96,15 @@ void CCoinsViewCache::AddCoin(const COutPoint &outpoint, Coin&& coin, bool possi\n     it->second.coin = std::move(coin);\n     it->second.flags |= CCoinsCacheEntry::DIRTY | (fresh ? CCoinsCacheEntry::FRESH : 0);\n     cachedCoinsUsage += it->second.coin.DynamicMemoryUsage();\n+    TRACE8(utxocache, add,\n+           outpoint.hash.ToString().c_str(),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r703013754",
      "id" : 703013754,
      "in_reply_to_id" : 703005689,
      "line" : 100,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMzAxMzc1NA==",
      "original_commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "original_line" : 100,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 13,
      "pull_request_review_id" : 747363336,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-06T17:58:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703013754",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r703014722"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703014722"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I agree that `outpoint.hash.ToString().c_str()` here is called _a lot_ more than the `hash.data().toString().c_str()` in the connect_block tracepoint. This could hurt performance. Might need to drop this. ",
      "commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "created_at" : "2021-09-06T17:03:53Z",
      "diff_hunk" : "@@ -95,6 +96,15 @@ void CCoinsViewCache::AddCoin(const COutPoint &outpoint, Coin&& coin, bool possi\n     it->second.coin = std::move(coin);\n     it->second.flags |= CCoinsCacheEntry::DIRTY | (fresh ? CCoinsCacheEntry::FRESH : 0);\n     cachedCoinsUsage += it->second.coin.DynamicMemoryUsage();\n+    TRACE8(utxocache, add,\n+           outpoint.hash.ToString().c_str(),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r703014722",
      "id" : 703014722,
      "in_reply_to_id" : 703005689,
      "line" : 100,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMzAxNDcyMg==",
      "original_commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "original_line" : 100,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 13,
      "pull_request_review_id" : 747364330,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-06T17:47:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703014722",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#9384](https://github.com/bitcoin/bitcoin/pull/9384) (CCoinsViewCache code cleanup & deduplication by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-09-07T00:28:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#issuecomment-913911250",
      "id" : 913911250,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22902",
      "node_id" : "IC_kwDOABII5842eS3S",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-07T00:28:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/913911250",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2021-09-08T07:58:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#issuecomment-915008258",
      "id" : 915008258,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22902",
      "node_id" : "IC_kwDOABII5842iesC",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-08T07:58:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/915008258",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2021-09-08T14:28:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#issuecomment-915289125",
      "id" : 915289125,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22902",
      "node_id" : "IC_kwDOABII5842jjQl",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-08T14:28:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/915289125",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r705041737"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/705041737"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "How about only using the first 64bit of the hash: `outpoint.hash.GetUint64(0)`. This should be very fast and maybe unique enough, at least for the purpose of tracing",
      "commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "created_at" : "2021-09-09T07:12:38Z",
      "diff_hunk" : "@@ -95,6 +96,15 @@ void CCoinsViewCache::AddCoin(const COutPoint &outpoint, Coin&& coin, bool possi\n     it->second.coin = std::move(coin);\n     it->second.flags |= CCoinsCacheEntry::DIRTY | (fresh ? CCoinsCacheEntry::FRESH : 0);\n     cachedCoinsUsage += it->second.coin.DynamicMemoryUsage();\n+    TRACE8(utxocache, add,\n+           outpoint.hash.ToString().c_str(),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r705041737",
      "id" : 705041737,
      "in_reply_to_id" : 703005689,
      "line" : 100,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNTA0MTczNw==",
      "original_commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "original_line" : 100,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 13,
      "pull_request_review_id" : 749964690,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-09T07:12:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/705041737",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r705047534"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/705047534"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "We already pass `outpoint.hash.data()` as the last argument, that's not the issue. The issue here is the `ToString()` part which might be to expensive in such a frequently called function while being only a work around for `bpftrace` not supporting hex-formatting.",
      "commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "created_at" : "2021-09-09T07:19:16Z",
      "diff_hunk" : "@@ -95,6 +96,15 @@ void CCoinsViewCache::AddCoin(const COutPoint &outpoint, Coin&& coin, bool possi\n     it->second.coin = std::move(coin);\n     it->second.flags |= CCoinsCacheEntry::DIRTY | (fresh ? CCoinsCacheEntry::FRESH : 0);\n     cachedCoinsUsage += it->second.coin.DynamicMemoryUsage();\n+    TRACE8(utxocache, add,\n+           outpoint.hash.ToString().c_str(),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r705047534",
      "id" : 705047534,
      "in_reply_to_id" : 703005689,
      "line" : 100,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNTA0NzUzNA==",
      "original_commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "original_line" : 100,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 13,
      "pull_request_review_id" : 749970539,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-09T07:30:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/705047534",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r705176691"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/705176691"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I just came across https://github.com/iovisor/bpftrace/issues/659#issuecomment-568624842. We don't need to use the built-in hex-formatting as it's quite simple just `printf(\"%02x\")` each byte of the txid in an [`unroll () {...}`][1]. This even allows us to print the txids in big-endian (the block-explorer format). \r\n\r\n```\r\n  $p = $txid + 31;\r\n  unroll(32) {\r\n      $b = *(uint8*)$p;\r\n      printf(\"%02x\", $b);\r\n      $p-=1;\r\n  }\r\n```\r\n[1]: https://github.com/iovisor/bpftrace/blob/master/docs/reference_guide.md#9-unroll---unroll\r\n\r\nThis means we can drop the `outpoint.hash.ToString().c_str()` from the tracepoints added here and use the `outpoint.hash.data()` as the first argument. ",
      "commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "created_at" : "2021-09-09T09:55:57Z",
      "diff_hunk" : "@@ -95,6 +96,15 @@ void CCoinsViewCache::AddCoin(const COutPoint &outpoint, Coin&& coin, bool possi\n     it->second.coin = std::move(coin);\n     it->second.flags |= CCoinsCacheEntry::DIRTY | (fresh ? CCoinsCacheEntry::FRESH : 0);\n     cachedCoinsUsage += it->second.coin.DynamicMemoryUsage();\n+    TRACE8(utxocache, add,\n+           outpoint.hash.ToString().c_str(),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r705176691",
      "id" : 705176691,
      "in_reply_to_id" : 703005689,
      "line" : 100,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNTE3NjY5MQ==",
      "original_commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "original_line" : 100,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 13,
      "pull_request_review_id" : 750130308,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-09T09:55:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/705176691",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "My benchmarks (4x reindex-chainstate till block 500000 for both the mergebase 92aad5303b9b96c46015156b5dc96b48e9e7bc76 and 15b8ba500d59c6c5de764cd13c22d0cb44d6bd14) show that this PR increases time spent in `ConnectBlock` by about 3.4%. This is without hooking into the tracepoints. \r\n\r\n![image](https://user-images.githubusercontent.com/19157360/132832934-81727f02-0292-4530-95e7-7e754c843e18.png)\r\n\r\nAs discussed in https://github.com/bitcoin/bitcoin/pull/22902#discussion_r705176691 we can drop the first argument of the `add`, `spent`, and `uncache` tracepoints which should improve the performance. Will re-benchmark then.\r\n",
      "created_at" : "2021-09-10T09:32:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#issuecomment-916768924",
      "id" : 916768924,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22902",
      "node_id" : "IC_kwDOABII5842pMic",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-10T09:35:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/916768924",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r706044573"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706044573"
         }
      },
      "author_association" : "NONE",
      "body" : "The purpose was to get the duration of the flush, this value can be used for benchmarking purposes. \r\n\r\nThe `nNow` was declared here:\r\nhttps://github.com/bitcoin/bitcoin/blob/384d07601185d0779c324392e798da234163ca72/src/validation.cpp#L1969",
      "commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "created_at" : "2021-09-10T09:40:10Z",
      "diff_hunk" : "@@ -2120,6 +2120,13 @@ bool CChainState::FlushStateToDisk(\n             nLastFlush = nNow;\n             full_flush_completed = true;\n         }\n+        TRACE6(utxocache, flush,\n+               (int64_t)(GetTimeMicros() - nNow.count()), // in microseconds (Âµs)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r706044573",
      "id" : 706044573,
      "in_reply_to_id" : 703001878,
      "line" : 2124,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNjA0NDU3Mw==",
      "original_commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "original_line" : 2124,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 5,
      "pull_request_review_id" : 751233617,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-10T09:40:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706044573",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/51032928?v=4",
         "events_url" : "https://api.github.com/users/arnabsen1729/events{/privacy}",
         "followers_url" : "https://api.github.com/users/arnabsen1729/followers",
         "following_url" : "https://api.github.com/users/arnabsen1729/following{/other_user}",
         "gists_url" : "https://api.github.com/users/arnabsen1729/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/arnabsen1729",
         "id" : 51032928,
         "login" : "arnabsen1729",
         "node_id" : "MDQ6VXNlcjUxMDMyOTI4",
         "organizations_url" : "https://api.github.com/users/arnabsen1729/orgs",
         "received_events_url" : "https://api.github.com/users/arnabsen1729/received_events",
         "repos_url" : "https://api.github.com/users/arnabsen1729/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/arnabsen1729/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/arnabsen1729/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/arnabsen1729"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r706509325"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706509325"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nice, I was trying to use unroll like this for printing data in bpftrace but could never figure it out. I was never able to do it based on a length argument, probably because it wasn't a literal. This case works fine though since we know the length of the hash.",
      "commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "created_at" : "2021-09-10T22:55:26Z",
      "diff_hunk" : "@@ -95,6 +96,15 @@ void CCoinsViewCache::AddCoin(const COutPoint &outpoint, Coin&& coin, bool possi\n     it->second.coin = std::move(coin);\n     it->second.flags |= CCoinsCacheEntry::DIRTY | (fresh ? CCoinsCacheEntry::FRESH : 0);\n     cachedCoinsUsage += it->second.coin.DynamicMemoryUsage();\n+    TRACE8(utxocache, add,\n+           outpoint.hash.ToString().c_str(),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r706509325",
      "id" : 706509325,
      "in_reply_to_id" : 703005689,
      "line" : 100,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNjUwOTMyNQ==",
      "original_commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "original_line" : 100,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 13,
      "pull_request_review_id" : 751844670,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-10T22:55:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706509325",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Did some more profiling on a node in IBD running with this PR (https://github.com/bitcoin/bitcoin/commit/15b8ba500d59c6c5de764cd13c22d0cb44d6bd14) to make sure the `ToString()` is really the issue here.\r\n\r\nIn `CCoinsViewCache::SpendCoin` we spend more than half of the time in `ToString()`.  \r\n![image](https://user-images.githubusercontent.com/19157360/132963574-4df9aa0a-6cce-4149-8cb1-8f08ca0b44b8.png)\r\n\r\nIn `CCoinsViewCache::AddCoin` we spend a lot less time in `ToString()` compared to `CCoinsViewCache::SpendCoin`, but still significant time.\r\n![image](https://user-images.githubusercontent.com/19157360/132963510-d62b2a02-29b4-4eaa-b8f8-2123d90d63d2.png)\r\n\r\n\r\n(please ignore the `bitcoind-22902-mergebase` binary name shown here. It's not the mergebase, the binary is build from https://github.com/bitcoin/bitcoin/commit/15b8ba500d59c6c5de764cd13c22d0cb44d6bd14)",
      "created_at" : "2021-09-11T23:00:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#issuecomment-917498376",
      "id" : 917498376,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22902",
      "node_id" : "IC_kwDOABII5842r-oI",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-11T23:00:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/917498376",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think in general good advice is to pass binary/raw data into the trace functions directly. Don't spent effort formatting, you can do this on the other side (and only when necessary, just before presentation to the user).",
      "created_at" : "2021-10-01T07:29:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#issuecomment-931979916",
      "id" : 931979916,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22902",
      "node_id" : "IC_kwDOABII5843jOKM",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/931979916/reactions"
      },
      "updated_at" : "2021-10-01T07:30:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/931979916",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept and light code review ACK, thanks for adding tracepoints!\r\n\r\nEdit: see discussion please remove the `ToString`.",
      "created_at" : "2021-11-10T18:39:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#issuecomment-965631546",
      "id" : 965631546,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22902",
      "node_id" : "IC_kwDOABII5845jl46",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/965631546/reactions"
      },
      "updated_at" : "2021-11-10T19:01:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/965631546",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r746898280"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/746898280"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> We already pass outpoint.hash.data() as the last argument, that's not the issue. The issue here is the ToString() part which might be to expensive in such a frequently called function while being only a work around for bpftrace not supporting hex-formatting.\r\n\r\nI agree here. Let's remove this ToString argument. It's too much overhead to allocate, construct, deallocate a string here every time even if the tracepoint is disabled.",
      "commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "created_at" : "2021-11-10T19:00:11Z",
      "diff_hunk" : "@@ -95,6 +96,15 @@ void CCoinsViewCache::AddCoin(const COutPoint &outpoint, Coin&& coin, bool possi\n     it->second.coin = std::move(coin);\n     it->second.flags |= CCoinsCacheEntry::DIRTY | (fresh ? CCoinsCacheEntry::FRESH : 0);\n     cachedCoinsUsage += it->second.coin.DynamicMemoryUsage();\n+    TRACE8(utxocache, add,\n+           outpoint.hash.ToString().c_str(),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r746898280",
      "id" : 746898280,
      "in_reply_to_id" : 703005689,
      "line" : 100,
      "node_id" : "PRRC_kwDOABII584shMNo",
      "original_commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "original_line" : 100,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 13,
      "pull_request_review_id" : 803028022,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/746898280/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-10T19:00:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/746898280",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for updating!\r\nCode and documentation review ACK 2bc51c5c3215398875c04456a3f3df1c07b830b5",
      "created_at" : "2021-11-29T12:31:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#issuecomment-981592097",
      "id" : 981592097,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22902",
      "node_id" : "IC_kwDOABII5846gegh",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/981592097/reactions"
      },
      "updated_at" : "2021-11-29T12:31:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/981592097",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r758492317"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/758492317"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This tracepoint is being called each time `FlushStateToDisk()` is called, even when we don't flush. We call `FlushStateToDisk()` with `FlushStateMode::PERIODIC` in `AcceptToMemoryPoolWithTime()` for each transaction accepted to mempool.",
      "commit_id" : "2bc51c5c3215398875c04456a3f3df1c07b830b5",
      "created_at" : "2021-11-29T15:48:34Z",
      "diff_hunk" : "@@ -2101,6 +2101,13 @@ bool CChainState::FlushStateToDisk(\n             nLastFlush = nNow;\n             full_flush_completed = true;\n         }\n+        TRACE6(utxocache, flush,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r758492317",
      "id" : 758492317,
      "line" : 2104,
      "node_id" : "PRRC_kwDOABII584tNayd",
      "original_commit_id" : "2bc51c5c3215398875c04456a3f3df1c07b830b5",
      "original_line" : 2104,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 4,
      "pull_request_review_id" : 817979316,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/758492317/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-29T16:16:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/758492317",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r758494620"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/758494620"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "We didn't flush here. We should only trace and log on flushes and not each time `FlushStateToDisk()` is called. See https://github.com/bitcoin/bitcoin/pull/22902#discussion_r758492317.",
      "commit_id" : "2bc51c5c3215398875c04456a3f3df1c07b830b5",
      "created_at" : "2021-11-29T15:50:45Z",
      "diff_hunk" : "@@ -234,3 +234,62 @@ Histogram of block connection times in milliseconds (ms).\n [16, 32)               9 |                                                    |\n [32, 64)               4 |                                                    |\n ```\n+\n+### log_utxocache_flush.py\n+\n+A BCC Python script to log the cache and index flushes. Based on the\n+`utxocache:flush` tracepoint.\n+\n+```bash\n+$ python3 contrib/tracing/log_utxocache_flush.py ./src/bitcoind\n+```\n+\n+```\n+Logging utxocache flushes. Ctrl-C to end...\n+Duration (Âµs)   Mode       Coins Count     Memory Usage    Prune    Full Flush\n+0               PERIODIC   28484           3929.87 kB      False    False",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r758494620",
      "id" : 758494620,
      "line" : 250,
      "node_id" : "PRRC_kwDOABII584tNbWc",
      "original_commit_id" : "2bc51c5c3215398875c04456a3f3df1c07b830b5",
      "original_line" : 250,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "contrib/tracing/README.md",
      "position" : 17,
      "pull_request_review_id" : 817979316,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/758494620/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-29T15:57:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/758494620",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r758611463"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/758611463"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If this is specifically about flushing the UTXO set, it should probably be moved a few lines higher into the conditional where the associated `LOG_TIME_MILLIS...` call is: https://github.com/bitcoin/bitcoin/blob/master/src/validation.cpp#L2087-L2089\r\n\r\nHowever based on the included doc, it sounds like this tracepoint is attempting to include both UTXO cache flushes and block index flushes. I think this will be difficult to do with a single tracepoint, so probably the scope should be reduced to a tracepoint for writing the coins cache to disk.",
      "commit_id" : "2bc51c5c3215398875c04456a3f3df1c07b830b5",
      "created_at" : "2021-11-29T18:03:48Z",
      "diff_hunk" : "@@ -2101,6 +2101,13 @@ bool CChainState::FlushStateToDisk(\n             nLastFlush = nNow;\n             full_flush_completed = true;\n         }\n+        TRACE6(utxocache, flush,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r758611463",
      "id" : 758611463,
      "in_reply_to_id" : 758492317,
      "line" : 2104,
      "node_id" : "PRRC_kwDOABII584tN34H",
      "original_commit_id" : "2bc51c5c3215398875c04456a3f3df1c07b830b5",
      "original_line" : 2104,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 4,
      "pull_request_review_id" : 818139542,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/758611463/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-29T18:03:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/758611463",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r761033288"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/761033288"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Both instances of `bpf_usdt_readarg` read from argument 5. The second one should read from argument 6.\r\n\r\nIf we move the tracepoint the `if (fIsFullFlush) {}` scope then the 6th argument can be dropped completely. ",
      "commit_id" : "2bc51c5c3215398875c04456a3f3df1c07b830b5",
      "created_at" : "2021-12-02T12:10:52Z",
      "diff_hunk" : "@@ -0,0 +1,107 @@\n+#!/usr/bin/env python3\n+\n+import sys\n+import ctypes\n+from bcc import BPF, USDT\n+\n+\"\"\"Example logging Bitcoin Core utxo set cache flushes utilizing\n+    the utxocache:flush tracepoint.\"\"\"\n+\n+# USAGE:  ./contrib/tracing/log_utxocache_flush.py path/to/bitcoind\n+\n+# BCC: The C program to be compiled to an eBPF program (by BCC) and loaded into\n+# a sandboxed Linux kernel VM.\n+program = \"\"\"\n+# include <uapi/linux/ptrace.h>\n+struct data_t\n+{\n+  u64 duration;\n+  u32 mode;\n+  u64 coins_count;\n+  u64 coins_mem_usage;\n+  bool is_flush_prune;\n+  bool is_full_flush;\n+};\n+\n+// BPF perf buffer to push the data to user space.\n+BPF_PERF_OUTPUT(flush);\n+\n+int trace_flush(struct pt_regs *ctx) {\n+  struct data_t data = {};\n+  bpf_usdt_readarg(1, ctx, &data.duration);\n+  bpf_usdt_readarg(2, ctx, &data.mode);\n+  bpf_usdt_readarg(3, ctx, &data.coins_count);\n+  bpf_usdt_readarg(4, ctx, &data.coins_mem_usage);\n+  bpf_usdt_readarg(5, ctx, &data.is_flush_prune);\n+  bpf_usdt_readarg(5, ctx, &data.is_full_flush);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r761033288",
      "id" : 761033288,
      "line" : 36,
      "node_id" : "PRRC_kwDOABII584tXHJI",
      "original_commit_id" : "2bc51c5c3215398875c04456a3f3df1c07b830b5",
      "original_line" : 36,
      "original_position" : 36,
      "original_start_line" : 35,
      "path" : "contrib/tracing/log_utxocache_flush.py",
      "position" : 36,
      "pull_request_review_id" : 821417454,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/761033288/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 35,
      "start_side" : "RIGHT",
      "updated_at" : "2021-12-02T12:10:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/761033288",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I don't think reverting is a good idea. We only do that in the case of emergencies: breaking the build or bugs which inconvenience current users of the master branch. All of this is sufficiently experimental that it doesn't bother anyone when it's not in a release. Let's handle it in a follow-up PR.",
      "created_at" : "2021-12-04T10:44:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#issuecomment-986007124",
      "id" : 986007124,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22902",
      "node_id" : "IC_kwDOABII5846xUZU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/986007124/reactions"
      },
      "updated_at" : "2021-12-04T10:44:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/986007124",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Agree that a follow-up is better suited here.",
      "created_at" : "2021-12-06T11:12:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#issuecomment-986676516",
      "id" : 986676516,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22902",
      "node_id" : "IC_kwDOABII5846z30k",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/986676516/reactions"
      },
      "updated_at" : "2021-12-06T11:12:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/986676516",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I've just tested the `log_utxos.bt` on mainnet and it's giving me this output:\r\n\r\n```\r\nSpent  0b9ab1dc44cf8ff9a3b9d4Lost 20 events\r\n94Lost 36 events\r\nf6Lost 33 events\r\nb241Lost 32 events\r\nb2Lost 32 events\r\nSpent  6ae7e6eb7cffLost 28 events\r\nbcLost 43 events\r\nfaLost 46 events\r\n09Lost 24 events\r\n37Lost 19 events\r\n2fLost 32 events\r\nSpent  1bfaf48e84d8b3dc2c3ebe282d8842Lost 34 events\r\nc0Lost 18 events\r\n5e17Lost 17 events\r\n8aLost 42 events\r\n0dLost 39 events\r\n7ee9Lost 31 events\r\nSpent  bbc2c4ccbd1c3d6583cacd4a8572b2Lost 44 events\r\n```\r\n\r\nThe tracepoints `utxocache:add` and `utxocache:spent` tracepoints are called very frequently during block connections causing events to be lost as the buffer fills before it read. Haven't tested if attaching to the two tracepoints via a BCC Python script or Rust program behaves differently.\r\n\r\n\r\nI'm seeing events being lost during testnet and signet IBD too, however not as many as on mainnet (as the blocks contain fewer transactions and thus fewer changes to the UTXO set).",
      "created_at" : "2021-12-06T11:28:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#issuecomment-986688802",
      "id" : 986688802,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22902",
      "node_id" : "IC_kwDOABII5846z60i",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/986688802/reactions"
      },
      "updated_at" : "2021-12-06T11:30:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/986688802",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Let's handle it in a follow-up PR.\r\n\r\nfwiw: @arnabsen1729 is working on a follow-up",
      "created_at" : "2021-12-06T12:01:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#issuecomment-986709762",
      "id" : 986709762,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22902",
      "node_id" : "IC_kwDOABII5846z_8C",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/986709762/reactions"
      },
      "updated_at" : "2021-12-06T12:01:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/986709762",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "On Mon, Dec 06, 2021 at 03:28:44AM -0800, 0xB10C wrote:\r\n>I've just tested the `log_utxos.bt` on mainnet and it's giving me this output:\r\n>\r\n>94Lost 36 events\r\n>[..]\r\n>\r\n>The tracepoints `utxocache:add` and `utxocache:spent` tracepoints are called very frequently during block connections causing events to be lost as the buffer fills before it read. Haven't tested if attaching to the two tracepoints via a BCC Python script or Rust program behaves differently.\r\n\r\nInteresting, it looks like this is a fundamental limitation of the ring buffer. If you're generating events faster than the script can process them, it looks like events will be dropped. \r\n\r\nLooking at the script, calling printf 32 times might be pretty slow relative to the incoming events. Is it possible to call printf once with 32 %02x entries in the format string?\r\n",
      "created_at" : "2021-12-06T18:29:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#issuecomment-987042594",
      "id" : 987042594,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22902",
      "node_id" : "IC_kwDOABII58461RMi",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/987042594/reactions"
      },
      "updated_at" : "2021-12-06T19:08:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/987042594",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Looking at the script, calling printf 32 times might be pretty slow relative to the incoming events. Is it possible to call printf once with 32 %02x entries in the format string?\r\n\r\nMaybe, yes.\r\n\r\nIn BCC you can set the page count of the ring buffer. That worked for me in the past. You can control bpftrace's ring buffer page count with `BPFTRACE_PERF_RB_PAGES` (needs to be set to a power of two).\r\n\r\nRunning `BPFTRACE_PERF_RB_PAGES=16384 bpftrace contrib/tracing/log_utxos.bt` is the lowest page size that works for me here without dropping events. Default is 64.",
      "created_at" : "2021-12-06T19:12:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#issuecomment-987094612",
      "id" : 987094612,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22902",
      "node_id" : "IC_kwDOABII58461d5U",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/987094612/reactions"
      },
      "updated_at" : "2021-12-06T19:12:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/987094612",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@0xB10C that seems to be a better solution, since I imagine people will have harder workloads than 32 printfs...",
      "created_at" : "2021-12-06T19:14:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#issuecomment-987097953",
      "id" : 987097953,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22902",
      "node_id" : "IC_kwDOABII58461eth",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/987097953/reactions"
      },
      "updated_at" : "2021-12-06T19:14:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/987097953",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "yes, I guess mentioning this on either the docs or examples page would be good. Could be done in @arnabsen1729 follow-up.",
      "created_at" : "2021-12-06T19:18:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#issuecomment-987105342",
      "id" : 987105342,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22902",
      "node_id" : "IC_kwDOABII58461gg-",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/987105342/reactions"
      },
      "updated_at" : "2021-12-06T19:18:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/987105342",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "if the page size is 4096 (some quick googling, not sure if correct), then 16384 pages is ~67 MB. seems pretty high but not unreasonable...",
      "created_at" : "2021-12-06T19:20:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#issuecomment-987106330",
      "id" : 987106330,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22902",
      "node_id" : "IC_kwDOABII58461gwa",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/987106330/reactions"
      },
      "updated_at" : "2021-12-06T19:20:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/987106330",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   }
]
