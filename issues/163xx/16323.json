{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "This is a bit of a rework of #16175, which is a rework of #12934. Built on top of #16279.\r\n\r\nThis is a roughly-minimal patchset to get PNB processing blocks in the background in a clean way, however it doesn't *actually* enable any material parallelism yet - it only sets up a structure for significantly untangling cs_main in coming work.\r\n\r\nNext steps:\r\n * Notably, ProcessMessages will now call PNB, get a future for the block being fully processed, and then immediately block on cs_main waiting to process reject messages and other CNodeState data. This is rather easy to resolve using the new CPeerState (see comment about how we should slowly move things into CPeerState to reduce cs_main contention).\r\n * In parallel, PNB (and, thus, CheckBlock, and the pre-store AcceptBlock bits) should start losing cs_main, this is primarily doable by splitting mapBlockIndex out of cs_main (probably via something like mempool.cs, where a cs_blockindex acts as a read mutex while writers take cs_main. Given the prevalence of cs_main calls just to look up entries in mapBlockIndex, this should improve things pretty significantly.",
   "closed_at" : "2019-11-12T20:21:15Z",
   "closed_by" : {
      "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
      "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
      "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/TheBlueMatt",
      "id" : 649246,
      "login" : "TheBlueMatt",
      "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
      "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
      "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
      "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/TheBlueMatt"
   },
   "comments" : 5,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16323/comments",
   "created_at" : "2019-07-02T15:47:38Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16323/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/16323",
   "id" : 463305275,
   "labels" : [
      {
         "color" : "fef2c0",
         "default" : false,
         "id" : 1392286103,
         "name" : "Needs Conceptual Review",
         "node_id" : "MDU6TGFiZWwxMzkyMjg2MTAz",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20Conceptual%20Review"
      },
      {
         "color" : "cccccc",
         "default" : false,
         "id" : 955867938,
         "name" : "Needs rebase",
         "node_id" : "MDU6TGFiZWw5NTU4Njc5Mzg=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase"
      },
      {
         "color" : "6060aa",
         "default" : false,
         "id" : 118379652,
         "name" : "Validation",
         "node_id" : "MDU6TGFiZWwxMTgzNzk2NTI=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Validation"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16323/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDExOlB1bGxSZXF1ZXN0MjkzODExMzIy",
   "number" : 16323,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/16323.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16323",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/16323.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16323"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : " Call ProcessNewBlock() asynchronously",
   "updated_at" : "2019-11-12T20:21:15Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16323",
   "user" : {
      "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
      "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
      "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/TheBlueMatt",
      "id" : 649246,
      "login" : "TheBlueMatt",
      "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
      "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
      "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
      "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/TheBlueMatt"
   }
}
