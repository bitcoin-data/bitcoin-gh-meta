[
   {
      "body" : "The current implementation is not optimised for large \"enterprise\" size wallets. I guess `listunspent` mainly suffers from the fact that it goes over the **complete** `mapWallet` (in memory map of all transactions), in your case ~520k transactions.\r\n\r\nThere is a little optimisation in master that hasn't been deployed (will be in 0.15):\r\n#8952",
      "created_at" : "2017-06-01T05:51:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/10492#issuecomment-305395693",
      "id" : 305395693,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10492",
      "updated_at" : "2017-06-01T05:51:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/305395693",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "The current process for finding unspents is inefficient. These PRs aim or aimed at improving listunspent performance, I'd recommend investigating them:\r\n- Add index to wallet UTXO #7823 (closed)\r\n- Cache vout IsMine() value on `CWallet::AvailableCoins()` #9939",
      "created_at" : "2017-06-01T06:35:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/10492#issuecomment-305402140",
      "id" : 305402140,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10492",
      "updated_at" : "2017-06-01T06:35:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/305402140",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Related:  #7475",
      "created_at" : "2017-06-06T10:22:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/10492#issuecomment-306444586",
      "id" : 306444586,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10492",
      "updated_at" : "2017-06-06T10:22:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/306444586",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "> Even with a small (~50) amount of inputs, calling bitcoin-cli listunspent is rather slow taking between 7 and 15 seconds on a high powered machine with lots of memory. \r\n\r\nTo be clear, this is a wallet with tens of thousands of transactions in it-- right?  Listunspent iterates over all the transactions, not just the ones with unspent outputs.",
      "created_at" : "2017-06-06T21:59:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/10492#issuecomment-306629800",
      "id" : 306629800,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10492",
      "updated_at" : "2017-06-06T21:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/306629800",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "@gmaxwell  Sorry, I meant a small amount of unspent outputs. (as in, the listunspent return result is quite small) but yeah the wallet itself has a lot of transactions",
      "created_at" : "2017-06-06T22:02:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/10492#issuecomment-306630415",
      "id" : 306630415,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10492",
      "updated_at" : "2017-06-06T22:03:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/306630415",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/9326759?v=3",
         "events_url" : "https://api.github.com/users/RHavar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/RHavar/followers",
         "following_url" : "https://api.github.com/users/RHavar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/RHavar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/RHavar",
         "id" : 9326759,
         "login" : "RHavar",
         "organizations_url" : "https://api.github.com/users/RHavar/orgs",
         "received_events_url" : "https://api.github.com/users/RHavar/received_events",
         "repos_url" : "https://api.github.com/users/RHavar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/RHavar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/RHavar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/RHavar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Indeed for large wallets the current implementation is slow and @joaopaulofonseca tried to improve parts of the algorithm. In the past I've submitted #7649 which improved a bit. It is hard to improve taking the current wallet implementation.\r\n\r\nIf you must create a lot of transactions then I can suggest:\r\n- cache externally: you periodically retrieve unspents and then try to first spend those when creating new transactions. With that approach you have to deal with change output and fee calculation;\r\n- create a new \"send wallet\" when the current has more than N transactions. Just transfer the balance to an address of the new wallet.",
      "created_at" : "2017-12-07T14:15:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/10492#issuecomment-349978893",
      "id" : 349978893,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10492",
      "updated_at" : "2017-12-07T14:15:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/349978893",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The feature request didn't seem to attract much attention in the past. Also, the issue seems not important enough right now to keep it sitting around idle in the list of open issues.\r\n\r\nClosing due to lack of interest. Pull requests with improvements are always welcome.",
      "created_at" : "2020-05-09T12:32:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/10492#issuecomment-626169164",
      "id" : 626169164,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10492",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyNjE2OTE2NA==",
      "updated_at" : "2020-05-09T12:32:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/626169164",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
