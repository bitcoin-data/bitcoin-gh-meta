[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [instagibbs](https://github.com/bitcoin/bitcoin/pull/26646#issuecomment-1377439712), [achow101](https://github.com/bitcoin/bitcoin/pull/26646#issuecomment-1377986578), [naumenkogs](https://github.com/bitcoin/bitcoin/pull/26646#issuecomment-1378344587) |\n| Approach ACK | [stickies-v](https://github.com/bitcoin/bitcoin/pull/26646#pullrequestreview-1223169114) |\n| Stale ACK | [vincenzopalazzo](https://github.com/bitcoin/bitcoin/pull/26646#pullrequestreview-1223340153) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#26711](https://github.com/bitcoin/bitcoin/pull/26711) ([WIP] validate package transactions with their in-package ancestor sets by glozow)\n* [#25429](https://github.com/bitcoin/bitcoin/pull/25429) (refactor: Avoid UniValue copies by MarcoFalke)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2022-12-06T10:43:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#issuecomment-1339126268",
      "id" : 1339126268,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26646",
      "node_id" : "IC_kwDOABII585P0XH8",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1339126268/reactions"
      },
      "updated_at" : "2023-01-11T07:36:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1339126268",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1041150868"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1041150868"
         }
      },
      "author_association" : "MEMBER",
      "body" : "call this \"nonfinal\" or something seems clearer to me than mutable ",
      "commit_id" : "139e0e10d96a53231b8c5179def33627aed48d3e",
      "created_at" : "2022-12-06T15:52:18Z",
      "diff_hunk" : "@@ -1343,6 +1344,11 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptPackage(const Package& package,\n     // the new transactions. This ensures we don't double-count transaction counts and sizes when\n     // checking ancestor/descendant limits, or double-count transaction fees for fee-related policy.\n     ATMPArgs single_args = ATMPArgs::SingleInPackageAccept(args);\n+    // Results from individual validation. \"Mutable\" because if a transaction fails by itself but\n+    // succeeds later (i.e. when evaluated with a fee-bumping child), the result changes (though not\n+    // reflected in this map). If a transaction fails more than once, we want to return the first\n+    // result, when it was considered on its own. So changes will only be from invalid -> valid.\n+    std::map<uint256, MempoolAcceptResult> individual_results_mutable;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1041150868",
      "id" : 1041150868,
      "line" : 1351,
      "node_id" : "PRRC_kwDOABII584-DrOU",
      "original_commit_id" : "139e0e10d96a53231b8c5179def33627aed48d3e",
      "original_line" : 1351,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 16,
      "pull_request_review_id" : 1206854880,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1041150868/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-06T16:13:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1041150868",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1041170332"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1041170332"
         }
      },
      "author_association" : "MEMBER",
      "body" : "at 139e0e10d96a53231b8c5179def33627aed48d3e commenting out this line doesn't seem to fail any tests, but it does for this particular commit.",
      "commit_id" : "139e0e10d96a53231b8c5179def33627aed48d3e",
      "created_at" : "2022-12-06T16:08:56Z",
      "diff_hunk" : "@@ -1380,6 +1380,8 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptPackage(const Package& package,\n                 // future.  Continue individually validating the rest of the transactions, because\n                 // some of them may still be valid.\n                 quit_early = true;\n+                package_state.Invalid(PackageValidationResult::PCKG_TX, \"transaction failed\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1041170332",
      "id" : 1041170332,
      "line" : 1398,
      "node_id" : "PRRC_kwDOABII584-Dv-c",
      "original_commit_id" : "c1cd5e340e277d30cf80b5a4c183db0c7b94ca1d",
      "original_line" : 1383,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 4,
      "pull_request_review_id" : 1206854880,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1041170332/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-06T16:13:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1041170332",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1041174515"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1041174515"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ever slightly so meta, but I think `txns_new` should instead be called `package_eval_txns` or something, since there are other new transactions that have been not included in this set, due to being accepted individually. ",
      "commit_id" : "139e0e10d96a53231b8c5179def33627aed48d3e",
      "created_at" : "2022-12-06T16:12:24Z",
      "diff_hunk" : "@@ -1390,24 +1396,40 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptPackage(const Package& package,\n                 // some of them may still be valid.\n                 quit_early = true;\n                 package_state.Invalid(PackageValidationResult::PCKG_TX, \"transaction failed\");\n-                results.emplace(wtxid, single_res);\n+                individual_results_mutable.emplace(wtxid, single_res);\n             } else {\n+                package_state.Invalid(PackageValidationResult::PCKG_TX, \"transaction failed\");\n+                individual_results_mutable.emplace(wtxid, single_res);\n                 txns_new.push_back(tx);\n             }\n         }\n     }\n \n     // Nothing to do if the entire package has already been submitted.\n     if (quit_early || txns_new.empty()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1041174515",
      "id" : 1041174515,
      "line" : 1409,
      "node_id" : "PRRC_kwDOABII584-Dw_z",
      "original_commit_id" : "139e0e10d96a53231b8c5179def33627aed48d3e",
      "original_line" : 1409,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 35,
      "pull_request_review_id" : 1206854880,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1041174515/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-06T16:13:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1041174515",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1041477981"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1041477981"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I see what you mean yeah. Will tweak the test.",
      "commit_id" : "139e0e10d96a53231b8c5179def33627aed48d3e",
      "created_at" : "2022-12-06T21:28:34Z",
      "diff_hunk" : "@@ -1380,6 +1380,8 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptPackage(const Package& package,\n                 // future.  Continue individually validating the rest of the transactions, because\n                 // some of them may still be valid.\n                 quit_early = true;\n+                package_state.Invalid(PackageValidationResult::PCKG_TX, \"transaction failed\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1041477981",
      "id" : 1041477981,
      "in_reply_to_id" : 1041170332,
      "line" : 1398,
      "node_id" : "PRRC_kwDOABII584-E7Fd",
      "original_commit_id" : "c1cd5e340e277d30cf80b5a4c183db0c7b94ca1d",
      "original_line" : 1383,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 4,
      "pull_request_review_id" : 1207353140,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1041477981/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-06T21:28:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1041477981",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1042150573"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1042150573"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah, the problem was the same line exists in the non-quit-early case as well. Deleted that as it's incorrect - if we're not quitting early then `package_state` won't be used. The non-quit-early case shouldn't be modifying package_state. Also added a comment/rename to make this more clear.\r\n\r\nThis also has the effect of making the test fail if you comment out this line on the last commit.",
      "commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "created_at" : "2022-12-07T12:35:32Z",
      "diff_hunk" : "@@ -1380,6 +1380,8 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptPackage(const Package& package,\n                 // future.  Continue individually validating the rest of the transactions, because\n                 // some of them may still be valid.\n                 quit_early = true;\n+                package_state.Invalid(PackageValidationResult::PCKG_TX, \"transaction failed\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1042150573",
      "id" : 1042150573,
      "in_reply_to_id" : 1041170332,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-HfSt",
      "original_commit_id" : "c1cd5e340e277d30cf80b5a4c183db0c7b94ca1d",
      "original_line" : 1383,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1208338420,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1042150573/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-07T12:38:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1042150573",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1042151123"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1042151123"
         }
      },
      "author_association" : "MEMBER",
      "body" : "renamed to individual_results_nonfinal",
      "commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "created_at" : "2022-12-07T12:36:04Z",
      "diff_hunk" : "@@ -1343,6 +1344,11 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptPackage(const Package& package,\n     // the new transactions. This ensures we don't double-count transaction counts and sizes when\n     // checking ancestor/descendant limits, or double-count transaction fees for fee-related policy.\n     ATMPArgs single_args = ATMPArgs::SingleInPackageAccept(args);\n+    // Results from individual validation. \"Mutable\" because if a transaction fails by itself but\n+    // succeeds later (i.e. when evaluated with a fee-bumping child), the result changes (though not\n+    // reflected in this map). If a transaction fails more than once, we want to return the first\n+    // result, when it was considered on its own. So changes will only be from invalid -> valid.\n+    std::map<uint256, MempoolAcceptResult> individual_results_mutable;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1042151123",
      "id" : 1042151123,
      "in_reply_to_id" : 1041150868,
      "line" : 1352,
      "node_id" : "PRRC_kwDOABII584-HfbT",
      "original_commit_id" : "139e0e10d96a53231b8c5179def33627aed48d3e",
      "original_line" : 1352,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 144,
      "pull_request_review_id" : 1208338420,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1042151123/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-07T12:38:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1042151123",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1042153215"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1042153215"
         }
      },
      "author_association" : "MEMBER",
      "body" : "renamed, no problem. 3line diff",
      "commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "created_at" : "2022-12-07T12:37:50Z",
      "diff_hunk" : "@@ -1390,24 +1396,40 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptPackage(const Package& package,\n                 // some of them may still be valid.\n                 quit_early = true;\n                 package_state.Invalid(PackageValidationResult::PCKG_TX, \"transaction failed\");\n-                results.emplace(wtxid, single_res);\n+                individual_results_mutable.emplace(wtxid, single_res);\n             } else {\n+                package_state.Invalid(PackageValidationResult::PCKG_TX, \"transaction failed\");\n+                individual_results_mutable.emplace(wtxid, single_res);\n                 txns_new.push_back(tx);\n             }\n         }\n     }\n \n     // Nothing to do if the entire package has already been submitted.\n     if (quit_early || txns_new.empty()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1042153215",
      "id" : 1042153215,
      "in_reply_to_id" : 1041174515,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-Hf7_",
      "original_commit_id" : "139e0e10d96a53231b8c5179def33627aed48d3e",
      "original_line" : 1409,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1208338420,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1042153215/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-07T12:38:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1042153215",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1042272401"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1042272401"
         }
      },
      "author_association" : "MEMBER",
      "body" : "name is still the same as before",
      "commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "created_at" : "2022-12-07T14:27:12Z",
      "diff_hunk" : "@@ -1343,6 +1344,11 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptPackage(const Package& package,\n     // the new transactions. This ensures we don't double-count transaction counts and sizes when\n     // checking ancestor/descendant limits, or double-count transaction fees for fee-related policy.\n     ATMPArgs single_args = ATMPArgs::SingleInPackageAccept(args);\n+    // Results from individual validation. \"Mutable\" because if a transaction fails by itself but\n+    // succeeds later (i.e. when evaluated with a fee-bumping child), the result changes (though not\n+    // reflected in this map). If a transaction fails more than once, we want to return the first\n+    // result, when it was considered on its own. So changes will only be from invalid -> valid.\n+    std::map<uint256, MempoolAcceptResult> individual_results_mutable;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1042272401",
      "id" : 1042272401,
      "in_reply_to_id" : 1041150868,
      "line" : 1352,
      "node_id" : "PRRC_kwDOABII584-H9CR",
      "original_commit_id" : "139e0e10d96a53231b8c5179def33627aed48d3e",
      "original_line" : 1352,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 144,
      "pull_request_review_id" : 1208518372,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1042272401/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-07T14:34:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1042272401",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1043849641"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1043849641"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm wondering how well-defined this value is. Am I right in thinking that the calculation here is \"sum(fees_of_package_transactions)/sum(size_of_package_transactions)\"?\r\n\r\nWhat happens in this case: we have 3 transactions A -> B, C, where C is a child of both A and B.\r\n\r\nA has a low feerate and cannot make it in to the mempool by itself.  (A+B) has a high enough feerate for acceptance, but we receive for validation (A+B+C) instead.  B cannot make it in by itself, since it would be missing a parent, and we never try A+B, right?  So the package feerate for C would reflect the fees and feerate of B (which could be higher than C's own feerate, I think?).\r\n\r\nDo we require that C pay a higher feerate than any of its parents when doing package acceptance?  If not, then I'm not sure this value will always make sense, ie the package feerate of a transaction with no children ought never be greater than its own feerate.",
      "commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "created_at" : "2022-12-08T21:37:58Z",
      "diff_hunk" : "@@ -582,6 +582,11 @@ class MemPoolAccept\n         /** Total virtual size of all transactions being replaced. */\n         size_t m_conflicting_size{0};\n \n+        /** If we're doing package validation (i.e. m_package_feerates=true), the \"effective\"\n+         * package feerate of this transaction, which may include fee and vsize of its ancestors\n+         * and/or descendants. */\n+        CFeeRate m_package_feerate{0};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1043849641",
      "id" : 1043849641,
      "line" : 588,
      "node_id" : "PRRC_kwDOABII584-N-Gp",
      "original_commit_id" : "70d1af27cfcc9db68d7f26fa15eb7ee9510bbde1",
      "original_line" : 588,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 7,
      "pull_request_review_id" : 1210815392,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1043849641/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-08T21:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1043849641",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1043854324"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1043854324"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Does this comment equally apply to package submission in master?",
      "commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "created_at" : "2022-12-08T21:44:52Z",
      "diff_hunk" : "@@ -582,6 +582,11 @@ class MemPoolAccept\n         /** Total virtual size of all transactions being replaced. */\n         size_t m_conflicting_size{0};\n \n+        /** If we're doing package validation (i.e. m_package_feerates=true), the \"effective\"\n+         * package feerate of this transaction, which may include fee and vsize of its ancestors\n+         * and/or descendants. */\n+        CFeeRate m_package_feerate{0};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1043854324",
      "id" : 1043854324,
      "in_reply_to_id" : 1043849641,
      "line" : 588,
      "node_id" : "PRRC_kwDOABII584-N_P0",
      "original_commit_id" : "70d1af27cfcc9db68d7f26fa15eb7ee9510bbde1",
      "original_line" : 588,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 7,
      "pull_request_review_id" : 1210822120,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1043854324/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-08T21:44:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1043854324",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1043876437"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1043876437"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think so, but I was about to write a test using the example above, except where C is 0-fee, and see if it makes it in...",
      "commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "created_at" : "2022-12-08T22:17:41Z",
      "diff_hunk" : "@@ -582,6 +582,11 @@ class MemPoolAccept\n         /** Total virtual size of all transactions being replaced. */\n         size_t m_conflicting_size{0};\n \n+        /** If we're doing package validation (i.e. m_package_feerates=true), the \"effective\"\n+         * package feerate of this transaction, which may include fee and vsize of its ancestors\n+         * and/or descendants. */\n+        CFeeRate m_package_feerate{0};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1043876437",
      "id" : 1043876437,
      "in_reply_to_id" : 1043849641,
      "line" : 588,
      "node_id" : "PRRC_kwDOABII584-OEpV",
      "original_commit_id" : "70d1af27cfcc9db68d7f26fa15eb7ee9510bbde1",
      "original_line" : 588,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 7,
      "pull_request_review_id" : 1210854166,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1043876437/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-08T22:17:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1043876437",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1044346662"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1044346662"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, master does not currently handle this case because we're currently doing A, B, C individually, so we'd get 1 \"too low fee\" and 2 \"missing inputs,\" and then reject all of them. When I first tried to implement for 1-child-with-parents, I had incorrectly assumed this was okay and the code made it in before I realized - my apologies for that. The intention is definitely to fix it.\r\n\r\nRequiring C pay a higher feerate than its parents is ok in the child-with-parents scenario but not generic ancestor package scenario (imagine low fee grandparent, lower fee parent, high fee child). I think we've discussed \"for each tx in topological order, calculate its in-package ancestor set that hasn't made it in yet, and submit that as a package\" - I have drafted this [here](https://github.com/glozow/bitcoin/commit/ef4e4936ab692d87dc0d5d55ac61e13940565947).\r\n\r\nBtw this test case is implemented [here](https://github.com/glozow/bitcoin/commit/6659757cd547e4c3f6b62ef80cbc8cdda4b301b9) (it should fail on master as you expect).",
      "commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "created_at" : "2022-12-09T11:12:22Z",
      "diff_hunk" : "@@ -582,6 +582,11 @@ class MemPoolAccept\n         /** Total virtual size of all transactions being replaced. */\n         size_t m_conflicting_size{0};\n \n+        /** If we're doing package validation (i.e. m_package_feerates=true), the \"effective\"\n+         * package feerate of this transaction, which may include fee and vsize of its ancestors\n+         * and/or descendants. */\n+        CFeeRate m_package_feerate{0};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1044346662",
      "id" : 1044346662,
      "in_reply_to_id" : 1043849641,
      "line" : 588,
      "node_id" : "PRRC_kwDOABII584-P3cm",
      "original_commit_id" : "70d1af27cfcc9db68d7f26fa15eb7ee9510bbde1",
      "original_line" : 588,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 7,
      "pull_request_review_id" : 1211507173,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1044346662/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-09T11:12:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1044346662",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1044552718"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1044552718"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can confirm the patch fails as expected: the entire triangle package makes it in the mempool ",
      "commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "created_at" : "2022-12-09T15:12:27Z",
      "diff_hunk" : "@@ -582,6 +582,11 @@ class MemPoolAccept\n         /** Total virtual size of all transactions being replaced. */\n         size_t m_conflicting_size{0};\n \n+        /** If we're doing package validation (i.e. m_package_feerates=true), the \"effective\"\n+         * package feerate of this transaction, which may include fee and vsize of its ancestors\n+         * and/or descendants. */\n+        CFeeRate m_package_feerate{0};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1044552718",
      "id" : 1044552718,
      "in_reply_to_id" : 1043849641,
      "line" : 588,
      "node_id" : "PRRC_kwDOABII584-QpwO",
      "original_commit_id" : "70d1af27cfcc9db68d7f26fa15eb7ee9510bbde1",
      "original_line" : 588,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 7,
      "pull_request_review_id" : 1211811542,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1044552718/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-09T15:12:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1044552718",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1045879297"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1045879297"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: list initialization (and in a few more places down below)\r\n```suggestion\r\n        CMutableTransaction mtx_parent_invalid{mtx_parent};\r\n```",
      "commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "created_at" : "2022-12-12T14:14:50Z",
      "diff_hunk" : "@@ -275,7 +274,30 @@ BOOST_FIXTURE_TEST_CASE(package_submission_tests, TestChain100Setup)\n         BOOST_CHECK_EQUAL(result_3gen_submit.m_state.GetResult(), PackageValidationResult::PCKG_POLICY);\n         BOOST_CHECK_EQUAL(result_3gen_submit.m_state.GetRejectReason(), \"package-not-child-with-parents\");\n         BOOST_CHECK_EQUAL(m_node.mempool->size(), expected_pool_size);\n-        BOOST_CHECK(result_3gen_submit.m_package_feerate == std::nullopt);\n+    }\n+\n+    // Parent and child package where transactions are invalid for reasons other than fee and\n+    // missing inputs, so the package validation isn't expected to happen.\n+    {\n+        CScriptWitness bad_witness;\n+        bad_witness.stack.push_back(std::vector<unsigned char>(1));\n+        CMutableTransaction mtx_parent_invalid = mtx_parent;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1045879297",
      "id" : 1045879297,
      "line" : 284,
      "node_id" : "PRRC_kwDOABII584-VtoB",
      "original_commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "original_line" : 284,
      "original_position" : 53,
      "original_start_line" : null,
      "path" : "src/test/txpackage_tests.cpp",
      "position" : 53,
      "pull_request_review_id" : 1213662405,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1045879297/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-12T18:01:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1045879297",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1045968527"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1045968527"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit\r\n```suggestion\r\n    const CFeeRate effective_feerate{ws.m_modified_fees, ws.m_vsize};\r\n```",
      "commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "created_at" : "2022-12-12T15:24:23Z",
      "diff_hunk" : "@@ -1176,16 +1182,17 @@ MempoolAcceptResult MemPoolAccept::AcceptSingleTransaction(const CTransactionRef\n \n     if (!ConsensusScriptChecks(args, ws)) return MempoolAcceptResult::Failure(ws.m_state);\n \n+    const CFeeRate effective_feerate(ws.m_modified_fees, ws.m_vsize);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1045968527",
      "id" : 1045968527,
      "line" : 1185,
      "node_id" : "PRRC_kwDOABII584-WDaP",
      "original_commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "original_line" : 1185,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 28,
      "pull_request_review_id" : 1213662405,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1045968527/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-12T18:01:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1045968527",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1046011831"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1046011831"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: since this is a member of \"fees\", I think \"effective-rate\" can be a less verbose alternative (and also consistent with \"base\")\r\n```suggestion\r\n                        {RPCResult::Type::STR_AMOUNT, \"effective-rate\", /*optional=*/true, \"if something other than base feerate was used, the effective feerate in \" + CURRENCY_UNIT + \" per KvB. For example, the package feerate and/or feerate with modified fees from prioritisetransaction.\"},\r\n```",
      "commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "created_at" : "2022-12-12T15:54:58Z",
      "diff_hunk" : "@@ -124,6 +124,7 @@ static RPCHelpMan testmempoolaccept()\n                     {RPCResult::Type::OBJ, \"fees\", /*optional=*/true, \"Transaction fees (only present if 'allowed' is true)\",\n                     {\n                         {RPCResult::Type::STR_AMOUNT, \"base\", \"transaction fee in \" + CURRENCY_UNIT},\n+                        {RPCResult::Type::STR_AMOUNT, \"effective-feerate\", /*optional=*/true, \"if something other than base feerate was used, the effective feerate in \" + CURRENCY_UNIT + \" per KvB. For example, the package feerate and/or feerate with modified fees from prioritisetransaction.\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1046011831",
      "id" : 1046011831,
      "line" : 127,
      "node_id" : "PRRC_kwDOABII584-WN-3",
      "original_commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "original_line" : 127,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : 4,
      "pull_request_review_id" : 1213662405,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1046011831/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-12T18:01:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1046011831",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1046013886"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1046013886"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Have you considered always including this field? Besides the minimal data overhead, I don't see a reason to not always include it. Simplifies the logic for both server and client?",
      "commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "created_at" : "2022-12-12T15:56:21Z",
      "diff_hunk" : "@@ -124,6 +124,7 @@ static RPCHelpMan testmempoolaccept()\n                     {RPCResult::Type::OBJ, \"fees\", /*optional=*/true, \"Transaction fees (only present if 'allowed' is true)\",\n                     {\n                         {RPCResult::Type::STR_AMOUNT, \"base\", \"transaction fee in \" + CURRENCY_UNIT},\n+                        {RPCResult::Type::STR_AMOUNT, \"effective-feerate\", /*optional=*/true, \"if something other than base feerate was used, the effective feerate in \" + CURRENCY_UNIT + \" per KvB. For example, the package feerate and/or feerate with modified fees from prioritisetransaction.\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1046013886",
      "id" : 1046013886,
      "in_reply_to_id" : 1046011831,
      "line" : 127,
      "node_id" : "PRRC_kwDOABII584-WOe-",
      "original_commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "original_line" : 127,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : 4,
      "pull_request_review_id" : 1213662405,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1046013886/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-12T18:01:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1046013886",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1046025065"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1046025065"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "imo this is less readable than the previous `for package_txn in package_txns:`\r\n\r\n(I think the rest of the changes in this loop are an improvement)",
      "commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "created_at" : "2022-12-12T16:04:45Z",
      "diff_hunk" : "@@ -298,27 +298,19 @@ def test_submit_child_with_parents(self, num_parents, partial_submit):\n         submitpackage_result = node.submitpackage(package=[tx[\"hex\"] for tx in package_txns])\n \n         # Check that each result is present, with the correct size and fees\n-        for package_txn in package_txns:\n-            tx = package_txn[\"tx\"]\n+        for i in range(num_parents + 1):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1046025065",
      "id" : 1046025065,
      "line" : 301,
      "node_id" : "PRRC_kwDOABII584-WRNp",
      "original_commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "original_line" : 301,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "test/functional/rpc_packages.py",
      "position" : 6,
      "pull_request_review_id" : 1213662405,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1046025065/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-12T18:01:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1046025065",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1046062544"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1046062544"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "alternative suggestion: \"preliminary\", but happy with \"nonfinal\" too.",
      "commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "created_at" : "2022-12-12T16:31:55Z",
      "diff_hunk" : "@@ -1343,6 +1344,11 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptPackage(const Package& package,\n     // the new transactions. This ensures we don't double-count transaction counts and sizes when\n     // checking ancestor/descendant limits, or double-count transaction fees for fee-related policy.\n     ATMPArgs single_args = ATMPArgs::SingleInPackageAccept(args);\n+    // Results from individual validation. \"Mutable\" because if a transaction fails by itself but\n+    // succeeds later (i.e. when evaluated with a fee-bumping child), the result changes (though not\n+    // reflected in this map). If a transaction fails more than once, we want to return the first\n+    // result, when it was considered on its own. So changes will only be from invalid -> valid.\n+    std::map<uint256, MempoolAcceptResult> individual_results_mutable;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1046062544",
      "id" : 1046062544,
      "in_reply_to_id" : 1041150868,
      "line" : 1352,
      "node_id" : "PRRC_kwDOABII584-WaXQ",
      "original_commit_id" : "139e0e10d96a53231b8c5179def33627aed48d3e",
      "original_line" : 1352,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 144,
      "pull_request_review_id" : 1213662405,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1046062544/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-12T18:01:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1046062544",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1046084540"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1046084540"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Additional lookup can be avoided:\r\n```suggestion\r\n            Assume(results.emplace(wtxid, mempoolaccept_res).second);\r\n```",
      "commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "created_at" : "2022-12-12T16:47:16Z",
      "diff_hunk" : "@@ -1380,24 +1396,42 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptPackage(const Package& package,\n                 // future.  Continue individually validating the rest of the transactions, because\n                 // some of them may still be valid.\n                 quit_early = true;\n+                package_state_quit_early.Invalid(PackageValidationResult::PCKG_TX, \"transaction failed\");\n+                individual_results_mutable.emplace(wtxid, single_res);\n             } else {\n-                txns_new.push_back(tx);\n+                individual_results_mutable.emplace(wtxid, single_res);\n+                txns_package_eval.push_back(tx);\n             }\n         }\n     }\n \n     // Nothing to do if the entire package has already been submitted.\n-    if (quit_early || txns_new.empty()) {\n+    if (quit_early || txns_package_eval.empty()) {\n+        for (const auto& [wtxid, mempoolaccept_res] : individual_results_mutable) {\n+            Assume(results.find(wtxid) == results.end());\n+            results.emplace(wtxid, mempoolaccept_res);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1046084540",
      "id" : 1046084540,
      "line" : 1412,
      "node_id" : "PRRC_kwDOABII584-Wfu8",
      "original_commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "original_line" : 1412,
      "original_position" : 170,
      "original_start_line" : 1411,
      "path" : "src/validation.cpp",
      "position" : 170,
      "pull_request_review_id" : 1213662405,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1046084540/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1411,
      "start_side" : "RIGHT",
      "updated_at" : "2022-12-12T18:01:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1046084540",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1046117647"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1046117647"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "std::map::insert [doesn't overwrite](https://en.cppreference.com/w/cpp/container/map/insert) if key already exists, so since we're not using rvalue refs I think this can be simplified without performance degradation:\r\n```suggestion\r\n        // insert doesn't overwrite existing keys\r\n        submission_result.m_tx_results.insert(individual_results_mutable.begin(), individual_results_mutable.end());\r\n```\r\n",
      "commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "created_at" : "2022-12-12T17:11:26Z",
      "diff_hunk" : "@@ -1380,24 +1396,42 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptPackage(const Package& package,\n                 // future.  Continue individually validating the rest of the transactions, because\n                 // some of them may still be valid.\n                 quit_early = true;\n+                package_state_quit_early.Invalid(PackageValidationResult::PCKG_TX, \"transaction failed\");\n+                individual_results_mutable.emplace(wtxid, single_res);\n             } else {\n-                txns_new.push_back(tx);\n+                individual_results_mutable.emplace(wtxid, single_res);\n+                txns_package_eval.push_back(tx);\n             }\n         }\n     }\n \n     // Nothing to do if the entire package has already been submitted.\n-    if (quit_early || txns_new.empty()) {\n+    if (quit_early || txns_package_eval.empty()) {\n+        for (const auto& [wtxid, mempoolaccept_res] : individual_results_mutable) {\n+            Assume(results.find(wtxid) == results.end());\n+            results.emplace(wtxid, mempoolaccept_res);\n+        }\n         // No package feerate when no package validation was done.\n-        return PackageMempoolAcceptResult(package_state, std::move(results));\n+        return PackageMempoolAcceptResult(package_state_quit_early, std::move(results));\n     }\n-    // Validate the (deduplicated) transactions as a package.\n-    auto submission_result = AcceptMultipleTransactions(txns_new, args);\n+    // Validate the (deduplicated) transactions as a package. Note that submission_result has its\n+    // own PackageValidationState; package_state is unused past this point.\n+    auto submission_result = AcceptMultipleTransactions(txns_package_eval, args);\n     // Include already-in-mempool transaction results in the final result.\n     for (const auto& [wtxid, mempoolaccept_res] : results) {\n+        Assume(submission_result.m_tx_results.find(wtxid) == submission_result.m_tx_results.end());\n         submission_result.m_tx_results.emplace(wtxid, mempoolaccept_res);\n     }\n-    if (submission_result.m_state.IsValid()) assert(submission_result.m_package_feerate.has_value());\n+    if (submission_result.m_state.GetResult() == PackageValidationResult::PCKG_TX) {\n+        // Package validation failed because one or more transactions failed.\n+        // Include individual previous failure reasons if they aren't provided.\n+        for (const auto& [wtxid, mempoolaccept_res] : individual_results_mutable) {\n+            if (submission_result.m_tx_results.find(wtxid) == submission_result.m_tx_results.end()) {\n+                submission_result.m_tx_results.emplace(wtxid, mempoolaccept_res);\n+            }\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1046117647",
      "id" : 1046117647,
      "line" : 1432,
      "node_id" : "PRRC_kwDOABII584-Wn0P",
      "original_commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "original_line" : 1432,
      "original_position" : 194,
      "original_start_line" : 1428,
      "path" : "src/validation.cpp",
      "position" : 194,
      "pull_request_review_id" : 1213662405,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1046117647/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1428,
      "start_side" : "RIGHT",
      "updated_at" : "2022-12-12T18:01:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1046117647",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1046149577"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1046149577"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Sorry to bikeshed, but `txns_package_eval` is hard to understand imo. Would `txns_to_evaluate` (or `package_txns_to_evaluate`, but I think it's too verbose) work?",
      "commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "created_at" : "2022-12-12T17:35:32Z",
      "diff_hunk" : "@@ -1390,24 +1396,40 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptPackage(const Package& package,\n                 // some of them may still be valid.\n                 quit_early = true;\n                 package_state.Invalid(PackageValidationResult::PCKG_TX, \"transaction failed\");\n-                results.emplace(wtxid, single_res);\n+                individual_results_mutable.emplace(wtxid, single_res);\n             } else {\n+                package_state.Invalid(PackageValidationResult::PCKG_TX, \"transaction failed\");\n+                individual_results_mutable.emplace(wtxid, single_res);\n                 txns_new.push_back(tx);\n             }\n         }\n     }\n \n     // Nothing to do if the entire package has already been submitted.\n     if (quit_early || txns_new.empty()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1046149577",
      "id" : 1046149577,
      "in_reply_to_id" : 1041174515,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-WvnJ",
      "original_commit_id" : "139e0e10d96a53231b8c5179def33627aed48d3e",
      "original_line" : 1409,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1213662405,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1046149577/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-12T18:01:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1046149577",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1046155242"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1046155242"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: could make \"previous\" more explicit\r\n```suggestion\r\n        // Include individual failure reasons if not already provided by `AcceptSingleTransaction()`.\r\n```",
      "commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "created_at" : "2022-12-12T17:39:42Z",
      "diff_hunk" : "@@ -1380,24 +1396,42 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptPackage(const Package& package,\n                 // future.  Continue individually validating the rest of the transactions, because\n                 // some of them may still be valid.\n                 quit_early = true;\n+                package_state_quit_early.Invalid(PackageValidationResult::PCKG_TX, \"transaction failed\");\n+                individual_results_mutable.emplace(wtxid, single_res);\n             } else {\n-                txns_new.push_back(tx);\n+                individual_results_mutable.emplace(wtxid, single_res);\n+                txns_package_eval.push_back(tx);\n             }\n         }\n     }\n \n     // Nothing to do if the entire package has already been submitted.\n-    if (quit_early || txns_new.empty()) {\n+    if (quit_early || txns_package_eval.empty()) {\n+        for (const auto& [wtxid, mempoolaccept_res] : individual_results_mutable) {\n+            Assume(results.find(wtxid) == results.end());\n+            results.emplace(wtxid, mempoolaccept_res);\n+        }\n         // No package feerate when no package validation was done.\n-        return PackageMempoolAcceptResult(package_state, std::move(results));\n+        return PackageMempoolAcceptResult(package_state_quit_early, std::move(results));\n     }\n-    // Validate the (deduplicated) transactions as a package.\n-    auto submission_result = AcceptMultipleTransactions(txns_new, args);\n+    // Validate the (deduplicated) transactions as a package. Note that submission_result has its\n+    // own PackageValidationState; package_state is unused past this point.\n+    auto submission_result = AcceptMultipleTransactions(txns_package_eval, args);\n     // Include already-in-mempool transaction results in the final result.\n     for (const auto& [wtxid, mempoolaccept_res] : results) {\n+        Assume(submission_result.m_tx_results.find(wtxid) == submission_result.m_tx_results.end());\n         submission_result.m_tx_results.emplace(wtxid, mempoolaccept_res);\n     }\n-    if (submission_result.m_state.IsValid()) assert(submission_result.m_package_feerate.has_value());\n+    if (submission_result.m_state.GetResult() == PackageValidationResult::PCKG_TX) {\n+        // Package validation failed because one or more transactions failed.\n+        // Include individual previous failure reasons if they aren't provided.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1046155242",
      "id" : 1046155242,
      "line" : 1427,
      "node_id" : "PRRC_kwDOABII584-Ww_q",
      "original_commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "original_line" : 1427,
      "original_position" : 189,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 189,
      "pull_request_review_id" : 1213662405,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1046155242/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-12T18:01:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1046155242",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1046158930"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1046158930"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Not specific to this PR, but I think this docstring is out of date? In addition to entire package already being submitted, this block also handles the case of package containing invalid txns. Perhaps good to update now?",
      "commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "created_at" : "2022-12-12T17:42:23Z",
      "diff_hunk" : "@@ -1380,24 +1396,42 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptPackage(const Package& package,\n                 // future.  Continue individually validating the rest of the transactions, because\n                 // some of them may still be valid.\n                 quit_early = true;\n+                package_state_quit_early.Invalid(PackageValidationResult::PCKG_TX, \"transaction failed\");\n+                individual_results_mutable.emplace(wtxid, single_res);\n             } else {\n-                txns_new.push_back(tx);\n+                individual_results_mutable.emplace(wtxid, single_res);\n+                txns_package_eval.push_back(tx);\n             }\n         }\n     }\n \n     // Nothing to do if the entire package has already been submitted.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1046158930",
      "id" : 1046158930,
      "line" : 1408,
      "node_id" : "PRRC_kwDOABII584-Wx5S",
      "original_commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "original_line" : 1408,
      "original_position" : 165,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 165,
      "pull_request_review_id" : 1213662405,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1046158930/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-12T18:01:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1046158930",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1046160777"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1046160777"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This comment can now be removed I think",
      "commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "created_at" : "2022-12-12T17:43:35Z",
      "diff_hunk" : "@@ -1380,24 +1396,42 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptPackage(const Package& package,\n                 // future.  Continue individually validating the rest of the transactions, because\n                 // some of them may still be valid.\n                 quit_early = true;\n+                package_state_quit_early.Invalid(PackageValidationResult::PCKG_TX, \"transaction failed\");\n+                individual_results_mutable.emplace(wtxid, single_res);\n             } else {\n-                txns_new.push_back(tx);\n+                individual_results_mutable.emplace(wtxid, single_res);\n+                txns_package_eval.push_back(tx);\n             }\n         }\n     }\n \n     // Nothing to do if the entire package has already been submitted.\n-    if (quit_early || txns_new.empty()) {\n+    if (quit_early || txns_package_eval.empty()) {\n+        for (const auto& [wtxid, mempoolaccept_res] : individual_results_mutable) {\n+            Assume(results.find(wtxid) == results.end());\n+            results.emplace(wtxid, mempoolaccept_res);\n+        }\n         // No package feerate when no package validation was done.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1046160777",
      "id" : 1046160777,
      "line" : 1414,
      "node_id" : "PRRC_kwDOABII584-WyWJ",
      "original_commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "original_line" : 1414,
      "original_position" : 172,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 172,
      "pull_request_review_id" : 1213662405,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1046160777/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-12T18:01:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1046160777",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1047045461"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1047045461"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Have you considered always including this field?\r\n\r\nWe don't always know it. We could have quit validation before looking up inputs, e.g. because `CheckTransaction()` failed. It's also possible we couldn't find the inputs at all.",
      "commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "created_at" : "2022-12-13T11:37:24Z",
      "diff_hunk" : "@@ -124,6 +124,7 @@ static RPCHelpMan testmempoolaccept()\n                     {RPCResult::Type::OBJ, \"fees\", /*optional=*/true, \"Transaction fees (only present if 'allowed' is true)\",\n                     {\n                         {RPCResult::Type::STR_AMOUNT, \"base\", \"transaction fee in \" + CURRENCY_UNIT},\n+                        {RPCResult::Type::STR_AMOUNT, \"effective-feerate\", /*optional=*/true, \"if something other than base feerate was used, the effective feerate in \" + CURRENCY_UNIT + \" per KvB. For example, the package feerate and/or feerate with modified fees from prioritisetransaction.\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1047045461",
      "id" : 1047045461,
      "in_reply_to_id" : 1046011831,
      "line" : 127,
      "node_id" : "PRRC_kwDOABII584-aKVV",
      "original_commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "original_line" : 127,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : 4,
      "pull_request_review_id" : 1215300420,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1047045461/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-13T11:37:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1047045461",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1048389293"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048389293"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In the case of virtual sizes and `CFeeRate`, we do a narrowing conversion (the `CFeeRate` ctor takes a `uint32_t`, while we use `int64_t` for `Workspace::m_vsize`), so the compiler complains. This is exactly what braced initialization is good for imo, but we should really fix them. This is an annoying thing about CFeeRate in general since we use various types for vsize around the codebase. I'd probably save this for a \"unify types used to represent virtual size\" PR.",
      "commit_id" : "0d383a65ee01eb58c011c4c056523b9a0f20d96f",
      "created_at" : "2022-12-14T12:06:17Z",
      "diff_hunk" : "@@ -1176,16 +1182,17 @@ MempoolAcceptResult MemPoolAccept::AcceptSingleTransaction(const CTransactionRef\n \n     if (!ConsensusScriptChecks(args, ws)) return MempoolAcceptResult::Failure(ws.m_state);\n \n+    const CFeeRate effective_feerate(ws.m_modified_fees, ws.m_vsize);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1048389293",
      "id" : 1048389293,
      "in_reply_to_id" : 1045968527,
      "line" : 1189,
      "node_id" : "PRRC_kwDOABII584-fSat",
      "original_commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "original_line" : 1189,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 35,
      "pull_request_review_id" : 1217340370,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048389293/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-16T11:29:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048389293",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1048417283"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048417283"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Updated",
      "commit_id" : "0d383a65ee01eb58c011c4c056523b9a0f20d96f",
      "created_at" : "2022-12-14T12:37:31Z",
      "diff_hunk" : "@@ -1380,24 +1396,42 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptPackage(const Package& package,\n                 // future.  Continue individually validating the rest of the transactions, because\n                 // some of them may still be valid.\n                 quit_early = true;\n+                package_state_quit_early.Invalid(PackageValidationResult::PCKG_TX, \"transaction failed\");\n+                individual_results_mutable.emplace(wtxid, single_res);\n             } else {\n-                txns_new.push_back(tx);\n+                individual_results_mutable.emplace(wtxid, single_res);\n+                txns_package_eval.push_back(tx);\n             }\n         }\n     }\n \n     // Nothing to do if the entire package has already been submitted.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1048417283",
      "id" : 1048417283,
      "in_reply_to_id" : 1046158930,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-fZQD",
      "original_commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "original_line" : 1408,
      "original_position" : 165,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1217340370,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048417283/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-16T11:29:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048417283",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1048417365"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048417365"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, taken",
      "commit_id" : "0d383a65ee01eb58c011c4c056523b9a0f20d96f",
      "created_at" : "2022-12-14T12:37:36Z",
      "diff_hunk" : "@@ -1380,24 +1396,42 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptPackage(const Package& package,\n                 // future.  Continue individually validating the rest of the transactions, because\n                 // some of them may still be valid.\n                 quit_early = true;\n+                package_state_quit_early.Invalid(PackageValidationResult::PCKG_TX, \"transaction failed\");\n+                individual_results_mutable.emplace(wtxid, single_res);\n             } else {\n-                txns_new.push_back(tx);\n+                individual_results_mutable.emplace(wtxid, single_res);\n+                txns_package_eval.push_back(tx);\n             }\n         }\n     }\n \n     // Nothing to do if the entire package has already been submitted.\n-    if (quit_early || txns_new.empty()) {\n+    if (quit_early || txns_package_eval.empty()) {\n+        for (const auto& [wtxid, mempoolaccept_res] : individual_results_mutable) {\n+            Assume(results.find(wtxid) == results.end());\n+            results.emplace(wtxid, mempoolaccept_res);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1048417365",
      "id" : 1048417365,
      "in_reply_to_id" : 1046084540,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-fZRV",
      "original_commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "original_line" : 1412,
      "original_position" : 170,
      "original_start_line" : 1411,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1217340370,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048417365/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-12-16T11:29:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048417365",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1048417433"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048417433"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Removed, thanks",
      "commit_id" : "0d383a65ee01eb58c011c4c056523b9a0f20d96f",
      "created_at" : "2022-12-14T12:37:41Z",
      "diff_hunk" : "@@ -1380,24 +1396,42 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptPackage(const Package& package,\n                 // future.  Continue individually validating the rest of the transactions, because\n                 // some of them may still be valid.\n                 quit_early = true;\n+                package_state_quit_early.Invalid(PackageValidationResult::PCKG_TX, \"transaction failed\");\n+                individual_results_mutable.emplace(wtxid, single_res);\n             } else {\n-                txns_new.push_back(tx);\n+                individual_results_mutable.emplace(wtxid, single_res);\n+                txns_package_eval.push_back(tx);\n             }\n         }\n     }\n \n     // Nothing to do if the entire package has already been submitted.\n-    if (quit_early || txns_new.empty()) {\n+    if (quit_early || txns_package_eval.empty()) {\n+        for (const auto& [wtxid, mempoolaccept_res] : individual_results_mutable) {\n+            Assume(results.find(wtxid) == results.end());\n+            results.emplace(wtxid, mempoolaccept_res);\n+        }\n         // No package feerate when no package validation was done.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1048417433",
      "id" : 1048417433,
      "in_reply_to_id" : 1046160777,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-fZSZ",
      "original_commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "original_line" : 1414,
      "original_position" : 172,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1217340370,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048417433/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-16T11:29:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048417433",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1048417615"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048417615"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Clarified this comment",
      "commit_id" : "0d383a65ee01eb58c011c4c056523b9a0f20d96f",
      "created_at" : "2022-12-14T12:37:53Z",
      "diff_hunk" : "@@ -1380,24 +1396,42 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptPackage(const Package& package,\n                 // future.  Continue individually validating the rest of the transactions, because\n                 // some of them may still be valid.\n                 quit_early = true;\n+                package_state_quit_early.Invalid(PackageValidationResult::PCKG_TX, \"transaction failed\");\n+                individual_results_mutable.emplace(wtxid, single_res);\n             } else {\n-                txns_new.push_back(tx);\n+                individual_results_mutable.emplace(wtxid, single_res);\n+                txns_package_eval.push_back(tx);\n             }\n         }\n     }\n \n     // Nothing to do if the entire package has already been submitted.\n-    if (quit_early || txns_new.empty()) {\n+    if (quit_early || txns_package_eval.empty()) {\n+        for (const auto& [wtxid, mempoolaccept_res] : individual_results_mutable) {\n+            Assume(results.find(wtxid) == results.end());\n+            results.emplace(wtxid, mempoolaccept_res);\n+        }\n         // No package feerate when no package validation was done.\n-        return PackageMempoolAcceptResult(package_state, std::move(results));\n+        return PackageMempoolAcceptResult(package_state_quit_early, std::move(results));\n     }\n-    // Validate the (deduplicated) transactions as a package.\n-    auto submission_result = AcceptMultipleTransactions(txns_new, args);\n+    // Validate the (deduplicated) transactions as a package. Note that submission_result has its\n+    // own PackageValidationState; package_state is unused past this point.\n+    auto submission_result = AcceptMultipleTransactions(txns_package_eval, args);\n     // Include already-in-mempool transaction results in the final result.\n     for (const auto& [wtxid, mempoolaccept_res] : results) {\n+        Assume(submission_result.m_tx_results.find(wtxid) == submission_result.m_tx_results.end());\n         submission_result.m_tx_results.emplace(wtxid, mempoolaccept_res);\n     }\n-    if (submission_result.m_state.IsValid()) assert(submission_result.m_package_feerate.has_value());\n+    if (submission_result.m_state.GetResult() == PackageValidationResult::PCKG_TX) {\n+        // Package validation failed because one or more transactions failed.\n+        // Include individual previous failure reasons if they aren't provided.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1048417615",
      "id" : 1048417615,
      "in_reply_to_id" : 1046155242,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-fZVP",
      "original_commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "original_line" : 1427,
      "original_position" : 189,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1217340370,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048417615/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-16T11:29:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048417615",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1048417780"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048417780"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah thanks, taken",
      "commit_id" : "0d383a65ee01eb58c011c4c056523b9a0f20d96f",
      "created_at" : "2022-12-14T12:38:01Z",
      "diff_hunk" : "@@ -1380,24 +1396,42 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptPackage(const Package& package,\n                 // future.  Continue individually validating the rest of the transactions, because\n                 // some of them may still be valid.\n                 quit_early = true;\n+                package_state_quit_early.Invalid(PackageValidationResult::PCKG_TX, \"transaction failed\");\n+                individual_results_mutable.emplace(wtxid, single_res);\n             } else {\n-                txns_new.push_back(tx);\n+                individual_results_mutable.emplace(wtxid, single_res);\n+                txns_package_eval.push_back(tx);\n             }\n         }\n     }\n \n     // Nothing to do if the entire package has already been submitted.\n-    if (quit_early || txns_new.empty()) {\n+    if (quit_early || txns_package_eval.empty()) {\n+        for (const auto& [wtxid, mempoolaccept_res] : individual_results_mutable) {\n+            Assume(results.find(wtxid) == results.end());\n+            results.emplace(wtxid, mempoolaccept_res);\n+        }\n         // No package feerate when no package validation was done.\n-        return PackageMempoolAcceptResult(package_state, std::move(results));\n+        return PackageMempoolAcceptResult(package_state_quit_early, std::move(results));\n     }\n-    // Validate the (deduplicated) transactions as a package.\n-    auto submission_result = AcceptMultipleTransactions(txns_new, args);\n+    // Validate the (deduplicated) transactions as a package. Note that submission_result has its\n+    // own PackageValidationState; package_state is unused past this point.\n+    auto submission_result = AcceptMultipleTransactions(txns_package_eval, args);\n     // Include already-in-mempool transaction results in the final result.\n     for (const auto& [wtxid, mempoolaccept_res] : results) {\n+        Assume(submission_result.m_tx_results.find(wtxid) == submission_result.m_tx_results.end());\n         submission_result.m_tx_results.emplace(wtxid, mempoolaccept_res);\n     }\n-    if (submission_result.m_state.IsValid()) assert(submission_result.m_package_feerate.has_value());\n+    if (submission_result.m_state.GetResult() == PackageValidationResult::PCKG_TX) {\n+        // Package validation failed because one or more transactions failed.\n+        // Include individual previous failure reasons if they aren't provided.\n+        for (const auto& [wtxid, mempoolaccept_res] : individual_results_mutable) {\n+            if (submission_result.m_tx_results.find(wtxid) == submission_result.m_tx_results.end()) {\n+                submission_result.m_tx_results.emplace(wtxid, mempoolaccept_res);\n+            }\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1048417780",
      "id" : 1048417780,
      "in_reply_to_id" : 1046117647,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-fZX0",
      "original_commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "original_line" : 1432,
      "original_position" : 194,
      "original_start_line" : 1428,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1217340370,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048417780/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-12-16T11:29:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048417780",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1048417910"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048417910"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Changed back",
      "commit_id" : "0d383a65ee01eb58c011c4c056523b9a0f20d96f",
      "created_at" : "2022-12-14T12:38:09Z",
      "diff_hunk" : "@@ -298,27 +298,19 @@ def test_submit_child_with_parents(self, num_parents, partial_submit):\n         submitpackage_result = node.submitpackage(package=[tx[\"hex\"] for tx in package_txns])\n \n         # Check that each result is present, with the correct size and fees\n-        for package_txn in package_txns:\n-            tx = package_txn[\"tx\"]\n+        for i in range(num_parents + 1):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1048417910",
      "id" : 1048417910,
      "in_reply_to_id" : 1046025065,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-fZZ2",
      "original_commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "original_line" : 301,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "test/functional/rpc_packages.py",
      "position" : null,
      "pull_request_review_id" : 1217340370,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048417910/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-16T11:29:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048417910",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1048583003"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048583003"
         }
      },
      "author_association" : "MEMBER",
      "body" : "rename to `results_final` to be self documenting later?",
      "commit_id" : "0d383a65ee01eb58c011c4c056523b9a0f20d96f",
      "created_at" : "2022-12-14T15:02:59Z",
      "diff_hunk" : "@@ -1316,14 +1338,15 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptPackage(const Package& package,\n          return unconfirmed_parent_txids.count(input.prevout.hash) > 0 || m_view.HaveCoin(input.prevout);\n     };\n     if (!std::all_of(child->vin.cbegin(), child->vin.cend(), package_or_confirmed)) {\n-        package_state.Invalid(PackageValidationResult::PCKG_POLICY, \"package-not-child-with-unconfirmed-parents\");\n-        return PackageMempoolAcceptResult(package_state, {});\n+        package_state_quit_early.Invalid(PackageValidationResult::PCKG_POLICY, \"package-not-child-with-unconfirmed-parents\");\n+        return PackageMempoolAcceptResult(package_state_quit_early, {});\n     }\n     // Protect against bugs where we pull more inputs from disk that miss being added to\n     // coins_to_uncache. The backend will be connected again when needed in PreChecks.\n     m_view.SetBackend(m_dummy);\n \n     LOCK(m_pool.cs);\n+    // Stores final results that will not change.\n     std::map<const uint256, const MempoolAcceptResult> results;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1048583003",
      "id" : 1048583003,
      "line" : 1350,
      "node_id" : "PRRC_kwDOABII584-gBtb",
      "original_commit_id" : "0d383a65ee01eb58c011c4c056523b9a0f20d96f",
      "original_line" : 1350,
      "original_position" : 148,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 148,
      "pull_request_review_id" : 1217631020,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048583003/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-14T15:12:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048583003",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1048588103"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048588103"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Could also assert that `m_result_type != MempoolAcceptResult::ResultType::INVALID` to catch possible regressions",
      "commit_id" : "0d383a65ee01eb58c011c4c056523b9a0f20d96f",
      "created_at" : "2022-12-14T15:07:22Z",
      "diff_hunk" : "@@ -1380,24 +1408,38 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptPackage(const Package& package,\n                 // future.  Continue individually validating the rest of the transactions, because\n                 // some of them may still be valid.\n                 quit_early = true;\n+                package_state_quit_early.Invalid(PackageValidationResult::PCKG_TX, \"transaction failed\");\n+                individual_results_nonfinal.emplace(wtxid, single_res);\n             } else {\n-                txns_new.push_back(tx);\n+                individual_results_nonfinal.emplace(wtxid, single_res);\n+                txns_package_eval.push_back(tx);\n             }\n         }\n     }\n \n-    // Nothing to do if the entire package has already been submitted.\n-    if (quit_early || txns_new.empty()) {\n-        // No package feerate when no package validation was done.\n-        return PackageMempoolAcceptResult(package_state, std::move(results));\n+    // Quit early because package validation won't change the result or the entire package has\n+    // already been submitted.\n+    if (quit_early || txns_package_eval.empty()) {\n+        for (const auto& [wtxid, mempoolaccept_res] : individual_results_nonfinal) {\n+            Assume(results.emplace(wtxid, mempoolaccept_res).second);\n+        }\n+        return PackageMempoolAcceptResult(package_state_quit_early, std::move(results));\n     }\n-    // Validate the (deduplicated) transactions as a package.\n-    auto submission_result = AcceptMultipleTransactions(txns_new, args);\n+    // Validate the (deduplicated) transactions as a package. Note that submission_result has its\n+    // own PackageValidationState; package_state is unused past this point.\n+    auto submission_result = AcceptMultipleTransactions(txns_package_eval, args);\n     // Include already-in-mempool transaction results in the final result.\n     for (const auto& [wtxid, mempoolaccept_res] : results) {\n-        submission_result.m_tx_results.emplace(wtxid, mempoolaccept_res);\n+        Assume(submission_result.m_tx_results.emplace(wtxid, mempoolaccept_res).second);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1048588103",
      "id" : 1048588103,
      "line" : 1433,
      "node_id" : "PRRC_kwDOABII584-gC9H",
      "original_commit_id" : "0d383a65ee01eb58c011c4c056523b9a0f20d96f",
      "original_line" : 1433,
      "original_position" : 200,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 200,
      "pull_request_review_id" : 1217631020,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048588103/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-14T15:12:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048588103",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1050643251"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1050643251"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Re: \"I'm wondering how well-defined this value is.\" Last push adds the wtxids of which transactions are included in the feerate, to both `MempoolAcceptResult` and the testmempoolaccept/submitpackage RPCs.\r\n\r\nRe: the problem where we don't always end up with the right transactions, might be better for another PR. I've opened #26711 to do this.",
      "commit_id" : "0d383a65ee01eb58c011c4c056523b9a0f20d96f",
      "created_at" : "2022-12-16T11:28:09Z",
      "diff_hunk" : "@@ -582,6 +582,11 @@ class MemPoolAccept\n         /** Total virtual size of all transactions being replaced. */\n         size_t m_conflicting_size{0};\n \n+        /** If we're doing package validation (i.e. m_package_feerates=true), the \"effective\"\n+         * package feerate of this transaction, which may include fee and vsize of its ancestors\n+         * and/or descendants. */\n+        CFeeRate m_package_feerate{0};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1050643251",
      "id" : 1050643251,
      "in_reply_to_id" : 1043849641,
      "line" : 588,
      "node_id" : "PRRC_kwDOABII584-n4sz",
      "original_commit_id" : "70d1af27cfcc9db68d7f26fa15eb7ee9510bbde1",
      "original_line" : 588,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 7,
      "pull_request_review_id" : 1217340370,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1050643251/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-16T11:29:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1050643251",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1050643723"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1050643723"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "0d383a65ee01eb58c011c4c056523b9a0f20d96f",
      "created_at" : "2022-12-16T11:28:38Z",
      "diff_hunk" : "@@ -275,7 +274,30 @@ BOOST_FIXTURE_TEST_CASE(package_submission_tests, TestChain100Setup)\n         BOOST_CHECK_EQUAL(result_3gen_submit.m_state.GetResult(), PackageValidationResult::PCKG_POLICY);\n         BOOST_CHECK_EQUAL(result_3gen_submit.m_state.GetRejectReason(), \"package-not-child-with-parents\");\n         BOOST_CHECK_EQUAL(m_node.mempool->size(), expected_pool_size);\n-        BOOST_CHECK(result_3gen_submit.m_package_feerate == std::nullopt);\n+    }\n+\n+    // Parent and child package where transactions are invalid for reasons other than fee and\n+    // missing inputs, so the package validation isn't expected to happen.\n+    {\n+        CScriptWitness bad_witness;\n+        bad_witness.stack.push_back(std::vector<unsigned char>(1));\n+        CMutableTransaction mtx_parent_invalid = mtx_parent;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1050643723",
      "id" : 1050643723,
      "in_reply_to_id" : 1045879297,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-n40L",
      "original_commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "original_line" : 284,
      "original_position" : 53,
      "original_start_line" : null,
      "path" : "src/test/txpackage_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1217340370,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1050643723/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-16T11:29:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1050643723",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1050705548"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1050705548"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Aha, good point, can't just go blindly nitting to do list initialization everywhere. However, would it then be a good starting point to just make the conversion explicit instead?\r\n```suggestion\r\n    const CFeeRate effective_feerate{ws.m_modified_fees, static_cast<uint32_t>(ws.m_vsize)};\r\n```",
      "commit_id" : "0d383a65ee01eb58c011c4c056523b9a0f20d96f",
      "created_at" : "2022-12-16T12:21:07Z",
      "diff_hunk" : "@@ -1176,16 +1182,17 @@ MempoolAcceptResult MemPoolAccept::AcceptSingleTransaction(const CTransactionRef\n \n     if (!ConsensusScriptChecks(args, ws)) return MempoolAcceptResult::Failure(ws.m_state);\n \n+    const CFeeRate effective_feerate(ws.m_modified_fees, ws.m_vsize);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1050705548",
      "id" : 1050705548,
      "in_reply_to_id" : 1045968527,
      "line" : 1189,
      "node_id" : "PRRC_kwDOABII584-oH6M",
      "original_commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "original_line" : 1189,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 35,
      "pull_request_review_id" : 1220770357,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1050705548/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-16T12:21:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1050705548",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1051480487"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1051480487"
         }
      },
      "author_association" : "NONE",
      "body" : "```suggestion\r\n```\r\n\r\nThis check looks redundant? are you in an if with the condition `tx_result.m_result_type == MempoolAcceptResult::ResultType::VALID` and `tx_result` is never modified so this confused me while I was reading the code.\r\n\r\nI'm missing anything that makes this observation a dum observation?",
      "commit_id" : "0d383a65ee01eb58c011c4c056523b9a0f20d96f",
      "created_at" : "2022-12-17T20:35:08Z",
      "diff_hunk" : "@@ -215,6 +219,15 @@ static RPCHelpMan testmempoolaccept()\n                         result_inner.pushKV(\"vsize\", virtual_size);\n                         UniValue fees(UniValue::VOBJ);\n                         fees.pushKV(\"base\", ValueFromAmount(fee));\n+                        CHECK_NONFATAL(tx_result.m_result_type == MempoolAcceptResult::ResultType::VALID);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1051480487",
      "id" : 1051480487,
      "line" : 222,
      "node_id" : "PRRC_kwDOABII584-rFGn",
      "original_commit_id" : "0d383a65ee01eb58c011c4c056523b9a0f20d96f",
      "original_line" : 222,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : 15,
      "pull_request_review_id" : 1221892702,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1051480487/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-17T20:35:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1051480487",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/17150045?v=4",
         "events_url" : "https://api.github.com/users/vincenzopalazzo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vincenzopalazzo/followers",
         "following_url" : "https://api.github.com/users/vincenzopalazzo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vincenzopalazzo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vincenzopalazzo",
         "id" : 17150045,
         "login" : "vincenzopalazzo",
         "node_id" : "MDQ6VXNlcjE3MTUwMDQ1",
         "organizations_url" : "https://api.github.com/users/vincenzopalazzo/orgs",
         "received_events_url" : "https://api.github.com/users/vincenzopalazzo/received_events",
         "repos_url" : "https://api.github.com/users/vincenzopalazzo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vincenzopalazzo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vincenzopalazzo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vincenzopalazzo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1051481458"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1051481458"
         }
      },
      "author_association" : "NONE",
      "body" : "```suggestion\r\n                    if (tx_resultm_result_type == MempoolAcceptResult::ResultType::VALID &&\r\n```\r\nThis is a very side comment that does not point to be an annoying comment, just It is just a side note also because I noted that you use this in `testmempoolaccept`, I think it is just a historical reason?\r\n\r\n```diff\r\ndiff --git a/src/rpc/mempool.cpp b/src/rpc/mempool.cpp\r\nindex 6f08ac5e4..bc30b9a20 100644\r\n--- a/src/rpc/mempool.cpp\r\n+++ b/src/rpc/mempool.cpp\r\n@@ -871,27 +871,28 @@ static RPCHelpMan submitpackage()\r\n                 auto it = package_result.m_tx_results.find(tx->GetWitnessHash());\r\n                 CHECK_NONFATAL(it != package_result.m_tx_results.end());\r\n                 UniValue result_inner{UniValue::VOBJ};\r\n+                const auto& tx_result = it->second;\r\n                 result_inner.pushKV(\"txid\", tx->GetHash().GetHex());\r\n-                if (it->second.m_result_type == MempoolAcceptResult::ResultType::DIFFERENT_WITNESS) {\r\n-                    result_inner.pushKV(\"other-wtxid\", it->second.m_other_wtxid.value().GetHex());\r\n+                if (tx_result.m_result_type == MempoolAcceptResult::ResultType::DIFFERENT_WITNESS) {\r\n+                    result_inner.pushKV(\"other-wtxid\", tx_result.m_other_wtxid.value().GetHex());\r\n                 }\r\n-                if (it->second.m_result_type == MempoolAcceptResult::ResultType::VALID ||\r\n-                    it->second.m_result_type == MempoolAcceptResult::ResultType::MEMPOOL_ENTRY) {\r\n-                    result_inner.pushKV(\"vsize\", int64_t{it->second.m_vsize.value()});\r\n+                if (tx_result.m_result_type == MempoolAcceptResult::ResultType::VALID ||\r\n+                    tx_result.m_result_type == MempoolAcceptResult::ResultType::MEMPOOL_ENTRY) {\r\n+                    result_inner.pushKV(\"vsize\", int64_t{tx_result.m_vsize.value()});\r\n                     UniValue fees(UniValue::VOBJ);\r\n-                    fees.pushKV(\"base\", ValueFromAmount(it->second.m_base_fees.value()));\r\n-                    if (it->second.m_result_type == MempoolAcceptResult::ResultType::VALID &&\r\n-                        it->second.m_effective_feerate.value().GetFee(it->second.m_vsize.value()) != it->second.m_base_fees.value()) {\r\n-                        fees.pushKV(\"effective-feerate\", ValueFromAmount(it->second.m_effective_feerate.value().GetFeePerK()));\r\n+                    fees.pushKV(\"base\", ValueFromAmount(tx_result.m_base_fees.value()));\r\n+                    if (tx_result.m_result_type == MempoolAcceptResult::ResultType::VALID &&\r\n+                        tx_result.m_effective_feerate.value().GetFee(tx_result.m_vsize.value()) != tx_result.m_base_fees.value()) {\r\n+                        fees.pushKV(\"effective-feerate\", ValueFromAmount(tx_result.m_effective_feerate.value().GetFeePerK()));\r\n                         UniValue effective_includes_res(UniValue::VARR);\r\n-                        for (const auto& wtxid : it->second.m_wtxids_fee_calculations.value()) {\r\n+                        for (const auto& wtxid : tx_result.m_wtxids_fee_calculations.value()) {\r\n                             effective_includes_res.push_back(wtxid.ToString());\r\n                         }\r\n                         fees.pushKV(\"effective-includes\", effective_includes_res);\r\n                     }\r\n                     result_inner.pushKV(\"fees\", fees);\r\n-                    if (it->second.m_replaced_transactions.has_value()) {\r\n-                        for (const auto& ptx : it->second.m_replaced_transactions.value()) {\r\n+                    if (tx_result.m_replaced_transactions.has_value()) {\r\n+                        for (const auto& ptx : tx_result.m_replaced_transactions.value()) {\r\n                             replaced_txids.insert(ptx->GetHash());\r\n                         }\r\n                     }\r\n```",
      "commit_id" : "0d383a65ee01eb58c011c4c056523b9a0f20d96f",
      "created_at" : "2022-12-17T20:46:51Z",
      "diff_hunk" : "@@ -864,6 +880,15 @@ static RPCHelpMan submitpackage()\n                     result_inner.pushKV(\"vsize\", int64_t{it->second.m_vsize.value()});\n                     UniValue fees(UniValue::VOBJ);\n                     fees.pushKV(\"base\", ValueFromAmount(it->second.m_base_fees.value()));\n+                    if (it->second.m_result_type == MempoolAcceptResult::ResultType::VALID &&",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1051481458",
      "id" : 1051481458,
      "line" : 883,
      "node_id" : "PRRC_kwDOABII584-rFVy",
      "original_commit_id" : "0d383a65ee01eb58c011c4c056523b9a0f20d96f",
      "original_line" : 883,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : 46,
      "pull_request_review_id" : 1221893543,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1051481458/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-17T20:46:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1051481458",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/17150045?v=4",
         "events_url" : "https://api.github.com/users/vincenzopalazzo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vincenzopalazzo/followers",
         "following_url" : "https://api.github.com/users/vincenzopalazzo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vincenzopalazzo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vincenzopalazzo",
         "id" : 17150045,
         "login" : "vincenzopalazzo",
         "node_id" : "MDQ6VXNlcjE3MTUwMDQ1",
         "organizations_url" : "https://api.github.com/users/vincenzopalazzo/orgs",
         "received_events_url" : "https://api.github.com/users/vincenzopalazzo/received_events",
         "repos_url" : "https://api.github.com/users/vincenzopalazzo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vincenzopalazzo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vincenzopalazzo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vincenzopalazzo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1052373434"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1052373434"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good point, this is redundant!",
      "commit_id" : "48f81f2b5e4052717989a30db942c378d369215b",
      "created_at" : "2022-12-19T15:57:08Z",
      "diff_hunk" : "@@ -215,6 +219,15 @@ static RPCHelpMan testmempoolaccept()\n                         result_inner.pushKV(\"vsize\", virtual_size);\n                         UniValue fees(UniValue::VOBJ);\n                         fees.pushKV(\"base\", ValueFromAmount(fee));\n+                        CHECK_NONFATAL(tx_result.m_result_type == MempoolAcceptResult::ResultType::VALID);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1052373434",
      "id" : 1052373434,
      "in_reply_to_id" : 1051480487,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-ufG6",
      "original_commit_id" : "0d383a65ee01eb58c011c4c056523b9a0f20d96f",
      "original_line" : 222,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1223142154,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1052373434/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-19T16:51:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1052373434",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1052385178"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1052385178"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good idea, added this + an Assume that the individual_results_nonfinal are all `ResultType::INVALID` above.",
      "commit_id" : "48f81f2b5e4052717989a30db942c378d369215b",
      "created_at" : "2022-12-19T16:08:28Z",
      "diff_hunk" : "@@ -1380,24 +1408,38 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptPackage(const Package& package,\n                 // future.  Continue individually validating the rest of the transactions, because\n                 // some of them may still be valid.\n                 quit_early = true;\n+                package_state_quit_early.Invalid(PackageValidationResult::PCKG_TX, \"transaction failed\");\n+                individual_results_nonfinal.emplace(wtxid, single_res);\n             } else {\n-                txns_new.push_back(tx);\n+                individual_results_nonfinal.emplace(wtxid, single_res);\n+                txns_package_eval.push_back(tx);\n             }\n         }\n     }\n \n-    // Nothing to do if the entire package has already been submitted.\n-    if (quit_early || txns_new.empty()) {\n-        // No package feerate when no package validation was done.\n-        return PackageMempoolAcceptResult(package_state, std::move(results));\n+    // Quit early because package validation won't change the result or the entire package has\n+    // already been submitted.\n+    if (quit_early || txns_package_eval.empty()) {\n+        for (const auto& [wtxid, mempoolaccept_res] : individual_results_nonfinal) {\n+            Assume(results.emplace(wtxid, mempoolaccept_res).second);\n+        }\n+        return PackageMempoolAcceptResult(package_state_quit_early, std::move(results));\n     }\n-    // Validate the (deduplicated) transactions as a package.\n-    auto submission_result = AcceptMultipleTransactions(txns_new, args);\n+    // Validate the (deduplicated) transactions as a package. Note that submission_result has its\n+    // own PackageValidationState; package_state is unused past this point.\n+    auto submission_result = AcceptMultipleTransactions(txns_package_eval, args);\n     // Include already-in-mempool transaction results in the final result.\n     for (const auto& [wtxid, mempoolaccept_res] : results) {\n-        submission_result.m_tx_results.emplace(wtxid, mempoolaccept_res);\n+        Assume(submission_result.m_tx_results.emplace(wtxid, mempoolaccept_res).second);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1052385178",
      "id" : 1052385178,
      "in_reply_to_id" : 1048588103,
      "line" : 1436,
      "node_id" : "PRRC_kwDOABII584-uh-a",
      "original_commit_id" : "0d383a65ee01eb58c011c4c056523b9a0f20d96f",
      "original_line" : 1436,
      "original_position" : 200,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 233,
      "pull_request_review_id" : 1223142154,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1052385178/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-19T16:51:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1052385178",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1052388157"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1052388157"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done",
      "commit_id" : "48f81f2b5e4052717989a30db942c378d369215b",
      "created_at" : "2022-12-19T16:11:32Z",
      "diff_hunk" : "@@ -1316,14 +1338,15 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptPackage(const Package& package,\n          return unconfirmed_parent_txids.count(input.prevout.hash) > 0 || m_view.HaveCoin(input.prevout);\n     };\n     if (!std::all_of(child->vin.cbegin(), child->vin.cend(), package_or_confirmed)) {\n-        package_state.Invalid(PackageValidationResult::PCKG_POLICY, \"package-not-child-with-unconfirmed-parents\");\n-        return PackageMempoolAcceptResult(package_state, {});\n+        package_state_quit_early.Invalid(PackageValidationResult::PCKG_POLICY, \"package-not-child-with-unconfirmed-parents\");\n+        return PackageMempoolAcceptResult(package_state_quit_early, {});\n     }\n     // Protect against bugs where we pull more inputs from disk that miss being added to\n     // coins_to_uncache. The backend will be connected again when needed in PreChecks.\n     m_view.SetBackend(m_dummy);\n \n     LOCK(m_pool.cs);\n+    // Stores final results that will not change.\n     std::map<const uint256, const MempoolAcceptResult> results;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1052388157",
      "id" : 1052388157,
      "in_reply_to_id" : 1048583003,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-uis9",
      "original_commit_id" : "0d383a65ee01eb58c011c4c056523b9a0f20d96f",
      "original_line" : 1350,
      "original_position" : 148,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1223142154,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1052388157/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-19T16:51:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1052388157",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1052391894"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1052391894"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: I think this can be moved inside the if loop?",
      "commit_id" : "48f81f2b5e4052717989a30db942c378d369215b",
      "created_at" : "2022-12-19T16:15:21Z",
      "diff_hunk" : "@@ -1143,12 +1148,17 @@ bool MemPoolAccept::SubmitPackage(const ATMPArgs& args, std::vector<Workspace>&\n     // make sure we haven't exceeded max mempool size.\n     LimitMempoolSize(m_pool, m_active_chainstate.CoinsTip());\n \n+    std::vector<uint256> all_package_wtxids;\n+    std::transform(workspaces.cbegin(), workspaces.cend(), std::back_inserter(all_package_wtxids),\n+                   [](const auto& ws) { return ws.m_ptx->GetWitnessHash(); });\n     // Find the wtxids of the transactions that made it into the mempool. Allow partial submission,\n     // but don't report success unless they all made it into the mempool.\n     for (Workspace& ws : workspaces) {\n+        const auto effective_feerate = args.m_package_feerates ? ws.m_package_feerate : CFeeRate(ws.m_modified_fees, ws.m_vsize);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1052391894",
      "id" : 1052391894,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-ujnW",
      "original_commit_id" : "0d383a65ee01eb58c011c4c056523b9a0f20d96f",
      "original_line" : 1157,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1223169114,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1052391894/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-20T22:46:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1052391894",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1052399683"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1052399683"
         }
      },
      "author_association" : "MEMBER",
      "body" : "applied across the effective feerate commit",
      "commit_id" : "48f81f2b5e4052717989a30db942c378d369215b",
      "created_at" : "2022-12-19T16:23:08Z",
      "diff_hunk" : "@@ -1176,16 +1182,17 @@ MempoolAcceptResult MemPoolAccept::AcceptSingleTransaction(const CTransactionRef\n \n     if (!ConsensusScriptChecks(args, ws)) return MempoolAcceptResult::Failure(ws.m_state);\n \n+    const CFeeRate effective_feerate(ws.m_modified_fees, ws.m_vsize);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1052399683",
      "id" : 1052399683,
      "in_reply_to_id" : 1045968527,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-ulhD",
      "original_commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "original_line" : 1189,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1223142154,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1052399683/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-19T16:51:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1052399683",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1052427664"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1052427664"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Applied this change to the lines touched in this PR",
      "commit_id" : "48f81f2b5e4052717989a30db942c378d369215b",
      "created_at" : "2022-12-19T16:52:15Z",
      "diff_hunk" : "@@ -864,6 +880,15 @@ static RPCHelpMan submitpackage()\n                     result_inner.pushKV(\"vsize\", int64_t{it->second.m_vsize.value()});\n                     UniValue fees(UniValue::VOBJ);\n                     fees.pushKV(\"base\", ValueFromAmount(it->second.m_base_fees.value()));\n+                    if (it->second.m_result_type == MempoolAcceptResult::ResultType::VALID &&",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1052427664",
      "id" : 1052427664,
      "in_reply_to_id" : 1051481458,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-usWQ",
      "original_commit_id" : "0d383a65ee01eb58c011c4c056523b9a0f20d96f",
      "original_line" : 883,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1223221091,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1052427664/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-19T16:52:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1052427664",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK https://github.com/bitcoin/bitcoin/pull/26646/commits/48f81f2b5e4052717989a30db942c378d369215b\r\n\r\nchanges are:\r\nremoving redundant nonfatal check\r\ngiving it->second a variable for ease of reading\r\nstatic case of m_vsize to uint32_t\r\ndoc and suggested variable renamings",
      "created_at" : "2022-12-19T18:26:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#issuecomment-1358069056",
      "id" : 1358069056,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26646",
      "node_id" : "IC_kwDOABII585Q8n1A",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1358069056/reactions"
      },
      "updated_at" : "2022-12-19T18:26:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1358069056",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1052558352"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1052558352"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: could preallocate memory of `workspaces.size()`",
      "commit_id" : "48f81f2b5e4052717989a30db942c378d369215b",
      "created_at" : "2022-12-19T19:25:54Z",
      "diff_hunk" : "@@ -1143,12 +1148,18 @@ bool MemPoolAccept::SubmitPackage(const ATMPArgs& args, std::vector<Workspace>&\n     // make sure we haven't exceeded max mempool size.\n     LimitMempoolSize(m_pool, m_active_chainstate.CoinsTip());\n \n+    std::vector<uint256> all_package_wtxids;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1052558352",
      "id" : 1052558352,
      "line" : 1151,
      "node_id" : "PRRC_kwDOABII584-vMQQ",
      "original_commit_id" : "48f81f2b5e4052717989a30db942c378d369215b",
      "original_line" : 1151,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 16,
      "pull_request_review_id" : 1223169114,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1052558352/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-20T22:46:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1052558352",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1053798286"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1053798286"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit\r\n```suggestion\r\n            const std::vector<uint256> single_wtxid{ws.m_ptx->GetWitnessHash()};\r\n```",
      "commit_id" : "48f81f2b5e4052717989a30db942c378d369215b",
      "created_at" : "2022-12-20T22:12:11Z",
      "diff_hunk" : "@@ -1232,59 +1247,68 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptMultipleTransactions(const std::\n     if (args.m_package_feerates &&\n         !CheckFeeRate(m_total_vsize, m_total_modified_fees, placeholder_state)) {\n         package_state.Invalid(PackageValidationResult::PCKG_POLICY, \"package-fee-too-low\");\n-        return PackageMempoolAcceptResult(package_state, package_feerate, {});\n+        return PackageMempoolAcceptResult(package_state, {});\n     }\n \n     // Apply package mempool ancestor/descendant limits. Skip if there is only one transaction,\n     // because it's unnecessary. Also, CPFP carve out can increase the limit for individual\n     // transactions, but this exemption is not extended to packages in CheckPackageLimits().\n     std::string err_string;\n     if (txns.size() > 1 && !PackageMempoolChecks(txns, package_state)) {\n-        return PackageMempoolAcceptResult(package_state, package_feerate, std::move(results));\n+        return PackageMempoolAcceptResult(package_state, std::move(results));\n     }\n \n     for (Workspace& ws : workspaces) {\n+        ws.m_package_feerate = package_feerate;\n         if (!PolicyScriptChecks(args, ws)) {\n             // Exit early to avoid doing pointless work. Update the failed tx result; the rest are unfinished.\n             package_state.Invalid(PackageValidationResult::PCKG_TX, \"transaction failed\");\n             results.emplace(ws.m_ptx->GetWitnessHash(), MempoolAcceptResult::Failure(ws.m_state));\n-            return PackageMempoolAcceptResult(package_state, package_feerate, std::move(results));\n+            return PackageMempoolAcceptResult(package_state, std::move(results));\n         }\n         if (args.m_test_accept) {\n+            const auto effective_feerate = args.m_package_feerates ? ws.m_package_feerate :\n+                CFeeRate{ws.m_modified_fees, static_cast<uint32_t>(ws.m_vsize)};\n             // When test_accept=true, transactions that pass PolicyScriptChecks are valid because there are\n             // no further mempool checks (passing PolicyScriptChecks implies passing ConsensusScriptChecks).\n+            // Note that when test_accept=true, package feerate is not used, so we only include the\n+            // 1 transaction's wtxid in MempoolAcceptResult::wtxids_fee_calculations. This should be\n+            // updated if that changes.\n+            Assume(!args.m_package_feerates);\n+            const std::vector<uint256> single_wtxid({ws.m_ptx->GetWitnessHash()});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1053798286",
      "id" : 1053798286,
      "line" : 1278,
      "node_id" : "PRRC_kwDOABII584-z6-O",
      "original_commit_id" : "48f81f2b5e4052717989a30db942c378d369215b",
      "original_line" : 1278,
      "original_position" : 90,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 90,
      "pull_request_review_id" : 1223169114,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1053798286/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-20T22:46:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1053798286",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1053798401"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1053798401"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit\r\n```suggestion\r\n    const std::vector<uint256> single_wtxid{ws.m_ptx->GetWitnessHash()};\r\n```",
      "commit_id" : "48f81f2b5e4052717989a30db942c378d369215b",
      "created_at" : "2022-12-20T22:12:22Z",
      "diff_hunk" : "@@ -1176,16 +1187,20 @@ MempoolAcceptResult MemPoolAccept::AcceptSingleTransaction(const CTransactionRef\n \n     if (!ConsensusScriptChecks(args, ws)) return MempoolAcceptResult::Failure(ws.m_state);\n \n+    const CFeeRate effective_feerate{ws.m_modified_fees, static_cast<uint32_t>(ws.m_vsize)};\n+    const std::vector<uint256> single_wtxid({ws.m_ptx->GetWitnessHash()});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1053798401",
      "id" : 1053798401,
      "line" : 1191,
      "node_id" : "PRRC_kwDOABII584-z7AB",
      "original_commit_id" : "48f81f2b5e4052717989a30db942c378d369215b",
      "original_line" : 1191,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 37,
      "pull_request_review_id" : 1223169114,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1053798401/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-20T22:46:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1053798401",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1053805893"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1053805893"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "But I think we always know it when `allowed=true`? For `fees`, the docs already state that \"(only present if 'allowed' is true)\".  So I think, consistent with `base` (which isn't optional), we can always (when `allowed=true`) return `effective-feerate`. This makes for a more consistent API imo.\r\n\r\nI suppose this also comes down to personal preference, so I'm okay leaving it as is too if you/others prefer.",
      "commit_id" : "48f81f2b5e4052717989a30db942c378d369215b",
      "created_at" : "2022-12-20T22:23:25Z",
      "diff_hunk" : "@@ -124,6 +124,7 @@ static RPCHelpMan testmempoolaccept()\n                     {RPCResult::Type::OBJ, \"fees\", /*optional=*/true, \"Transaction fees (only present if 'allowed' is true)\",\n                     {\n                         {RPCResult::Type::STR_AMOUNT, \"base\", \"transaction fee in \" + CURRENCY_UNIT},\n+                        {RPCResult::Type::STR_AMOUNT, \"effective-feerate\", /*optional=*/true, \"if something other than base feerate was used, the effective feerate in \" + CURRENCY_UNIT + \" per KvB. For example, the package feerate and/or feerate with modified fees from prioritisetransaction.\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1053805893",
      "id" : 1053805893,
      "in_reply_to_id" : 1046011831,
      "line" : 127,
      "node_id" : "PRRC_kwDOABII584-z81F",
      "original_commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "original_line" : 127,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : 4,
      "pull_request_review_id" : 1223169114,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1053805893/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-20T22:46:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1053805893",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 48f81f2b5e4052717989a30db942c378d369215b\r\n\r\nI don't have a big picture about package relay yet, but these changes are good on their own.",
      "created_at" : "2022-12-21T10:06:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#issuecomment-1361111056",
      "id" : 1361111056,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26646",
      "node_id" : "IC_kwDOABII585RIOgQ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1361111056/reactions"
      },
      "updated_at" : "2022-12-21T10:06:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1361111056",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1054220529"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1054220529"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@sdaftuar comfortable with resolving for this PR?",
      "commit_id" : "48f81f2b5e4052717989a30db942c378d369215b",
      "created_at" : "2022-12-21T10:22:16Z",
      "diff_hunk" : "@@ -582,6 +582,11 @@ class MemPoolAccept\n         /** Total virtual size of all transactions being replaced. */\n         size_t m_conflicting_size{0};\n \n+        /** If we're doing package validation (i.e. m_package_feerates=true), the \"effective\"\n+         * package feerate of this transaction, which may include fee and vsize of its ancestors\n+         * and/or descendants. */\n+        CFeeRate m_package_feerate{0};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1054220529",
      "id" : 1054220529,
      "in_reply_to_id" : 1043849641,
      "line" : 588,
      "node_id" : "PRRC_kwDOABII584-1iDx",
      "original_commit_id" : "70d1af27cfcc9db68d7f26fa15eb7ee9510bbde1",
      "original_line" : 588,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 7,
      "pull_request_review_id" : 1225830034,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1054220529/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-21T10:22:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1054220529",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1061843308"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1061843308"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 0d17b04977d6882e8dba6cf6c192a825a446f4ae \"[validation] return wtxids of other transactions whose fees were used\"\r\n\r\nMy understanding is that `effective_feerate` is computed using all of the package's txs when `args.m_package_feerates == true`, but only the workspace's single tx when that parameter is `false`. So I think it is incorrect to give `all_package_wtxids` in the latter case?",
      "commit_id" : "48f81f2b5e4052717989a30db942c378d369215b",
      "created_at" : "2023-01-04T20:07:31Z",
      "diff_hunk" : "@@ -1148,14 +1148,18 @@ bool MemPoolAccept::SubmitPackage(const ATMPArgs& args, std::vector<Workspace>&\n     // make sure we haven't exceeded max mempool size.\n     LimitMempoolSize(m_pool, m_active_chainstate.CoinsTip());\n \n+    std::vector<uint256> all_package_wtxids;\n+    std::transform(workspaces.cbegin(), workspaces.cend(), std::back_inserter(all_package_wtxids),\n+                   [](const auto& ws) { return ws.m_ptx->GetWitnessHash(); });\n     // Find the wtxids of the transactions that made it into the mempool. Allow partial submission,\n     // but don't report success unless they all made it into the mempool.\n     for (Workspace& ws : workspaces) {\n         const auto effective_feerate = args.m_package_feerates ? ws.m_package_feerate :\n             CFeeRate{ws.m_modified_fees, static_cast<uint32_t>(ws.m_vsize)};\n         if (m_pool.exists(GenTxid::Wtxid(ws.m_ptx->GetWitnessHash()))) {\n             results.emplace(ws.m_ptx->GetWitnessHash(),\n-                MempoolAcceptResult::Success(std::move(ws.m_replaced_transactions), ws.m_vsize, ws.m_base_fees, effective_feerate));\n+                MempoolAcceptResult::Success(std::move(ws.m_replaced_transactions), ws.m_vsize,\n+                                             ws.m_base_fees, effective_feerate, all_package_wtxids));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1061843308",
      "id" : 1061843308,
      "line" : 1162,
      "node_id" : "PRRC_kwDOABII584_SnFs",
      "original_commit_id" : "0d17b04977d6882e8dba6cf6c192a825a446f4ae",
      "original_line" : 1162,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 16,
      "pull_request_review_id" : 1236418570,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1061843308/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-04T20:12:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1061843308",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1062383829"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1062383829"
         }
      },
      "author_association" : "MEMBER",
      "body" : "We include `MempoolAcceptResult::m_effective_feerate` and `m_wtxids_fee_calculations` whenever the transaction is successful i.e. `ResultType::VALID`. I think it's still meaningful for single transactions, as it can include modified fees from prioritisetransaction. Alternatively we could return a separate result for modified fees.\r\n\r\n> My understanding is that effective_feerate is computed using all of the package's txs when args.m_package_feerates == true, but only the workspace's single tx when that parameter is false. \r\n\r\nThis is not 100% accurate - it's all of the transactions within `AcceptMultipleTransactions`, but that's not equivalent to the entire package. During a package validation (see `AcceptPackage`) we may split up a package into multiple groups for fee calculations (i.e. right now transactions can be submitted individually and with #26711 various subgroups). The hope here is for the caller to know exactly which transactions were included in the \"package feerate\" for a transaction.",
      "commit_id" : "48f81f2b5e4052717989a30db942c378d369215b",
      "created_at" : "2023-01-05T11:39:28Z",
      "diff_hunk" : "@@ -1148,14 +1148,18 @@ bool MemPoolAccept::SubmitPackage(const ATMPArgs& args, std::vector<Workspace>&\n     // make sure we haven't exceeded max mempool size.\n     LimitMempoolSize(m_pool, m_active_chainstate.CoinsTip());\n \n+    std::vector<uint256> all_package_wtxids;\n+    std::transform(workspaces.cbegin(), workspaces.cend(), std::back_inserter(all_package_wtxids),\n+                   [](const auto& ws) { return ws.m_ptx->GetWitnessHash(); });\n     // Find the wtxids of the transactions that made it into the mempool. Allow partial submission,\n     // but don't report success unless they all made it into the mempool.\n     for (Workspace& ws : workspaces) {\n         const auto effective_feerate = args.m_package_feerates ? ws.m_package_feerate :\n             CFeeRate{ws.m_modified_fees, static_cast<uint32_t>(ws.m_vsize)};\n         if (m_pool.exists(GenTxid::Wtxid(ws.m_ptx->GetWitnessHash()))) {\n             results.emplace(ws.m_ptx->GetWitnessHash(),\n-                MempoolAcceptResult::Success(std::move(ws.m_replaced_transactions), ws.m_vsize, ws.m_base_fees, effective_feerate));\n+                MempoolAcceptResult::Success(std::move(ws.m_replaced_transactions), ws.m_vsize,\n+                                             ws.m_base_fees, effective_feerate, all_package_wtxids));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1062383829",
      "id" : 1062383829,
      "in_reply_to_id" : 1061843308,
      "line" : 1162,
      "node_id" : "PRRC_kwDOABII584_UrDV",
      "original_commit_id" : "0d17b04977d6882e8dba6cf6c192a825a446f4ae",
      "original_line" : 1162,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 16,
      "pull_request_review_id" : 1237249918,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1062383829/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-05T11:39:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1062383829",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1062690420"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1062690420"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Right, what I mean is that there is a mismatch between `m_effective_feerate` and `m_wtxid_fee_calculations` depending on `args.m_package_feerates`. When that parameter is true, we would correctly report `m_effective_feerate` as the package feerate and `m_wtxids_fee_calculations` as all of the wtxids in the workspaces. But when it is false, `m_effective_feerate` is the modified feerate of just the single transaction in the workspace, whereas `m_wtxid_fee_calculations` is still all of the wtxids in all of the workspaces. That is what I think is incorrect. It should be the workspace's single wtxid, rather than all of them.\r\n\r\nIt looks like the only paths to get to this code are either `args.m_package_feerates = true` or there's a single transaction. So it doesn't really matter, just feels a bit wrong.",
      "commit_id" : "ada89cbd4249fad5eaedfa0a173dfc911f188084",
      "created_at" : "2023-01-05T16:57:05Z",
      "diff_hunk" : "@@ -1148,14 +1148,18 @@ bool MemPoolAccept::SubmitPackage(const ATMPArgs& args, std::vector<Workspace>&\n     // make sure we haven't exceeded max mempool size.\n     LimitMempoolSize(m_pool, m_active_chainstate.CoinsTip());\n \n+    std::vector<uint256> all_package_wtxids;\n+    std::transform(workspaces.cbegin(), workspaces.cend(), std::back_inserter(all_package_wtxids),\n+                   [](const auto& ws) { return ws.m_ptx->GetWitnessHash(); });\n     // Find the wtxids of the transactions that made it into the mempool. Allow partial submission,\n     // but don't report success unless they all made it into the mempool.\n     for (Workspace& ws : workspaces) {\n         const auto effective_feerate = args.m_package_feerates ? ws.m_package_feerate :\n             CFeeRate{ws.m_modified_fees, static_cast<uint32_t>(ws.m_vsize)};\n         if (m_pool.exists(GenTxid::Wtxid(ws.m_ptx->GetWitnessHash()))) {\n             results.emplace(ws.m_ptx->GetWitnessHash(),\n-                MempoolAcceptResult::Success(std::move(ws.m_replaced_transactions), ws.m_vsize, ws.m_base_fees, effective_feerate));\n+                MempoolAcceptResult::Success(std::move(ws.m_replaced_transactions), ws.m_vsize,\n+                                             ws.m_base_fees, effective_feerate, all_package_wtxids));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1062690420",
      "id" : 1062690420,
      "in_reply_to_id" : 1061843308,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584_V150",
      "original_commit_id" : "0d17b04977d6882e8dba6cf6c192a825a446f4ae",
      "original_line" : 1162,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1237727438,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1062690420/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-05T17:09:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1062690420",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1063656033"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1063656033"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ohh I see, yeah that's a bit weird. Changed now.\r\n",
      "commit_id" : "ada89cbd4249fad5eaedfa0a173dfc911f188084",
      "created_at" : "2023-01-06T17:57:33Z",
      "diff_hunk" : "@@ -1148,14 +1148,18 @@ bool MemPoolAccept::SubmitPackage(const ATMPArgs& args, std::vector<Workspace>&\n     // make sure we haven't exceeded max mempool size.\n     LimitMempoolSize(m_pool, m_active_chainstate.CoinsTip());\n \n+    std::vector<uint256> all_package_wtxids;\n+    std::transform(workspaces.cbegin(), workspaces.cend(), std::back_inserter(all_package_wtxids),\n+                   [](const auto& ws) { return ws.m_ptx->GetWitnessHash(); });\n     // Find the wtxids of the transactions that made it into the mempool. Allow partial submission,\n     // but don't report success unless they all made it into the mempool.\n     for (Workspace& ws : workspaces) {\n         const auto effective_feerate = args.m_package_feerates ? ws.m_package_feerate :\n             CFeeRate{ws.m_modified_fees, static_cast<uint32_t>(ws.m_vsize)};\n         if (m_pool.exists(GenTxid::Wtxid(ws.m_ptx->GetWitnessHash()))) {\n             results.emplace(ws.m_ptx->GetWitnessHash(),\n-                MempoolAcceptResult::Success(std::move(ws.m_replaced_transactions), ws.m_vsize, ws.m_base_fees, effective_feerate));\n+                MempoolAcceptResult::Success(std::move(ws.m_replaced_transactions), ws.m_vsize,\n+                                             ws.m_base_fees, effective_feerate, all_package_wtxids));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1063656033",
      "id" : 1063656033,
      "in_reply_to_id" : 1061843308,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584_Zhph",
      "original_commit_id" : "0d17b04977d6882e8dba6cf6c192a825a446f4ae",
      "original_line" : 1162,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1239187485,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1063656033/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-06T17:57:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1063656033",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Sorry for missing a few of your review comments @stickies-v!\r\n\r\n> * requires a release notes file highlighting the RPC changes\r\n\r\nAdded for testmempoolaccept, submitpackage is regtest-only.\r\n\r\n> * the docstring of assert_equal_package_results (rpc_packages.py) still mentions package feerate which I think is now out of date\r\n\r\nThis refers to the \"package feerate\" concept [documented here](https://github.com/bitcoin/bitcoin/blob/09f32cffa6c3e8b2d77281a5983ffe8f482a5945/doc/policy/packages.md#package-fees-and-feerate), rather than the RPC result \"package-feerate\". So left as is, sorry for that being a bit confusing.\r\n\r\n\r\n> * nit: [a723541](https://github.com/bitcoin/bitcoin/commit/a72354186f9328d3f56bdd4a41959ff56a774653) could be split in two commits: one for rename, and one for the actual change\r\n\r\nDone\r\n",
      "created_at" : "2023-01-06T17:57:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#issuecomment-1373959707",
      "id" : 1373959707,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26646",
      "node_id" : "IC_kwDOABII585R5PYb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1373959707/reactions"
      },
      "updated_at" : "2023-01-06T17:57:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1373959707",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1063656364"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1063656364"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "ada89cbd4249fad5eaedfa0a173dfc911f188084",
      "created_at" : "2023-01-06T17:58:05Z",
      "diff_hunk" : "@@ -1232,59 +1247,68 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptMultipleTransactions(const std::\n     if (args.m_package_feerates &&\n         !CheckFeeRate(m_total_vsize, m_total_modified_fees, placeholder_state)) {\n         package_state.Invalid(PackageValidationResult::PCKG_POLICY, \"package-fee-too-low\");\n-        return PackageMempoolAcceptResult(package_state, package_feerate, {});\n+        return PackageMempoolAcceptResult(package_state, {});\n     }\n \n     // Apply package mempool ancestor/descendant limits. Skip if there is only one transaction,\n     // because it's unnecessary. Also, CPFP carve out can increase the limit for individual\n     // transactions, but this exemption is not extended to packages in CheckPackageLimits().\n     std::string err_string;\n     if (txns.size() > 1 && !PackageMempoolChecks(txns, package_state)) {\n-        return PackageMempoolAcceptResult(package_state, package_feerate, std::move(results));\n+        return PackageMempoolAcceptResult(package_state, std::move(results));\n     }\n \n     for (Workspace& ws : workspaces) {\n+        ws.m_package_feerate = package_feerate;\n         if (!PolicyScriptChecks(args, ws)) {\n             // Exit early to avoid doing pointless work. Update the failed tx result; the rest are unfinished.\n             package_state.Invalid(PackageValidationResult::PCKG_TX, \"transaction failed\");\n             results.emplace(ws.m_ptx->GetWitnessHash(), MempoolAcceptResult::Failure(ws.m_state));\n-            return PackageMempoolAcceptResult(package_state, package_feerate, std::move(results));\n+            return PackageMempoolAcceptResult(package_state, std::move(results));\n         }\n         if (args.m_test_accept) {\n+            const auto effective_feerate = args.m_package_feerates ? ws.m_package_feerate :\n+                CFeeRate{ws.m_modified_fees, static_cast<uint32_t>(ws.m_vsize)};\n             // When test_accept=true, transactions that pass PolicyScriptChecks are valid because there are\n             // no further mempool checks (passing PolicyScriptChecks implies passing ConsensusScriptChecks).\n+            // Note that when test_accept=true, package feerate is not used, so we only include the\n+            // 1 transaction's wtxid in MempoolAcceptResult::wtxids_fee_calculations. This should be\n+            // updated if that changes.\n+            Assume(!args.m_package_feerates);\n+            const std::vector<uint256> single_wtxid({ws.m_ptx->GetWitnessHash()});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1063656364",
      "id" : 1063656364,
      "in_reply_to_id" : 1053798286,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584_Zhus",
      "original_commit_id" : "48f81f2b5e4052717989a30db942c378d369215b",
      "original_line" : 1278,
      "original_position" : 90,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1239188614,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1063656364/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-06T17:58:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1063656364",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1063656625"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1063656625"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Changed to non-optional now",
      "commit_id" : "ada89cbd4249fad5eaedfa0a173dfc911f188084",
      "created_at" : "2023-01-06T17:58:29Z",
      "diff_hunk" : "@@ -124,6 +124,7 @@ static RPCHelpMan testmempoolaccept()\n                     {RPCResult::Type::OBJ, \"fees\", /*optional=*/true, \"Transaction fees (only present if 'allowed' is true)\",\n                     {\n                         {RPCResult::Type::STR_AMOUNT, \"base\", \"transaction fee in \" + CURRENCY_UNIT},\n+                        {RPCResult::Type::STR_AMOUNT, \"effective-feerate\", /*optional=*/true, \"if something other than base feerate was used, the effective feerate in \" + CURRENCY_UNIT + \" per KvB. For example, the package feerate and/or feerate with modified fees from prioritisetransaction.\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1063656625",
      "id" : 1063656625,
      "in_reply_to_id" : 1046011831,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584_Zhyx",
      "original_commit_id" : "c5ca0755273597cf1d0f1d10b6b914b13a8bb37f",
      "original_line" : 127,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1239189547,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1063656625/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-06T17:58:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1063656625",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "reACK ada89cb",
      "created_at" : "2023-01-09T07:42:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#issuecomment-1375213884",
      "id" : 1375213884,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26646",
      "node_id" : "IC_kwDOABII585R-Bk8",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1375213884/reactions"
      },
      "updated_at" : "2023-01-09T07:42:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1375213884",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1064706389"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1064706389"
         }
      },
      "author_association" : "MEMBER",
      "body" : "note this was accomplished on line below",
      "commit_id" : "ada89cbd4249fad5eaedfa0a173dfc911f188084",
      "created_at" : "2023-01-09T14:34:23Z",
      "diff_hunk" : "@@ -1143,12 +1148,18 @@ bool MemPoolAccept::SubmitPackage(const ATMPArgs& args, std::vector<Workspace>&\n     // make sure we haven't exceeded max mempool size.\n     LimitMempoolSize(m_pool, m_active_chainstate.CoinsTip());\n \n+    std::vector<uint256> all_package_wtxids;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1064706389",
      "id" : 1064706389,
      "in_reply_to_id" : 1052558352,
      "line" : 1152,
      "node_id" : "PRRC_kwDOABII584_diFV",
      "original_commit_id" : "48f81f2b5e4052717989a30db942c378d369215b",
      "original_line" : 1152,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 16,
      "pull_request_review_id" : 1240590839,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1064706389/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-09T14:39:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1064706389",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1065044063"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065044063"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 92d789b090a166ea6deebbfcbf2c1069fa8cc693 \"[validation] return wtxids of other transactions whose fees were used\"\r\n\r\nSince the previous commit adds the calculation for `effective_feerate` here depending on `m_package_feerates`, I would expect that the calculation for the involved wtxids would do that as well. Or the previous commit could add this `Assume` and just do the single tx feerate calculation. The behavior for setting the effective feerate and the involved txids should be unified to avoid bugs.",
      "commit_id" : "264f9ef17f650035882d24083fb419845942a3ac",
      "created_at" : "2023-01-09T19:47:49Z",
      "diff_hunk" : "@@ -1265,9 +1275,14 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptMultipleTransactions(const std::\n                 CFeeRate{ws.m_modified_fees, static_cast<uint32_t>(ws.m_vsize)};\n             // When test_accept=true, transactions that pass PolicyScriptChecks are valid because there are\n             // no further mempool checks (passing PolicyScriptChecks implies passing ConsensusScriptChecks).\n+            // Note that when test_accept=true, package feerate is not used, so we only include the\n+            // 1 transaction's wtxid in MempoolAcceptResult::wtxids_fee_calculations. This should be\n+            // updated if that changes.\n+            Assume(!args.m_package_feerates);\n+            const std::vector<uint256> single_wtxid{ws.m_ptx->GetWitnessHash()};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1065044063",
      "id" : 1065044063,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584_e0hf",
      "original_commit_id" : "92d789b090a166ea6deebbfcbf2c1069fa8cc693",
      "original_line" : 1282,
      "original_position" : 53,
      "original_start_line" : 1281,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1241105052,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065044063/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2023-01-09T20:40:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065044063",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1065054572"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065054572"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 57b56b7ce9ebef646d3fe3e706bf994c17864f3c \"[rpc] return effective-feerate in testmempoolaccept and submitpackage\"\r\n\r\nThis change doesn't seem to be meaningful? The test passes either way.",
      "commit_id" : "264f9ef17f650035882d24083fb419845942a3ac",
      "created_at" : "2023-01-09T19:58:07Z",
      "diff_hunk" : "@@ -302,14 +302,12 @@ def test_submit_child_with_parents(self, num_parents, partial_submit):\n         for package_txn in package_txns:\n             tx = package_txn[\"tx\"]\n             assert tx.getwtxid() in submitpackage_result[\"tx-results\"]\n-            tx_result = submitpackage_result[\"tx-results\"][tx.getwtxid()]\n-            assert_equal(tx_result, {\n-                \"txid\": package_txn[\"txid\"],\n-                \"vsize\": tx.get_vsize(),\n-                \"fees\": {\n-                    \"base\": DEFAULT_FEE,\n-                }\n-            })\n+            wtxid = tx.getwtxid()\n+            assert wtxid in submitpackage_result[\"tx-results\"]\n+            tx_result = submitpackage_result[\"tx-results\"][wtxid]\n+            assert_equal(tx_result[\"txid\"], tx.rehash())\n+            assert_equal(tx_result[\"vsize\"], tx.get_vsize())\n+            assert_equal(tx_result[\"fees\"][\"base\"], DEFAULT_FEE)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1065054572",
      "id" : 1065054572,
      "line" : 316,
      "node_id" : "PRRC_kwDOABII584_e3Fs",
      "original_commit_id" : "57b56b7ce9ebef646d3fe3e706bf994c17864f3c",
      "original_line" : 316,
      "original_position" : 17,
      "original_start_line" : 305,
      "path" : "test/functional/rpc_packages.py",
      "position" : 59,
      "pull_request_review_id" : 1241105052,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065054572/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 305,
      "start_side" : "LEFT",
      "updated_at" : "2023-01-09T20:40:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065054572",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1065066507"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065066507"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 57b56b7ce9ebef646d3fe3e706bf994c17864f3c \"[rpc] return effective-feerate in testmempoolaccept and submitpackage\"\r\n\r\nFor here and in `submitpackage`, it's not clear to me why `effective-feerate` and `effective-includes` should be guarded by whether it is different from the base fees. The presence (or lack thereof) of this field indicates whether this transaction was validated as part of the package, but that is also more explicitly represented by `effective-includes`. I don't think it's harmful to provide this information for all transactions.",
      "commit_id" : "264f9ef17f650035882d24083fb419845942a3ac",
      "created_at" : "2023-01-09T20:14:16Z",
      "diff_hunk" : "@@ -217,6 +218,9 @@ static RPCHelpMan testmempoolaccept()\n                         result_inner.pushKV(\"vsize\", virtual_size);\n                         UniValue fees(UniValue::VOBJ);\n                         fees.pushKV(\"base\", ValueFromAmount(fee));\n+                        if (fee != tx_result.m_effective_feerate.value().GetFee(virtual_size)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1065066507",
      "id" : 1065066507,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584_e6AL",
      "original_commit_id" : "57b56b7ce9ebef646d3fe3e706bf994c17864f3c",
      "original_line" : 221,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1241105052,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065066507/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-09T20:40:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065066507",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1065613898"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065613898"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah thanks, I think I agree. For submitpackage we should continue to gate on whether the tx was in the mempool already - in that case we wouldn't know whether package feerate was used so I wouldn't want to report a potentially inaccurate feerate. Added a comment about this as well. Since testmempoolaccept doesn't allow already-in-mempool transactions, it should always have this for successful transactions.\r\n\r\nBase != effective is no longer a gate. Edited the `optional` bool for these results to reflect the status.\r\nSome tests needed to be changed (just dropping the `effective-*` results there because they aren't relevant in those tests and comparing feerates isn't handled properly in `assert_equal`).",
      "commit_id" : "264f9ef17f650035882d24083fb419845942a3ac",
      "created_at" : "2023-01-10T10:40:41Z",
      "diff_hunk" : "@@ -217,6 +218,9 @@ static RPCHelpMan testmempoolaccept()\n                         result_inner.pushKV(\"vsize\", virtual_size);\n                         UniValue fees(UniValue::VOBJ);\n                         fees.pushKV(\"base\", ValueFromAmount(fee));\n+                        if (fee != tx_result.m_effective_feerate.value().GetFee(virtual_size)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1065613898",
      "id" : 1065613898,
      "in_reply_to_id" : 1065066507,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584_g_pK",
      "original_commit_id" : "57b56b7ce9ebef646d3fe3e706bf994c17864f3c",
      "original_line" : 221,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1241939908,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065613898/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-10T11:20:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065613898",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1065618245"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065618245"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ended up keeping it in latest push, as the result now includes optional fields and a feerate so we need to use `assert_fee_amount`",
      "commit_id" : "264f9ef17f650035882d24083fb419845942a3ac",
      "created_at" : "2023-01-10T10:44:57Z",
      "diff_hunk" : "@@ -302,14 +302,12 @@ def test_submit_child_with_parents(self, num_parents, partial_submit):\n         for package_txn in package_txns:\n             tx = package_txn[\"tx\"]\n             assert tx.getwtxid() in submitpackage_result[\"tx-results\"]\n-            tx_result = submitpackage_result[\"tx-results\"][tx.getwtxid()]\n-            assert_equal(tx_result, {\n-                \"txid\": package_txn[\"txid\"],\n-                \"vsize\": tx.get_vsize(),\n-                \"fees\": {\n-                    \"base\": DEFAULT_FEE,\n-                }\n-            })\n+            wtxid = tx.getwtxid()\n+            assert wtxid in submitpackage_result[\"tx-results\"]\n+            tx_result = submitpackage_result[\"tx-results\"][wtxid]\n+            assert_equal(tx_result[\"txid\"], tx.rehash())\n+            assert_equal(tx_result[\"vsize\"], tx.get_vsize())\n+            assert_equal(tx_result[\"fees\"][\"base\"], DEFAULT_FEE)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1065618245",
      "id" : 1065618245,
      "in_reply_to_id" : 1065054572,
      "line" : 316,
      "node_id" : "PRRC_kwDOABII584_hAtF",
      "original_commit_id" : "57b56b7ce9ebef646d3fe3e706bf994c17864f3c",
      "original_line" : 316,
      "original_position" : 17,
      "original_start_line" : 305,
      "path" : "test/functional/rpc_packages.py",
      "position" : 59,
      "pull_request_review_id" : 1241939908,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065618245/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 305,
      "start_side" : "LEFT",
      "updated_at" : "2023-01-10T11:20:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065618245",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1065619534"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065619534"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Agree this is more bug-preventative. The downside is we end up constructing `all_wtxids` without using it when doing a test package mempool accept, but seems alright.",
      "commit_id" : "264f9ef17f650035882d24083fb419845942a3ac",
      "created_at" : "2023-01-10T10:46:14Z",
      "diff_hunk" : "@@ -1265,9 +1275,14 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptMultipleTransactions(const std::\n                 CFeeRate{ws.m_modified_fees, static_cast<uint32_t>(ws.m_vsize)};\n             // When test_accept=true, transactions that pass PolicyScriptChecks are valid because there are\n             // no further mempool checks (passing PolicyScriptChecks implies passing ConsensusScriptChecks).\n+            // Note that when test_accept=true, package feerate is not used, so we only include the\n+            // 1 transaction's wtxid in MempoolAcceptResult::wtxids_fee_calculations. This should be\n+            // updated if that changes.\n+            Assume(!args.m_package_feerates);\n+            const std::vector<uint256> single_wtxid{ws.m_ptx->GetWitnessHash()};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1065619534",
      "id" : 1065619534,
      "in_reply_to_id" : 1065044063,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584_hBBO",
      "original_commit_id" : "92d789b090a166ea6deebbfcbf2c1069fa8cc693",
      "original_line" : 1282,
      "original_position" : 53,
      "original_start_line" : 1281,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1241939908,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065619534/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2023-01-10T11:20:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065619534",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1065917384"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065917384"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n                        // Effective feerate is not provided for MEMPOOL_ENTRY(already-in-mempool) transactions even\r\n```",
      "commit_id" : "264f9ef17f650035882d24083fb419845942a3ac",
      "created_at" : "2023-01-10T15:22:57Z",
      "diff_hunk" : "@@ -864,6 +878,17 @@ static RPCHelpMan submitpackage()\n                     result_inner.pushKV(\"vsize\", int64_t{it->second.m_vsize.value()});\n                     UniValue fees(UniValue::VOBJ);\n                     fees.pushKV(\"base\", ValueFromAmount(it->second.m_base_fees.value()));\n+                    if (tx_result.m_result_type == MempoolAcceptResult::ResultType::VALID) {\n+                        // Effective feerate is not provided for MEMPOOL_ENTRY transactions even",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1065917384",
      "id" : 1065917384,
      "line" : 882,
      "node_id" : "PRRC_kwDOABII584_iJvI",
      "original_commit_id" : "264f9ef17f650035882d24083fb419845942a3ac",
      "original_line" : 882,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : 52,
      "pull_request_review_id" : 1242419177,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065917384/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-10T15:25:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1065917384",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "reACK https://github.com/bitcoin/bitcoin/pull/26646/commits/264f9ef17f650035882d24083fb419845942a3ac\r\n",
      "created_at" : "2023-01-10T15:24:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#issuecomment-1377439712",
      "id" : 1377439712,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26646",
      "node_id" : "IC_kwDOABII585SGg_g",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1377439712/reactions"
      },
      "updated_at" : "2023-01-10T15:24:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1377439712",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 264f9ef17f650035882d24083fb419845942a3ac",
      "created_at" : "2023-01-10T22:37:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#issuecomment-1377986578",
      "id" : 1377986578,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26646",
      "node_id" : "IC_kwDOABII585SImgS",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1377986578/reactions"
      },
      "updated_at" : "2023-01-10T22:37:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1377986578",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "reACK 264f9ef17f650035882d24083fb419845942a3ac",
      "created_at" : "2023-01-11T07:36:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#issuecomment-1378344587",
      "id" : 1378344587,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26646",
      "node_id" : "IC_kwDOABII585SJ96L",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1378344587/reactions"
      },
      "updated_at" : "2023-01-11T07:36:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1378344587",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1066966428"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1066966428"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't like \"preliminary\" as much as it's not guaranteed there's another round :shrug:",
      "commit_id" : "264f9ef17f650035882d24083fb419845942a3ac",
      "created_at" : "2023-01-11T13:03:42Z",
      "diff_hunk" : "@@ -1343,6 +1344,11 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptPackage(const Package& package,\n     // the new transactions. This ensures we don't double-count transaction counts and sizes when\n     // checking ancestor/descendant limits, or double-count transaction fees for fee-related policy.\n     ATMPArgs single_args = ATMPArgs::SingleInPackageAccept(args);\n+    // Results from individual validation. \"Mutable\" because if a transaction fails by itself but\n+    // succeeds later (i.e. when evaluated with a fee-bumping child), the result changes (though not\n+    // reflected in this map). If a transaction fails more than once, we want to return the first\n+    // result, when it was considered on its own. So changes will only be from invalid -> valid.\n+    std::map<uint256, MempoolAcceptResult> individual_results_mutable;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26646#discussion_r1066966428",
      "id" : 1066966428,
      "in_reply_to_id" : 1041150868,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584_mJ2c",
      "original_commit_id" : "139e0e10d96a53231b8c5179def33627aed48d3e",
      "original_line" : 1352,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1243869471,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26646",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1066966428/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-11T13:03:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1066966428",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   }
]
