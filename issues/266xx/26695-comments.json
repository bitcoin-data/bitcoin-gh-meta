[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [stickies-v](https://github.com/bitcoin/bitcoin/pull/26695#pullrequestreview-1226360773), [kevkevinpal](https://github.com/bitcoin/bitcoin/pull/26695#issuecomment-1363456336), [achow101](https://github.com/bitcoin/bitcoin/pull/26695#issuecomment-1379592245) |\n| Concept ACK | [pablomartin4btc](https://github.com/bitcoin/bitcoin/pull/26695#pullrequestreview-1226621159) |\n| Stale ACK | [jamesob](https://github.com/bitcoin/bitcoin/pull/26695#pullrequestreview-1221181904), [Emzy](https://github.com/bitcoin/bitcoin/pull/26695#issuecomment-1361820871), [hernanmarino](https://github.com/bitcoin/bitcoin/pull/26695#pullrequestreview-1226572144) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.\n",
      "created_at" : "2022-12-13T16:38:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#issuecomment-1349016230",
      "id" : 1349016230,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26695",
      "node_id" : "IC_kwDOABII585QaFqm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1349016230/reactions"
      },
      "updated_at" : "2023-01-11T23:02:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1349016230",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1047752243"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1047752243"
         }
      },
      "author_association" : "MEMBER",
      "body" : "https://github.com/bitcoin/bitcoin/pull/26695/commits/3f550b0887db0007633a26aac1dd80ec4723be55\r\n\r\nCommit doesn't compile; looks like the `PrepareBlock()` call in `block_assemble.cpp` needs to be updated:\r\n```cpp\r\nbench/block_assemble.cpp:45:9: error: no matching function for call to 'PrepareBlock'\r\n        PrepareBlock(test_setup->m_node, P2WSH_OP_TRUE);\r\n        ^~~~~~~~~~~~\r\n./test/util/mining.h:27:25: note: candidate function not viable: requires 3 arguments, but 2 were provided\r\nstd::shared_ptr<CBlock> PrepareBlock(const node::NodeContext&, const CScript& coinbase_scriptPubKey, bool check);\r\n                        ^\r\n1 error generated.\r\n```",
      "commit_id" : "e2ef70c537793d1d2a608d5a93862b1203a86090",
      "created_at" : "2022-12-13T21:08:24Z",
      "diff_hunk" : "@@ -24,7 +24,7 @@ std::vector<std::shared_ptr<CBlock>> CreateBlockChain(size_t total_height, const\n CTxIn MineBlock(const node::NodeContext&, const CScript& coinbase_scriptPubKey);\n \n /** Prepare a block to be mined */\n-std::shared_ptr<CBlock> PrepareBlock(const node::NodeContext&, const CScript& coinbase_scriptPubKey);\n+std::shared_ptr<CBlock> PrepareBlock(const node::NodeContext&, const CScript& coinbase_scriptPubKey, bool check);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1047752243",
      "id" : 1047752243,
      "line" : 27,
      "node_id" : "PRRC_kwDOABII584-c24z",
      "original_commit_id" : "3f550b0887db0007633a26aac1dd80ec4723be55",
      "original_line" : 27,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/util/mining.h",
      "position" : 5,
      "pull_request_review_id" : 1216424439,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1047752243/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-13T21:11:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1047752243",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1048263365"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048263365"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed",
      "commit_id" : "4c20bee65009bd2c95c2a3426030b042f55007ad",
      "created_at" : "2022-12-14T10:15:15Z",
      "diff_hunk" : "@@ -24,7 +24,7 @@ std::vector<std::shared_ptr<CBlock>> CreateBlockChain(size_t total_height, const\n CTxIn MineBlock(const node::NodeContext&, const CScript& coinbase_scriptPubKey);\n \n /** Prepare a block to be mined */\n-std::shared_ptr<CBlock> PrepareBlock(const node::NodeContext&, const CScript& coinbase_scriptPubKey);\n+std::shared_ptr<CBlock> PrepareBlock(const node::NodeContext&, const CScript& coinbase_scriptPubKey, bool check);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1048263365",
      "id" : 1048263365,
      "in_reply_to_id" : 1047752243,
      "line" : 27,
      "node_id" : "PRRC_kwDOABII584-ezrF",
      "original_commit_id" : "3f550b0887db0007633a26aac1dd80ec4723be55",
      "original_line" : 27,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/util/mining.h",
      "position" : 5,
      "pull_request_review_id" : 1217163576,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048263365/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-14T10:15:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048263365",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1048445309"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048445309"
         }
      },
      "author_association" : "MEMBER",
      "body" : "not sure if it matters, but previously this was (implicitly) calling `DefaultOptions`, now it calls `Options`.",
      "commit_id" : "4c20bee65009bd2c95c2a3426030b042f55007ad",
      "created_at" : "2022-12-14T13:05:50Z",
      "diff_hunk" : "@@ -74,10 +74,12 @@ CTxIn MineBlock(const NodeContext& node, const CScript& coinbase_scriptPubKey)\n     return CTxIn{block->vtx[0]->GetHash(), 0};\n }\n \n-std::shared_ptr<CBlock> PrepareBlock(const NodeContext& node, const CScript& coinbase_scriptPubKey)\n+std::shared_ptr<CBlock> PrepareBlock(const NodeContext& node, const CScript& coinbase_scriptPubKey, bool check)\n {\n+    BlockAssembler::Options options;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1048445309",
      "id" : 1048445309,
      "line" : 79,
      "node_id" : "PRRC_kwDOABII584-fgF9",
      "original_commit_id" : "b42cd786d01838ad979f00fff5f49f9fe67b14d5",
      "original_line" : 79,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/test/util/mining.cpp",
      "position" : 16,
      "pull_request_review_id" : 1217424049,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048445309/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-14T13:18:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048445309",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1048454257"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048454257"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: Could pass in the options struct to avoid having to change this again if another option is added?\r\nCould also add a redirect function without the argument, similar to BlockAssembler, to avoid having to change existing call sites?\r\n\r\nFeel free to ignore, but then you could use clang-tidy named-args to at least document the bool literals.",
      "commit_id" : "4c20bee65009bd2c95c2a3426030b042f55007ad",
      "created_at" : "2022-12-14T13:14:38Z",
      "diff_hunk" : "@@ -74,10 +74,12 @@ CTxIn MineBlock(const NodeContext& node, const CScript& coinbase_scriptPubKey)\n     return CTxIn{block->vtx[0]->GetHash(), 0};\n }\n \n-std::shared_ptr<CBlock> PrepareBlock(const NodeContext& node, const CScript& coinbase_scriptPubKey)\n+std::shared_ptr<CBlock> PrepareBlock(const NodeContext& node, const CScript& coinbase_scriptPubKey, bool check)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1048454257",
      "id" : 1048454257,
      "line" : 77,
      "node_id" : "PRRC_kwDOABII584-fiRx",
      "original_commit_id" : "b42cd786d01838ad979f00fff5f49f9fe67b14d5",
      "original_line" : 77,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/test/util/mining.cpp",
      "position" : 14,
      "pull_request_review_id" : 1217424049,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048454257/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-14T13:18:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048454257",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1048455993"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048455993"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: could use clang-tidy named args?",
      "commit_id" : "4c20bee65009bd2c95c2a3426030b042f55007ad",
      "created_at" : "2022-12-14T13:16:24Z",
      "diff_hunk" : "@@ -45,5 +45,18 @@ static void AssembleBlock(benchmark::Bench& bench)\n         PrepareBlock(test_setup->m_node, P2WSH_OP_TRUE, true);\n     });\n }\n+static void BlockAssemblerAddPackageTxns(benchmark::Bench& bench)\n+{\n+    FastRandomContext det_rand{true};\n+    auto testing_setup = MakeNoLogFileContext<TestChain100Setup>();\n+    CTxMemPool& pool = *testing_setup.get()->m_node.mempool;\n+    LOCK2(cs_main, pool.cs);\n+    const auto transactions = testing_setup->PopulateMempool(det_rand, 1000, true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1048455993",
      "id" : 1048455993,
      "line" : 54,
      "node_id" : "PRRC_kwDOABII584-fis5",
      "original_commit_id" : "4c20bee65009bd2c95c2a3426030b042f55007ad",
      "original_line" : 54,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/bench/block_assemble.cpp",
      "position" : 10,
      "pull_request_review_id" : 1217424049,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048455993/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-14T13:18:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048455993",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1048457824"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048457824"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: why?",
      "commit_id" : "4c20bee65009bd2c95c2a3426030b042f55007ad",
      "created_at" : "2022-12-14T13:18:12Z",
      "diff_hunk" : "@@ -45,5 +45,18 @@ static void AssembleBlock(benchmark::Bench& bench)\n         PrepareBlock(test_setup->m_node, P2WSH_OP_TRUE, true);\n     });\n }\n+static void BlockAssemblerAddPackageTxns(benchmark::Bench& bench)\n+{\n+    FastRandomContext det_rand{true};\n+    auto testing_setup = MakeNoLogFileContext<TestChain100Setup>();\n+    CTxMemPool& pool = *testing_setup.get()->m_node.mempool;\n+    LOCK2(cs_main, pool.cs);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1048457824",
      "id" : 1048457824,
      "line" : 53,
      "node_id" : "PRRC_kwDOABII584-fjJg",
      "original_commit_id" : "4c20bee65009bd2c95c2a3426030b042f55007ad",
      "original_line" : 53,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/bench/block_assemble.cpp",
      "position" : 9,
      "pull_request_review_id" : 1217424049,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048457824/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-14T13:18:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048457824",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1048475222"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048475222"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n    auto block{PrepareBlock(node, coinbase_scriptPubKey, /*check=*/true)};\r\n```",
      "commit_id" : "bf560fca91cbe87fd98a9e4adbf2eab1827c4a6e",
      "created_at" : "2022-12-14T13:33:36Z",
      "diff_hunk" : "@@ -61,7 +61,7 @@ std::vector<std::shared_ptr<CBlock>> CreateBlockChain(size_t total_height, const\n \n CTxIn MineBlock(const NodeContext& node, const CScript& coinbase_scriptPubKey)\n {\n-    auto block = PrepareBlock(node, coinbase_scriptPubKey);\n+    auto block = PrepareBlock(node, coinbase_scriptPubKey, true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1048475222",
      "id" : 1048475222,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-fnZW",
      "original_commit_id" : "4c20bee65009bd2c95c2a3426030b042f55007ad",
      "original_line" : 64,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/util/mining.cpp",
      "position" : null,
      "pull_request_review_id" : 1217468000,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048475222/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-15T11:57:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048475222",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1048477980"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048477980"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`check` is kinda vague, what about`test_validity`? Also, default `true` seems appropriate?\r\n```suggestion\r\nstd::shared_ptr<CBlock> PrepareBlock(const node::NodeContext&, const CScript& coinbase_scriptPubKey, bool test_validity);\r\n```",
      "commit_id" : "bf560fca91cbe87fd98a9e4adbf2eab1827c4a6e",
      "created_at" : "2022-12-14T13:36:15Z",
      "diff_hunk" : "@@ -24,7 +24,7 @@ std::vector<std::shared_ptr<CBlock>> CreateBlockChain(size_t total_height, const\n CTxIn MineBlock(const node::NodeContext&, const CScript& coinbase_scriptPubKey);\n \n /** Prepare a block to be mined */\n-std::shared_ptr<CBlock> PrepareBlock(const node::NodeContext&, const CScript& coinbase_scriptPubKey);\n+std::shared_ptr<CBlock> PrepareBlock(const node::NodeContext&, const CScript& coinbase_scriptPubKey, bool check);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1048477980",
      "id" : 1048477980,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-foEc",
      "original_commit_id" : "4c20bee65009bd2c95c2a3426030b042f55007ad",
      "original_line" : 27,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/util/mining.h",
      "position" : null,
      "pull_request_review_id" : 1217468000,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048477980/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-15T11:57:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048477980",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1048480684"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048480684"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Perhaps out of scope for this PR but... We could avoid this duplication by just adding `Options` as a member to `BlockAssembler`?",
      "commit_id" : "bf560fca91cbe87fd98a9e4adbf2eab1827c4a6e",
      "created_at" : "2022-12-14T13:38:50Z",
      "diff_hunk" : "@@ -135,6 +135,9 @@ class BlockAssembler\n     unsigned int nBlockMaxWeight;\n     CFeeRate blockMinFeeRate;\n \n+    // Whether to call TestBlockValidity() at the end of CreateNewBlock().\n+    const bool test_block_validity;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1048480684",
      "id" : 1048480684,
      "line" : 140,
      "node_id" : "PRRC_kwDOABII584-fous",
      "original_commit_id" : "4c20bee65009bd2c95c2a3426030b042f55007ad",
      "original_line" : 140,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/node/miner.h",
      "position" : 13,
      "pull_request_review_id" : 1217468000,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048480684/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-15T11:57:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048480684",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1048484165"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048484165"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: while touching, would be nice to add parameter hints\r\n```suggestion\r\n    if (test_block_validity && !TestBlockValidity(state, chainparams, m_chainstate, *pblock, pindexPrev, GetAdjustedTime, /*fCheckPOW=*/false, /*fCheckMerkleRoot=*/false)) {\r\n```",
      "commit_id" : "bf560fca91cbe87fd98a9e4adbf2eab1827c4a6e",
      "created_at" : "2022-12-14T13:42:05Z",
      "diff_hunk" : "@@ -170,7 +173,7 @@ std::unique_ptr<CBlockTemplate> BlockAssembler::CreateNewBlock(const CScript& sc\n     pblocktemplate->vTxSigOpsCost[0] = WITNESS_SCALE_FACTOR * GetLegacySigOpCount(*pblock->vtx[0]);\n \n     BlockValidationState state;\n-    if (!TestBlockValidity(state, chainparams, m_chainstate, *pblock, pindexPrev, GetAdjustedTime, false, false)) {\n+    if (test_block_validity && !TestBlockValidity(state, chainparams, m_chainstate, *pblock, pindexPrev, GetAdjustedTime, false, false)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1048484165",
      "id" : 1048484165,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-fplF",
      "original_commit_id" : "4c20bee65009bd2c95c2a3426030b042f55007ad",
      "original_line" : 176,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/node/miner.cpp",
      "position" : null,
      "pull_request_review_id" : 1217468000,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048484165/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-15T11:57:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048484165",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1048491782"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048491782"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit\r\n```suggestion\r\n        const CAmount fee{100 * det_rand.randrange(30)};\r\n```",
      "commit_id" : "bf560fca91cbe87fd98a9e4adbf2eab1827c4a6e",
      "created_at" : "2022-12-14T13:49:02Z",
      "diff_hunk" : "@@ -397,15 +397,15 @@ std::vector<CTransactionRef> TestChain100Setup::PopulateMempool(FastRandomContex\n             unspent_prevouts.pop_front();\n         }\n         const size_t num_outputs = det_rand.randrange(24) + 1;\n-        // Approximately 1000sat \"fee,\" equal output amounts.\n-        const CAmount amount_per_output = (total_in - 1000) / num_outputs;\n+        const CAmount fee = 100 * det_rand.randrange(30);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1048491782",
      "id" : 1048491782,
      "line" : 400,
      "node_id" : "PRRC_kwDOABII584-frcG",
      "original_commit_id" : "4c20bee65009bd2c95c2a3426030b042f55007ad",
      "original_line" : 400,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/test/util/setup_common.cpp",
      "position" : 6,
      "pull_request_review_id" : 1217468000,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048491782/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-15T11:57:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048491782",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1048528548"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048528548"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "it's not immediately obvious to me what the benefit is of randomizing the fee, perhaps useful to add rationale to the commit msg?",
      "commit_id" : "bf560fca91cbe87fd98a9e4adbf2eab1827c4a6e",
      "created_at" : "2022-12-14T14:20:10Z",
      "diff_hunk" : "@@ -397,15 +397,15 @@ std::vector<CTransactionRef> TestChain100Setup::PopulateMempool(FastRandomContex\n             unspent_prevouts.pop_front();\n         }\n         const size_t num_outputs = det_rand.randrange(24) + 1;\n-        // Approximately 1000sat \"fee,\" equal output amounts.\n-        const CAmount amount_per_output = (total_in - 1000) / num_outputs;\n+        const CAmount fee = 100 * det_rand.randrange(30);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1048528548",
      "id" : 1048528548,
      "in_reply_to_id" : 1048491782,
      "line" : 400,
      "node_id" : "PRRC_kwDOABII584-f0ak",
      "original_commit_id" : "4c20bee65009bd2c95c2a3426030b042f55007ad",
      "original_line" : 400,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/test/util/setup_common.cpp",
      "position" : 6,
      "pull_request_review_id" : 1217468000,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048528548/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-15T11:57:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048528548",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1048530799"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048530799"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit\r\n```suggestion\r\n    auto testing_setup{MakeNoLogFileContext<TestChain100Setup>()};\r\n    CTxMemPool& pool{*testing_setup.get()->m_node.mempool};\r\n    LOCK2(cs_main, pool.cs);\r\n    const auto transactions{testing_setup->PopulateMempool(det_rand, 1000, true)};\r\n```",
      "commit_id" : "bf560fca91cbe87fd98a9e4adbf2eab1827c4a6e",
      "created_at" : "2022-12-14T14:22:05Z",
      "diff_hunk" : "@@ -42,8 +42,21 @@ static void AssembleBlock(benchmark::Bench& bench)\n     }\n \n     bench.run([&] {\n-        PrepareBlock(test_setup->m_node, P2WSH_OP_TRUE);\n+        PrepareBlock(test_setup->m_node, P2WSH_OP_TRUE, true);\n+    });\n+}\n+static void BlockAssemblerAddPackageTxns(benchmark::Bench& bench)\n+{\n+    FastRandomContext det_rand{true};\n+    auto testing_setup = MakeNoLogFileContext<TestChain100Setup>();\n+    CTxMemPool& pool = *testing_setup.get()->m_node.mempool;\n+    LOCK2(cs_main, pool.cs);\n+    const auto transactions = testing_setup->PopulateMempool(det_rand, 1000, true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1048530799",
      "id" : 1048530799,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-f09v",
      "original_commit_id" : "4c20bee65009bd2c95c2a3426030b042f55007ad",
      "original_line" : 54,
      "original_position" : 14,
      "original_start_line" : 51,
      "path" : "src/bench/block_assemble.cpp",
      "position" : null,
      "pull_request_review_id" : 1217468000,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048530799/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-12-15T11:57:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048530799",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1048576364"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048576364"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This is among the slowest benchmarks in the suite atm. On my machine, `--sanity-check` takes ~1.2s. I think that's an acceptable additional slowdown for `make check`, but perhaps we should consider downgrading this to `PriorityLevel::MEDIUM`?",
      "commit_id" : "bf560fca91cbe87fd98a9e4adbf2eab1827c4a6e",
      "created_at" : "2022-12-14T14:57:47Z",
      "diff_hunk" : "@@ -42,8 +42,21 @@ static void AssembleBlock(benchmark::Bench& bench)\n     }\n \n     bench.run([&] {\n-        PrepareBlock(test_setup->m_node, P2WSH_OP_TRUE);\n+        PrepareBlock(test_setup->m_node, P2WSH_OP_TRUE, true);\n+    });\n+}\n+static void BlockAssemblerAddPackageTxns(benchmark::Bench& bench)\n+{\n+    FastRandomContext det_rand{true};\n+    auto testing_setup = MakeNoLogFileContext<TestChain100Setup>();\n+    CTxMemPool& pool = *testing_setup.get()->m_node.mempool;\n+    LOCK2(cs_main, pool.cs);\n+    const auto transactions = testing_setup->PopulateMempool(det_rand, 1000, true);\n+\n+    bench.run([&] {\n+        PrepareBlock(testing_setup->m_node, P2WSH_OP_TRUE, false);\n     });\n }\n \n BENCHMARK(AssembleBlock, benchmark::PriorityLevel::HIGH);\n+BENCHMARK(BlockAssemblerAddPackageTxns, benchmark::PriorityLevel::HIGH);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1048576364",
      "id" : 1048576364,
      "line" : 63,
      "node_id" : "PRRC_kwDOABII584-gAFs",
      "original_commit_id" : "4c20bee65009bd2c95c2a3426030b042f55007ad",
      "original_line" : 63,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/bench/block_assemble.cpp",
      "position" : 26,
      "pull_request_review_id" : 1217468000,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048576364/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-15T11:57:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048576364",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1049558698"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1049558698"
         }
      },
      "author_association" : "MEMBER",
      "body" : "True, there's no difference here but it means the testing setup ignores `-blockmintxfee` and `-blockmaxweight` options when calling `PrepareBlock()`.",
      "commit_id" : "bf560fca91cbe87fd98a9e4adbf2eab1827c4a6e",
      "created_at" : "2022-12-15T12:05:18Z",
      "diff_hunk" : "@@ -74,10 +74,12 @@ CTxIn MineBlock(const NodeContext& node, const CScript& coinbase_scriptPubKey)\n     return CTxIn{block->vtx[0]->GetHash(), 0};\n }\n \n-std::shared_ptr<CBlock> PrepareBlock(const NodeContext& node, const CScript& coinbase_scriptPubKey)\n+std::shared_ptr<CBlock> PrepareBlock(const NodeContext& node, const CScript& coinbase_scriptPubKey, bool check)\n {\n+    BlockAssembler::Options options;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1049558698",
      "id" : 1049558698,
      "in_reply_to_id" : 1048445309,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-jv6q",
      "original_commit_id" : "b42cd786d01838ad979f00fff5f49f9fe67b14d5",
      "original_line" : 79,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/test/util/mining.cpp",
      "position" : null,
      "pull_request_review_id" : 1219088870,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1049558698/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-15T16:00:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1049558698",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1049561790"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1049561790"
         }
      },
      "author_association" : "MEMBER",
      "body" : "~Fwiw since you brought it up - I think it's better to keep `Options` as an argument for ctoring `BlockAssembler` rather than a member, as I think it would be the best way to decouple `BlockAssembler` from `ArgsManager` (e.g. something like https://github.com/bitcoin/bitcoin/pull/25290/commits/f1941e8bfd2eecc478c7660434b1ebf6a64095a0).~\r\n\r\n~Looking back to when they were first separated in #9868, it seems not accessing `gArgs` from the `BlockAssembler` ctor was a motivation there as well.~\r\n\r\nAh I misunderstood and thought you were suggesting we remove the struct entirely, apologies!",
      "commit_id" : "b05347204d2d1cad030fc794aae2b0d29c35db7d",
      "created_at" : "2022-12-15T12:08:56Z",
      "diff_hunk" : "@@ -135,6 +135,9 @@ class BlockAssembler\n     unsigned int nBlockMaxWeight;\n     CFeeRate blockMinFeeRate;\n \n+    // Whether to call TestBlockValidity() at the end of CreateNewBlock().\n+    const bool test_block_validity;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1049561790",
      "id" : 1049561790,
      "in_reply_to_id" : 1048480684,
      "line" : 140,
      "node_id" : "PRRC_kwDOABII584-jwq-",
      "original_commit_id" : "4c20bee65009bd2c95c2a3426030b042f55007ad",
      "original_line" : 140,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/node/miner.h",
      "position" : 13,
      "pull_request_review_id" : 1219088870,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1049561790/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-21T17:08:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1049561790",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1049698151"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1049698151"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is no longer a bool, so resolving",
      "commit_id" : "bf560fca91cbe87fd98a9e4adbf2eab1827c4a6e",
      "created_at" : "2022-12-15T14:20:28Z",
      "diff_hunk" : "@@ -24,7 +24,7 @@ std::vector<std::shared_ptr<CBlock>> CreateBlockChain(size_t total_height, const\n CTxIn MineBlock(const node::NodeContext&, const CScript& coinbase_scriptPubKey);\n \n /** Prepare a block to be mined */\n-std::shared_ptr<CBlock> PrepareBlock(const node::NodeContext&, const CScript& coinbase_scriptPubKey);\n+std::shared_ptr<CBlock> PrepareBlock(const node::NodeContext&, const CScript& coinbase_scriptPubKey, bool check);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1049698151",
      "id" : 1049698151,
      "in_reply_to_id" : 1048477980,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-kR9n",
      "original_commit_id" : "4c20bee65009bd2c95c2a3426030b042f55007ad",
      "original_line" : 27,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/util/mining.h",
      "position" : null,
      "pull_request_review_id" : 1219088870,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1049698151/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-15T16:00:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1049698151",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1049811800"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1049811800"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Removed, thanks",
      "commit_id" : "bf560fca91cbe87fd98a9e4adbf2eab1827c4a6e",
      "created_at" : "2022-12-15T15:50:01Z",
      "diff_hunk" : "@@ -45,5 +45,18 @@ static void AssembleBlock(benchmark::Bench& bench)\n         PrepareBlock(test_setup->m_node, P2WSH_OP_TRUE, true);\n     });\n }\n+static void BlockAssemblerAddPackageTxns(benchmark::Bench& bench)\n+{\n+    FastRandomContext det_rand{true};\n+    auto testing_setup = MakeNoLogFileContext<TestChain100Setup>();\n+    CTxMemPool& pool = *testing_setup.get()->m_node.mempool;\n+    LOCK2(cs_main, pool.cs);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1049811800",
      "id" : 1049811800,
      "in_reply_to_id" : 1048457824,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-kttY",
      "original_commit_id" : "4c20bee65009bd2c95c2a3426030b042f55007ad",
      "original_line" : 53,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/bench/block_assemble.cpp",
      "position" : null,
      "pull_request_review_id" : 1219088870,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1049811800/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-15T16:00:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1049811800",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1049811956"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1049811956"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added",
      "commit_id" : "bf560fca91cbe87fd98a9e4adbf2eab1827c4a6e",
      "created_at" : "2022-12-15T15:50:05Z",
      "diff_hunk" : "@@ -45,5 +45,18 @@ static void AssembleBlock(benchmark::Bench& bench)\n         PrepareBlock(test_setup->m_node, P2WSH_OP_TRUE, true);\n     });\n }\n+static void BlockAssemblerAddPackageTxns(benchmark::Bench& bench)\n+{\n+    FastRandomContext det_rand{true};\n+    auto testing_setup = MakeNoLogFileContext<TestChain100Setup>();\n+    CTxMemPool& pool = *testing_setup.get()->m_node.mempool;\n+    LOCK2(cs_main, pool.cs);\n+    const auto transactions = testing_setup->PopulateMempool(det_rand, 1000, true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1049811956",
      "id" : 1049811956,
      "in_reply_to_id" : 1048455993,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-ktv0",
      "original_commit_id" : "4c20bee65009bd2c95c2a3426030b042f55007ad",
      "original_line" : 54,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/bench/block_assemble.cpp",
      "position" : null,
      "pull_request_review_id" : 1219088870,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1049811956/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-15T16:00:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1049811956",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1049812519"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1049812519"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Some taken, most lines deleted",
      "commit_id" : "bf560fca91cbe87fd98a9e4adbf2eab1827c4a6e",
      "created_at" : "2022-12-15T15:50:24Z",
      "diff_hunk" : "@@ -42,8 +42,21 @@ static void AssembleBlock(benchmark::Bench& bench)\n     }\n \n     bench.run([&] {\n-        PrepareBlock(test_setup->m_node, P2WSH_OP_TRUE);\n+        PrepareBlock(test_setup->m_node, P2WSH_OP_TRUE, true);\n+    });\n+}\n+static void BlockAssemblerAddPackageTxns(benchmark::Bench& bench)\n+{\n+    FastRandomContext det_rand{true};\n+    auto testing_setup = MakeNoLogFileContext<TestChain100Setup>();\n+    CTxMemPool& pool = *testing_setup.get()->m_node.mempool;\n+    LOCK2(cs_main, pool.cs);\n+    const auto transactions = testing_setup->PopulateMempool(det_rand, 1000, true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1049812519",
      "id" : 1049812519,
      "in_reply_to_id" : 1048530799,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-kt4n",
      "original_commit_id" : "4c20bee65009bd2c95c2a3426030b042f55007ad",
      "original_line" : 54,
      "original_position" : 14,
      "original_start_line" : 51,
      "path" : "src/bench/block_assemble.cpp",
      "position" : null,
      "pull_request_review_id" : 1219088870,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1049812519/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-12-15T16:00:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1049812519",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1049813788"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1049813788"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Line is removed now",
      "commit_id" : "bf560fca91cbe87fd98a9e4adbf2eab1827c4a6e",
      "created_at" : "2022-12-15T15:51:08Z",
      "diff_hunk" : "@@ -61,7 +61,7 @@ std::vector<std::shared_ptr<CBlock>> CreateBlockChain(size_t total_height, const\n \n CTxIn MineBlock(const NodeContext& node, const CScript& coinbase_scriptPubKey)\n {\n-    auto block = PrepareBlock(node, coinbase_scriptPubKey);\n+    auto block = PrepareBlock(node, coinbase_scriptPubKey, true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1049813788",
      "id" : 1049813788,
      "in_reply_to_id" : 1048475222,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-kuMc",
      "original_commit_id" : "4c20bee65009bd2c95c2a3426030b042f55007ad",
      "original_line" : 64,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/util/mining.cpp",
      "position" : null,
      "pull_request_review_id" : 1219088870,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1049813788/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-15T16:00:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1049813788",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1049814927"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1049814927"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good idea, did this instead of the bool",
      "commit_id" : "bf560fca91cbe87fd98a9e4adbf2eab1827c4a6e",
      "created_at" : "2022-12-15T15:51:45Z",
      "diff_hunk" : "@@ -74,10 +74,12 @@ CTxIn MineBlock(const NodeContext& node, const CScript& coinbase_scriptPubKey)\n     return CTxIn{block->vtx[0]->GetHash(), 0};\n }\n \n-std::shared_ptr<CBlock> PrepareBlock(const NodeContext& node, const CScript& coinbase_scriptPubKey)\n+std::shared_ptr<CBlock> PrepareBlock(const NodeContext& node, const CScript& coinbase_scriptPubKey, bool check)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1049814927",
      "id" : 1049814927,
      "in_reply_to_id" : 1048454257,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-kueP",
      "original_commit_id" : "b42cd786d01838ad979f00fff5f49f9fe67b14d5",
      "original_line" : 77,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/test/util/mining.cpp",
      "position" : null,
      "pull_request_review_id" : 1219088870,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1049814927/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-15T16:00:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1049814927",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1049816842"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1049816842"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Updated commit message.\r\nThis is a narrowing conversion - randrange returns uint64_t, CAmount is a 32.",
      "commit_id" : "bf560fca91cbe87fd98a9e4adbf2eab1827c4a6e",
      "created_at" : "2022-12-15T15:52:53Z",
      "diff_hunk" : "@@ -397,15 +397,15 @@ std::vector<CTransactionRef> TestChain100Setup::PopulateMempool(FastRandomContex\n             unspent_prevouts.pop_front();\n         }\n         const size_t num_outputs = det_rand.randrange(24) + 1;\n-        // Approximately 1000sat \"fee,\" equal output amounts.\n-        const CAmount amount_per_output = (total_in - 1000) / num_outputs;\n+        const CAmount fee = 100 * det_rand.randrange(30);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1049816842",
      "id" : 1049816842,
      "in_reply_to_id" : 1048491782,
      "line" : 400,
      "node_id" : "PRRC_kwDOABII584-ku8K",
      "original_commit_id" : "4c20bee65009bd2c95c2a3426030b042f55007ad",
      "original_line" : 400,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/test/util/setup_common.cpp",
      "position" : 6,
      "pull_request_review_id" : 1219088870,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1049816842/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-15T16:00:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1049816842",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1049820168"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1049820168"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added an `ApplyArgsManOptions` so we can both manually manipulate the options and get the config from `ArgsManager`.",
      "commit_id" : "bf560fca91cbe87fd98a9e4adbf2eab1827c4a6e",
      "created_at" : "2022-12-15T15:54:57Z",
      "diff_hunk" : "@@ -74,10 +74,12 @@ CTxIn MineBlock(const NodeContext& node, const CScript& coinbase_scriptPubKey)\n     return CTxIn{block->vtx[0]->GetHash(), 0};\n }\n \n-std::shared_ptr<CBlock> PrepareBlock(const NodeContext& node, const CScript& coinbase_scriptPubKey)\n+std::shared_ptr<CBlock> PrepareBlock(const NodeContext& node, const CScript& coinbase_scriptPubKey, bool check)\n {\n+    BlockAssembler::Options options;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1049820168",
      "id" : 1049820168,
      "in_reply_to_id" : 1048445309,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-kvwI",
      "original_commit_id" : "b42cd786d01838ad979f00fff5f49f9fe67b14d5",
      "original_line" : 79,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/test/util/mining.cpp",
      "position" : null,
      "pull_request_review_id" : 1219088870,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1049820168/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-15T16:00:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1049820168",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1049828447"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1049828447"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "bf560fca91cbe87fd98a9e4adbf2eab1827c4a6e",
      "created_at" : "2022-12-15T15:59:37Z",
      "diff_hunk" : "@@ -170,7 +173,7 @@ std::unique_ptr<CBlockTemplate> BlockAssembler::CreateNewBlock(const CScript& sc\n     pblocktemplate->vTxSigOpsCost[0] = WITNESS_SCALE_FACTOR * GetLegacySigOpCount(*pblock->vtx[0]);\n \n     BlockValidationState state;\n-    if (!TestBlockValidity(state, chainparams, m_chainstate, *pblock, pindexPrev, GetAdjustedTime, false, false)) {\n+    if (test_block_validity && !TestBlockValidity(state, chainparams, m_chainstate, *pblock, pindexPrev, GetAdjustedTime, false, false)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1049828447",
      "id" : 1049828447,
      "in_reply_to_id" : 1048484165,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-kxxf",
      "original_commit_id" : "4c20bee65009bd2c95c2a3426030b042f55007ad",
      "original_line" : 176,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/node/miner.cpp",
      "position" : null,
      "pull_request_review_id" : 1219088870,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1049828447/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-15T16:00:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1049828447",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Yes apologies @jamesob, I noticed I was making the tx fee random but still setting the mempool entry fee to 1000. Thanks for such a quick review!",
      "created_at" : "2022-12-16T17:10:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#issuecomment-1355236087",
      "id" : 1355236087,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26695",
      "node_id" : "IC_kwDOABII585Qx0L3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1355236087/reactions"
      },
      "updated_at" : "2022-12-16T17:10:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1355236087",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1051998403"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1051998403"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is there any value in disabling it? Sure, the benchmark will be less \"micro\", but at the same time it would be missing if a \"package\" block is slowing down CNB via TBV. Or is taking TBV a lot longer than the remainder of CNB, which would make this benchmark ineffective?",
      "commit_id" : "b05347204d2d1cad030fc794aae2b0d29c35db7d",
      "created_at" : "2022-12-19T09:46:50Z",
      "diff_hunk" : "@@ -45,5 +46,18 @@ static void AssembleBlock(benchmark::Bench& bench)\n         PrepareBlock(test_setup->m_node, P2WSH_OP_TRUE);\n     });\n }\n+static void BlockAssemblerAddPackageTxns(benchmark::Bench& bench)\n+{\n+    FastRandomContext det_rand{true};\n+    auto testing_setup{MakeNoLogFileContext<TestChain100Setup>()};\n+    testing_setup->PopulateMempool(det_rand, /*num_transactions=*/1000, /*submit=*/true);\n+    node::BlockAssembler::Options assembler_options;\n+    assembler_options.test_block_validity = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1051998403",
      "id" : 1051998403,
      "line" : 55,
      "node_id" : "PRRC_kwDOABII584-tDjD",
      "original_commit_id" : "b05347204d2d1cad030fc794aae2b0d29c35db7d",
      "original_line" : 55,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/bench/block_assemble.cpp",
      "position" : 18,
      "pull_request_review_id" : 1222585757,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1051998403/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-19T09:47:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1051998403",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1052022902"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1052022902"
         }
      },
      "author_association" : "MEMBER",
      "body" : "One reason is TBV taking time, another is TBV would fail because `PopulateMempool()` doesn't sign the txns and spends immature coinbases. I can change it to generate keys and mine 100 blocks in between creating and submitting the transactions if people want.",
      "commit_id" : "b05347204d2d1cad030fc794aae2b0d29c35db7d",
      "created_at" : "2022-12-19T10:10:33Z",
      "diff_hunk" : "@@ -45,5 +46,18 @@ static void AssembleBlock(benchmark::Bench& bench)\n         PrepareBlock(test_setup->m_node, P2WSH_OP_TRUE);\n     });\n }\n+static void BlockAssemblerAddPackageTxns(benchmark::Bench& bench)\n+{\n+    FastRandomContext det_rand{true};\n+    auto testing_setup{MakeNoLogFileContext<TestChain100Setup>()};\n+    testing_setup->PopulateMempool(det_rand, /*num_transactions=*/1000, /*submit=*/true);\n+    node::BlockAssembler::Options assembler_options;\n+    assembler_options.test_block_validity = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1052022902",
      "id" : 1052022902,
      "in_reply_to_id" : 1051998403,
      "line" : 55,
      "node_id" : "PRRC_kwDOABII584-tJh2",
      "original_commit_id" : "b05347204d2d1cad030fc794aae2b0d29c35db7d",
      "original_line" : 55,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/bench/block_assemble.cpp",
      "position" : 18,
      "pull_request_review_id" : 1222619833,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1052022902/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-19T10:10:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1052022902",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1053907539"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1053907539"
         }
      },
      "author_association" : "NONE",
      "body" : "this is what I get when trying to run the `BlockAssemblerAddPackageTxns` benchmark\r\n\r\nSpecs:\r\n```\r\nmac book pro 2019\r\n2.3 GHz 8-Core Intel Core i9\r\n16 GB 2667 MHz DDR4\r\nAMD Radeon Pro 5500M 4 GB\r\n```\r\n\r\nResults:\r\n```\r\n./src/bench/bench_bitcoin -filter=BlockAssemblerAddPackageTxns --sanity-check\r\nRunning with --sanity-check option, benchmark results will be useless.\r\n\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|      813,714,108.00 |                1.23 |    0.0% |      0.81 | `BlockAssemblerAddPackageTxns`\r\n```\r\n\r\nWithout `--sanity-check`:\r\n```\r\n./src/bench/bench_bitcoin -filter=BlockAssemblerAddPackageTxns\r\n\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|      830,079,779.00 |                1.20 |    1.4% |      9.16 | `BlockAssemblerAddPackageTxns`\r\n```",
      "commit_id" : "b05347204d2d1cad030fc794aae2b0d29c35db7d",
      "created_at" : "2022-12-21T02:02:14Z",
      "diff_hunk" : "@@ -42,8 +42,21 @@ static void AssembleBlock(benchmark::Bench& bench)\n     }\n \n     bench.run([&] {\n-        PrepareBlock(test_setup->m_node, P2WSH_OP_TRUE);\n+        PrepareBlock(test_setup->m_node, P2WSH_OP_TRUE, true);\n+    });\n+}\n+static void BlockAssemblerAddPackageTxns(benchmark::Bench& bench)\n+{\n+    FastRandomContext det_rand{true};\n+    auto testing_setup = MakeNoLogFileContext<TestChain100Setup>();\n+    CTxMemPool& pool = *testing_setup.get()->m_node.mempool;\n+    LOCK2(cs_main, pool.cs);\n+    const auto transactions = testing_setup->PopulateMempool(det_rand, 1000, true);\n+\n+    bench.run([&] {\n+        PrepareBlock(testing_setup->m_node, P2WSH_OP_TRUE, false);\n     });\n }\n \n BENCHMARK(AssembleBlock, benchmark::PriorityLevel::HIGH);\n+BENCHMARK(BlockAssemblerAddPackageTxns, benchmark::PriorityLevel::HIGH);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1053907539",
      "id" : 1053907539,
      "in_reply_to_id" : 1048576364,
      "line" : 63,
      "node_id" : "PRRC_kwDOABII584-0VpT",
      "original_commit_id" : "4c20bee65009bd2c95c2a3426030b042f55007ad",
      "original_line" : 63,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/bench/block_assemble.cpp",
      "position" : 26,
      "pull_request_review_id" : 1225358212,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1053907539/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-21T02:02:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1053907539",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15950706?v=4",
         "events_url" : "https://api.github.com/users/kevkevinpal/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kevkevinpal/followers",
         "following_url" : "https://api.github.com/users/kevkevinpal/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kevkevinpal/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kevkevinpal",
         "id" : 15950706,
         "login" : "kevkevinpal",
         "node_id" : "MDQ6VXNlcjE1OTUwNzA2",
         "organizations_url" : "https://api.github.com/users/kevkevinpal/orgs",
         "received_events_url" : "https://api.github.com/users/kevkevinpal/received_events",
         "repos_url" : "https://api.github.com/users/kevkevinpal/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kevkevinpal/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kevkevinpal/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kevkevinpal"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I saw in 50218324dac18556d87688dc1a8e89bbe4d5f69e you change \r\n`LOCK2(m_node.mempool->cs, cs_main);` -> `LOCK2(cs_main, m_node.mempool->cs);`\r\nI'm just curious as to the reason",
      "created_at" : "2022-12-21T02:48:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#issuecomment-1360776222",
      "id" : 1360776222,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26695",
      "node_id" : "IC_kwDOABII585RG8we",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1360776222/reactions"
      },
      "updated_at" : "2022-12-21T02:48:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1360776222",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15950706?v=4",
         "events_url" : "https://api.github.com/users/kevkevinpal/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kevkevinpal/followers",
         "following_url" : "https://api.github.com/users/kevkevinpal/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kevkevinpal/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kevkevinpal",
         "id" : 15950706,
         "login" : "kevkevinpal",
         "node_id" : "MDQ6VXNlcjE1OTUwNzA2",
         "organizations_url" : "https://api.github.com/users/kevkevinpal/orgs",
         "received_events_url" : "https://api.github.com/users/kevkevinpal/received_events",
         "repos_url" : "https://api.github.com/users/kevkevinpal/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kevkevinpal/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kevkevinpal/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kevkevinpal"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I saw in [5021832](https://github.com/bitcoin/bitcoin/commit/50218324dac18556d87688dc1a8e89bbe4d5f69e) you change `LOCK2(m_node.mempool->cs, cs_main);` -> `LOCK2(cs_main, m_node.mempool->cs);` I'm just curious as to the reason\r\n\r\nIt's an inconsistent order of acquiring mutexes, which along with other things can cause deadlock. I missed it when first implementing `PopulateMempool()` - until this PR, it was only called with both locks already acquired. Compiling with `--enable-debug` / `-DDEBUG_LOCKORDER` found it.",
      "created_at" : "2022-12-21T10:02:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#issuecomment-1361105239",
      "id" : 1361105239,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26695",
      "node_id" : "IC_kwDOABII585RINFX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1361105239/reactions"
      },
      "updated_at" : "2022-12-21T10:02:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1361105239",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> > I saw in [5021832](https://github.com/bitcoin/bitcoin/commit/50218324dac18556d87688dc1a8e89bbe4d5f69e) you change `LOCK2(m_node.mempool->cs, cs_main);` -> `LOCK2(cs_main, m_node.mempool->cs);` I'm just curious as to the reason\n> \n> It's an inconsistent order of acquiring mutexes, which along with other things can cause deadlock. I missed it when first implementing `PopulateMempool()` - until this PR, it was only called with both locks already acquired. Compiling with `--enable-debug` / `-DDEBUG_LOCKORDER` found it.\n\nOk I'll try compiling with `--enable-debug` thanks that helps explain",
      "created_at" : "2022-12-21T14:04:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#issuecomment-1361350940",
      "id" : 1361350940,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26695",
      "node_id" : "IC_kwDOABII585RJJEc",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1361350940/reactions"
      },
      "updated_at" : "2022-12-21T14:04:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1361350940",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15950706?v=4",
         "events_url" : "https://api.github.com/users/kevkevinpal/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kevkevinpal/followers",
         "following_url" : "https://api.github.com/users/kevkevinpal/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kevkevinpal/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kevkevinpal",
         "id" : 15950706,
         "login" : "kevkevinpal",
         "node_id" : "MDQ6VXNlcjE1OTUwNzA2",
         "organizations_url" : "https://api.github.com/users/kevkevinpal/orgs",
         "received_events_url" : "https://api.github.com/users/kevkevinpal/received_events",
         "repos_url" : "https://api.github.com/users/kevkevinpal/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kevkevinpal/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kevkevinpal/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kevkevinpal"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1054562437"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1054562437"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\nvoid ApplyArgsManOptions(const ArgsManager& args, BlockAssembler::Options& options)\r\n```",
      "commit_id" : "04528054fcde61aa00e009dbbe1ac350ca1cf748",
      "created_at" : "2022-12-21T16:06:56Z",
      "diff_hunk" : "@@ -72,18 +74,22 @@ BlockAssembler::BlockAssembler(Chainstate& chainstate, const CTxMemPool* mempool\n     nBlockMaxWeight = std::max<size_t>(4000, std::min<size_t>(MAX_BLOCK_WEIGHT - 4000, options.nBlockMaxWeight));\n }\n \n-static BlockAssembler::Options DefaultOptions()\n+void ApplyArgsManOptions(const ArgsManager& gArgs, BlockAssembler::Options& options)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1054562437",
      "id" : 1054562437,
      "line" : 77,
      "node_id" : "PRRC_kwDOABII584-21iF",
      "original_commit_id" : "b05347204d2d1cad030fc794aae2b0d29c35db7d",
      "original_line" : 77,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/node/miner.cpp",
      "position" : 19,
      "pull_request_review_id" : 1226360773,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1054562437/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-22T15:27:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1054562437",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Tested ACK b05347204d2d1cad030fc794aae2b0d29c35db7d\r\n\r\nthis is what I get when running the ```BlockAssemblerAddPackageTxns``` benchmark\r\n\r\nSpecs:\r\nmac book pro 2019\r\n2,6 GHz 6-Core Intel Core i7\r\n16 GB 2667 MHz DDR4\r\nmacos 13.0.1 (22A400)\r\n\r\n```\r\n$ ./src/bench/bench_bitcoin -filter=BlockAssemblerAddPackageTxns --sanity-check\r\nRunning with --sanity-check option, benchmark results will be useless.\r\n\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|      777,853,228.00 |                1.29 |    0.0% |      0.78 | `BlockAssemblerAddPackageTxns`\r\n```\r\nWithout --sanity-check:\r\n```\r\n$ ./src/bench/bench_bitcoin -filter=BlockAssemblerAddPackageTxns \r\n\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|      787,270,151.00 |                1.27 |    0.8% |      8.94 | `BlockAssemblerAddPackageTxns`\r\n```\r\n\r\nSpecs:\r\nThin Client \r\n2,6 GHz 2-Core AMD G-T56N Processor\r\n4 GB \r\nUbuntu 20.04.5 LTS\r\n\r\n```\r\n$ ./src/bench/bench_bitcoin -filter=BlockAssemblerAddPackageTxns --sanity-check\r\nRunning with --sanity-check option, benchmark results will be useless.\r\nWarning, results might be unstable:\r\n* CPU frequency scaling enabled: CPU 0 between 825.0 and 1,650.0 MHz\r\n* CPU governor is 'ondemand' but should be 'performance'\r\n* Turbo is enabled, CPU frequency will fluctuate\r\n\r\nRecommendations\r\n* Use 'pyperf system tune' before benchmarking. See https://github.com/psf/pyperf\r\n\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|    3,488,170,147.00 |                0.29 |    0.0% |      3.49 | `BlockAssemblerAddPackageTxns`\r\n```\r\nWithout --sanity-check:\r\n```\r\n$ ./src/bench/bench_bitcoin -filter=BlockAssemblerAddPackageTxns\r\nWarning, results might be unstable:\r\n* CPU frequency scaling enabled: CPU 0 between 825.0 and 1,650.0 MHz\r\n* CPU governor is 'ondemand' but should be 'performance'\r\n* Turbo is enabled, CPU frequency will fluctuate\r\n\r\nRecommendations\r\n* Use 'pyperf system tune' before benchmarking. See https://github.com/psf/pyperf\r\n\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|    3,477,761,468.00 |                0.29 |    0.0% |     38.30 | `BlockAssemblerAddPackageTxns`\r\n\r\n```",
      "created_at" : "2022-12-21T18:21:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#issuecomment-1361820871",
      "id" : 1361820871,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26695",
      "node_id" : "IC_kwDOABII585RK7zH",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1361820871/reactions"
      },
      "updated_at" : "2022-12-21T18:21:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1361820871",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1223908?v=4",
         "events_url" : "https://api.github.com/users/Emzy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Emzy/followers",
         "following_url" : "https://api.github.com/users/Emzy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Emzy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Emzy",
         "id" : 1223908,
         "login" : "Emzy",
         "node_id" : "MDQ6VXNlcjEyMjM5MDg=",
         "organizations_url" : "https://api.github.com/users/Emzy/orgs",
         "received_events_url" : "https://api.github.com/users/Emzy/received_events",
         "repos_url" : "https://api.github.com/users/Emzy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Emzy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Emzy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Emzy"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Tested ACK [b053472](https://github.com/bitcoin/bitcoin/pull/26695/commits/b05347204d2d1cad030fc794aae2b0d29c35db7d)\r\n\r\nleft some test results here\r\nhttps://github.com/bitcoin/bitcoin/pull/26695#discussion_r1053907539",
      "created_at" : "2022-12-21T18:33:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#issuecomment-1361846238",
      "id" : 1361846238,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26695",
      "node_id" : "IC_kwDOABII585RLB_e",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1361846238/reactions"
      },
      "updated_at" : "2022-12-21T18:33:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1361846238",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15950706?v=4",
         "events_url" : "https://api.github.com/users/kevkevinpal/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kevkevinpal/followers",
         "following_url" : "https://api.github.com/users/kevkevinpal/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kevkevinpal/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kevkevinpal",
         "id" : 15950706,
         "login" : "kevkevinpal",
         "node_id" : "MDQ6VXNlcjE1OTUwNzA2",
         "organizations_url" : "https://api.github.com/users/kevkevinpal/orgs",
         "received_events_url" : "https://api.github.com/users/kevkevinpal/received_events",
         "repos_url" : "https://api.github.com/users/kevkevinpal/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kevkevinpal/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kevkevinpal/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kevkevinpal"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1054725954"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1054725954"
         }
      },
      "author_association" : "NONE",
      "body" : "```suggestion\r\nstatic BlockAssembler::Options CustomOptions()\r\n```\r\nnit: as discussed on the [PR review club](https://bitcoincore.reviews/26695), perhaps the `\"DefaultOptions\"` could be renamed to avoid confusion (`\"CustomOptions\"` could be an alternative), unless there's a reason for not doing it.\r\n",
      "commit_id" : "b05347204d2d1cad030fc794aae2b0d29c35db7d",
      "created_at" : "2022-12-21T19:00:10Z",
      "diff_hunk" : "@@ -72,18 +74,22 @@ BlockAssembler::BlockAssembler(Chainstate& chainstate, const CTxMemPool* mempool\n     nBlockMaxWeight = std::max<size_t>(4000, std::min<size_t>(MAX_BLOCK_WEIGHT - 4000, options.nBlockMaxWeight));\n }\n \n-static BlockAssembler::Options DefaultOptions()\n+void ApplyArgsManOptions(const ArgsManager& gArgs, BlockAssembler::Options& options)\n {\n     // Block resource limits\n     // If -blockmaxweight is not given, limit to DEFAULT_BLOCK_MAX_WEIGHT\n-    BlockAssembler::Options options;\n     options.nBlockMaxWeight = gArgs.GetIntArg(\"-blockmaxweight\", DEFAULT_BLOCK_MAX_WEIGHT);\n     if (gArgs.IsArgSet(\"-blockmintxfee\")) {\n         std::optional<CAmount> parsed = ParseMoney(gArgs.GetArg(\"-blockmintxfee\", \"\"));\n         options.blockMinFeeRate = CFeeRate{parsed.value_or(DEFAULT_BLOCK_MIN_TX_FEE)};\n     } else {\n         options.blockMinFeeRate = CFeeRate{DEFAULT_BLOCK_MIN_TX_FEE};\n     }\n+}\n+static BlockAssembler::Options DefaultOptions()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1054725954",
      "id" : 1054725954,
      "line" : 89,
      "node_id" : "PRRC_kwDOABII584-3ddC",
      "original_commit_id" : "b05347204d2d1cad030fc794aae2b0d29c35db7d",
      "original_line" : 89,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "src/node/miner.cpp",
      "position" : 32,
      "pull_request_review_id" : 1226612496,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1054725954/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-21T19:00:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1054725954",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/110166421?v=4",
         "events_url" : "https://api.github.com/users/pablomartin4btc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pablomartin4btc/followers",
         "following_url" : "https://api.github.com/users/pablomartin4btc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pablomartin4btc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pablomartin4btc",
         "id" : 110166421,
         "login" : "pablomartin4btc",
         "node_id" : "U_kgDOBpEBlQ",
         "organizations_url" : "https://api.github.com/users/pablomartin4btc/orgs",
         "received_events_url" : "https://api.github.com/users/pablomartin4btc/received_events",
         "repos_url" : "https://api.github.com/users/pablomartin4btc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pablomartin4btc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pablomartin4btc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pablomartin4btc"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1054935498"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1054935498"
         }
      },
      "author_association" : "MEMBER",
      "body" : "When compiled with `--enable-debug`, this slows down `make check` by ~30s for me. When run without `--sanity-check`, it takes ~280s. I think this needs to be a low priority benchmark.",
      "commit_id" : "b05347204d2d1cad030fc794aae2b0d29c35db7d",
      "created_at" : "2022-12-21T23:31:17Z",
      "diff_hunk" : "@@ -42,8 +42,21 @@ static void AssembleBlock(benchmark::Bench& bench)\n     }\n \n     bench.run([&] {\n-        PrepareBlock(test_setup->m_node, P2WSH_OP_TRUE);\n+        PrepareBlock(test_setup->m_node, P2WSH_OP_TRUE, true);\n+    });\n+}\n+static void BlockAssemblerAddPackageTxns(benchmark::Bench& bench)\n+{\n+    FastRandomContext det_rand{true};\n+    auto testing_setup = MakeNoLogFileContext<TestChain100Setup>();\n+    CTxMemPool& pool = *testing_setup.get()->m_node.mempool;\n+    LOCK2(cs_main, pool.cs);\n+    const auto transactions = testing_setup->PopulateMempool(det_rand, 1000, true);\n+\n+    bench.run([&] {\n+        PrepareBlock(testing_setup->m_node, P2WSH_OP_TRUE, false);\n     });\n }\n \n BENCHMARK(AssembleBlock, benchmark::PriorityLevel::HIGH);\n+BENCHMARK(BlockAssemblerAddPackageTxns, benchmark::PriorityLevel::HIGH);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1054935498",
      "id" : 1054935498,
      "in_reply_to_id" : 1048576364,
      "line" : 63,
      "node_id" : "PRRC_kwDOABII584-4QnK",
      "original_commit_id" : "4c20bee65009bd2c95c2a3426030b042f55007ad",
      "original_line" : 63,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/bench/block_assemble.cpp",
      "position" : 26,
      "pull_request_review_id" : 1226893952,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1054935498/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-21T23:31:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1054935498",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1055369895"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055369895"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Renamed to `ConfiguredOptions`",
      "commit_id" : "04528054fcde61aa00e009dbbe1ac350ca1cf748",
      "created_at" : "2022-12-22T11:35:12Z",
      "diff_hunk" : "@@ -72,18 +74,22 @@ BlockAssembler::BlockAssembler(Chainstate& chainstate, const CTxMemPool* mempool\n     nBlockMaxWeight = std::max<size_t>(4000, std::min<size_t>(MAX_BLOCK_WEIGHT - 4000, options.nBlockMaxWeight));\n }\n \n-static BlockAssembler::Options DefaultOptions()\n+void ApplyArgsManOptions(const ArgsManager& gArgs, BlockAssembler::Options& options)\n {\n     // Block resource limits\n     // If -blockmaxweight is not given, limit to DEFAULT_BLOCK_MAX_WEIGHT\n-    BlockAssembler::Options options;\n     options.nBlockMaxWeight = gArgs.GetIntArg(\"-blockmaxweight\", DEFAULT_BLOCK_MAX_WEIGHT);\n     if (gArgs.IsArgSet(\"-blockmintxfee\")) {\n         std::optional<CAmount> parsed = ParseMoney(gArgs.GetArg(\"-blockmintxfee\", \"\"));\n         options.blockMinFeeRate = CFeeRate{parsed.value_or(DEFAULT_BLOCK_MIN_TX_FEE)};\n     } else {\n         options.blockMinFeeRate = CFeeRate{DEFAULT_BLOCK_MIN_TX_FEE};\n     }\n+}\n+static BlockAssembler::Options DefaultOptions()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1055369895",
      "id" : 1055369895,
      "in_reply_to_id" : 1054725954,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-56qn",
      "original_commit_id" : "b05347204d2d1cad030fc794aae2b0d29c35db7d",
      "original_line" : 89,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "src/node/miner.cpp",
      "position" : null,
      "pull_request_review_id" : 1227532907,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055369895/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-22T12:01:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055369895",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1055385621"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055385621"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Changed to low, I think we don't have medium? Is priority based on time only, and if so at what time threshold would we want to knock the priority down?",
      "commit_id" : "04528054fcde61aa00e009dbbe1ac350ca1cf748",
      "created_at" : "2022-12-22T11:56:46Z",
      "diff_hunk" : "@@ -42,8 +42,21 @@ static void AssembleBlock(benchmark::Bench& bench)\n     }\n \n     bench.run([&] {\n-        PrepareBlock(test_setup->m_node, P2WSH_OP_TRUE);\n+        PrepareBlock(test_setup->m_node, P2WSH_OP_TRUE, true);\n+    });\n+}\n+static void BlockAssemblerAddPackageTxns(benchmark::Bench& bench)\n+{\n+    FastRandomContext det_rand{true};\n+    auto testing_setup = MakeNoLogFileContext<TestChain100Setup>();\n+    CTxMemPool& pool = *testing_setup.get()->m_node.mempool;\n+    LOCK2(cs_main, pool.cs);\n+    const auto transactions = testing_setup->PopulateMempool(det_rand, 1000, true);\n+\n+    bench.run([&] {\n+        PrepareBlock(testing_setup->m_node, P2WSH_OP_TRUE, false);\n     });\n }\n \n BENCHMARK(AssembleBlock, benchmark::PriorityLevel::HIGH);\n+BENCHMARK(BlockAssemblerAddPackageTxns, benchmark::PriorityLevel::HIGH);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1055385621",
      "id" : 1055385621,
      "in_reply_to_id" : 1048576364,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-5-gV",
      "original_commit_id" : "4c20bee65009bd2c95c2a3426030b042f55007ad",
      "original_line" : 63,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/bench/block_assemble.cpp",
      "position" : null,
      "pull_request_review_id" : 1227532907,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055385621/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-22T12:01:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055385621",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1055535942"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055535942"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think I'd prefer keeping TBV disabled here. Block validation is important to benchmark too, but since this scales linearly with the amount of transactions selected - I think the current `AssembleBlock` benchmark suffices there? Narrower benchmarks help more easily pinpoint where performance issues are.",
      "commit_id" : "04528054fcde61aa00e009dbbe1ac350ca1cf748",
      "created_at" : "2022-12-22T14:45:34Z",
      "diff_hunk" : "@@ -45,5 +46,18 @@ static void AssembleBlock(benchmark::Bench& bench)\n         PrepareBlock(test_setup->m_node, P2WSH_OP_TRUE);\n     });\n }\n+static void BlockAssemblerAddPackageTxns(benchmark::Bench& bench)\n+{\n+    FastRandomContext det_rand{true};\n+    auto testing_setup{MakeNoLogFileContext<TestChain100Setup>()};\n+    testing_setup->PopulateMempool(det_rand, /*num_transactions=*/1000, /*submit=*/true);\n+    node::BlockAssembler::Options assembler_options;\n+    assembler_options.test_block_validity = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1055535942",
      "id" : 1055535942,
      "in_reply_to_id" : 1051998403,
      "line" : 55,
      "node_id" : "PRRC_kwDOABII584-6jNG",
      "original_commit_id" : "b05347204d2d1cad030fc794aae2b0d29c35db7d",
      "original_line" : 55,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/bench/block_assemble.cpp",
      "position" : 18,
      "pull_request_review_id" : 1226360773,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055535942/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-22T15:27:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055535942",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1055570462"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055570462"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yeah sorry, we had medium in the initial PR but it was removed later on, so agreed with changing it to low. We haven't defined any guidelines on when to downgrade to low afaik, but since devs run `make check` often, I think adding benches with meaningful (e.g. >1s?) `--sanity-check` overhead should run in low priority - unless their complexity/importance warrants otherwise.",
      "commit_id" : "04528054fcde61aa00e009dbbe1ac350ca1cf748",
      "created_at" : "2022-12-22T15:20:06Z",
      "diff_hunk" : "@@ -42,8 +42,21 @@ static void AssembleBlock(benchmark::Bench& bench)\n     }\n \n     bench.run([&] {\n-        PrepareBlock(test_setup->m_node, P2WSH_OP_TRUE);\n+        PrepareBlock(test_setup->m_node, P2WSH_OP_TRUE, true);\n+    });\n+}\n+static void BlockAssemblerAddPackageTxns(benchmark::Bench& bench)\n+{\n+    FastRandomContext det_rand{true};\n+    auto testing_setup = MakeNoLogFileContext<TestChain100Setup>();\n+    CTxMemPool& pool = *testing_setup.get()->m_node.mempool;\n+    LOCK2(cs_main, pool.cs);\n+    const auto transactions = testing_setup->PopulateMempool(det_rand, 1000, true);\n+\n+    bench.run([&] {\n+        PrepareBlock(testing_setup->m_node, P2WSH_OP_TRUE, false);\n     });\n }\n \n BENCHMARK(AssembleBlock, benchmark::PriorityLevel::HIGH);\n+BENCHMARK(BlockAssemblerAddPackageTxns, benchmark::PriorityLevel::HIGH);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1055570462",
      "id" : 1055570462,
      "in_reply_to_id" : 1048576364,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-6roe",
      "original_commit_id" : "4c20bee65009bd2c95c2a3426030b042f55007ad",
      "original_line" : 63,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/bench/block_assemble.cpp",
      "position" : null,
      "pull_request_review_id" : 1226360773,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26695",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055570462/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-22T15:27:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055570462",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Tested ACK [0452805](https://github.com/bitcoin/bitcoin/pull/26695/commits/04528054fcde61aa00e009dbbe1ac350ca1cf748)\r\nCompiled this time using `--enable-debug`\r\n\r\nSpecs:\r\n\r\nmac book pro 2019\r\n2.3 GHz 8-Core Intel Core i9\r\n16 GB 2667 MHz DDR4\r\nAMD Radeon Pro 5500M 4 GB\r\n\r\n\r\n`â  bitcoin git:(PR26695) â ./src/bench/bench_bitcoin -filter=BlockAssemblerAddPackageTxns --sanity-check`\r\n```\r\nRunning with --sanity-check option, benchmark results will be useless.\r\nWarning, results might be unstable:\r\n* DEBUG defined\r\n\r\nRecommendations\r\n* Make sure you compile for Release\r\n\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|   45,742,309,331.00 |                0.02 |    0.0% |     45.74 | `BlockAssemblerAddPackageTxns`\r\n```\r\n`â  bitcoin git:(PR26695) â ./src/bench/bench_bitcoin -filter=BlockAssemblerAddPackageTxns`\r\n\r\n```\r\nWarning, results might be unstable:\r\n* DEBUG defined\r\n\r\nRecommendations\r\n* Make sure you compile for Release\r\n\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|   43,927,650,019.00 |                0.02 |    0.7% |    488.03 | `BlockAssemblerAddPackageTxns`\r\n```",
      "created_at" : "2022-12-23T00:08:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#issuecomment-1363456336",
      "id" : 1363456336,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26695",
      "node_id" : "IC_kwDOABII585RRLFQ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1363456336/reactions"
      },
      "updated_at" : "2022-12-23T00:08:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1363456336",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15950706?v=4",
         "events_url" : "https://api.github.com/users/kevkevinpal/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kevkevinpal/followers",
         "following_url" : "https://api.github.com/users/kevkevinpal/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kevkevinpal/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kevkevinpal",
         "id" : 15950706,
         "login" : "kevkevinpal",
         "node_id" : "MDQ6VXNlcjE1OTUwNzA2",
         "organizations_url" : "https://api.github.com/users/kevkevinpal/orgs",
         "received_events_url" : "https://api.github.com/users/kevkevinpal/received_events",
         "repos_url" : "https://api.github.com/users/kevkevinpal/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kevkevinpal/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kevkevinpal/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kevkevinpal"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 04528054fcde61aa00e009dbbe1ac350ca1cf748",
      "created_at" : "2023-01-11T23:02:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#issuecomment-1379592245",
      "id" : 1379592245,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26695",
      "node_id" : "IC_kwDOABII585SOug1",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1379592245/reactions"
      },
      "updated_at" : "2023-01-11T23:02:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1379592245",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I think [this comment](https://github.com/bitcoin/bitcoin/pull/26695/files#r1048480684) can be resolved in a follow-up if preferable but I'd prefer the [`gArgs` parameter be renamed](https://github.com/bitcoin/bitcoin/pull/26695#discussion_r1054562437) in this PR already since it's quite confusing.\r\n\r\nFollow-ups in https://github.com/bitcoin/bitcoin/pull/26883",
      "created_at" : "2023-01-12T13:38:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26695#issuecomment-1380370462",
      "id" : 1380370462,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26695",
      "node_id" : "IC_kwDOABII585SRsge",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1380370462/reactions"
      },
      "updated_at" : "2023-01-12T13:38:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1380370462",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   }
]
