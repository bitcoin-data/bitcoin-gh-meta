{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "MEMBER",
   "body" : "After https://github.com/bitcoin/bitcoin/pull/26645, this change is required to be able to `#include clientversion.h` in the `libbitcoinconsensus` code without dependency on `util/translation.h`.\r\n\r\n## Steps to reproduce the problem\r\n\r\nTo demonstrate the problem, let's consider the `x86_64-w64-mingw32` platform as it guarantees that all symbols are defined in a library:\r\n```\r\n$ make -C depends HOST=x86_64-w64-mingw32 NO_QT=1 NO_WALLET=1 NO_NATPMP=1 NO_UPNP=1 NO_ZMQ=1\r\n$ ./autogen.sh && ./configure CONFIG_SITE=$PWD/depends/x86_64-w64-mingw32/share/config.site && make clean\r\n```\r\n\r\nAnd now, let's apply a diff as follows:\r\n```diff\r\n--- a/src/script/bitcoinconsensus.cpp\r\n+++ b/src/script/bitcoinconsensus.cpp\r\n@@ -8,6 +8,7 @@\r\n #include <primitives/transaction.h>\r\n #include <pubkey.h>\r\n #include <script/interpreter.h>\r\n+#include <util/check.h>\r\n #include <version.h>\r\n \r\n namespace {\r\n@@ -25,7 +26,7 @@ public:\r\n     void read(Span<std::byte> dst)\r\n     {\r\n         if (dst.size() > m_remaining) {\r\n-            throw std::ios_base::failure(std::string(__func__) + \": end of data\");\r\n+            throw std::ios_base::failure(STR_INTERNAL_BUG(\"end of data\"));\r\n         }\r\n \r\n         if (dst.data() == nullptr) {\r\n```\r\n\r\nThe resulted code fails to compile:\r\n```\r\n$ make\r\n...\r\n  CXXLD    libbitcoinconsensus.la\r\n/usr/bin/x86_64-w64-mingw32-ld: script/.libs/libbitcoinconsensus_la-bitcoinconsensus.o:bitcoinconsensus.cpp:(.text+0x1db): undefined reference to `StrFormatInternalBug[abi:cxx11](char const*, char const*, int, char const*)'\r\n...\r\n```\r\n\r\nObviously, the `util/check.cpp` needs to be added to the library sources:\r\n```diff\r\n--- a/src/Makefile.am\r\n+++ b/src/Makefile.am\r\n@@ -972,6 +972,7 @@ lib_LTLIBRARIES += $(LIBBITCOINCONSENSUS)\r\n \r\n include_HEADERS = script/bitcoinconsensus.h\r\n libbitcoinconsensus_la_SOURCES = support/cleanse.cpp $(crypto_libbitcoin_crypto_base_la_SOURCES) $(libbitcoin_consensus_a_SOURCES)\r\n+libbitcoinconsensus_la_SOURCES += util/check.cpp\r\n \r\n libbitcoinconsensus_la_LDFLAGS = $(AM_LDFLAGS) -no-undefined $(RELDFLAGS)\r\n libbitcoinconsensus_la_LIBADD = $(LIBSECP256K1)\r\n```\r\n\r\nNow, a linker complains about another symbol:\r\n```\r\n$ make\r\n...\r\n  CXXLD    libbitcoinconsensus.la\r\n/usr/bin/x86_64-w64-mingw32-ld: util/.libs/libbitcoinconsensus_la-check.o:check.cpp:(.text+0x8c): undefined reference to `FormatFullVersion[abi:cxx11]()'\r\n...\r\n```\r\n\r\nwhich is defined in the `clientversion.cpp`:\r\n```diff\r\n--- a/src/Makefile.am\r\n+++ b/src/Makefile.am\r\n@@ -972,6 +972,7 @@ lib_LTLIBRARIES += $(LIBBITCOINCONSENSUS)\r\n \r\n include_HEADERS = script/bitcoinconsensus.h\r\n libbitcoinconsensus_la_SOURCES = support/cleanse.cpp $(crypto_libbitcoin_crypto_base_la_SOURCES) $(libbitcoin_consensus_a_SOURCES)\r\n+libbitcoinconsensus_la_SOURCES += clientversion.cpp util/check.cpp\r\n \r\n libbitcoinconsensus_la_LDFLAGS = $(AM_LDFLAGS) -no-undefined $(RELDFLAGS)\r\n libbitcoinconsensus_la_LIBADD = $(LIBSECP256K1)\r\n```\r\n\r\nThis time a linker error is:\r\n```\r\n$ make\r\n...\r\n  CXXLD    libbitcoinconsensus.la\r\n/usr/bin/x86_64-w64-mingw32-ld: .libs/libbitcoinconsensus_la-clientversion.o:clientversion.:(.rdata$.refptr._Z17G_TRANSLATION_FUNB5cxx11[.refptr._Z17G_TRANSLATION_FUNB5cxx11]+0x0): undefined reference to `G_TRANSLATION_FUN[abi:cxx11]'\r\n...\r\n```\r\n\r\nwhich is supposed to be solved by this PR.\r\n\r\n---\r\n\r\nSee https://github.com/bitcoin/bitcoin/pull/26504.\r\n\r\nThe last time those functions were moved in https://github.com/bitcoin/bitcoin/pull/24409.",
   "closed_at" : "2023-04-25T15:43:34Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
      "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
      "followers_url" : "https://api.github.com/users/achow101/followers",
      "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/achow101",
      "id" : 3782274,
      "login" : "achow101",
      "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
      "organizations_url" : "https://api.github.com/users/achow101/orgs",
      "received_events_url" : "https://api.github.com/users/achow101/received_events",
      "repos_url" : "https://api.github.com/users/achow101/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/achow101"
   },
   "comments" : 20,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26688/comments",
   "created_at" : "2022-12-12T15:36:25Z",
   "draft" : false,
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26688/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/26688",
   "id" : 1492165275,
   "labels" : [
      {
         "color" : "cccccc",
         "default" : false,
         "description" : "",
         "id" : 955867938,
         "name" : "Needs rebase",
         "node_id" : "MDU6TGFiZWw5NTU4Njc5Mzg=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26688/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "PR_kwDOABII585FNSQm",
   "number" : 26688,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/26688.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26688",
      "merged_at" : null,
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/26688.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26688"
   },
   "reactions" : {
      "+1" : 0,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 0,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26688/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "state_reason" : null,
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26688/timeline",
   "title" : "Move `CopyrightHolders()` and `LicenseInfo()` into `libbitcoin_common`",
   "updated_at" : "2023-04-27T06:15:53Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26688",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
      "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
      "followers_url" : "https://api.github.com/users/hebasto/followers",
      "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/hebasto",
      "id" : 32963518,
      "login" : "hebasto",
      "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
      "organizations_url" : "https://api.github.com/users/hebasto/orgs",
      "received_events_url" : "https://api.github.com/users/hebasto/received_events",
      "repos_url" : "https://api.github.com/users/hebasto/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/hebasto"
   }
}
