[
   {
      "author_association" : "MEMBER",
      "body" : "I suspected those are the steps to reproduce the bug in the unit tests on a fresh install of Ubuntu Focal, however, I couldn't\r\n\r\n\r\n```\r\nexport DEBIAN_FRONTEND=noninteractive && apt update && apt install curl wget htop git vim ccache -y && git clone https://github.com/bitcoin/bitcoin.git ./bitcoin-core && cd bitcoin-core && apt install libc++abi-dev libc++-dev clang llvm build-essential libtool autotools-dev automake pkg-config bsdmainutils python3-zmq      make automake cmake curl g++-multilib libtool binutils-gold bsdmainutils pkg-config python3 patch bison        -y  && ( cd depends && make CC=clang CXX=\"clang++ -stdlib=libc++\" DEBUG=1 NO_QT=1 NO_WALLET=1 NO_ZMQ=1 NO_UPNP=1 NO_NATPMP=1 -j $(nproc) ) &&  ./autogen.sh && CONFIG_SITE=\"$PWD/depends/x86_64-pc-linux-gnu/share/config.site\" ./configure CC=clang CXX=\"clang++ -stdlib=libc++\" && make -j $(nproc)\r\n```\r\n\r\n",
      "created_at" : "2022-02-09T11:58:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24290#issuecomment-1033684160",
      "id" : 1033684160,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24290",
      "node_id" : "IC_kwDOABII5849nMTA",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1033684160/reactions"
      },
      "updated_at" : "2022-02-09T11:58:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1033684160",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Oh, nvm. I could reproduce in the unit tests. It just needs valgrind:\r\n\r\n```\r\nvalgrind ./src/test/test_bitcoin \r\n==102942== Memcheck, a memory error detector\r\n==102942== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.\r\n==102942== Using Valgrind-3.15.0 and LibVEX; rerun with -h for copyright info\r\n==102942== Command: ./src/test/test_bitcoin\r\n==102942== \r\nRunning 449 test cases...\r\n==102942== Invalid read of size 8\r\n==102942==    at 0x48B6B47: std::__1::__libcpp_db::swap(void*, void*) (in /usr/lib/llvm-10/lib/libc++.so.1.0)\r\n==102942==    by 0x1D5CF7: std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >::basic_string(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >&&) (in /bitcoin-core/src/test/test_bitcoin)\r\n==102942==    by 0x20702C: std::__1::__fs::filesystem::path::path(std::__1::__fs::filesystem::path&&) (in /bitcoin-core/src/test/test_bitcoin)\r\n==102942==    by 0x20651C: fs::path::path(std::__1::__fs::filesystem::path) (in /bitcoin-core/src/test/test_bitcoin)\r\n==102942==    by 0xC5247F: fs::absolute(fs::path const&) (in /bitcoin-core/src/test/test_bitcoin)\r\n==102942==    by 0xC5270A: ArgsManager::GetDataDir(bool) const (in /bitcoin-core/src/test/test_bitcoin)\r\n==102942==    by 0x36341B: ArgsManager::GetDataDirNet() const (in /bitcoin-core/src/test/test_bitcoin)\r\n==102942==    by 0xC558AB: AbsPathForConfigVal(fs::path const&, bool) (in /bitcoin-core/src/test/test_bitcoin)\r\n==102942==    by 0xB8B1A6: init::SetLoggingOptions(ArgsManager const&) (in /bitcoin-core/src/test/test_bitcoin)\r\n==102942==    by 0x7449B6: InitLogging(ArgsManager const&) (in /bitcoin-core/src/test/test_bitcoin)\r\n==102942==    by 0x6B8958: BasicTestingSetup::BasicTestingSetup(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::vector<char const*, std::__1::allocator<char const*> > const&) (in /bitcoin-core/src/test/test_bitcoin)\r\n==102942==    by 0x1C1ABA: addrman_tests::addrman_simple::addrman_simple() (in /bitcoin-core/src/test/test_bitcoin)\r\n==102942==  Address 0x8 is not stack'd, malloc'd or (recently) free'd\r\n==102942== \r\n==102942== Warning: client switching stacks?  SP change: 0x5540ad8 --> 0x1ffeffb760\r\n==102942==          to suppress, use: --max-stackframe=137332763784 or greater\r\n",
      "created_at" : "2022-02-09T11:59:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24290#issuecomment-1033684942",
      "id" : 1033684942,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24290",
      "node_id" : "IC_kwDOABII5849nMfO",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1033684942/reactions"
      },
      "updated_at" : "2022-02-09T11:59:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1033684942",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "bitcoind also affected:\r\n\r\n\r\n```\r\n# valgrind ./src/bitcoind -datadir=/tmp/aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\r\n==107287== Memcheck, a memory error detector\r\n==107287== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.\r\n==107287== Using Valgrind-3.15.0 and LibVEX; rerun with -h for copyright info\r\n==107287== Command: ./src/bitcoind -datadir=/tmp/aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\r\n==107287== \r\n==107287== Invalid read of size 8\r\n==107287==    at 0x48B6B47: std::__1::__libcpp_db::swap(void*, void*) (in /usr/lib/llvm-10/lib/libc++.so.1.0)\r\n==107287==    by 0x15B0A7: std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >::basic_string(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >&&) (in /bitcoin-core/src/bitcoind)\r\n==107287==    by 0x1AE5DC: std::__1::__fs::filesystem::path::path(std::__1::__fs::filesystem::path&&) (in /bitcoin-core/src/bitcoind)\r\n==107287==    by 0x180D9C: fs::path::path(std::__1::__fs::filesystem::path) (in /bitcoin-core/src/bitcoind)\r\n==107287==    by 0x7DA58F: fs::absolute(fs::path const&) (in /bitcoin-core/src/bitcoind)\r\n==107287==    by 0x7DD885: CheckDataDirOption() (in /bitcoin-core/src/bitcoind)\r\n==107287==    by 0x156201: AppInit(node::NodeContext&, int, char**) (in /bitcoin-core/src/bitcoind)\r\n==107287==    by 0x155E7B: main (in /bitcoin-core/src/bitcoind)\r\n==107287==  Address 0x8 is not stack'd, malloc'd or (recently) free'd\r\n==107287== \r\n==107287== \r\n==107287== Process terminating with default action of signal 11 (SIGSEGV): dumping core\r\n==107287==  Access not within mapped region at address 0x8\r\n==107287==    at 0x48B6B47: std::__1::__libcpp_db::swap(void*, void*) (in /usr/lib/llvm-10/lib/libc++.so.1.0)\r\n==107287==    by 0x15B0A7: std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >::basic_string(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >&&) (in /bitcoin-core/src/bitcoind)\r\n==107287==    by 0x1AE5DC: std::__1::__fs::filesystem::path::path(std::__1::__fs::filesystem::path&&) (in /bitcoin-core/src/bitcoind)\r\n==107287==    by 0x180D9C: fs::path::path(std::__1::__fs::filesystem::path) (in /bitcoin-core/src/bitcoind)\r\n==107287==    by 0x7DA58F: fs::absolute(fs::path const&) (in /bitcoin-core/src/bitcoind)\r\n==107287==    by 0x7DD885: CheckDataDirOption() (in /bitcoin-core/src/bitcoind)\r\n==107287==    by 0x156201: AppInit(node::NodeContext&, int, char**) (in /bitcoin-core/src/bitcoind)\r\n==107287==    by 0x155E7B: main (in /bitcoin-core/src/bitcoind)\r\n==107287==  If you believe this happened as a result of a stack\r\n==107287==  overflow in your program's main thread (unlikely but\r\n==107287==  possible), you can try to increase the size of the\r\n==107287==  main thread stack using the --main-stacksize= flag.\r\n==107287==  The main thread stack size used in this run was 8388608.\r\n==107287== \r\n==107287== HEAP SUMMARY:\r\n==107287==     in use at exit: 159,334 bytes in 2,276 blocks\r\n==107287==   total heap usage: 8,251 allocs, 5,975 frees, 503,749 bytes allocated\r\n==107287== \r\n==107287== LEAK SUMMARY:\r\n==107287==    definitely lost: 0 bytes in 0 blocks\r\n==107287==    indirectly lost: 0 bytes in 0 blocks\r\n==107287==      possibly lost: 0 bytes in 0 blocks\r\n==107287==    still reachable: 159,334 bytes in 2,276 blocks\r\n==107287==         suppressed: 0 bytes in 0 blocks\r\n==107287== Rerun with --leak-check=full to see details of leaked memory\r\n==107287== \r\n==107287== For lists of detected and suppressed errors, rerun with: -s\r\n==107287== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)\r\nSegmentation fault (core dumped)\r\n",
      "created_at" : "2022-02-09T12:19:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24290#issuecomment-1033701985",
      "id" : 1033701985,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24290",
      "node_id" : "IC_kwDOABII5849nQph",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1033701985/reactions"
      },
      "updated_at" : "2022-02-09T12:19:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1033701985",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Closing for now as upstream bug. Feel free to continue discussion.",
      "created_at" : "2022-02-16T08:57:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24290#issuecomment-1041258577",
      "id" : 1041258577,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24290",
      "node_id" : "IC_kwDOABII584-EFhR",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1041258577/reactions"
      },
      "updated_at" : "2022-02-16T08:57:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1041258577",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
