[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#24213](https://github.com/bitcoin/bitcoin/pull/24213) (refactor: use Span in random.*; make GetRand a template, remove GetRandInt by PastaPastaPasta)\n* [#24128](https://github.com/bitcoin/bitcoin/pull/24128) (wallet: BIP 326 sequence based anti-fee-snipe for taproot inputs by MarcoFalke)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-02-02T04:16:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24225#issuecomment-1027561520",
      "id" : 1027561520,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24225",
      "node_id" : "IC_kwDOABII5849P1gw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1027561520/reactions"
      },
      "updated_at" : "2022-03-06T12:33:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1027561520",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24225#discussion_r797330665"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24225"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/797330665"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: I'd probably add a verb to the function's name",
      "commit_id" : "fa32fb032d996b720c4876d2d949a52ba71f3f22",
      "created_at" : "2022-02-02T07:27:00Z",
      "diff_hunk" : "@@ -583,12 +583,13 @@ static bool IsCurrentForAntiFeeSniping(interfaces::Chain& chain, const uint256&\n }\n \n /**\n- * Return a height-based locktime for new transactions (uses the height of the\n+ * Set a height-based locktime for new transactions (uses the height of the\n  * current chain tip unless we are not synced with the current chain\n  */\n-static uint32_t GetLocktimeForNewTransaction(interfaces::Chain& chain, const uint256& block_hash, int block_height)\n+static void AntiFeeSnipe(CMutableTransaction& tx, interfaces::Chain& chain, const uint256& block_hash, int block_height)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24225#discussion_r797330665",
      "id" : 797330665,
      "line" : 589,
      "node_id" : "PRRC_kwDOABII584vhkzp",
      "original_commit_id" : "fa32fb032d996b720c4876d2d949a52ba71f3f22",
      "original_line" : 589,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 9,
      "pull_request_review_id" : 870161629,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24225",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/797330665/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-02T07:28:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/797330665",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24225#discussion_r797342171"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24225"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/797342171"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Isn't `to snipe` a verb? Though, I am open to suggestions.",
      "commit_id" : "fa32fb032d996b720c4876d2d949a52ba71f3f22",
      "created_at" : "2022-02-02T07:48:57Z",
      "diff_hunk" : "@@ -583,12 +583,13 @@ static bool IsCurrentForAntiFeeSniping(interfaces::Chain& chain, const uint256&\n }\n \n /**\n- * Return a height-based locktime for new transactions (uses the height of the\n+ * Set a height-based locktime for new transactions (uses the height of the\n  * current chain tip unless we are not synced with the current chain\n  */\n-static uint32_t GetLocktimeForNewTransaction(interfaces::Chain& chain, const uint256& block_hash, int block_height)\n+static void AntiFeeSnipe(CMutableTransaction& tx, interfaces::Chain& chain, const uint256& block_hash, int block_height)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24225#discussion_r797342171",
      "id" : 797342171,
      "in_reply_to_id" : 797330665,
      "line" : 589,
      "node_id" : "PRRC_kwDOABII584vhnnb",
      "original_commit_id" : "fa32fb032d996b720c4876d2d949a52ba71f3f22",
      "original_line" : 589,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 9,
      "pull_request_review_id" : 870177154,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24225",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/797342171/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-02T07:48:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/797342171",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24225#discussion_r797394265"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24225"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/797394265"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I thought fee sniping is that something we want to counter, not something we're doing ourselves. I was thinking along the lines of \"SetAntiFeeSnipe\" or \"SetAntiFeeSnipeLocktime\" ð¤·ââï¸ ",
      "commit_id" : "fa8e76bb9002a126b3645bd9533c282f5dfff111",
      "created_at" : "2022-02-02T09:04:10Z",
      "diff_hunk" : "@@ -583,12 +583,13 @@ static bool IsCurrentForAntiFeeSniping(interfaces::Chain& chain, const uint256&\n }\n \n /**\n- * Return a height-based locktime for new transactions (uses the height of the\n+ * Set a height-based locktime for new transactions (uses the height of the\n  * current chain tip unless we are not synced with the current chain\n  */\n-static uint32_t GetLocktimeForNewTransaction(interfaces::Chain& chain, const uint256& block_hash, int block_height)\n+static void AntiFeeSnipe(CMutableTransaction& tx, interfaces::Chain& chain, const uint256& block_hash, int block_height)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24225#discussion_r797394265",
      "id" : 797394265,
      "in_reply_to_id" : 797330665,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584vh0VZ",
      "original_commit_id" : "fa32fb032d996b720c4876d2d949a52ba71f3f22",
      "original_line" : 589,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 870248236,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24225",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/797394265/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-02T09:04:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/797394265",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24225#discussion_r797400077"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24225"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/797400077"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thx, done something",
      "commit_id" : "fa8e76bb9002a126b3645bd9533c282f5dfff111",
      "created_at" : "2022-02-02T09:11:48Z",
      "diff_hunk" : "@@ -583,12 +583,13 @@ static bool IsCurrentForAntiFeeSniping(interfaces::Chain& chain, const uint256&\n }\n \n /**\n- * Return a height-based locktime for new transactions (uses the height of the\n+ * Set a height-based locktime for new transactions (uses the height of the\n  * current chain tip unless we are not synced with the current chain\n  */\n-static uint32_t GetLocktimeForNewTransaction(interfaces::Chain& chain, const uint256& block_hash, int block_height)\n+static void AntiFeeSnipe(CMutableTransaction& tx, interfaces::Chain& chain, const uint256& block_hash, int block_height)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24225#discussion_r797400077",
      "id" : 797400077,
      "in_reply_to_id" : 797330665,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584vh1wN",
      "original_commit_id" : "fa32fb032d996b720c4876d2d949a52ba71f3f22",
      "original_line" : 589,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 870256587,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24225",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/797400077/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-02T09:11:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/797400077",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Code review is fine. I compiled the PR and created a transaction on regtest, which seemed to go well. I added my own print statement to check that the `DiscourageFeeSniping` function really was called, and therefore that the asserts passed. \r\n\r\nACK https://github.com/bitcoin/bitcoin/pull/24225/commits/fa8e76bb9002a126b3645bd9533c282f5dfff111",
      "created_at" : "2022-03-08T18:47:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24225#issuecomment-1062093364",
      "id" : 1062093364,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24225",
      "node_id" : "IC_kwDOABII584_TkI0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1062093364/reactions"
      },
      "updated_at" : "2022-03-08T18:47:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1062093364",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8398185?v=4",
         "events_url" : "https://api.github.com/users/chris-belcher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/chris-belcher/followers",
         "following_url" : "https://api.github.com/users/chris-belcher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/chris-belcher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/chris-belcher",
         "id" : 8398185,
         "login" : "chris-belcher",
         "node_id" : "MDQ6VXNlcjgzOTgxODU=",
         "organizations_url" : "https://api.github.com/users/chris-belcher/orgs",
         "received_events_url" : "https://api.github.com/users/chris-belcher/received_events",
         "repos_url" : "https://api.github.com/users/chris-belcher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/chris-belcher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/chris-belcher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/chris-belcher"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@S3RK Mind doing a quick re-ACK?",
      "created_at" : "2022-03-10T12:30:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24225#issuecomment-1064004894",
      "id" : 1064004894,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24225",
      "node_id" : "IC_kwDOABII584_a20e",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1064004894/reactions"
      },
      "updated_at" : "2022-03-10T12:30:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1064004894",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Code review ACK fa8e76bb9002a126b3645bd9533c282f5dfff111",
      "created_at" : "2022-03-14T07:10:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24225#issuecomment-1066448550",
      "id" : 1066448550,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24225",
      "node_id" : "IC_kwDOABII584_kLam",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1066448550/reactions"
      },
      "updated_at" : "2022-03-14T07:10:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1066448550",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK fa8e76bb9002a126b3645bd9533c282f5dfff111",
      "created_at" : "2022-03-14T10:27:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24225#issuecomment-1066615926",
      "id" : 1066615926,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24225",
      "node_id" : "IC_kwDOABII584_k0R2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1066615926/reactions"
      },
      "updated_at" : "2022-03-14T10:27:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1066615926",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24225#discussion_r825798268"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24225"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/825798268"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is fine for now, but it could be problematic if the sequence of preset inputs and the existing locktime were passed into the newly created transaction. Currently, we don't do that, but we might need to do that later for miniscript.",
      "commit_id" : "fa8e76bb9002a126b3645bd9533c282f5dfff111",
      "created_at" : "2022-03-14T10:29:48Z",
      "diff_hunk" : "@@ -610,22 +611,34 @@ static uint32_t GetLocktimeForNewTransaction(interfaces::Chain& chain, const uin\n     // now we ensure code won't be written that makes assumptions about\n     // nLockTime that preclude a fix later.\n     if (IsCurrentForAntiFeeSniping(chain, block_hash)) {\n-        locktime = block_height;\n+        tx.nLockTime = block_height;\n \n         // Secondly occasionally randomly pick a nLockTime even further back, so\n         // that transactions that are delayed after signing for whatever reason,\n         // e.g. high-latency mix networks and some CoinJoin implementations, have\n         // better privacy.\n-        if (GetRandInt(10) == 0)\n-            locktime = std::max(0, (int)locktime - GetRandInt(100));\n+        if (GetRandInt(10) == 0) {\n+            tx.nLockTime = std::max(0, int(tx.nLockTime) - GetRandInt(100));\n+        }\n     } else {\n         // If our chain is lagging behind, we can't discourage fee sniping nor help\n         // the privacy of high-latency transactions. To avoid leaking a potentially\n         // unique \"nLockTime fingerprint\", set nLockTime to a constant.\n-        locktime = 0;\n+        tx.nLockTime = 0;\n+    }\n+    // Sanity check all values\n+    assert(tx.nLockTime < LOCKTIME_THRESHOLD); // Type must be block height\n+    assert(tx.nLockTime <= uint64_t(block_height));\n+    for (const auto& in : tx.vin) {\n+        // Can not be FINAL for locktime to work\n+        assert(in.nSequence != CTxIn::SEQUENCE_FINAL);\n+        // May be MAX NONFINAL to disable both BIP68 and BIP125\n+        if (in.nSequence == CTxIn::MAX_SEQUENCE_NONFINAL) continue;\n+        // May be MAX BIP125 to disable BIP68 and enable BIP125\n+        if (in.nSequence == MAX_BIP125_RBF_SEQUENCE) continue;\n+        // The wallet does not support any other sequence-use right now.\n+        assert(false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24225#discussion_r825798268",
      "id" : 825798268,
      "line" : 640,
      "node_id" : "PRRC_kwDOABII584xOK58",
      "original_commit_id" : "fa8e76bb9002a126b3645bd9533c282f5dfff111",
      "original_line" : 640,
      "original_position" : 51,
      "original_start_line" : 639,
      "path" : "src/wallet/spend.cpp",
      "position" : 51,
      "pull_request_review_id" : 908577051,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24225",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/825798268/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 639,
      "start_side" : "RIGHT",
      "updated_at" : "2022-03-14T10:29:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/825798268",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24225#discussion_r825800850"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24225"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/825800850"
         }
      },
      "author_association" : "MEMBER",
      "body" : "#24128 removes this assert. So I think either miniscript or #24128 should remove it (whichever happens first)",
      "commit_id" : "fa8e76bb9002a126b3645bd9533c282f5dfff111",
      "created_at" : "2022-03-14T10:32:41Z",
      "diff_hunk" : "@@ -610,22 +611,34 @@ static uint32_t GetLocktimeForNewTransaction(interfaces::Chain& chain, const uin\n     // now we ensure code won't be written that makes assumptions about\n     // nLockTime that preclude a fix later.\n     if (IsCurrentForAntiFeeSniping(chain, block_hash)) {\n-        locktime = block_height;\n+        tx.nLockTime = block_height;\n \n         // Secondly occasionally randomly pick a nLockTime even further back, so\n         // that transactions that are delayed after signing for whatever reason,\n         // e.g. high-latency mix networks and some CoinJoin implementations, have\n         // better privacy.\n-        if (GetRandInt(10) == 0)\n-            locktime = std::max(0, (int)locktime - GetRandInt(100));\n+        if (GetRandInt(10) == 0) {\n+            tx.nLockTime = std::max(0, int(tx.nLockTime) - GetRandInt(100));\n+        }\n     } else {\n         // If our chain is lagging behind, we can't discourage fee sniping nor help\n         // the privacy of high-latency transactions. To avoid leaking a potentially\n         // unique \"nLockTime fingerprint\", set nLockTime to a constant.\n-        locktime = 0;\n+        tx.nLockTime = 0;\n+    }\n+    // Sanity check all values\n+    assert(tx.nLockTime < LOCKTIME_THRESHOLD); // Type must be block height\n+    assert(tx.nLockTime <= uint64_t(block_height));\n+    for (const auto& in : tx.vin) {\n+        // Can not be FINAL for locktime to work\n+        assert(in.nSequence != CTxIn::SEQUENCE_FINAL);\n+        // May be MAX NONFINAL to disable both BIP68 and BIP125\n+        if (in.nSequence == CTxIn::MAX_SEQUENCE_NONFINAL) continue;\n+        // May be MAX BIP125 to disable BIP68 and enable BIP125\n+        if (in.nSequence == MAX_BIP125_RBF_SEQUENCE) continue;\n+        // The wallet does not support any other sequence-use right now.\n+        assert(false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24225#discussion_r825800850",
      "id" : 825800850,
      "in_reply_to_id" : 825798268,
      "line" : 640,
      "node_id" : "PRRC_kwDOABII584xOLiS",
      "original_commit_id" : "fa8e76bb9002a126b3645bd9533c282f5dfff111",
      "original_line" : 640,
      "original_position" : 51,
      "original_start_line" : 639,
      "path" : "src/wallet/spend.cpp",
      "position" : 51,
      "pull_request_review_id" : 908580506,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24225",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/825800850/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 639,
      "start_side" : "RIGHT",
      "updated_at" : "2022-03-14T10:32:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/825800850",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
