{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "MEMBER",
   "body" : "1. Only add a transaction to the unbroadcast set when it's added to the mempool\r\n    \r\n    Currently, if BroadcastTransaction() is called to rebroadcast a\r\n    transaction (e.g. by ResendWalletTransactions()), then we add the\r\n    transaction to the unbroadcast set. That transaction has already been\r\n    broadcast in the past, so peers are unlikely to request it again,\r\n    meaning RemoveUnbroadcastTx() won't be called and it won't be removed\r\n    from m_unbroadcast_txids.\r\n    \r\n    Net processing will therefore continue to attempt rebroadcast for the\r\n    transaction every 10-15 minutes. This will most likely continue until\r\n    the node connects to a new peer which hasn't yet seen the transaction\r\n    (or perhaps indefinitely).\r\n    \r\n    Fix by only adding the transaction to the broadcast set when it's added to the mempool.\r\n\r\n2. Allow rebroadcast for same-txid-different-wtxid transactions\r\n    \r\n    There is some slightly unexpected behaviour when:\r\n    \r\n    - there is already transaction in the mempool (the \"mempool tx\")\r\n    - BroadcastTransaction() is called for a transaction with the same txid\r\n      as the mempool transaction but a different witness (the \"new tx\")\r\n    \r\n    Prior to this commit, if BroadcastTransaction() is called with\r\n    relay=true, then it'll call RelayTransaction() using the txid/wtxid of\r\n    the new tx, not the txid/wtxid of the mempool tx. For wtxid relay peers,\r\n    in SendMessages(), the wtxid of the new tx will be taken from\r\n    setInventoryTxToSend, but will then be filtered out from the vector of\r\n    wtxids to announce, since m_mempool.info() won't find the transaction\r\n    (the mempool contains the mempool tx, which has a different wtxid from\r\n    the new tx).\r\n    \r\n    Fix this by calling RelayTransaction() with the wtxid of the mempool\r\n    transaction in this case.\r\n\r\nThe third commit is a comment/whitespace only change to tidy up the BroadcastTransaction() function.",
   "closed_at" : "2021-07-20T12:58:53Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
      "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
      "followers_url" : "https://api.github.com/users/fanquake/followers",
      "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/fanquake",
      "id" : 863730,
      "login" : "fanquake",
      "node_id" : "MDQ6VXNlcjg2MzczMA==",
      "organizations_url" : "https://api.github.com/users/fanquake/orgs",
      "received_events_url" : "https://api.github.com/users/fanquake/received_events",
      "repos_url" : "https://api.github.com/users/fanquake/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/fanquake"
   },
   "comments" : 19,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22261/comments",
   "created_at" : "2021-06-16T15:58:52Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22261/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/22261",
   "id" : 922799170,
   "labels" : [
      {
         "color" : "FBBAAB",
         "default" : false,
         "description" : null,
         "id" : 64585,
         "name" : "Bug",
         "node_id" : "MDU6TGFiZWw2NDU4NQ==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug"
      },
      {
         "color" : "fef2c0",
         "default" : false,
         "description" : null,
         "id" : 164208572,
         "name" : "Mempool",
         "node_id" : "MDU6TGFiZWwxNjQyMDg1NzI=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Mempool"
      },
      {
         "color" : "006b75",
         "default" : false,
         "description" : null,
         "id" : 98298007,
         "name" : "P2P",
         "node_id" : "MDU6TGFiZWw5ODI5ODAwNw==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P"
      },
      {
         "color" : "0052cc",
         "default" : false,
         "description" : "",
         "id" : 1648013533,
         "name" : "Review club",
         "node_id" : "MDU6TGFiZWwxNjQ4MDEzNTMz",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Review%20club"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22261/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDExOlB1bGxSZXF1ZXN0NjcxNjMxMDg3",
   "number" : 22261,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/22261.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22261",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/22261.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22261"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "[p2p/mempool] Two small fixes to node broadcast logic",
   "updated_at" : "2021-07-20T13:06:08Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22261",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
      "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
      "followers_url" : "https://api.github.com/users/jnewbery/followers",
      "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/jnewbery",
      "id" : 1063656,
      "login" : "jnewbery",
      "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
      "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
      "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
      "repos_url" : "https://api.github.com/users/jnewbery/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/jnewbery"
   }
}
