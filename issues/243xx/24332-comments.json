[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-02-14T10:13:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24332#issuecomment-1038900263",
      "id" : 1038900263,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24332",
      "node_id" : "IC_kwDOABII58497Fwn",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1038900263/reactions"
      },
      "updated_at" : "2022-02-14T10:13:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1038900263",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased",
      "created_at" : "2022-02-14T20:12:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24332#issuecomment-1039508838",
      "id" : 1039508838,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24332",
      "node_id" : "IC_kwDOABII58499aVm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1039508838/reactions"
      },
      "updated_at" : "2022-02-14T20:12:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1039508838",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK. I think the code changes here basically look good, but I do have some feedback.\r\n\r\n* I think new code in `src/kernel/` should try not rely on global variables. Or at least, any API exposed by libbitcoin_kernel should not be **forced** to rely on global variables, because it it is missing some pointer to the appropriate context. I made a small change in b6072da940b1af4eadf8c1bc6192ae86d634e714 which adds a little infrastructure fixing this problem for `timedata` in a way that should let us clean up globals later, while not substantially increasing the size of the diff now. Could squash it into this PR.\r\n\r\n* I think it would be good to put all code in `src/kernel/` in a `kernel::` namespace, similar to how `src/node/` code is in `node::`, `src/wallet/` is in `wallet::`, newer `src/util` code is in `util::`. (Suggested changes above in b6072da940b1af4eadf8c1bc6192ae86d634e714 do use `kernel::` namespace FWIW)\r\n\r\n* I don't love how there are duplicative `src/timedata.h`, `src/timedata.cpp`, `src/kernel/timedata.h`, and `src/kernel/timedata.cpp` files. Would be good to name the kernel files to something like `src/kernel/adjusted_time` or something more specific to make them more distinct.\r\n\r\n* `kernel/init/common` naming doesn't make much sense. The `src/init/common.cpp` file has that name because every other file in the `src/init/` directory contains init code for one of the bitcoin-core executables (`bitcoind.cpp`, `bitcoin-qt.cpp`, `bitcoin-wallet.cpp`) and `common.cpp` was supposed to hold whatever common boilerplate was used by them all. Probably the `src/kernel/init/` directory should not exist and the code should just be moved into the `kernel::Context` constructors / destructors.\r\n\r\n* I guess we are actively discussing this in #24303, but I still don't understand where the boundary between `libbitcoin_kernel` and `libbitcoin_consensus` is or why these are two different libraries. I guess depending on where that discussion goes, maybe some of this code may go in libbitcoin_consensus not libbitcoin_kernel.\r\n",
      "created_at" : "2022-02-14T21:10:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24332#issuecomment-1039562660",
      "id" : 1039562660,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24332",
      "node_id" : "IC_kwDOABII58499nek",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1039562660/reactions"
      },
      "updated_at" : "2022-02-14T21:10:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1039562660",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Concept ACK. I think the code changes here basically look good, but I do have some feedback.\r\n> \r\n> * I think new code in `src/kernel/` should try not rely on global variables. Or at least, any API exposed by libbitcoin_kernel should not be **forced** to rely on global variables, because it it is missing some pointer to the appropriate context. I made a small change in b6072da940b1af4eadf8c1bc6192ae86d634e714 which adds a little infrastructure fixing this problem for `timedata` in a way that should let us clean up globals later, while not substantially increasing the size of the diff now. Could squash it into this PR.\r\n> \r\n> * I think it would be good to put all code in `src/kernel/` in a `kernel::` namespace, similar to how `src/node/` code is in `node::`, `src/wallet/` is in `wallet::`, newer `src/util` code is in `util::`. (Suggested changes above in b6072da940b1af4eadf8c1bc6192ae86d634e714 do use `kernel::` namespace FWIW)\r\n> \r\n> * I don't love how there are duplicative `src/timedata.h`, `src/timedata.cpp`, `src/kernel/timedata.h`, and `src/kernel/timedata.cpp` files. Would be good to name the kernel files to something like `src/kernel/adjusted_time` or something more specific to make them more distinct.\r\n> \r\n> * `kernel/init/common` naming doesn't make much sense. The `src/init/common.cpp` file has that name because every other file in the `src/init/` directory contains init code for one of the bitcoin-core executables (`bitcoind.cpp`, `bitcoin-qt.cpp`, `bitcoin-wallet.cpp`) and `common.cpp` was supposed to hold whatever common boilerplate was used by them all. Probably the `src/kernel/init/` directory should not exist and the code should just be moved into the `kernel::Context` constructors / destructors.\r\n> \r\n> * I guess we are actively discussing this in #24303, but I still don't understand where the boundary between `libbitcoin_kernel` and `libbitcoin_consensus` is or why these are two different libraries. I guess depending on where that discussion goes, maybe some of this code may go in libbitcoin_consensus not libbitcoin_kernel.\r\n\r\nAs mentioned [here](https://github.com/bitcoin/bitcoin/issues/24303#issuecomment-1040334722) and [here](https://github.com/bitcoin/bitcoin/issues/24303#issuecomment-1042099654), I had a fruitful talk offline with Ryan and hashed out a few of these points. I will incorporate the changes to introduce a `kernel::Context` struct, and tweak the code organization such that it aligns with our existing code organization style more.\r\n\r\n**Closing temporarily, will re-open** (or open another PR)!",
      "created_at" : "2022-02-16T20:05:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24332#issuecomment-1042115430",
      "id" : 1042115430,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24332",
      "node_id" : "IC_kwDOABII584-HWtm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1042115430/reactions"
      },
      "updated_at" : "2022-02-16T20:12:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1042115430",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   }
]
