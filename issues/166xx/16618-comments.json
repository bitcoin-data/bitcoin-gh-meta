[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Is this safe to do? What are the implications of connecting to a peer that would otherwise be banned?",
      "created_at" : "2019-08-15T10:34:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16618#issuecomment-521596921",
      "id" : 521596921,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16618",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMTU5NjkyMQ==",
      "updated_at" : "2019-08-15T10:34:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/521596921",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/42591821?v=4",
         "events_url" : "https://api.github.com/users/gapeman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gapeman/followers",
         "following_url" : "https://api.github.com/users/gapeman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gapeman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gapeman",
         "id" : 42591821,
         "login" : "gapeman",
         "node_id" : "MDQ6VXNlcjQyNTkxODIx",
         "organizations_url" : "https://api.github.com/users/gapeman/orgs",
         "received_events_url" : "https://api.github.com/users/gapeman/received_events",
         "repos_url" : "https://api.github.com/users/gapeman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gapeman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gapeman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gapeman"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@gapeman afaik that was the behavior before #16248 (which was not supposed to change existing behavior).\r\n\r\n@NicolasDorier would be nice to have a test for this.",
      "created_at" : "2019-08-15T10:52:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16618#issuecomment-521601527",
      "id" : 521601527,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16618",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMTYwMTUyNw==",
      "updated_at" : "2019-08-15T10:53:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/521601527",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@gapeman if your config specifically say that you don't want to ban a peer, then it should not be banned.\r\n\r\nAs @Sjors says, I just want to keep current behavior working as before.\r\n\r\nI can take a look to see if I can make a test for that.",
      "created_at" : "2019-08-15T13:12:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16618#issuecomment-521635542",
      "id" : 521635542,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16618",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMTYzNTU0Mg==",
      "updated_at" : "2019-08-15T13:12:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/521635542",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I refactored it to properly scope some variables. Writing a test so such regression can't happen.",
      "created_at" : "2019-08-15T13:28:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16618#issuecomment-521640563",
      "id" : 521640563,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16618",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMTY0MDU2Mw==",
      "updated_at" : "2019-08-15T13:28:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/521640563",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Fixed the bug, and added an anti regression test for `setban`",
      "created_at" : "2019-08-15T14:02:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16618#issuecomment-521652289",
      "id" : 521652289,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16618",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMTY1MjI4OQ==",
      "updated_at" : "2019-08-15T14:02:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/521652289",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "utACK a0d2e2b",
      "created_at" : "2019-08-15T14:08:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16618#issuecomment-521654132",
      "id" : 521654132,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16618",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMTY1NDEzMg==",
      "updated_at" : "2019-08-15T14:08:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/521654132",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16618#discussion_r314326784"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16618"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314326784"
         }
      },
      "author_association" : "MEMBER",
      "body" : "test/functional/rpc_setban.py:7:1: F401 'test_framework.test_node.ErrorMatch' imported but unused\r\n\r\ntest/functional/rpc_setban.py:39:78: F821 undefined name 'p'\r\n\r\ntest/functional/rpc_setban.py:41:75: F821 undefined name 'p'",
      "commit_id" : "b3e2a6e73eb2dab50e4bf9a1af966f03a4a14dad",
      "created_at" : "2019-08-15T14:14:26Z",
      "diff_hunk" : "@@ -0,0 +1,44 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2015-2019 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test the setban rpc call.\"\"\"\n+\n+from test_framework.test_node import ErrorMatch",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16618#discussion_r314326784",
      "id" : 314326784,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDMyNjc4NA==",
      "original_commit_id" : "a0d2e2b1bd5d44f18eb3865e657c67efd0111a3f",
      "original_position" : 7,
      "path" : "test/functional/rpc_setban.py",
      "position" : null,
      "pull_request_review_id" : 275452633,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16618",
      "updated_at" : "2019-08-15T15:16:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314326784",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16618#discussion_r314330783"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16618"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314330783"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe pass node in directly and split into `assert_has_permission(self, node, permission)` and `assert_has_no_permission(self, node, permission)` ",
      "commit_id" : "b3e2a6e73eb2dab50e4bf9a1af966f03a4a14dad",
      "created_at" : "2019-08-15T14:23:19Z",
      "diff_hunk" : "@@ -0,0 +1,44 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2015-2019 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test the setban rpc call.\"\"\"\n+\n+from test_framework.test_node import ErrorMatch\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    connect_nodes\n+)\n+\n+class SetBanTests(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+        self.setup_clean_chain = True\n+        self.extra_args = [[],[]]\n+\n+    def run_test(self):\n+        # Node 0 connects to Node 1\n+        self.assert_has_permission('noban', False)\n+        # Node 0 get banned by Node 1\n+        self.nodes[1].setban(\"127.0.0.1\", \"add\")\n+        # Node 1 should not be able to reconnect\n+        self.restart_node(1, [])\n+        connect_nodes(self.nodes[0], 1)\n+        peerinfo = self.nodes[1].getpeerinfo()\n+        assert_equal(0, len(peerinfo))\n+        # Node 1 should be able to reconnect if it has noban permission\n+        self.restart_node(1, ['-whitelist=127.0.0.1'])\n+        connect_nodes(self.nodes[0], 1)\n+        self.assert_has_permission('noban', True)\n+\n+    def assert_has_permission(self, permission, contains):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16618#discussion_r314330783",
      "id" : 314330783,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDMzMDc4Mw==",
      "original_commit_id" : "a0d2e2b1bd5d44f18eb3865e657c67efd0111a3f",
      "original_position" : 35,
      "path" : "test/functional/rpc_setban.py",
      "position" : 34,
      "pull_request_review_id" : 275457822,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16618",
      "updated_at" : "2019-08-15T15:16:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314330783",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16618#discussion_r314359274"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16618"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314359274"
         }
      },
      "author_association" : "MEMBER",
      "body" : "what about `assert_equal(True, self.hasPermision(...))` ?\r\n\r\nThat said, I don't think it should pass the nodes to this method. It is confusing (there is two nodes: the node that is permissioned, and the node on which we want to check permissions).",
      "commit_id" : "b3e2a6e73eb2dab50e4bf9a1af966f03a4a14dad",
      "created_at" : "2019-08-15T15:18:07Z",
      "diff_hunk" : "@@ -0,0 +1,44 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2015-2019 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test the setban rpc call.\"\"\"\n+\n+from test_framework.test_node import ErrorMatch\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    connect_nodes\n+)\n+\n+class SetBanTests(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+        self.setup_clean_chain = True\n+        self.extra_args = [[],[]]\n+\n+    def run_test(self):\n+        # Node 0 connects to Node 1\n+        self.assert_has_permission('noban', False)\n+        # Node 0 get banned by Node 1\n+        self.nodes[1].setban(\"127.0.0.1\", \"add\")\n+        # Node 1 should not be able to reconnect\n+        self.restart_node(1, [])\n+        connect_nodes(self.nodes[0], 1)\n+        peerinfo = self.nodes[1].getpeerinfo()\n+        assert_equal(0, len(peerinfo))\n+        # Node 1 should be able to reconnect if it has noban permission\n+        self.restart_node(1, ['-whitelist=127.0.0.1'])\n+        connect_nodes(self.nodes[0], 1)\n+        self.assert_has_permission('noban', True)\n+\n+    def assert_has_permission(self, permission, contains):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16618#discussion_r314359274",
      "id" : 314359274,
      "in_reply_to_id" : 314330783,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDM1OTI3NA==",
      "original_commit_id" : "a0d2e2b1bd5d44f18eb3865e657c67efd0111a3f",
      "original_position" : 35,
      "path" : "test/functional/rpc_setban.py",
      "position" : 34,
      "pull_request_review_id" : 275493435,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16618",
      "updated_at" : "2019-08-15T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314359274",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16618#discussion_r314388627"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16618"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314388627"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`assert(self.hasPermision(...))` is even simpler.\r\n\r\nYou could pass both nodes. Or you could document at the top of the test file which hardcoded nodes do what.",
      "commit_id" : "b3e2a6e73eb2dab50e4bf9a1af966f03a4a14dad",
      "created_at" : "2019-08-15T16:19:54Z",
      "diff_hunk" : "@@ -0,0 +1,44 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2015-2019 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test the setban rpc call.\"\"\"\n+\n+from test_framework.test_node import ErrorMatch\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    connect_nodes\n+)\n+\n+class SetBanTests(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+        self.setup_clean_chain = True\n+        self.extra_args = [[],[]]\n+\n+    def run_test(self):\n+        # Node 0 connects to Node 1\n+        self.assert_has_permission('noban', False)\n+        # Node 0 get banned by Node 1\n+        self.nodes[1].setban(\"127.0.0.1\", \"add\")\n+        # Node 1 should not be able to reconnect\n+        self.restart_node(1, [])\n+        connect_nodes(self.nodes[0], 1)\n+        peerinfo = self.nodes[1].getpeerinfo()\n+        assert_equal(0, len(peerinfo))\n+        # Node 1 should be able to reconnect if it has noban permission\n+        self.restart_node(1, ['-whitelist=127.0.0.1'])\n+        connect_nodes(self.nodes[0], 1)\n+        self.assert_has_permission('noban', True)\n+\n+    def assert_has_permission(self, permission, contains):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16618#discussion_r314388627",
      "id" : 314388627,
      "in_reply_to_id" : 314330783,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDM4ODYyNw==",
      "original_commit_id" : "a0d2e2b1bd5d44f18eb3865e657c67efd0111a3f",
      "original_position" : 35,
      "path" : "test/functional/rpc_setban.py",
      "position" : 34,
      "pull_request_review_id" : 275529668,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16618",
      "updated_at" : "2019-08-15T16:19:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314388627",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16618#discussion_r314543190"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16618"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314543190"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sorry but I think you could just inline this - it's longer as it is with the `contains` arg.",
      "commit_id" : "b3e2a6e73eb2dab50e4bf9a1af966f03a4a14dad",
      "created_at" : "2019-08-16T00:02:39Z",
      "diff_hunk" : "@@ -0,0 +1,44 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2015-2019 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test the setban rpc call.\"\"\"\n+\n+from test_framework.test_node import ErrorMatch\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    connect_nodes\n+)\n+\n+class SetBanTests(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+        self.setup_clean_chain = True\n+        self.extra_args = [[],[]]\n+\n+    def run_test(self):\n+        # Node 0 connects to Node 1\n+        self.assert_has_permission('noban', False)\n+        # Node 0 get banned by Node 1\n+        self.nodes[1].setban(\"127.0.0.1\", \"add\")\n+        # Node 1 should not be able to reconnect\n+        self.restart_node(1, [])\n+        connect_nodes(self.nodes[0], 1)\n+        peerinfo = self.nodes[1].getpeerinfo()\n+        assert_equal(0, len(peerinfo))\n+        # Node 1 should be able to reconnect if it has noban permission\n+        self.restart_node(1, ['-whitelist=127.0.0.1'])\n+        connect_nodes(self.nodes[0], 1)\n+        self.assert_has_permission('noban', True)\n+\n+    def assert_has_permission(self, permission, contains):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16618#discussion_r314543190",
      "id" : 314543190,
      "in_reply_to_id" : 314330783,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDU0MzE5MA==",
      "original_commit_id" : "a0d2e2b1bd5d44f18eb3865e657c67efd0111a3f",
      "original_position" : 35,
      "path" : "test/functional/rpc_setban.py",
      "position" : 34,
      "pull_request_review_id" : 275725446,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16618",
      "updated_at" : "2019-08-16T00:05:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314543190",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "As @promag suggested, I instead just inlined the permission checked, it is actually more readable.\r\n\r\nI also check in the logs that we really prevent connection because of the ban. I also added a test to `setban x remove`.",
      "created_at" : "2019-08-16T04:19:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16618#issuecomment-521878304",
      "id" : 521878304,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16618",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMTg3ODMwNA==",
      "updated_at" : "2019-08-16T04:19:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/521878304",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@Sjors `rpc_setban` is the right name, I really want to test setban, so I added it in the whitelist of authorized term.",
      "created_at" : "2019-08-16T04:23:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16618#issuecomment-521878935",
      "id" : 521878935,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16618",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMTg3ODkzNQ==",
      "updated_at" : "2019-08-16T04:23:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/521878935",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Agree inline is more clear. utACK d117f45",
      "created_at" : "2019-08-16T08:22:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16618#issuecomment-521929475",
      "id" : 521929475,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16618",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMTkyOTQ3NQ==",
      "updated_at" : "2019-08-16T08:22:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/521929475",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK d117f4541d4717e83c9396273e92960723622030\r\n\r\n<details><summary>Show signature and timestamp</summary>\r\n\r\nSignature:\r\n\r\n```\r\n-----BEGIN PGP SIGNED MESSAGE-----\r\nHash: SHA512\r\n\r\nACK d117f4541d4717e83c9396273e92960723622030\r\n-----BEGIN PGP SIGNATURE-----\r\n\r\niQGzBAEBCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\r\npUin2gv9GZKDSUbn62676zj0G6Igb8tzgC2M1Sf2KyEuIR+heCoVYGlyp3rXDbuc\r\n22c5dyDXDnktsyMR3mwo3KLzT/MBY/wc8nDgdzkRUzWt6j+/q8Ex8NTnfbgyGXzr\r\nvBE3bJOfA1y3DCCzpSar4uU/sPUAK+oJ3qF1+62rijDYpC0Jh1UaYMy7AdYQdYQ/\r\nkyO3jorAiwIk0sE7SzJDq3rE7wlHzQ4LCZauCnVft/Y1rOY1IkmYfke3uapR4EVr\r\nZw7D40jY6RsEDLNh/1odaRqjm01v1uJ5d7mFnqOFCKA7RwdS2NQ0ElbfQ3fAUowm\r\nV7Oola76XE8OvGsj9y+qOwBkX5iMgeNQANb+Pf6poB0ANDh0AKpIkxjSIGGbhKi2\r\nXN9KGRaHLpNBeU69lQDrvsXEzyfl4kSLyO9/k7+qZAtgUTqyLDhi9beqS9Ta0OKF\r\nX7RHymgGIn1zvTOY4WSoPiHIF5ceVDu9S5r/fxr9DHmwPWWEzOE9ztfcSiQw68tY\r\nHRrWUvc+\r\n=qI3j\r\n-----END PGP SIGNATURE-----\r\n```\r\n\r\n[Timestamp of file with hash `74a14b73630691da8ffa64e5b597d7fd7246787327bba54579da5c03c881ec01  -`](https://opentimestamps.org/info/?004f70656e54696d657374616d7073000050726f6f6600bf89e2e884e89294010874a14b73630691da8ffa64e5b597d7fd7246787327bba54579da5c03c881ec01f01043219eeffe1ae9a1026ee48a3dd50b9308fff01010030cd40044e4372cb6d2446292049608f020f11ddc7314ce1f42373e025745cf37f58ab5434f875df973797c6bc7f768a88a08f1045d56b8e1f0088dbe7bdd983eab1a0083dfe30d2ef90c8e2c2b68747470733a2f2f626f622e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267fff01019f975197112f255b780d679cad9efc208f1045d56b8e0f00883cdfc66b55a8b5b0083dfe30d2ef90c8e2e2d68747470733a2f2f616c6963652e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267fff0102e30f02eece966fef2a0c783189e008908f1045d56b8e0f008182705ebec4d87280083dfe30d2ef90c8e292868747470733a2f2f66696e6e65792e63616c656e6461722e657465726e69747977616c6c2e636f6df0105f28dc7979c351e16ded943d6a738b2e08f1045d56b8e0f008952e9f3fb11641920083dfe30d2ef90c8e232268747470733a2f2f6274632e63616c656e6461722e636174616c6c6178792e636f6d)\r\n\r\n</details>\r\n",
      "created_at" : "2019-08-16T14:09:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16618#issuecomment-522022047",
      "id" : 522022047,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16618",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMjAyMjA0Nw==",
      "updated_at" : "2019-08-16T14:09:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/522022047",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
