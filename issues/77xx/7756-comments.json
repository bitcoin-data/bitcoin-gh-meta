[
   {
      "author_association" : "MEMBER",
      "body" : "Travis fail is unrelated (https://github.com/bitcoin/bitcoin/issues/7470#issuecomment-202332354), respinning.\n",
      "created_at" : "2016-03-31T09:12:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7756#issuecomment-203838086",
      "id" : 203838086,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7756",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDIwMzgzODA4Ng==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/203838086/reactions"
      },
      "updated_at" : "2016-03-31T09:12:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/203838086",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased\n",
      "created_at" : "2016-04-06T11:05:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7756#issuecomment-206312054",
      "id" : 206312054,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7756",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDIwNjMxMjA1NA==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/206312054/reactions"
      },
      "updated_at" : "2016-04-06T11:05:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/206312054",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7756#discussion_r58687618"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7756"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/58687618"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Using NULL would be clearer as it's a pointer.\n",
      "commit_id" : "509cb006d514cece5ab7680094f033c8dc8a2318",
      "created_at" : "2016-04-06T11:10:23Z",
      "diff_hunk" : "@@ -45,7 +45,7 @@ bool CCoinsView::GetCoins(const uint256 &txid, CCoins &coins) const { return fal\n bool CCoinsView::HaveCoins(const uint256 &txid) const { return false; }\n uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n bool CCoinsView::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlock) { return false; }\n-bool CCoinsView::GetStats(CCoinsStats &stats) const { return false; }\n+CCoinsViewCursor *CCoinsView::Cursor() const { return 0; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7756#discussion_r58687618",
      "id" : 58687618,
      "line" : 48,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4Njg3NjE4",
      "original_commit_id" : "c1331def20f17405b28bd37176429b4cd9c8d189",
      "original_line" : null,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 5,
      "pull_request_review_id" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7756",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/58687618/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2016-04-15T14:33:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/58687618",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> - rpc: Add method gettxoutsetinfo2 that uses new Cursor method\n\nThat seems outdated.\n",
      "created_at" : "2016-04-06T11:28:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7756#issuecomment-206322046",
      "id" : 206322046,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7756",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDIwNjMyMjA0Ng==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/206322046/reactions"
      },
      "updated_at" : "2016-04-06T11:28:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/206322046",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> That seems outdated.\n\nYes, I've removed that in the rebase, I had multiple commits with two `getutxosetinfo` in an intermediate step but that was annoying to rebase over #7766.\n",
      "created_at" : "2016-04-06T12:02:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7756#issuecomment-206339906",
      "id" : 206339906,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7756",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDIwNjMzOTkwNg==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/206339906/reactions"
      },
      "updated_at" : "2016-04-06T12:02:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/206339906",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7756#discussion_r58692992"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7756"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/58692992"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Bjarne Stroustrup taught me not to use NULL in c++ code: http://www.stroustrup.com/bs_faq2.html#null\nI don't care deeply about this though.\n",
      "commit_id" : "509cb006d514cece5ab7680094f033c8dc8a2318",
      "created_at" : "2016-04-06T12:05:37Z",
      "diff_hunk" : "@@ -45,7 +45,7 @@ bool CCoinsView::GetCoins(const uint256 &txid, CCoins &coins) const { return fal\n bool CCoinsView::HaveCoins(const uint256 &txid) const { return false; }\n uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n bool CCoinsView::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlock) { return false; }\n-bool CCoinsView::GetStats(CCoinsStats &stats) const { return false; }\n+CCoinsViewCursor *CCoinsView::Cursor() const { return 0; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7756#discussion_r58692992",
      "id" : 58692992,
      "line" : 48,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NjkyOTky",
      "original_commit_id" : "c1331def20f17405b28bd37176429b4cd9c8d189",
      "original_line" : null,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 5,
      "pull_request_review_id" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7756",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/58692992/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2016-04-15T14:33:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/58692992",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7756#discussion_r58718514"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7756"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/58718514"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Interesting. Comment retracted.\n",
      "commit_id" : "509cb006d514cece5ab7680094f033c8dc8a2318",
      "created_at" : "2016-04-06T14:49:25Z",
      "diff_hunk" : "@@ -45,7 +45,7 @@ bool CCoinsView::GetCoins(const uint256 &txid, CCoins &coins) const { return fal\n bool CCoinsView::HaveCoins(const uint256 &txid) const { return false; }\n uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n bool CCoinsView::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlock) { return false; }\n-bool CCoinsView::GetStats(CCoinsStats &stats) const { return false; }\n+CCoinsViewCursor *CCoinsView::Cursor() const { return 0; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7756#discussion_r58718514",
      "id" : 58718514,
      "line" : 48,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NzE4NTE0",
      "original_commit_id" : "c1331def20f17405b28bd37176429b4cd9c8d189",
      "original_line" : null,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 5,
      "pull_request_review_id" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7756",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/58718514/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2016-04-15T14:33:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/58718514",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7756#discussion_r58719141"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7756"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/58719141"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This should never loop more than once, I think? Seems that the loop here could hide potential problems.\n",
      "commit_id" : "509cb006d514cece5ab7680094f033c8dc8a2318",
      "created_at" : "2016-04-06T14:52:32Z",
      "diff_hunk" : "@@ -94,50 +94,53 @@ bool CBlockTreeDB::ReadLastBlockFile(int &nFile) {\n     return Read(DB_LAST_BLOCK, nFile);\n }\n \n-bool CCoinsViewDB::GetStats(CCoinsStats &stats) const {\n+CCoinsViewCursor *CCoinsViewDB::Cursor() const\n+{\n+    CCoinsViewDBCursor *i = new CCoinsViewDBCursor(const_cast<CDBWrapper*>(&db)->NewIterator(), GetBestBlock());\n     /* It seems that there are no \"const iterators\" for LevelDB.  Since we\n        only need read operations on it, use a const-cast to get around\n        that restriction.  */\n-    boost::scoped_ptr<CDBIterator> pcursor(const_cast<CDBWrapper*>(&db)->NewIterator());\n-    pcursor->Seek(DB_COINS);\n+    i->pcursor->Seek(DB_COINS);\n+    // Cache key of first record\n+    i->pcursor->GetKey(i->keyTmp);\n+    return i;\n+}\n \n-    CHashWriter ss(SER_GETHASH, PROTOCOL_VERSION);\n-    stats.hashBlock = GetBestBlock();\n-    ss << stats.hashBlock;\n-    CAmount nTotalAmount = 0;\n-    while (pcursor->Valid()) {\n-        boost::this_thread::interruption_point();\n-        std::pair<char, uint256> key;\n-        CCoins coins;\n-        if (pcursor->GetKey(key) && key.first == DB_COINS) {\n-            if (pcursor->GetValue(coins)) {\n-                stats.nTransactions++;\n-                for (unsigned int i=0; i<coins.vout.size(); i++) {\n-                    const CTxOut &out = coins.vout[i];\n-                    if (!out.IsNull()) {\n-                        stats.nTransactionOutputs++;\n-                        ss << VARINT(i+1);\n-                        ss << out;\n-                        nTotalAmount += out.nValue;\n-                    }\n-                }\n-                stats.nSerializedSize += 32 + pcursor->GetValueSize();\n-                ss << VARINT(0);\n-            } else {\n-                return error(\"CCoinsViewDB::GetStats() : unable to read value\");\n-            }\n-        } else {\n-            break;\n-        }\n-        pcursor->Next();\n+bool CCoinsViewDBCursor::GetKey(uint256 &key) const\n+{\n+    // Return cached key\n+    if (keyTmp.first == DB_COINS) {\n+        key = keyTmp.second;\n+        return true;\n     }\n-    {\n-        LOCK(cs_main);\n-        stats.nHeight = mapBlockIndex.find(stats.hashBlock)->second->nHeight;\n+    return false;\n+}\n+\n+bool CCoinsViewDBCursor::GetValue(CCoins &coins) const\n+{\n+    return pcursor->GetValue(coins);\n+}\n+\n+unsigned int CCoinsViewDBCursor::GetValueSize() const\n+{\n+    return pcursor->GetValueSize();\n+}\n+\n+bool CCoinsViewDBCursor::Valid() const\n+{\n+    return pcursor->Valid();\n+}\n+\n+void CCoinsViewDBCursor::Next()\n+{\n+    while (true) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7756#discussion_r58719141",
      "id" : 58719141,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NzE5MTQx",
      "original_commit_id" : "eacf28cb382a9cac92981c2d8389a00468d9a42d",
      "original_line" : null,
      "original_position" : 78,
      "original_start_line" : null,
      "path" : "src/txdb.cpp",
      "position" : null,
      "pull_request_review_id" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7756",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/58719141/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2016-04-15T14:33:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/58719141",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7756#discussion_r58719259"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7756"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/58719259"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Unreachable code?\n",
      "commit_id" : "509cb006d514cece5ab7680094f033c8dc8a2318",
      "created_at" : "2016-04-06T14:53:08Z",
      "diff_hunk" : "@@ -94,50 +94,53 @@ bool CBlockTreeDB::ReadLastBlockFile(int &nFile) {\n     return Read(DB_LAST_BLOCK, nFile);\n }\n \n-bool CCoinsViewDB::GetStats(CCoinsStats &stats) const {\n+CCoinsViewCursor *CCoinsViewDB::Cursor() const\n+{\n+    CCoinsViewDBCursor *i = new CCoinsViewDBCursor(const_cast<CDBWrapper*>(&db)->NewIterator(), GetBestBlock());\n     /* It seems that there are no \"const iterators\" for LevelDB.  Since we\n        only need read operations on it, use a const-cast to get around\n        that restriction.  */\n-    boost::scoped_ptr<CDBIterator> pcursor(const_cast<CDBWrapper*>(&db)->NewIterator());\n-    pcursor->Seek(DB_COINS);\n+    i->pcursor->Seek(DB_COINS);\n+    // Cache key of first record\n+    i->pcursor->GetKey(i->keyTmp);\n+    return i;\n+}\n \n-    CHashWriter ss(SER_GETHASH, PROTOCOL_VERSION);\n-    stats.hashBlock = GetBestBlock();\n-    ss << stats.hashBlock;\n-    CAmount nTotalAmount = 0;\n-    while (pcursor->Valid()) {\n-        boost::this_thread::interruption_point();\n-        std::pair<char, uint256> key;\n-        CCoins coins;\n-        if (pcursor->GetKey(key) && key.first == DB_COINS) {\n-            if (pcursor->GetValue(coins)) {\n-                stats.nTransactions++;\n-                for (unsigned int i=0; i<coins.vout.size(); i++) {\n-                    const CTxOut &out = coins.vout[i];\n-                    if (!out.IsNull()) {\n-                        stats.nTransactionOutputs++;\n-                        ss << VARINT(i+1);\n-                        ss << out;\n-                        nTotalAmount += out.nValue;\n-                    }\n-                }\n-                stats.nSerializedSize += 32 + pcursor->GetValueSize();\n-                ss << VARINT(0);\n-            } else {\n-                return error(\"CCoinsViewDB::GetStats() : unable to read value\");\n-            }\n-        } else {\n-            break;\n-        }\n-        pcursor->Next();\n+bool CCoinsViewDBCursor::GetKey(uint256 &key) const\n+{\n+    // Return cached key\n+    if (keyTmp.first == DB_COINS) {\n+        key = keyTmp.second;\n+        return true;\n     }\n-    {\n-        LOCK(cs_main);\n-        stats.nHeight = mapBlockIndex.find(stats.hashBlock)->second->nHeight;\n+    return false;\n+}\n+\n+bool CCoinsViewDBCursor::GetValue(CCoins &coins) const\n+{\n+    return pcursor->GetValue(coins);\n+}\n+\n+unsigned int CCoinsViewDBCursor::GetValueSize() const\n+{\n+    return pcursor->GetValueSize();\n+}\n+\n+bool CCoinsViewDBCursor::Valid() const\n+{\n+    return pcursor->Valid();\n+}\n+\n+void CCoinsViewDBCursor::Next()\n+{\n+    while (true) {\n+        pcursor->Next();\n+        if (!pcursor->Valid())\n+            return;\n+        if (pcursor->GetKey(keyTmp) && keyTmp.first == DB_COINS)\n+            return;\n     }\n-    stats.hashSerialized = ss.GetHash();\n-    stats.nTotalAmount = nTotalAmount;\n-    return true;\n+    keyTmp.first = 0; // Invalidate cached key after last record so that GetKey() returns false",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7756#discussion_r58719259",
      "id" : 58719259,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NzE5MjU5",
      "original_commit_id" : "eacf28cb382a9cac92981c2d8389a00468d9a42d",
      "original_line" : null,
      "original_position" : 88,
      "original_start_line" : null,
      "path" : "src/txdb.cpp",
      "position" : null,
      "pull_request_review_id" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7756",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/58719259/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2016-04-15T14:33:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/58719259",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7756#discussion_r59012843"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7756"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/59012843"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Right, there can't be holes between DB_COINS records, will change this loop.\n",
      "commit_id" : "509cb006d514cece5ab7680094f033c8dc8a2318",
      "created_at" : "2016-04-08T11:42:14Z",
      "diff_hunk" : "@@ -94,50 +94,53 @@ bool CBlockTreeDB::ReadLastBlockFile(int &nFile) {\n     return Read(DB_LAST_BLOCK, nFile);\n }\n \n-bool CCoinsViewDB::GetStats(CCoinsStats &stats) const {\n+CCoinsViewCursor *CCoinsViewDB::Cursor() const\n+{\n+    CCoinsViewDBCursor *i = new CCoinsViewDBCursor(const_cast<CDBWrapper*>(&db)->NewIterator(), GetBestBlock());\n     /* It seems that there are no \"const iterators\" for LevelDB.  Since we\n        only need read operations on it, use a const-cast to get around\n        that restriction.  */\n-    boost::scoped_ptr<CDBIterator> pcursor(const_cast<CDBWrapper*>(&db)->NewIterator());\n-    pcursor->Seek(DB_COINS);\n+    i->pcursor->Seek(DB_COINS);\n+    // Cache key of first record\n+    i->pcursor->GetKey(i->keyTmp);\n+    return i;\n+}\n \n-    CHashWriter ss(SER_GETHASH, PROTOCOL_VERSION);\n-    stats.hashBlock = GetBestBlock();\n-    ss << stats.hashBlock;\n-    CAmount nTotalAmount = 0;\n-    while (pcursor->Valid()) {\n-        boost::this_thread::interruption_point();\n-        std::pair<char, uint256> key;\n-        CCoins coins;\n-        if (pcursor->GetKey(key) && key.first == DB_COINS) {\n-            if (pcursor->GetValue(coins)) {\n-                stats.nTransactions++;\n-                for (unsigned int i=0; i<coins.vout.size(); i++) {\n-                    const CTxOut &out = coins.vout[i];\n-                    if (!out.IsNull()) {\n-                        stats.nTransactionOutputs++;\n-                        ss << VARINT(i+1);\n-                        ss << out;\n-                        nTotalAmount += out.nValue;\n-                    }\n-                }\n-                stats.nSerializedSize += 32 + pcursor->GetValueSize();\n-                ss << VARINT(0);\n-            } else {\n-                return error(\"CCoinsViewDB::GetStats() : unable to read value\");\n-            }\n-        } else {\n-            break;\n-        }\n-        pcursor->Next();\n+bool CCoinsViewDBCursor::GetKey(uint256 &key) const\n+{\n+    // Return cached key\n+    if (keyTmp.first == DB_COINS) {\n+        key = keyTmp.second;\n+        return true;\n     }\n-    {\n-        LOCK(cs_main);\n-        stats.nHeight = mapBlockIndex.find(stats.hashBlock)->second->nHeight;\n+    return false;\n+}\n+\n+bool CCoinsViewDBCursor::GetValue(CCoins &coins) const\n+{\n+    return pcursor->GetValue(coins);\n+}\n+\n+unsigned int CCoinsViewDBCursor::GetValueSize() const\n+{\n+    return pcursor->GetValueSize();\n+}\n+\n+bool CCoinsViewDBCursor::Valid() const\n+{\n+    return pcursor->Valid();\n+}\n+\n+void CCoinsViewDBCursor::Next()\n+{\n+    while (true) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7756#discussion_r59012843",
      "id" : 59012843,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MDEyODQz",
      "original_commit_id" : "eacf28cb382a9cac92981c2d8389a00468d9a42d",
      "original_line" : null,
      "original_position" : 78,
      "original_start_line" : null,
      "path" : "src/txdb.cpp",
      "position" : null,
      "pull_request_review_id" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7756",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/59012843/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2016-04-15T14:33:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/59012843",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Pushed a commit that should address @sipa's comment: get rid of loop, no more chance of hiding failures.\n",
      "created_at" : "2016-04-09T08:14:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7756#issuecomment-207743050",
      "id" : 207743050,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7756",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDIwNzc0MzA1MA==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/207743050/reactions"
      },
      "updated_at" : "2016-04-09T08:14:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/207743050",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 299fad9\n",
      "created_at" : "2016-04-12T17:59:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7756#issuecomment-209031021",
      "id" : 209031021,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7756",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDIwOTAzMTAyMQ==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/209031021/reactions"
      },
      "updated_at" : "2016-04-12T17:59:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/209031021",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Squashed eacf28c 299fad9 into 509cb00\n",
      "created_at" : "2016-04-15T14:33:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7756#issuecomment-210484541",
      "id" : 210484541,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7756",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDIxMDQ4NDU0MQ==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/210484541/reactions"
      },
      "updated_at" : "2016-04-15T14:33:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/210484541",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
