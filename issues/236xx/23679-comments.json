[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Or should I rather validate port directly in addpeeraddress() and just ignore the -0 case?\r\n\r\n~~I think it can be ignored. Tried using `-0` in few other arguments for other RPC and it is considered as `0`. I could not find a way to read `peers.dat` however this observation is based on usage of negative zero in other parameters.~~\r\n\r\nBased on reading few posts like https://softwareengineering.stackexchange.com/questions/280648/why-is-negative-zero-important it could be an issue in some cases ~~but not here I guess.I have no opinion on this because I couldn't do anything interesting with `-0` in `addpeeraddress`~~\r\n\r\n@amadeuszpawlik  I tried using port `-0` in `addnode` and it adds negative zero in the port, I am assuming similar thing would happen with `addpeeraddress` so: \r\n\r\n**Concept ACK** for this PR and maybe we need to make changes for few other RPC",
      "created_at" : "2021-12-07T23:10:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23679#issuecomment-988329017",
      "id" : 988329017,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23679",
      "node_id" : "IC_kwDOABII58466LQ5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/988329017/reactions"
      },
      "updated_at" : "2021-12-08T10:50:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/988329017",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@prayank23 good find with `addnode` (although in that particular command the port is specified in an address string, so this wouldn't fix it). It looks like `-0` is not the only case that `addnode` accepts.\r\nThe modded `SplitHostPort` I propose in #22087 would definitely be nice here for port validation.\r\nI'll go trough other RPCs and add validation for them too.\r\n\r\nMy question still stands, is modifying `univalue` a valid approach for commands that currently use `int` for port value, or do I ignore the `-0` case and simply validate directly in `net.cpp`?",
      "created_at" : "2021-12-12T14:12:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23679#issuecomment-991905585",
      "id" : 991905585,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23679",
      "node_id" : "IC_kwDOABII5847H0cx",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/991905585/reactions"
      },
      "updated_at" : "2021-12-12T14:13:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/991905585",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/35263201?v=4",
         "events_url" : "https://api.github.com/users/amadeuszpawlik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amadeuszpawlik/followers",
         "following_url" : "https://api.github.com/users/amadeuszpawlik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amadeuszpawlik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amadeuszpawlik",
         "id" : 35263201,
         "login" : "amadeuszpawlik",
         "node_id" : "MDQ6VXNlcjM1MjYzMjAx",
         "organizations_url" : "https://api.github.com/users/amadeuszpawlik/orgs",
         "received_events_url" : "https://api.github.com/users/amadeuszpawlik/received_events",
         "repos_url" : "https://api.github.com/users/amadeuszpawlik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amadeuszpawlik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amadeuszpawlik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amadeuszpawlik"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#25095](https://github.com/bitcoin/bitcoin/pull/25095) (rpc: Fix implicit-integer-sign-change in gettxout by MarcoFalke)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-05-11T15:27:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23679#issuecomment-1123929957",
      "id" : 1123929957,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23679",
      "node_id" : "IC_kwDOABII585C_c9l",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1123929957/reactions"
      },
      "updated_at" : "2022-05-11T15:27:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1123929957",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-05-13T09:56:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23679#issuecomment-1125868261",
      "id" : 1125868261,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23679",
      "node_id" : "IC_kwDOABII585DG2Ll",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1125868261/reactions"
      },
      "updated_at" : "2022-05-13T09:56:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1125868261",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23679#discussion_r872218946"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23679"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/872218946"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    const auto port{request.params[1].getInt<uint16_t>()};\r\n```\r\n\r\non master this is now trivial to implement in a one-line diff",
      "commit_id" : "0f72ddfbe561f697cad8384066cda8cf5e88ec96",
      "created_at" : "2022-05-13T10:09:48Z",
      "diff_hunk" : "@@ -943,7 +943,7 @@ static RPCHelpMan addpeeraddress()\n     }\n \n     const std::string& addr_string{request.params[0].get_str()};\n-    const uint16_t port{static_cast<uint16_t>(request.params[1].get_int())};\n+    const uint16_t& port{request.params[1].get_uint16()};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23679#discussion_r872218946",
      "id" : 872218946,
      "line" : 946,
      "node_id" : "PRRC_kwDOABII584z_QFC",
      "original_commit_id" : "0f72ddfbe561f697cad8384066cda8cf5e88ec96",
      "original_line" : 946,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : 5,
      "pull_request_review_id" : 972022743,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23679",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/872218946/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-13T10:09:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/872218946",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
