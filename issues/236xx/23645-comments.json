[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK\r\n\r\nThanks for reporting! I think we definitely don't want users to avoid updating to new versions due to RPC calls performing significantly worse, i.e. I'd agree that this needs to be fixed (unless there is a really good reason not to). I vaguely remember having reviewed this PR at that time (more than two years ago), obviously neither me nor other reviewers were aware that this could affect the performance -- in a strict sense this PR should not have been labelled as \"refactoring\". Will take a deeper look within the next days.\r\n\r\nTo reproduce the issue easier, would you mind sharing what is a \"big wallet\" in your use-case, in terms of order of magnitude of number of transactions/addresses in the wallet? Also do you have concrete numbers on taking \"notably longer\"?",
      "created_at" : "2021-12-03T12:58:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/23645#issuecomment-985497923",
      "id" : 985497923,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23645",
      "node_id" : "IC_kwDOABII5846vYFD",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/985497923/reactions"
      },
      "updated_at" : "2021-12-03T12:58:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/985497923",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> To reproduce the issue easier, would you mind sharing what is a \"big wallet\" in your use-case, in terms of order of magnitude of number of transactions/addresses in the wallet? Also do you have concrete numbers on taking \"notably longer\"?\r\n\r\nWe are using some test files that contain ~ 10k - 100k transactions of different types.\r\nThey are part of a highly integrated testing environment with deeply predefined hardware where we issue a large number  of requests at a high frequency via rpc. I can't give you exact numbers on \"notably longer\" since our setup operates on a pass/fail basis, but it was for sure more than factor of 5, probably even 10.\r\n\r\nSince we have been running through a lot of trouble due changes like this, we are generally quite slow with following updates of Bitcoin Core, unfortunately. The problem is that once these requests clog up, Bitcoin Core becomes unresponsive altogether, which would be catastrophic in our prod env. Of course, we also have other measures to avoid this, but we want to ensure this not to be a bottleneck in any case.\r\n\r\nI am not an expert on how feasible such a testing setup is for a project like Bitcoin Core, but it would be helpful if the most common rpc requests had automatic test cases in terms of performance. This could help spot and discuss potential severe degradations already at the PR-merge stage and would save some downstream effort. Not talking about corner cases here, but things like getting the amount of received coins for an address should be as responsive as possible.",
      "created_at" : "2021-12-04T23:46:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/23645#issuecomment-986136696",
      "id" : 986136696,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23645",
      "node_id" : "IC_kwDOABII5846x0B4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/986136696/reactions"
      },
      "updated_at" : "2021-12-04T23:46:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/986136696",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/95378531?v=4",
         "events_url" : "https://api.github.com/users/beegater/events{/privacy}",
         "followers_url" : "https://api.github.com/users/beegater/followers",
         "following_url" : "https://api.github.com/users/beegater/following{/other_user}",
         "gists_url" : "https://api.github.com/users/beegater/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/beegater",
         "id" : 95378531,
         "login" : "beegater",
         "node_id" : "U_kgDOBa9cYw",
         "organizations_url" : "https://api.github.com/users/beegater/orgs",
         "received_events_url" : "https://api.github.com/users/beegater/received_events",
         "repos_url" : "https://api.github.com/users/beegater/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/beegater/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/beegater/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/beegater"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "There are benchmarks (https://github.com/bitcoin/bitcoin/blob/master/src/bench/wallet_balance.cpp), but they currently don't fail CI when the performance drops.\r\n\r\nImprovements are welcome.",
      "created_at" : "2021-12-06T09:13:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/23645#issuecomment-986581858",
      "id" : 986581858,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23645",
      "node_id" : "IC_kwDOABII5846zgti",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/986581858/reactions"
      },
      "updated_at" : "2021-12-06T09:13:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/986581858",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "`listunspent` took a very long when i had 2000 UTXOs (on testnet, i was filling blocks there :))\r\nis it possible to speed up `listunspent` as well?",
      "created_at" : "2021-12-15T15:59:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/23645#issuecomment-994928441",
      "id" : 994928441,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23645",
      "node_id" : "IC_kwDOABII5847TWc5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/994928441/reactions"
      },
      "updated_at" : "2021-12-15T15:59:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/994928441",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/49868160?v=4",
         "events_url" : "https://api.github.com/users/antonilol/events{/privacy}",
         "followers_url" : "https://api.github.com/users/antonilol/followers",
         "following_url" : "https://api.github.com/users/antonilol/following{/other_user}",
         "gists_url" : "https://api.github.com/users/antonilol/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/antonilol",
         "id" : 49868160,
         "login" : "antonilol",
         "node_id" : "MDQ6VXNlcjQ5ODY4MTYw",
         "organizations_url" : "https://api.github.com/users/antonilol/orgs",
         "received_events_url" : "https://api.github.com/users/antonilol/received_events",
         "repos_url" : "https://api.github.com/users/antonilol/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/antonilol/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/antonilol/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/antonilol"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I confirm the issue. I'm trying \r\n`time bitcoin-cli getreceivedbyaddress SOMEADDRESS 7`\r\nand results are\r\n0m0.016s - bitcoin core 0.20.1\r\n0m0.786s - bitcoin core 0.21.2\r\n0m1.934s - bitcoin core 22.0 - absolutely impossible timing for us\r\n\r\nWe have 1758 transactions and 1715 addresses.\r\n\r\nI'm using binary version x86_64-linux from https://bitcoincore.org/bin/bitcoin-core-22.0/ on host with Debian Stretch",
      "created_at" : "2022-02-22T10:25:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/23645#issuecomment-1047645534",
      "id" : 1047645534,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23645",
      "node_id" : "IC_kwDOABII584-cc1e",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1047645534/reactions"
      },
      "updated_at" : "2022-02-22T10:33:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1047645534",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/9906715?v=4",
         "events_url" : "https://api.github.com/users/iprok/events{/privacy}",
         "followers_url" : "https://api.github.com/users/iprok/followers",
         "following_url" : "https://api.github.com/users/iprok/following{/other_user}",
         "gists_url" : "https://api.github.com/users/iprok/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/iprok",
         "id" : 9906715,
         "login" : "iprok",
         "node_id" : "MDQ6VXNlcjk5MDY3MTU=",
         "organizations_url" : "https://api.github.com/users/iprok/orgs",
         "received_events_url" : "https://api.github.com/users/iprok/received_events",
         "repos_url" : "https://api.github.com/users/iprok/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/iprok/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/iprok/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/iprok"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@theStack hello, excuse me for bothering you, but are any news or plans here?",
      "created_at" : "2022-04-27T07:34:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/23645#issuecomment-1110650011",
      "id" : 1110650011,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23645",
      "node_id" : "IC_kwDOABII585CMyyb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1110650011/reactions"
      },
      "updated_at" : "2022-04-27T07:34:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1110650011",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/9906715?v=4",
         "events_url" : "https://api.github.com/users/iprok/events{/privacy}",
         "followers_url" : "https://api.github.com/users/iprok/followers",
         "following_url" : "https://api.github.com/users/iprok/following{/other_user}",
         "gists_url" : "https://api.github.com/users/iprok/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/iprok",
         "id" : 9906715,
         "login" : "iprok",
         "node_id" : "MDQ6VXNlcjk5MDY3MTU=",
         "organizations_url" : "https://api.github.com/users/iprok/orgs",
         "received_events_url" : "https://api.github.com/users/iprok/received_events",
         "repos_url" : "https://api.github.com/users/iprok/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/iprok/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/iprok/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/iprok"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> @theStack hello, excuse me for bothering you, but are any news or plans here?\r\n\r\nThere is a PR tackling this problem (https://github.com/bitcoin/bitcoin/pull/23662) that should be ready for merge soon, i.e. the next release will very likely include the fix.",
      "created_at" : "2022-04-27T10:31:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/23645#issuecomment-1110840982",
      "id" : 1110840982,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23645",
      "node_id" : "IC_kwDOABII585CNhaW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1110840982/reactions"
      },
      "updated_at" : "2022-04-27T10:31:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1110840982",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   }
]
