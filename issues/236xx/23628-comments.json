[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#22838](https://github.com/bitcoin/bitcoin/pull/22838) (descriptors: Be able to specify change and receiving in a single descriptor string by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-11-29T17:03:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23628#issuecomment-981829818",
      "id" : 981829818,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23628",
      "node_id" : "IC_kwDOABII5846hYi6",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/981829818/reactions"
      },
      "updated_at" : "2021-12-09T05:03:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/981829818",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r762680717"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762680717"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Adding `desc_str` to the result would be useful, so the user doesn't have to manually call HWI and doesn't have to guess which of the descriptors failed.\r\n\r\nYou could rename `dummy_error` to `desc_error` and include that in the message too.",
      "commit_id" : "0221b2cb47c902400ae3e4bbef3149b3d186b669",
      "created_at" : "2021-12-06T03:30:03Z",
      "diff_hunk" : "@@ -3205,6 +3205,9 @@ void CWallet::SetupDescriptorScriptPubKeyMans()\n                 FlatSigningProvider keys;\n                 std::string dummy_error;\n                 std::unique_ptr<Descriptor> desc = Parse(desc_str, keys, dummy_error, false);\n+                if (desc == NULL) {\n+                    throw std::runtime_error(std::string(__func__) + \": Invalid descriptor\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r762680717",
      "id" : 762680717,
      "line" : 3209,
      "node_id" : "PRRC_kwDOABII584tdZWN",
      "original_commit_id" : "0221b2cb47c902400ae3e4bbef3149b3d186b669",
      "original_line" : 3209,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 5,
      "pull_request_review_id" : 823507107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762680717/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-06T03:37:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762680717",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r762681750"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762681750"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Let's not fill this file up with too many options. `wallet_signer.py` can test both scenario's without needing an argument. ",
      "commit_id" : "0221b2cb47c902400ae3e4bbef3149b3d186b669",
      "created_at" : "2021-12-06T03:34:15Z",
      "diff_hunk" : "@@ -115,6 +115,7 @@\n     'feature_taproot.py',\n     'rpc_signer.py',\n     'wallet_signer.py --descriptors',\n+    'wallet_signer.py --descriptors --invalid',",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r762681750",
      "id" : 762681750,
      "line" : 118,
      "node_id" : "PRRC_kwDOABII584tdZmW",
      "original_commit_id" : "0221b2cb47c902400ae3e4bbef3149b3d186b669",
      "original_line" : 118,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/test_runner.py",
      "position" : 4,
      "pull_request_review_id" : 823507107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762681750/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-06T03:37:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762681750",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r762682091"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762682091"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Adding a new `invalid_signer.py` is fine with me, though an alternative approach would be to keep one mock, and then use the device fingerprint to decide the behavior.\r\n\r\nIn that case you would expand the `enumerate` mock to add a signer with e.g. `\"fingerprint\": \"00000003\"`, and then `getdescriptors` would return an invalid descriptor for `00000003`. ",
      "commit_id" : "0221b2cb47c902400ae3e4bbef3149b3d186b669",
      "created_at" : "2021-12-06T03:35:38Z",
      "diff_hunk" : "@@ -15,11 +15,16 @@\n     assert_equal,\n     assert_raises_rpc_error,\n )\n+from test_framework.authproxy import JSONRPCException\n \n \n class WalletSignerTest(BitcoinTestFramework):\n+    def add_options(self, parser):\n+        parser.add_argument(\"--invalid\", dest=\"invalid\", default=False, action=\"store_true\",\n+                            help=\"Test invalid external signer\")\n+\n     def mock_signer_path(self):\n-        path = os.path.join(os.path.dirname(os.path.realpath(__file__)), 'mocks', 'signer.py')\n+        path = os.path.join(os.path.dirname(os.path.realpath(__file__)), 'mocks', 'invalid_signer.py' if self.options.invalid else 'signer.py')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r762682091",
      "id" : 762682091,
      "line" : 27,
      "node_id" : "PRRC_kwDOABII584tdZrr",
      "original_commit_id" : "0221b2cb47c902400ae3e4bbef3149b3d186b669",
      "original_line" : 27,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "test/functional/wallet_signer.py",
      "position" : 14,
      "pull_request_review_id" : 823507107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762682091/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-06T03:37:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762682091",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r764513896"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764513896"
         }
      },
      "author_association" : "NONE",
      "body" : "`python3 -c \"import sys; print(type(sys.stdin))\"` reports that this is a TextIOWrapper (even when I pipe something in such that stdin isn't a tty), so that [BufferedIOBase.read](https://docs.python.org/3/library/io.html#io.BufferedIOBase.read) will be used, which cannot return None. Why not `buffer = sys.stdin.read().rstrip()`, then? Then it wouldn't be necessary to strip it twice. And `if buffer and buffer.rstrip() != \"\"` could be simply `if buffer` or maybe `if buffer != \"\"` if you prefer to be verbose.",
      "commit_id" : "0221b2cb47c902400ae3e4bbef3149b3d186b669",
      "created_at" : "2021-12-08T03:00:09Z",
      "diff_hunk" : "@@ -0,0 +1,65 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018-2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+import os\n+import sys\n+import argparse\n+import json\n+\n+def perform_pre_checks():\n+    mock_result_path = os.path.join(os.getcwd(), \"mock_result\")\n+    if(os.path.isfile(mock_result_path)):\n+        with open(mock_result_path, \"r\", encoding=\"utf8\") as f:\n+            mock_result = f.read()\n+        if mock_result[0]:\n+            sys.stdout.write(mock_result[2:])\n+            sys.exit(int(mock_result[0]))\n+\n+def enumerate(args):\n+    sys.stdout.write(json.dumps([{\"fingerprint\": \"b3c19bfc\", \"type\": \"trezor\", \"model\": \"trezor_t\"}, {\"fingerprint\": \"00000002\"}]))\n+\n+def getdescriptors(args):\n+    xpub_pkh = \"xpub6CRhJvXV8x2AKWvqi1ZSMFU6cbxzQiYrv3dxSUXCawjMJ1JzpqVsveH4way1yCmJm29KzH1zrVZmVwes4Qo6oXVE1HFn4fdiKrYJngqFFc6\"\n+    xpub_sh = \"xpub6CoNoq3Tg4tGSpom2BSwL42gy864KHo3TXkHxLxBbhvCkgmdVXADQmiHbLZhX3Me1cYhRx7s25Lpm4LnT5zu395ANHsXB2QvT9tqJDAibTN\"\n+    xpub_wpkh = \"xpub6DUcLgY1DfgDy2RV6q4djwwsLitaoZDumbribqrR8mP78fEtgZa1XEsqT5MWQ7gwLwKsTQPT28XLoVE5A97rDNTwMXjmzPaNijoCApCbWvp\"\n+\n+    sys.stdout.write(json.dumps({\n+        \"receive\": [\n+            \"pkh([b3c19bfc/44'/1'/\" + args.account + \"']\" + xpub_pkh + \"/0/*)#h26nxtl9\",\n+            \"sh(wpkh([b3c19bfc/49'/1'/\" + args.account + \"']\" + xpub_sh + \"/0/*))#32ry02yp\",\n+            \"wpkh([b3c19bfc/84'/1'/\" + args.account + \"']\" + xpub_wpkh + \"/0/*)#jftn8ppv\"\n+        ],\n+        \"internal\": [\n+            \"pkh([b3c19bfc/44'/1'/\" + args.account + \"']\" + xpub_pkh + \"/1/*)#x7ljm70a\",\n+            \"sh(wpkh([b3c19bfc/49'/1'/\" + args.account + \"']\" + xpub_sh + \"/1/*))#ytdjh437\",\n+            \"wpkh([b3c19bfc/84'/1'/\" + args.account + \"']\" + xpub_wpkh + \"/1/*)#rawj6535\"\n+        ]\n+    }))\n+\n+parser = argparse.ArgumentParser(prog='./invalid_signer.py', description='External invalid signer mock')\n+parser.add_argument('--fingerprint')\n+parser.add_argument('--chain', default='main')\n+parser.add_argument('--stdin', action='store_true')\n+\n+subparsers = parser.add_subparsers(description='Commands', dest='command')\n+subparsers.required = True\n+\n+parser_enumerate = subparsers.add_parser('enumerate', help='list available signers')\n+parser_enumerate.set_defaults(func=enumerate)\n+\n+parser_getdescriptors = subparsers.add_parser('getdescriptors')\n+parser_getdescriptors.set_defaults(func=getdescriptors)\n+parser_getdescriptors.add_argument('--account', metavar='account')\n+\n+if not sys.stdin.isatty():\n+    buffer = sys.stdin.read()\n+    if buffer and buffer.rstrip() != \"\":\n+        sys.argv.extend(buffer.rstrip().split(\" \"))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r764513896",
      "id" : 764513896,
      "line" : 59,
      "node_id" : "PRRC_kwDOABII584tkY5o",
      "original_commit_id" : "0221b2cb47c902400ae3e4bbef3149b3d186b669",
      "original_line" : 59,
      "original_position" : 59,
      "original_start_line" : 57,
      "path" : "test/functional/mocks/invalid_signer.py",
      "position" : 59,
      "pull_request_review_id" : 825964778,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764513896/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 57,
      "start_side" : "RIGHT",
      "updated_at" : "2021-12-08T03:11:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764513896",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/284023?v=4",
         "events_url" : "https://api.github.com/users/ysangkok/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ysangkok/followers",
         "following_url" : "https://api.github.com/users/ysangkok/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ysangkok/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ysangkok",
         "id" : 284023,
         "login" : "ysangkok",
         "node_id" : "MDQ6VXNlcjI4NDAyMw==",
         "organizations_url" : "https://api.github.com/users/ysangkok/orgs",
         "received_events_url" : "https://api.github.com/users/ysangkok/received_events",
         "repos_url" : "https://api.github.com/users/ysangkok/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ysangkok/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ysangkok/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ysangkok"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r764838556"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764838556"
         }
      },
      "author_association" : "NONE",
      "body" : "done in https://github.com/bitcoin/bitcoin/pull/23628/commits/a5f53c36942bf82c056380df6c15adf0b12190f2",
      "commit_id" : "a5f53c36942bf82c056380df6c15adf0b12190f2",
      "created_at" : "2021-12-08T12:53:21Z",
      "diff_hunk" : "@@ -3205,6 +3205,9 @@ void CWallet::SetupDescriptorScriptPubKeyMans()\n                 FlatSigningProvider keys;\n                 std::string dummy_error;\n                 std::unique_ptr<Descriptor> desc = Parse(desc_str, keys, dummy_error, false);\n+                if (desc == NULL) {\n+                    throw std::runtime_error(std::string(__func__) + \": Invalid descriptor\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r764838556",
      "id" : 764838556,
      "in_reply_to_id" : 762680717,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tloKc",
      "original_commit_id" : "0221b2cb47c902400ae3e4bbef3149b3d186b669",
      "original_line" : 3209,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 826399015,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764838556/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-08T12:53:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764838556",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1573866?v=4",
         "events_url" : "https://api.github.com/users/sstone/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sstone/followers",
         "following_url" : "https://api.github.com/users/sstone/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sstone/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sstone",
         "id" : 1573866,
         "login" : "sstone",
         "node_id" : "MDQ6VXNlcjE1NzM4NjY=",
         "organizations_url" : "https://api.github.com/users/sstone/orgs",
         "received_events_url" : "https://api.github.com/users/sstone/received_events",
         "repos_url" : "https://api.github.com/users/sstone/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sstone/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sstone/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sstone"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r764838682"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764838682"
         }
      },
      "author_association" : "NONE",
      "body" : "done in https://github.com/bitcoin/bitcoin/pull/23628/commits/a5f53c36942bf82c056380df6c15adf0b12190f2",
      "commit_id" : "a5f53c36942bf82c056380df6c15adf0b12190f2",
      "created_at" : "2021-12-08T12:53:30Z",
      "diff_hunk" : "@@ -115,6 +115,7 @@\n     'feature_taproot.py',\n     'rpc_signer.py',\n     'wallet_signer.py --descriptors',\n+    'wallet_signer.py --descriptors --invalid',",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r764838682",
      "id" : 764838682,
      "in_reply_to_id" : 762681750,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tloMa",
      "original_commit_id" : "0221b2cb47c902400ae3e4bbef3149b3d186b669",
      "original_line" : 118,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/test_runner.py",
      "position" : null,
      "pull_request_review_id" : 826399182,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764838682/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-08T12:53:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764838682",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1573866?v=4",
         "events_url" : "https://api.github.com/users/sstone/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sstone/followers",
         "following_url" : "https://api.github.com/users/sstone/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sstone/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sstone",
         "id" : 1573866,
         "login" : "sstone",
         "node_id" : "MDQ6VXNlcjE1NzM4NjY=",
         "organizations_url" : "https://api.github.com/users/sstone/orgs",
         "received_events_url" : "https://api.github.com/users/sstone/received_events",
         "repos_url" : "https://api.github.com/users/sstone/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sstone/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sstone/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sstone"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r764840737"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764840737"
         }
      },
      "author_association" : "NONE",
      "body" : "I could get that to work, it seems that it is not supported yet ? (see https://github.com/bitcoin/bitcoin/blob/master/src/wallet/external_signer_scriptpubkeyman.cpp#L47) so instead I re-start the node and change signer path to point to the invalid signer mock.",
      "commit_id" : "a5f53c36942bf82c056380df6c15adf0b12190f2",
      "created_at" : "2021-12-08T12:56:20Z",
      "diff_hunk" : "@@ -15,11 +15,16 @@\n     assert_equal,\n     assert_raises_rpc_error,\n )\n+from test_framework.authproxy import JSONRPCException\n \n \n class WalletSignerTest(BitcoinTestFramework):\n+    def add_options(self, parser):\n+        parser.add_argument(\"--invalid\", dest=\"invalid\", default=False, action=\"store_true\",\n+                            help=\"Test invalid external signer\")\n+\n     def mock_signer_path(self):\n-        path = os.path.join(os.path.dirname(os.path.realpath(__file__)), 'mocks', 'signer.py')\n+        path = os.path.join(os.path.dirname(os.path.realpath(__file__)), 'mocks', 'invalid_signer.py' if self.options.invalid else 'signer.py')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r764840737",
      "id" : 764840737,
      "in_reply_to_id" : 762682091,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tlosh",
      "original_commit_id" : "0221b2cb47c902400ae3e4bbef3149b3d186b669",
      "original_line" : 27,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "test/functional/wallet_signer.py",
      "position" : null,
      "pull_request_review_id" : 826401991,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764840737/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-08T12:56:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764840737",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1573866?v=4",
         "events_url" : "https://api.github.com/users/sstone/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sstone/followers",
         "following_url" : "https://api.github.com/users/sstone/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sstone/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sstone",
         "id" : 1573866,
         "login" : "sstone",
         "node_id" : "MDQ6VXNlcjE1NzM4NjY=",
         "organizations_url" : "https://api.github.com/users/sstone/orgs",
         "received_events_url" : "https://api.github.com/users/sstone/received_events",
         "repos_url" : "https://api.github.com/users/sstone/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sstone/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sstone/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sstone"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r764842458"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764842458"
         }
      },
      "author_association" : "NONE",
      "body" : "This was copied from the original https://github.com/bitcoin/bitcoin/blob/master/test/functional/mocks/signer.py code.",
      "commit_id" : "a5f53c36942bf82c056380df6c15adf0b12190f2",
      "created_at" : "2021-12-08T12:58:40Z",
      "diff_hunk" : "@@ -0,0 +1,65 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018-2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+import os\n+import sys\n+import argparse\n+import json\n+\n+def perform_pre_checks():\n+    mock_result_path = os.path.join(os.getcwd(), \"mock_result\")\n+    if(os.path.isfile(mock_result_path)):\n+        with open(mock_result_path, \"r\", encoding=\"utf8\") as f:\n+            mock_result = f.read()\n+        if mock_result[0]:\n+            sys.stdout.write(mock_result[2:])\n+            sys.exit(int(mock_result[0]))\n+\n+def enumerate(args):\n+    sys.stdout.write(json.dumps([{\"fingerprint\": \"b3c19bfc\", \"type\": \"trezor\", \"model\": \"trezor_t\"}, {\"fingerprint\": \"00000002\"}]))\n+\n+def getdescriptors(args):\n+    xpub_pkh = \"xpub6CRhJvXV8x2AKWvqi1ZSMFU6cbxzQiYrv3dxSUXCawjMJ1JzpqVsveH4way1yCmJm29KzH1zrVZmVwes4Qo6oXVE1HFn4fdiKrYJngqFFc6\"\n+    xpub_sh = \"xpub6CoNoq3Tg4tGSpom2BSwL42gy864KHo3TXkHxLxBbhvCkgmdVXADQmiHbLZhX3Me1cYhRx7s25Lpm4LnT5zu395ANHsXB2QvT9tqJDAibTN\"\n+    xpub_wpkh = \"xpub6DUcLgY1DfgDy2RV6q4djwwsLitaoZDumbribqrR8mP78fEtgZa1XEsqT5MWQ7gwLwKsTQPT28XLoVE5A97rDNTwMXjmzPaNijoCApCbWvp\"\n+\n+    sys.stdout.write(json.dumps({\n+        \"receive\": [\n+            \"pkh([b3c19bfc/44'/1'/\" + args.account + \"']\" + xpub_pkh + \"/0/*)#h26nxtl9\",\n+            \"sh(wpkh([b3c19bfc/49'/1'/\" + args.account + \"']\" + xpub_sh + \"/0/*))#32ry02yp\",\n+            \"wpkh([b3c19bfc/84'/1'/\" + args.account + \"']\" + xpub_wpkh + \"/0/*)#jftn8ppv\"\n+        ],\n+        \"internal\": [\n+            \"pkh([b3c19bfc/44'/1'/\" + args.account + \"']\" + xpub_pkh + \"/1/*)#x7ljm70a\",\n+            \"sh(wpkh([b3c19bfc/49'/1'/\" + args.account + \"']\" + xpub_sh + \"/1/*))#ytdjh437\",\n+            \"wpkh([b3c19bfc/84'/1'/\" + args.account + \"']\" + xpub_wpkh + \"/1/*)#rawj6535\"\n+        ]\n+    }))\n+\n+parser = argparse.ArgumentParser(prog='./invalid_signer.py', description='External invalid signer mock')\n+parser.add_argument('--fingerprint')\n+parser.add_argument('--chain', default='main')\n+parser.add_argument('--stdin', action='store_true')\n+\n+subparsers = parser.add_subparsers(description='Commands', dest='command')\n+subparsers.required = True\n+\n+parser_enumerate = subparsers.add_parser('enumerate', help='list available signers')\n+parser_enumerate.set_defaults(func=enumerate)\n+\n+parser_getdescriptors = subparsers.add_parser('getdescriptors')\n+parser_getdescriptors.set_defaults(func=getdescriptors)\n+parser_getdescriptors.add_argument('--account', metavar='account')\n+\n+if not sys.stdin.isatty():\n+    buffer = sys.stdin.read()\n+    if buffer and buffer.rstrip() != \"\":\n+        sys.argv.extend(buffer.rstrip().split(\" \"))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r764842458",
      "id" : 764842458,
      "in_reply_to_id" : 764513896,
      "line" : 59,
      "node_id" : "PRRC_kwDOABII584tlpHa",
      "original_commit_id" : "0221b2cb47c902400ae3e4bbef3149b3d186b669",
      "original_line" : 59,
      "original_position" : 59,
      "original_start_line" : 57,
      "path" : "test/functional/mocks/invalid_signer.py",
      "position" : 59,
      "pull_request_review_id" : 826404341,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764842458/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 57,
      "start_side" : "RIGHT",
      "updated_at" : "2021-12-08T12:58:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764842458",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1573866?v=4",
         "events_url" : "https://api.github.com/users/sstone/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sstone/followers",
         "following_url" : "https://api.github.com/users/sstone/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sstone/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sstone",
         "id" : 1573866,
         "login" : "sstone",
         "node_id" : "MDQ6VXNlcjE1NzM4NjY=",
         "organizations_url" : "https://api.github.com/users/sstone/orgs",
         "received_events_url" : "https://api.github.com/users/sstone/received_events",
         "repos_url" : "https://api.github.com/users/sstone/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sstone/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sstone/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sstone"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r764887011"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764887011"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In a5f53c36942bf82c056380df6c15adf0b12190f2 \"Check descriptors returned by external signers\"\r\n\r\nnit: `nullptr` is preferred over `NULL`",
      "commit_id" : "a5f53c36942bf82c056380df6c15adf0b12190f2",
      "created_at" : "2021-12-08T13:55:09Z",
      "diff_hunk" : "@@ -3203,8 +3203,11 @@ void CWallet::SetupDescriptorScriptPubKeyMans()\n             for (const UniValue& desc_val : descriptor_vals.get_array().getValues()) {\n                 std::string desc_str = desc_val.getValStr();\n                 FlatSigningProvider keys;\n-                std::string dummy_error;\n-                std::unique_ptr<Descriptor> desc = Parse(desc_str, keys, dummy_error, false);\n+                std::string desc_error;\n+                std::unique_ptr<Descriptor> desc = Parse(desc_str, keys, desc_error, false);\n+                if (desc == NULL) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r764887011",
      "id" : 764887011,
      "line" : 3208,
      "node_id" : "PRRC_kwDOABII584tlz_j",
      "original_commit_id" : "a5f53c36942bf82c056380df6c15adf0b12190f2",
      "original_line" : 3208,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 8,
      "pull_request_review_id" : 826466246,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764887011/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-08T14:07:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764887011",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r764888405"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764888405"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In a5f53c36942bf82c056380df6c15adf0b12190f2 \"Check descriptors returned by external signers\"\r\n\r\nMissing leading `f` for f-string. This line should also be inside of `test_invalid_signer` rather than in the caller. Also, the wrong node is being restarted, it should be node 1.\r\n\r\n```suggestion\r\n        self.restart_node(1, [f\"-signer={self.mock_invalid_signer_path()}\", \"-keypool=10\"])\r\n```",
      "commit_id" : "a5f53c36942bf82c056380df6c15adf0b12190f2",
      "created_at" : "2021-12-08T13:56:51Z",
      "diff_hunk" : "@@ -48,6 +56,11 @@ def clear_mock_result(self, node):\n         os.remove(os.path.join(node.cwd, \"mock_result\"))\n \n     def run_test(self):\n+        self.test_valid_signer()\n+        self.restart_node(0, [\"-signer={self.mock_invalid_signer_path()}\", \"-keypool=10\"])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r764888405",
      "id" : 764888405,
      "line" : 60,
      "node_id" : "PRRC_kwDOABII584tl0VV",
      "original_commit_id" : "a5f53c36942bf82c056380df6c15adf0b12190f2",
      "original_line" : 60,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "test/functional/wallet_signer.py",
      "position" : 27,
      "pull_request_review_id" : 826466246,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764888405/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-08T14:07:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764888405",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r764889490"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764889490"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In a5f53c36942bf82c056380df6c15adf0b12190f2 \"Check descriptors returned by external signers\"\r\n\r\nThere's no need to duplicate these tests.",
      "commit_id" : "a5f53c36942bf82c056380df6c15adf0b12190f2",
      "created_at" : "2021-12-08T13:58:04Z",
      "diff_hunk" : "@@ -187,5 +200,36 @@ def run_test(self):\n         # )\n         # self.clear_mock_result(self.nodes[4])\n \n+    def test_invalid_signer(self):\n+        self.log.debug(f\"-signer={self.mock_invalid_signer_path()}\")\n+\n+        # Create new wallets for an external signer.\n+        # disable_private_keys and descriptors must be true:\n+        assert_raises_rpc_error(-4, \"Private keys must be disabled when using an external signer\", self.nodes[1].createwallet, wallet_name='not_hww_invalid', disable_private_keys=False, descriptors=True, external_signer=True)\n+        if self.is_bdb_compiled():\n+            assert_raises_rpc_error(-4, \"Descriptor support must be enabled when using an external signer\", self.nodes[1].createwallet, wallet_name='not_hww_invalid', disable_private_keys=True, descriptors=False, external_signer=True)\n+        else:\n+            assert_raises_rpc_error(-4, \"Compiled without bdb support (required for legacy wallets)\", self.nodes[1].createwallet, wallet_name='not_hww_invalid', disable_private_keys=True, descriptors=False, external_signer=True)\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r764889490",
      "id" : 764889490,
      "line" : 213,
      "node_id" : "PRRC_kwDOABII584tl0mS",
      "original_commit_id" : "a5f53c36942bf82c056380df6c15adf0b12190f2",
      "original_line" : 213,
      "original_position" : 48,
      "original_start_line" : 207,
      "path" : "test/functional/wallet_signer.py",
      "position" : 48,
      "pull_request_review_id" : 826466246,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764889490/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 207,
      "start_side" : "RIGHT",
      "updated_at" : "2021-12-08T14:07:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764889490",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r764895669"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764895669"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In a5f53c36942bf82c056380df6c15adf0b12190f2 \"Check descriptors returned by external signers\"\r\n\r\nThis isn't testing the invalid behavior. It should also use `assert_raises_rpc_error`.\r\n\r\n```suggestion\r\n        assert_raises_rpc_error(-1, \"Invalid descriptor\", self.nodes[1].createwallet, wallet_name='hww_invalid', disable_private_keys=True, descriptors=True, external_signer=True)\r\n```",
      "commit_id" : "a5f53c36942bf82c056380df6c15adf0b12190f2",
      "created_at" : "2021-12-08T14:05:46Z",
      "diff_hunk" : "@@ -187,5 +200,36 @@ def run_test(self):\n         # )\n         # self.clear_mock_result(self.nodes[4])\n \n+    def test_invalid_signer(self):\n+        self.log.debug(f\"-signer={self.mock_invalid_signer_path()}\")\n+\n+        # Create new wallets for an external signer.\n+        # disable_private_keys and descriptors must be true:\n+        assert_raises_rpc_error(-4, \"Private keys must be disabled when using an external signer\", self.nodes[1].createwallet, wallet_name='not_hww_invalid', disable_private_keys=False, descriptors=True, external_signer=True)\n+        if self.is_bdb_compiled():\n+            assert_raises_rpc_error(-4, \"Descriptor support must be enabled when using an external signer\", self.nodes[1].createwallet, wallet_name='not_hww_invalid', disable_private_keys=True, descriptors=False, external_signer=True)\n+        else:\n+            assert_raises_rpc_error(-4, \"Compiled without bdb support (required for legacy wallets)\", self.nodes[1].createwallet, wallet_name='not_hww_invalid', disable_private_keys=True, descriptors=False, external_signer=True)\n+\n+        self.log.info('Test invalid external signer')\n+        try:\n+            self.nodes[1].createwallet(wallet_name='hww_invalid', disable_private_keys=True, descriptors=True, external_signer=True)\n+        except JSONRPCException:\n+            pass",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r764895669",
      "id" : 764895669,
      "line" : 218,
      "node_id" : "PRRC_kwDOABII584tl2G1",
      "original_commit_id" : "a5f53c36942bf82c056380df6c15adf0b12190f2",
      "original_line" : 218,
      "original_position" : 53,
      "original_start_line" : 215,
      "path" : "test/functional/wallet_signer.py",
      "position" : 53,
      "pull_request_review_id" : 826466246,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764895669/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 215,
      "start_side" : "RIGHT",
      "updated_at" : "2021-12-08T14:07:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764895669",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r764896091"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764896091"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In a5f53c36942bf82c056380df6c15adf0b12190f2 \"Check descriptors returned by external signers\"\r\n\r\nIt is not necessary to duplicate these tests.",
      "commit_id" : "a5f53c36942bf82c056380df6c15adf0b12190f2",
      "created_at" : "2021-12-08T14:06:19Z",
      "diff_hunk" : "@@ -187,5 +200,36 @@ def run_test(self):\n         # )\n         # self.clear_mock_result(self.nodes[4])\n \n+    def test_invalid_signer(self):\n+        self.log.debug(f\"-signer={self.mock_invalid_signer_path()}\")\n+\n+        # Create new wallets for an external signer.\n+        # disable_private_keys and descriptors must be true:\n+        assert_raises_rpc_error(-4, \"Private keys must be disabled when using an external signer\", self.nodes[1].createwallet, wallet_name='not_hww_invalid', disable_private_keys=False, descriptors=True, external_signer=True)\n+        if self.is_bdb_compiled():\n+            assert_raises_rpc_error(-4, \"Descriptor support must be enabled when using an external signer\", self.nodes[1].createwallet, wallet_name='not_hww_invalid', disable_private_keys=True, descriptors=False, external_signer=True)\n+        else:\n+            assert_raises_rpc_error(-4, \"Compiled without bdb support (required for legacy wallets)\", self.nodes[1].createwallet, wallet_name='not_hww_invalid', disable_private_keys=True, descriptors=False, external_signer=True)\n+\n+        self.log.info('Test invalid external signer')\n+        try:\n+            self.nodes[1].createwallet(wallet_name='hww_invalid', disable_private_keys=True, descriptors=True, external_signer=True)\n+        except JSONRPCException:\n+            pass\n+\n+        # Flag can't be set afterwards (could be added later for non-blank descriptor based watch-only wallets)\n+        self.nodes[1].createwallet(wallet_name='not_hww_invalid', disable_private_keys=True, descriptors=True, external_signer=False)\n+        not_hww = self.nodes[1].get_wallet_rpc('not_hww_invalid')\n+        assert_raises_rpc_error(-8, \"Wallet flag is immutable: external_signer\", not_hww.setwalletflag, \"external_signer\", True)\n+\n+        # assert_raises_rpc_error(-4, \"Multiple signers found, please specify which to use\", wallet_name='not_hww', disable_private_keys=True, descriptors=True, external_signer=True)\n+\n+        # TODO: Handle error thrown by script\n+        # self.set_mock_result(self.nodes[1], \"2\")\n+        # assert_raises_rpc_error(-1, 'Unable to parse JSON',\n+        #     self.nodes[1].createwallet, wallet_name='not_hww2', disable_private_keys=True, descriptors=True, external_signer=False\n+        # )\n+        # self.clear_mock_result(self.nodes[1])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r764896091",
      "id" : 764896091,
      "line" : 232,
      "node_id" : "PRRC_kwDOABII584tl2Nb",
      "original_commit_id" : "a5f53c36942bf82c056380df6c15adf0b12190f2",
      "original_line" : 232,
      "original_position" : 67,
      "original_start_line" : 220,
      "path" : "test/functional/wallet_signer.py",
      "position" : 67,
      "pull_request_review_id" : 826466246,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764896091/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 220,
      "start_side" : "RIGHT",
      "updated_at" : "2021-12-08T14:07:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764896091",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r765256556"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765256556"
         }
      },
      "author_association" : "NONE",
      "body" : "done in https://github.com/bitcoin/bitcoin/pull/23628/commits/96846ef7817257326d51c4f05047ca46c3f7f3c7",
      "commit_id" : "96846ef7817257326d51c4f05047ca46c3f7f3c7",
      "created_at" : "2021-12-08T21:24:48Z",
      "diff_hunk" : "@@ -3203,8 +3203,11 @@ void CWallet::SetupDescriptorScriptPubKeyMans()\n             for (const UniValue& desc_val : descriptor_vals.get_array().getValues()) {\n                 std::string desc_str = desc_val.getValStr();\n                 FlatSigningProvider keys;\n-                std::string dummy_error;\n-                std::unique_ptr<Descriptor> desc = Parse(desc_str, keys, dummy_error, false);\n+                std::string desc_error;\n+                std::unique_ptr<Descriptor> desc = Parse(desc_str, keys, desc_error, false);\n+                if (desc == NULL) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r765256556",
      "id" : 765256556,
      "in_reply_to_id" : 764887011,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tnONs",
      "original_commit_id" : "a5f53c36942bf82c056380df6c15adf0b12190f2",
      "original_line" : 3208,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 826971294,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765256556/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-08T21:24:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765256556",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1573866?v=4",
         "events_url" : "https://api.github.com/users/sstone/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sstone/followers",
         "following_url" : "https://api.github.com/users/sstone/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sstone/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sstone",
         "id" : 1573866,
         "login" : "sstone",
         "node_id" : "MDQ6VXNlcjE1NzM4NjY=",
         "organizations_url" : "https://api.github.com/users/sstone/orgs",
         "received_events_url" : "https://api.github.com/users/sstone/received_events",
         "repos_url" : "https://api.github.com/users/sstone/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sstone/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sstone/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sstone"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r765256791"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765256791"
         }
      },
      "author_association" : "NONE",
      "body" : "thanks! done in https://github.com/bitcoin/bitcoin/pull/23628/commits/96846ef7817257326d51c4f05047ca46c3f7f3c7",
      "commit_id" : "96846ef7817257326d51c4f05047ca46c3f7f3c7",
      "created_at" : "2021-12-08T21:25:12Z",
      "diff_hunk" : "@@ -48,6 +56,11 @@ def clear_mock_result(self, node):\n         os.remove(os.path.join(node.cwd, \"mock_result\"))\n \n     def run_test(self):\n+        self.test_valid_signer()\n+        self.restart_node(0, [\"-signer={self.mock_invalid_signer_path()}\", \"-keypool=10\"])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r765256791",
      "id" : 765256791,
      "in_reply_to_id" : 764888405,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tnORX",
      "original_commit_id" : "a5f53c36942bf82c056380df6c15adf0b12190f2",
      "original_line" : 60,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "test/functional/wallet_signer.py",
      "position" : null,
      "pull_request_review_id" : 826971605,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765256791/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-08T21:25:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765256791",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1573866?v=4",
         "events_url" : "https://api.github.com/users/sstone/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sstone/followers",
         "following_url" : "https://api.github.com/users/sstone/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sstone/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sstone",
         "id" : 1573866,
         "login" : "sstone",
         "node_id" : "MDQ6VXNlcjE1NzM4NjY=",
         "organizations_url" : "https://api.github.com/users/sstone/orgs",
         "received_events_url" : "https://api.github.com/users/sstone/received_events",
         "repos_url" : "https://api.github.com/users/sstone/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sstone/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sstone/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sstone"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r765256979"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765256979"
         }
      },
      "author_association" : "NONE",
      "body" : "thanks! done in https://github.com/bitcoin/bitcoin/pull/23628/commits/96846ef7817257326d51c4f05047ca46c3f7f3c7",
      "commit_id" : "96846ef7817257326d51c4f05047ca46c3f7f3c7",
      "created_at" : "2021-12-08T21:25:30Z",
      "diff_hunk" : "@@ -187,5 +200,36 @@ def run_test(self):\n         # )\n         # self.clear_mock_result(self.nodes[4])\n \n+    def test_invalid_signer(self):\n+        self.log.debug(f\"-signer={self.mock_invalid_signer_path()}\")\n+\n+        # Create new wallets for an external signer.\n+        # disable_private_keys and descriptors must be true:\n+        assert_raises_rpc_error(-4, \"Private keys must be disabled when using an external signer\", self.nodes[1].createwallet, wallet_name='not_hww_invalid', disable_private_keys=False, descriptors=True, external_signer=True)\n+        if self.is_bdb_compiled():\n+            assert_raises_rpc_error(-4, \"Descriptor support must be enabled when using an external signer\", self.nodes[1].createwallet, wallet_name='not_hww_invalid', disable_private_keys=True, descriptors=False, external_signer=True)\n+        else:\n+            assert_raises_rpc_error(-4, \"Compiled without bdb support (required for legacy wallets)\", self.nodes[1].createwallet, wallet_name='not_hww_invalid', disable_private_keys=True, descriptors=False, external_signer=True)\n+\n+        self.log.info('Test invalid external signer')\n+        try:\n+            self.nodes[1].createwallet(wallet_name='hww_invalid', disable_private_keys=True, descriptors=True, external_signer=True)\n+        except JSONRPCException:\n+            pass",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r765256979",
      "id" : 765256979,
      "in_reply_to_id" : 764895669,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tnOUT",
      "original_commit_id" : "a5f53c36942bf82c056380df6c15adf0b12190f2",
      "original_line" : 218,
      "original_position" : 53,
      "original_start_line" : 215,
      "path" : "test/functional/wallet_signer.py",
      "position" : null,
      "pull_request_review_id" : 826971839,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765256979/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-12-08T21:25:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765256979",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1573866?v=4",
         "events_url" : "https://api.github.com/users/sstone/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sstone/followers",
         "following_url" : "https://api.github.com/users/sstone/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sstone/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sstone",
         "id" : 1573866,
         "login" : "sstone",
         "node_id" : "MDQ6VXNlcjE1NzM4NjY=",
         "organizations_url" : "https://api.github.com/users/sstone/orgs",
         "received_events_url" : "https://api.github.com/users/sstone/received_events",
         "repos_url" : "https://api.github.com/users/sstone/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sstone/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sstone/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sstone"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r765257155"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765257155"
         }
      },
      "author_association" : "NONE",
      "body" : "removed in https://github.com/bitcoin/bitcoin/pull/23628/commits/96846ef7817257326d51c4f05047ca46c3f7f3c7",
      "commit_id" : "96846ef7817257326d51c4f05047ca46c3f7f3c7",
      "created_at" : "2021-12-08T21:25:47Z",
      "diff_hunk" : "@@ -187,5 +200,36 @@ def run_test(self):\n         # )\n         # self.clear_mock_result(self.nodes[4])\n \n+    def test_invalid_signer(self):\n+        self.log.debug(f\"-signer={self.mock_invalid_signer_path()}\")\n+\n+        # Create new wallets for an external signer.\n+        # disable_private_keys and descriptors must be true:\n+        assert_raises_rpc_error(-4, \"Private keys must be disabled when using an external signer\", self.nodes[1].createwallet, wallet_name='not_hww_invalid', disable_private_keys=False, descriptors=True, external_signer=True)\n+        if self.is_bdb_compiled():\n+            assert_raises_rpc_error(-4, \"Descriptor support must be enabled when using an external signer\", self.nodes[1].createwallet, wallet_name='not_hww_invalid', disable_private_keys=True, descriptors=False, external_signer=True)\n+        else:\n+            assert_raises_rpc_error(-4, \"Compiled without bdb support (required for legacy wallets)\", self.nodes[1].createwallet, wallet_name='not_hww_invalid', disable_private_keys=True, descriptors=False, external_signer=True)\n+\n+        self.log.info('Test invalid external signer')\n+        try:\n+            self.nodes[1].createwallet(wallet_name='hww_invalid', disable_private_keys=True, descriptors=True, external_signer=True)\n+        except JSONRPCException:\n+            pass\n+\n+        # Flag can't be set afterwards (could be added later for non-blank descriptor based watch-only wallets)\n+        self.nodes[1].createwallet(wallet_name='not_hww_invalid', disable_private_keys=True, descriptors=True, external_signer=False)\n+        not_hww = self.nodes[1].get_wallet_rpc('not_hww_invalid')\n+        assert_raises_rpc_error(-8, \"Wallet flag is immutable: external_signer\", not_hww.setwalletflag, \"external_signer\", True)\n+\n+        # assert_raises_rpc_error(-4, \"Multiple signers found, please specify which to use\", wallet_name='not_hww', disable_private_keys=True, descriptors=True, external_signer=True)\n+\n+        # TODO: Handle error thrown by script\n+        # self.set_mock_result(self.nodes[1], \"2\")\n+        # assert_raises_rpc_error(-1, 'Unable to parse JSON',\n+        #     self.nodes[1].createwallet, wallet_name='not_hww2', disable_private_keys=True, descriptors=True, external_signer=False\n+        # )\n+        # self.clear_mock_result(self.nodes[1])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r765257155",
      "id" : 765257155,
      "in_reply_to_id" : 764896091,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tnOXD",
      "original_commit_id" : "a5f53c36942bf82c056380df6c15adf0b12190f2",
      "original_line" : 232,
      "original_position" : 67,
      "original_start_line" : 220,
      "path" : "test/functional/wallet_signer.py",
      "position" : null,
      "pull_request_review_id" : 826972078,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765257155/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-12-08T21:25:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765257155",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1573866?v=4",
         "events_url" : "https://api.github.com/users/sstone/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sstone/followers",
         "following_url" : "https://api.github.com/users/sstone/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sstone/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sstone",
         "id" : 1573866,
         "login" : "sstone",
         "node_id" : "MDQ6VXNlcjE1NzM4NjY=",
         "organizations_url" : "https://api.github.com/users/sstone/orgs",
         "received_events_url" : "https://api.github.com/users/sstone/received_events",
         "repos_url" : "https://api.github.com/users/sstone/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sstone/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sstone/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sstone"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r765257316"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765257316"
         }
      },
      "author_association" : "NONE",
      "body" : "removed in https://github.com/bitcoin/bitcoin/pull/23628/commits/96846ef7817257326d51c4f05047ca46c3f7f3c7",
      "commit_id" : "96846ef7817257326d51c4f05047ca46c3f7f3c7",
      "created_at" : "2021-12-08T21:26:04Z",
      "diff_hunk" : "@@ -187,5 +200,36 @@ def run_test(self):\n         # )\n         # self.clear_mock_result(self.nodes[4])\n \n+    def test_invalid_signer(self):\n+        self.log.debug(f\"-signer={self.mock_invalid_signer_path()}\")\n+\n+        # Create new wallets for an external signer.\n+        # disable_private_keys and descriptors must be true:\n+        assert_raises_rpc_error(-4, \"Private keys must be disabled when using an external signer\", self.nodes[1].createwallet, wallet_name='not_hww_invalid', disable_private_keys=False, descriptors=True, external_signer=True)\n+        if self.is_bdb_compiled():\n+            assert_raises_rpc_error(-4, \"Descriptor support must be enabled when using an external signer\", self.nodes[1].createwallet, wallet_name='not_hww_invalid', disable_private_keys=True, descriptors=False, external_signer=True)\n+        else:\n+            assert_raises_rpc_error(-4, \"Compiled without bdb support (required for legacy wallets)\", self.nodes[1].createwallet, wallet_name='not_hww_invalid', disable_private_keys=True, descriptors=False, external_signer=True)\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r765257316",
      "id" : 765257316,
      "in_reply_to_id" : 764889490,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tnOZk",
      "original_commit_id" : "a5f53c36942bf82c056380df6c15adf0b12190f2",
      "original_line" : 213,
      "original_position" : 48,
      "original_start_line" : 207,
      "path" : "test/functional/wallet_signer.py",
      "position" : null,
      "pull_request_review_id" : 826972287,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765257316/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-12-08T21:26:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765257316",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1573866?v=4",
         "events_url" : "https://api.github.com/users/sstone/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sstone/followers",
         "following_url" : "https://api.github.com/users/sstone/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sstone/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sstone",
         "id" : 1573866,
         "login" : "sstone",
         "node_id" : "MDQ6VXNlcjE1NzM4NjY=",
         "organizations_url" : "https://api.github.com/users/sstone/orgs",
         "received_events_url" : "https://api.github.com/users/sstone/received_events",
         "repos_url" : "https://api.github.com/users/sstone/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sstone/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sstone/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sstone"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 96846ef7817257326d51c4f05047ca46c3f7f3c7",
      "created_at" : "2021-12-08T23:41:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23628#issuecomment-989316049",
      "id" : 989316049,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23628",
      "node_id" : "IC_kwDOABII584698PR",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/989316049/reactions"
      },
      "updated_at" : "2021-12-08T23:41:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/989316049",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r765396425"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765396425"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`createwallet` doesn't let you specify a fingerprint, so this workaround is probably fine for now.",
      "commit_id" : "96846ef7817257326d51c4f05047ca46c3f7f3c7",
      "created_at" : "2021-12-09T02:54:29Z",
      "diff_hunk" : "@@ -15,11 +15,16 @@\n     assert_equal,\n     assert_raises_rpc_error,\n )\n+from test_framework.authproxy import JSONRPCException\n \n \n class WalletSignerTest(BitcoinTestFramework):\n+    def add_options(self, parser):\n+        parser.add_argument(\"--invalid\", dest=\"invalid\", default=False, action=\"store_true\",\n+                            help=\"Test invalid external signer\")\n+\n     def mock_signer_path(self):\n-        path = os.path.join(os.path.dirname(os.path.realpath(__file__)), 'mocks', 'signer.py')\n+        path = os.path.join(os.path.dirname(os.path.realpath(__file__)), 'mocks', 'invalid_signer.py' if self.options.invalid else 'signer.py')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r765396425",
      "id" : 765396425,
      "in_reply_to_id" : 762682091,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tnwXJ",
      "original_commit_id" : "0221b2cb47c902400ae3e4bbef3149b3d186b669",
      "original_line" : 27,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "test/functional/wallet_signer.py",
      "position" : null,
      "pull_request_review_id" : 827154898,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765396425/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-09T02:54:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765396425",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r765399119"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765399119"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: use a double quote: `Invalid descriptor \\\"\"` because descriptors can already have `'` in them.",
      "commit_id" : "96846ef7817257326d51c4f05047ca46c3f7f3c7",
      "created_at" : "2021-12-09T03:02:53Z",
      "diff_hunk" : "@@ -3203,8 +3203,11 @@ void CWallet::SetupDescriptorScriptPubKeyMans()\n             for (const UniValue& desc_val : descriptor_vals.get_array().getValues()) {\n                 std::string desc_str = desc_val.getValStr();\n                 FlatSigningProvider keys;\n-                std::string dummy_error;\n-                std::unique_ptr<Descriptor> desc = Parse(desc_str, keys, dummy_error, false);\n+                std::string desc_error;\n+                std::unique_ptr<Descriptor> desc = Parse(desc_str, keys, desc_error, false);\n+                if (desc == nullptr) {\n+                    throw std::runtime_error(std::string(__func__) + \": Invalid descriptor '\" + desc_str + \"' (\" + desc_error + \")\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23628#discussion_r765399119",
      "id" : 765399119,
      "line" : 3209,
      "node_id" : "PRRC_kwDOABII584tnxBP",
      "original_commit_id" : "96846ef7817257326d51c4f05047ca46c3f7f3c7",
      "original_line" : 3209,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 9,
      "pull_request_review_id" : 827158480,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23628",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765399119/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-09T03:02:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765399119",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK https://github.com/bitcoin/bitcoin/pull/23628/commits/5493e925013245d5ad0f7ea8784fe07f531803d0\r\n\r\nNice first contribution! Fix is straightforward and well-covered by tests. I did not test this locally.",
      "created_at" : "2021-12-09T15:02:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23628#issuecomment-989934297",
      "id" : 989934297,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23628",
      "node_id" : "IC_kwDOABII5847ATLZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/989934297/reactions"
      },
      "updated_at" : "2021-12-09T15:02:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/989934297",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 5493e925013245d5ad0f7ea8784fe07f531803d0",
      "created_at" : "2021-12-09T16:34:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23628#issuecomment-990017795",
      "id" : 990017795,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23628",
      "node_id" : "IC_kwDOABII5847AnkD",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/990017795/reactions"
      },
      "updated_at" : "2021-12-09T16:34:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/990017795",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   }
]
