[
   {
      "author_association" : "MEMBER",
      "body" : "I really dont see the point in this, if we request a block, and a node lags behind due to some network congestion, and then we get the block later, there is no reason to drop that peer, if the peer is constantly lagging behind, we may want to not request blocks from that peer, but dropping them could kill eg mobile clients.\n",
      "created_at" : "2012-05-22T23:43:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1382#issuecomment-5861884",
      "id" : 5861884,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1382",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4NjE4ODQ=",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/5861884/reactions"
      },
      "updated_at" : "2012-05-22T23:43:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/5861884",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "NACK.\n\nOnly disconnect peers that really misbehave. Any disconnect rule that you add has potential to wreck the network in some (maybe unforseen) circumstances. We should be really careful.\n",
      "created_at" : "2012-05-23T05:10:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1382#issuecomment-5865333",
      "id" : 5865333,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1382",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4NjUzMzM=",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/5865333/reactions"
      },
      "updated_at" : "2012-05-23T05:10:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/5865333",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@TheBlueMatt @laanwj Please can you see Issue #1120 - do we really want to continue having nodes sending thousands of duplicate blocks to each other? If we don't disconnect the peer, then what are the alternative solutions to this problem? By the way, in case it wasn't obvious, this is relating to when a peer is catching up and is more than a thousand blocks behind the best block.\n",
      "created_at" : "2012-05-24T20:31:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1382#issuecomment-5916764",
      "id" : 5916764,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1382",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MTY3NjQ=",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/5916764/reactions"
      },
      "updated_at" : "2012-05-25T09:00:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/5916764",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=4",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "node_id" : "MDQ6VXNlcjE1MzAyODM=",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Duplicated blocks (and tx as well!) are probably caused from client sending `getdata` multiple times in the first place. It occurs when the workload is high, typical situation during initial download. The operation turnaround time might exceed the request resend timeout, triggering the duplicated requests. \n\nSo to proof the node intentionally send duplicated blocks need to do per node based tracking, which I think don't worth the effort.\n\nAlso I'm wondering what's the attack vector by intentionally sending duplicated block / tx. Since recv queue are rate limited by size, its more likely for a malicious node to send duplicated requests, to maximize effectiveness of draining neighbors' bandwidth.\n",
      "created_at" : "2012-06-13T13:29:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1382#issuecomment-6300881",
      "id" : 6300881,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1382",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMDA4ODE=",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/6300881/reactions"
      },
      "updated_at" : "2012-06-13T17:16:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/6300881",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/839287?v=4",
         "events_url" : "https://api.github.com/users/csyangchen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/csyangchen/followers",
         "following_url" : "https://api.github.com/users/csyangchen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/csyangchen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/csyangchen",
         "id" : 839287,
         "login" : "csyangchen",
         "node_id" : "MDQ6VXNlcjgzOTI4Nw==",
         "organizations_url" : "https://api.github.com/users/csyangchen/orgs",
         "received_events_url" : "https://api.github.com/users/csyangchen/received_events",
         "repos_url" : "https://api.github.com/users/csyangchen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/csyangchen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/csyangchen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/csyangchen"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@csyangchen this isn't meant to disconnect to due misbehavoiur, but simply to reduce wasted bandwidth between two nodes. This is a problem still occuring in 0.6.3 with a good internet connection, so unless someone has an alternative suggestion for fixing this, I would appreciate some ACKs please.\n",
      "created_at" : "2012-07-03T13:11:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1382#issuecomment-6733822",
      "id" : 6733822,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1382",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3MzM4MjI=",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/6733822/reactions"
      },
      "updated_at" : "2012-07-03T13:11:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/6733822",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=4",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "node_id" : "MDQ6VXNlcjE1MzAyODM=",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm opposed to disconnecting peers for expected behavior. \n",
      "created_at" : "2012-07-25T18:13:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1382#issuecomment-7257028",
      "id" : 7257028,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1382",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyNTcwMjg=",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/7257028/reactions"
      },
      "updated_at" : "2012-07-25T18:13:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/7257028",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@gmaxwell what do you suggest instead of disconnecting then? Or do you propose that we continue to waste bandwidth as is currently the case?\n",
      "created_at" : "2012-07-26T10:12:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1382#issuecomment-7273877",
      "id" : 7273877,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1382",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyNzM4Nzc=",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/7273877/reactions"
      },
      "updated_at" : "2012-07-26T10:12:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/7273877",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=4",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "node_id" : "MDQ6VXNlcjE1MzAyODM=",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't completely understand the nature of the wasteful behavior and I can't reproduce it in 0.6.3, so I'm unable to make a suggestion.  I'm just reasonably confident that disconnecting peers for expected behavior is not the right thing to do (and among other problems, poses partitioning risk).\n\nThe right thing do to, of course, would be to avoid bad behavior in the first place. Once it's avoided, then you could talk about possibly dumping peers which intentionally misbehave, although O(N) bandwidth attacks are not terribly interesting. (You can flood a peer without ever connecting to its bitcoin, so there is little we can do).\n",
      "created_at" : "2012-07-26T14:02:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1382#issuecomment-7278391",
      "id" : 7278391,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1382",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyNzgzOTE=",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/7278391/reactions"
      },
      "updated_at" : "2012-07-26T14:02:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/7278391",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This targets one highly specific flood, while ignoring all the other flooding possible within the protocol.  An attacker can just pick another message to flood, including messages we don't notice, but do unpack-before-ignoring.\n\nGiven the other two naks, closing.\n",
      "created_at" : "2012-08-01T16:41:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1382#issuecomment-7432535",
      "id" : 7432535,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1382",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0MzI1MzU=",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/7432535/reactions"
      },
      "updated_at" : "2012-08-01T16:41:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/7432535",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=4",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "node_id" : "MDQ6VXNlcjQ5NDQxMQ==",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Looking at the closing comment, I think this pull request has been misunderstood. It is not for protection against any sort of attack. The duplicate blocks happen naturally due to the way bitcoin works, due to the set timeouts, and the delays in the network due to processing. Given that there is no current way for a node to say \"please stop sending me blocks\" to another node that is responding to a request for blocks but took so long that another request was sent out to another node, which started sending the blocks first, the only way to safe the wasted bandwidth (of both nodes), is to disconnect from the node that is lagging behind.\n",
      "created_at" : "2012-09-05T10:26:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1382#issuecomment-8293726",
      "id" : 8293726,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1382",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyOTM3MjY=",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/8293726/reactions"
      },
      "updated_at" : "2012-09-05T10:38:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/8293726",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=4",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "node_id" : "MDQ6VXNlcjE1MzAyODM=",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Just getting started with bitcoin, trying to initialize a wallet, and after days of waiting to catch up, it seems to me the issue being described here is real and some fix would be quite beneficial.  By way of providing some real world data, here are some stats collected from my client's debug log:\n\n```\nexarkun@top:~/.bitcoin$ grep \"already have block\" debug.log  | wc -l\n383867\nexarkun@top:~/.bitcoin$ grep \"ProcessBlock: ACCEPTED\" debug.log  | wc -l\n22486\n```\n\nThat's nearly twenty times more duplicate blocks - redundant, useless traffic - than legitimate, helpful blocks.  If there is no way to tell a peer to stop sending some blocks, and it is not desirable to disconnect from a peer which is now sending unneeded blocks (because they have been retrieved from somewhere else in the meanwhile), then it seems like some other fix at least is needed here.  Perhaps the client shouldn't be so aggressive about sending out duplicate getblocks to multiple peers.  However, as a temporary solution, disconnecting seems sensible to me.  The client will establish connections to other peers (or even the same peers again) and continue exchanging data with them, and having gotten some blocks, _not_ ask for them again over the new connection.\n",
      "created_at" : "2012-11-25T03:37:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1382#issuecomment-10687242",
      "id" : 10687242,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1382",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDEwNjg3MjQy",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/10687242/reactions"
      },
      "updated_at" : "2012-11-25T03:37:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/10687242",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/254565?v=4",
         "events_url" : "https://api.github.com/users/exarkun/events{/privacy}",
         "followers_url" : "https://api.github.com/users/exarkun/followers",
         "following_url" : "https://api.github.com/users/exarkun/following{/other_user}",
         "gists_url" : "https://api.github.com/users/exarkun/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/exarkun",
         "id" : 254565,
         "login" : "exarkun",
         "node_id" : "MDQ6VXNlcjI1NDU2NQ==",
         "organizations_url" : "https://api.github.com/users/exarkun/orgs",
         "received_events_url" : "https://api.github.com/users/exarkun/received_events",
         "repos_url" : "https://api.github.com/users/exarkun/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/exarkun/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/exarkun/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/exarkun"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm glad to see other people confirming this issue. What other options are there other than disconnecting the peer? If peer's utilised more than one connection, then it would be possible to disconnect the transfer without disconnecting the peer, but I'm not sure it's worth coding this just for that reason.\n\nThe problem is exacerbated by the fact that during block validation the peers stops responding to requests, and so once the block validation completes, the peer suddenly sends a load of stuff that the requesting peer no longer needs, so another solution would be to change the code to continue responding to requests even during block validation.\n\n@jgarzik could this be re-opened please?\n",
      "created_at" : "2012-11-25T11:37:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1382#issuecomment-10692534",
      "id" : 10692534,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1382",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDEwNjkyNTM0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/10692534/reactions"
      },
      "updated_at" : "2012-11-25T11:38:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/10692534",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=4",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "node_id" : "MDQ6VXNlcjE1MzAyODM=",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The solution is to remember which block was requested from which peer, and not ask it again (unless the old one is really lagging).\n",
      "created_at" : "2012-11-25T11:39:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1382#issuecomment-10692550",
      "id" : 10692550,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1382",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDEwNjkyNTUw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/10692550/reactions"
      },
      "updated_at" : "2012-11-25T11:39:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/10692550",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@sipa how do you tell if the \"old one is really lagging\"?\n",
      "created_at" : "2012-11-25T11:41:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1382#issuecomment-10692568",
      "id" : 10692568,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1382",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDEwNjkyNTY4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/10692568/reactions"
      },
      "updated_at" : "2012-11-25T11:41:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/10692568",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=4",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "node_id" : "MDQ6VXNlcjE1MzAyODM=",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The core of the problem here is that we have two mechanisms:\n  1) when we think we don't have all blocks, pick a peer to download them all from\n  2) when a new block is announced and we don't have its parents, ask them from the peer who sent it\n\nThe problem is that these two mechanisms don't place nicely together, and when a new block is found during initial syncup, you end up doing both at once. That's purely a local implementation problem - there is no blame to either of the peers involved, so they should not be disconnected for doing what is asked from them.\n\nThe solution is writing something of a download manager, which keeps track of which peers have which blocks, and tries to fetch them, and switch if a peer seems unresponsive. In my opinion, this is only really possible once we have headers-first sync, so the best chain is known before starting the actual block download. This would also mean the download can be parallellized.\n\nThat's not to say we don't need a more immediate solution. It's becoming more and more obvious that the sync mechanism is broken. I think we should aim for a simple solution now which solves the worst, and then really solve it when headers-first is implemented.\n",
      "created_at" : "2012-11-25T11:48:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1382#issuecomment-10692606",
      "id" : 10692606,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1382",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDEwNjkyNjA2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/10692606/reactions"
      },
      "updated_at" : "2012-11-25T11:48:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/10692606",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@sipa No one is suggesting disconnecting a peer for doing what is asked from them. We are suggesting disconnecting peers which are sending _repeatedly and in a sustained fashion_ blocks which are not required.\n\nYou also haven't defined how to determine when a \"peer seems unresponsive\". I posit, that this will always be a guess, and therefore unreliable. The simplest solution IMHO is to simply end the transfer of the unwanted blocks by the only mechanism available currently - disconnection. This will benefit the entire network as currently there is a majority of wasted traffic happening due to these disconnections not happening.\n\nWhat is the disadvantage in disconnection? So far, we have discussed the advantages, and it doesn't appear anyone has suggested any disadvantages. The only reason for not doing this IMHO is if there are significant disadvantages.\n\nI agree that a simple solution is needed, and I think this patch is it. I agree that a better solution could be developed later though.\n",
      "created_at" : "2012-11-25T11:54:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1382#issuecomment-10692656",
      "id" : 10692656,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1382",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDEwNjkyNjU2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/10692656/reactions"
      },
      "updated_at" : "2012-11-25T11:54:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/10692656",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=4",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "node_id" : "MDQ6VXNlcjE1MzAyODM=",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I don't think you get it. Peers only send blocks to us, because we ASK them to send us blocks. There is no code that just sends blocks - it's always in response to a getdata. If we receive the same block twice, it is because we asked it twice. That is our fault, not theirs. The problem is that we ask for blocks both as a sync mechanism, and in response to receiving an orphan.\n\nAs to determining unresponsiveness: some timeout between expecting a block message and the getdata?\n\nRegarding disadvantages: don't kill connections to nodes that behave as expected. You may lose the good ones.\n",
      "created_at" : "2012-11-25T12:02:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1382#issuecomment-10692729",
      "id" : 10692729,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1382",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDEwNjkyNzI5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/10692729/reactions"
      },
      "updated_at" : "2012-11-25T12:03:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/10692729",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@sipa I am aware that peers should only send blocks they've been asked for. There are already timeouts implemented, but these will always be arbitrary and only a guess to determine if a peer is lagging or not. They are therefore not reliable, and IMHO shouldn't be relied on. The problem cannot be fixed by tweaking timeouts, and if timeouts are set too long, then it will cause other problems too.\n\nHow do you define \"good nodes\"? The only nodes this patch will cause us to lose are bad ones - \"bad ones\" being nodes that are repeatedly and consistently sending us blocks we do not want or need. Labelling a node \"good\" just because it's doing what we've asked of it, isn't definitive, IMHO. It can be based on more criteria than this.\n",
      "created_at" : "2012-11-25T12:14:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1382#issuecomment-10692817",
      "id" : 10692817,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1382",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDEwNjkyODE3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/10692817/reactions"
      },
      "updated_at" : "2012-11-25T12:15:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/10692817",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=4",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "node_id" : "MDQ6VXNlcjE1MzAyODM=",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Of course it is always a guess. You cannot know which nodes are good and which aren't for sure.\n\nBut this patch does not fix the problem. The problem is that we request the same block multiple times in certain cases, even when there is no reason to assume the peer is lagging. And then it disconnects peers that do what we ask them.\n",
      "created_at" : "2012-11-25T12:20:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1382#issuecomment-10692859",
      "id" : 10692859,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1382",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDEwNjkyODU5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/10692859/reactions"
      },
      "updated_at" : "2012-11-25T12:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/10692859",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@sipa you're right of course that the code currently does request some blocks multiple times when it doesn't need to, but that is a separate issue and requires a separate patch to fix that. That fix, however, won't eradicate the situation that this patch mitigates.\n\nThere is an argument though that that patch should be a prerequisite patch to this one.\n",
      "created_at" : "2012-11-25T12:22:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1382#issuecomment-10692875",
      "id" : 10692875,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1382",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDEwNjkyODc1",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/10692875/reactions"
      },
      "updated_at" : "2012-11-25T12:24:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/10692875",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=4",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "node_id" : "MDQ6VXNlcjE1MzAyODM=",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I'll try to explain a bit more in detail why this is not a solution, but this is my last comment in this thread.\n\nAssume we are doing initial block synchronization, so we're sending getblocks, receive invs, download blocks, and send a new getblocks. During that time, a new block is found. One node (typically one of the best!) is the first to announce this new block to us, so we download it, see that we don't have its parents, and we go on to request the headers from this good peer that was so kind to announce a new block to us. Now we are doing the getblocks/invs/getdata/blocks/getblocks sequence from two nodes at one: the original one we were synchronizing from, and the one that announced the new best block. You're eventually going to kill one of these - that will temporarily mitigate the situation of course, but the next time a new block is found while you're still not done synchronizing, the same thing repeats all over again. And every time, you have a large chance of killing your best-connected peer.\n\nYou say that requesting the same block multiple times is a separate issue. It is not, it is the only issue. And this is what needs fixing, not killing off peers which do the stupid thing we asked them to.\n",
      "created_at" : "2012-11-25T12:29:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1382#issuecomment-10692926",
      "id" : 10692926,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1382",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDEwNjkyOTI2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/10692926/reactions"
      },
      "updated_at" : "2012-11-25T12:30:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/10692926",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@sipa You're explaining things to me that I already know and understand, and I've already said I agree that there could  be a patch to fix what you are describing in my previous comment, and that that patch might be better done before this one (which is still needed to cater for lagging nodes). You are failing to address the issue of lagging nodes providing blocks already received by lesser-lagging nodes, which is what this patch is intended for.\n\nHaving said that, I think that this patch is still better implemented now rather than waiting for the other patch to be done first.\n",
      "created_at" : "2012-11-25T12:34:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1382#issuecomment-10692976",
      "id" : 10692976,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1382",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDEwNjkyOTc2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/10692976/reactions"
      },
      "updated_at" : "2012-11-25T12:38:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/10692976",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=4",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "node_id" : "MDQ6VXNlcjE1MzAyODM=",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I did some initial work on proper request management a while ago, but never got very far as I was working on bloom filter stuff, you can work on it more if you want: https://github.com/TheBlueMatt/bitcoin/commits/bloom%2Brelayblock\n",
      "created_at" : "2012-11-25T13:13:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1382#issuecomment-10693301",
      "id" : 10693301,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1382",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDEwNjkzMzAx",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/10693301/reactions"
      },
      "updated_at" : "2012-11-25T13:13:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/10693301",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@rebroad What you are seeing is not due to \"lagging peers\", this is pretty easily tested. Sipa explained why you saw this. We only make the request out to one peer (except in the case sipa outlined) so lagging really has nothing to do with it.\n",
      "created_at" : "2013-04-21T03:02:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1382#issuecomment-16715154",
      "id" : 16715154,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1382",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDE2NzE1MTU0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/16715154/reactions"
      },
      "updated_at" : "2013-04-21T03:02:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/16715154",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@gmaxwell a block is requested from another peer if it's not received within 2 minutes. This 2 minutes is rather arbitrary and not a reliable way to determine that a block has failed to be downloaded. It will even request the same block from another peer even when the original peer is currently sending a block. The code behind this could do with some obvious improvements, and the 2 minute delay should be replaced with something not so time based, IMHO. Perhaps start the timer from the point at which block reception stops, rather than from the point of initial request.\n",
      "created_at" : "2013-04-21T16:44:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1382#issuecomment-16732271",
      "id" : 16732271,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1382",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDE2NzMyMjcx",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/16732271/reactions"
      },
      "updated_at" : "2013-04-21T16:44:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/16732271",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=4",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "node_id" : "MDQ6VXNlcjE1MzAyODM=",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I've run into this several times while starting up new nodes. I've always managed to work around it, either by temporarily setting maxconnections=1 and listen=0, or by adding another node under my control that has the current blockchain, or by simply waiting out the duplicate blocks. but if there's a fix available, collectively covering your ears and saying \"lalalala I can't hear you\" might not be the best approach. I appreciate rebroad's efforts to keep shining the light on this issue.\n",
      "created_at" : "2014-01-24T01:50:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1382#issuecomment-33190493",
      "id" : 33190493,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1382",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDMzMTkwNDkz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/33190493/reactions"
      },
      "updated_at" : "2014-01-24T01:50:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/33190493",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/203358?v=4",
         "events_url" : "https://api.github.com/users/jcomeauictx/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jcomeauictx/followers",
         "following_url" : "https://api.github.com/users/jcomeauictx/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jcomeauictx/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jcomeauictx",
         "id" : 203358,
         "login" : "jcomeauictx",
         "node_id" : "MDQ6VXNlcjIwMzM1OA==",
         "organizations_url" : "https://api.github.com/users/jcomeauictx/orgs",
         "received_events_url" : "https://api.github.com/users/jcomeauictx/received_events",
         "repos_url" : "https://api.github.com/users/jcomeauictx/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jcomeauictx/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jcomeauictx/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jcomeauictx"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "See #3514 for a solution that doesn't kill peers that do what we ask.\n",
      "created_at" : "2014-01-24T03:33:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1382#issuecomment-33194780",
      "id" : 33194780,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1382",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDMzMTk0Nzgw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/33194780/reactions"
      },
      "updated_at" : "2014-01-24T03:33:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/33194780",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   }
]
