[
   {
      "author_association" : "MEMBER",
      "body" : "Reviewers: This PR is being discussed in the review club at https://bitcoincore.reviews/19055\r\n\r\n(A `Review club` tag for this PR would be helpful to indicate that review notes and discussion are available there.)",
      "created_at" : "2020-05-26T11:38:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-633971712",
      "id" : 633971712,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMzk3MTcxMg==",
      "updated_at" : "2020-05-26T11:38:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/633971712",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Some history for the context:\r\n* https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014337.html\r\n* based on #10434",
      "created_at" : "2020-05-26T12:02:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-633981639",
      "id" : 633981639,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMzk4MTYzOQ==",
      "updated_at" : "2020-05-26T12:02:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/633981639",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@gzhao408 I think there is a bit of a miscommunication. The term \"rolling\" here just means efficient addition as well as deletion from the set being hashed. There is no actual window, as sets are unordered. Perhaps the term was chosen badly (which would be my fault).\r\n\r\nAll of LtHash, MuHash, and ECMH support incremental addition and deletion. The \"non-rolling\" mention in @fjahr's document refers to the fact that he hasn't implemented continuous UTXO set hashing with these functions, only a from scratch computation. It has nothing to do with what these functions can or can't do.\r\n\r\nThe primary difference between MuHash and ECMH is caching:\r\n\r\n* ECMH is more CPU time overall, but the time is mostly in computing the \"effect\" of a set of additions/deletions; applying that effect to the overall hash is extremely cheap. Furthermore, a 64-byte precomputed \"patch\" per set of additions/deletions can be created, which means a patch could be cached per-transaction, and then very cheaply applied when the transaction confirms. So it allows doing most of the work ahead of time (before the block arrives).\r\n\r\n* MuHash is cheaper overall, but the time is mostly in applying the changes to the overall hash. This means caching isn't very useful (and also the caches would be 768 bytes, which is pretty large). If the intent is computing things in the background, or at block connection time, then this is a better (and simpler) approach.",
      "created_at" : "2020-05-26T16:45:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-634142704",
      "id" : 634142704,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNDE0MjcwNA==",
      "updated_at" : "2020-05-26T16:45:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/634142704",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "AaaAHhhh, thank you @sipa for the clarification! \r\n\r\n> The term \"rolling\" here just means efficient addition as well as deletion from the set being hashed.\r\n> The \"non-rolling\" mention in @fjahr's document refers to the fact that he hasn't implemented continuous UTXO set hashing with these functions\r\n\r\nThis makes a lot more sense; I had thought he meant the hash function itself is rolling/non-rolling. I didn't have much info but was super interested and went for a textbook definition ð now I feel embarrassed. This information is super helpful, thanks!",
      "created_at" : "2020-05-26T17:08:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-634155367",
      "id" : 634155367,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNDE1NTM2Nw==",
      "updated_at" : "2020-05-26T17:08:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/634155367",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/gzhao408/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gzhao408/followers",
         "following_url" : "https://api.github.com/users/gzhao408/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gzhao408/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gzhao408",
         "id" : 25183001,
         "login" : "gzhao408",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/gzhao408/orgs",
         "received_events_url" : "https://api.github.com/users/gzhao408/received_events",
         "repos_url" : "https://api.github.com/users/gzhao408/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gzhao408/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gzhao408/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gzhao408"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> It also seems that ECMH (which is noted as non-rolling) performed better and has a maintainability plus since it's part of Secp256k1.\r\n\r\nPlease also note that there is an implementation of ECMH that is an open pull request to Secp256k1 but it is not merged and has been stale for some time. So the work to get it merged is more or less the same and I don't think there is a big difference in maintainability between having it in core or secp.",
      "created_at" : "2020-05-26T18:44:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-634207235",
      "id" : 634207235,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNDIwNzIzNQ==",
      "updated_at" : "2020-05-26T18:44:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/634207235",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@fjahr I've written a Python implementation of MuHash3072, so it can be more easily tested: https://github.com/sipa/bitcoin/commits/202005_muhash_python (no tests are included, but I've verified it matches the C++ code in a few simple examples).",
      "created_at" : "2020-05-26T21:14:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-634282984",
      "id" : 634282984,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNDI4Mjk4NA==",
      "updated_at" : "2020-05-26T21:14:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/634282984",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-05-26T21:15:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-634283316",
      "id" : 634283316,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNDI4MzMxNg==",
      "updated_at" : "2020-05-26T21:15:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/634283316",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> @fjahr I've written a Python implementation of MuHash3072, so it can be more easily tested: [sipa/bitcoin@`202005_muhash_python` (commits)](https://github.com/sipa/bitcoin/commits/202005_muhash_python) (no tests are included, but I've verified it matches the C++ code in a few simple examples).\r\n\r\nAwesome, I have just pulled it in here and will build further tests on top of it.",
      "created_at" : "2020-05-26T22:22:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-634312013",
      "id" : 634312013,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNDMxMjAxMw==",
      "updated_at" : "2020-05-26T22:22:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/634312013",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased and added a6cf0df104728a587283578735e7f11c5f0f2ae4 which allows the user to use the legacy hash with the use of a flag. This will definitely be squashed but I decided to keep it separate for the moment to make discussions easier in the review club tomorrow. I figured I would need to do something like this anyway in order go through a deprecation cycle with `gettxoutsetinfo`, the question is if that is still needed with the flag. Also added 4438aed09e87de0afb37da64ffb5e7489084e8ab which is @sipa 's python implementation of Muhash, currently unused.",
      "created_at" : "2020-05-26T22:28:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-634314204",
      "id" : 634314204,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNDMxNDIwNA==",
      "updated_at" : "2020-05-26T22:28:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/634314204",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r431080029"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431080029"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ced54242 nit: sort",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-05-27T12:31:37Z",
      "diff_hunk" : "@@ -388,6 +388,8 @@ crypto_libbitcoin_crypto_base_a_SOURCES = \\\n   crypto/hmac_sha512.h \\\n   crypto/poly1305.h \\\n   crypto/poly1305.cpp \\\n+  crypto/muhash.cpp \\\n+  crypto/muhash.h \\",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r431080029",
      "id" : 431080029,
      "line" : 409,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA4MDAyOQ==",
      "original_commit_id" : "4438aed09e87de0afb37da64ffb5e7489084e8ab",
      "original_line" : 409,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/Makefile.am",
      "position" : 4,
      "pull_request_review_id" : 419143541,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431080029",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r431132007"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431132007"
         }
      },
      "author_association" : "MEMBER",
      "body" : "cda20f3 nit: perhaps sort the functions above and this list, e.g. like\r\n\r\n```\r\n$ src/bench/bench_bitcoin -list\r\n...\r\nMuHash, 5, 5000, 0, 0, 0, 0\r\nMuHashAdd, 5, 5000, 0, 0, 0, 0\r\nMuHashDiv, 5, 100, 0, 0, 0, 0\r\nMuHashPrecompute, 5, 5000, 0, 0, 0, 0\r\n\r\n$ src/bench/bench_bitcoin -filter=MuHash*.*\r\n# Benchmark, evals, iterations, total, min, max, median\r\nMuHash, 5, 5000, 0.287426, 7.45603e-06, 1.72302e-05, 1.08339e-05\r\nMuHashAdd, 5, 5000, 0.243778, 7.93741e-06, 1.17234e-05, 9.61388e-06\r\nMuHashDiv, 5, 100, 8.62069, 0.0146344, 0.0216452, 0.0169485\r\nMuHashPrecompute, 5, 5000, 0.0557224, 1.55965e-06, 4.40565e-06, 1.65373e-06\r\n```\r\n",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-05-27T13:30:41Z",
      "diff_hunk" : "@@ -101,3 +166,8 @@ BENCHMARK(SipHash_32b, 40 * 1000 * 1000);\n BENCHMARK(SHA256D64_1024, 7400);\n BENCHMARK(FastRandom_32bit, 110 * 1000 * 1000);\n BENCHMARK(FastRandom_1bit, 440 * 1000 * 1000);\n+\n+BENCHMARK(MuHash, 5000);\n+BENCHMARK(MuHashPrecompute, 5000);\n+BENCHMARK(MuHashAdd, 5000);\n+BENCHMARK(MuHashDiv, 100);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r431132007",
      "id" : 431132007,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTEzMjAwNw==",
      "original_commit_id" : "4438aed09e87de0afb37da64ffb5e7489084e8ab",
      "original_line" : 172,
      "original_position" : 87,
      "original_start_line" : null,
      "path" : "src/bench/crypto_hash.cpp",
      "position" : null,
      "pull_request_review_id" : 419143541,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431132007",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r431151719"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431151719"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ced54242 and cda20f3f nit: in these four functions above `++i` is preferred over `i++` per doc/developer-notes.md\r\n\r\n5d67c47 same for `src/crypto/muhash.h::L71`",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-05-27T13:56:46Z",
      "diff_hunk" : "@@ -91,6 +92,70 @@ static void FastRandom_1bit(benchmark::State& state)\n     }\n }\n \n+static void MuHash(benchmark::State& state)\n+{\n+    FastRandomContext rng(true);\n+    MuHash3072 acc;\n+    unsigned char key[32] = {0};\n+    int i = 0;\n+    while (state.KeepRunning()) {\n+        key[0] = ++i;\n+        acc *= MuHash3072(key);\n+    }\n+}\n+\n+static void MuHashPrecompute(benchmark::State& state)\n+{\n+    FastRandomContext rng(true);\n+    MuHash3072 acc;\n+    unsigned char key[32];\n+    std::vector<unsigned char> randkey = rng.randbytes(32);\n+    for (size_t i = 0; i < randkey.size(); i++) {\n+        key[i] = randkey[i];\n+    }\n+\n+    while (state.KeepRunning()) {\n+        MuHash3072{key};\n+    }\n+}\n+\n+static void MuHashAdd(benchmark::State& state)\n+{\n+    FastRandomContext rng(true);\n+    MuHash3072 acc;\n+    unsigned char key[32];\n+    std::vector<unsigned char> randkey = rng.randbytes(32);\n+    for (size_t i = 0; i < randkey.size(); i++) {\n+        key[i] = randkey[i];\n+    }\n+\n+    MuHash3072 muhash = MuHash3072(key);\n+    while (state.KeepRunning()) {\n+        acc *= muhash;\n+    }\n+}\n+\n+static void MuHashDiv(benchmark::State& state)\n+{\n+    FastRandomContext rng(true);\n+    MuHash3072 acc;\n+    unsigned char key[32];\n+    std::vector<unsigned char> randkey = rng.randbytes(32);\n+    for (size_t i = 0; i < randkey.size(); i++) {\n+        key[i] = randkey[i];\n+    }\n+\n+    MuHash3072 muhash = MuHash3072(key);\n+\n+    for (size_t i = 0; i < state.m_num_iters; i++) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r431151719",
      "id" : 431151719,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTE1MTcxOQ==",
      "original_commit_id" : "4438aed09e87de0afb37da64ffb5e7489084e8ab",
      "original_line" : 150,
      "original_position" : 67,
      "original_start_line" : null,
      "path" : "src/bench/crypto_hash.cpp",
      "position" : null,
      "pull_request_review_id" : 419143541,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431151719",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r431199564"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431199564"
         }
      },
      "author_association" : "MEMBER",
      "body" : "a6cf0df1 could add the new `bool GetUTXOStats()` next to the existing one -- to ease review, I moved them together.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-05-27T14:53:12Z",
      "diff_hunk" : "@@ -66,9 +97,38 @@ bool GetUTXOStats(CCoinsView* view, CCoinsStats& stats, const std::function<void\n         pcursor->Next();\n     }\n     if (!outputs.empty()) {\n-        ApplyStats(stats, ss, prevkey, outputs);\n+        ApplyStats(stats, hash, prevkey, outputs);\n     }\n-    stats.hashSerialized = ss.GetHash();\n+\n+    FinalizeHash(hash, stats);\n+\n     stats.nDiskSize = view->EstimateSize();\n     return true;\n }\n+\n+// The legacy hash serializes the hashBlock\n+void PrepareHash(CHashWriter& hash, CCoinsStats& stats) {\n+    hash << stats.hashBlock;\n+}\n+// Muhash does not need the prepare step\n+void PrepareHash(MuHash3072 hash, CCoinsStats& stats) {}\n+\n+void FinalizeHash(CHashWriter& hash, CCoinsStats& stats) {\n+    stats.hashSerialized = hash.GetHash();\n+}\n+void FinalizeHash(MuHash3072 hash, CCoinsStats& stats) {\n+    unsigned char out[384];\n+    hash.Finalize(out);\n+    stats.hashSerialized = (TruncatedSHA512Writer(SER_DISK, 0) << out).GetHash();\n+}\n+\n+bool GetUTXOStats(CCoinsView *view, CCoinsStats &stats, const std::function<void()>& interruption_point, bool use_muhash)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r431199564",
      "id" : 431199564,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTE5OTU2NA==",
      "original_commit_id" : "4438aed09e87de0afb37da64ffb5e7489084e8ab",
      "original_line" : 125,
      "original_position" : 119,
      "original_start_line" : null,
      "path" : "src/node/coinstats.cpp",
      "position" : null,
      "pull_request_review_id" : 419143541,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431199564",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Also verified that, like your added test in `rpc_blockchain.py`, only `utxo_set_hash` varies between `gettxoutsetinfo` in -regtest with each algo.\r\n\r\n```bash \r\n$ bitcoin-cli -regtest gettxoutsetinfo\r\n{\r\n  \"height\": 15599,\r\n  \"bestblock\": \"6e535bc570f9be1b86d21711b23391e4e8f001682b5c6243883744879cdc4f84\",\r\n  \"transactions\": 3216,\r\n  \"txouts\": 3219,\r\n  \"bogosize\": 234987,\r\n  \"utxo_set_hash\": \"c4926481130f6689950e07e0e1f2060277d349b106a94b83145d577d3db4d225\",\r\n  \"disk_size\": 226234,\r\n  \"total_amount\": 14949.99998350\r\n}\r\n$ bitcoin-cli -regtest gettxoutsetinfo true\r\n{\r\n  \"height\": 15599,\r\n  \"bestblock\": \"6e535bc570f9be1b86d21711b23391e4e8f001682b5c6243883744879cdc4f84\",\r\n  \"transactions\": 3216,\r\n  \"txouts\": 3219,\r\n  \"bogosize\": 234987,\r\n  \"utxo_set_hash\": \"1883e99e56927fd5e3b82ccb9e08acd1be7ed0256d4cafe142626ae2fb66ffb4\",\r\n  \"disk_size\": 226234,\r\n  \"total_amount\": 14949.99998350\r\n}\r\n```",
      "created_at" : "2020-05-27T16:01:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-634764233",
      "id" : 634764233,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNDc2NDIzMw==",
      "updated_at" : "2020-05-27T18:09:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/634764233",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: \"separate\" is misspelled in the commit title of cda20f3f897ff88337756cb0c0345b41cec9014e\r\n\r\nIt might be nice to split this in two PRs: One which adds MuHash, and one which updates `gettxoutsetinfo` to support it. I would definitely at least rebase/squash to put all the MuHash additions first and then layer the functionality changes on top.\r\n\r\nEdited to add thought: The next PR could add rolling as well, so this way we don't have an interim state where `gettxoutsetinfo` is even slower than it is now.",
      "created_at" : "2020-05-27T17:10:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-634809748",
      "id" : 634809748,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNDgwOTc0OA==",
      "updated_at" : "2020-05-27T17:23:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/634809748",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/177646?v=4",
         "events_url" : "https://api.github.com/users/narula/events{/privacy}",
         "followers_url" : "https://api.github.com/users/narula/followers",
         "following_url" : "https://api.github.com/users/narula/following{/other_user}",
         "gists_url" : "https://api.github.com/users/narula/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/narula",
         "id" : 177646,
         "login" : "narula",
         "node_id" : "MDQ6VXNlcjE3NzY0Ng==",
         "organizations_url" : "https://api.github.com/users/narula/orgs",
         "received_events_url" : "https://api.github.com/users/narula/received_events",
         "repos_url" : "https://api.github.com/users/narula/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/narula/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/narula/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/narula"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19145 (Add hash_type MUHASH for gettxoutsetinfo by fjahr)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-05-27T20:04:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-634910640",
      "id" : 634910640,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNDkxMDY0MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-17T05:51:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/634910640",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r431778760"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431778760"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n                    {\"hash_type\", RPCArg::Type::STR, /* default */ \"hash_serialized_2\", \"Which UTXO set hash should be calculated. Options: 'hash_serialized_2' (the legacy algorithm), 'muhash', 'none'.\"},\r\n```\r\n\r\nHow much time is spent on hashing with the legacy hash vs muhash vs none? Imagine someone just wants the `total_amount` as fast as possible.\r\n\r\nIf hashing is slow in general, maybe there should be an option to skip it?",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-05-28T11:53:20Z",
      "diff_hunk" : "@@ -971,7 +971,9 @@ static UniValue gettxoutsetinfo(const JSONRPCRequest& request)\n             RPCHelpMan{\"gettxoutsetinfo\",\n                 \"\\nReturns statistics about the unspent transaction output set.\\n\"\n                 \"Note this call may take some time.\\n\",\n-                {},\n+                {\n+                    {\"legacy_hash\", RPCArg::Type::BOOL, /* default */ \"false\", \"Whether the UTXO set hash should be calculated using the legacy algorithm (not Muhash).\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r431778760",
      "id" : 431778760,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc3ODc2MA==",
      "original_commit_id" : "4438aed09e87de0afb37da64ffb5e7489084e8ab",
      "original_line" : 975,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 420031955,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431778760",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r431944665"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431944665"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It's a good question but based on my tests (with commented out hashing code) the performance impact of `hash_serialized2` is only small. Results were volatile but on average `gettxoutsetinfo` without the hash was only a few seconds faster (5s - 20s faster, an improvement of ~10%). I think it's not really worth adding an option for that if we can have the index instead.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-05-28T15:54:19Z",
      "diff_hunk" : "@@ -971,7 +971,9 @@ static UniValue gettxoutsetinfo(const JSONRPCRequest& request)\n             RPCHelpMan{\"gettxoutsetinfo\",\n                 \"\\nReturns statistics about the unspent transaction output set.\\n\"\n                 \"Note this call may take some time.\\n\",\n-                {},\n+                {\n+                    {\"legacy_hash\", RPCArg::Type::BOOL, /* default */ \"false\", \"Whether the UTXO set hash should be calculated using the legacy algorithm (not Muhash).\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r431944665",
      "id" : 431944665,
      "in_reply_to_id" : 431778760,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk0NDY2NQ==",
      "original_commit_id" : "4438aed09e87de0afb37da64ffb5e7489084e8ab",
      "original_line" : 975,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 420256522,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431944665",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r432425903"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432425903"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thinking about it a little bit more, I think it would be good to have the option for later on when we want to remove the code for `hash_serialized_2`. So I will add it as an option.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-05-29T11:36:13Z",
      "diff_hunk" : "@@ -971,7 +971,9 @@ static UniValue gettxoutsetinfo(const JSONRPCRequest& request)\n             RPCHelpMan{\"gettxoutsetinfo\",\n                 \"\\nReturns statistics about the unspent transaction output set.\\n\"\n                 \"Note this call may take some time.\\n\",\n-                {},\n+                {\n+                    {\"legacy_hash\", RPCArg::Type::BOOL, /* default */ \"false\", \"Whether the UTXO set hash should be calculated using the legacy algorithm (not Muhash).\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r432425903",
      "id" : 432425903,
      "in_reply_to_id" : 431778760,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQyNTkwMw==",
      "original_commit_id" : "4438aed09e87de0afb37da64ffb5e7489084e8ab",
      "original_line" : 975,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 420873318,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432425903",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r432426282"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432426282"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "now out of scope of this PR but will reorg it in the follow-up",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-05-29T11:37:08Z",
      "diff_hunk" : "@@ -66,9 +97,38 @@ bool GetUTXOStats(CCoinsView* view, CCoinsStats& stats, const std::function<void\n         pcursor->Next();\n     }\n     if (!outputs.empty()) {\n-        ApplyStats(stats, ss, prevkey, outputs);\n+        ApplyStats(stats, hash, prevkey, outputs);\n     }\n-    stats.hashSerialized = ss.GetHash();\n+\n+    FinalizeHash(hash, stats);\n+\n     stats.nDiskSize = view->EstimateSize();\n     return true;\n }\n+\n+// The legacy hash serializes the hashBlock\n+void PrepareHash(CHashWriter& hash, CCoinsStats& stats) {\n+    hash << stats.hashBlock;\n+}\n+// Muhash does not need the prepare step\n+void PrepareHash(MuHash3072 hash, CCoinsStats& stats) {}\n+\n+void FinalizeHash(CHashWriter& hash, CCoinsStats& stats) {\n+    stats.hashSerialized = hash.GetHash();\n+}\n+void FinalizeHash(MuHash3072 hash, CCoinsStats& stats) {\n+    unsigned char out[384];\n+    hash.Finalize(out);\n+    stats.hashSerialized = (TruncatedSHA512Writer(SER_DISK, 0) << out).GetHash();\n+}\n+\n+bool GetUTXOStats(CCoinsView *view, CCoinsStats &stats, const std::function<void()>& interruption_point, bool use_muhash)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r432426282",
      "id" : 432426282,
      "in_reply_to_id" : 431199564,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQyNjI4Mg==",
      "original_commit_id" : "4438aed09e87de0afb37da64ffb5e7489084e8ab",
      "original_line" : 125,
      "original_position" : 119,
      "original_start_line" : null,
      "path" : "src/node/coinstats.cpp",
      "position" : null,
      "pull_request_review_id" : 420873836,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432426282",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r432426338"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432426338"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-05-29T11:37:15Z",
      "diff_hunk" : "@@ -91,6 +92,70 @@ static void FastRandom_1bit(benchmark::State& state)\n     }\n }\n \n+static void MuHash(benchmark::State& state)\n+{\n+    FastRandomContext rng(true);\n+    MuHash3072 acc;\n+    unsigned char key[32] = {0};\n+    int i = 0;\n+    while (state.KeepRunning()) {\n+        key[0] = ++i;\n+        acc *= MuHash3072(key);\n+    }\n+}\n+\n+static void MuHashPrecompute(benchmark::State& state)\n+{\n+    FastRandomContext rng(true);\n+    MuHash3072 acc;\n+    unsigned char key[32];\n+    std::vector<unsigned char> randkey = rng.randbytes(32);\n+    for (size_t i = 0; i < randkey.size(); i++) {\n+        key[i] = randkey[i];\n+    }\n+\n+    while (state.KeepRunning()) {\n+        MuHash3072{key};\n+    }\n+}\n+\n+static void MuHashAdd(benchmark::State& state)\n+{\n+    FastRandomContext rng(true);\n+    MuHash3072 acc;\n+    unsigned char key[32];\n+    std::vector<unsigned char> randkey = rng.randbytes(32);\n+    for (size_t i = 0; i < randkey.size(); i++) {\n+        key[i] = randkey[i];\n+    }\n+\n+    MuHash3072 muhash = MuHash3072(key);\n+    while (state.KeepRunning()) {\n+        acc *= muhash;\n+    }\n+}\n+\n+static void MuHashDiv(benchmark::State& state)\n+{\n+    FastRandomContext rng(true);\n+    MuHash3072 acc;\n+    unsigned char key[32];\n+    std::vector<unsigned char> randkey = rng.randbytes(32);\n+    for (size_t i = 0; i < randkey.size(); i++) {\n+        key[i] = randkey[i];\n+    }\n+\n+    MuHash3072 muhash = MuHash3072(key);\n+\n+    for (size_t i = 0; i < state.m_num_iters; i++) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r432426338",
      "id" : 432426338,
      "in_reply_to_id" : 431151719,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQyNjMzOA==",
      "original_commit_id" : "4438aed09e87de0afb37da64ffb5e7489084e8ab",
      "original_line" : 150,
      "original_position" : 67,
      "original_start_line" : null,
      "path" : "src/bench/crypto_hash.cpp",
      "position" : null,
      "pull_request_review_id" : 420873910,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432426338",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r432426405"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432426405"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-05-29T11:37:23Z",
      "diff_hunk" : "@@ -101,3 +166,8 @@ BENCHMARK(SipHash_32b, 40 * 1000 * 1000);\n BENCHMARK(SHA256D64_1024, 7400);\n BENCHMARK(FastRandom_32bit, 110 * 1000 * 1000);\n BENCHMARK(FastRandom_1bit, 440 * 1000 * 1000);\n+\n+BENCHMARK(MuHash, 5000);\n+BENCHMARK(MuHashPrecompute, 5000);\n+BENCHMARK(MuHashAdd, 5000);\n+BENCHMARK(MuHashDiv, 100);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r432426405",
      "id" : 432426405,
      "in_reply_to_id" : 431132007,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQyNjQwNQ==",
      "original_commit_id" : "4438aed09e87de0afb37da64ffb5e7489084e8ab",
      "original_line" : 172,
      "original_position" : 87,
      "original_start_line" : null,
      "path" : "src/bench/crypto_hash.cpp",
      "position" : null,
      "pull_request_review_id" : 420873991,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432426405",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r432426468"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432426468"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-05-29T11:37:31Z",
      "diff_hunk" : "@@ -388,6 +388,8 @@ crypto_libbitcoin_crypto_base_a_SOURCES = \\\n   crypto/hmac_sha512.h \\\n   crypto/poly1305.h \\\n   crypto/poly1305.cpp \\\n+  crypto/muhash.cpp \\\n+  crypto/muhash.h \\",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r432426468",
      "id" : 432426468,
      "in_reply_to_id" : 431080029,
      "line" : 409,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQyNjQ2OA==",
      "original_commit_id" : "4438aed09e87de0afb37da64ffb5e7489084e8ab",
      "original_line" : 409,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/Makefile.am",
      "position" : 4,
      "pull_request_review_id" : 420874073,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432426468",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "It looks like you removed a bunch of code, and the functional tests, in the last push? If yes, review effort is being thrown away, and perhaps the PR description needs to be updated.",
      "created_at" : "2020-05-29T12:51:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-635955599",
      "id" : 635955599,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNTk1NTU5OQ==",
      "updated_at" : "2020-05-29T12:52:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/635955599",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> It looks like you removed a bunch of code, and the functional tests, in the last push? If yes, review effort is being thrown away, and perhaps the PR description needs to be updated.\r\n\r\nYes, I am writing an update at the moment",
      "created_at" : "2020-05-29T12:53:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-635956325",
      "id" : 635956325,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNTk1NjMyNQ==",
      "updated_at" : "2020-05-29T12:53:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/635956325",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> nit: \"separate\" is misspelled in the commit title of [cda20f3](https://github.com/bitcoin/bitcoin/commit/cda20f3f897ff88337756cb0c0345b41cec9014e)\r\n\r\ndone\r\n\r\n",
      "created_at" : "2020-05-29T12:53:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-635956487",
      "id" : 635956487,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNTk1NjQ4Nw==",
      "updated_at" : "2020-05-29T12:53:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/635956487",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for all the reviews so far! I have addressed comments and, based on feedback from the PR review club and others, split it up further to make reviews more manageable and keep discussions more focussed. This now only adds the implementation of `Muhash3072` and `TruncatedSHA512` in C++. The next in the series is https://github.com/bitcoin/bitcoin/pull/19105 and will only add the Python implementation. A PR review club on it will give another chance to dive deeper into implementation details of Muhash3072. The third PR will add let the user use `gettxoutsetinfo` with Muhash, taking feedback into account (WIP). Progress of the different pull requests is now tracked in #18000 (top of the description).",
      "created_at" : "2020-05-29T13:03:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-635960689",
      "id" : 635960689,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNTk2MDY4OQ==",
      "updated_at" : "2020-05-29T13:03:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/635960689",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> * This PR essentially makes `gettxoutsetinfo` too slow to be useable in testnet and mainnet (it times out and raises after 15 minutes); for that reason, until the -coinstatsindex in #18000 is merged, the MuHash algorithm should be opt-in for rpc `gettxoutsetinfo` and not the default\r\n\r\nWill do so in the follow-up that adds the option to the RPC.\r\n\r\n> * What are your plans regarding ECMH?\r\n\r\nI don't have plans for it unless there is a reason to reconsider it as the algorithm of choice over Muhash. The branch with the ECMH implementation in secp256k1 is still there if people want to play with it.\r\n\r\n> * it looks like `TruncatedSHA512Writer` could use unit tests (perhaps just sanity checks if not viable to use test vectors, `CHashWriter` is also not tested directly but used by other unit tests: addrman, hash, sighash)\r\n\r\nI have laid out some thoughts on it [here]( https://github.com/bitcoin/bitcoin/pull/18000#issuecomment-629296641) why it is hard to add meaningful unit tests. I am still thinking about a better solution and might add an implementation of SHA512/256. There is a single sanity check at the bottom of the Muhash test at least. \r\n\r\n> * a fuzz harness would be ideal\r\n\r\nYeah, as I mention in my answer to Sjors, I would like to add it as a follow-up.\r\n\r\n> * do you plan to add tests using the just-added Python MuHash3072 implementation?\r\n\r\n Yes\r\n\r\n> * [06ae4ab](https://github.com/bitcoin/bitcoin/commit/06ae4ab04f010b24bad03ea6a3c728848cd28545) commit message s/256/512/?\r\n\r\ndone\r\n\r\n> * [04d088d](https://github.com/bitcoin/bitcoin/commit/04d088da106d8c7df0d629d21416c824d6568d18) commit message could mention the renaming of `hash_serialized_2` to `utxo_set_hash` and why it was changed (I didn't see any explanation anywhere)\r\n\r\nI was going back and forth on this, which is probably why it is not mentioned. Initially it was named `muhash`, then I thought it should be more general name that makes more sense to the user. But now my tendency is back to naming it muhash, since we want to keep `hash_serialized_2` for longer and there is no guarantee that there will not be another algo used some time in the future which would mean we would probably need to rename it again in order to avoid confusion.\r\n\r\n> * [04d088d](https://github.com/bitcoin/bitcoin/commit/04d088da106d8c7df0d629d21416c824d6568d18) and [a6cf0df](https://github.com/bitcoin/bitcoin/commit/a6cf0df104728a587283578735e7f11c5f0f2ae4) ought to be squashed to one commit; keeping them separate unnecessarily complicates reviewing -- I squashed them locally in order to see the relevant diff, as ApplyStats() is weird enough to review already\r\n\r\nYes, done in follow-up pr\r\n\r\n> * at some point you'll want to add a release note\r\n\r\nyepp\r\n",
      "created_at" : "2020-05-29T13:17:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-635967249",
      "id" : 635967249,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNTk2NzI0OQ==",
      "updated_at" : "2020-05-29T13:17:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/635967249",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think it'd be easier to review this code if the PR didn't include the ASM implementation.",
      "created_at" : "2020-06-05T18:29:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-639690930",
      "id" : 639690930,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzOTY5MDkzMA==",
      "updated_at" : "2020-06-05T18:29:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/639690930",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r436143516"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/436143516"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This is now implemented in #19145.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-06-05T20:14:59Z",
      "diff_hunk" : "@@ -971,7 +971,9 @@ static UniValue gettxoutsetinfo(const JSONRPCRequest& request)\n             RPCHelpMan{\"gettxoutsetinfo\",\n                 \"\\nReturns statistics about the unspent transaction output set.\\n\"\n                 \"Note this call may take some time.\\n\",\n-                {},\n+                {\n+                    {\"legacy_hash\", RPCArg::Type::BOOL, /* default */ \"false\", \"Whether the UTXO set hash should be calculated using the legacy algorithm (not Muhash).\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r436143516",
      "id" : 436143516,
      "in_reply_to_id" : 431778760,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE0MzUxNg==",
      "original_commit_id" : "4438aed09e87de0afb37da64ffb5e7489084e8ab",
      "original_line" : 975,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 425598449,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/436143516",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I think it'd be easier to review this code if the PR didn't include the ASM implementation.\r\n\r\nYeah, I can split that out easily as well.",
      "created_at" : "2020-06-05T20:16:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-639776914",
      "id" : 639776914,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzOTc3NjkxNA==",
      "updated_at" : "2020-06-05T20:16:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/639776914",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ASM optimizations moved to https://github.com/bitcoin/bitcoin/pull/19181",
      "created_at" : "2020-06-05T20:24:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-639783978",
      "id" : 639783978,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzOTc4Mzk3OA==",
      "updated_at" : "2020-06-05T20:24:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/639783978",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Is there a particular reason for sha512?  Although for some sizes it can be faster w/ a totally naive implementation It is a lot slower on hardware with sha-ni (and presumably somewhat slower than a parallel implementation using 8-way avx sha256).",
      "created_at" : "2020-06-07T07:22:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-640169988",
      "id" : 640169988,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MDE2OTk4OA==",
      "updated_at" : "2020-06-07T07:22:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/640169988",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@gmaxwell I assume it's SHA512 because of my original code used that. I've pointed out to @fjahr that we should benchmark if SHA256 isn't faster these days (on x86_64, I expect it to be). I hadn't thought of the possibility of parallellizing; that should shift things even further in favor of SHA256.\r\n\r\nFWIW, the original reason was that for typical UTXOs, only one SHA512 compression is enough (it'd be over 55 bytes but below 119), and at the time this was first written, a SHA256 compression on x86_64 was less than twice as fast as a SHA512 one.",
      "created_at" : "2020-06-07T16:33:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-640244825",
      "id" : 640244825,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MDI0NDgyNQ==",
      "updated_at" : "2020-06-07T18:32:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/640244825",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> a SHA256 compression on x86_64 was less than twice as fast as a SHA512 one.\r\n\r\nRight, that was my comment on naive code.\r\n\r\n> I hadn't thought of the possibility of parallellizing; that should shift things even further in favor of SHA256.\r\n\r\nWell, make sha256 preferable on more hardware and not just hardware with sha-ni or similar...\r\n\r\n(FWIW, the muhash updating itself could also be parallelized presumably with good effect)\r\n",
      "created_at" : "2020-06-07T18:46:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-640262224",
      "id" : 640262224,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MDI2MjIyNA==",
      "updated_at" : "2020-06-07T18:46:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/640262224",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I finally got around to run these benchmarks and it appears that Truncated512 is still significantly faster on my hardware (`Intel(R) Core(TM) i5-6287U CPU @ 3.10GHz`). But I have seen some strange benchmarks before on this machine, so it would be great if others could run them as well. I pushed the code in a new commit, I can remove it again if it is not valuable enough to keep.\r\n\r\n`SHA256` results (100 bytes):\r\n```\r\n$ src/bench/bench_bitcoin -filter=SHA256_100b -evals=50\r\n# Benchmark, evals, iterations, total, min, max, median\r\nSHA256_100b, 50, 1000000, 38.3667, 6.93112e-07, 9.39267e-07, 7.40312e-07\r\nSHA256_100b, 50, 1000000, 38.4717, 6.93757e-07, 1.08095e-06, 7.47834e-07\r\nSHA256_100b, 50, 1000000, 40.7169, 7.07437e-07, 1.11799e-06, 8.01852e-07\r\n```\r\n\r\n`TruncatedSHA512Writer` results (100 bytes):\r\n```\r\n$ src/bench/bench_bitcoin -filter=TruncatedSHA512_100b -evals=50\r\n# Benchmark, evals, iterations, total, min, max, median\r\nTruncatedSHA512_100b, 50, 1000000, 21.6684, 4.17094e-07, 4.98784e-07, 4.30721e-07\r\nTruncatedSHA512_100b, 50, 1000000, 22.3288, 4.17564e-07, 5.26341e-07, 4.46433e-07\r\nTruncatedSHA512_100b, 50, 1000000, 21.9103, 4.17407e-07, 5.02515e-07, 4.33787e-07\r\n```",
      "created_at" : "2020-06-08T15:24:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-640699423",
      "id" : 640699423,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MDY5OTQyMw==",
      "updated_at" : "2020-06-08T15:24:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/640699423",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@fjahr It seems the benchmarking framework isn't calling the SHA256AutoDetect() function, which would enable hardware-accelerated versions of SHA256. See #19214 for a fix.\r\n\r\nWith that fixed, I get (on my SHA-NI enabled machine):\r\n\r\n```\r\n$ ./src/bench/bench_bitcoin -filter='.*100b' -evals=50\r\n# Benchmark, evals, iterations, total, min, max, median\r\nSHA256_100b, 50, 1000000, 4.73236, 9.27549e-08, 1.35582e-07, 9.35812e-08\r\nTruncatedSHA512_100b, 50, 1000000, 18.3907, 3.63877e-07, 3.88716e-07, 3.67614e-07\r\n```\r\n\r\nAnd on a machine without SHA-NI (but with AVX2):\r\n```\r\n$ ./src/bench/bench_bitcoin -filter='.*100b.*' -evals=50\r\n# Benchmark, evals, iterations, total, min, max, median\r\nSHA256_100b, 50, 1000000, 30.8421, 6.10718e-07, 6.40862e-07, 6.14576e-07\r\nTruncatedSHA512_100b, 50, 1000000, 28.2434, 5.57851e-07, 5.87092e-07, 5.62717e-07\r\n```\r\n\r\nSo it seems @gmaxwell's intuition above was right, that non-parallel SHA256 is only preferable on SHA-NI enabled machines. If we'd consider parallellizing updates (e.g. cache up 8 added/deleted UTXOs in the MuHash object itself, and then processing them all at once), SHA256 is probably a win over SHA512 on most modern x86_64 systems.",
      "created_at" : "2020-06-08T18:04:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-640785035",
      "id" : 640785035,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MDc4NTAzNQ==",
      "updated_at" : "2020-06-08T18:57:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/640785035",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@sipa Thanks for your help! Then I will change the code to use SHA256 which should simplify work for reviewers as well.",
      "created_at" : "2020-06-08T20:41:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-640875012",
      "id" : 640875012,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MDg3NTAxMg==",
      "updated_at" : "2020-06-08T20:41:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/640875012",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. I'm still worried about a lack of test vectors.\r\n\r\nIt would be useful to rebase #18000 whenever individual PRs are close to merge-ready. It allows reviewers to sanity check that the end result still produces a blazing fast `gettxoutsetinfo` and that the index builds in reasonable time.\r\n\r\nI'm copying the discussion about `TruncatedSHA256Writer` unit tests here (if only to get it in the merge commit):\r\n\r\n> I am currently a bit unsure of what the right way to go is for this. A first observation is that `CHashWriter` is also untested. I think both these classes are pretty thin wrappers of the actual hash functions they use, so a test might not provide much value. But `TruncatedSHA256Writer` does a bit more, so I think it could still be valuable to have a sanity check test. I was looking for any test vectors provided for [SHA-512/256](https://eprint.iacr.org/2010/548.pdf) and while there are is no official set, at least [these](https://csrc.nist.gov/csrc/media/projects/cryptographic-standards-and-guidelines/documents/examples/sha512_256.pdf) could be enough for a sanity check. However, the problem is that for SHA-512/256 different initializers are used. We reuse SHA-512 for simplicity reasons, I guess. It's easy enough to add the other initializers. I am just not sure it worth the additional review effort. Another fact that I stumbled over, is that the serializer used here is writing the null character of a string into the hash, where I am not sure if that is a bug but it certainly makes working with test vectors hard.\r\n> \r\n> So, I am not sure if adding SHA-512/256 is worth it. And I am also unsure if a test for `TruncatedSHA256Writer` would be valuable without test vectors and given the only limited logic inside the class.\r\n\r\nAnd your comment above:\r\n\r\n> I am still thinking about a better solution and might add an implementation of SHA512/256. There is a single sanity check at the bottom of the Muhash test at least.\r\n\r\nThe performance discussion above suggests dropping 0104b7f33230f8bde09c5a2fb1d8ef4243f2ab1d entirely, which would render the above discussion moot. I'll wait with reviewing until that's settled.",
      "created_at" : "2020-06-09T10:36:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-641201795",
      "id" : 641201795,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MTIwMTc5NQ==",
      "updated_at" : "2020-06-09T10:36:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/641201795",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r437326492"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437326492"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe link to the paper and mailinglist discussion here:\r\n* https://cseweb.ucsd.edu/~mihir/papers/inchash.pdf (explains MuHASH in general terms)\r\n* https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014337.html (picks SHA512 and ChaCha20)",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-06-09T11:07:41Z",
      "diff_hunk" : "@@ -0,0 +1,77 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+#include <stdint.h>\n+\n+struct Num3072 {\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_type;\n+    typedef uint64_t limb_type;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_type;\n+    typedef uint32_t limb_type;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_type limbs[LIMBS];\n+};\n+\n+/** A class representing MuHash sets",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r437326492",
      "id" : 437326492,
      "line" : 62,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzMyNjQ5Mg==",
      "original_commit_id" : "d11910b38fab4e3c51be6fcd3c807e4d11ee8669",
      "original_line" : 62,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : 62,
      "pull_request_review_id" : 427030918,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437326492",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "We should consider switching to the latest `ChaCha20` per RFC 8439, which may or may not produce a different `MuHash3072`. See #19225",
      "created_at" : "2020-06-09T14:51:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-641348347",
      "id" : 641348347,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MTM0ODM0Nw==",
      "updated_at" : "2020-06-09T14:51:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/641348347",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r437515881"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437515881"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Let's add some info about the choice of SHA256 + ChaCha20 here. It essentially compresses the item (e.g. a serialised UTXO) into 3072 bits. Because ChaCha20 doesn't compress - it's designed for encryption - we feed it a SHA256() hash; it then decompresses that 256 bits into 3072.\r\n\r\nWhy 3072 bits? Because it's safe enough, according to @sipa's mailinglist post:\r\n```\r\nThankfully, [6] also shows that the k-sum problem cannot be\r\nefficiently solved in groups in which the discrete logarithm problem\r\nis hard, as an efficient k-sum solver can be used to compute discrete\r\nlogarithms. As a result, MuHash modulo a sufficiently large safe prime\r\nis provably secure under the DL assumption. Common guidelines on\r\nsecurity parameters [7] say that 3072-bit DL has about 128 bits of\r\nsecurity. A final 256-bit hash can be applied to the 3072-bit result\r\nwithout loss of security to reduce the final size.\r\n```\r\n\r\nIIUC we could apply any other digest on a serialised UTXO as long as it produces at least ~3000 bits. Since sha256 and ChaCha20 are well studied an we use them for other things, they do the job.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-06-09T15:22:14Z",
      "diff_hunk" : "@@ -0,0 +1,77 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+#include <stdint.h>\n+\n+struct Num3072 {\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_type;\n+    typedef uint64_t limb_type;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_type;\n+    typedef uint32_t limb_type;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_type limbs[LIMBS];\n+};\n+\n+/** A class representing MuHash sets\n+ *\n+ * MuHash is a hashing algorithm that supports adding set elements in any\n+ * order but also deleting in any order. As a result, it can maintain a\n+ * running sum for a set of data as a whole, and add/subtract when data\n+ * is added to or removed from it. A downside of MuHash is that computing\n+ * an inverse is relatively expensive. This can be solved by representing\n+ * the running value as a fraction, and multiplying added elements into\n+ * the numerator and removed elements into the denominator. Only when the\n+ * final hash is desired, a single modular inverse and multiplication is\n+ * needed to combine the two.\n+ *\n+ * As the update operations are also associative, H(a)+H(b)+H(c)+H(d) can\n+ * in fact be computed as (H(a)+H(b)) + (H(c)+H(d)). This implies that\n+ * all of this is perfectly parallellizable: each thread can process an\n+ * arbitrary subset of the update operations, allowing them to be\n+ * efficiently combined later.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r437515881",
      "id" : 437515881,
      "line" : 79,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUxNTg4MQ==",
      "original_commit_id" : "d11910b38fab4e3c51be6fcd3c807e4d11ee8669",
      "original_line" : 79,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : 79,
      "pull_request_review_id" : 427275640,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437515881",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "From the PR Review club minutes: https://bitcoincore.reviews/19055.html#l-195\r\n\r\n> sipa toÂ fjahr: if you're going to cache the hash for every block... that's actually an argument in favor of ECMH, as the minimal \"state\" to keep for ECMH is 33 bytes only, while for MuHash it's 384 bytes\r\n\r\nAnd above:\r\n\r\n> The primary difference between MuHash and ECMH is caching:\r\n> \r\n> * ECMH is more CPU time overall, but the time is mostly in computing the \"effect\" of a set of additions/deletions; applying that effect to the overall hash is extremely cheap. Furthermore, a 64-byte precomputed \"patch\" per set of additions/deletions can be created, which means a patch could be cached per-transaction, and then very cheaply applied when the transaction confirms. So it allows doing most of the work ahead of time (before the block arrives).\r\n> * MuHash is cheaper overall, but the time is mostly in applying the changes to the overall hash. This means caching isn't very useful (and also the caches would be 768 bytes, which is pretty large). If the intent is computing things in the background, or at block connection time, then this is a better (and simpler) approach.\r\n\r\nWe should probably clarify what's meant with \"caching\".\r\n\r\nWith `-coinstatsindex` we store the UTXO set hash for every height. This makes the RPC blazing fast. With MuHash it uses ~500 MB for the current chain vs 39 MB with ECMH. The latter is so small I can see us turning that on by default one day (assuming ECMH calculation adds negligible overhead to IBD). But 500 MB isn't unacceptable for an advanced user who needs `gettxoutsetinfo` (disclaimer: yours truly [needs the index](https://github.com/BitMEXResearch/forkmonitor/issues/139), but has no use for any hash).\r\n\r\nWhen you don't have the index enabled, MuHash is faster than ECMH, but both are unacceptably slow for anyone using the feature more than once. So in practice I expect anyone who needs this feature to turn on the index.\r\n\r\nAssuming this feature is mostly used with an index, then ECMH seems the better option in terms of storage.\r\n\r\nConceptionally I find MuHash very simple and we have all the ingredients here. We might as well use it for the initial `-coinstatsindex`, and add ECMH later, as well as any briljant other ideas.",
      "created_at" : "2020-06-09T16:35:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-641420023",
      "id" : 641420023,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MTQyMDAyMw==",
      "updated_at" : "2020-06-09T16:35:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/641420023",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r438026185"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438026185"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : ">  Because ChaCha20 doesn't compress - it's designed for encryption - we feed it a SHA256() hash; it then decompresses that 256 bits into 3072.\r\n\r\nI think that argument is a little too ad-hoc for serious crypto. The MuHash paper assumes that elements are first hashed with a hash function that they model as a random oracle (RO). Now while SHA256 with fixed inputs itself is a good choice for something modeled as a RO, this is not immediately clear to me for `ChaCha20-3072-bits(key=SHA256(.))`, even though that looks okay.\r\n\r\nIf SHA256 is modeled as a RO and ChaCha20 as an ideal cipher, then this is probably good. And MuHash assumes a RO but AFACT then relies only on the fact that the outputs are uniformly and independently distributed over the target group (see [Lemma 3.1 in the paper](https://cseweb.ucsd.edu/~mihir/papers/inchash.pdf)) and there is no RO-programming or other advanced stuff involved. And indeed, `ChaCha20-3072-bits(key=SHA256(.))` should be negligibly close to this, even if we just assume that ChaCha20 is a PRF instead of an ideal cipher. But this requires some more attention and some more eyes.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-06-10T10:35:36Z",
      "diff_hunk" : "@@ -0,0 +1,77 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+#include <stdint.h>\n+\n+struct Num3072 {\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_type;\n+    typedef uint64_t limb_type;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_type;\n+    typedef uint32_t limb_type;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_type limbs[LIMBS];\n+};\n+\n+/** A class representing MuHash sets\n+ *\n+ * MuHash is a hashing algorithm that supports adding set elements in any\n+ * order but also deleting in any order. As a result, it can maintain a\n+ * running sum for a set of data as a whole, and add/subtract when data\n+ * is added to or removed from it. A downside of MuHash is that computing\n+ * an inverse is relatively expensive. This can be solved by representing\n+ * the running value as a fraction, and multiplying added elements into\n+ * the numerator and removed elements into the denominator. Only when the\n+ * final hash is desired, a single modular inverse and multiplication is\n+ * needed to combine the two.\n+ *\n+ * As the update operations are also associative, H(a)+H(b)+H(c)+H(d) can\n+ * in fact be computed as (H(a)+H(b)) + (H(c)+H(d)). This implies that\n+ * all of this is perfectly parallellizable: each thread can process an\n+ * arbitrary subset of the update operations, allowing them to be\n+ * efficiently combined later.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r438026185",
      "id" : 438026185,
      "in_reply_to_id" : 437515881,
      "line" : 79,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODAyNjE4NQ==",
      "original_commit_id" : "d11910b38fab4e3c51be6fcd3c807e4d11ee8669",
      "original_line" : 79,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : 79,
      "pull_request_review_id" : 427926624,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438026185",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1071625?v=4",
         "events_url" : "https://api.github.com/users/real-or-random/events{/privacy}",
         "followers_url" : "https://api.github.com/users/real-or-random/followers",
         "following_url" : "https://api.github.com/users/real-or-random/following{/other_user}",
         "gists_url" : "https://api.github.com/users/real-or-random/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/real-or-random",
         "id" : 1071625,
         "login" : "real-or-random",
         "node_id" : "MDQ6VXNlcjEwNzE2MjU=",
         "organizations_url" : "https://api.github.com/users/real-or-random/orgs",
         "received_events_url" : "https://api.github.com/users/real-or-random/received_events",
         "repos_url" : "https://api.github.com/users/real-or-random/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/real-or-random/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/real-or-random/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/real-or-random"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Another data point is the implementation complexity (code lines etc). If we want arithmetic incl. ASM here, this needs to be maintained whereas for ECMH the basic primitives may just be there already there in secp256k1. Not sure if that makes a large difference but it's something to keep in mind.",
      "created_at" : "2020-06-10T12:05:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-641958916",
      "id" : 641958916,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MTk1ODkxNg==",
      "updated_at" : "2020-06-10T12:05:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/641958916",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1071625?v=4",
         "events_url" : "https://api.github.com/users/real-or-random/events{/privacy}",
         "followers_url" : "https://api.github.com/users/real-or-random/followers",
         "following_url" : "https://api.github.com/users/real-or-random/following{/other_user}",
         "gists_url" : "https://api.github.com/users/real-or-random/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/real-or-random",
         "id" : 1071625,
         "login" : "real-or-random",
         "node_id" : "MDQ6VXNlcjEwNzE2MjU=",
         "organizations_url" : "https://api.github.com/users/real-or-random/orgs",
         "received_events_url" : "https://api.github.com/users/real-or-random/received_events",
         "repos_url" : "https://api.github.com/users/real-or-random/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/real-or-random/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/real-or-random/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/real-or-random"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r438102500"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438102500"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> I think that argument is a little too ad-hoc for serious crypto.\r\n\r\nCompletely agree. I'm trying to tease out what we know. For the purpose of an index it doesn't matter too much. We can use MuHash to experiment with this concept, and abandon it for something better. By the time anyone proposes to use this for consensus, we'll need a much stronger proof.\r\n\r\nThat said, there should be strongly worded warnings in the header, because other project might prematurely run with this if it \"works in Bitcoin\". ",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-06-10T13:00:47Z",
      "diff_hunk" : "@@ -0,0 +1,77 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+#include <stdint.h>\n+\n+struct Num3072 {\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_type;\n+    typedef uint64_t limb_type;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_type;\n+    typedef uint32_t limb_type;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_type limbs[LIMBS];\n+};\n+\n+/** A class representing MuHash sets\n+ *\n+ * MuHash is a hashing algorithm that supports adding set elements in any\n+ * order but also deleting in any order. As a result, it can maintain a\n+ * running sum for a set of data as a whole, and add/subtract when data\n+ * is added to or removed from it. A downside of MuHash is that computing\n+ * an inverse is relatively expensive. This can be solved by representing\n+ * the running value as a fraction, and multiplying added elements into\n+ * the numerator and removed elements into the denominator. Only when the\n+ * final hash is desired, a single modular inverse and multiplication is\n+ * needed to combine the two.\n+ *\n+ * As the update operations are also associative, H(a)+H(b)+H(c)+H(d) can\n+ * in fact be computed as (H(a)+H(b)) + (H(c)+H(d)). This implies that\n+ * all of this is perfectly parallellizable: each thread can process an\n+ * arbitrary subset of the update operations, allowing them to be\n+ * efficiently combined later.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r438102500",
      "id" : 438102500,
      "in_reply_to_id" : 437515881,
      "line" : 79,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODEwMjUwMA==",
      "original_commit_id" : "d11910b38fab4e3c51be6fcd3c807e4d11ee8669",
      "original_line" : 79,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : 79,
      "pull_request_review_id" : 428026795,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438102500",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> With `-coinstatsindex` we store the UTXO set hash for every height. This makes the RPC blazing fast. With MuHash it uses ~500 MB for the current chain vs 39 MB with ECMH. The latter is so small I can see us turning that on by default one day (assuming ECMH calculation adds negligible overhead to IBD). But 500 MB isn't unacceptable for an advanced user who needs `gettxoutsetinfo` (disclaimer: yours truly [needs the index](https://github.com/BitMEXResearch/forkmonitor/issues/139), but has no use for any hash).\r\n> \r\n> When you don't have the index enabled, MuHash is faster than ECMH, but both are unacceptably slow for anyone using the feature more than once. So in practice I expect anyone who needs this feature to turn on the index.\r\n> \r\n> Assuming this feature is mostly used with an index, then ECMH seems the better option in terms of storage.\r\n\r\nThere is no real difference in storage because I am not saving the `MuHash3072` object for every block but the finalized hash. I didn't even think about storage when I made that decision tbh. Intuitively this made more sense to me because if we access historical blocks to get their stats all we would do with the MuHash is finalize it anyway. So we save a little bit of CPU every time we do it. There is currently only one `MuHash3072` object maintained at the tip and if there is a reorg I am rolling back the reorged blocks. This takes longer than accessing a stored `MuHash3072` object of course but that trade-off seemed worth it to me even without storage because we don't see too many reorgs these days and it's really not that long to roll back a block and add another.\r\n\r\nOn my current mainnet node the whole `indexes/coinstats` folder is 83 MB large. That includes all the stats, not just the hash. Was the 500 MB number a theoretical calculation or did you see this in practice? If your folder is that large I would need to investigate.\r\n\r\n",
      "created_at" : "2020-06-10T13:01:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-641990925",
      "id" : 641990925,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MTk5MDkyNQ==",
      "updated_at" : "2020-06-10T13:01:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/641990925",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "My calculation was based on 768 bytes of cache, but that's off by a factor 2. A finalised MuHash3072 uses 3072 bits. So for 640,000 blocks that's 234 MB.\r\n\r\nI suppose you could store just the sha256 hash for historical blocks, only keep 3072 bits for the most recent block, and use that to move forward or roll back. In that case storage is the same as with ECMH. I can't think of a use case for the full 3072 bits. Initially I was thinking of it as a set, so you potentially query it for the presence of a UTXO, but that's not actually how it works. So perhaps there really is no point in keeping the full 3072 bits for historical blocks.",
      "created_at" : "2020-06-10T13:10:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-641996489",
      "id" : 641996489,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MTk5NjQ4OQ==",
      "updated_at" : "2020-06-10T13:10:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/641996489",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "There would be no reason to cache the internal state except maybe for a few in-memory blocks near the tip or something like that just to speed up reorgs.\r\n",
      "created_at" : "2020-06-11T01:08:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-642345673",
      "id" : 642345673,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MjM0NTY3Mw==",
      "updated_at" : "2020-06-11T01:08:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642345673",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Implemented the use of SHA256 and also added some clarification on the \"set\" question in the docs.",
      "created_at" : "2020-06-11T21:54:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-642946245",
      "id" : 642946245,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0Mjk0NjI0NQ==",
      "updated_at" : "2020-06-11T21:54:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642946245",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r439532565"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439532565"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit fe9ea729fc67e012de773975018a0f749c03790f: might as well move all bench code to 5675d28f22b3e3745226f40aac023c0d689b5acd ",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-06-12T16:49:17Z",
      "diff_hunk" : "@@ -4,6 +4,7 @@\n \n \n #include <bench/bench.h>\n+#include <crypto/muhash.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r439532565",
      "id" : 439532565,
      "line" : 7,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTUzMjU2NQ==",
      "original_commit_id" : "fe9ea729fc67e012de773975018a0f749c03790f",
      "original_line" : 7,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/bench/crypto_hash.cpp",
      "position" : 4,
      "pull_request_review_id" : 429893490,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439532565",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r439537666"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439537666"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`unsigned char out[32];` is added in 106f9148848ffa64b433f1bc2dd6980930a4cb02 and dropped in fe9ea729fc67e012de773975018a0f749c03790f",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-06-12T16:59:28Z",
      "diff_hunk" : "@@ -212,7 +212,6 @@ class SHA256Writer\n \n     uint256 GetHash() {\n         uint256 result;\n-        unsigned char out[32];",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r439537666",
      "id" : 439537666,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTUzNzY2Ng==",
      "original_commit_id" : "fe9ea729fc67e012de773975018a0f749c03790f",
      "original_line" : 215,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/hash.h",
      "position" : null,
      "pull_request_review_id" : 429893490,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439537666",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@Sjors If you mean a bigint library for the C++ side, sure - my original email points out that GMP is faster than this code, but I don't want to add a new dependency for this. The Python code uses Python's native bigint support.",
      "created_at" : "2020-06-12T18:09:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-643415794",
      "id" : 643415794,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MzQxNTc5NA==",
      "updated_at" : "2020-06-12T18:09:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/643415794",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> a bigint library for the C++ side\r\n\r\nThat's what I meant. I agree adding all of GMP is overkill.",
      "created_at" : "2020-06-12T18:18:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-643419477",
      "id" : 643419477,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MzQxOTQ3Nw==",
      "updated_at" : "2020-06-12T18:18:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/643419477",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "There's some discussion about tradeoffs and here's another small point to consider. MuHash3072 introduces cryptographic assumptions that are not used in Bitcoin yet. This is unusual but not a big thing given these are very mild assumptions (i.e., either finite field DL is hard enough *or* Wagner's algorithm is the best method to find collisions here), and most importantly, this is currently just intended to be used for sanity checks. Still, everything else equal, EC-MuHash would not introduce new assumptions. If this functionality will ever be used in relation with chain validation, one should keep this in mind.",
      "created_at" : "2020-06-12T19:17:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-643442664",
      "id" : 643442664,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MzQ0MjY2NA==",
      "updated_at" : "2020-06-12T19:17:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/643442664",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1071625?v=4",
         "events_url" : "https://api.github.com/users/real-or-random/events{/privacy}",
         "followers_url" : "https://api.github.com/users/real-or-random/followers",
         "following_url" : "https://api.github.com/users/real-or-random/following{/other_user}",
         "gists_url" : "https://api.github.com/users/real-or-random/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/real-or-random",
         "id" : 1071625,
         "login" : "real-or-random",
         "node_id" : "MDQ6VXNlcjEwNzE2MjU=",
         "organizations_url" : "https://api.github.com/users/real-or-random/orgs",
         "received_events_url" : "https://api.github.com/users/real-or-random/received_events",
         "repos_url" : "https://api.github.com/users/real-or-random/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/real-or-random/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/real-or-random/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/real-or-random"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I find the claim that the EC alternative does not introduce a new cryptographic assumption implausible: You can't break a discrete log by finding a number of random points that you do not know the discrete log of that add to a selected point. ",
      "created_at" : "2020-06-13T01:49:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-643551262",
      "id" : 643551262,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MzU1MTI2Mg==",
      "updated_at" : "2020-06-13T01:49:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/643551262",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@gmaxwell Solving the generalized birthday problem is provably as hard as the DL problem in the same group (but it may be much harder as well), I think. So under the assumption that DL is hard in secp256k1, then the generalized birthday problem is hard over it, and that implies collision resistance for the ECMH hash based on it.",
      "created_at" : "2020-06-13T01:57:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-643552222",
      "id" : 643552222,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MzU1MjIyMg==",
      "updated_at" : "2020-06-13T01:57:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/643552222",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Sorry, some theory crypto stuff ahead...\r\n\r\n> I find the claim that the EC alternative does not introduce a new cryptographic assumption implausible: You can't break a discrete log by finding a number of random points that you do not know the discrete log of that add to a selected point.\r\n\r\nOh, in the (programmable) random oracle model, you can! It's in fact straight forward and it's buried in the proof of Lemma 3.1 in the [MuHash paper](https://cseweb.ucsd.edu/~mihir/papers/inchash.pdf). I missed that this Lemma relies on programming the random oracle when I wrote https://github.com/bitcoin/bitcoin/pull/19055#discussion_r438026185. It's not immediately obvious because they split the proof in Lemma 3.1 (reducing collisions to balance problem) and Lemma B.2 (reducing balance problem to DL). Say you're given an algorithm C that finds collisions in MuHash, and it needs to access the prehashing function H as a random oracle. Then when C asks you for H(q_i) for some query q_i, you can draw a random r_i, set a_i = r_i*G, and reply with H(q_i) = a_i. Then you know the DL of all the a_i, and you can continue from that.\r\n\r\nHowever this requires modeling the prehashing function as a programmable random oracle. In our case, this function is `ChaCha20-3072-bits(key=SHA256(.))`. This means that we should really have a closer look at this function. I still believe that this is as good as a random oracle if we assume SHA256 is a random oracle and ChaCha20 is an ideal cipher, and this may very well be clear to someone who has worked on random oracle indifferentiability and the ideal cipher model but I haven't, so I'd need to do some reading or ask people who are more familiar with this stuff. \r\n",
      "created_at" : "2020-06-13T09:39:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-643598704",
      "id" : 643598704,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MzU5ODcwNA==",
      "updated_at" : "2020-06-13T09:39:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/643598704",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1071625?v=4",
         "events_url" : "https://api.github.com/users/real-or-random/events{/privacy}",
         "followers_url" : "https://api.github.com/users/real-or-random/followers",
         "following_url" : "https://api.github.com/users/real-or-random/following{/other_user}",
         "gists_url" : "https://api.github.com/users/real-or-random/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/real-or-random",
         "id" : 1071625,
         "login" : "real-or-random",
         "node_id" : "MDQ6VXNlcjEwNzE2MjU=",
         "organizations_url" : "https://api.github.com/users/real-or-random/orgs",
         "received_events_url" : "https://api.github.com/users/real-or-random/received_events",
         "repos_url" : "https://api.github.com/users/real-or-random/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/real-or-random/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/real-or-random/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/real-or-random"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r439813927"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439813927"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-06-14T10:17:29Z",
      "diff_hunk" : "@@ -4,6 +4,7 @@\n \n \n #include <bench/bench.h>\n+#include <crypto/muhash.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r439813927",
      "id" : 439813927,
      "in_reply_to_id" : 439532565,
      "line" : 7,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTgxMzkyNw==",
      "original_commit_id" : "fe9ea729fc67e012de773975018a0f749c03790f",
      "original_line" : 7,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/bench/crypto_hash.cpp",
      "position" : 4,
      "pull_request_review_id" : 430205685,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439813927",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r439813934"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439813934"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-06-14T10:17:33Z",
      "diff_hunk" : "@@ -212,7 +212,6 @@ class SHA256Writer\n \n     uint256 GetHash() {\n         uint256 result;\n-        unsigned char out[32];",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r439813934",
      "id" : 439813934,
      "in_reply_to_id" : 439537666,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTgxMzkzNA==",
      "original_commit_id" : "fe9ea729fc67e012de773975018a0f749c03790f",
      "original_line" : 215,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/hash.h",
      "position" : null,
      "pull_request_review_id" : 430205691,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439813934",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Addressed @Sjors comments.",
      "created_at" : "2020-06-14T10:18:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-643746561",
      "id" : 643746561,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0Mzc0NjU2MQ==",
      "updated_at" : "2020-06-14T10:18:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/643746561",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r439879174"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439879174"
         }
      },
      "author_association" : "MEMBER",
      "body" : "d111135a3c928d1915f48cb4d46ca89a3d179686\r\n\r\nnit, space after `for`.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-06-14T23:37:26Z",
      "diff_hunk" : "@@ -73,6 +74,13 @@ class MuHash3072\n \n     /* Finalize into a 384-byte hash. Does not change this object's value. */\n     void Finalize(unsigned char* hash384) noexcept;\n+\n+    SERIALIZE_METHODS(MuHash3072, obj)\n+    {\n+        for(int i = 0; i < obj.LIMBS; ++i) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r439879174",
      "id" : 439879174,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg3OTE3NA==",
      "original_commit_id" : "d111135a3c928d1915f48cb4d46ca89a3d179686",
      "original_line" : 80,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : null,
      "pull_request_review_id" : 430260841,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439879174",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r439879324"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439879324"
         }
      },
      "author_association" : "MEMBER",
      "body" : "d111135a3c928d1915f48cb4d46ca89a3d179686\r\n\r\nnit, newline after, usually project headers are split from others.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-06-14T23:39:36Z",
      "diff_hunk" : "@@ -9,6 +9,7 @@\n #include <config/bitcoin-config.h>\n #endif\n \n+#include <serialize.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r439879324",
      "id" : 439879324,
      "line" : 12,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg3OTMyNA==",
      "original_commit_id" : "d111135a3c928d1915f48cb4d46ca89a3d179686",
      "original_line" : 12,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : 12,
      "pull_request_review_id" : 430260841,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439879324",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r439879455"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439879455"
         }
      },
      "author_association" : "MEMBER",
      "body" : "4b493677ab2c1d90cb8b11659660d18c3f61171f\r\n\r\nShould these assertions be conditional to `#ifdef DEBUG`? Same in `Multiply`.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-06-14T23:41:04Z",
      "diff_hunk" : "@@ -0,0 +1,277 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+#define MAX_PRIME_DIFF 1103717\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+#define extract3(c0,c1,c2,n) { \\\n+    (n) = c0; \\\n+    c0 = c1; \\\n+    c1 = c2; \\\n+    c2 = 0; \\\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+#define extract2(c0,c1,n) { \\\n+    (n) = c0; \\\n+    c0 = c1; \\\n+    c1 = 0; \\\n+}\n+\n+/** [c0,c1] = a * b */\n+#define mul(c0,c1,a,b) { \\\n+    Num3072::double_limb_type t = (Num3072::double_limb_type)a * b; \\\n+    c2 = 0; \\\n+    c1 = t >> Num3072::LIMB_SIZE; \\\n+    c0 = t; \\\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+#define mulnadd3(c0,c1,c2,d0,d1,d2,n) { \\\n+    Num3072::double_limb_type t = (Num3072::double_limb_type)d0 * n + c0; \\\n+    c0 = t; \\\n+    t >>= Num3072::LIMB_SIZE; \\\n+    t += (Num3072::double_limb_type)d1 * n + c1; \\\n+    c1 = t; \\\n+    t >>= Num3072::LIMB_SIZE; \\\n+    c2 = t + d2 * n; \\\n+}\n+\n+/* [c0,c1] *= n */\n+#define muln2(c0,c1,n) { \\\n+    Num3072::double_limb_type t = (Num3072::double_limb_type)c0 * n; \\\n+    c0 = t; \\\n+    t >>= Num3072::LIMB_SIZE; \\\n+    t += (Num3072::double_limb_type)c1 * n; \\\n+    c1 = t; \\\n+    t >>= Num3072::LIMB_SIZE; \\\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+#define muladd3(c0,c1,c2,a,b) { \\\n+    Num3072::limb_type tl, th; \\\n+    { \\\n+        Num3072::double_limb_type t = (Num3072::double_limb_type)a * b; \\\n+        th = t >> Num3072::LIMB_SIZE; \\\n+        tl = t; \\\n+    } \\\n+    c0 += tl; \\\n+    th += (c0 < tl) ? 1 : 0; \\\n+    c1 += th; \\\n+    c2 += (c1 < th) ? 1 : 0; \\\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+#define muldbladd3(c0,c1,c2,a,b) { \\\n+    Num3072::limb_type tl, th; \\\n+    { \\\n+        Num3072::double_limb_type t = (Num3072::double_limb_type)a * b; \\\n+        th = t >> Num3072::LIMB_SIZE; \\\n+        tl = t; \\\n+    } \\\n+    c0 += tl; \\\n+    Num3072::limb_type tt = th + ((c0 < tl) ? 1 : 0); \\\n+    c1 += tt; \\\n+    c2 += (c1 < tt) ? 1 : 0; \\\n+    c0 += tl; \\\n+    th += (c0 < tl) ? 1 : 0; \\\n+    c1 += th; \\\n+    c2 += (c1 < th) ? 1 : 0; \\\n+}\n+\n+/** [c0,c1] += a */\n+#define add2(c0,c1,a) { \\\n+    c0 += (a); \\\n+    c1 += (c0 < (a)) ? 1 : 0; \\\n+}\n+\n+bool IsOverflow(const Num3072* d)\n+{\n+    for (int i = 1; i < Num3072::LIMBS - 1; ++i) {\n+        if (d->limbs[i] != std::numeric_limits<Num3072::limb_type>::max()) return false;\n+    }\n+    if (d->limbs[0] <= std::numeric_limits<Num3072::limb_type>::max() - MAX_PRIME_DIFF) return false;\n+    return true;\n+}\n+\n+void FullReduce(Num3072* d)\n+{\n+    Num3072::limb_type c0 = MAX_PRIME_DIFF;\n+    for (int i = 0; i < Num3072::LIMBS; ++i) {\n+        Num3072::limb_type c1 = 0;\n+        add2(c0, c1, d->limbs[i]);\n+        extract2(c0, c1, d->limbs[i]);\n+    }\n+}\n+\n+void Multiply(Num3072* out, const Num3072* a, const Num3072* b)\n+{\n+    Num3072::limb_type c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of a*b into tmp, including one reduction. */\n+    for (int j = 0; j < Num3072::LIMBS - 1; ++j) {\n+        Num3072::limb_type d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        mul(d0, d1, a->limbs[1 + j], b->limbs[Num3072::LIMBS + j - (1 + j)]);\n+        for (int i = 2 + j; i < Num3072::LIMBS; ++i) muladd3(d0, d1, d2, a->limbs[i], b->limbs[Num3072::LIMBS + j - i]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < j + 1; ++i) muladd3(c0, c1, c2, a->limbs[i], b->limbs[j - i]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    /* Compute limb N-1 of a*b into tmp. */\n+    {\n+        Num3072::limb_type c2 = 0;\n+        for (int i = 0; i < Num3072::LIMBS; ++i) muladd3(c0, c1, c2, a->limbs[i], b->limbs[Num3072::LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[Num3072::LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < Num3072::LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, out->limbs[j]);\n+    }\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(out);\n+}\n+\n+void Square(Num3072* out, const Num3072* a)\n+{\n+    Num3072::limb_type c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of a*a into tmp, including one reduction. */\n+    for (int j = 0; j < Num3072::LIMBS - 1; ++j) {\n+        Num3072::limb_type d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        for (int i = 0; i < (Num3072::LIMBS - 1 - j) / 2; ++i) muldbladd3(d0, d1, d2, a->limbs[i + j + 1], a->limbs[Num3072::LIMBS - 1 - i]);\n+        if ((j + 1) & 1) muladd3(d0, d1, d2, a->limbs[(Num3072::LIMBS - 1 - j) / 2 + j + 1], a->limbs[Num3072::LIMBS - 1 - (Num3072::LIMBS - 1 - j) / 2]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < (j + 1) / 2; ++i) muldbladd3(c0, c1, c2, a->limbs[i], a->limbs[j - i]);\n+        if ((j + 1) & 1) muladd3(c0, c1, c2, a->limbs[(j + 1) / 2], a->limbs[j - (j + 1) / 2]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    {\n+        Num3072::limb_type c2 = 0;\n+        for (int i = 0; i < Num3072::LIMBS / 2; ++i) muldbladd3(c0, c1, c2, a->limbs[i], a->limbs[Num3072::LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[Num3072::LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < Num3072::LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, out->limbs[j]);\n+    }\n+    assert(c1 == 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r439879455",
      "id" : 439879455,
      "line" : 245,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg3OTQ1NQ==",
      "original_commit_id" : "4b493677ab2c1d90cb8b11659660d18c3f61171f",
      "original_line" : 245,
      "original_position" : 179,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : 245,
      "pull_request_review_id" : 430260841,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439879455",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r439879482"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439879482"
         }
      },
      "author_association" : "MEMBER",
      "body" : "4b493677ab2c1d90cb8b11659660d18c3f61171f\r\n\r\nnit, add `// namespace`.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-06-14T23:41:26Z",
      "diff_hunk" : "@@ -0,0 +1,277 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+#define MAX_PRIME_DIFF 1103717\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+#define extract3(c0,c1,c2,n) { \\\n+    (n) = c0; \\\n+    c0 = c1; \\\n+    c1 = c2; \\\n+    c2 = 0; \\\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+#define extract2(c0,c1,n) { \\\n+    (n) = c0; \\\n+    c0 = c1; \\\n+    c1 = 0; \\\n+}\n+\n+/** [c0,c1] = a * b */\n+#define mul(c0,c1,a,b) { \\\n+    Num3072::double_limb_type t = (Num3072::double_limb_type)a * b; \\\n+    c2 = 0; \\\n+    c1 = t >> Num3072::LIMB_SIZE; \\\n+    c0 = t; \\\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+#define mulnadd3(c0,c1,c2,d0,d1,d2,n) { \\\n+    Num3072::double_limb_type t = (Num3072::double_limb_type)d0 * n + c0; \\\n+    c0 = t; \\\n+    t >>= Num3072::LIMB_SIZE; \\\n+    t += (Num3072::double_limb_type)d1 * n + c1; \\\n+    c1 = t; \\\n+    t >>= Num3072::LIMB_SIZE; \\\n+    c2 = t + d2 * n; \\\n+}\n+\n+/* [c0,c1] *= n */\n+#define muln2(c0,c1,n) { \\\n+    Num3072::double_limb_type t = (Num3072::double_limb_type)c0 * n; \\\n+    c0 = t; \\\n+    t >>= Num3072::LIMB_SIZE; \\\n+    t += (Num3072::double_limb_type)c1 * n; \\\n+    c1 = t; \\\n+    t >>= Num3072::LIMB_SIZE; \\\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+#define muladd3(c0,c1,c2,a,b) { \\\n+    Num3072::limb_type tl, th; \\\n+    { \\\n+        Num3072::double_limb_type t = (Num3072::double_limb_type)a * b; \\\n+        th = t >> Num3072::LIMB_SIZE; \\\n+        tl = t; \\\n+    } \\\n+    c0 += tl; \\\n+    th += (c0 < tl) ? 1 : 0; \\\n+    c1 += th; \\\n+    c2 += (c1 < th) ? 1 : 0; \\\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+#define muldbladd3(c0,c1,c2,a,b) { \\\n+    Num3072::limb_type tl, th; \\\n+    { \\\n+        Num3072::double_limb_type t = (Num3072::double_limb_type)a * b; \\\n+        th = t >> Num3072::LIMB_SIZE; \\\n+        tl = t; \\\n+    } \\\n+    c0 += tl; \\\n+    Num3072::limb_type tt = th + ((c0 < tl) ? 1 : 0); \\\n+    c1 += tt; \\\n+    c2 += (c1 < tt) ? 1 : 0; \\\n+    c0 += tl; \\\n+    th += (c0 < tl) ? 1 : 0; \\\n+    c1 += th; \\\n+    c2 += (c1 < th) ? 1 : 0; \\\n+}\n+\n+/** [c0,c1] += a */\n+#define add2(c0,c1,a) { \\\n+    c0 += (a); \\\n+    c1 += (c0 < (a)) ? 1 : 0; \\\n+}\n+\n+bool IsOverflow(const Num3072* d)\n+{\n+    for (int i = 1; i < Num3072::LIMBS - 1; ++i) {\n+        if (d->limbs[i] != std::numeric_limits<Num3072::limb_type>::max()) return false;\n+    }\n+    if (d->limbs[0] <= std::numeric_limits<Num3072::limb_type>::max() - MAX_PRIME_DIFF) return false;\n+    return true;\n+}\n+\n+void FullReduce(Num3072* d)\n+{\n+    Num3072::limb_type c0 = MAX_PRIME_DIFF;\n+    for (int i = 0; i < Num3072::LIMBS; ++i) {\n+        Num3072::limb_type c1 = 0;\n+        add2(c0, c1, d->limbs[i]);\n+        extract2(c0, c1, d->limbs[i]);\n+    }\n+}\n+\n+void Multiply(Num3072* out, const Num3072* a, const Num3072* b)\n+{\n+    Num3072::limb_type c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of a*b into tmp, including one reduction. */\n+    for (int j = 0; j < Num3072::LIMBS - 1; ++j) {\n+        Num3072::limb_type d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        mul(d0, d1, a->limbs[1 + j], b->limbs[Num3072::LIMBS + j - (1 + j)]);\n+        for (int i = 2 + j; i < Num3072::LIMBS; ++i) muladd3(d0, d1, d2, a->limbs[i], b->limbs[Num3072::LIMBS + j - i]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < j + 1; ++i) muladd3(c0, c1, c2, a->limbs[i], b->limbs[j - i]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    /* Compute limb N-1 of a*b into tmp. */\n+    {\n+        Num3072::limb_type c2 = 0;\n+        for (int i = 0; i < Num3072::LIMBS; ++i) muladd3(c0, c1, c2, a->limbs[i], b->limbs[Num3072::LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[Num3072::LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < Num3072::LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, out->limbs[j]);\n+    }\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(out);\n+}\n+\n+void Square(Num3072* out, const Num3072* a)\n+{\n+    Num3072::limb_type c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of a*a into tmp, including one reduction. */\n+    for (int j = 0; j < Num3072::LIMBS - 1; ++j) {\n+        Num3072::limb_type d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        for (int i = 0; i < (Num3072::LIMBS - 1 - j) / 2; ++i) muldbladd3(d0, d1, d2, a->limbs[i + j + 1], a->limbs[Num3072::LIMBS - 1 - i]);\n+        if ((j + 1) & 1) muladd3(d0, d1, d2, a->limbs[(Num3072::LIMBS - 1 - j) / 2 + j + 1], a->limbs[Num3072::LIMBS - 1 - (Num3072::LIMBS - 1 - j) / 2]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < (j + 1) / 2; ++i) muldbladd3(c0, c1, c2, a->limbs[i], a->limbs[j - i]);\n+        if ((j + 1) & 1) muladd3(c0, c1, c2, a->limbs[(j + 1) / 2], a->limbs[j - (j + 1) / 2]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    {\n+        Num3072::limb_type c2 = 0;\n+        for (int i = 0; i < Num3072::LIMBS / 2; ++i) muldbladd3(c0, c1, c2, a->limbs[i], a->limbs[Num3072::LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[Num3072::LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < Num3072::LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, out->limbs[j]);\n+    }\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(out);\n+}\n+\n+void Inverse(Num3072* out, const Num3072* a)\n+{\n+    Num3072 p[12]; // p[i] = a^(2^(2^i)-1)\n+    Num3072 x;\n+\n+    p[0] = *a;\n+\n+    for (int i = 0; i < 11; ++i) {\n+        p[i + 1] = p[i];\n+        for (int j = 0; j < (1 << i); ++j) Square(&p[i + 1], &p[i + 1]);\n+        Multiply(&p[i + 1], &p[i + 1], &p[i]);\n+    }\n+\n+    x = p[11];\n+\n+    for (int j = 0; j < 512; ++j) Square(&x, &x);\n+    Multiply(&x, &x, &p[9]);\n+    for (int j = 0; j < 256; ++j) Square(&x, &x);\n+    Multiply(&x, &x, &p[8]);\n+    for (int j = 0; j < 128; ++j) Square(&x, &x);\n+    Multiply(&x, &x, &p[7]);\n+    for (int j = 0; j < 64; ++j) Square(&x, &x);\n+    Multiply(&x, &x, &p[6]);\n+    for (int j = 0; j < 32; ++j) Square(&x, &x);\n+    Multiply(&x, &x, &p[5]);\n+    for (int j = 0; j < 8; ++j) Square(&x, &x);\n+    Multiply(&x, &x, &p[3]);\n+    for (int j = 0; j < 2; ++j) Square(&x, &x);\n+    Multiply(&x, &x, &p[1]);\n+    for (int j = 0; j < 1; ++j) Square(&x, &x);\n+    Multiply(&x, &x, &p[0]);\n+    for (int j = 0; j < 5; ++j) Square(&x, &x);\n+    Multiply(&x, &x, &p[2]);\n+    for (int j = 0; j < 3; ++j) Square(&x, &x);\n+    Multiply(&x, &x, &p[0]);\n+    for (int j = 0; j < 2; ++j) Square(&x, &x);\n+    Multiply(&x, &x, &p[0]);\n+    for (int j = 0; j < 4; ++j) Square(&x, &x);\n+    Multiply(&x, &x, &p[0]);\n+    for (int j = 0; j < 4; ++j) Square(&x, &x);\n+    Multiply(&x, &x, &p[1]);\n+    for (int j = 0; j < 3; ++j) Square(&x, &x);\n+    Multiply(&x, &x, &p[0]);\n+\n+    *out = x;\n+}\n+\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r439879482",
      "id" : 439879482,
      "line" : 260,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg3OTQ4Mg==",
      "original_commit_id" : "4b493677ab2c1d90cb8b11659660d18c3f61171f",
      "original_line" : 260,
      "original_position" : 232,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : 260,
      "pull_request_review_id" : 430260841,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439879482",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r439880752"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439880752"
         }
      },
      "author_association" : "MEMBER",
      "body" : "18c4d69f8d771aa596a321cf1d6c8e6e106d42a9\r\n\r\nnit, should fix format.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-06-14T23:55:13Z",
      "diff_hunk" : "@@ -191,6 +191,39 @@ class CHashVerifier : public CHashWriter\n     }\n };\n \n+/** A writer stream that computes a SHA256 hash. */\n+class SHA256Writer\n+{\n+private:\n+    CSHA256 ctx;\n+\n+    const int nType;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r439880752",
      "id" : 439880752,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg4MDc1Mg==",
      "original_commit_id" : "18c4d69f8d771aa596a321cf1d6c8e6e106d42a9",
      "original_line" : 200,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/hash.h",
      "position" : null,
      "pull_request_review_id" : 430260841,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439880752",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> However this requires modeling the prehashing function as a programmable random oracle. In our case, this function is `ChaCha20-3072-bits(key=SHA256(.))`. This means that we should really have a closer look at this function. I still believe that this is as good as a random oracle if we assume SHA256 is a random oracle and ChaCha20 is an ideal cipher, and this may very well be clear to someone who has worked on random oracle indifferentiability and the ideal cipher model but I haven't, so I'd need to do some reading or ask people who are more familiar with this stuff.\r\n\r\nOkay, this is indeed pretty direct from the ideal cipher model, which is not less a stretch than the random oracle model in the end. In the ideal cipher model, the cipher is modeled as a function E(k,x), which is a perfectly random permutation for every key k, and by giving the attacker *oracle access* to this function (and it's inverse). So it's very similar to the random oracle model for some hash function H and you can play the same programming tricks. That is, if you get a query H(q_i), you can use a random H(q_i) and program E(H(q_i), 0)|| ... ||E(H(x), 5) = r_i * G. (Note here that 3072/512 = 6, where 512 is the bitsize of the ChaCha permutation.) And if you get a query E(k, x) / E^-1(k, x) for some key k* you've never seen before, just give a random answer, the attacker will find a preimage of H that maps to k* only with negligible probability.\r\n\r\n__tl;dr (or if I lost you)__:\r\nIf you believe in provable security of cryptographic constructions, and we compare to the common assumptions we already need for working consensus, then\r\n - ECMH (= MuHash on secp256k1) needs the additional assumption that ChaCha20 is a good PRG.\r\n - MuHash3072 needs the additional assumption that ChaCha20 is a good PRG *and* that either i) the finite field discrete logarithm is hard in 3072-bit fields or ii) Wagner's algorithm is the best method to find collisions here.\r\n\r\nAs I all these assumptions are fine. However, there's indeed a difference, so \r\n\r\n> If this functionality will ever be used in relation with chain validation, one should keep this in mind. \r\n",
      "created_at" : "2020-06-15T11:45:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-644079086",
      "id" : 644079086,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NDA3OTA4Ng==",
      "updated_at" : "2020-06-15T11:45:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/644079086",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1071625?v=4",
         "events_url" : "https://api.github.com/users/real-or-random/events{/privacy}",
         "followers_url" : "https://api.github.com/users/real-or-random/followers",
         "following_url" : "https://api.github.com/users/real-or-random/following{/other_user}",
         "gists_url" : "https://api.github.com/users/real-or-random/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/real-or-random",
         "id" : 1071625,
         "login" : "real-or-random",
         "node_id" : "MDQ6VXNlcjEwNzE2MjU=",
         "organizations_url" : "https://api.github.com/users/real-or-random/orgs",
         "received_events_url" : "https://api.github.com/users/real-or-random/received_events",
         "repos_url" : "https://api.github.com/users/real-or-random/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/real-or-random/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/real-or-random/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/real-or-random"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r440221681"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440221681"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-06-15T14:35:28Z",
      "diff_hunk" : "@@ -191,6 +191,39 @@ class CHashVerifier : public CHashWriter\n     }\n };\n \n+/** A writer stream that computes a SHA256 hash. */\n+class SHA256Writer\n+{\n+private:\n+    CSHA256 ctx;\n+\n+    const int nType;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r440221681",
      "id" : 440221681,
      "in_reply_to_id" : 439880752,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDIyMTY4MQ==",
      "original_commit_id" : "18c4d69f8d771aa596a321cf1d6c8e6e106d42a9",
      "original_line" : 200,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/hash.h",
      "position" : null,
      "pull_request_review_id" : 430704951,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440221681",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r440221759"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440221759"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-06-15T14:35:34Z",
      "diff_hunk" : "@@ -0,0 +1,277 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+#define MAX_PRIME_DIFF 1103717\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+#define extract3(c0,c1,c2,n) { \\\n+    (n) = c0; \\\n+    c0 = c1; \\\n+    c1 = c2; \\\n+    c2 = 0; \\\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+#define extract2(c0,c1,n) { \\\n+    (n) = c0; \\\n+    c0 = c1; \\\n+    c1 = 0; \\\n+}\n+\n+/** [c0,c1] = a * b */\n+#define mul(c0,c1,a,b) { \\\n+    Num3072::double_limb_type t = (Num3072::double_limb_type)a * b; \\\n+    c2 = 0; \\\n+    c1 = t >> Num3072::LIMB_SIZE; \\\n+    c0 = t; \\\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+#define mulnadd3(c0,c1,c2,d0,d1,d2,n) { \\\n+    Num3072::double_limb_type t = (Num3072::double_limb_type)d0 * n + c0; \\\n+    c0 = t; \\\n+    t >>= Num3072::LIMB_SIZE; \\\n+    t += (Num3072::double_limb_type)d1 * n + c1; \\\n+    c1 = t; \\\n+    t >>= Num3072::LIMB_SIZE; \\\n+    c2 = t + d2 * n; \\\n+}\n+\n+/* [c0,c1] *= n */\n+#define muln2(c0,c1,n) { \\\n+    Num3072::double_limb_type t = (Num3072::double_limb_type)c0 * n; \\\n+    c0 = t; \\\n+    t >>= Num3072::LIMB_SIZE; \\\n+    t += (Num3072::double_limb_type)c1 * n; \\\n+    c1 = t; \\\n+    t >>= Num3072::LIMB_SIZE; \\\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+#define muladd3(c0,c1,c2,a,b) { \\\n+    Num3072::limb_type tl, th; \\\n+    { \\\n+        Num3072::double_limb_type t = (Num3072::double_limb_type)a * b; \\\n+        th = t >> Num3072::LIMB_SIZE; \\\n+        tl = t; \\\n+    } \\\n+    c0 += tl; \\\n+    th += (c0 < tl) ? 1 : 0; \\\n+    c1 += th; \\\n+    c2 += (c1 < th) ? 1 : 0; \\\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+#define muldbladd3(c0,c1,c2,a,b) { \\\n+    Num3072::limb_type tl, th; \\\n+    { \\\n+        Num3072::double_limb_type t = (Num3072::double_limb_type)a * b; \\\n+        th = t >> Num3072::LIMB_SIZE; \\\n+        tl = t; \\\n+    } \\\n+    c0 += tl; \\\n+    Num3072::limb_type tt = th + ((c0 < tl) ? 1 : 0); \\\n+    c1 += tt; \\\n+    c2 += (c1 < tt) ? 1 : 0; \\\n+    c0 += tl; \\\n+    th += (c0 < tl) ? 1 : 0; \\\n+    c1 += th; \\\n+    c2 += (c1 < th) ? 1 : 0; \\\n+}\n+\n+/** [c0,c1] += a */\n+#define add2(c0,c1,a) { \\\n+    c0 += (a); \\\n+    c1 += (c0 < (a)) ? 1 : 0; \\\n+}\n+\n+bool IsOverflow(const Num3072* d)\n+{\n+    for (int i = 1; i < Num3072::LIMBS - 1; ++i) {\n+        if (d->limbs[i] != std::numeric_limits<Num3072::limb_type>::max()) return false;\n+    }\n+    if (d->limbs[0] <= std::numeric_limits<Num3072::limb_type>::max() - MAX_PRIME_DIFF) return false;\n+    return true;\n+}\n+\n+void FullReduce(Num3072* d)\n+{\n+    Num3072::limb_type c0 = MAX_PRIME_DIFF;\n+    for (int i = 0; i < Num3072::LIMBS; ++i) {\n+        Num3072::limb_type c1 = 0;\n+        add2(c0, c1, d->limbs[i]);\n+        extract2(c0, c1, d->limbs[i]);\n+    }\n+}\n+\n+void Multiply(Num3072* out, const Num3072* a, const Num3072* b)\n+{\n+    Num3072::limb_type c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of a*b into tmp, including one reduction. */\n+    for (int j = 0; j < Num3072::LIMBS - 1; ++j) {\n+        Num3072::limb_type d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        mul(d0, d1, a->limbs[1 + j], b->limbs[Num3072::LIMBS + j - (1 + j)]);\n+        for (int i = 2 + j; i < Num3072::LIMBS; ++i) muladd3(d0, d1, d2, a->limbs[i], b->limbs[Num3072::LIMBS + j - i]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < j + 1; ++i) muladd3(c0, c1, c2, a->limbs[i], b->limbs[j - i]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    /* Compute limb N-1 of a*b into tmp. */\n+    {\n+        Num3072::limb_type c2 = 0;\n+        for (int i = 0; i < Num3072::LIMBS; ++i) muladd3(c0, c1, c2, a->limbs[i], b->limbs[Num3072::LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[Num3072::LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < Num3072::LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, out->limbs[j]);\n+    }\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(out);\n+}\n+\n+void Square(Num3072* out, const Num3072* a)\n+{\n+    Num3072::limb_type c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of a*a into tmp, including one reduction. */\n+    for (int j = 0; j < Num3072::LIMBS - 1; ++j) {\n+        Num3072::limb_type d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        for (int i = 0; i < (Num3072::LIMBS - 1 - j) / 2; ++i) muldbladd3(d0, d1, d2, a->limbs[i + j + 1], a->limbs[Num3072::LIMBS - 1 - i]);\n+        if ((j + 1) & 1) muladd3(d0, d1, d2, a->limbs[(Num3072::LIMBS - 1 - j) / 2 + j + 1], a->limbs[Num3072::LIMBS - 1 - (Num3072::LIMBS - 1 - j) / 2]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < (j + 1) / 2; ++i) muldbladd3(c0, c1, c2, a->limbs[i], a->limbs[j - i]);\n+        if ((j + 1) & 1) muladd3(c0, c1, c2, a->limbs[(j + 1) / 2], a->limbs[j - (j + 1) / 2]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    {\n+        Num3072::limb_type c2 = 0;\n+        for (int i = 0; i < Num3072::LIMBS / 2; ++i) muldbladd3(c0, c1, c2, a->limbs[i], a->limbs[Num3072::LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[Num3072::LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < Num3072::LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, out->limbs[j]);\n+    }\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(out);\n+}\n+\n+void Inverse(Num3072* out, const Num3072* a)\n+{\n+    Num3072 p[12]; // p[i] = a^(2^(2^i)-1)\n+    Num3072 x;\n+\n+    p[0] = *a;\n+\n+    for (int i = 0; i < 11; ++i) {\n+        p[i + 1] = p[i];\n+        for (int j = 0; j < (1 << i); ++j) Square(&p[i + 1], &p[i + 1]);\n+        Multiply(&p[i + 1], &p[i + 1], &p[i]);\n+    }\n+\n+    x = p[11];\n+\n+    for (int j = 0; j < 512; ++j) Square(&x, &x);\n+    Multiply(&x, &x, &p[9]);\n+    for (int j = 0; j < 256; ++j) Square(&x, &x);\n+    Multiply(&x, &x, &p[8]);\n+    for (int j = 0; j < 128; ++j) Square(&x, &x);\n+    Multiply(&x, &x, &p[7]);\n+    for (int j = 0; j < 64; ++j) Square(&x, &x);\n+    Multiply(&x, &x, &p[6]);\n+    for (int j = 0; j < 32; ++j) Square(&x, &x);\n+    Multiply(&x, &x, &p[5]);\n+    for (int j = 0; j < 8; ++j) Square(&x, &x);\n+    Multiply(&x, &x, &p[3]);\n+    for (int j = 0; j < 2; ++j) Square(&x, &x);\n+    Multiply(&x, &x, &p[1]);\n+    for (int j = 0; j < 1; ++j) Square(&x, &x);\n+    Multiply(&x, &x, &p[0]);\n+    for (int j = 0; j < 5; ++j) Square(&x, &x);\n+    Multiply(&x, &x, &p[2]);\n+    for (int j = 0; j < 3; ++j) Square(&x, &x);\n+    Multiply(&x, &x, &p[0]);\n+    for (int j = 0; j < 2; ++j) Square(&x, &x);\n+    Multiply(&x, &x, &p[0]);\n+    for (int j = 0; j < 4; ++j) Square(&x, &x);\n+    Multiply(&x, &x, &p[0]);\n+    for (int j = 0; j < 4; ++j) Square(&x, &x);\n+    Multiply(&x, &x, &p[1]);\n+    for (int j = 0; j < 3; ++j) Square(&x, &x);\n+    Multiply(&x, &x, &p[0]);\n+\n+    *out = x;\n+}\n+\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r440221759",
      "id" : 440221759,
      "in_reply_to_id" : 439879482,
      "line" : 260,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDIyMTc1OQ==",
      "original_commit_id" : "4b493677ab2c1d90cb8b11659660d18c3f61171f",
      "original_line" : 260,
      "original_position" : 232,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : 260,
      "pull_request_review_id" : 430705047,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440221759",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r440221831"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440221831"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Makes sense to me. Added.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-06-15T14:35:39Z",
      "diff_hunk" : "@@ -0,0 +1,277 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+#define MAX_PRIME_DIFF 1103717\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+#define extract3(c0,c1,c2,n) { \\\n+    (n) = c0; \\\n+    c0 = c1; \\\n+    c1 = c2; \\\n+    c2 = 0; \\\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+#define extract2(c0,c1,n) { \\\n+    (n) = c0; \\\n+    c0 = c1; \\\n+    c1 = 0; \\\n+}\n+\n+/** [c0,c1] = a * b */\n+#define mul(c0,c1,a,b) { \\\n+    Num3072::double_limb_type t = (Num3072::double_limb_type)a * b; \\\n+    c2 = 0; \\\n+    c1 = t >> Num3072::LIMB_SIZE; \\\n+    c0 = t; \\\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+#define mulnadd3(c0,c1,c2,d0,d1,d2,n) { \\\n+    Num3072::double_limb_type t = (Num3072::double_limb_type)d0 * n + c0; \\\n+    c0 = t; \\\n+    t >>= Num3072::LIMB_SIZE; \\\n+    t += (Num3072::double_limb_type)d1 * n + c1; \\\n+    c1 = t; \\\n+    t >>= Num3072::LIMB_SIZE; \\\n+    c2 = t + d2 * n; \\\n+}\n+\n+/* [c0,c1] *= n */\n+#define muln2(c0,c1,n) { \\\n+    Num3072::double_limb_type t = (Num3072::double_limb_type)c0 * n; \\\n+    c0 = t; \\\n+    t >>= Num3072::LIMB_SIZE; \\\n+    t += (Num3072::double_limb_type)c1 * n; \\\n+    c1 = t; \\\n+    t >>= Num3072::LIMB_SIZE; \\\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+#define muladd3(c0,c1,c2,a,b) { \\\n+    Num3072::limb_type tl, th; \\\n+    { \\\n+        Num3072::double_limb_type t = (Num3072::double_limb_type)a * b; \\\n+        th = t >> Num3072::LIMB_SIZE; \\\n+        tl = t; \\\n+    } \\\n+    c0 += tl; \\\n+    th += (c0 < tl) ? 1 : 0; \\\n+    c1 += th; \\\n+    c2 += (c1 < th) ? 1 : 0; \\\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+#define muldbladd3(c0,c1,c2,a,b) { \\\n+    Num3072::limb_type tl, th; \\\n+    { \\\n+        Num3072::double_limb_type t = (Num3072::double_limb_type)a * b; \\\n+        th = t >> Num3072::LIMB_SIZE; \\\n+        tl = t; \\\n+    } \\\n+    c0 += tl; \\\n+    Num3072::limb_type tt = th + ((c0 < tl) ? 1 : 0); \\\n+    c1 += tt; \\\n+    c2 += (c1 < tt) ? 1 : 0; \\\n+    c0 += tl; \\\n+    th += (c0 < tl) ? 1 : 0; \\\n+    c1 += th; \\\n+    c2 += (c1 < th) ? 1 : 0; \\\n+}\n+\n+/** [c0,c1] += a */\n+#define add2(c0,c1,a) { \\\n+    c0 += (a); \\\n+    c1 += (c0 < (a)) ? 1 : 0; \\\n+}\n+\n+bool IsOverflow(const Num3072* d)\n+{\n+    for (int i = 1; i < Num3072::LIMBS - 1; ++i) {\n+        if (d->limbs[i] != std::numeric_limits<Num3072::limb_type>::max()) return false;\n+    }\n+    if (d->limbs[0] <= std::numeric_limits<Num3072::limb_type>::max() - MAX_PRIME_DIFF) return false;\n+    return true;\n+}\n+\n+void FullReduce(Num3072* d)\n+{\n+    Num3072::limb_type c0 = MAX_PRIME_DIFF;\n+    for (int i = 0; i < Num3072::LIMBS; ++i) {\n+        Num3072::limb_type c1 = 0;\n+        add2(c0, c1, d->limbs[i]);\n+        extract2(c0, c1, d->limbs[i]);\n+    }\n+}\n+\n+void Multiply(Num3072* out, const Num3072* a, const Num3072* b)\n+{\n+    Num3072::limb_type c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of a*b into tmp, including one reduction. */\n+    for (int j = 0; j < Num3072::LIMBS - 1; ++j) {\n+        Num3072::limb_type d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        mul(d0, d1, a->limbs[1 + j], b->limbs[Num3072::LIMBS + j - (1 + j)]);\n+        for (int i = 2 + j; i < Num3072::LIMBS; ++i) muladd3(d0, d1, d2, a->limbs[i], b->limbs[Num3072::LIMBS + j - i]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < j + 1; ++i) muladd3(c0, c1, c2, a->limbs[i], b->limbs[j - i]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    /* Compute limb N-1 of a*b into tmp. */\n+    {\n+        Num3072::limb_type c2 = 0;\n+        for (int i = 0; i < Num3072::LIMBS; ++i) muladd3(c0, c1, c2, a->limbs[i], b->limbs[Num3072::LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[Num3072::LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < Num3072::LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, out->limbs[j]);\n+    }\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(out);\n+}\n+\n+void Square(Num3072* out, const Num3072* a)\n+{\n+    Num3072::limb_type c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of a*a into tmp, including one reduction. */\n+    for (int j = 0; j < Num3072::LIMBS - 1; ++j) {\n+        Num3072::limb_type d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        for (int i = 0; i < (Num3072::LIMBS - 1 - j) / 2; ++i) muldbladd3(d0, d1, d2, a->limbs[i + j + 1], a->limbs[Num3072::LIMBS - 1 - i]);\n+        if ((j + 1) & 1) muladd3(d0, d1, d2, a->limbs[(Num3072::LIMBS - 1 - j) / 2 + j + 1], a->limbs[Num3072::LIMBS - 1 - (Num3072::LIMBS - 1 - j) / 2]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < (j + 1) / 2; ++i) muldbladd3(c0, c1, c2, a->limbs[i], a->limbs[j - i]);\n+        if ((j + 1) & 1) muladd3(c0, c1, c2, a->limbs[(j + 1) / 2], a->limbs[j - (j + 1) / 2]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    {\n+        Num3072::limb_type c2 = 0;\n+        for (int i = 0; i < Num3072::LIMBS / 2; ++i) muldbladd3(c0, c1, c2, a->limbs[i], a->limbs[Num3072::LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[Num3072::LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < Num3072::LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, out->limbs[j]);\n+    }\n+    assert(c1 == 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r440221831",
      "id" : 440221831,
      "in_reply_to_id" : 439879455,
      "line" : 245,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDIyMTgzMQ==",
      "original_commit_id" : "4b493677ab2c1d90cb8b11659660d18c3f61171f",
      "original_line" : 245,
      "original_position" : 179,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : 245,
      "pull_request_review_id" : 430705145,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440221831",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r440221890"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440221890"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-06-15T14:35:44Z",
      "diff_hunk" : "@@ -9,6 +9,7 @@\n #include <config/bitcoin-config.h>\n #endif\n \n+#include <serialize.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r440221890",
      "id" : 440221890,
      "in_reply_to_id" : 439879324,
      "line" : 12,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDIyMTg5MA==",
      "original_commit_id" : "d111135a3c928d1915f48cb4d46ca89a3d179686",
      "original_line" : 12,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : 12,
      "pull_request_review_id" : 430705216,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440221890",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r440221999"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440221999"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-06-15T14:35:53Z",
      "diff_hunk" : "@@ -73,6 +74,13 @@ class MuHash3072\n \n     /* Finalize into a 384-byte hash. Does not change this object's value. */\n     void Finalize(unsigned char* hash384) noexcept;\n+\n+    SERIALIZE_METHODS(MuHash3072, obj)\n+    {\n+        for(int i = 0; i < obj.LIMBS; ++i) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r440221999",
      "id" : 440221999,
      "in_reply_to_id" : 439879174,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDIyMTk5OQ==",
      "original_commit_id" : "d111135a3c928d1915f48cb4d46ca89a3d179686",
      "original_line" : 80,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : null,
      "pull_request_review_id" : 430705362,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440221999",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Addressed @promag 's review comments.",
      "created_at" : "2020-06-15T14:36:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-644174444",
      "id" : 644174444,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NDE3NDQ0NA==",
      "updated_at" : "2020-06-15T14:36:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/644174444",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : ">  That's what I meant. I agree adding all of GMP is overkill.\r\n\r\nAlso mind that GMP is not license-compatible with bitcoin (it's LGPL). So, that's another stumbling block besides our desire to limit third-party dependencies.\r\n\r\n> As I all these assumptions are fine. However, there's indeed a difference, so\r\n\r\nI have a hard time reading how serious your concerns are. So to be clear: in your opinion, this is not a blocker for merging this?",
      "created_at" : "2020-06-18T13:06:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-646004470",
      "id" : 646004470,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NjAwNDQ3MA==",
      "updated_at" : "2020-06-18T13:12:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646004470",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r442211563"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442211563"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why are these implemented as macros instead of (inline) functions?",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-06-18T13:07:41Z",
      "diff_hunk" : "@@ -0,0 +1,281 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+#define MAX_PRIME_DIFF 1103717\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+#define extract3(c0,c1,c2,n) { \\",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r442211563",
      "id" : 442211563,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjIxMTU2Mw==",
      "original_commit_id" : "3585297e5e7578150683b809dd7b46bcaf63351f",
      "original_line" : 21,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 433263304,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442211563",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I have a hard time reading how serious your concerns are. So to be clear: in your opinion, this is not a blocker for merging this?\r\n\r\nSorry if my posts are confusing. I don't have serious concerns at all and no, I don't believe this is a blocker. \r\n\r\nLet me try to explain. After I looked at the details, I believe that both MuHash3072 and ECMH (= MuHash on secp256k1) are very solid choices and we do not need to worry about either. What I was pointing out is that ECMH is a slightly more conservative choice if you look at the cryptographic assumptions because ECMH is better aligned with the assumptions that we already make in Bitcoin. But this is just a very small point in all the tradeoffs discussed between MuHash3072 and ECMH, and it's perfectly reasonable that we prefer performance over being super conservative here, in  particular because MuHash is intended for `gettxoutsetinfo`, which serves merely as a sanity check. I believe if MuHash was planned to be used in the consensus implementation, then we might come to the conclusion that we prefer being a little more conservative over getting a little bit more performance out of it. But as far as I understand, there are currently no plans to use MuHash in consensus, so this is not relevant currently.",
      "created_at" : "2020-06-19T12:47:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-646616902",
      "id" : 646616902,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NjYxNjkwMg==",
      "updated_at" : "2020-06-19T12:47:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646616902",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1071625?v=4",
         "events_url" : "https://api.github.com/users/real-or-random/events{/privacy}",
         "followers_url" : "https://api.github.com/users/real-or-random/followers",
         "following_url" : "https://api.github.com/users/real-or-random/following{/other_user}",
         "gists_url" : "https://api.github.com/users/real-or-random/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/real-or-random",
         "id" : 1071625,
         "login" : "real-or-random",
         "node_id" : "MDQ6VXNlcjEwNzE2MjU=",
         "organizations_url" : "https://api.github.com/users/real-or-random/orgs",
         "received_events_url" : "https://api.github.com/users/real-or-random/received_events",
         "repos_url" : "https://api.github.com/users/real-or-random/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/real-or-random/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/real-or-random/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/real-or-random"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Could rebase on top of #19286 and add fuzzing of the MuHash3072 class to the `src/test/fuzz/crypto.cpp` fuzzing harness in order to demonstrate (some level of) code robustness (more specifically: absence of warnings from ASan, MSan and UBSan when processing malformed/unexpected inputs)? :)",
      "created_at" : "2020-06-22T13:28:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-647519700",
      "id" : 647519700,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NzUxOTcwMA==",
      "updated_at" : "2020-06-22T13:28:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/647519700",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Could rebase on top of #19286 and add fuzzing of the MuHash3072 class to the `src/test/fuzz/crypto.cpp` fuzzing harness in order to demonstrate (some level of) code robustness (more specifically: absence of warnings from ASan, MSan and UBSan when processing malformed/unexpected inputs)? :)\r\n\r\nDone. I am still learning more about fuzzing so looking forward to your feedback. :)",
      "created_at" : "2020-07-01T21:06:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-652646724",
      "id" : 652646724,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MjY0NjcyNA==",
      "updated_at" : "2020-07-01T21:06:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/652646724",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r448624203"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448624203"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I am not aware of a reason why inline functions couldn't be used here. From my side, the only reason is that this is @sipa 's original code and I did not feel so strongly about it that it justified a bigger change. Of course, I will do it if that's preferred by reviewers.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-07-01T21:25:06Z",
      "diff_hunk" : "@@ -0,0 +1,281 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+#define MAX_PRIME_DIFF 1103717\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+#define extract3(c0,c1,c2,n) { \\",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r448624203",
      "id" : 448624203,
      "in_reply_to_id" : 442211563,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYyNDIwMw==",
      "original_commit_id" : "3585297e5e7578150683b809dd7b46bcaf63351f",
      "original_line" : 21,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 441206737,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448624203",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r448630059"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448630059"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It may have been that I copied this from code that was originally written for C.\r\n\r\nFeel free to change it; inline functions would be far more C++ish.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-07-01T21:39:01Z",
      "diff_hunk" : "@@ -0,0 +1,281 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+#define MAX_PRIME_DIFF 1103717\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+#define extract3(c0,c1,c2,n) { \\",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r448630059",
      "id" : 448630059,
      "in_reply_to_id" : 442211563,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYzMDA1OQ==",
      "original_commit_id" : "3585297e5e7578150683b809dd7b46bcaf63351f",
      "original_line" : 21,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 441213789,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448630059",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r448630571"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448630571"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: `MuHash3072 muhash;` is enough :)",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-07-01T21:40:17Z",
      "diff_hunk" : "@@ -33,6 +34,7 @@ void test_one_input(const std::vector<uint8_t>& buffer)\n     CSHA256 sha256;\n     CSHA512 sha512;\n     CSipHasher sip_hasher{fuzzed_data_provider.ConsumeIntegral<uint64_t>(), fuzzed_data_provider.ConsumeIntegral<uint64_t>()};\n+    MuHash3072 muhash = MuHash3072();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r448630571",
      "id" : 448630571,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYzMDU3MQ==",
      "original_commit_id" : "62e842c15eeb7af5d195200d6a605113f16a7e39",
      "original_line" : 37,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/test/fuzz/crypto.cpp",
      "position" : null,
      "pull_request_review_id" : 441214410,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448630571",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r448633047"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448633047"
         }
      },
      "author_association" : "MEMBER",
      "body" : "To not interfere with the other fuzzers by changing the data size, what about either creating a new `case 3` specifically for this MuHash3072 code (the resize and the lines immediately below), or alternatively do something along the lines of `std::vector<uint8_t> muhash_data = data;` + `muhash_data.resize(32);`?",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-07-01T21:46:14Z",
      "diff_hunk" : "@@ -58,6 +60,14 @@ void test_one_input(const std::vector<uint8_t>& buffer)\n             (void)Hash160(data);\n             (void)Hash160(data.begin(), data.end());\n             (void)sha512.Size();\n+\n+            // MuHash3072 only accepts a fixed key length of 32 bytes\n+            data.resize(32);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r448633047",
      "id" : 448633047,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYzMzA0Nw==",
      "original_commit_id" : "62e842c15eeb7af5d195200d6a605113f16a7e39",
      "original_line" : 65,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/test/fuzz/crypto.cpp",
      "position" : null,
      "pull_request_review_id" : 441214410,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448633047",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r448634840"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448634840"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Make sure you also exercise the other constructor `MuHash3072::MuHash3072(const unsigned char* key32)`. Perhaps `ConsumeBool()` to choose which constructor to use?\r\n\r\nGenerally a good thing to do when testing a fuzzer is to add `assert(false);` to all code paths you want to reach and then fuzz/tweak/repeat until you've reached them all.\r\n\r\nIn this case we want to make sure that relevant code paths in the following functions are covered:\r\n\r\n```\r\nMuHash3072::MuHash3072() noexcept\r\nMuHash3072::MuHash3072(const unsigned char* key32) noexcept\r\nvoid MuHash3072::Finalize(unsigned char* hash384) noexcept\r\nMuHash3072& MuHash3072::operator*=(const MuHash3072& x) noexcept\r\nMuHash3072& MuHash3072::operator/=(const MuHash3072& x) noexcept\r\n```",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-07-01T21:50:38Z",
      "diff_hunk" : "@@ -67,10 +77,11 @@ void test_one_input(const std::vector<uint8_t>& buffer)\n             (void)sha1.Reset();\n             (void)sha256.Reset();\n             (void)sha512.Reset();\n+            muhash = MuHash3072();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r448634840",
      "id" : 448634840,
      "line" : 81,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYzNDg0MA==",
      "original_commit_id" : "62e842c15eeb7af5d195200d6a605113f16a7e39",
      "original_line" : 81,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/test/fuzz/crypto.cpp",
      "position" : 33,
      "pull_request_review_id" : 441214410,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448634840",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r448638490"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448638490"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Brevity is the soul of wit",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-07-01T22:00:07Z",
      "diff_hunk" : "@@ -33,6 +34,7 @@ void test_one_input(const std::vector<uint8_t>& buffer)\n     CSHA256 sha256;\n     CSHA512 sha512;\n     CSipHasher sip_hasher{fuzzed_data_provider.ConsumeIntegral<uint64_t>(), fuzzed_data_provider.ConsumeIntegral<uint64_t>()};\n+    MuHash3072 muhash = MuHash3072();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r448638490",
      "id" : 448638490,
      "in_reply_to_id" : 448630571,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYzODQ5MA==",
      "original_commit_id" : "62e842c15eeb7af5d195200d6a605113f16a7e39",
      "original_line" : 37,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/test/fuzz/crypto.cpp",
      "position" : null,
      "pull_request_review_id" : 441223837,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448638490",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-ACK 62e842c15eeb7af5d195200d6a605113f16a7e39 modulo \"not interfere with the other fuzzers by changing the data size\". Complete code coverage can wait for a followup (it already covers the basics).",
      "created_at" : "2020-07-06T11:34:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-654179346",
      "id" : 654179346,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1NDE3OTM0Ng==",
      "updated_at" : "2020-07-06T11:34:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/654179346",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r452886409"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/452886409"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-07-10T14:40:33Z",
      "diff_hunk" : "@@ -33,6 +34,7 @@ void test_one_input(const std::vector<uint8_t>& buffer)\n     CSHA256 sha256;\n     CSHA512 sha512;\n     CSipHasher sip_hasher{fuzzed_data_provider.ConsumeIntegral<uint64_t>(), fuzzed_data_provider.ConsumeIntegral<uint64_t>()};\n+    MuHash3072 muhash = MuHash3072();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r452886409",
      "id" : 452886409,
      "in_reply_to_id" : 448630571,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg4NjQwOQ==",
      "original_commit_id" : "62e842c15eeb7af5d195200d6a605113f16a7e39",
      "original_line" : 37,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/test/fuzz/crypto.cpp",
      "position" : null,
      "pull_request_review_id" : 446457462,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/452886409",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r452886730"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/452886730"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done, opted for your second suggestion.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-07-10T14:41:01Z",
      "diff_hunk" : "@@ -58,6 +60,14 @@ void test_one_input(const std::vector<uint8_t>& buffer)\n             (void)Hash160(data);\n             (void)Hash160(data.begin(), data.end());\n             (void)sha512.Size();\n+\n+            // MuHash3072 only accepts a fixed key length of 32 bytes\n+            data.resize(32);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r452886730",
      "id" : 452886730,
      "in_reply_to_id" : 448633047,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg4NjczMA==",
      "original_commit_id" : "62e842c15eeb7af5d195200d6a605113f16a7e39",
      "original_line" : 65,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/test/fuzz/crypto.cpp",
      "position" : null,
      "pull_request_review_id" : 446457867,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/452886730",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r452887936"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/452887936"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "That constructor is used for the MuHash objects that get added or removed. I checked all the public functions as you suggested and they seem to all be covered.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-07-10T14:43:00Z",
      "diff_hunk" : "@@ -67,10 +77,11 @@ void test_one_input(const std::vector<uint8_t>& buffer)\n             (void)sha1.Reset();\n             (void)sha256.Reset();\n             (void)sha512.Reset();\n+            muhash = MuHash3072();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r452887936",
      "id" : 452887936,
      "in_reply_to_id" : 448634840,
      "line" : 81,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg4NzkzNg==",
      "original_commit_id" : "62e842c15eeb7af5d195200d6a605113f16a7e39",
      "original_line" : 81,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/test/fuzz/crypto.cpp",
      "position" : 33,
      "pull_request_review_id" : 446459430,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/452887936",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Addressed @practicalswift 's feedback and turned the macros into inline functions.",
      "created_at" : "2020-07-10T14:43:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-656713016",
      "id" : 656713016,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1NjcxMzAxNg==",
      "updated_at" : "2020-07-10T14:43:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/656713016",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@fjahr Thanks for addressing the fuzzing feedback. The fuzzing changes look good (`src/test/fuzz/crypto.cpp`). (I haven't reviewed the rest yet.)",
      "created_at" : "2020-07-10T19:03:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-656837402",
      "id" : 656837402,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1NjgzNzQwMg==",
      "updated_at" : "2020-07-10T19:03:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/656837402",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Replaced the first commit which added `SHA256Writer` with commit 284ca85e3fc4d30f60e7fbb903303b4dc935d82c from #17977 (Taproot) which provides the same functionality in fewer LOC. It uses `CHashWriter` instead of creating a new class, which is nice, and if this gets merged before #17977 there is one less commit to review.",
      "created_at" : "2020-07-11T21:23:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-657132203",
      "id" : 657132203,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1NzEzMjIwMw==",
      "updated_at" : "2020-07-11T21:23:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/657132203",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r455770853"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/455770853"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Shouldn't `GetCheapHash` be calling `GetSHA256`? I.e. \"Cheap\" refers to a single rather than a double hash. cc @JeremyRubin @sipa ",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-07-16T13:06:48Z",
      "diff_hunk" : "@@ -132,20 +132,33 @@ class CHashWriter\n         ctx.Write((const unsigned char*)pch, size);\n     }\n \n-    // invalidates the object\n+    /** Compute the double-SHA256 hash of all data written to this object.\n+     *\n+     * Invalidates this object.\n+     */\n     uint256 GetHash() {\n         uint256 result;\n-        ctx.Finalize((unsigned char*)&result);\n+        ctx.Finalize(result.begin());\n+        ctx.Reset().Write(result.begin(), CSHA256::OUTPUT_SIZE).Finalize(result.begin());\n+        return result;\n+    }\n+\n+    /** Compute the SHA256 hash of all data written to this object.\n+     *\n+     * Invalidates this object.\n+     */\n+    uint256 GetSHA256() {\n+        uint256 result;\n+        ctx.Finalize(result.begin());\n         return result;\n     }\n \n     /**\n      * Returns the first 64 bits from the resulting hash.\n      */\n     inline uint64_t GetCheapHash() {\n-        unsigned char result[CHash256::OUTPUT_SIZE];\n-        ctx.Finalize(result);\n-        return ReadLE64(result);\n+        uint256 result = GetHash();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r455770853",
      "id" : 455770853,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTc3MDg1Mw==",
      "original_commit_id" : "00a578e9bc5a2b691d529780824c90333013f1d6",
      "original_line" : 143,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/hash.h",
      "position" : null,
      "pull_request_review_id" : 449827562,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/455770853",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Let's try to get #18071 in first (for the first commit)",
      "created_at" : "2020-07-24T10:23:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-663471922",
      "id" : 663471922,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2MzQ3MTkyMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-24T10:23:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/663471922",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r460171013"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460171013"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "No because it's a behavior change :/\r\n\r\nIf someone wants to make sure that we don't rely on cheaphashes being consistent across boots then yes.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-07-24T16:49:32Z",
      "diff_hunk" : "@@ -132,20 +132,33 @@ class CHashWriter\n         ctx.Write((const unsigned char*)pch, size);\n     }\n \n-    // invalidates the object\n+    /** Compute the double-SHA256 hash of all data written to this object.\n+     *\n+     * Invalidates this object.\n+     */\n     uint256 GetHash() {\n         uint256 result;\n-        ctx.Finalize((unsigned char*)&result);\n+        ctx.Finalize(result.begin());\n+        ctx.Reset().Write(result.begin(), CSHA256::OUTPUT_SIZE).Finalize(result.begin());\n+        return result;\n+    }\n+\n+    /** Compute the SHA256 hash of all data written to this object.\n+     *\n+     * Invalidates this object.\n+     */\n+    uint256 GetSHA256() {\n+        uint256 result;\n+        ctx.Finalize(result.begin());\n         return result;\n     }\n \n     /**\n      * Returns the first 64 bits from the resulting hash.\n      */\n     inline uint64_t GetCheapHash() {\n-        unsigned char result[CHash256::OUTPUT_SIZE];\n-        ctx.Finalize(result);\n-        return ReadLE64(result);\n+        uint256 result = GetHash();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r460171013",
      "id" : 460171013,
      "in_reply_to_id" : 455770853,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE3MTAxMw==",
      "original_commit_id" : "00a578e9bc5a2b691d529780824c90333013f1d6",
      "original_line" : 143,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/hash.h",
      "position" : null,
      "pull_request_review_id" : 455038093,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460171013",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r460172516"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460172516"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Addrman's bucketing relies on it.\n\nWith a new addrman version we could change it to siphash instead, which would let us get rid of GetCheapHash entirely.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-07-24T16:52:08Z",
      "diff_hunk" : "@@ -132,20 +132,33 @@ class CHashWriter\n         ctx.Write((const unsigned char*)pch, size);\n     }\n \n-    // invalidates the object\n+    /** Compute the double-SHA256 hash of all data written to this object.\n+     *\n+     * Invalidates this object.\n+     */\n     uint256 GetHash() {\n         uint256 result;\n-        ctx.Finalize((unsigned char*)&result);\n+        ctx.Finalize(result.begin());\n+        ctx.Reset().Write(result.begin(), CSHA256::OUTPUT_SIZE).Finalize(result.begin());\n+        return result;\n+    }\n+\n+    /** Compute the SHA256 hash of all data written to this object.\n+     *\n+     * Invalidates this object.\n+     */\n+    uint256 GetSHA256() {\n+        uint256 result;\n+        ctx.Finalize(result.begin());\n         return result;\n     }\n \n     /**\n      * Returns the first 64 bits from the resulting hash.\n      */\n     inline uint64_t GetCheapHash() {\n-        unsigned char result[CHash256::OUTPUT_SIZE];\n-        ctx.Finalize(result);\n-        return ReadLE64(result);\n+        uint256 result = GetHash();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r460172516",
      "id" : 460172516,
      "in_reply_to_id" : 455770853,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE3MjUxNg==",
      "original_commit_id" : "00a578e9bc5a2b691d529780824c90333013f1d6",
      "original_line" : 143,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/hash.h",
      "position" : null,
      "pull_request_review_id" : 455039920,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460172516",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK bb3098bbaf1305aa9091ee5e3cd92f2973e04c68\r\nI have reviewed everything but the MuHash implementation in detail, and looked broadly at the MuHash code but could not follow all the specifics.\r\n\r\n> Let's try to get #18071 in first (for the first commit)\r\n\r\nMind that there doesn't seem to be agreement on that PR yet.",
      "created_at" : "2020-07-30T12:57:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-666348096",
      "id" : 666348096,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2NjM0ODA5Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-30T13:03:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/666348096",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r462991147"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/462991147"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It would be nice to document here in a comment why this particular cascade is used, and how it works. It is not obvious to me.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-07-30T13:21:41Z",
      "diff_hunk" : "@@ -0,0 +1,288 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_type MAX_PRIME_DIFF = 1103717;\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& c2, Num3072::limb_type& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(Num3072::limb_type& c0, Num3072::limb_type& c1, const Num3072::limb_type& a, const Num3072::limb_type& b)\n+{\n+    Num3072::double_limb_type t = (Num3072::double_limb_type)a * b;\n+    c1 = t >> Num3072::LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& c2, Num3072::limb_type& d0, Num3072::limb_type& d1, Num3072::limb_type& d2, const Num3072::limb_type& n)\n+{\n+    Num3072::double_limb_type t = (Num3072::double_limb_type)d0 * n + c0;\n+    c0 = t;\n+    t >>= Num3072::LIMB_SIZE;\n+    t += (Num3072::double_limb_type)d1 * n + c1;\n+    c1 = t;\n+    t >>= Num3072::LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(Num3072::limb_type& c0, Num3072::limb_type& c1, const Num3072::limb_type& n)\n+{\n+    Num3072::double_limb_type t = (Num3072::double_limb_type)c0 * n;\n+    c0 = t;\n+    t >>= Num3072::LIMB_SIZE;\n+    t += (Num3072::double_limb_type)c1 * n;\n+    c1 = t;\n+    t >>= Num3072::LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& c2, const Num3072::limb_type& a, const Num3072::limb_type& b)\n+{\n+    Num3072::limb_type tl, th;\n+    {\n+        Num3072::double_limb_type t = (Num3072::double_limb_type)a * b;\n+        th = t >> Num3072::LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& c2, const Num3072::limb_type& a, const Num3072::limb_type& b)\n+{\n+    Num3072::limb_type tl, th;\n+    {\n+        Num3072::double_limb_type t = (Num3072::double_limb_type)a * b;\n+        th = t >> Num3072::LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    Num3072::limb_type tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072* d)\n+{\n+    for (int i = 1; i < Num3072::LIMBS - 1; ++i) {\n+        if (d->limbs[i] != std::numeric_limits<Num3072::limb_type>::max()) return false;\n+    }\n+    if (d->limbs[0] <= std::numeric_limits<Num3072::limb_type>::max() - MAX_PRIME_DIFF) return false;\n+    return true;\n+}\n+\n+void FullReduce(Num3072* d)\n+{\n+    Num3072::limb_type c0 = MAX_PRIME_DIFF;\n+    for (int i = 0; i < Num3072::LIMBS; ++i) {\n+        Num3072::limb_type c1 = 0;\n+        add2(c0, c1, d->limbs[i]);\n+        extract2(c0, c1, d->limbs[i]);\n+    }\n+}\n+\n+void Multiply(Num3072* out, const Num3072* a, const Num3072* b)\n+{\n+    Num3072::limb_type c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of a*b into tmp, including one reduction. */\n+    for (int j = 0; j < Num3072::LIMBS - 1; ++j) {\n+        Num3072::limb_type d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        mul(d0, d1, a->limbs[1 + j], b->limbs[Num3072::LIMBS + j - (1 + j)]);\n+        for (int i = 2 + j; i < Num3072::LIMBS; ++i) muladd3(d0, d1, d2, a->limbs[i], b->limbs[Num3072::LIMBS + j - i]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < j + 1; ++i) muladd3(c0, c1, c2, a->limbs[i], b->limbs[j - i]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    /* Compute limb N-1 of a*b into tmp. */\n+    {\n+        Num3072::limb_type c2 = 0;\n+        for (int i = 0; i < Num3072::LIMBS; ++i) muladd3(c0, c1, c2, a->limbs[i], b->limbs[Num3072::LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[Num3072::LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < Num3072::LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, out->limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(out);\n+}\n+\n+void Square(Num3072* out, const Num3072* a)\n+{\n+    Num3072::limb_type c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of a*a into tmp, including one reduction. */\n+    for (int j = 0; j < Num3072::LIMBS - 1; ++j) {\n+        Num3072::limb_type d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        for (int i = 0; i < (Num3072::LIMBS - 1 - j) / 2; ++i) muldbladd3(d0, d1, d2, a->limbs[i + j + 1], a->limbs[Num3072::LIMBS - 1 - i]);\n+        if ((j + 1) & 1) muladd3(d0, d1, d2, a->limbs[(Num3072::LIMBS - 1 - j) / 2 + j + 1], a->limbs[Num3072::LIMBS - 1 - (Num3072::LIMBS - 1 - j) / 2]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < (j + 1) / 2; ++i) muldbladd3(c0, c1, c2, a->limbs[i], a->limbs[j - i]);\n+        if ((j + 1) & 1) muladd3(c0, c1, c2, a->limbs[(j + 1) / 2], a->limbs[j - (j + 1) / 2]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    {\n+        Num3072::limb_type c2 = 0;\n+        for (int i = 0; i < Num3072::LIMBS / 2; ++i) muldbladd3(c0, c1, c2, a->limbs[i], a->limbs[Num3072::LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[Num3072::LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < Num3072::LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, out->limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(out);\n+}\n+\n+void Inverse(Num3072* out, const Num3072* a)\n+{\n+    Num3072 p[12]; // p[i] = a^(2^(2^i)-1)\n+    Num3072 x;\n+\n+    p[0] = *a;\n+\n+    for (int i = 0; i < 11; ++i) {\n+        p[i + 1] = p[i];\n+        for (int j = 0; j < (1 << i); ++j) Square(&p[i + 1], &p[i + 1]);\n+        Multiply(&p[i + 1], &p[i + 1], &p[i]);\n+    }\n+\n+    x = p[11];\n+\n+    for (int j = 0; j < 512; ++j) Square(&x, &x);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r462991147",
      "id" : 462991147,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjk5MTE0Nw==",
      "original_commit_id" : "bb3098bbaf1305aa9091ee5e3cd92f2973e04c68",
      "original_line" : 215,
      "original_position" : 211,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 458393720,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/462991147",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-07-30T14:29:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-666400406",
      "id" : 666400406,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2NjQwMDQwNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-30T14:29:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/666400406",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Let's try to get #18071 in first (for the first commit)\r\n\r\nIt's closed now in favor of #19601.\r\n",
      "created_at" : "2020-08-20T14:14:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-677692503",
      "id" : 677692503,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3NzY5MjUwMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-20T14:14:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/677692503",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r475233273"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/475233273"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I have added a reference to a paper that explains this algorithm. Unfortunately, I think there is no publicly accessible version of that paper that we can link to here. The paid version is here: https://link.springer.com/chapter/10.1007/978-3-540-69485-4_10.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-08-23T15:36:02Z",
      "diff_hunk" : "@@ -0,0 +1,288 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_type MAX_PRIME_DIFF = 1103717;\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& c2, Num3072::limb_type& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(Num3072::limb_type& c0, Num3072::limb_type& c1, const Num3072::limb_type& a, const Num3072::limb_type& b)\n+{\n+    Num3072::double_limb_type t = (Num3072::double_limb_type)a * b;\n+    c1 = t >> Num3072::LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& c2, Num3072::limb_type& d0, Num3072::limb_type& d1, Num3072::limb_type& d2, const Num3072::limb_type& n)\n+{\n+    Num3072::double_limb_type t = (Num3072::double_limb_type)d0 * n + c0;\n+    c0 = t;\n+    t >>= Num3072::LIMB_SIZE;\n+    t += (Num3072::double_limb_type)d1 * n + c1;\n+    c1 = t;\n+    t >>= Num3072::LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(Num3072::limb_type& c0, Num3072::limb_type& c1, const Num3072::limb_type& n)\n+{\n+    Num3072::double_limb_type t = (Num3072::double_limb_type)c0 * n;\n+    c0 = t;\n+    t >>= Num3072::LIMB_SIZE;\n+    t += (Num3072::double_limb_type)c1 * n;\n+    c1 = t;\n+    t >>= Num3072::LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& c2, const Num3072::limb_type& a, const Num3072::limb_type& b)\n+{\n+    Num3072::limb_type tl, th;\n+    {\n+        Num3072::double_limb_type t = (Num3072::double_limb_type)a * b;\n+        th = t >> Num3072::LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& c2, const Num3072::limb_type& a, const Num3072::limb_type& b)\n+{\n+    Num3072::limb_type tl, th;\n+    {\n+        Num3072::double_limb_type t = (Num3072::double_limb_type)a * b;\n+        th = t >> Num3072::LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    Num3072::limb_type tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072* d)\n+{\n+    for (int i = 1; i < Num3072::LIMBS - 1; ++i) {\n+        if (d->limbs[i] != std::numeric_limits<Num3072::limb_type>::max()) return false;\n+    }\n+    if (d->limbs[0] <= std::numeric_limits<Num3072::limb_type>::max() - MAX_PRIME_DIFF) return false;\n+    return true;\n+}\n+\n+void FullReduce(Num3072* d)\n+{\n+    Num3072::limb_type c0 = MAX_PRIME_DIFF;\n+    for (int i = 0; i < Num3072::LIMBS; ++i) {\n+        Num3072::limb_type c1 = 0;\n+        add2(c0, c1, d->limbs[i]);\n+        extract2(c0, c1, d->limbs[i]);\n+    }\n+}\n+\n+void Multiply(Num3072* out, const Num3072* a, const Num3072* b)\n+{\n+    Num3072::limb_type c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of a*b into tmp, including one reduction. */\n+    for (int j = 0; j < Num3072::LIMBS - 1; ++j) {\n+        Num3072::limb_type d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        mul(d0, d1, a->limbs[1 + j], b->limbs[Num3072::LIMBS + j - (1 + j)]);\n+        for (int i = 2 + j; i < Num3072::LIMBS; ++i) muladd3(d0, d1, d2, a->limbs[i], b->limbs[Num3072::LIMBS + j - i]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < j + 1; ++i) muladd3(c0, c1, c2, a->limbs[i], b->limbs[j - i]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    /* Compute limb N-1 of a*b into tmp. */\n+    {\n+        Num3072::limb_type c2 = 0;\n+        for (int i = 0; i < Num3072::LIMBS; ++i) muladd3(c0, c1, c2, a->limbs[i], b->limbs[Num3072::LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[Num3072::LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < Num3072::LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, out->limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(out);\n+}\n+\n+void Square(Num3072* out, const Num3072* a)\n+{\n+    Num3072::limb_type c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of a*a into tmp, including one reduction. */\n+    for (int j = 0; j < Num3072::LIMBS - 1; ++j) {\n+        Num3072::limb_type d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        for (int i = 0; i < (Num3072::LIMBS - 1 - j) / 2; ++i) muldbladd3(d0, d1, d2, a->limbs[i + j + 1], a->limbs[Num3072::LIMBS - 1 - i]);\n+        if ((j + 1) & 1) muladd3(d0, d1, d2, a->limbs[(Num3072::LIMBS - 1 - j) / 2 + j + 1], a->limbs[Num3072::LIMBS - 1 - (Num3072::LIMBS - 1 - j) / 2]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < (j + 1) / 2; ++i) muldbladd3(c0, c1, c2, a->limbs[i], a->limbs[j - i]);\n+        if ((j + 1) & 1) muladd3(c0, c1, c2, a->limbs[(j + 1) / 2], a->limbs[j - (j + 1) / 2]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    {\n+        Num3072::limb_type c2 = 0;\n+        for (int i = 0; i < Num3072::LIMBS / 2; ++i) muldbladd3(c0, c1, c2, a->limbs[i], a->limbs[Num3072::LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[Num3072::LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < Num3072::LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, out->limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(out);\n+}\n+\n+void Inverse(Num3072* out, const Num3072* a)\n+{\n+    Num3072 p[12]; // p[i] = a^(2^(2^i)-1)\n+    Num3072 x;\n+\n+    p[0] = *a;\n+\n+    for (int i = 0; i < 11; ++i) {\n+        p[i + 1] = p[i];\n+        for (int j = 0; j < (1 << i); ++j) Square(&p[i + 1], &p[i + 1]);\n+        Multiply(&p[i + 1], &p[i + 1], &p[i]);\n+    }\n+\n+    x = p[11];\n+\n+    for (int j = 0; j < 512; ++j) Square(&x, &x);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r475233273",
      "id" : 475233273,
      "in_reply_to_id" : 462991147,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTIzMzI3Mw==",
      "original_commit_id" : "bb3098bbaf1305aa9091ee5e3cd92f2973e04c68",
      "original_line" : 215,
      "original_position" : 211,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 473021093,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/475233273",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased since #19601 was merged.",
      "created_at" : "2020-08-27T09:55:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-681848903",
      "id" : 681848903,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4MTg0ODkwMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-27T09:55:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/681848903",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review re-ACK 24317aa5a1bd91b90e5971016e842b58f0b4ba62\r\nThanks for adding a comment to the Inverse function.",
      "created_at" : "2020-08-27T14:35:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-681989062",
      "id" : 681989062,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4MTk4OTA2Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-27T14:38:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/681989062",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-09-10T16:42:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-690481472",
      "id" : 690481472,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5MDQ4MTQ3Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-10T16:42:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/690481472",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased",
      "created_at" : "2020-09-11T11:15:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-691034042",
      "id" : 691034042,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5MTAzNDA0Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-11T11:15:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/691034042",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r489117810"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489117810"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think this should be `obj.data.LIMBS` and `obj.data.limbs[i]` ? Can add:\r\n\r\n```c++\r\n#include <streams.h>\r\n...\r\n    CDataStream ss(SER_DISK, PROTOCOL_VERSION);\r\n    ss << acc;\r\n```\r\n\r\nto exercise the code.\r\n\r\nIf this is being serialized by directly dumping the limbs, is there a problem if the code that serializes it uses `uint64_t` limbs and the code that deserializes uses `uint32_t` limbs? I think we read/write everything in little endian and `limbs[0]` is the least-significant limb so this works out okay.\r\n\r\nMight be good to add a test that serializing some constant ends up as a predictable constant, and deserializes back to the same thing, something like:\r\n\r\n```c++\r\n    MuHash3072 serchk = FromInt(1); serchk *= FromInt(2);\r\n    std::string ser_exp = \"ad5d5a19c789b21f95f9c2a09f264f8aab4ef29ca30824f7330a8c3f4c61c25a6035bc27476ade3a38f2f2bc576bfbeabdf69641a91b99631ef904d37103eff744129842b1fd83158db6466ab4b752278f04add175a7a41ab8ea1305f66855068730dd3baf1ad29d6e13c7ba3350864a8f96e2e9e5c1ca65e11ab3e361184213a3fb395ac5c86efe3997c671cc5d46df3e1b2f00bf09120ae252a0e985b2452be64d5f626c0bc03747355d91ff2aa31ea4087797b91c80af5003d4b3a2ba5c34cd4a8785712897cd2331bac1b749e4fe9d17a5bb68395e2571d1759dceb5609dfae38ec6186e8c2eb22ffeb9bb8330083ee15d4b816e117e6bc1399c707b3e9d01ae74d2f589d6eb8e9e58c572088476e0444e3dbc05c95867acdb7c18be551e0eb2189d3c39dd86dbc844dc70ac33f9328be9e3b0d792bb359498f5fb385e2d8a8e3a5cde7e3e4e8ba123d3e1eda0b859d3a56e548dd6d23a03ce82e01493f96a67abd3109f9f4315c966f8cba311d71899c04a7fd9618ed028580ffcd21263\";\r\n    CDataStream ss_chk(SER_DISK, PROTOCOL_VERSION);\r\n    ss_chk << serchk;\r\n    BOOST_CHECK_EQUAL(ser_exp, HexStr(ss_chk.str()));\r\n\r\n    MuHash3072 deserchk;\r\n    ss_chk >> deserchk;\r\n    unsigned char out2[384];\r\n    serchk.Finalize(out); deserchk.Finalize(out2);\r\n    BOOST_CHECK_EQUAL(HexStr(out), HexStr(out2));\r\n```\r\n",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-09-16T02:05:46Z",
      "diff_hunk" : "@@ -73,6 +75,13 @@ class MuHash3072\n \n     /* Finalize into a 384-byte hash. Does not change this object's value. */\n     void Finalize(unsigned char* hash384) noexcept;\n+\n+    SERIALIZE_METHODS(MuHash3072, obj)\n+    {\n+        for (int i = 0; i < obj.LIMBS; ++i) {\n+            READWRITE(obj.limbs[i]);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r489117810",
      "id" : 489117810,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTExNzgxMA==",
      "original_commit_id" : "4cb77c70d3d43ebe004dc130d51ab0c75913c3f5",
      "original_line" : 82,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : null,
      "pull_request_review_id" : 489223281,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489117810",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r489131218"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489131218"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Might be better to accept a `Span` rather than having an implicit length? Also for `Finalize` perhaps -- sha3.cpp does it that way.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-09-16T02:55:58Z",
      "diff_hunk" : "@@ -0,0 +1,78 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <stdint.h>\n+\n+struct Num3072 {\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_type;\n+    typedef uint64_t limb_type;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_type;\n+    typedef uint32_t limb_type;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_type limbs[LIMBS];\n+};\n+\n+/** A class representing MuHash sets\n+ *\n+ * MuHash is a hashing algorithm that supports adding set elements in any\n+ * order but also deleting in any order. As a result, it can maintain a\n+ * running sum for a set of data as a whole, and add/subtract when data\n+ * is added to or removed from it. A downside of MuHash is that computing\n+ * an inverse is relatively expensive. This can be solved by representing\n+ * the running value as a fraction, and multiplying added elements into\n+ * the numerator and removed elements into the denominator. Only when the\n+ * final hash is desired, a single modular inverse and multiplication is\n+ * needed to combine the two.\n+ *\n+ * As the update operations are also associative, H(a)+H(b)+H(c)+H(d) can\n+ * in fact be computed as (H(a)+H(b)) + (H(c)+H(d)). This implies that\n+ * all of this is perfectly parallellizable: each thread can process an\n+ * arbitrary subset of the update operations, allowing them to be\n+ * efficiently combined later.\n+ *\n+ * This class does not enforce the use of a set as the data it represents.\n+ * It is possible to add elements more than once and also to remove\n+ * elements that have not been added before. However, it is not clear if\n+ * security assumptions still hold in this case, so it should for now\n+ * only be used to represent a set of elements.\n+ *\n+ * See also https://cseweb.ucsd.edu/~mihir/papers/inchash.pdf and\n+ * https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014337.html.\n+ */\n+class MuHash3072\n+{\n+private:\n+    Num3072 data;\n+\n+public:\n+    /* The empty set. */\n+    MuHash3072() noexcept;\n+\n+    /* A singleton with a single 32-byte key in it. */\n+    explicit MuHash3072(const unsigned char* key32) noexcept;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r489131218",
      "id" : 489131218,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTEzMTIxOA==",
      "original_commit_id" : "c540f8edc143e856474a27626cc0bd08018ed734",
      "original_line" : 66,
      "original_position" : 66,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : null,
      "pull_request_review_id" : 489223281,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489131218",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r489133613"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489133613"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Might be worth clarifying that muhash does not support checking if an element is a member of the set, and therefore it's not possible to (efficiently) enforce that you don't add members that are already in the set, or remove members that aren't in the set?\r\n\r\nMight also be worth being more explicit that the \"represent the running value as a fraction\" optimisation is a TODO.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-09-16T03:05:10Z",
      "diff_hunk" : "@@ -0,0 +1,78 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <stdint.h>\n+\n+struct Num3072 {\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_type;\n+    typedef uint64_t limb_type;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_type;\n+    typedef uint32_t limb_type;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_type limbs[LIMBS];\n+};\n+\n+/** A class representing MuHash sets\n+ *\n+ * MuHash is a hashing algorithm that supports adding set elements in any\n+ * order but also deleting in any order. As a result, it can maintain a\n+ * running sum for a set of data as a whole, and add/subtract when data\n+ * is added to or removed from it. A downside of MuHash is that computing\n+ * an inverse is relatively expensive. This can be solved by representing\n+ * the running value as a fraction, and multiplying added elements into\n+ * the numerator and removed elements into the denominator. Only when the\n+ * final hash is desired, a single modular inverse and multiplication is\n+ * needed to combine the two.\n+ *\n+ * As the update operations are also associative, H(a)+H(b)+H(c)+H(d) can\n+ * in fact be computed as (H(a)+H(b)) + (H(c)+H(d)). This implies that\n+ * all of this is perfectly parallellizable: each thread can process an\n+ * arbitrary subset of the update operations, allowing them to be\n+ * efficiently combined later.\n+ *\n+ * This class does not enforce the use of a set as the data it represents.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r489133613",
      "id" : 489133613,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTEzMzYxMw==",
      "original_commit_id" : "c540f8edc143e856474a27626cc0bd08018ed734",
      "original_line" : 47,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : null,
      "pull_request_review_id" : 489223281,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489133613",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r489135525"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489135525"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The headers suggest that removing things that aren't in the set is a bad idea (\"not clear if the security assumptions still hold\", \"should for now only be used to represent a set of elements\") so seems a bit odd to be doing it in the tests. Could convert it to `z *= x; z *= y; y *= x; z /= y;` to only add things that aren't present/remove things that are present.\r\n\r\nI think the comment in the header doesn't make sense though -- as I understand it, it should be equally fine (in security terms even) to remove a set by saying:\r\n\r\n```\r\n    MuHash3072 to_remove;\r\n    for (x : spent) { to_remove *= MuHash3072(x); }\r\n    set /= to_remove;\r\n```\r\n\r\nand\r\n\r\n```\r\n    MuHash3072 changes;\r\n    for (x : arrived) { changes *= MuHash3072(x); }\r\n    for (x : spent) { changes /= MuHash3072(x); }\r\n    set *= changes;\r\n```\r\n\r\neven though that's removing things from `changes` before they've been added.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-09-16T03:12:53Z",
      "diff_hunk" : "@@ -857,4 +858,58 @@ BOOST_AUTO_TEST_CASE(sha3_256_tests)\n     TestSHA3_256(\"72c57c359e10684d0517e46653a02d18d29eff803eb009e4d5eb9e95add9ad1a4ac1f38a70296f3a369a16985ca3c957de2084cdc9bdd8994eb59b8815e0debad4ec1f001feac089820db8becdaf896aaf95721e8674e5d476b43bd2b873a7d135cd685f545b438210f9319e4dcd55986c85303c1ddf18dc746fe63a409df0a998ed376eb683e16c09e6e9018504152b3e7628ef350659fb716e058a5263a18823d2f2f6ee6a8091945a48ae1c5cb1694cf2c1fe76ef9177953afe8899cfa2b7fe0603bfa3180937dadfb66fbbdd119bbf8063338aa4a699075a3bfdbae8db7e5211d0917e9665a702fc9b0a0a901d08bea97654162d82a9f05622b060b634244779c33427eb7a29353a5f48b07cbefa72f3622ac5900bef77b71d6b314296f304c8426f451f32049b1f6af156a9dab702e8907d3cd72bb2c50493f4d593e731b285b70c803b74825b3524cda3205a8897106615260ac93c01c5ec14f5b11127783989d1824527e99e04f6a340e827b559f24db9292fcdd354838f9339a5fa1d7f6b2087f04835828b13463dd40927866f16ae33ed501ec0e6c4e63948768c5aeea3e4f6754985954bea7d61088c44430204ef491b74a64bde1358cecb2cad28ee6a3de5b752ff6a051104d88478653339457ac45ba44cbb65f54d1969d047cda746931d5e6a8b48e211416aefd5729f3d60b56b54e7f85aa2f42de3cb69419240c24e67139a11790a709edef2ac52cf35dd0a08af45926ebe9761f498ff83bfe263d6897ee97943a4b982fe3404ef0b4a45e06113c60340e0664f14799bf59cb4b3934b465fabefd87155905ee5309ba41e9e402973311831ea600b16437f71df39ee77130490c4d0227e5d1757fdc66af3ae6b9953053ed9aafca0160209858a7d4dd38fe10e0cb153672d08633ed6c54977aa0a6e67f9ff2f8c9d22dd7b21de08192960fd0e0da68d77c8d810db11dcaa61c725cd4092cbff76c8e1debd8d0361bb3f2e607911d45716f53067bdc0d89dd4889177765166a424e9fc0cb711201099dda213355e6639ac7eb86eca2ae0ab38b7f674f37ef8a6fcca1a6f52f55d9e1dcd631d2c3c82bba129172feb991d5af51afecd9d61a88b6832e4107480e392aed61a8644f551665ebff6b20953b635737a4f895e429fddcfe801f606fbda74b3bf6f5767d0fac14907fcfd0aa1d4c11b9e91b01d68052399b51a29f1ae6acd965109977c14a555cbcbd21ad8cb9f8853506d4bc21c01e62d61d7b21be1b923be54914e6b0a7ca84dd11f1159193e1184568a6134a6bbadf5b4df986edcf2019390ae841cfaa44435e28ce877d3dae4177992fa5d4e5c005876dbe3d1e63bec7dcc0942762b48b1ecc6c1a918409a8a72812a1e245c0c67be6e729c2b49bc6ee4d24a8f63e78e75db45655c26a9a78aff36fcd67117f26b8f654dca664b9f0e30681874cb749e1a692720078856286c2560b0292cc837933423147569350955c9571bf8941ba128fd339cb4268f46b94bc6ee203eb7026813706ea51c4f24c91866fc23a724bf2501327e6ae89c29f8db315dc28d2c7c719514036367e018f4835f63fdecd71f9bdced7132b6c4f8b13c69a517026fcd3622d67cb632320d5e7308f78f4b7cea11f6291b137851dc6cd6366f2785c71c3f237f81a7658b2a8d512b61e0ad5a4710b7b124151689fcb2116063fbff7e9115fed7b93de834970b838e49f8f8ba5f1f874c354078b5810a55ae289a56da563f1da6cd80a3757d6073fa55e016e45ac6cec1f69d871c92fd0ae9670c74249045e6b464787f9504128736309fed205f8df4d90e332908581298d9c75a3fa36ab0c3c9272e62de53ab290c803d67b696fd615c260a47bffad16746f18ba1a10a061bacbea9369693b3c042eec36bed289d7d12e52bca8aa1c2dff88ca7816498d25626d0f1e106ebb0b4a12138e00f3df5b1c2f49d98b1756e69b641b7c6353d99dbff050f4d76842c6cf1c2a4b062fc8e6336fa689b7c9d5c6b4ab8c15a5c20e514ff070a602d85ae52fa7810c22f8eeffd34a095b93342144f7a98d024216b3d68ed7bea047517bfcd83ec83febd1ba0e5858e2bdc1d8b1f7b0f89e90ccc432a3f930cb8209462e64556c5054c56ca2a85f16b32eb83a10459d13516faa4d23302b7607b9bd38dab2239ac9e9440c314433fdfb3ceadab4b4f87415ed6f240e017221f3b5f7ac196cdf54957bec42fe6893994b46de3d27dc7fb58ca88feb5b9e79cf20053d12530ac524337b22a3629bea52f40b06d3e2128f32060f9105847daed81d35f20e2002817434659baff64494c5b5c7f9216bfda38412a0f70511159dc73bb6bae1f8eaa0ef08d99bcb31f94f6be12c29c83df45926430b366c99fca3270c15fc4056398fdf3135b7779e3066a006961d1ac0ad1c83179ce39e87a96b722ec23aabc065badf3e188347a360772ca6a447abac7e6a44f0d4632d52926332e44a0a86bff5ce699fd063bdda3ffd4c41b53ded49fecec67f40599b934e16e3fd1bc063ad7026f8d71bfd4cbaf56599586774723194b692036f1b6bb242e2ffb9c600b5215b412764599476ce475c9e5b396fbcebd6be323dcf4d0048077400aac7500db41dc95fc7f7edbe7c9c2ec5ea89943fe13b42217eef530bbd023671509e12dfce4e1c1c82955d965e6a68aa66f6967dba48feda572db1f099d9a6dc4bc8edade852b5e824a06890dc48a6a6510ecaf8cf7620d757290e3166d431abecc624fa9ac2234d2eb783308ead45544910c633a94964b2ef5fbc409cb8835ac4147d384e12e0a5e13951f7de0ee13eafcb0ca0c04946d7804040c0a3cd088352424b097adb7aad1ca4495952f3e6c0158c02d2bcec33bfda69301434a84d9027ce02c0b9725dad118\", \"d894b86261436362e64241e61f6b3e6589daf64dc641f60570c4c0bf3b1f2ca3\");\n }\n \n+static MuHash3072 FromInt(unsigned char i) {\n+    unsigned char tmp[32] = {i, 0};\n+    return MuHash3072(tmp);\n+}\n+\n+BOOST_AUTO_TEST_CASE(muhash_tests)\n+{\n+    unsigned char out[384];\n+\n+    for (int iter = 0; iter < 10; ++iter) {\n+        unsigned char res[384];\n+        int table[4];\n+        for (int i = 0; i < 4; ++i) {\n+            table[i] = g_insecure_rand_ctx.randbits(3);\n+        }\n+        for (int order = 0; order < 4; ++order) {\n+            MuHash3072 acc;\n+            for (int i = 0; i < 4; ++i) {\n+                int t = table[i ^ order];\n+                if (t & 4) {\n+                    acc /= FromInt(t & 3);\n+                } else {\n+                    acc *= FromInt(t & 3);\n+                }\n+            }\n+            acc.Finalize(out);\n+            if (order == 0) {\n+                memcpy(res, out, 384);\n+            } else {\n+                BOOST_CHECK(memcmp(res, out, 384) == 0);\n+            }\n+        }\n+\n+        MuHash3072 x = FromInt(g_insecure_rand_ctx.randbits(4)); // x=X\n+        MuHash3072 y = FromInt(g_insecure_rand_ctx.randbits(4)); // x=X, y=Y\n+        MuHash3072 z; // x=X, y=Y, z=1\n+        z *= x; // x=X, y=Y, z=X\n+        z /= y; // x=X, y=Y, z=X/Y",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r489135525",
      "id" : 489135525,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTEzNTUyNQ==",
      "original_commit_id" : "c540f8edc143e856474a27626cc0bd08018ed734",
      "original_line" : 898,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "src/test/crypto_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 489223281,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489135525",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r489161487"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489161487"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Might as well move the `d->limbs[0]` case prior to the for loop.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-09-16T04:56:58Z",
      "diff_hunk" : "@@ -0,0 +1,292 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_type MAX_PRIME_DIFF = 1103717;\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& c2, Num3072::limb_type& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(Num3072::limb_type& c0, Num3072::limb_type& c1, const Num3072::limb_type& a, const Num3072::limb_type& b)\n+{\n+    Num3072::double_limb_type t = (Num3072::double_limb_type)a * b;\n+    c1 = t >> Num3072::LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& c2, Num3072::limb_type& d0, Num3072::limb_type& d1, Num3072::limb_type& d2, const Num3072::limb_type& n)\n+{\n+    Num3072::double_limb_type t = (Num3072::double_limb_type)d0 * n + c0;\n+    c0 = t;\n+    t >>= Num3072::LIMB_SIZE;\n+    t += (Num3072::double_limb_type)d1 * n + c1;\n+    c1 = t;\n+    t >>= Num3072::LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(Num3072::limb_type& c0, Num3072::limb_type& c1, const Num3072::limb_type& n)\n+{\n+    Num3072::double_limb_type t = (Num3072::double_limb_type)c0 * n;\n+    c0 = t;\n+    t >>= Num3072::LIMB_SIZE;\n+    t += (Num3072::double_limb_type)c1 * n;\n+    c1 = t;\n+    t >>= Num3072::LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& c2, const Num3072::limb_type& a, const Num3072::limb_type& b)\n+{\n+    Num3072::limb_type tl, th;\n+    {\n+        Num3072::double_limb_type t = (Num3072::double_limb_type)a * b;\n+        th = t >> Num3072::LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& c2, const Num3072::limb_type& a, const Num3072::limb_type& b)\n+{\n+    Num3072::limb_type tl, th;\n+    {\n+        Num3072::double_limb_type t = (Num3072::double_limb_type)a * b;\n+        th = t >> Num3072::LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    Num3072::limb_type tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072* d)\n+{\n+    for (int i = 1; i < Num3072::LIMBS - 1; ++i) {\n+        if (d->limbs[i] != std::numeric_limits<Num3072::limb_type>::max()) return false;\n+    }\n+    if (d->limbs[0] <= std::numeric_limits<Num3072::limb_type>::max() - MAX_PRIME_DIFF) return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r489161487",
      "id" : 489161487,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTE2MTQ4Nw==",
      "original_commit_id" : "c540f8edc143e856474a27626cc0bd08018ed734",
      "original_line" : 114,
      "original_position" : 114,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 489274591,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489161487",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r489167116"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489167116"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think the for loop should be `i = 1; i < LIMBS; ++i` not `LIMBS-1`?\r\n\r\nMight be clever to have `data` be `protected` rather than `private` so it can be initialised directly to edge cases via a subclass in the unit tests, without having to find a chacha-primage for them.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-09-16T05:12:58Z",
      "diff_hunk" : "@@ -0,0 +1,292 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_type MAX_PRIME_DIFF = 1103717;\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& c2, Num3072::limb_type& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(Num3072::limb_type& c0, Num3072::limb_type& c1, const Num3072::limb_type& a, const Num3072::limb_type& b)\n+{\n+    Num3072::double_limb_type t = (Num3072::double_limb_type)a * b;\n+    c1 = t >> Num3072::LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& c2, Num3072::limb_type& d0, Num3072::limb_type& d1, Num3072::limb_type& d2, const Num3072::limb_type& n)\n+{\n+    Num3072::double_limb_type t = (Num3072::double_limb_type)d0 * n + c0;\n+    c0 = t;\n+    t >>= Num3072::LIMB_SIZE;\n+    t += (Num3072::double_limb_type)d1 * n + c1;\n+    c1 = t;\n+    t >>= Num3072::LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(Num3072::limb_type& c0, Num3072::limb_type& c1, const Num3072::limb_type& n)\n+{\n+    Num3072::double_limb_type t = (Num3072::double_limb_type)c0 * n;\n+    c0 = t;\n+    t >>= Num3072::LIMB_SIZE;\n+    t += (Num3072::double_limb_type)c1 * n;\n+    c1 = t;\n+    t >>= Num3072::LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& c2, const Num3072::limb_type& a, const Num3072::limb_type& b)\n+{\n+    Num3072::limb_type tl, th;\n+    {\n+        Num3072::double_limb_type t = (Num3072::double_limb_type)a * b;\n+        th = t >> Num3072::LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& c2, const Num3072::limb_type& a, const Num3072::limb_type& b)\n+{\n+    Num3072::limb_type tl, th;\n+    {\n+        Num3072::double_limb_type t = (Num3072::double_limb_type)a * b;\n+        th = t >> Num3072::LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    Num3072::limb_type tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072* d)\n+{\n+    for (int i = 1; i < Num3072::LIMBS - 1; ++i) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r489167116",
      "id" : 489167116,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTE2NzExNg==",
      "original_commit_id" : "c540f8edc143e856474a27626cc0bd08018ed734",
      "original_line" : 111,
      "original_position" : 111,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 489274591,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489167116",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r489171646"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489171646"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This is only ever called with `out == a`, so could take a single argument. Similarly for Multiply which is also always in-place.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-09-16T05:28:26Z",
      "diff_hunk" : "@@ -0,0 +1,292 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_type MAX_PRIME_DIFF = 1103717;\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& c2, Num3072::limb_type& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(Num3072::limb_type& c0, Num3072::limb_type& c1, const Num3072::limb_type& a, const Num3072::limb_type& b)\n+{\n+    Num3072::double_limb_type t = (Num3072::double_limb_type)a * b;\n+    c1 = t >> Num3072::LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& c2, Num3072::limb_type& d0, Num3072::limb_type& d1, Num3072::limb_type& d2, const Num3072::limb_type& n)\n+{\n+    Num3072::double_limb_type t = (Num3072::double_limb_type)d0 * n + c0;\n+    c0 = t;\n+    t >>= Num3072::LIMB_SIZE;\n+    t += (Num3072::double_limb_type)d1 * n + c1;\n+    c1 = t;\n+    t >>= Num3072::LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(Num3072::limb_type& c0, Num3072::limb_type& c1, const Num3072::limb_type& n)\n+{\n+    Num3072::double_limb_type t = (Num3072::double_limb_type)c0 * n;\n+    c0 = t;\n+    t >>= Num3072::LIMB_SIZE;\n+    t += (Num3072::double_limb_type)c1 * n;\n+    c1 = t;\n+    t >>= Num3072::LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& c2, const Num3072::limb_type& a, const Num3072::limb_type& b)\n+{\n+    Num3072::limb_type tl, th;\n+    {\n+        Num3072::double_limb_type t = (Num3072::double_limb_type)a * b;\n+        th = t >> Num3072::LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& c2, const Num3072::limb_type& a, const Num3072::limb_type& b)\n+{\n+    Num3072::limb_type tl, th;\n+    {\n+        Num3072::double_limb_type t = (Num3072::double_limb_type)a * b;\n+        th = t >> Num3072::LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    Num3072::limb_type tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072* d)\n+{\n+    for (int i = 1; i < Num3072::LIMBS - 1; ++i) {\n+        if (d->limbs[i] != std::numeric_limits<Num3072::limb_type>::max()) return false;\n+    }\n+    if (d->limbs[0] <= std::numeric_limits<Num3072::limb_type>::max() - MAX_PRIME_DIFF) return false;\n+    return true;\n+}\n+\n+void FullReduce(Num3072* d)\n+{\n+    Num3072::limb_type c0 = MAX_PRIME_DIFF;\n+    for (int i = 0; i < Num3072::LIMBS; ++i) {\n+        Num3072::limb_type c1 = 0;\n+        add2(c0, c1, d->limbs[i]);\n+        extract2(c0, c1, d->limbs[i]);\n+    }\n+}\n+\n+void Multiply(Num3072* out, const Num3072* a, const Num3072* b)\n+{\n+    Num3072::limb_type c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of a*b into tmp, including one reduction. */\n+    for (int j = 0; j < Num3072::LIMBS - 1; ++j) {\n+        Num3072::limb_type d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        mul(d0, d1, a->limbs[1 + j], b->limbs[Num3072::LIMBS + j - (1 + j)]);\n+        for (int i = 2 + j; i < Num3072::LIMBS; ++i) muladd3(d0, d1, d2, a->limbs[i], b->limbs[Num3072::LIMBS + j - i]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < j + 1; ++i) muladd3(c0, c1, c2, a->limbs[i], b->limbs[j - i]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    /* Compute limb N-1 of a*b into tmp. */\n+    {\n+        Num3072::limb_type c2 = 0;\n+        for (int i = 0; i < Num3072::LIMBS; ++i) muladd3(c0, c1, c2, a->limbs[i], b->limbs[Num3072::LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[Num3072::LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < Num3072::LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, out->limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(out);\n+}\n+\n+void Square(Num3072* out, const Num3072* a)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r489171646",
      "id" : 489171646,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTE3MTY0Ng==",
      "original_commit_id" : "c540f8edc143e856474a27626cc0bd08018ed734",
      "original_line" : 162,
      "original_position" : 162,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 489274591,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489171646",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r489200958"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489200958"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Dropping all the `Num3072::` prefixes might make the code a little less noisy:\r\n\r\n```c++\r\nusing limb_type = Num3072::limb_type;\r\nusing double_limb_type = Num3072::double_limb_type;\r\nconstexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\r\nconstexpr int LIMBS = Num3072::LIMBS;\r\n```\r\n\r\n(also, wouldn't `limb_t` be more normal than `limb_type`?)\r\n\r\nProbably overkill, but maybe consider checking the `Num3072` constants make sense:\r\n\r\n```c++\r\nstatic_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\r\nstatic_assert(sizeof(double_limb_type) == sizeof(limb_type) * 2, \"bad size for double_limb_type\");\r\nstatic_assert(sizeof(limb_type) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\r\n\r\n// hard coded values in MuHash3072 constructor and Finalize\r\nstatic_assert(sizeof(limb_type) == 4 || sizeof(limb_type) == 8, \"bad size for limb_type\");\r\n```",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-09-16T06:47:08Z",
      "diff_hunk" : "@@ -0,0 +1,292 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r489200958",
      "id" : 489200958,
      "line" : 15,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTIwMDk1OA==",
      "original_commit_id" : "c540f8edc143e856474a27626cc0bd08018ed734",
      "original_line" : 15,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : 15,
      "pull_request_review_id" : 489274591,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489200958",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r492377373"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/492377373"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-09-21T22:17:18Z",
      "diff_hunk" : "@@ -0,0 +1,292 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_type MAX_PRIME_DIFF = 1103717;\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& c2, Num3072::limb_type& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(Num3072::limb_type& c0, Num3072::limb_type& c1, const Num3072::limb_type& a, const Num3072::limb_type& b)\n+{\n+    Num3072::double_limb_type t = (Num3072::double_limb_type)a * b;\n+    c1 = t >> Num3072::LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& c2, Num3072::limb_type& d0, Num3072::limb_type& d1, Num3072::limb_type& d2, const Num3072::limb_type& n)\n+{\n+    Num3072::double_limb_type t = (Num3072::double_limb_type)d0 * n + c0;\n+    c0 = t;\n+    t >>= Num3072::LIMB_SIZE;\n+    t += (Num3072::double_limb_type)d1 * n + c1;\n+    c1 = t;\n+    t >>= Num3072::LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(Num3072::limb_type& c0, Num3072::limb_type& c1, const Num3072::limb_type& n)\n+{\n+    Num3072::double_limb_type t = (Num3072::double_limb_type)c0 * n;\n+    c0 = t;\n+    t >>= Num3072::LIMB_SIZE;\n+    t += (Num3072::double_limb_type)c1 * n;\n+    c1 = t;\n+    t >>= Num3072::LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& c2, const Num3072::limb_type& a, const Num3072::limb_type& b)\n+{\n+    Num3072::limb_type tl, th;\n+    {\n+        Num3072::double_limb_type t = (Num3072::double_limb_type)a * b;\n+        th = t >> Num3072::LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& c2, const Num3072::limb_type& a, const Num3072::limb_type& b)\n+{\n+    Num3072::limb_type tl, th;\n+    {\n+        Num3072::double_limb_type t = (Num3072::double_limb_type)a * b;\n+        th = t >> Num3072::LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    Num3072::limb_type tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072* d)\n+{\n+    for (int i = 1; i < Num3072::LIMBS - 1; ++i) {\n+        if (d->limbs[i] != std::numeric_limits<Num3072::limb_type>::max()) return false;\n+    }\n+    if (d->limbs[0] <= std::numeric_limits<Num3072::limb_type>::max() - MAX_PRIME_DIFF) return false;\n+    return true;\n+}\n+\n+void FullReduce(Num3072* d)\n+{\n+    Num3072::limb_type c0 = MAX_PRIME_DIFF;\n+    for (int i = 0; i < Num3072::LIMBS; ++i) {\n+        Num3072::limb_type c1 = 0;\n+        add2(c0, c1, d->limbs[i]);\n+        extract2(c0, c1, d->limbs[i]);\n+    }\n+}\n+\n+void Multiply(Num3072* out, const Num3072* a, const Num3072* b)\n+{\n+    Num3072::limb_type c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of a*b into tmp, including one reduction. */\n+    for (int j = 0; j < Num3072::LIMBS - 1; ++j) {\n+        Num3072::limb_type d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        mul(d0, d1, a->limbs[1 + j], b->limbs[Num3072::LIMBS + j - (1 + j)]);\n+        for (int i = 2 + j; i < Num3072::LIMBS; ++i) muladd3(d0, d1, d2, a->limbs[i], b->limbs[Num3072::LIMBS + j - i]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < j + 1; ++i) muladd3(c0, c1, c2, a->limbs[i], b->limbs[j - i]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    /* Compute limb N-1 of a*b into tmp. */\n+    {\n+        Num3072::limb_type c2 = 0;\n+        for (int i = 0; i < Num3072::LIMBS; ++i) muladd3(c0, c1, c2, a->limbs[i], b->limbs[Num3072::LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[Num3072::LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < Num3072::LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, out->limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(out);\n+}\n+\n+void Square(Num3072* out, const Num3072* a)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r492377373",
      "id" : 492377373,
      "in_reply_to_id" : 489171646,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjM3NzM3Mw==",
      "original_commit_id" : "c540f8edc143e856474a27626cc0bd08018ed734",
      "original_line" : 162,
      "original_position" : 162,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 493019097,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/492377373",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r492377415"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/492377415"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think all these suggestions are sensible. Added.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-09-21T22:17:25Z",
      "diff_hunk" : "@@ -0,0 +1,292 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r492377415",
      "id" : 492377415,
      "in_reply_to_id" : 489200958,
      "line" : 15,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjM3NzQxNQ==",
      "original_commit_id" : "c540f8edc143e856474a27626cc0bd08018ed734",
      "original_line" : 15,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : 15,
      "pull_request_review_id" : 493019154,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/492377415",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r492377548"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/492377548"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-09-21T22:17:47Z",
      "diff_hunk" : "@@ -0,0 +1,292 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_type MAX_PRIME_DIFF = 1103717;\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& c2, Num3072::limb_type& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(Num3072::limb_type& c0, Num3072::limb_type& c1, const Num3072::limb_type& a, const Num3072::limb_type& b)\n+{\n+    Num3072::double_limb_type t = (Num3072::double_limb_type)a * b;\n+    c1 = t >> Num3072::LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& c2, Num3072::limb_type& d0, Num3072::limb_type& d1, Num3072::limb_type& d2, const Num3072::limb_type& n)\n+{\n+    Num3072::double_limb_type t = (Num3072::double_limb_type)d0 * n + c0;\n+    c0 = t;\n+    t >>= Num3072::LIMB_SIZE;\n+    t += (Num3072::double_limb_type)d1 * n + c1;\n+    c1 = t;\n+    t >>= Num3072::LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(Num3072::limb_type& c0, Num3072::limb_type& c1, const Num3072::limb_type& n)\n+{\n+    Num3072::double_limb_type t = (Num3072::double_limb_type)c0 * n;\n+    c0 = t;\n+    t >>= Num3072::LIMB_SIZE;\n+    t += (Num3072::double_limb_type)c1 * n;\n+    c1 = t;\n+    t >>= Num3072::LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& c2, const Num3072::limb_type& a, const Num3072::limb_type& b)\n+{\n+    Num3072::limb_type tl, th;\n+    {\n+        Num3072::double_limb_type t = (Num3072::double_limb_type)a * b;\n+        th = t >> Num3072::LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& c2, const Num3072::limb_type& a, const Num3072::limb_type& b)\n+{\n+    Num3072::limb_type tl, th;\n+    {\n+        Num3072::double_limb_type t = (Num3072::double_limb_type)a * b;\n+        th = t >> Num3072::LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    Num3072::limb_type tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072* d)\n+{\n+    for (int i = 1; i < Num3072::LIMBS - 1; ++i) {\n+        if (d->limbs[i] != std::numeric_limits<Num3072::limb_type>::max()) return false;\n+    }\n+    if (d->limbs[0] <= std::numeric_limits<Num3072::limb_type>::max() - MAX_PRIME_DIFF) return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r492377548",
      "id" : 492377548,
      "in_reply_to_id" : 489161487,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjM3NzU0OA==",
      "original_commit_id" : "c540f8edc143e856474a27626cc0bd08018ed734",
      "original_line" : 114,
      "original_position" : 114,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 493019313,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/492377548",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r492377632"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/492377632"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yeah, I think this makes sense. From what I have read I think there was just no research done on the security of this. I think it makes sense to be defensive but I amended the comment that this would just not the intended use. I also updated the test to follow this.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-09-21T22:18:00Z",
      "diff_hunk" : "@@ -857,4 +858,58 @@ BOOST_AUTO_TEST_CASE(sha3_256_tests)\n     TestSHA3_256(\"72c57c359e10684d0517e46653a02d18d29eff803eb009e4d5eb9e95add9ad1a4ac1f38a70296f3a369a16985ca3c957de2084cdc9bdd8994eb59b8815e0debad4ec1f001feac089820db8becdaf896aaf95721e8674e5d476b43bd2b873a7d135cd685f545b438210f9319e4dcd55986c85303c1ddf18dc746fe63a409df0a998ed376eb683e16c09e6e9018504152b3e7628ef350659fb716e058a5263a18823d2f2f6ee6a8091945a48ae1c5cb1694cf2c1fe76ef9177953afe8899cfa2b7fe0603bfa3180937dadfb66fbbdd119bbf8063338aa4a699075a3bfdbae8db7e5211d0917e9665a702fc9b0a0a901d08bea97654162d82a9f05622b060b634244779c33427eb7a29353a5f48b07cbefa72f3622ac5900bef77b71d6b314296f304c8426f451f32049b1f6af156a9dab702e8907d3cd72bb2c50493f4d593e731b285b70c803b74825b3524cda3205a8897106615260ac93c01c5ec14f5b11127783989d1824527e99e04f6a340e827b559f24db9292fcdd354838f9339a5fa1d7f6b2087f04835828b13463dd40927866f16ae33ed501ec0e6c4e63948768c5aeea3e4f6754985954bea7d61088c44430204ef491b74a64bde1358cecb2cad28ee6a3de5b752ff6a051104d88478653339457ac45ba44cbb65f54d1969d047cda746931d5e6a8b48e211416aefd5729f3d60b56b54e7f85aa2f42de3cb69419240c24e67139a11790a709edef2ac52cf35dd0a08af45926ebe9761f498ff83bfe263d6897ee97943a4b982fe3404ef0b4a45e06113c60340e0664f14799bf59cb4b3934b465fabefd87155905ee5309ba41e9e402973311831ea600b16437f71df39ee77130490c4d0227e5d1757fdc66af3ae6b9953053ed9aafca0160209858a7d4dd38fe10e0cb153672d08633ed6c54977aa0a6e67f9ff2f8c9d22dd7b21de08192960fd0e0da68d77c8d810db11dcaa61c725cd4092cbff76c8e1debd8d0361bb3f2e607911d45716f53067bdc0d89dd4889177765166a424e9fc0cb711201099dda213355e6639ac7eb86eca2ae0ab38b7f674f37ef8a6fcca1a6f52f55d9e1dcd631d2c3c82bba129172feb991d5af51afecd9d61a88b6832e4107480e392aed61a8644f551665ebff6b20953b635737a4f895e429fddcfe801f606fbda74b3bf6f5767d0fac14907fcfd0aa1d4c11b9e91b01d68052399b51a29f1ae6acd965109977c14a555cbcbd21ad8cb9f8853506d4bc21c01e62d61d7b21be1b923be54914e6b0a7ca84dd11f1159193e1184568a6134a6bbadf5b4df986edcf2019390ae841cfaa44435e28ce877d3dae4177992fa5d4e5c005876dbe3d1e63bec7dcc0942762b48b1ecc6c1a918409a8a72812a1e245c0c67be6e729c2b49bc6ee4d24a8f63e78e75db45655c26a9a78aff36fcd67117f26b8f654dca664b9f0e30681874cb749e1a692720078856286c2560b0292cc837933423147569350955c9571bf8941ba128fd339cb4268f46b94bc6ee203eb7026813706ea51c4f24c91866fc23a724bf2501327e6ae89c29f8db315dc28d2c7c719514036367e018f4835f63fdecd71f9bdced7132b6c4f8b13c69a517026fcd3622d67cb632320d5e7308f78f4b7cea11f6291b137851dc6cd6366f2785c71c3f237f81a7658b2a8d512b61e0ad5a4710b7b124151689fcb2116063fbff7e9115fed7b93de834970b838e49f8f8ba5f1f874c354078b5810a55ae289a56da563f1da6cd80a3757d6073fa55e016e45ac6cec1f69d871c92fd0ae9670c74249045e6b464787f9504128736309fed205f8df4d90e332908581298d9c75a3fa36ab0c3c9272e62de53ab290c803d67b696fd615c260a47bffad16746f18ba1a10a061bacbea9369693b3c042eec36bed289d7d12e52bca8aa1c2dff88ca7816498d25626d0f1e106ebb0b4a12138e00f3df5b1c2f49d98b1756e69b641b7c6353d99dbff050f4d76842c6cf1c2a4b062fc8e6336fa689b7c9d5c6b4ab8c15a5c20e514ff070a602d85ae52fa7810c22f8eeffd34a095b93342144f7a98d024216b3d68ed7bea047517bfcd83ec83febd1ba0e5858e2bdc1d8b1f7b0f89e90ccc432a3f930cb8209462e64556c5054c56ca2a85f16b32eb83a10459d13516faa4d23302b7607b9bd38dab2239ac9e9440c314433fdfb3ceadab4b4f87415ed6f240e017221f3b5f7ac196cdf54957bec42fe6893994b46de3d27dc7fb58ca88feb5b9e79cf20053d12530ac524337b22a3629bea52f40b06d3e2128f32060f9105847daed81d35f20e2002817434659baff64494c5b5c7f9216bfda38412a0f70511159dc73bb6bae1f8eaa0ef08d99bcb31f94f6be12c29c83df45926430b366c99fca3270c15fc4056398fdf3135b7779e3066a006961d1ac0ad1c83179ce39e87a96b722ec23aabc065badf3e188347a360772ca6a447abac7e6a44f0d4632d52926332e44a0a86bff5ce699fd063bdda3ffd4c41b53ded49fecec67f40599b934e16e3fd1bc063ad7026f8d71bfd4cbaf56599586774723194b692036f1b6bb242e2ffb9c600b5215b412764599476ce475c9e5b396fbcebd6be323dcf4d0048077400aac7500db41dc95fc7f7edbe7c9c2ec5ea89943fe13b42217eef530bbd023671509e12dfce4e1c1c82955d965e6a68aa66f6967dba48feda572db1f099d9a6dc4bc8edade852b5e824a06890dc48a6a6510ecaf8cf7620d757290e3166d431abecc624fa9ac2234d2eb783308ead45544910c633a94964b2ef5fbc409cb8835ac4147d384e12e0a5e13951f7de0ee13eafcb0ca0c04946d7804040c0a3cd088352424b097adb7aad1ca4495952f3e6c0158c02d2bcec33bfda69301434a84d9027ce02c0b9725dad118\", \"d894b86261436362e64241e61f6b3e6589daf64dc641f60570c4c0bf3b1f2ca3\");\n }\n \n+static MuHash3072 FromInt(unsigned char i) {\n+    unsigned char tmp[32] = {i, 0};\n+    return MuHash3072(tmp);\n+}\n+\n+BOOST_AUTO_TEST_CASE(muhash_tests)\n+{\n+    unsigned char out[384];\n+\n+    for (int iter = 0; iter < 10; ++iter) {\n+        unsigned char res[384];\n+        int table[4];\n+        for (int i = 0; i < 4; ++i) {\n+            table[i] = g_insecure_rand_ctx.randbits(3);\n+        }\n+        for (int order = 0; order < 4; ++order) {\n+            MuHash3072 acc;\n+            for (int i = 0; i < 4; ++i) {\n+                int t = table[i ^ order];\n+                if (t & 4) {\n+                    acc /= FromInt(t & 3);\n+                } else {\n+                    acc *= FromInt(t & 3);\n+                }\n+            }\n+            acc.Finalize(out);\n+            if (order == 0) {\n+                memcpy(res, out, 384);\n+            } else {\n+                BOOST_CHECK(memcmp(res, out, 384) == 0);\n+            }\n+        }\n+\n+        MuHash3072 x = FromInt(g_insecure_rand_ctx.randbits(4)); // x=X\n+        MuHash3072 y = FromInt(g_insecure_rand_ctx.randbits(4)); // x=X, y=Y\n+        MuHash3072 z; // x=X, y=Y, z=1\n+        z *= x; // x=X, y=Y, z=X\n+        z /= y; // x=X, y=Y, z=X/Y",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r492377632",
      "id" : 492377632,
      "in_reply_to_id" : 489135525,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjM3NzYzMg==",
      "original_commit_id" : "c540f8edc143e856474a27626cc0bd08018ed734",
      "original_line" : 898,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "src/test/crypto_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 493019415,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/492377632",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r492377900"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/492377900"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated that part a bit, I hope this is more clear.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-09-21T22:18:43Z",
      "diff_hunk" : "@@ -0,0 +1,78 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <stdint.h>\n+\n+struct Num3072 {\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_type;\n+    typedef uint64_t limb_type;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_type;\n+    typedef uint32_t limb_type;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_type limbs[LIMBS];\n+};\n+\n+/** A class representing MuHash sets\n+ *\n+ * MuHash is a hashing algorithm that supports adding set elements in any\n+ * order but also deleting in any order. As a result, it can maintain a\n+ * running sum for a set of data as a whole, and add/subtract when data\n+ * is added to or removed from it. A downside of MuHash is that computing\n+ * an inverse is relatively expensive. This can be solved by representing\n+ * the running value as a fraction, and multiplying added elements into\n+ * the numerator and removed elements into the denominator. Only when the\n+ * final hash is desired, a single modular inverse and multiplication is\n+ * needed to combine the two.\n+ *\n+ * As the update operations are also associative, H(a)+H(b)+H(c)+H(d) can\n+ * in fact be computed as (H(a)+H(b)) + (H(c)+H(d)). This implies that\n+ * all of this is perfectly parallellizable: each thread can process an\n+ * arbitrary subset of the update operations, allowing them to be\n+ * efficiently combined later.\n+ *\n+ * This class does not enforce the use of a set as the data it represents.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r492377900",
      "id" : 492377900,
      "in_reply_to_id" : 489133613,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjM3NzkwMA==",
      "original_commit_id" : "c540f8edc143e856474a27626cc0bd08018ed734",
      "original_line" : 47,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : null,
      "pull_request_review_id" : 493019728,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/492377900",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r492377925"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/492377925"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Makes sense. Done.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-09-21T22:18:49Z",
      "diff_hunk" : "@@ -0,0 +1,78 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <stdint.h>\n+\n+struct Num3072 {\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_type;\n+    typedef uint64_t limb_type;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_type;\n+    typedef uint32_t limb_type;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_type limbs[LIMBS];\n+};\n+\n+/** A class representing MuHash sets\n+ *\n+ * MuHash is a hashing algorithm that supports adding set elements in any\n+ * order but also deleting in any order. As a result, it can maintain a\n+ * running sum for a set of data as a whole, and add/subtract when data\n+ * is added to or removed from it. A downside of MuHash is that computing\n+ * an inverse is relatively expensive. This can be solved by representing\n+ * the running value as a fraction, and multiplying added elements into\n+ * the numerator and removed elements into the denominator. Only when the\n+ * final hash is desired, a single modular inverse and multiplication is\n+ * needed to combine the two.\n+ *\n+ * As the update operations are also associative, H(a)+H(b)+H(c)+H(d) can\n+ * in fact be computed as (H(a)+H(b)) + (H(c)+H(d)). This implies that\n+ * all of this is perfectly parallellizable: each thread can process an\n+ * arbitrary subset of the update operations, allowing them to be\n+ * efficiently combined later.\n+ *\n+ * This class does not enforce the use of a set as the data it represents.\n+ * It is possible to add elements more than once and also to remove\n+ * elements that have not been added before. However, it is not clear if\n+ * security assumptions still hold in this case, so it should for now\n+ * only be used to represent a set of elements.\n+ *\n+ * See also https://cseweb.ucsd.edu/~mihir/papers/inchash.pdf and\n+ * https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014337.html.\n+ */\n+class MuHash3072\n+{\n+private:\n+    Num3072 data;\n+\n+public:\n+    /* The empty set. */\n+    MuHash3072() noexcept;\n+\n+    /* A singleton with a single 32-byte key in it. */\n+    explicit MuHash3072(const unsigned char* key32) noexcept;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r492377925",
      "id" : 492377925,
      "in_reply_to_id" : 489131218,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjM3NzkyNQ==",
      "original_commit_id" : "c540f8edc143e856474a27626cc0bd08018ed734",
      "original_line" : 66,
      "original_position" : 66,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : null,
      "pull_request_review_id" : 493019768,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/492377925",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r492378952"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/492378952"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks, this was a bug. I also added that test in an additional commit.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-09-21T22:21:20Z",
      "diff_hunk" : "@@ -73,6 +75,13 @@ class MuHash3072\n \n     /* Finalize into a 384-byte hash. Does not change this object's value. */\n     void Finalize(unsigned char* hash384) noexcept;\n+\n+    SERIALIZE_METHODS(MuHash3072, obj)\n+    {\n+        for (int i = 0; i < obj.LIMBS; ++i) {\n+            READWRITE(obj.limbs[i]);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r492378952",
      "id" : 492378952,
      "in_reply_to_id" : 489117810,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjM3ODk1Mg==",
      "original_commit_id" : "4cb77c70d3d43ebe004dc130d51ab0c75913c3f5",
      "original_line" : 82,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : null,
      "pull_request_review_id" : 493020934,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/492378952",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r492379981"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/492379981"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yeah, that makes sense. I also took your suggestion and added a basic test that executes the `IsOverflow` function which wasn't covered so far.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-09-21T22:24:09Z",
      "diff_hunk" : "@@ -0,0 +1,292 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_type MAX_PRIME_DIFF = 1103717;\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& c2, Num3072::limb_type& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(Num3072::limb_type& c0, Num3072::limb_type& c1, const Num3072::limb_type& a, const Num3072::limb_type& b)\n+{\n+    Num3072::double_limb_type t = (Num3072::double_limb_type)a * b;\n+    c1 = t >> Num3072::LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& c2, Num3072::limb_type& d0, Num3072::limb_type& d1, Num3072::limb_type& d2, const Num3072::limb_type& n)\n+{\n+    Num3072::double_limb_type t = (Num3072::double_limb_type)d0 * n + c0;\n+    c0 = t;\n+    t >>= Num3072::LIMB_SIZE;\n+    t += (Num3072::double_limb_type)d1 * n + c1;\n+    c1 = t;\n+    t >>= Num3072::LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(Num3072::limb_type& c0, Num3072::limb_type& c1, const Num3072::limb_type& n)\n+{\n+    Num3072::double_limb_type t = (Num3072::double_limb_type)c0 * n;\n+    c0 = t;\n+    t >>= Num3072::LIMB_SIZE;\n+    t += (Num3072::double_limb_type)c1 * n;\n+    c1 = t;\n+    t >>= Num3072::LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& c2, const Num3072::limb_type& a, const Num3072::limb_type& b)\n+{\n+    Num3072::limb_type tl, th;\n+    {\n+        Num3072::double_limb_type t = (Num3072::double_limb_type)a * b;\n+        th = t >> Num3072::LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& c2, const Num3072::limb_type& a, const Num3072::limb_type& b)\n+{\n+    Num3072::limb_type tl, th;\n+    {\n+        Num3072::double_limb_type t = (Num3072::double_limb_type)a * b;\n+        th = t >> Num3072::LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    Num3072::limb_type tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(Num3072::limb_type& c0, Num3072::limb_type& c1, Num3072::limb_type& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072* d)\n+{\n+    for (int i = 1; i < Num3072::LIMBS - 1; ++i) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r492379981",
      "id" : 492379981,
      "in_reply_to_id" : 489167116,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjM3OTk4MQ==",
      "original_commit_id" : "c540f8edc143e856474a27626cc0bd08018ed734",
      "original_line" : 111,
      "original_position" : 111,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 493022221,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/492379981",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks a lot for the review @ajtowns . I hope I have addressed all of your feedback.\r\n\r\n> Would be nice to have more test vectors checking that the c++ and python code end up with the same results. ACK otherwise.\r\n\r\nThere are more tests like this coming in the follow-up #19145 . Unless you disagree I would prefer to keep the scope of this PR were it is :)",
      "created_at" : "2020-09-21T22:32:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-696413868",
      "id" : 696413868,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5NjQxMzg2OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-21T22:32:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/696413868",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r492832419"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/492832419"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Confirmed that this is calculating `out = a ** (2**3072 - MAX_PRIME_DIFF - 2)` by noting that all the operations are multiplicative and thus you can take the log of everything in base `a`, giving:\r\n\r\n```python\r\n>>> p = [2**(2**i)-1 for i in range(12)]\r\n>>> def double_n_add(x, n, pn):\r\n...     for j in range(n): x *= 2\r\n...     return x + p[pn]\r\n... \r\n>>> x = p[11]\r\n>>> x = double_n_add(x, 512, 9)\r\n>>> x = double_n_add(x, 256, 8)\r\n>>> x = double_n_add(x, 128, 7)\r\n>>> x = double_n_add(x,  64, 6)\r\n>>> x = double_n_add(x,  32, 5)\r\n>>> x = double_n_add(x,   8, 3)\r\n>>> x = double_n_add(x,   2, 1)\r\n>>> x = double_n_add(x,   1, 0)\r\n>>> x = double_n_add(x,   5, 2)\r\n>>> x = double_n_add(x,   3, 0)\r\n>>> x = double_n_add(x,   2, 0)\r\n>>> x = double_n_add(x,   4, 0)\r\n>>> x = double_n_add(x,   4, 1)\r\n>>> x = double_n_add(x,   3, 0)\r\n>>> x == 2**3072 - 1103717 - 2\r\nTrue\r\n```",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-09-22T15:30:36Z",
      "diff_hunk" : "@@ -0,0 +1,304 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+    {\n+        double_limb_t t = (double_limb_t)a * b;\n+        th = t >> LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+    {\n+        double_limb_t t = (double_limb_t)a * b;\n+        th = t >> LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, limb_t& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072* d)\n+{\n+    if (d->limbs[0] <= std::numeric_limits<limb_t>::max() - MAX_PRIME_DIFF) return false;\n+    for (int i = 1; i < LIMBS; ++i) {\n+        if (d->limbs[i] != std::numeric_limits<limb_t>::max()) return false;\n+    }\n+    return true;\n+}\n+\n+void FullReduce(Num3072* d)\n+{\n+    limb_t c0 = MAX_PRIME_DIFF;\n+    for (int i = 0; i < LIMBS; ++i) {\n+        limb_t c1 = 0;\n+        add2(c0, c1, d->limbs[i]);\n+        extract2(c0, c1, d->limbs[i]);\n+    }\n+}\n+\n+void Multiply(Num3072* in_out, const Num3072* a)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*a into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        mul(d0, d1, in_out->limbs[1 + j], a->limbs[LIMBS + j - (1 + j)]);\n+        for (int i = 2 + j; i < LIMBS; ++i) muladd3(d0, d1, d2, in_out->limbs[i], a->limbs[LIMBS + j - i]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < j + 1; ++i) muladd3(c0, c1, c2, in_out->limbs[i], a->limbs[j - i]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    /* Compute limb N-1 of a*b into tmp. */\n+    {\n+        limb_t c2 = 0;\n+        for (int i = 0; i < LIMBS; ++i) muladd3(c0, c1, c2, in_out->limbs[i], a->limbs[LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out->limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Square(Num3072* in_out)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*in_out into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        for (int i = 0; i < (LIMBS - 1 - j) / 2; ++i) muldbladd3(d0, d1, d2, in_out->limbs[i + j + 1], in_out->limbs[LIMBS - 1 - i]);\n+        if ((j + 1) & 1) muladd3(d0, d1, d2, in_out->limbs[(LIMBS - 1 - j) / 2 + j + 1], in_out->limbs[LIMBS - 1 - (LIMBS - 1 - j) / 2]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < (j + 1) / 2; ++i) muldbladd3(c0, c1, c2, in_out->limbs[i], in_out->limbs[j - i]);\n+        if ((j + 1) & 1) muladd3(c0, c1, c2, in_out->limbs[(j + 1) / 2], in_out->limbs[j - (j + 1) / 2]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    {\n+        limb_t c2 = 0;\n+        for (int i = 0; i < LIMBS / 2; ++i) muldbladd3(c0, c1, c2, in_out->limbs[i], in_out->limbs[LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out->limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Inverse(Num3072* out, const Num3072* a)\n+{\n+    // For fast exponentiation a sliding window exponentiation with repunit\n+    // precomputation is utilized. See \"Fast Point Decompression for Standard\n+    // Elliptic Curves\" (Brumley, JÃ¤rvinen, 2008).",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r492832419",
      "id" : 492832419,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjgzMjQxOQ==",
      "original_commit_id" : "ef53ca76cc616cd359969533a75c3dab388ec38d",
      "original_line" : 210,
      "original_position" : 210,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 493589996,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/492832419",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r492867088"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/492867088"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Missing `}` for case 9.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-09-22T16:18:28Z",
      "diff_hunk" : "@@ -122,6 +135,9 @@ void test_one_input(const std::vector<uint8_t>& buffer)\n             case 9: {\n                 data.resize(SHA3_256::OUTPUT_SIZE);\n                 sha3.Finalize(data);\n+            case 10: {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r492867088",
      "id" : 492867088,
      "line" : 136,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjg2NzA4OA==",
      "original_commit_id" : "f9b3c4bf0686e418e32c4a60f5598e7c23599d93",
      "original_line" : 136,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "src/test/fuzz/crypto.cpp",
      "position" : 46,
      "pull_request_review_id" : 493589996,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/492867088",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r492867231"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/492867231"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`Finalize(data)`",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-09-22T16:18:40Z",
      "diff_hunk" : "@@ -122,6 +135,9 @@ void test_one_input(const std::vector<uint8_t>& buffer)\n             case 9: {\n                 data.resize(SHA3_256::OUTPUT_SIZE);\n                 sha3.Finalize(data);\n+            case 10: {\n+                data.resize(384);\n+                muhash.Finalize(data.data());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r492867231",
      "id" : 492867231,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjg2NzIzMQ==",
      "original_commit_id" : "f9b3c4bf0686e418e32c4a60f5598e7c23599d93",
      "original_line" : 140,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/test/fuzz/crypto.cpp",
      "position" : null,
      "pull_request_review_id" : 493589996,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/492867231",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r492867426"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/492867426"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`MuHash3072(muhash_data)`",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-09-22T16:18:57Z",
      "diff_hunk" : "@@ -60,6 +62,16 @@ void test_one_input(const std::vector<uint8_t>& buffer)\n             (void)Hash(data);\n             (void)Hash160(data);\n             (void)sha512.Size();\n+\n+            // MuHash3072 only accepts a fixed key length of 32 bytes\n+            std::vector<uint8_t> muhash_data = data;\n+            muhash_data.resize(32);\n+\n+            if (fuzzed_data_provider.ConsumeBool()) {\n+                muhash *= MuHash3072(muhash_data.data());\n+            } else {\n+                muhash /= MuHash3072(muhash_data.data());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r492867426",
      "id" : 492867426,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjg2NzQyNg==",
      "original_commit_id" : "f9b3c4bf0686e418e32c4a60f5598e7c23599d93",
      "original_line" : 73,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/test/fuzz/crypto.cpp",
      "position" : null,
      "pull_request_review_id" : 493589996,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/492867426",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Pushed fuzz test fixes, thanks @ajtowns !",
      "created_at" : "2020-10-03T00:02:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-703006924",
      "id" : 703006924,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwMzAwNjkyNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-03T00:02:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/703006924",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r499093557"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499093557"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-03T00:02:48Z",
      "diff_hunk" : "@@ -60,6 +62,16 @@ void test_one_input(const std::vector<uint8_t>& buffer)\n             (void)Hash(data);\n             (void)Hash160(data);\n             (void)sha512.Size();\n+\n+            // MuHash3072 only accepts a fixed key length of 32 bytes\n+            std::vector<uint8_t> muhash_data = data;\n+            muhash_data.resize(32);\n+\n+            if (fuzzed_data_provider.ConsumeBool()) {\n+                muhash *= MuHash3072(muhash_data.data());\n+            } else {\n+                muhash /= MuHash3072(muhash_data.data());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r499093557",
      "id" : 499093557,
      "in_reply_to_id" : 492867426,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA5MzU1Nw==",
      "original_commit_id" : "f9b3c4bf0686e418e32c4a60f5598e7c23599d93",
      "original_line" : 73,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/test/fuzz/crypto.cpp",
      "position" : null,
      "pull_request_review_id" : 501500195,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499093557",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r499093569"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499093569"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-03T00:02:57Z",
      "diff_hunk" : "@@ -122,6 +135,9 @@ void test_one_input(const std::vector<uint8_t>& buffer)\n             case 9: {\n                 data.resize(SHA3_256::OUTPUT_SIZE);\n                 sha3.Finalize(data);\n+            case 10: {\n+                data.resize(384);\n+                muhash.Finalize(data.data());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r499093569",
      "id" : 499093569,
      "in_reply_to_id" : 492867231,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA5MzU2OQ==",
      "original_commit_id" : "f9b3c4bf0686e418e32c4a60f5598e7c23599d93",
      "original_line" : 140,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/test/fuzz/crypto.cpp",
      "position" : null,
      "pull_request_review_id" : 501500216,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499093569",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r499093583"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499093583"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-03T00:03:04Z",
      "diff_hunk" : "@@ -122,6 +135,9 @@ void test_one_input(const std::vector<uint8_t>& buffer)\n             case 9: {\n                 data.resize(SHA3_256::OUTPUT_SIZE);\n                 sha3.Finalize(data);\n+            case 10: {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r499093583",
      "id" : 499093583,
      "in_reply_to_id" : 492867088,
      "line" : 136,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA5MzU4Mw==",
      "original_commit_id" : "f9b3c4bf0686e418e32c4a60f5598e7c23599d93",
      "original_line" : 136,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "src/test/fuzz/crypto.cpp",
      "position" : 46,
      "pull_request_review_id" : 501500235,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499093583",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507170069"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507170069"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It seems a shame to make `Num3072` part of the public interface just so it can be used in a single test in crypt_tests.cpp. Is there a way the overflow test can be written without using the `Num3072` class?",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-18T14:31:50Z",
      "diff_hunk" : "@@ -0,0 +1,97 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+\n+#include <stdint.h>\n+\n+struct Num3072 {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507170069",
      "id" : 507170069,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzE3MDA2OQ==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 16,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : null,
      "pull_request_review_id" : 511150383,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507170069",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507170142"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507170142"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This doesn't need to be in the public interface and can be in the .cpp file's unnamed namespace.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-18T14:32:27Z",
      "diff_hunk" : "@@ -0,0 +1,97 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+\n+#include <stdint.h>\n+\n+struct Num3072 {\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_t;\n+    typedef uint64_t limb_t;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_t;\n+    typedef uint32_t limb_t;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_t limbs[LIMBS];\n+};\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507170142",
      "id" : 507170142,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzE3MDE0Mg==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 32,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : null,
      "pull_request_review_id" : 511150383,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507170142",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507170212"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507170212"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Any reason not to use the project's style guide and name member variables with an `m_` prefix?",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-18T14:32:59Z",
      "diff_hunk" : "@@ -0,0 +1,97 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+\n+#include <stdint.h>\n+\n+struct Num3072 {\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_t;\n+    typedef uint64_t limb_t;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_t;\n+    typedef uint32_t limb_t;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_t limbs[LIMBS];\n+};\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+/** A class representing MuHash sets\n+ *\n+ * MuHash is a hashing algorithm that supports adding set elements in any\n+ * order but also deleting in any order. As a result, it can maintain a\n+ * running sum for a set of data as a whole, and add/subtract when data\n+ * is added to or removed from it. A downside of MuHash is that computing\n+ * an inverse is relatively expensive. This can be solved by representing\n+ * the running value as a fraction, and multiplying added elements into\n+ * the numerator and removed elements into the denominator. Only when the\n+ * final hash is desired, a single modular inverse and multiplication is\n+ * needed to combine the two.\n+ *\n+ * TODO: Represent running value as a fraction to allow for more intuitive\n+ * use (see above).\n+ *\n+ * As the update operations are also associative, H(a)+H(b)+H(c)+H(d) can\n+ * in fact be computed as (H(a)+H(b)) + (H(c)+H(d)). This implies that\n+ * all of this is perfectly parallellizable: each thread can process an\n+ * arbitrary subset of the update operations, allowing them to be\n+ * efficiently combined later.\n+ *\n+ * Muhash does not support checking if an element is already part of the\n+ * set. That is why this class does not enforce the use of a set as the\n+ * data it represents because there is no efficient way to do so..\n+ * It is possible to add elements more than once and also to remove\n+ * elements that have not been added before. However, this implementation\n+ * is intended to represent a set of elements.\n+ *\n+ * See also https://cseweb.ucsd.edu/~mihir/papers/inchash.pdf and\n+ * https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014337.html.\n+ */\n+class MuHash3072\n+{\n+protected:\n+    Num3072 data;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507170212",
      "id" : 507170212,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzE3MDIxMg==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 68,
      "original_position" : 68,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : null,
      "pull_request_review_id" : 511150383,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507170212",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507170280"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507170280"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Again, it'd be nice if these weren't exposed in the header file and were moved to the cpp file's unnamed namespace.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-18T14:33:32Z",
      "diff_hunk" : "@@ -0,0 +1,97 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+\n+#include <stdint.h>\n+\n+struct Num3072 {\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_t;\n+    typedef uint64_t limb_t;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_t;\n+    typedef uint32_t limb_t;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_t limbs[LIMBS];\n+};\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+/** A class representing MuHash sets\n+ *\n+ * MuHash is a hashing algorithm that supports adding set elements in any\n+ * order but also deleting in any order. As a result, it can maintain a\n+ * running sum for a set of data as a whole, and add/subtract when data\n+ * is added to or removed from it. A downside of MuHash is that computing\n+ * an inverse is relatively expensive. This can be solved by representing\n+ * the running value as a fraction, and multiplying added elements into\n+ * the numerator and removed elements into the denominator. Only when the\n+ * final hash is desired, a single modular inverse and multiplication is\n+ * needed to combine the two.\n+ *\n+ * TODO: Represent running value as a fraction to allow for more intuitive\n+ * use (see above).\n+ *\n+ * As the update operations are also associative, H(a)+H(b)+H(c)+H(d) can\n+ * in fact be computed as (H(a)+H(b)) + (H(c)+H(d)). This implies that\n+ * all of this is perfectly parallellizable: each thread can process an\n+ * arbitrary subset of the update operations, allowing them to be\n+ * efficiently combined later.\n+ *\n+ * Muhash does not support checking if an element is already part of the\n+ * set. That is why this class does not enforce the use of a set as the\n+ * data it represents because there is no efficient way to do so..\n+ * It is possible to add elements more than once and also to remove\n+ * elements that have not been added before. However, this implementation\n+ * is intended to represent a set of elements.\n+ *\n+ * See also https://cseweb.ucsd.edu/~mihir/papers/inchash.pdf and\n+ * https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014337.html.\n+ */\n+class MuHash3072\n+{\n+protected:\n+    Num3072 data;\n+\n+    static constexpr size_t INPUT_SIZE = 32;\n+    static constexpr size_t OUTPUT_SIZE = 384;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507170280",
      "id" : 507170280,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzE3MDI4MA==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 71,
      "original_position" : 71,
      "original_start_line" : 70,
      "path" : "src/crypto/muhash.h",
      "position" : null,
      "pull_request_review_id" : 511150383,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507170280",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507173075"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507173075"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is this platform independent (ie between HAVE___INT128 and !HAVE___INT128 platforms)? I guess so because the unit tests are asserting exact serializations.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-18T14:56:08Z",
      "diff_hunk" : "@@ -0,0 +1,97 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+\n+#include <stdint.h>\n+\n+struct Num3072 {\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_t;\n+    typedef uint64_t limb_t;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_t;\n+    typedef uint32_t limb_t;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_t limbs[LIMBS];\n+};\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+/** A class representing MuHash sets\n+ *\n+ * MuHash is a hashing algorithm that supports adding set elements in any\n+ * order but also deleting in any order. As a result, it can maintain a\n+ * running sum for a set of data as a whole, and add/subtract when data\n+ * is added to or removed from it. A downside of MuHash is that computing\n+ * an inverse is relatively expensive. This can be solved by representing\n+ * the running value as a fraction, and multiplying added elements into\n+ * the numerator and removed elements into the denominator. Only when the\n+ * final hash is desired, a single modular inverse and multiplication is\n+ * needed to combine the two.\n+ *\n+ * TODO: Represent running value as a fraction to allow for more intuitive\n+ * use (see above).\n+ *\n+ * As the update operations are also associative, H(a)+H(b)+H(c)+H(d) can\n+ * in fact be computed as (H(a)+H(b)) + (H(c)+H(d)). This implies that\n+ * all of this is perfectly parallellizable: each thread can process an\n+ * arbitrary subset of the update operations, allowing them to be\n+ * efficiently combined later.\n+ *\n+ * Muhash does not support checking if an element is already part of the\n+ * set. That is why this class does not enforce the use of a set as the\n+ * data it represents because there is no efficient way to do so..\n+ * It is possible to add elements more than once and also to remove\n+ * elements that have not been added before. However, this implementation\n+ * is intended to represent a set of elements.\n+ *\n+ * See also https://cseweb.ucsd.edu/~mihir/papers/inchash.pdf and\n+ * https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014337.html.\n+ */\n+class MuHash3072\n+{\n+protected:\n+    Num3072 data;\n+\n+    static constexpr size_t INPUT_SIZE = 32;\n+    static constexpr size_t OUTPUT_SIZE = 384;\n+\n+public:\n+    /* The empty set. */\n+    MuHash3072() noexcept;\n+\n+    /* A singleton with a single 32-byte key in it. */\n+    explicit MuHash3072(Span<const unsigned char> key32) noexcept;\n+\n+    /* Multiply (resulting in a hash for the union of the sets) */\n+    MuHash3072& operator*=(const MuHash3072& add) noexcept;\n+\n+    /* Divide (resulting in a hash for the difference of the sets) */\n+    MuHash3072& operator/=(const MuHash3072& sub) noexcept;\n+\n+    /* Finalize into a 384-byte hash. Does not change this object's value. */\n+    void Finalize(Span<unsigned char> hash384) noexcept;\n+\n+    SERIALIZE_METHODS(MuHash3072, obj)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507173075",
      "id" : 507173075,
      "line" : 123,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzE3MzA3NQ==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 123,
      "original_position" : 89,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : 123,
      "pull_request_review_id" : 511150383,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507173075",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507173583"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507173583"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Has the performance benefit of using `__int128` been measured? My instinct would be to remove the platform-dependent code, including all the typedefs and static_asserts.\tThere are benefits to having just a single implementation (simpler, smaller code), and the performance of the mushash implementation isn't critical, since it'll only be used in indexing and the rpc interface.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-18T15:00:01Z",
      "diff_hunk" : "@@ -0,0 +1,97 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+\n+#include <stdint.h>\n+\n+struct Num3072 {\n+#ifdef HAVE___INT128",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507173583",
      "id" : 507173583,
      "line" : 26,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzE3MzU4Mw==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 26,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : 26,
      "pull_request_review_id" : 511150383,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507173583",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507178737"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507178737"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Consider using a range based loop:\r\n\r\n```suggestion\r\n        for (auto& limb : obj.data.limbs) {\r\n            READWRITE(limb);\r\n        }\r\n```",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-18T15:47:19Z",
      "diff_hunk" : "@@ -0,0 +1,97 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+\n+#include <stdint.h>\n+\n+struct Num3072 {\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_t;\n+    typedef uint64_t limb_t;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_t;\n+    typedef uint32_t limb_t;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_t limbs[LIMBS];\n+};\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+/** A class representing MuHash sets\n+ *\n+ * MuHash is a hashing algorithm that supports adding set elements in any\n+ * order but also deleting in any order. As a result, it can maintain a\n+ * running sum for a set of data as a whole, and add/subtract when data\n+ * is added to or removed from it. A downside of MuHash is that computing\n+ * an inverse is relatively expensive. This can be solved by representing\n+ * the running value as a fraction, and multiplying added elements into\n+ * the numerator and removed elements into the denominator. Only when the\n+ * final hash is desired, a single modular inverse and multiplication is\n+ * needed to combine the two.\n+ *\n+ * TODO: Represent running value as a fraction to allow for more intuitive\n+ * use (see above).\n+ *\n+ * As the update operations are also associative, H(a)+H(b)+H(c)+H(d) can\n+ * in fact be computed as (H(a)+H(b)) + (H(c)+H(d)). This implies that\n+ * all of this is perfectly parallellizable: each thread can process an\n+ * arbitrary subset of the update operations, allowing them to be\n+ * efficiently combined later.\n+ *\n+ * Muhash does not support checking if an element is already part of the\n+ * set. That is why this class does not enforce the use of a set as the\n+ * data it represents because there is no efficient way to do so..\n+ * It is possible to add elements more than once and also to remove\n+ * elements that have not been added before. However, this implementation\n+ * is intended to represent a set of elements.\n+ *\n+ * See also https://cseweb.ucsd.edu/~mihir/papers/inchash.pdf and\n+ * https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014337.html.\n+ */\n+class MuHash3072\n+{\n+protected:\n+    Num3072 data;\n+\n+    static constexpr size_t INPUT_SIZE = 32;\n+    static constexpr size_t OUTPUT_SIZE = 384;\n+\n+public:\n+    /* The empty set. */\n+    MuHash3072() noexcept;\n+\n+    /* A singleton with a single 32-byte key in it. */\n+    explicit MuHash3072(Span<const unsigned char> key32) noexcept;\n+\n+    /* Multiply (resulting in a hash for the union of the sets) */\n+    MuHash3072& operator*=(const MuHash3072& add) noexcept;\n+\n+    /* Divide (resulting in a hash for the difference of the sets) */\n+    MuHash3072& operator/=(const MuHash3072& sub) noexcept;\n+\n+    /* Finalize into a 384-byte hash. Does not change this object's value. */\n+    void Finalize(Span<unsigned char> hash384) noexcept;\n+\n+    SERIALIZE_METHODS(MuHash3072, obj)\n+    {\n+        for (int i = 0; i < obj.data.LIMBS; ++i) {\n+            READWRITE(obj.data.limbs[i]);\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507178737",
      "id" : 507178737,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzE3ODczNw==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 115,
      "original_position" : 93,
      "original_start_line" : 91,
      "path" : "src/crypto/muhash.h",
      "position" : null,
      "pull_request_review_id" : 511150383,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507178737",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507179354"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507179354"
         }
      },
      "author_association" : "MEMBER",
      "body" : "All of these functions (`IsOverflow()`, `FullReduce()`, `Multiply()`, `Square()`, `Inverse()`) take pointers, but they're always called with non-null ptrs and there's no null checking in the function body. Consider changing the signatures to take references to better express that they must be called with an actual object.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-18T15:52:48Z",
      "diff_hunk" : "@@ -0,0 +1,304 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+    {\n+        double_limb_t t = (double_limb_t)a * b;\n+        th = t >> LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+    {\n+        double_limb_t t = (double_limb_t)a * b;\n+        th = t >> LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, limb_t& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072* d)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507179354",
      "id" : 507179354,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzE3OTM1NA==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 119,
      "original_position" : 119,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 511150383,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507179354",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507179765"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507179765"
         }
      },
      "author_association" : "MEMBER",
      "body" : "s/to do so../to do so./ (remove double .)",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-18T15:56:13Z",
      "diff_hunk" : "@@ -0,0 +1,97 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+\n+#include <stdint.h>\n+\n+struct Num3072 {\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_t;\n+    typedef uint64_t limb_t;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_t;\n+    typedef uint32_t limb_t;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_t limbs[LIMBS];\n+};\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+/** A class representing MuHash sets\n+ *\n+ * MuHash is a hashing algorithm that supports adding set elements in any\n+ * order but also deleting in any order. As a result, it can maintain a\n+ * running sum for a set of data as a whole, and add/subtract when data\n+ * is added to or removed from it. A downside of MuHash is that computing\n+ * an inverse is relatively expensive. This can be solved by representing\n+ * the running value as a fraction, and multiplying added elements into\n+ * the numerator and removed elements into the denominator. Only when the\n+ * final hash is desired, a single modular inverse and multiplication is\n+ * needed to combine the two.\n+ *\n+ * TODO: Represent running value as a fraction to allow for more intuitive\n+ * use (see above).\n+ *\n+ * As the update operations are also associative, H(a)+H(b)+H(c)+H(d) can\n+ * in fact be computed as (H(a)+H(b)) + (H(c)+H(d)). This implies that\n+ * all of this is perfectly parallellizable: each thread can process an\n+ * arbitrary subset of the update operations, allowing them to be\n+ * efficiently combined later.\n+ *\n+ * Muhash does not support checking if an element is already part of the\n+ * set. That is why this class does not enforce the use of a set as the\n+ * data it represents because there is no efficient way to do so..",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507179765",
      "id" : 507179765,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzE3OTc2NQ==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 57,
      "original_position" : 57,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : null,
      "pull_request_review_id" : 511150383,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507179765",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507183199"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507183199"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why not implicit `this`?\r\n\r\n```suggestion\r\n    Multiply(&data, &x.data);\r\n```\r\n\r\nThis would be even clearer if Multiply took references and `data` was renamed `m_data`:\r\n\r\n`Multiply(m_data, x.m_data);`\r\n\r\nSame below in the `/=()` operator",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-18T16:27:55Z",
      "diff_hunk" : "@@ -0,0 +1,304 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+    {\n+        double_limb_t t = (double_limb_t)a * b;\n+        th = t >> LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+    {\n+        double_limb_t t = (double_limb_t)a * b;\n+        th = t >> LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, limb_t& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072* d)\n+{\n+    if (d->limbs[0] <= std::numeric_limits<limb_t>::max() - MAX_PRIME_DIFF) return false;\n+    for (int i = 1; i < LIMBS; ++i) {\n+        if (d->limbs[i] != std::numeric_limits<limb_t>::max()) return false;\n+    }\n+    return true;\n+}\n+\n+void FullReduce(Num3072* d)\n+{\n+    limb_t c0 = MAX_PRIME_DIFF;\n+    for (int i = 0; i < LIMBS; ++i) {\n+        limb_t c1 = 0;\n+        add2(c0, c1, d->limbs[i]);\n+        extract2(c0, c1, d->limbs[i]);\n+    }\n+}\n+\n+void Multiply(Num3072* in_out, const Num3072* a)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*a into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        mul(d0, d1, in_out->limbs[1 + j], a->limbs[LIMBS + j - (1 + j)]);\n+        for (int i = 2 + j; i < LIMBS; ++i) muladd3(d0, d1, d2, in_out->limbs[i], a->limbs[LIMBS + j - i]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < j + 1; ++i) muladd3(c0, c1, c2, in_out->limbs[i], a->limbs[j - i]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    /* Compute limb N-1 of a*b into tmp. */\n+    {\n+        limb_t c2 = 0;\n+        for (int i = 0; i < LIMBS; ++i) muladd3(c0, c1, c2, in_out->limbs[i], a->limbs[LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out->limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Square(Num3072* in_out)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*in_out into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        for (int i = 0; i < (LIMBS - 1 - j) / 2; ++i) muldbladd3(d0, d1, d2, in_out->limbs[i + j + 1], in_out->limbs[LIMBS - 1 - i]);\n+        if ((j + 1) & 1) muladd3(d0, d1, d2, in_out->limbs[(LIMBS - 1 - j) / 2 + j + 1], in_out->limbs[LIMBS - 1 - (LIMBS - 1 - j) / 2]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < (j + 1) / 2; ++i) muldbladd3(c0, c1, c2, in_out->limbs[i], in_out->limbs[j - i]);\n+        if ((j + 1) & 1) muladd3(c0, c1, c2, in_out->limbs[(j + 1) / 2], in_out->limbs[j - (j + 1) / 2]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    {\n+        limb_t c2 = 0;\n+        for (int i = 0; i < LIMBS / 2; ++i) muldbladd3(c0, c1, c2, in_out->limbs[i], in_out->limbs[LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out->limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Inverse(Num3072* out, const Num3072* a)\n+{\n+    // For fast exponentiation a sliding window exponentiation with repunit\n+    // precomputation is utilized. See \"Fast Point Decompression for Standard\n+    // Elliptic Curves\" (Brumley, JÃ¤rvinen, 2008).\n+\n+    Num3072 p[12]; // p[i] = a^(2^(2^i)-1)\n+    Num3072 x;\n+\n+    p[0] = *a;\n+\n+    for (int i = 0; i < 11; ++i) {\n+        p[i + 1] = p[i];\n+        for (int j = 0; j < (1 << i); ++j) Square(&p[i + 1]);\n+        Multiply(&p[i + 1], &p[i]);\n+    }\n+\n+    x = p[11];\n+\n+    for (int j = 0; j < 512; ++j) Square(&x);\n+    Multiply(&x, &p[9]);\n+    for (int j = 0; j < 256; ++j) Square(&x);\n+    Multiply(&x, &p[8]);\n+    for (int j = 0; j < 128; ++j) Square(&x);\n+    Multiply(&x, &p[7]);\n+    for (int j = 0; j < 64; ++j) Square(&x);\n+    Multiply(&x, &p[6]);\n+    for (int j = 0; j < 32; ++j) Square(&x);\n+    Multiply(&x, &p[5]);\n+    for (int j = 0; j < 8; ++j) Square(&x);\n+    Multiply(&x, &p[3]);\n+    for (int j = 0; j < 2; ++j) Square(&x);\n+    Multiply(&x, &p[1]);\n+    for (int j = 0; j < 1; ++j) Square(&x);\n+    Multiply(&x, &p[0]);\n+    for (int j = 0; j < 5; ++j) Square(&x);\n+    Multiply(&x, &p[2]);\n+    for (int j = 0; j < 3; ++j) Square(&x);\n+    Multiply(&x, &p[0]);\n+    for (int j = 0; j < 2; ++j) Square(&x);\n+    Multiply(&x, &p[0]);\n+    for (int j = 0; j < 4; ++j) Square(&x);\n+    Multiply(&x, &p[0]);\n+    for (int j = 0; j < 4; ++j) Square(&x);\n+    Multiply(&x, &p[1]);\n+    for (int j = 0; j < 3; ++j) Square(&x);\n+    Multiply(&x, &p[0]);\n+\n+    *out = x;\n+}\n+\n+} // namespace\n+\n+MuHash3072::MuHash3072() noexcept\n+{\n+    data.limbs[0] = 1;\n+    for (int i = 1; i < LIMBS; ++i) data.limbs[i] = 0;\n+}\n+\n+MuHash3072::MuHash3072(Span<const unsigned char> key32) noexcept\n+{\n+    assert(key32.size() == INPUT_SIZE);\n+    unsigned char tmp[OUTPUT_SIZE];\n+    ChaCha20(key32.data(), key32.size()).Keystream(tmp, OUTPUT_SIZE);\n+    for (int i = 0; i < LIMBS; ++i) {\n+        if (sizeof(limb_t) == 4) {\n+            data.limbs[i] = ReadLE32(tmp + 4 * i);\n+        } else if (sizeof(limb_t) == 8) {\n+            data.limbs[i] = ReadLE64(tmp + 8 * i);\n+        }\n+    }\n+}\n+\n+void MuHash3072::Finalize(Span<unsigned char> hash384) noexcept\n+{\n+    assert(hash384.size() == OUTPUT_SIZE);\n+    if (IsOverflow(&data)) FullReduce(&data);\n+    for (int i = 0; i < LIMBS; ++i) {\n+        if (sizeof(limb_t) == 4) {\n+            WriteLE32(hash384.data() + i * 4, data.limbs[i]);\n+        } else if (sizeof(limb_t) == 8) {\n+            WriteLE64(hash384.data() + i * 8, data.limbs[i]);\n+        }\n+    }\n+}\n+\n+MuHash3072& MuHash3072::operator*=(const MuHash3072& x) noexcept\n+{\n+    Multiply(&this->data, &x.data);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507183199",
      "id" : 507183199,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzE4MzE5OQ==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 294,
      "original_position" : 294,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 511150383,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507183199",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507184333"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507184333"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It seems odd that the argument to the multiplication operator is called `add` and the argument to the division operator is called `sub`. Stick to either multiplicative or additive terminology!",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-18T16:38:58Z",
      "diff_hunk" : "@@ -0,0 +1,97 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+\n+#include <stdint.h>\n+\n+struct Num3072 {\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_t;\n+    typedef uint64_t limb_t;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_t;\n+    typedef uint32_t limb_t;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_t limbs[LIMBS];\n+};\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+/** A class representing MuHash sets\n+ *\n+ * MuHash is a hashing algorithm that supports adding set elements in any\n+ * order but also deleting in any order. As a result, it can maintain a\n+ * running sum for a set of data as a whole, and add/subtract when data\n+ * is added to or removed from it. A downside of MuHash is that computing\n+ * an inverse is relatively expensive. This can be solved by representing\n+ * the running value as a fraction, and multiplying added elements into\n+ * the numerator and removed elements into the denominator. Only when the\n+ * final hash is desired, a single modular inverse and multiplication is\n+ * needed to combine the two.\n+ *\n+ * TODO: Represent running value as a fraction to allow for more intuitive\n+ * use (see above).\n+ *\n+ * As the update operations are also associative, H(a)+H(b)+H(c)+H(d) can\n+ * in fact be computed as (H(a)+H(b)) + (H(c)+H(d)). This implies that\n+ * all of this is perfectly parallellizable: each thread can process an\n+ * arbitrary subset of the update operations, allowing them to be\n+ * efficiently combined later.\n+ *\n+ * Muhash does not support checking if an element is already part of the\n+ * set. That is why this class does not enforce the use of a set as the\n+ * data it represents because there is no efficient way to do so..\n+ * It is possible to add elements more than once and also to remove\n+ * elements that have not been added before. However, this implementation\n+ * is intended to represent a set of elements.\n+ *\n+ * See also https://cseweb.ucsd.edu/~mihir/papers/inchash.pdf and\n+ * https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014337.html.\n+ */\n+class MuHash3072\n+{\n+protected:\n+    Num3072 data;\n+\n+    static constexpr size_t INPUT_SIZE = 32;\n+    static constexpr size_t OUTPUT_SIZE = 384;\n+\n+public:\n+    /* The empty set. */\n+    MuHash3072() noexcept;\n+\n+    /* A singleton with a single 32-byte key in it. */\n+    explicit MuHash3072(Span<const unsigned char> key32) noexcept;\n+\n+    /* Multiply (resulting in a hash for the union of the sets) */\n+    MuHash3072& operator*=(const MuHash3072& add) noexcept;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507184333",
      "id" : 507184333,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzE4NDMzMw==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 75,
      "original_position" : 81,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : null,
      "pull_request_review_id" : 511150383,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507184333",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507186328"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507186328"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is really helpful, and makes it easier to understand what the algorithm is doing.\r\n\r\nI wonder if converting the c++ code to use a `DOUBLE_N_ADD()` macro and adding a comment on how to audit the numbers would make it easier to follow the code.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-18T16:56:53Z",
      "diff_hunk" : "@@ -0,0 +1,304 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+    {\n+        double_limb_t t = (double_limb_t)a * b;\n+        th = t >> LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+    {\n+        double_limb_t t = (double_limb_t)a * b;\n+        th = t >> LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, limb_t& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072* d)\n+{\n+    if (d->limbs[0] <= std::numeric_limits<limb_t>::max() - MAX_PRIME_DIFF) return false;\n+    for (int i = 1; i < LIMBS; ++i) {\n+        if (d->limbs[i] != std::numeric_limits<limb_t>::max()) return false;\n+    }\n+    return true;\n+}\n+\n+void FullReduce(Num3072* d)\n+{\n+    limb_t c0 = MAX_PRIME_DIFF;\n+    for (int i = 0; i < LIMBS; ++i) {\n+        limb_t c1 = 0;\n+        add2(c0, c1, d->limbs[i]);\n+        extract2(c0, c1, d->limbs[i]);\n+    }\n+}\n+\n+void Multiply(Num3072* in_out, const Num3072* a)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*a into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        mul(d0, d1, in_out->limbs[1 + j], a->limbs[LIMBS + j - (1 + j)]);\n+        for (int i = 2 + j; i < LIMBS; ++i) muladd3(d0, d1, d2, in_out->limbs[i], a->limbs[LIMBS + j - i]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < j + 1; ++i) muladd3(c0, c1, c2, in_out->limbs[i], a->limbs[j - i]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    /* Compute limb N-1 of a*b into tmp. */\n+    {\n+        limb_t c2 = 0;\n+        for (int i = 0; i < LIMBS; ++i) muladd3(c0, c1, c2, in_out->limbs[i], a->limbs[LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out->limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Square(Num3072* in_out)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*in_out into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        for (int i = 0; i < (LIMBS - 1 - j) / 2; ++i) muldbladd3(d0, d1, d2, in_out->limbs[i + j + 1], in_out->limbs[LIMBS - 1 - i]);\n+        if ((j + 1) & 1) muladd3(d0, d1, d2, in_out->limbs[(LIMBS - 1 - j) / 2 + j + 1], in_out->limbs[LIMBS - 1 - (LIMBS - 1 - j) / 2]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < (j + 1) / 2; ++i) muldbladd3(c0, c1, c2, in_out->limbs[i], in_out->limbs[j - i]);\n+        if ((j + 1) & 1) muladd3(c0, c1, c2, in_out->limbs[(j + 1) / 2], in_out->limbs[j - (j + 1) / 2]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    {\n+        limb_t c2 = 0;\n+        for (int i = 0; i < LIMBS / 2; ++i) muldbladd3(c0, c1, c2, in_out->limbs[i], in_out->limbs[LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out->limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Inverse(Num3072* out, const Num3072* a)\n+{\n+    // For fast exponentiation a sliding window exponentiation with repunit\n+    // precomputation is utilized. See \"Fast Point Decompression for Standard\n+    // Elliptic Curves\" (Brumley, JÃ¤rvinen, 2008).",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507186328",
      "id" : 507186328,
      "in_reply_to_id" : 492832419,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzE4NjMyOA==",
      "original_commit_id" : "ef53ca76cc616cd359969533a75c3dab388ec38d",
      "original_line" : 210,
      "original_position" : 210,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 511150383,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507186328",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507186374"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507186374"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is there anywhere to get hold of this paper, or a write-up of this technique?",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-18T16:57:30Z",
      "diff_hunk" : "@@ -0,0 +1,304 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+    {\n+        double_limb_t t = (double_limb_t)a * b;\n+        th = t >> LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+    {\n+        double_limb_t t = (double_limb_t)a * b;\n+        th = t >> LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, limb_t& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072* d)\n+{\n+    if (d->limbs[0] <= std::numeric_limits<limb_t>::max() - MAX_PRIME_DIFF) return false;\n+    for (int i = 1; i < LIMBS; ++i) {\n+        if (d->limbs[i] != std::numeric_limits<limb_t>::max()) return false;\n+    }\n+    return true;\n+}\n+\n+void FullReduce(Num3072* d)\n+{\n+    limb_t c0 = MAX_PRIME_DIFF;\n+    for (int i = 0; i < LIMBS; ++i) {\n+        limb_t c1 = 0;\n+        add2(c0, c1, d->limbs[i]);\n+        extract2(c0, c1, d->limbs[i]);\n+    }\n+}\n+\n+void Multiply(Num3072* in_out, const Num3072* a)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*a into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        mul(d0, d1, in_out->limbs[1 + j], a->limbs[LIMBS + j - (1 + j)]);\n+        for (int i = 2 + j; i < LIMBS; ++i) muladd3(d0, d1, d2, in_out->limbs[i], a->limbs[LIMBS + j - i]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < j + 1; ++i) muladd3(c0, c1, c2, in_out->limbs[i], a->limbs[j - i]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    /* Compute limb N-1 of a*b into tmp. */\n+    {\n+        limb_t c2 = 0;\n+        for (int i = 0; i < LIMBS; ++i) muladd3(c0, c1, c2, in_out->limbs[i], a->limbs[LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out->limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Square(Num3072* in_out)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*in_out into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        for (int i = 0; i < (LIMBS - 1 - j) / 2; ++i) muldbladd3(d0, d1, d2, in_out->limbs[i + j + 1], in_out->limbs[LIMBS - 1 - i]);\n+        if ((j + 1) & 1) muladd3(d0, d1, d2, in_out->limbs[(LIMBS - 1 - j) / 2 + j + 1], in_out->limbs[LIMBS - 1 - (LIMBS - 1 - j) / 2]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < (j + 1) / 2; ++i) muldbladd3(c0, c1, c2, in_out->limbs[i], in_out->limbs[j - i]);\n+        if ((j + 1) & 1) muladd3(c0, c1, c2, in_out->limbs[(j + 1) / 2], in_out->limbs[j - (j + 1) / 2]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    {\n+        limb_t c2 = 0;\n+        for (int i = 0; i < LIMBS / 2; ++i) muldbladd3(c0, c1, c2, in_out->limbs[i], in_out->limbs[LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out->limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Inverse(Num3072* out, const Num3072* a)\n+{\n+    // For fast exponentiation a sliding window exponentiation with repunit\n+    // precomputation is utilized. See \"Fast Point Decompression for Standard\n+    // Elliptic Curves\" (Brumley, JÃ¤rvinen, 2008).",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507186374",
      "id" : 507186374,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzE4NjM3NA==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 210,
      "original_position" : 210,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 511150383,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507186374",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507194862"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507194862"
         }
      },
      "author_association" : "MEMBER",
      "body" : "What are these indentations for? I think it'll compile to the same thing without them, and this just makes the code harder to read. There are similar blocks in `muldbladd3()` and `Multiply()`.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-18T18:14:23Z",
      "diff_hunk" : "@@ -0,0 +1,304 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+    {\n+        double_limb_t t = (double_limb_t)a * b;\n+        th = t >> LIMB_SIZE;\n+        tl = t;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507194862",
      "id" : 507194862,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzE5NDg2Mg==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 86,
      "original_position" : 86,
      "original_start_line" : 82,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 511150383,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507194862",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507231955"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507231955"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I have to think a little more about to how solve that best...",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-18T22:41:09Z",
      "diff_hunk" : "@@ -0,0 +1,97 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+\n+#include <stdint.h>\n+\n+struct Num3072 {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507231955",
      "id" : 507231955,
      "in_reply_to_id" : 507170069,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzIzMTk1NQ==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 16,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : null,
      "pull_request_review_id" : 511265789,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507231955",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507231982"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507231982"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-18T22:41:15Z",
      "diff_hunk" : "@@ -0,0 +1,97 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+\n+#include <stdint.h>\n+\n+struct Num3072 {\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_t;\n+    typedef uint64_t limb_t;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_t;\n+    typedef uint32_t limb_t;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_t limbs[LIMBS];\n+};\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507231982",
      "id" : 507231982,
      "in_reply_to_id" : 507170142,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzIzMTk4Mg==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 32,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : null,
      "pull_request_review_id" : 511265797,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507231982",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507232033"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507232033"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nope, done",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-18T22:41:21Z",
      "diff_hunk" : "@@ -0,0 +1,97 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+\n+#include <stdint.h>\n+\n+struct Num3072 {\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_t;\n+    typedef uint64_t limb_t;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_t;\n+    typedef uint32_t limb_t;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_t limbs[LIMBS];\n+};\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+/** A class representing MuHash sets\n+ *\n+ * MuHash is a hashing algorithm that supports adding set elements in any\n+ * order but also deleting in any order. As a result, it can maintain a\n+ * running sum for a set of data as a whole, and add/subtract when data\n+ * is added to or removed from it. A downside of MuHash is that computing\n+ * an inverse is relatively expensive. This can be solved by representing\n+ * the running value as a fraction, and multiplying added elements into\n+ * the numerator and removed elements into the denominator. Only when the\n+ * final hash is desired, a single modular inverse and multiplication is\n+ * needed to combine the two.\n+ *\n+ * TODO: Represent running value as a fraction to allow for more intuitive\n+ * use (see above).\n+ *\n+ * As the update operations are also associative, H(a)+H(b)+H(c)+H(d) can\n+ * in fact be computed as (H(a)+H(b)) + (H(c)+H(d)). This implies that\n+ * all of this is perfectly parallellizable: each thread can process an\n+ * arbitrary subset of the update operations, allowing them to be\n+ * efficiently combined later.\n+ *\n+ * Muhash does not support checking if an element is already part of the\n+ * set. That is why this class does not enforce the use of a set as the\n+ * data it represents because there is no efficient way to do so..\n+ * It is possible to add elements more than once and also to remove\n+ * elements that have not been added before. However, this implementation\n+ * is intended to represent a set of elements.\n+ *\n+ * See also https://cseweb.ucsd.edu/~mihir/papers/inchash.pdf and\n+ * https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014337.html.\n+ */\n+class MuHash3072\n+{\n+protected:\n+    Num3072 data;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507232033",
      "id" : 507232033,
      "in_reply_to_id" : 507170212,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzIzMjAzMw==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 68,
      "original_position" : 68,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : null,
      "pull_request_review_id" : 511265811,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507232033",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507232065"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507232065"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-18T22:41:25Z",
      "diff_hunk" : "@@ -0,0 +1,97 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+\n+#include <stdint.h>\n+\n+struct Num3072 {\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_t;\n+    typedef uint64_t limb_t;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_t;\n+    typedef uint32_t limb_t;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_t limbs[LIMBS];\n+};\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+/** A class representing MuHash sets\n+ *\n+ * MuHash is a hashing algorithm that supports adding set elements in any\n+ * order but also deleting in any order. As a result, it can maintain a\n+ * running sum for a set of data as a whole, and add/subtract when data\n+ * is added to or removed from it. A downside of MuHash is that computing\n+ * an inverse is relatively expensive. This can be solved by representing\n+ * the running value as a fraction, and multiplying added elements into\n+ * the numerator and removed elements into the denominator. Only when the\n+ * final hash is desired, a single modular inverse and multiplication is\n+ * needed to combine the two.\n+ *\n+ * TODO: Represent running value as a fraction to allow for more intuitive\n+ * use (see above).\n+ *\n+ * As the update operations are also associative, H(a)+H(b)+H(c)+H(d) can\n+ * in fact be computed as (H(a)+H(b)) + (H(c)+H(d)). This implies that\n+ * all of this is perfectly parallellizable: each thread can process an\n+ * arbitrary subset of the update operations, allowing them to be\n+ * efficiently combined later.\n+ *\n+ * Muhash does not support checking if an element is already part of the\n+ * set. That is why this class does not enforce the use of a set as the\n+ * data it represents because there is no efficient way to do so..\n+ * It is possible to add elements more than once and also to remove\n+ * elements that have not been added before. However, this implementation\n+ * is intended to represent a set of elements.\n+ *\n+ * See also https://cseweb.ucsd.edu/~mihir/papers/inchash.pdf and\n+ * https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014337.html.\n+ */\n+class MuHash3072\n+{\n+protected:\n+    Num3072 data;\n+\n+    static constexpr size_t INPUT_SIZE = 32;\n+    static constexpr size_t OUTPUT_SIZE = 384;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507232065",
      "id" : 507232065,
      "in_reply_to_id" : 507170280,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzIzMjA2NQ==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 71,
      "original_position" : 71,
      "original_start_line" : 70,
      "path" : "src/crypto/muhash.h",
      "position" : null,
      "pull_request_review_id" : 511265821,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507232065",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507232365"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507232365"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I believe so, I definitely forced either option on my system at some point.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-18T22:42:05Z",
      "diff_hunk" : "@@ -0,0 +1,97 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+\n+#include <stdint.h>\n+\n+struct Num3072 {\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_t;\n+    typedef uint64_t limb_t;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_t;\n+    typedef uint32_t limb_t;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_t limbs[LIMBS];\n+};\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+/** A class representing MuHash sets\n+ *\n+ * MuHash is a hashing algorithm that supports adding set elements in any\n+ * order but also deleting in any order. As a result, it can maintain a\n+ * running sum for a set of data as a whole, and add/subtract when data\n+ * is added to or removed from it. A downside of MuHash is that computing\n+ * an inverse is relatively expensive. This can be solved by representing\n+ * the running value as a fraction, and multiplying added elements into\n+ * the numerator and removed elements into the denominator. Only when the\n+ * final hash is desired, a single modular inverse and multiplication is\n+ * needed to combine the two.\n+ *\n+ * TODO: Represent running value as a fraction to allow for more intuitive\n+ * use (see above).\n+ *\n+ * As the update operations are also associative, H(a)+H(b)+H(c)+H(d) can\n+ * in fact be computed as (H(a)+H(b)) + (H(c)+H(d)). This implies that\n+ * all of this is perfectly parallellizable: each thread can process an\n+ * arbitrary subset of the update operations, allowing them to be\n+ * efficiently combined later.\n+ *\n+ * Muhash does not support checking if an element is already part of the\n+ * set. That is why this class does not enforce the use of a set as the\n+ * data it represents because there is no efficient way to do so..\n+ * It is possible to add elements more than once and also to remove\n+ * elements that have not been added before. However, this implementation\n+ * is intended to represent a set of elements.\n+ *\n+ * See also https://cseweb.ucsd.edu/~mihir/papers/inchash.pdf and\n+ * https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014337.html.\n+ */\n+class MuHash3072\n+{\n+protected:\n+    Num3072 data;\n+\n+    static constexpr size_t INPUT_SIZE = 32;\n+    static constexpr size_t OUTPUT_SIZE = 384;\n+\n+public:\n+    /* The empty set. */\n+    MuHash3072() noexcept;\n+\n+    /* A singleton with a single 32-byte key in it. */\n+    explicit MuHash3072(Span<const unsigned char> key32) noexcept;\n+\n+    /* Multiply (resulting in a hash for the union of the sets) */\n+    MuHash3072& operator*=(const MuHash3072& add) noexcept;\n+\n+    /* Divide (resulting in a hash for the difference of the sets) */\n+    MuHash3072& operator/=(const MuHash3072& sub) noexcept;\n+\n+    /* Finalize into a 384-byte hash. Does not change this object's value. */\n+    void Finalize(Span<unsigned char> hash384) noexcept;\n+\n+    SERIALIZE_METHODS(MuHash3072, obj)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507232365",
      "id" : 507232365,
      "in_reply_to_id" : 507173075,
      "line" : 123,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzIzMjM2NQ==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 123,
      "original_position" : 89,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : 123,
      "pull_request_review_id" : 511265878,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507232365",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507232390"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507232390"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't remember benchmarking this, will do so",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-18T22:42:10Z",
      "diff_hunk" : "@@ -0,0 +1,97 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+\n+#include <stdint.h>\n+\n+struct Num3072 {\n+#ifdef HAVE___INT128",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507232390",
      "id" : 507232390,
      "in_reply_to_id" : 507173583,
      "line" : 26,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzIzMjM5MA==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 26,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : 26,
      "pull_request_review_id" : 511265885,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507232390",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507232419"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507232419"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-18T22:42:14Z",
      "diff_hunk" : "@@ -0,0 +1,97 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+\n+#include <stdint.h>\n+\n+struct Num3072 {\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_t;\n+    typedef uint64_t limb_t;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_t;\n+    typedef uint32_t limb_t;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_t limbs[LIMBS];\n+};\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+/** A class representing MuHash sets\n+ *\n+ * MuHash is a hashing algorithm that supports adding set elements in any\n+ * order but also deleting in any order. As a result, it can maintain a\n+ * running sum for a set of data as a whole, and add/subtract when data\n+ * is added to or removed from it. A downside of MuHash is that computing\n+ * an inverse is relatively expensive. This can be solved by representing\n+ * the running value as a fraction, and multiplying added elements into\n+ * the numerator and removed elements into the denominator. Only when the\n+ * final hash is desired, a single modular inverse and multiplication is\n+ * needed to combine the two.\n+ *\n+ * TODO: Represent running value as a fraction to allow for more intuitive\n+ * use (see above).\n+ *\n+ * As the update operations are also associative, H(a)+H(b)+H(c)+H(d) can\n+ * in fact be computed as (H(a)+H(b)) + (H(c)+H(d)). This implies that\n+ * all of this is perfectly parallellizable: each thread can process an\n+ * arbitrary subset of the update operations, allowing them to be\n+ * efficiently combined later.\n+ *\n+ * Muhash does not support checking if an element is already part of the\n+ * set. That is why this class does not enforce the use of a set as the\n+ * data it represents because there is no efficient way to do so..\n+ * It is possible to add elements more than once and also to remove\n+ * elements that have not been added before. However, this implementation\n+ * is intended to represent a set of elements.\n+ *\n+ * See also https://cseweb.ucsd.edu/~mihir/papers/inchash.pdf and\n+ * https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014337.html.\n+ */\n+class MuHash3072\n+{\n+protected:\n+    Num3072 data;\n+\n+    static constexpr size_t INPUT_SIZE = 32;\n+    static constexpr size_t OUTPUT_SIZE = 384;\n+\n+public:\n+    /* The empty set. */\n+    MuHash3072() noexcept;\n+\n+    /* A singleton with a single 32-byte key in it. */\n+    explicit MuHash3072(Span<const unsigned char> key32) noexcept;\n+\n+    /* Multiply (resulting in a hash for the union of the sets) */\n+    MuHash3072& operator*=(const MuHash3072& add) noexcept;\n+\n+    /* Divide (resulting in a hash for the difference of the sets) */\n+    MuHash3072& operator/=(const MuHash3072& sub) noexcept;\n+\n+    /* Finalize into a 384-byte hash. Does not change this object's value. */\n+    void Finalize(Span<unsigned char> hash384) noexcept;\n+\n+    SERIALIZE_METHODS(MuHash3072, obj)\n+    {\n+        for (int i = 0; i < obj.data.LIMBS; ++i) {\n+            READWRITE(obj.data.limbs[i]);\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507232419",
      "id" : 507232419,
      "in_reply_to_id" : 507178737,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzIzMjQxOQ==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 115,
      "original_position" : 93,
      "original_start_line" : 91,
      "path" : "src/crypto/muhash.h",
      "position" : null,
      "pull_request_review_id" : 511265893,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507232419",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507232453"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507232453"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-18T22:42:20Z",
      "diff_hunk" : "@@ -0,0 +1,304 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+    {\n+        double_limb_t t = (double_limb_t)a * b;\n+        th = t >> LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+    {\n+        double_limb_t t = (double_limb_t)a * b;\n+        th = t >> LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, limb_t& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072* d)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507232453",
      "id" : 507232453,
      "in_reply_to_id" : 507179354,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzIzMjQ1Mw==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 119,
      "original_position" : 119,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 511265898,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507232453",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507232479"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507232479"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-18T22:42:24Z",
      "diff_hunk" : "@@ -0,0 +1,97 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+\n+#include <stdint.h>\n+\n+struct Num3072 {\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_t;\n+    typedef uint64_t limb_t;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_t;\n+    typedef uint32_t limb_t;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_t limbs[LIMBS];\n+};\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+/** A class representing MuHash sets\n+ *\n+ * MuHash is a hashing algorithm that supports adding set elements in any\n+ * order but also deleting in any order. As a result, it can maintain a\n+ * running sum for a set of data as a whole, and add/subtract when data\n+ * is added to or removed from it. A downside of MuHash is that computing\n+ * an inverse is relatively expensive. This can be solved by representing\n+ * the running value as a fraction, and multiplying added elements into\n+ * the numerator and removed elements into the denominator. Only when the\n+ * final hash is desired, a single modular inverse and multiplication is\n+ * needed to combine the two.\n+ *\n+ * TODO: Represent running value as a fraction to allow for more intuitive\n+ * use (see above).\n+ *\n+ * As the update operations are also associative, H(a)+H(b)+H(c)+H(d) can\n+ * in fact be computed as (H(a)+H(b)) + (H(c)+H(d)). This implies that\n+ * all of this is perfectly parallellizable: each thread can process an\n+ * arbitrary subset of the update operations, allowing them to be\n+ * efficiently combined later.\n+ *\n+ * Muhash does not support checking if an element is already part of the\n+ * set. That is why this class does not enforce the use of a set as the\n+ * data it represents because there is no efficient way to do so..",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507232479",
      "id" : 507232479,
      "in_reply_to_id" : 507179765,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzIzMjQ3OQ==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 57,
      "original_position" : 57,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : null,
      "pull_request_review_id" : 511265906,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507232479",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507232528"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507232528"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-18T22:42:32Z",
      "diff_hunk" : "@@ -0,0 +1,304 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+    {\n+        double_limb_t t = (double_limb_t)a * b;\n+        th = t >> LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+    {\n+        double_limb_t t = (double_limb_t)a * b;\n+        th = t >> LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, limb_t& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072* d)\n+{\n+    if (d->limbs[0] <= std::numeric_limits<limb_t>::max() - MAX_PRIME_DIFF) return false;\n+    for (int i = 1; i < LIMBS; ++i) {\n+        if (d->limbs[i] != std::numeric_limits<limb_t>::max()) return false;\n+    }\n+    return true;\n+}\n+\n+void FullReduce(Num3072* d)\n+{\n+    limb_t c0 = MAX_PRIME_DIFF;\n+    for (int i = 0; i < LIMBS; ++i) {\n+        limb_t c1 = 0;\n+        add2(c0, c1, d->limbs[i]);\n+        extract2(c0, c1, d->limbs[i]);\n+    }\n+}\n+\n+void Multiply(Num3072* in_out, const Num3072* a)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*a into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        mul(d0, d1, in_out->limbs[1 + j], a->limbs[LIMBS + j - (1 + j)]);\n+        for (int i = 2 + j; i < LIMBS; ++i) muladd3(d0, d1, d2, in_out->limbs[i], a->limbs[LIMBS + j - i]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < j + 1; ++i) muladd3(c0, c1, c2, in_out->limbs[i], a->limbs[j - i]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    /* Compute limb N-1 of a*b into tmp. */\n+    {\n+        limb_t c2 = 0;\n+        for (int i = 0; i < LIMBS; ++i) muladd3(c0, c1, c2, in_out->limbs[i], a->limbs[LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out->limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Square(Num3072* in_out)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*in_out into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        for (int i = 0; i < (LIMBS - 1 - j) / 2; ++i) muldbladd3(d0, d1, d2, in_out->limbs[i + j + 1], in_out->limbs[LIMBS - 1 - i]);\n+        if ((j + 1) & 1) muladd3(d0, d1, d2, in_out->limbs[(LIMBS - 1 - j) / 2 + j + 1], in_out->limbs[LIMBS - 1 - (LIMBS - 1 - j) / 2]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < (j + 1) / 2; ++i) muldbladd3(c0, c1, c2, in_out->limbs[i], in_out->limbs[j - i]);\n+        if ((j + 1) & 1) muladd3(c0, c1, c2, in_out->limbs[(j + 1) / 2], in_out->limbs[j - (j + 1) / 2]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    {\n+        limb_t c2 = 0;\n+        for (int i = 0; i < LIMBS / 2; ++i) muldbladd3(c0, c1, c2, in_out->limbs[i], in_out->limbs[LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out->limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Inverse(Num3072* out, const Num3072* a)\n+{\n+    // For fast exponentiation a sliding window exponentiation with repunit\n+    // precomputation is utilized. See \"Fast Point Decompression for Standard\n+    // Elliptic Curves\" (Brumley, JÃ¤rvinen, 2008).\n+\n+    Num3072 p[12]; // p[i] = a^(2^(2^i)-1)\n+    Num3072 x;\n+\n+    p[0] = *a;\n+\n+    for (int i = 0; i < 11; ++i) {\n+        p[i + 1] = p[i];\n+        for (int j = 0; j < (1 << i); ++j) Square(&p[i + 1]);\n+        Multiply(&p[i + 1], &p[i]);\n+    }\n+\n+    x = p[11];\n+\n+    for (int j = 0; j < 512; ++j) Square(&x);\n+    Multiply(&x, &p[9]);\n+    for (int j = 0; j < 256; ++j) Square(&x);\n+    Multiply(&x, &p[8]);\n+    for (int j = 0; j < 128; ++j) Square(&x);\n+    Multiply(&x, &p[7]);\n+    for (int j = 0; j < 64; ++j) Square(&x);\n+    Multiply(&x, &p[6]);\n+    for (int j = 0; j < 32; ++j) Square(&x);\n+    Multiply(&x, &p[5]);\n+    for (int j = 0; j < 8; ++j) Square(&x);\n+    Multiply(&x, &p[3]);\n+    for (int j = 0; j < 2; ++j) Square(&x);\n+    Multiply(&x, &p[1]);\n+    for (int j = 0; j < 1; ++j) Square(&x);\n+    Multiply(&x, &p[0]);\n+    for (int j = 0; j < 5; ++j) Square(&x);\n+    Multiply(&x, &p[2]);\n+    for (int j = 0; j < 3; ++j) Square(&x);\n+    Multiply(&x, &p[0]);\n+    for (int j = 0; j < 2; ++j) Square(&x);\n+    Multiply(&x, &p[0]);\n+    for (int j = 0; j < 4; ++j) Square(&x);\n+    Multiply(&x, &p[0]);\n+    for (int j = 0; j < 4; ++j) Square(&x);\n+    Multiply(&x, &p[1]);\n+    for (int j = 0; j < 3; ++j) Square(&x);\n+    Multiply(&x, &p[0]);\n+\n+    *out = x;\n+}\n+\n+} // namespace\n+\n+MuHash3072::MuHash3072() noexcept\n+{\n+    data.limbs[0] = 1;\n+    for (int i = 1; i < LIMBS; ++i) data.limbs[i] = 0;\n+}\n+\n+MuHash3072::MuHash3072(Span<const unsigned char> key32) noexcept\n+{\n+    assert(key32.size() == INPUT_SIZE);\n+    unsigned char tmp[OUTPUT_SIZE];\n+    ChaCha20(key32.data(), key32.size()).Keystream(tmp, OUTPUT_SIZE);\n+    for (int i = 0; i < LIMBS; ++i) {\n+        if (sizeof(limb_t) == 4) {\n+            data.limbs[i] = ReadLE32(tmp + 4 * i);\n+        } else if (sizeof(limb_t) == 8) {\n+            data.limbs[i] = ReadLE64(tmp + 8 * i);\n+        }\n+    }\n+}\n+\n+void MuHash3072::Finalize(Span<unsigned char> hash384) noexcept\n+{\n+    assert(hash384.size() == OUTPUT_SIZE);\n+    if (IsOverflow(&data)) FullReduce(&data);\n+    for (int i = 0; i < LIMBS; ++i) {\n+        if (sizeof(limb_t) == 4) {\n+            WriteLE32(hash384.data() + i * 4, data.limbs[i]);\n+        } else if (sizeof(limb_t) == 8) {\n+            WriteLE64(hash384.data() + i * 8, data.limbs[i]);\n+        }\n+    }\n+}\n+\n+MuHash3072& MuHash3072::operator*=(const MuHash3072& x) noexcept\n+{\n+    Multiply(&this->data, &x.data);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507232528",
      "id" : 507232528,
      "in_reply_to_id" : 507183199,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzIzMjUyOA==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 294,
      "original_position" : 294,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 511265915,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507232528",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507232586"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507232586"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I prefer the additive terminology personally and I thought they were both using it: `add` and `sub`tract? What would you prefer? `rem` for remove?",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-18T22:42:38Z",
      "diff_hunk" : "@@ -0,0 +1,97 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+\n+#include <stdint.h>\n+\n+struct Num3072 {\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_t;\n+    typedef uint64_t limb_t;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_t;\n+    typedef uint32_t limb_t;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_t limbs[LIMBS];\n+};\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+/** A class representing MuHash sets\n+ *\n+ * MuHash is a hashing algorithm that supports adding set elements in any\n+ * order but also deleting in any order. As a result, it can maintain a\n+ * running sum for a set of data as a whole, and add/subtract when data\n+ * is added to or removed from it. A downside of MuHash is that computing\n+ * an inverse is relatively expensive. This can be solved by representing\n+ * the running value as a fraction, and multiplying added elements into\n+ * the numerator and removed elements into the denominator. Only when the\n+ * final hash is desired, a single modular inverse and multiplication is\n+ * needed to combine the two.\n+ *\n+ * TODO: Represent running value as a fraction to allow for more intuitive\n+ * use (see above).\n+ *\n+ * As the update operations are also associative, H(a)+H(b)+H(c)+H(d) can\n+ * in fact be computed as (H(a)+H(b)) + (H(c)+H(d)). This implies that\n+ * all of this is perfectly parallellizable: each thread can process an\n+ * arbitrary subset of the update operations, allowing them to be\n+ * efficiently combined later.\n+ *\n+ * Muhash does not support checking if an element is already part of the\n+ * set. That is why this class does not enforce the use of a set as the\n+ * data it represents because there is no efficient way to do so..\n+ * It is possible to add elements more than once and also to remove\n+ * elements that have not been added before. However, this implementation\n+ * is intended to represent a set of elements.\n+ *\n+ * See also https://cseweb.ucsd.edu/~mihir/papers/inchash.pdf and\n+ * https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014337.html.\n+ */\n+class MuHash3072\n+{\n+protected:\n+    Num3072 data;\n+\n+    static constexpr size_t INPUT_SIZE = 32;\n+    static constexpr size_t OUTPUT_SIZE = 384;\n+\n+public:\n+    /* The empty set. */\n+    MuHash3072() noexcept;\n+\n+    /* A singleton with a single 32-byte key in it. */\n+    explicit MuHash3072(Span<const unsigned char> key32) noexcept;\n+\n+    /* Multiply (resulting in a hash for the union of the sets) */\n+    MuHash3072& operator*=(const MuHash3072& add) noexcept;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507232586",
      "id" : 507232586,
      "in_reply_to_id" : 507184333,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzIzMjU4Ng==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 75,
      "original_position" : 81,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : null,
      "pull_request_review_id" : 511265929,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507232586",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507232707"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507232707"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I did spend quite some time looking for something but the paper is only available behind a paywall and a friend told me there are other sources but that we might not want to link to those. I didn't find any summaries or so on the topic so if we want more details I would need to write something up myself I think.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-18T22:42:56Z",
      "diff_hunk" : "@@ -0,0 +1,304 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+    {\n+        double_limb_t t = (double_limb_t)a * b;\n+        th = t >> LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+    {\n+        double_limb_t t = (double_limb_t)a * b;\n+        th = t >> LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, limb_t& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072* d)\n+{\n+    if (d->limbs[0] <= std::numeric_limits<limb_t>::max() - MAX_PRIME_DIFF) return false;\n+    for (int i = 1; i < LIMBS; ++i) {\n+        if (d->limbs[i] != std::numeric_limits<limb_t>::max()) return false;\n+    }\n+    return true;\n+}\n+\n+void FullReduce(Num3072* d)\n+{\n+    limb_t c0 = MAX_PRIME_DIFF;\n+    for (int i = 0; i < LIMBS; ++i) {\n+        limb_t c1 = 0;\n+        add2(c0, c1, d->limbs[i]);\n+        extract2(c0, c1, d->limbs[i]);\n+    }\n+}\n+\n+void Multiply(Num3072* in_out, const Num3072* a)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*a into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        mul(d0, d1, in_out->limbs[1 + j], a->limbs[LIMBS + j - (1 + j)]);\n+        for (int i = 2 + j; i < LIMBS; ++i) muladd3(d0, d1, d2, in_out->limbs[i], a->limbs[LIMBS + j - i]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < j + 1; ++i) muladd3(c0, c1, c2, in_out->limbs[i], a->limbs[j - i]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    /* Compute limb N-1 of a*b into tmp. */\n+    {\n+        limb_t c2 = 0;\n+        for (int i = 0; i < LIMBS; ++i) muladd3(c0, c1, c2, in_out->limbs[i], a->limbs[LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out->limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Square(Num3072* in_out)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*in_out into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        for (int i = 0; i < (LIMBS - 1 - j) / 2; ++i) muldbladd3(d0, d1, d2, in_out->limbs[i + j + 1], in_out->limbs[LIMBS - 1 - i]);\n+        if ((j + 1) & 1) muladd3(d0, d1, d2, in_out->limbs[(LIMBS - 1 - j) / 2 + j + 1], in_out->limbs[LIMBS - 1 - (LIMBS - 1 - j) / 2]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < (j + 1) / 2; ++i) muldbladd3(c0, c1, c2, in_out->limbs[i], in_out->limbs[j - i]);\n+        if ((j + 1) & 1) muladd3(c0, c1, c2, in_out->limbs[(j + 1) / 2], in_out->limbs[j - (j + 1) / 2]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    {\n+        limb_t c2 = 0;\n+        for (int i = 0; i < LIMBS / 2; ++i) muldbladd3(c0, c1, c2, in_out->limbs[i], in_out->limbs[LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out->limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Inverse(Num3072* out, const Num3072* a)\n+{\n+    // For fast exponentiation a sliding window exponentiation with repunit\n+    // precomputation is utilized. See \"Fast Point Decompression for Standard\n+    // Elliptic Curves\" (Brumley, JÃ¤rvinen, 2008).",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507232707",
      "id" : 507232707,
      "in_reply_to_id" : 507186374,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzIzMjcwNw==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 210,
      "original_position" : 210,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 511265959,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507232707",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507233000"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507233000"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Removed them",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-18T22:43:30Z",
      "diff_hunk" : "@@ -0,0 +1,304 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+    {\n+        double_limb_t t = (double_limb_t)a * b;\n+        th = t >> LIMB_SIZE;\n+        tl = t;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507233000",
      "id" : 507233000,
      "in_reply_to_id" : 507194862,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzIzMzAwMA==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 86,
      "original_position" : 86,
      "original_start_line" : 82,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 511266027,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507233000",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for the feedback @jnewbery . I implemented most comments while there are still some I need to spend some more time on (including https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507186328 which I can not comment on for some reason).",
      "created_at" : "2020-10-18T22:45:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-711435198",
      "id" : 711435198,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxMTQzNTE5OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-18T22:45:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/711435198",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507238291"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507238291"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I expect a 4x speed difference approximately. Being able to use 64-bit multiplication hardware makes a huge difference.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-18T22:56:14Z",
      "diff_hunk" : "@@ -0,0 +1,97 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+\n+#include <stdint.h>\n+\n+struct Num3072 {\n+#ifdef HAVE___INT128",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507238291",
      "id" : 507238291,
      "in_reply_to_id" : 507173583,
      "line" : 26,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzIzODI5MQ==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 26,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : 26,
      "pull_request_review_id" : 511267271,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507238291",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507347412"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507347412"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The C++ code would be `square_n_mul`. Just having an inline function to calculate `x**(2**n)` -- ie the \"square n times\" part would probably already make it easier to follow.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-19T02:01:10Z",
      "diff_hunk" : "@@ -0,0 +1,304 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+    {\n+        double_limb_t t = (double_limb_t)a * b;\n+        th = t >> LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+    {\n+        double_limb_t t = (double_limb_t)a * b;\n+        th = t >> LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, limb_t& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072* d)\n+{\n+    if (d->limbs[0] <= std::numeric_limits<limb_t>::max() - MAX_PRIME_DIFF) return false;\n+    for (int i = 1; i < LIMBS; ++i) {\n+        if (d->limbs[i] != std::numeric_limits<limb_t>::max()) return false;\n+    }\n+    return true;\n+}\n+\n+void FullReduce(Num3072* d)\n+{\n+    limb_t c0 = MAX_PRIME_DIFF;\n+    for (int i = 0; i < LIMBS; ++i) {\n+        limb_t c1 = 0;\n+        add2(c0, c1, d->limbs[i]);\n+        extract2(c0, c1, d->limbs[i]);\n+    }\n+}\n+\n+void Multiply(Num3072* in_out, const Num3072* a)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*a into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        mul(d0, d1, in_out->limbs[1 + j], a->limbs[LIMBS + j - (1 + j)]);\n+        for (int i = 2 + j; i < LIMBS; ++i) muladd3(d0, d1, d2, in_out->limbs[i], a->limbs[LIMBS + j - i]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < j + 1; ++i) muladd3(c0, c1, c2, in_out->limbs[i], a->limbs[j - i]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    /* Compute limb N-1 of a*b into tmp. */\n+    {\n+        limb_t c2 = 0;\n+        for (int i = 0; i < LIMBS; ++i) muladd3(c0, c1, c2, in_out->limbs[i], a->limbs[LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out->limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Square(Num3072* in_out)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*in_out into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        for (int i = 0; i < (LIMBS - 1 - j) / 2; ++i) muldbladd3(d0, d1, d2, in_out->limbs[i + j + 1], in_out->limbs[LIMBS - 1 - i]);\n+        if ((j + 1) & 1) muladd3(d0, d1, d2, in_out->limbs[(LIMBS - 1 - j) / 2 + j + 1], in_out->limbs[LIMBS - 1 - (LIMBS - 1 - j) / 2]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < (j + 1) / 2; ++i) muldbladd3(c0, c1, c2, in_out->limbs[i], in_out->limbs[j - i]);\n+        if ((j + 1) & 1) muladd3(c0, c1, c2, in_out->limbs[(j + 1) / 2], in_out->limbs[j - (j + 1) / 2]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    {\n+        limb_t c2 = 0;\n+        for (int i = 0; i < LIMBS / 2; ++i) muldbladd3(c0, c1, c2, in_out->limbs[i], in_out->limbs[LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out->limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Inverse(Num3072* out, const Num3072* a)\n+{\n+    // For fast exponentiation a sliding window exponentiation with repunit\n+    // precomputation is utilized. See \"Fast Point Decompression for Standard\n+    // Elliptic Curves\" (Brumley, JÃ¤rvinen, 2008).",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507347412",
      "id" : 507347412,
      "in_reply_to_id" : 492832419,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzM0NzQxMg==",
      "original_commit_id" : "ef53ca76cc616cd359969533a75c3dab388ec38d",
      "original_line" : 210,
      "original_position" : 210,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 511368818,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507347412",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507352789"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507352789"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This is just an explanation of how the constants were chosen in the first place. I think it's only interesting in the same way references in an academic paper help trace the lineage of an idea rather than actually useful for reviewing the code as it stands -- ie, handy if you want to reinvent it, eg if 3072 bits aren't enough and you need to pick a new prime and hence new constants for efficient inversion, or if you want to see if you can find different constants that would involve even fewer square/multiply operations to get the same result. But not needed if you just want to check correctness.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-19T02:07:03Z",
      "diff_hunk" : "@@ -0,0 +1,304 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+    {\n+        double_limb_t t = (double_limb_t)a * b;\n+        th = t >> LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+    {\n+        double_limb_t t = (double_limb_t)a * b;\n+        th = t >> LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, limb_t& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072* d)\n+{\n+    if (d->limbs[0] <= std::numeric_limits<limb_t>::max() - MAX_PRIME_DIFF) return false;\n+    for (int i = 1; i < LIMBS; ++i) {\n+        if (d->limbs[i] != std::numeric_limits<limb_t>::max()) return false;\n+    }\n+    return true;\n+}\n+\n+void FullReduce(Num3072* d)\n+{\n+    limb_t c0 = MAX_PRIME_DIFF;\n+    for (int i = 0; i < LIMBS; ++i) {\n+        limb_t c1 = 0;\n+        add2(c0, c1, d->limbs[i]);\n+        extract2(c0, c1, d->limbs[i]);\n+    }\n+}\n+\n+void Multiply(Num3072* in_out, const Num3072* a)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*a into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        mul(d0, d1, in_out->limbs[1 + j], a->limbs[LIMBS + j - (1 + j)]);\n+        for (int i = 2 + j; i < LIMBS; ++i) muladd3(d0, d1, d2, in_out->limbs[i], a->limbs[LIMBS + j - i]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < j + 1; ++i) muladd3(c0, c1, c2, in_out->limbs[i], a->limbs[j - i]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    /* Compute limb N-1 of a*b into tmp. */\n+    {\n+        limb_t c2 = 0;\n+        for (int i = 0; i < LIMBS; ++i) muladd3(c0, c1, c2, in_out->limbs[i], a->limbs[LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out->limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Square(Num3072* in_out)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*in_out into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        for (int i = 0; i < (LIMBS - 1 - j) / 2; ++i) muldbladd3(d0, d1, d2, in_out->limbs[i + j + 1], in_out->limbs[LIMBS - 1 - i]);\n+        if ((j + 1) & 1) muladd3(d0, d1, d2, in_out->limbs[(LIMBS - 1 - j) / 2 + j + 1], in_out->limbs[LIMBS - 1 - (LIMBS - 1 - j) / 2]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < (j + 1) / 2; ++i) muldbladd3(c0, c1, c2, in_out->limbs[i], in_out->limbs[j - i]);\n+        if ((j + 1) & 1) muladd3(c0, c1, c2, in_out->limbs[(j + 1) / 2], in_out->limbs[j - (j + 1) / 2]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    {\n+        limb_t c2 = 0;\n+        for (int i = 0; i < LIMBS / 2; ++i) muldbladd3(c0, c1, c2, in_out->limbs[i], in_out->limbs[LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out->limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Inverse(Num3072* out, const Num3072* a)\n+{\n+    // For fast exponentiation a sliding window exponentiation with repunit\n+    // precomputation is utilized. See \"Fast Point Decompression for Standard\n+    // Elliptic Curves\" (Brumley, JÃ¤rvinen, 2008).",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507352789",
      "id" : 507352789,
      "in_reply_to_id" : 507186374,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzM1Mjc4OQ==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 210,
      "original_position" : 210,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 511370025,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507352789",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507517654"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507517654"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'd prefer `mul` and `div` for the multiplier and divisor operators. Alternatively change the operators to `+=` and `-=`.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-19T07:06:53Z",
      "diff_hunk" : "@@ -0,0 +1,97 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+\n+#include <stdint.h>\n+\n+struct Num3072 {\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_t;\n+    typedef uint64_t limb_t;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_t;\n+    typedef uint32_t limb_t;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_t limbs[LIMBS];\n+};\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+/** A class representing MuHash sets\n+ *\n+ * MuHash is a hashing algorithm that supports adding set elements in any\n+ * order but also deleting in any order. As a result, it can maintain a\n+ * running sum for a set of data as a whole, and add/subtract when data\n+ * is added to or removed from it. A downside of MuHash is that computing\n+ * an inverse is relatively expensive. This can be solved by representing\n+ * the running value as a fraction, and multiplying added elements into\n+ * the numerator and removed elements into the denominator. Only when the\n+ * final hash is desired, a single modular inverse and multiplication is\n+ * needed to combine the two.\n+ *\n+ * TODO: Represent running value as a fraction to allow for more intuitive\n+ * use (see above).\n+ *\n+ * As the update operations are also associative, H(a)+H(b)+H(c)+H(d) can\n+ * in fact be computed as (H(a)+H(b)) + (H(c)+H(d)). This implies that\n+ * all of this is perfectly parallellizable: each thread can process an\n+ * arbitrary subset of the update operations, allowing them to be\n+ * efficiently combined later.\n+ *\n+ * Muhash does not support checking if an element is already part of the\n+ * set. That is why this class does not enforce the use of a set as the\n+ * data it represents because there is no efficient way to do so..\n+ * It is possible to add elements more than once and also to remove\n+ * elements that have not been added before. However, this implementation\n+ * is intended to represent a set of elements.\n+ *\n+ * See also https://cseweb.ucsd.edu/~mihir/papers/inchash.pdf and\n+ * https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014337.html.\n+ */\n+class MuHash3072\n+{\n+protected:\n+    Num3072 data;\n+\n+    static constexpr size_t INPUT_SIZE = 32;\n+    static constexpr size_t OUTPUT_SIZE = 384;\n+\n+public:\n+    /* The empty set. */\n+    MuHash3072() noexcept;\n+\n+    /* A singleton with a single 32-byte key in it. */\n+    explicit MuHash3072(Span<const unsigned char> key32) noexcept;\n+\n+    /* Multiply (resulting in a hash for the union of the sets) */\n+    MuHash3072& operator*=(const MuHash3072& add) noexcept;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507517654",
      "id" : 507517654,
      "in_reply_to_id" : 507184333,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzUxNzY1NA==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 75,
      "original_position" : 81,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : null,
      "pull_request_review_id" : 511463883,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507517654",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507593284"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507593284"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No need to mark these as static. Being in the unnamed namespace already means that they don't have external linkage.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-19T09:13:08Z",
      "diff_hunk" : "@@ -0,0 +1,310 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+static constexpr size_t INPUT_SIZE = 32;\n+static constexpr size_t OUTPUT_SIZE = 384;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507593284",
      "id" : 507593284,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzU5MzI4NA==",
      "original_commit_id" : "b03e923c534a954edfdd9ef4ec9a68e5dd08d827",
      "original_line" : 21,
      "original_position" : 21,
      "original_start_line" : 20,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 511561744,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507593284",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507593683"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507593683"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No need to declare these variables up here. Just declare them where you need them. Same in other functions below.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-19T09:13:49Z",
      "diff_hunk" : "@@ -0,0 +1,310 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+static constexpr size_t INPUT_SIZE = 32;\n+static constexpr size_t OUTPUT_SIZE = 384;\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507593683",
      "id" : 507593683,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzU5MzY4Mw==",
      "original_commit_id" : "b03e923c534a954edfdd9ef4ec9a68e5dd08d827",
      "original_line" : 87,
      "original_position" : 87,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 511561744,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507593683",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507596124"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507596124"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Agree. I don't think there's anything more needed here.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-19T09:17:46Z",
      "diff_hunk" : "@@ -0,0 +1,304 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+    {\n+        double_limb_t t = (double_limb_t)a * b;\n+        th = t >> LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+    {\n+        double_limb_t t = (double_limb_t)a * b;\n+        th = t >> LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, limb_t& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072* d)\n+{\n+    if (d->limbs[0] <= std::numeric_limits<limb_t>::max() - MAX_PRIME_DIFF) return false;\n+    for (int i = 1; i < LIMBS; ++i) {\n+        if (d->limbs[i] != std::numeric_limits<limb_t>::max()) return false;\n+    }\n+    return true;\n+}\n+\n+void FullReduce(Num3072* d)\n+{\n+    limb_t c0 = MAX_PRIME_DIFF;\n+    for (int i = 0; i < LIMBS; ++i) {\n+        limb_t c1 = 0;\n+        add2(c0, c1, d->limbs[i]);\n+        extract2(c0, c1, d->limbs[i]);\n+    }\n+}\n+\n+void Multiply(Num3072* in_out, const Num3072* a)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*a into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        mul(d0, d1, in_out->limbs[1 + j], a->limbs[LIMBS + j - (1 + j)]);\n+        for (int i = 2 + j; i < LIMBS; ++i) muladd3(d0, d1, d2, in_out->limbs[i], a->limbs[LIMBS + j - i]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < j + 1; ++i) muladd3(c0, c1, c2, in_out->limbs[i], a->limbs[j - i]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    /* Compute limb N-1 of a*b into tmp. */\n+    {\n+        limb_t c2 = 0;\n+        for (int i = 0; i < LIMBS; ++i) muladd3(c0, c1, c2, in_out->limbs[i], a->limbs[LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out->limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Square(Num3072* in_out)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*in_out into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        for (int i = 0; i < (LIMBS - 1 - j) / 2; ++i) muldbladd3(d0, d1, d2, in_out->limbs[i + j + 1], in_out->limbs[LIMBS - 1 - i]);\n+        if ((j + 1) & 1) muladd3(d0, d1, d2, in_out->limbs[(LIMBS - 1 - j) / 2 + j + 1], in_out->limbs[LIMBS - 1 - (LIMBS - 1 - j) / 2]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < (j + 1) / 2; ++i) muldbladd3(c0, c1, c2, in_out->limbs[i], in_out->limbs[j - i]);\n+        if ((j + 1) & 1) muladd3(c0, c1, c2, in_out->limbs[(j + 1) / 2], in_out->limbs[j - (j + 1) / 2]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    {\n+        limb_t c2 = 0;\n+        for (int i = 0; i < LIMBS / 2; ++i) muldbladd3(c0, c1, c2, in_out->limbs[i], in_out->limbs[LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out->limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Inverse(Num3072* out, const Num3072* a)\n+{\n+    // For fast exponentiation a sliding window exponentiation with repunit\n+    // precomputation is utilized. See \"Fast Point Decompression for Standard\n+    // Elliptic Curves\" (Brumley, JÃ¤rvinen, 2008).",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507596124",
      "id" : 507596124,
      "in_reply_to_id" : 507186374,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzU5NjEyNA==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 210,
      "original_position" : 210,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 511561744,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507596124",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507596535"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507596535"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Implicit `this`:\r\n\r\n```suggestion\r\n    Multiply(m_data, tmp);\r\n```",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-19T09:18:27Z",
      "diff_hunk" : "@@ -0,0 +1,310 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+static constexpr size_t INPUT_SIZE = 32;\n+static constexpr size_t OUTPUT_SIZE = 384;\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+\n+    double_limb_t t = (double_limb_t)a * b;\n+    th = t >> LIMB_SIZE;\n+    tl = t;\n+\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+\n+    double_limb_t t = (double_limb_t)a * b;\n+    th = t >> LIMB_SIZE;\n+    tl = t;\n+\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, limb_t& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072& d)\n+{\n+    if (d.limbs[0] <= std::numeric_limits<limb_t>::max() - MAX_PRIME_DIFF) return false;\n+    for (int i = 1; i < LIMBS; ++i) {\n+        if (d.limbs[i] != std::numeric_limits<limb_t>::max()) return false;\n+    }\n+    return true;\n+}\n+\n+void FullReduce(Num3072& d)\n+{\n+    limb_t c0 = MAX_PRIME_DIFF;\n+    for (int i = 0; i < LIMBS; ++i) {\n+        limb_t c1 = 0;\n+        add2(c0, c1, d.limbs[i]);\n+        extract2(c0, c1, d.limbs[i]);\n+    }\n+}\n+\n+void Multiply(Num3072& in_out, const Num3072& a)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*a into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        mul(d0, d1, in_out.limbs[1 + j], a.limbs[LIMBS + j - (1 + j)]);\n+        for (int i = 2 + j; i < LIMBS; ++i) muladd3(d0, d1, d2, in_out.limbs[i], a.limbs[LIMBS + j - i]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < j + 1; ++i) muladd3(c0, c1, c2, in_out.limbs[i], a.limbs[j - i]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+\n+    /* Compute limb N-1 of a*b into tmp. */\n+    limb_t c2 = 0;\n+    for (int i = 0; i < LIMBS; ++i) muladd3(c0, c1, c2, in_out.limbs[i], a.limbs[LIMBS - 1 - i]);\n+    extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out.limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Square(Num3072& in_out)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*in_out into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        for (int i = 0; i < (LIMBS - 1 - j) / 2; ++i) muldbladd3(d0, d1, d2, in_out.limbs[i + j + 1], in_out.limbs[LIMBS - 1 - i]);\n+        if ((j + 1) & 1) muladd3(d0, d1, d2, in_out.limbs[(LIMBS - 1 - j) / 2 + j + 1], in_out.limbs[LIMBS - 1 - (LIMBS - 1 - j) / 2]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < (j + 1) / 2; ++i) muldbladd3(c0, c1, c2, in_out.limbs[i], in_out.limbs[j - i]);\n+        if ((j + 1) & 1) muladd3(c0, c1, c2, in_out.limbs[(j + 1) / 2], in_out.limbs[j - (j + 1) / 2]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+\n+    limb_t c2 = 0;\n+    for (int i = 0; i < LIMBS / 2; ++i) muldbladd3(c0, c1, c2, in_out.limbs[i], in_out.limbs[LIMBS - 1 - i]);\n+    extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out.limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Inverse(Num3072& out, const Num3072& a)\n+{\n+    // For fast exponentiation a sliding window exponentiation with repunit\n+    // precomputation is utilized. See \"Fast Point Decompression for Standard\n+    // Elliptic Curves\" (Brumley, JÃ¤rvinen, 2008).\n+\n+    Num3072 p[12]; // p[i] = a^(2^(2^i)-1)\n+    Num3072 x;\n+\n+    p[0] = a;\n+\n+    for (int i = 0; i < 11; ++i) {\n+        p[i + 1] = p[i];\n+        for (int j = 0; j < (1 << i); ++j) Square(p[i + 1]);\n+        Multiply(p[i + 1], p[i]);\n+    }\n+\n+    x = p[11];\n+\n+    for (int j = 0; j < 512; ++j) Square(x);\n+    Multiply(x, p[9]);\n+    for (int j = 0; j < 256; ++j) Square(x);\n+    Multiply(x, p[8]);\n+    for (int j = 0; j < 128; ++j) Square(x);\n+    Multiply(x, p[7]);\n+    for (int j = 0; j < 64; ++j) Square(x);\n+    Multiply(x, p[6]);\n+    for (int j = 0; j < 32; ++j) Square(x);\n+    Multiply(x, p[5]);\n+    for (int j = 0; j < 8; ++j) Square(x);\n+    Multiply(x, p[3]);\n+    for (int j = 0; j < 2; ++j) Square(x);\n+    Multiply(x, p[1]);\n+    for (int j = 0; j < 1; ++j) Square(x);\n+    Multiply(x, p[0]);\n+    for (int j = 0; j < 5; ++j) Square(x);\n+    Multiply(x, p[2]);\n+    for (int j = 0; j < 3; ++j) Square(x);\n+    Multiply(x, p[0]);\n+    for (int j = 0; j < 2; ++j) Square(x);\n+    Multiply(x, p[0]);\n+    for (int j = 0; j < 4; ++j) Square(x);\n+    Multiply(x, p[0]);\n+    for (int j = 0; j < 4; ++j) Square(x);\n+    Multiply(x, p[1]);\n+    for (int j = 0; j < 3; ++j) Square(x);\n+    Multiply(x, p[0]);\n+\n+    out = x;\n+}\n+\n+} // namespace\n+\n+MuHash3072::MuHash3072() noexcept\n+{\n+    m_data.limbs[0] = 1;\n+    for (int i = 1; i < LIMBS; ++i) m_data.limbs[i] = 0;\n+}\n+\n+MuHash3072::MuHash3072(Span<const unsigned char> key32) noexcept\n+{\n+    assert(key32.size() == INPUT_SIZE);\n+    unsigned char tmp[OUTPUT_SIZE];\n+    ChaCha20(key32.data(), key32.size()).Keystream(tmp, OUTPUT_SIZE);\n+    for (int i = 0; i < LIMBS; ++i) {\n+        if (sizeof(limb_t) == 4) {\n+            m_data.limbs[i] = ReadLE32(tmp + 4 * i);\n+        } else if (sizeof(limb_t) == 8) {\n+            m_data.limbs[i] = ReadLE64(tmp + 8 * i);\n+        }\n+    }\n+}\n+\n+void MuHash3072::Finalize(Span<unsigned char> hash384) noexcept\n+{\n+    assert(hash384.size() == OUTPUT_SIZE);\n+    if (IsOverflow(m_data)) FullReduce(m_data);\n+    for (int i = 0; i < LIMBS; ++i) {\n+        if (sizeof(limb_t) == 4) {\n+            WriteLE32(hash384.data() + i * 4, m_data.limbs[i]);\n+        } else if (sizeof(limb_t) == 8) {\n+            WriteLE64(hash384.data() + i * 8, m_data.limbs[i]);\n+        }\n+    }\n+}\n+\n+MuHash3072& MuHash3072::operator*=(const MuHash3072& x) noexcept\n+{\n+    Multiply(m_data, x.m_data);\n+    return *this;\n+}\n+\n+MuHash3072& MuHash3072::operator/=(const MuHash3072& x) noexcept\n+{\n+    Num3072 tmp;\n+    Inverse(tmp, x.m_data);\n+    Multiply(this->m_data, tmp);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507596535",
      "id" : 507596535,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzU5NjUzNQ==",
      "original_commit_id" : "b03e923c534a954edfdd9ef4ec9a68e5dd08d827",
      "original_line" : 308,
      "original_position" : 308,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 511561744,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507596535",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507598399"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507598399"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why is this temporary needed? Can we just construct `out` here?\r\n\r\nChanging the function signature to `Num3072 Inverse(const Num3072& in)` would use RVO and avoid copying `x` to `out`.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-19T09:21:26Z",
      "diff_hunk" : "@@ -0,0 +1,310 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+static constexpr size_t INPUT_SIZE = 32;\n+static constexpr size_t OUTPUT_SIZE = 384;\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+\n+    double_limb_t t = (double_limb_t)a * b;\n+    th = t >> LIMB_SIZE;\n+    tl = t;\n+\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+\n+    double_limb_t t = (double_limb_t)a * b;\n+    th = t >> LIMB_SIZE;\n+    tl = t;\n+\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, limb_t& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072& d)\n+{\n+    if (d.limbs[0] <= std::numeric_limits<limb_t>::max() - MAX_PRIME_DIFF) return false;\n+    for (int i = 1; i < LIMBS; ++i) {\n+        if (d.limbs[i] != std::numeric_limits<limb_t>::max()) return false;\n+    }\n+    return true;\n+}\n+\n+void FullReduce(Num3072& d)\n+{\n+    limb_t c0 = MAX_PRIME_DIFF;\n+    for (int i = 0; i < LIMBS; ++i) {\n+        limb_t c1 = 0;\n+        add2(c0, c1, d.limbs[i]);\n+        extract2(c0, c1, d.limbs[i]);\n+    }\n+}\n+\n+void Multiply(Num3072& in_out, const Num3072& a)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*a into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        mul(d0, d1, in_out.limbs[1 + j], a.limbs[LIMBS + j - (1 + j)]);\n+        for (int i = 2 + j; i < LIMBS; ++i) muladd3(d0, d1, d2, in_out.limbs[i], a.limbs[LIMBS + j - i]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < j + 1; ++i) muladd3(c0, c1, c2, in_out.limbs[i], a.limbs[j - i]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+\n+    /* Compute limb N-1 of a*b into tmp. */\n+    limb_t c2 = 0;\n+    for (int i = 0; i < LIMBS; ++i) muladd3(c0, c1, c2, in_out.limbs[i], a.limbs[LIMBS - 1 - i]);\n+    extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out.limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Square(Num3072& in_out)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*in_out into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        for (int i = 0; i < (LIMBS - 1 - j) / 2; ++i) muldbladd3(d0, d1, d2, in_out.limbs[i + j + 1], in_out.limbs[LIMBS - 1 - i]);\n+        if ((j + 1) & 1) muladd3(d0, d1, d2, in_out.limbs[(LIMBS - 1 - j) / 2 + j + 1], in_out.limbs[LIMBS - 1 - (LIMBS - 1 - j) / 2]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < (j + 1) / 2; ++i) muldbladd3(c0, c1, c2, in_out.limbs[i], in_out.limbs[j - i]);\n+        if ((j + 1) & 1) muladd3(c0, c1, c2, in_out.limbs[(j + 1) / 2], in_out.limbs[j - (j + 1) / 2]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+\n+    limb_t c2 = 0;\n+    for (int i = 0; i < LIMBS / 2; ++i) muldbladd3(c0, c1, c2, in_out.limbs[i], in_out.limbs[LIMBS - 1 - i]);\n+    extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out.limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Inverse(Num3072& out, const Num3072& a)\n+{\n+    // For fast exponentiation a sliding window exponentiation with repunit\n+    // precomputation is utilized. See \"Fast Point Decompression for Standard\n+    // Elliptic Curves\" (Brumley, JÃ¤rvinen, 2008).\n+\n+    Num3072 p[12]; // p[i] = a^(2^(2^i)-1)\n+    Num3072 x;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507598399",
      "id" : 507598399,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzU5ODM5OQ==",
      "original_commit_id" : "b03e923c534a954edfdd9ef4ec9a68e5dd08d827",
      "original_line" : 219,
      "original_position" : 219,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 511561744,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507598399",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507602363"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507602363"
         }
      },
      "author_association" : "MEMBER",
      "body" : "We don't usually compile out asserts in our code (in fact, I can't see any other examples in the codebase). I suggest removing this `Ifdef`.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-19T09:27:34Z",
      "diff_hunk" : "@@ -0,0 +1,310 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+static constexpr size_t INPUT_SIZE = 32;\n+static constexpr size_t OUTPUT_SIZE = 384;\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+\n+    double_limb_t t = (double_limb_t)a * b;\n+    th = t >> LIMB_SIZE;\n+    tl = t;\n+\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+\n+    double_limb_t t = (double_limb_t)a * b;\n+    th = t >> LIMB_SIZE;\n+    tl = t;\n+\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, limb_t& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072& d)\n+{\n+    if (d.limbs[0] <= std::numeric_limits<limb_t>::max() - MAX_PRIME_DIFF) return false;\n+    for (int i = 1; i < LIMBS; ++i) {\n+        if (d.limbs[i] != std::numeric_limits<limb_t>::max()) return false;\n+    }\n+    return true;\n+}\n+\n+void FullReduce(Num3072& d)\n+{\n+    limb_t c0 = MAX_PRIME_DIFF;\n+    for (int i = 0; i < LIMBS; ++i) {\n+        limb_t c1 = 0;\n+        add2(c0, c1, d.limbs[i]);\n+        extract2(c0, c1, d.limbs[i]);\n+    }\n+}\n+\n+void Multiply(Num3072& in_out, const Num3072& a)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*a into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        mul(d0, d1, in_out.limbs[1 + j], a.limbs[LIMBS + j - (1 + j)]);\n+        for (int i = 2 + j; i < LIMBS; ++i) muladd3(d0, d1, d2, in_out.limbs[i], a.limbs[LIMBS + j - i]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < j + 1; ++i) muladd3(c0, c1, c2, in_out.limbs[i], a.limbs[j - i]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+\n+    /* Compute limb N-1 of a*b into tmp. */\n+    limb_t c2 = 0;\n+    for (int i = 0; i < LIMBS; ++i) muladd3(c0, c1, c2, in_out.limbs[i], a.limbs[LIMBS - 1 - i]);\n+    extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out.limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Square(Num3072& in_out)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*in_out into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        for (int i = 0; i < (LIMBS - 1 - j) / 2; ++i) muldbladd3(d0, d1, d2, in_out.limbs[i + j + 1], in_out.limbs[LIMBS - 1 - i]);\n+        if ((j + 1) & 1) muladd3(d0, d1, d2, in_out.limbs[(LIMBS - 1 - j) / 2 + j + 1], in_out.limbs[LIMBS - 1 - (LIMBS - 1 - j) / 2]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < (j + 1) / 2; ++i) muldbladd3(c0, c1, c2, in_out.limbs[i], in_out.limbs[j - i]);\n+        if ((j + 1) & 1) muladd3(c0, c1, c2, in_out.limbs[(j + 1) / 2], in_out.limbs[j - (j + 1) / 2]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+\n+    limb_t c2 = 0;\n+    for (int i = 0; i < LIMBS / 2; ++i) muldbladd3(c0, c1, c2, in_out.limbs[i], in_out.limbs[LIMBS - 1 - i]);\n+    extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out.limbs[j]);\n+    }\n+#ifdef DEBUG",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507602363",
      "id" : 507602363,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzYwMjM2Mw==",
      "original_commit_id" : "b03e923c534a954edfdd9ef4ec9a68e5dd08d827",
      "original_line" : 204,
      "original_position" : 204,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 511561744,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507602363",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507610270"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507610270"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`add2()` is always followed by `extract2()`. Does it make sense to refactor these two functions into a single function?",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-19T09:40:00Z",
      "diff_hunk" : "@@ -0,0 +1,310 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+static constexpr size_t INPUT_SIZE = 32;\n+static constexpr size_t OUTPUT_SIZE = 384;\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+\n+    double_limb_t t = (double_limb_t)a * b;\n+    th = t >> LIMB_SIZE;\n+    tl = t;\n+\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+\n+    double_limb_t t = (double_limb_t)a * b;\n+    th = t >> LIMB_SIZE;\n+    tl = t;\n+\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, limb_t& a)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507610270",
      "id" : 507610270,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzYxMDI3MA==",
      "original_commit_id" : "b03e923c534a954edfdd9ef4ec9a68e5dd08d827",
      "original_line" : 117,
      "original_position" : 119,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 511561744,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507610270",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507832149"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507832149"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Did you consider making the argument to the constructor and `Finalize()` functions references to array rather than spans? Doing so reduces flexibility (eg you wouldn't be able to Finalize into a vector, although I can't imagine you'd ever want to do that) but increases safety (you can enforce the inputs at compile time rather than asserting at runtime).",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-19T15:10:50Z",
      "diff_hunk" : "@@ -0,0 +1,91 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+\n+#include <stdint.h>\n+\n+struct Num3072 {\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_t;\n+    typedef uint64_t limb_t;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_t;\n+    typedef uint32_t limb_t;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_t limbs[LIMBS];\n+};\n+\n+/** A class representing MuHash sets\n+ *\n+ * MuHash is a hashing algorithm that supports adding set elements in any\n+ * order but also deleting in any order. As a result, it can maintain a\n+ * running sum for a set of data as a whole, and add/subtract when data\n+ * is added to or removed from it. A downside of MuHash is that computing\n+ * an inverse is relatively expensive. This can be solved by representing\n+ * the running value as a fraction, and multiplying added elements into\n+ * the numerator and removed elements into the denominator. Only when the\n+ * final hash is desired, a single modular inverse and multiplication is\n+ * needed to combine the two.\n+ *\n+ * TODO: Represent running value as a fraction to allow for more intuitive\n+ * use (see above).\n+ *\n+ * As the update operations are also associative, H(a)+H(b)+H(c)+H(d) can\n+ * in fact be computed as (H(a)+H(b)) + (H(c)+H(d)). This implies that\n+ * all of this is perfectly parallellizable: each thread can process an\n+ * arbitrary subset of the update operations, allowing them to be\n+ * efficiently combined later.\n+ *\n+ * Muhash does not support checking if an element is already part of the\n+ * set. That is why this class does not enforce the use of a set as the\n+ * data it represents because there is no efficient way to do so.\n+ * It is possible to add elements more than once and also to remove\n+ * elements that have not been added before. However, this implementation\n+ * is intended to represent a set of elements.\n+ *\n+ * See also https://cseweb.ucsd.edu/~mihir/papers/inchash.pdf and\n+ * https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014337.html.\n+ */\n+class MuHash3072\n+{\n+protected:\n+    Num3072 m_data;\n+\n+public:\n+    /* The empty set. */\n+    MuHash3072() noexcept;\n+\n+    /* A singleton with a single 32-byte key in it. */\n+    explicit MuHash3072(Span<const unsigned char> key32) noexcept;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507832149",
      "id" : 507832149,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzgzMjE0OQ==",
      "original_commit_id" : "b03e923c534a954edfdd9ef4ec9a68e5dd08d827",
      "original_line" : 72,
      "original_position" : 72,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : null,
      "pull_request_review_id" : 511870771,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507832149",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508085588"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508085588"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hm, making an `add_and_extract2()` to use it in 3 places doesn't feel like an improvement to me TBH.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-19T21:55:16Z",
      "diff_hunk" : "@@ -0,0 +1,310 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+static constexpr size_t INPUT_SIZE = 32;\n+static constexpr size_t OUTPUT_SIZE = 384;\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+\n+    double_limb_t t = (double_limb_t)a * b;\n+    th = t >> LIMB_SIZE;\n+    tl = t;\n+\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+\n+    double_limb_t t = (double_limb_t)a * b;\n+    th = t >> LIMB_SIZE;\n+    tl = t;\n+\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, limb_t& a)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508085588",
      "id" : 508085588,
      "in_reply_to_id" : 507610270,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODA4NTU4OA==",
      "original_commit_id" : "b03e923c534a954edfdd9ef4ec9a68e5dd08d827",
      "original_line" : 117,
      "original_position" : 119,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 512187939,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508085588",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508085622"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508085622"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-19T21:55:19Z",
      "diff_hunk" : "@@ -0,0 +1,310 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+static constexpr size_t INPUT_SIZE = 32;\n+static constexpr size_t OUTPUT_SIZE = 384;\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+\n+    double_limb_t t = (double_limb_t)a * b;\n+    th = t >> LIMB_SIZE;\n+    tl = t;\n+\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+\n+    double_limb_t t = (double_limb_t)a * b;\n+    th = t >> LIMB_SIZE;\n+    tl = t;\n+\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, limb_t& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072& d)\n+{\n+    if (d.limbs[0] <= std::numeric_limits<limb_t>::max() - MAX_PRIME_DIFF) return false;\n+    for (int i = 1; i < LIMBS; ++i) {\n+        if (d.limbs[i] != std::numeric_limits<limb_t>::max()) return false;\n+    }\n+    return true;\n+}\n+\n+void FullReduce(Num3072& d)\n+{\n+    limb_t c0 = MAX_PRIME_DIFF;\n+    for (int i = 0; i < LIMBS; ++i) {\n+        limb_t c1 = 0;\n+        add2(c0, c1, d.limbs[i]);\n+        extract2(c0, c1, d.limbs[i]);\n+    }\n+}\n+\n+void Multiply(Num3072& in_out, const Num3072& a)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*a into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        mul(d0, d1, in_out.limbs[1 + j], a.limbs[LIMBS + j - (1 + j)]);\n+        for (int i = 2 + j; i < LIMBS; ++i) muladd3(d0, d1, d2, in_out.limbs[i], a.limbs[LIMBS + j - i]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < j + 1; ++i) muladd3(c0, c1, c2, in_out.limbs[i], a.limbs[j - i]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+\n+    /* Compute limb N-1 of a*b into tmp. */\n+    limb_t c2 = 0;\n+    for (int i = 0; i < LIMBS; ++i) muladd3(c0, c1, c2, in_out.limbs[i], a.limbs[LIMBS - 1 - i]);\n+    extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out.limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Square(Num3072& in_out)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*in_out into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        for (int i = 0; i < (LIMBS - 1 - j) / 2; ++i) muldbladd3(d0, d1, d2, in_out.limbs[i + j + 1], in_out.limbs[LIMBS - 1 - i]);\n+        if ((j + 1) & 1) muladd3(d0, d1, d2, in_out.limbs[(LIMBS - 1 - j) / 2 + j + 1], in_out.limbs[LIMBS - 1 - (LIMBS - 1 - j) / 2]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < (j + 1) / 2; ++i) muldbladd3(c0, c1, c2, in_out.limbs[i], in_out.limbs[j - i]);\n+        if ((j + 1) & 1) muladd3(c0, c1, c2, in_out.limbs[(j + 1) / 2], in_out.limbs[j - (j + 1) / 2]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+\n+    limb_t c2 = 0;\n+    for (int i = 0; i < LIMBS / 2; ++i) muldbladd3(c0, c1, c2, in_out.limbs[i], in_out.limbs[LIMBS - 1 - i]);\n+    extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out.limbs[j]);\n+    }\n+#ifdef DEBUG",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508085622",
      "id" : 508085622,
      "in_reply_to_id" : 507602363,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODA4NTYyMg==",
      "original_commit_id" : "b03e923c534a954edfdd9ef4ec9a68e5dd08d827",
      "original_line" : 204,
      "original_position" : 204,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 512187975,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508085622",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508085686"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508085686"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-19T21:55:27Z",
      "diff_hunk" : "@@ -0,0 +1,310 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+static constexpr size_t INPUT_SIZE = 32;\n+static constexpr size_t OUTPUT_SIZE = 384;\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+\n+    double_limb_t t = (double_limb_t)a * b;\n+    th = t >> LIMB_SIZE;\n+    tl = t;\n+\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+\n+    double_limb_t t = (double_limb_t)a * b;\n+    th = t >> LIMB_SIZE;\n+    tl = t;\n+\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, limb_t& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072& d)\n+{\n+    if (d.limbs[0] <= std::numeric_limits<limb_t>::max() - MAX_PRIME_DIFF) return false;\n+    for (int i = 1; i < LIMBS; ++i) {\n+        if (d.limbs[i] != std::numeric_limits<limb_t>::max()) return false;\n+    }\n+    return true;\n+}\n+\n+void FullReduce(Num3072& d)\n+{\n+    limb_t c0 = MAX_PRIME_DIFF;\n+    for (int i = 0; i < LIMBS; ++i) {\n+        limb_t c1 = 0;\n+        add2(c0, c1, d.limbs[i]);\n+        extract2(c0, c1, d.limbs[i]);\n+    }\n+}\n+\n+void Multiply(Num3072& in_out, const Num3072& a)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*a into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        mul(d0, d1, in_out.limbs[1 + j], a.limbs[LIMBS + j - (1 + j)]);\n+        for (int i = 2 + j; i < LIMBS; ++i) muladd3(d0, d1, d2, in_out.limbs[i], a.limbs[LIMBS + j - i]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < j + 1; ++i) muladd3(c0, c1, c2, in_out.limbs[i], a.limbs[j - i]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+\n+    /* Compute limb N-1 of a*b into tmp. */\n+    limb_t c2 = 0;\n+    for (int i = 0; i < LIMBS; ++i) muladd3(c0, c1, c2, in_out.limbs[i], a.limbs[LIMBS - 1 - i]);\n+    extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out.limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Square(Num3072& in_out)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*in_out into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        for (int i = 0; i < (LIMBS - 1 - j) / 2; ++i) muldbladd3(d0, d1, d2, in_out.limbs[i + j + 1], in_out.limbs[LIMBS - 1 - i]);\n+        if ((j + 1) & 1) muladd3(d0, d1, d2, in_out.limbs[(LIMBS - 1 - j) / 2 + j + 1], in_out.limbs[LIMBS - 1 - (LIMBS - 1 - j) / 2]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < (j + 1) / 2; ++i) muldbladd3(c0, c1, c2, in_out.limbs[i], in_out.limbs[j - i]);\n+        if ((j + 1) & 1) muladd3(c0, c1, c2, in_out.limbs[(j + 1) / 2], in_out.limbs[j - (j + 1) / 2]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+\n+    limb_t c2 = 0;\n+    for (int i = 0; i < LIMBS / 2; ++i) muldbladd3(c0, c1, c2, in_out.limbs[i], in_out.limbs[LIMBS - 1 - i]);\n+    extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out.limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Inverse(Num3072& out, const Num3072& a)\n+{\n+    // For fast exponentiation a sliding window exponentiation with repunit\n+    // precomputation is utilized. See \"Fast Point Decompression for Standard\n+    // Elliptic Curves\" (Brumley, JÃ¤rvinen, 2008).\n+\n+    Num3072 p[12]; // p[i] = a^(2^(2^i)-1)\n+    Num3072 x;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508085686",
      "id" : 508085686,
      "in_reply_to_id" : 507598399,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODA4NTY4Ng==",
      "original_commit_id" : "b03e923c534a954edfdd9ef4ec9a68e5dd08d827",
      "original_line" : 219,
      "original_position" : 219,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 512188050,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508085686",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508085738"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508085738"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-19T21:55:35Z",
      "diff_hunk" : "@@ -0,0 +1,310 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+static constexpr size_t INPUT_SIZE = 32;\n+static constexpr size_t OUTPUT_SIZE = 384;\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+\n+    double_limb_t t = (double_limb_t)a * b;\n+    th = t >> LIMB_SIZE;\n+    tl = t;\n+\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+\n+    double_limb_t t = (double_limb_t)a * b;\n+    th = t >> LIMB_SIZE;\n+    tl = t;\n+\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, limb_t& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072& d)\n+{\n+    if (d.limbs[0] <= std::numeric_limits<limb_t>::max() - MAX_PRIME_DIFF) return false;\n+    for (int i = 1; i < LIMBS; ++i) {\n+        if (d.limbs[i] != std::numeric_limits<limb_t>::max()) return false;\n+    }\n+    return true;\n+}\n+\n+void FullReduce(Num3072& d)\n+{\n+    limb_t c0 = MAX_PRIME_DIFF;\n+    for (int i = 0; i < LIMBS; ++i) {\n+        limb_t c1 = 0;\n+        add2(c0, c1, d.limbs[i]);\n+        extract2(c0, c1, d.limbs[i]);\n+    }\n+}\n+\n+void Multiply(Num3072& in_out, const Num3072& a)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*a into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        mul(d0, d1, in_out.limbs[1 + j], a.limbs[LIMBS + j - (1 + j)]);\n+        for (int i = 2 + j; i < LIMBS; ++i) muladd3(d0, d1, d2, in_out.limbs[i], a.limbs[LIMBS + j - i]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < j + 1; ++i) muladd3(c0, c1, c2, in_out.limbs[i], a.limbs[j - i]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+\n+    /* Compute limb N-1 of a*b into tmp. */\n+    limb_t c2 = 0;\n+    for (int i = 0; i < LIMBS; ++i) muladd3(c0, c1, c2, in_out.limbs[i], a.limbs[LIMBS - 1 - i]);\n+    extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out.limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Square(Num3072& in_out)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*in_out into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        for (int i = 0; i < (LIMBS - 1 - j) / 2; ++i) muldbladd3(d0, d1, d2, in_out.limbs[i + j + 1], in_out.limbs[LIMBS - 1 - i]);\n+        if ((j + 1) & 1) muladd3(d0, d1, d2, in_out.limbs[(LIMBS - 1 - j) / 2 + j + 1], in_out.limbs[LIMBS - 1 - (LIMBS - 1 - j) / 2]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < (j + 1) / 2; ++i) muldbladd3(c0, c1, c2, in_out.limbs[i], in_out.limbs[j - i]);\n+        if ((j + 1) & 1) muladd3(c0, c1, c2, in_out.limbs[(j + 1) / 2], in_out.limbs[j - (j + 1) / 2]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+\n+    limb_t c2 = 0;\n+    for (int i = 0; i < LIMBS / 2; ++i) muldbladd3(c0, c1, c2, in_out.limbs[i], in_out.limbs[LIMBS - 1 - i]);\n+    extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out.limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Inverse(Num3072& out, const Num3072& a)\n+{\n+    // For fast exponentiation a sliding window exponentiation with repunit\n+    // precomputation is utilized. See \"Fast Point Decompression for Standard\n+    // Elliptic Curves\" (Brumley, JÃ¤rvinen, 2008).\n+\n+    Num3072 p[12]; // p[i] = a^(2^(2^i)-1)\n+    Num3072 x;\n+\n+    p[0] = a;\n+\n+    for (int i = 0; i < 11; ++i) {\n+        p[i + 1] = p[i];\n+        for (int j = 0; j < (1 << i); ++j) Square(p[i + 1]);\n+        Multiply(p[i + 1], p[i]);\n+    }\n+\n+    x = p[11];\n+\n+    for (int j = 0; j < 512; ++j) Square(x);\n+    Multiply(x, p[9]);\n+    for (int j = 0; j < 256; ++j) Square(x);\n+    Multiply(x, p[8]);\n+    for (int j = 0; j < 128; ++j) Square(x);\n+    Multiply(x, p[7]);\n+    for (int j = 0; j < 64; ++j) Square(x);\n+    Multiply(x, p[6]);\n+    for (int j = 0; j < 32; ++j) Square(x);\n+    Multiply(x, p[5]);\n+    for (int j = 0; j < 8; ++j) Square(x);\n+    Multiply(x, p[3]);\n+    for (int j = 0; j < 2; ++j) Square(x);\n+    Multiply(x, p[1]);\n+    for (int j = 0; j < 1; ++j) Square(x);\n+    Multiply(x, p[0]);\n+    for (int j = 0; j < 5; ++j) Square(x);\n+    Multiply(x, p[2]);\n+    for (int j = 0; j < 3; ++j) Square(x);\n+    Multiply(x, p[0]);\n+    for (int j = 0; j < 2; ++j) Square(x);\n+    Multiply(x, p[0]);\n+    for (int j = 0; j < 4; ++j) Square(x);\n+    Multiply(x, p[0]);\n+    for (int j = 0; j < 4; ++j) Square(x);\n+    Multiply(x, p[1]);\n+    for (int j = 0; j < 3; ++j) Square(x);\n+    Multiply(x, p[0]);\n+\n+    out = x;\n+}\n+\n+} // namespace\n+\n+MuHash3072::MuHash3072() noexcept\n+{\n+    m_data.limbs[0] = 1;\n+    for (int i = 1; i < LIMBS; ++i) m_data.limbs[i] = 0;\n+}\n+\n+MuHash3072::MuHash3072(Span<const unsigned char> key32) noexcept\n+{\n+    assert(key32.size() == INPUT_SIZE);\n+    unsigned char tmp[OUTPUT_SIZE];\n+    ChaCha20(key32.data(), key32.size()).Keystream(tmp, OUTPUT_SIZE);\n+    for (int i = 0; i < LIMBS; ++i) {\n+        if (sizeof(limb_t) == 4) {\n+            m_data.limbs[i] = ReadLE32(tmp + 4 * i);\n+        } else if (sizeof(limb_t) == 8) {\n+            m_data.limbs[i] = ReadLE64(tmp + 8 * i);\n+        }\n+    }\n+}\n+\n+void MuHash3072::Finalize(Span<unsigned char> hash384) noexcept\n+{\n+    assert(hash384.size() == OUTPUT_SIZE);\n+    if (IsOverflow(m_data)) FullReduce(m_data);\n+    for (int i = 0; i < LIMBS; ++i) {\n+        if (sizeof(limb_t) == 4) {\n+            WriteLE32(hash384.data() + i * 4, m_data.limbs[i]);\n+        } else if (sizeof(limb_t) == 8) {\n+            WriteLE64(hash384.data() + i * 8, m_data.limbs[i]);\n+        }\n+    }\n+}\n+\n+MuHash3072& MuHash3072::operator*=(const MuHash3072& x) noexcept\n+{\n+    Multiply(m_data, x.m_data);\n+    return *this;\n+}\n+\n+MuHash3072& MuHash3072::operator/=(const MuHash3072& x) noexcept\n+{\n+    Num3072 tmp;\n+    Inverse(tmp, x.m_data);\n+    Multiply(this->m_data, tmp);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508085738",
      "id" : 508085738,
      "in_reply_to_id" : 507596535,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODA4NTczOA==",
      "original_commit_id" : "b03e923c534a954edfdd9ef4ec9a68e5dd08d827",
      "original_line" : 308,
      "original_position" : 308,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 512188112,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508085738",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508085805"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508085805"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-19T21:55:40Z",
      "diff_hunk" : "@@ -0,0 +1,310 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+static constexpr size_t INPUT_SIZE = 32;\n+static constexpr size_t OUTPUT_SIZE = 384;\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508085805",
      "id" : 508085805,
      "in_reply_to_id" : 507593683,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODA4NTgwNQ==",
      "original_commit_id" : "b03e923c534a954edfdd9ef4ec9a68e5dd08d827",
      "original_line" : 87,
      "original_position" : 87,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 512188193,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508085805",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508085835"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508085835"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-19T21:55:46Z",
      "diff_hunk" : "@@ -0,0 +1,310 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+static constexpr size_t INPUT_SIZE = 32;\n+static constexpr size_t OUTPUT_SIZE = 384;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508085835",
      "id" : 508085835,
      "in_reply_to_id" : 507593284,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODA4NTgzNQ==",
      "original_commit_id" : "b03e923c534a954edfdd9ef4ec9a68e5dd08d827",
      "original_line" : 21,
      "original_position" : 21,
      "original_start_line" : 20,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 512188227,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508085835",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508085917"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508085917"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hm, yeah, with the operators in mind that naming makes more sense. Changed to `mul` and `div`.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-19T21:55:57Z",
      "diff_hunk" : "@@ -0,0 +1,97 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+\n+#include <stdint.h>\n+\n+struct Num3072 {\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_t;\n+    typedef uint64_t limb_t;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_t;\n+    typedef uint32_t limb_t;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_t limbs[LIMBS];\n+};\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+/** A class representing MuHash sets\n+ *\n+ * MuHash is a hashing algorithm that supports adding set elements in any\n+ * order but also deleting in any order. As a result, it can maintain a\n+ * running sum for a set of data as a whole, and add/subtract when data\n+ * is added to or removed from it. A downside of MuHash is that computing\n+ * an inverse is relatively expensive. This can be solved by representing\n+ * the running value as a fraction, and multiplying added elements into\n+ * the numerator and removed elements into the denominator. Only when the\n+ * final hash is desired, a single modular inverse and multiplication is\n+ * needed to combine the two.\n+ *\n+ * TODO: Represent running value as a fraction to allow for more intuitive\n+ * use (see above).\n+ *\n+ * As the update operations are also associative, H(a)+H(b)+H(c)+H(d) can\n+ * in fact be computed as (H(a)+H(b)) + (H(c)+H(d)). This implies that\n+ * all of this is perfectly parallellizable: each thread can process an\n+ * arbitrary subset of the update operations, allowing them to be\n+ * efficiently combined later.\n+ *\n+ * Muhash does not support checking if an element is already part of the\n+ * set. That is why this class does not enforce the use of a set as the\n+ * data it represents because there is no efficient way to do so..\n+ * It is possible to add elements more than once and also to remove\n+ * elements that have not been added before. However, this implementation\n+ * is intended to represent a set of elements.\n+ *\n+ * See also https://cseweb.ucsd.edu/~mihir/papers/inchash.pdf and\n+ * https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014337.html.\n+ */\n+class MuHash3072\n+{\n+protected:\n+    Num3072 data;\n+\n+    static constexpr size_t INPUT_SIZE = 32;\n+    static constexpr size_t OUTPUT_SIZE = 384;\n+\n+public:\n+    /* The empty set. */\n+    MuHash3072() noexcept;\n+\n+    /* A singleton with a single 32-byte key in it. */\n+    explicit MuHash3072(Span<const unsigned char> key32) noexcept;\n+\n+    /* Multiply (resulting in a hash for the union of the sets) */\n+    MuHash3072& operator*=(const MuHash3072& add) noexcept;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508085917",
      "id" : 508085917,
      "in_reply_to_id" : 507184333,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODA4NTkxNw==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 75,
      "original_position" : 81,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : null,
      "pull_request_review_id" : 512188328,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508085917",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508093977"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508093977"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Benchmarks on my machine with and without `__int128` (values hardcoded instead) show a significant speedup:\r\n\r\nWith `__int128`:\r\n```\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|            3,313.23 |          301,820.21 |    0.1% |      0.00 | `MuHash`\r\n|            2,544.00 |          393,081.76 |    0.1% |      0.00 | `MuHashAdd`\r\n|        5,385,923.00 |              185.67 |    1.7% |      0.06 | `MuHashDiv`\r\n|              752.12 |        1,329,566.23 |    0.1% |      0.00 | `MuHashPrecompute`\r\n```\r\n\r\nWithout `__int128`:\r\n```\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|           10,692.00 |           93,527.87 |    0.1% |      0.00 | `MuHash`\r\n|           10,279.00 |           97,285.73 |    0.2% |      0.00 | `MuHashAdd`\r\n|       27,921,963.00 |               35.81 |    2.2% |      0.32 | `MuHashDiv`\r\n|              931.21 |        1,073,873.55 |    2.6% |      0.00 | `MuHashPrecompute`\r\n```",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-19T22:15:12Z",
      "diff_hunk" : "@@ -0,0 +1,97 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+\n+#include <stdint.h>\n+\n+struct Num3072 {\n+#ifdef HAVE___INT128",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508093977",
      "id" : 508093977,
      "in_reply_to_id" : 507173583,
      "line" : 26,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODA5Mzk3Nw==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 26,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : 26,
      "pull_request_review_id" : 512198120,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508093977",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508256703"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508256703"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Same in other functions below.\r\n\r\nLooks like you missed these.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-20T07:05:48Z",
      "diff_hunk" : "@@ -0,0 +1,310 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+static constexpr size_t INPUT_SIZE = 32;\n+static constexpr size_t OUTPUT_SIZE = 384;\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508256703",
      "id" : 508256703,
      "in_reply_to_id" : 507593683,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODI1NjcwMw==",
      "original_commit_id" : "b03e923c534a954edfdd9ef4ec9a68e5dd08d827",
      "original_line" : 87,
      "original_position" : 87,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 512388914,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508256703",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508264086"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508264086"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No need for a blank line here. These are all standard library includes and can be grouped together (as well as using the C++ header names):\r\n\r\n```suggestion\r\n#include <cassert>\r\n#include <cstdio>\r\n#include <limits>\r\n```",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-20T07:19:17Z",
      "diff_hunk" : "@@ -0,0 +1,307 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508264086",
      "id" : 508264086,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODI2NDA4Ng==",
      "original_commit_id" : "b29a0fde8784b7574a987dfb037a988b442bf92b",
      "original_line" : 13,
      "original_position" : 13,
      "original_start_line" : 10,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 512398415,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508264086",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508264443"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508264443"
         }
      },
      "author_association" : "MEMBER",
      "body" : "'next' from what? Is this just the largest 3072 bit safe prime number?",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-20T07:19:53Z",
      "diff_hunk" : "@@ -0,0 +1,307 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508264443",
      "id" : 508264443,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODI2NDQ0Mw==",
      "original_commit_id" : "b29a0fde8784b7574a987dfb037a988b442bf92b",
      "original_line" : 17,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 512398415,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508264443",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508275969"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508275969"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`limb_t& a` can be const, to indicate that it's an in-param (as is done for the in-params in the other helper functions)",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-20T07:39:32Z",
      "diff_hunk" : "@@ -0,0 +1,307 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+constexpr size_t INPUT_SIZE = 32;\n+constexpr size_t OUTPUT_SIZE = 384;\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    limb_t th = t >> LIMB_SIZE;\n+    limb_t tl = t;\n+\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+\n+    double_limb_t t = (double_limb_t)a * b;\n+    th = t >> LIMB_SIZE;\n+    tl = t;\n+\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, limb_t& a)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508275969",
      "id" : 508275969,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODI3NTk2OQ==",
      "original_commit_id" : "b29a0fde8784b7574a987dfb037a988b442bf92b",
      "original_line" : 117,
      "original_position" : 117,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 512398415,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508275969",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508277075"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508277075"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this function can overflow. If c1 is limb_t::max, and c0 + a overflows, then c1 + 1 overflows and the top bit is lost.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-20T07:41:16Z",
      "diff_hunk" : "@@ -0,0 +1,307 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+constexpr size_t INPUT_SIZE = 32;\n+constexpr size_t OUTPUT_SIZE = 384;\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    limb_t th = t >> LIMB_SIZE;\n+    limb_t tl = t;\n+\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+\n+    double_limb_t t = (double_limb_t)a * b;\n+    th = t >> LIMB_SIZE;\n+    tl = t;\n+\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, limb_t& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508277075",
      "id" : 508277075,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODI3NzA3NQ==",
      "original_commit_id" : "b29a0fde8784b7574a987dfb037a988b442bf92b",
      "original_line" : 101,
      "original_position" : 120,
      "original_start_line" : 119,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 512398415,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508277075",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508277430"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508277430"
         }
      },
      "author_association" : "MEMBER",
      "body" : "My suggestion was to merge `add2()` and `extract2()` since they're always called as a pair.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-20T07:41:52Z",
      "diff_hunk" : "@@ -0,0 +1,310 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+static constexpr size_t INPUT_SIZE = 32;\n+static constexpr size_t OUTPUT_SIZE = 384;\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+\n+    double_limb_t t = (double_limb_t)a * b;\n+    th = t >> LIMB_SIZE;\n+    tl = t;\n+\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+\n+    double_limb_t t = (double_limb_t)a * b;\n+    th = t >> LIMB_SIZE;\n+    tl = t;\n+\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, limb_t& a)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508277430",
      "id" : 508277430,
      "in_reply_to_id" : 507610270,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODI3NzQzMA==",
      "original_commit_id" : "b03e923c534a954edfdd9ef4ec9a68e5dd08d827",
      "original_line" : 117,
      "original_position" : 119,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 512398415,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508277430",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508284709"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508284709"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`t` is a local variable so is dropped immediately after this bitshift.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-20T07:53:23Z",
      "diff_hunk" : "@@ -0,0 +1,307 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+constexpr size_t INPUT_SIZE = 32;\n+constexpr size_t OUTPUT_SIZE = 384;\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+    t >>= LIMB_SIZE;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508284709",
      "id" : 508284709,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODI4NDcwOQ==",
      "original_commit_id" : "b29a0fde8784b7574a987dfb037a988b442bf92b",
      "original_line" : 81,
      "original_position" : 81,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 512398415,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508284709",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508817012"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508817012"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Removed",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-20T20:26:41Z",
      "diff_hunk" : "@@ -0,0 +1,307 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+constexpr size_t INPUT_SIZE = 32;\n+constexpr size_t OUTPUT_SIZE = 384;\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+    t >>= LIMB_SIZE;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508817012",
      "id" : 508817012,
      "in_reply_to_id" : 508284709,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODgxNzAxMg==",
      "original_commit_id" : "b29a0fde8784b7574a987dfb037a988b442bf92b",
      "original_line" : 81,
      "original_position" : 81,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 513105518,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508817012",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508817120"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508817120"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-20T20:26:55Z",
      "diff_hunk" : "@@ -0,0 +1,307 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+constexpr size_t INPUT_SIZE = 32;\n+constexpr size_t OUTPUT_SIZE = 384;\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    limb_t th = t >> LIMB_SIZE;\n+    limb_t tl = t;\n+\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+\n+    double_limb_t t = (double_limb_t)a * b;\n+    th = t >> LIMB_SIZE;\n+    tl = t;\n+\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, limb_t& a)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508817120",
      "id" : 508817120,
      "in_reply_to_id" : 508275969,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODgxNzEyMA==",
      "original_commit_id" : "b29a0fde8784b7574a987dfb037a988b442bf92b",
      "original_line" : 117,
      "original_position" : 117,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 513105652,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508817120",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508817390"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508817390"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Weird, I don't know how that made it in there, removed `next`",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-20T20:27:15Z",
      "diff_hunk" : "@@ -0,0 +1,307 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508817390",
      "id" : 508817390,
      "in_reply_to_id" : 508264443,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODgxNzM5MA==",
      "original_commit_id" : "b29a0fde8784b7574a987dfb037a988b442bf92b",
      "original_line" : 17,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 513105889,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508817390",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508817491"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508817491"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-20T20:27:23Z",
      "diff_hunk" : "@@ -0,0 +1,307 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r508817491",
      "id" : 508817491,
      "in_reply_to_id" : 508264086,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODgxNzQ5MQ==",
      "original_commit_id" : "b29a0fde8784b7574a987dfb037a988b442bf92b",
      "original_line" : 13,
      "original_position" : 13,
      "original_start_line" : 10,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 513105982,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/508817491",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r509130310"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509130310"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This function name is slightly confusing. This isn't returning whether the number has overflown the range that can be expressed in a Num3072. It's returning whether the number d is greater than the group order g and can therefore be reduced to a congruent value < g. I'd suggest renaming the function to `IsReduceable()` or `CanReduce()`, and commenting what the function is doing.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-21T09:29:38Z",
      "diff_hunk" : "@@ -0,0 +1,303 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <cassert>\n+#include <cstdio>\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+constexpr size_t INPUT_SIZE = 32;\n+constexpr size_t OUTPUT_SIZE = 384;\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    limb_t th = t >> LIMB_SIZE;\n+    limb_t tl = t;\n+\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    limb_t th = t >> LIMB_SIZE;\n+    limb_t tl = t;\n+\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, const limb_t& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072& d)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r509130310",
      "id" : 509130310,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTEzMDMxMA==",
      "original_commit_id" : "96a8d80f7ba43fd608984543d6bc6905f696529f",
      "original_line" : 119,
      "original_position" : 119,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 513482761,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509130310",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r509142040"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509142040"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This could also use a comment. We call this function in two places:\r\n\r\n1. After `IsOverflow` where `x â [g, MAX_NUM3072)`. In this case`FullReduce(x)` adds `MAX_PRIME_DIFF` to `x` and overflows Num3072, so `FullReduce(x) = x + MAX_PRIME_DIFF - MAX_NUM3072 = x - g`, which is congruent to x and is in `[0, g)`\r\n\r\n2. After `if (c0)` i.e. where x has overflown and `x = MAX_NUM3072 + d`. In this case `FullReduce(d)` adds `MAX_PRIME_DIFF` to `d`, so `x = MAX_NUM3072 + FullReduce(d) - MAX_PRIME_DIFF`, which means that `FullReduce(d)` and `x` are congruent. I think there _may_ be a bug here if `d â [g, MAX_NUM3072)`, i.e. if the `FullReduce()` function overflows. That would make `x = MAX_NUM3072 + FullReduce(d) - MAX_PRIME_DIFF + MAX_NUM3072` so `x` and `FullReduce(d)` are not congruent.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-21T09:47:33Z",
      "diff_hunk" : "@@ -0,0 +1,303 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <cassert>\n+#include <cstdio>\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+constexpr size_t INPUT_SIZE = 32;\n+constexpr size_t OUTPUT_SIZE = 384;\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    limb_t th = t >> LIMB_SIZE;\n+    limb_t tl = t;\n+\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    limb_t th = t >> LIMB_SIZE;\n+    limb_t tl = t;\n+\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, const limb_t& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072& d)\n+{\n+    if (d.limbs[0] <= std::numeric_limits<limb_t>::max() - MAX_PRIME_DIFF) return false;\n+    for (int i = 1; i < LIMBS; ++i) {\n+        if (d.limbs[i] != std::numeric_limits<limb_t>::max()) return false;\n+    }\n+    return true;\n+}\n+\n+void FullReduce(Num3072& d)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r509142040",
      "id" : 509142040,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTE0MjA0MA==",
      "original_commit_id" : "96a8d80f7ba43fd608984543d6bc6905f696529f",
      "original_line" : 128,
      "original_position" : 128,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 513482761,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509142040",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r509144274"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509144274"
         }
      },
      "author_association" : "MEMBER",
      "body" : "slightly confusing to have `c0` and `c1` declared at the top of the function, and `c2` declared both in the for block above here and again here. Perhaps move this declaration to the top too and reuse the variable. `c2` is always zero after `extract3()`, but you could assert that here to be clear.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-21T09:51:11Z",
      "diff_hunk" : "@@ -0,0 +1,303 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <cassert>\n+#include <cstdio>\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+constexpr size_t INPUT_SIZE = 32;\n+constexpr size_t OUTPUT_SIZE = 384;\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    limb_t th = t >> LIMB_SIZE;\n+    limb_t tl = t;\n+\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    limb_t th = t >> LIMB_SIZE;\n+    limb_t tl = t;\n+\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, const limb_t& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072& d)\n+{\n+    if (d.limbs[0] <= std::numeric_limits<limb_t>::max() - MAX_PRIME_DIFF) return false;\n+    for (int i = 1; i < LIMBS; ++i) {\n+        if (d.limbs[i] != std::numeric_limits<limb_t>::max()) return false;\n+    }\n+    return true;\n+}\n+\n+void FullReduce(Num3072& d)\n+{\n+    limb_t c0 = MAX_PRIME_DIFF;\n+    for (int i = 0; i < LIMBS; ++i) {\n+        limb_t c1 = 0;\n+        add2(c0, c1, d.limbs[i]);\n+        extract2(c0, c1, d.limbs[i]);\n+    }\n+}\n+\n+void Multiply(Num3072& in_out, const Num3072& a)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*a into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        mul(d0, d1, in_out.limbs[1 + j], a.limbs[LIMBS + j - (1 + j)]);\n+        for (int i = 2 + j; i < LIMBS; ++i) muladd3(d0, d1, d2, in_out.limbs[i], a.limbs[LIMBS + j - i]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < j + 1; ++i) muladd3(c0, c1, c2, in_out.limbs[i], a.limbs[j - i]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+\n+    /* Compute limb N-1 of a*b into tmp. */\n+    limb_t c2 = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r509144274",
      "id" : 509144274,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTE0NDI3NA==",
      "original_commit_id" : "96a8d80f7ba43fd608984543d6bc6905f696529f",
      "original_line" : 154,
      "original_position" : 154,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 513482761,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509144274",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r509145379"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509145379"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same as above. Any reason not to declare this `c2` at the top and reuse the variable?",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-21T09:52:49Z",
      "diff_hunk" : "@@ -0,0 +1,303 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <cassert>\n+#include <cstdio>\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+constexpr size_t INPUT_SIZE = 32;\n+constexpr size_t OUTPUT_SIZE = 384;\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    limb_t th = t >> LIMB_SIZE;\n+    limb_t tl = t;\n+\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    limb_t th = t >> LIMB_SIZE;\n+    limb_t tl = t;\n+\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, const limb_t& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072& d)\n+{\n+    if (d.limbs[0] <= std::numeric_limits<limb_t>::max() - MAX_PRIME_DIFF) return false;\n+    for (int i = 1; i < LIMBS; ++i) {\n+        if (d.limbs[i] != std::numeric_limits<limb_t>::max()) return false;\n+    }\n+    return true;\n+}\n+\n+void FullReduce(Num3072& d)\n+{\n+    limb_t c0 = MAX_PRIME_DIFF;\n+    for (int i = 0; i < LIMBS; ++i) {\n+        limb_t c1 = 0;\n+        add2(c0, c1, d.limbs[i]);\n+        extract2(c0, c1, d.limbs[i]);\n+    }\n+}\n+\n+void Multiply(Num3072& in_out, const Num3072& a)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*a into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        mul(d0, d1, in_out.limbs[1 + j], a.limbs[LIMBS + j - (1 + j)]);\n+        for (int i = 2 + j; i < LIMBS; ++i) muladd3(d0, d1, d2, in_out.limbs[i], a.limbs[LIMBS + j - i]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < j + 1; ++i) muladd3(c0, c1, c2, in_out.limbs[i], a.limbs[j - i]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+\n+    /* Compute limb N-1 of a*b into tmp. */\n+    limb_t c2 = 0;\n+    for (int i = 0; i < LIMBS; ++i) muladd3(c0, c1, c2, in_out.limbs[i], a.limbs[LIMBS - 1 - i]);\n+    extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out.limbs[j]);\n+    }\n+\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Square(Num3072& in_out)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*in_out into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        for (int i = 0; i < (LIMBS - 1 - j) / 2; ++i) muldbladd3(d0, d1, d2, in_out.limbs[i + j + 1], in_out.limbs[LIMBS - 1 - i]);\n+        if ((j + 1) & 1) muladd3(d0, d1, d2, in_out.limbs[(LIMBS - 1 - j) / 2 + j + 1], in_out.limbs[LIMBS - 1 - (LIMBS - 1 - j) / 2]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < (j + 1) / 2; ++i) muldbladd3(c0, c1, c2, in_out.limbs[i], in_out.limbs[j - i]);\n+        if ((j + 1) & 1) muladd3(c0, c1, c2, in_out.limbs[(j + 1) / 2], in_out.limbs[j - (j + 1) / 2]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+\n+    limb_t c2 = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r509145379",
      "id" : 509145379,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTE0NTM3OQ==",
      "original_commit_id" : "96a8d80f7ba43fd608984543d6bc6905f696529f",
      "original_line" : 188,
      "original_position" : 188,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 513482761,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509145379",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r509149688"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509149688"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That's almost exactly a 4x speedup for add and >5x speedup for div. Seems worthwhile!",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-21T09:59:37Z",
      "diff_hunk" : "@@ -0,0 +1,97 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+\n+#include <stdint.h>\n+\n+struct Num3072 {\n+#ifdef HAVE___INT128",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r509149688",
      "id" : 509149688,
      "in_reply_to_id" : 507173583,
      "line" : 26,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTE0OTY4OA==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 26,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : 26,
      "pull_request_review_id" : 513482761,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509149688",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r509153295"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509153295"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Change this to `MuHashMul()`?",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-21T10:05:12Z",
      "diff_hunk" : "@@ -105,6 +106,70 @@ static void FastRandom_1bit(benchmark::Bench& bench)\n     });\n }\n \n+static void MuHash(benchmark::Bench& bench)\n+{\n+    FastRandomContext rng(true);\n+    MuHash3072 acc;\n+    unsigned char key[32] = {0};\n+    int i = 0;\n+    bench.run([&] {\n+        key[0] = ++i;\n+        acc *= MuHash3072(key);\n+    });\n+}\n+\n+static void MuHashAdd(benchmark::Bench& bench)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r509153295",
      "id" : 509153295,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTE1MzI5NQ==",
      "original_commit_id" : "96a8d80f7ba43fd608984543d6bc6905f696529f",
      "original_line" : 121,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/bench/crypto_hash.cpp",
      "position" : null,
      "pull_request_review_id" : 513482761,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509153295",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r509153543"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509153543"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`rng` is unused. Remove it.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-21T10:05:37Z",
      "diff_hunk" : "@@ -105,6 +106,70 @@ static void FastRandom_1bit(benchmark::Bench& bench)\n     });\n }\n \n+static void MuHash(benchmark::Bench& bench)\n+{\n+    FastRandomContext rng(true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r509153543",
      "id" : 509153543,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTE1MzU0Mw==",
      "original_commit_id" : "96a8d80f7ba43fd608984543d6bc6905f696529f",
      "original_line" : 111,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/bench/crypto_hash.cpp",
      "position" : null,
      "pull_request_review_id" : 513482761,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509153543",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r509155449"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509155449"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think this is needed. There's nothing wrong with dividing by elements that aren't in the muhash.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-21T10:08:51Z",
      "diff_hunk" : "@@ -105,6 +106,70 @@ static void FastRandom_1bit(benchmark::Bench& bench)\n     });\n }\n \n+static void MuHash(benchmark::Bench& bench)\n+{\n+    FastRandomContext rng(true);\n+    MuHash3072 acc;\n+    unsigned char key[32] = {0};\n+    int i = 0;\n+    bench.run([&] {\n+        key[0] = ++i;\n+        acc *= MuHash3072(key);\n+    });\n+}\n+\n+static void MuHashAdd(benchmark::Bench& bench)\n+{\n+    FastRandomContext rng(true);\n+    MuHash3072 acc;\n+    unsigned char key[32];\n+    std::vector<unsigned char> randkey = rng.randbytes(32);\n+    for (size_t i = 0; i < randkey.size(); ++i) {\n+        key[i] = randkey[i];\n+    }\n+\n+    MuHash3072 muhash = MuHash3072(key);\n+    bench.run([&] {\n+        acc *= muhash;\n+    });\n+}\n+\n+static void MuHashDiv(benchmark::Bench& bench)\n+{\n+    FastRandomContext rng(true);\n+    MuHash3072 acc;\n+    unsigned char key[32];\n+    std::vector<unsigned char> randkey = rng.randbytes(32);\n+    for (size_t i = 0; i < randkey.size(); ++i) {\n+        key[i] = randkey[i];\n+    }\n+\n+    MuHash3072 muhash = MuHash3072(key);\n+\n+    for (size_t i = 0; i < bench.epochIterations(); ++i) {\n+        acc *= muhash;\n+    }\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r509155449",
      "id" : 509155449,
      "line" : 140,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTE1NTQ0OQ==",
      "original_commit_id" : "96a8d80f7ba43fd608984543d6bc6905f696529f",
      "original_line" : 140,
      "original_position" : 55,
      "original_start_line" : 149,
      "path" : "src/bench/crypto_hash.cpp",
      "position" : 43,
      "pull_request_review_id" : 513482761,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : 137,
      "start_side" : "RIGHT",
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509155449",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r509161865"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509161865"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The temporary array and vector variables are unnecessary here. The MuHash constructor takes a span, so we can just call it directly with the rvalue vector from randbytes().\r\n\r\n```suggestion\r\n    MuHash3072 acc;\r\n    FastRandomContext rng(true);\r\n    MuHash3072 muhash{rng.randbytes(32)};\r\n\r\n```\r\n\r\nSame in the other functions below.\r\n",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-21T10:19:32Z",
      "diff_hunk" : "@@ -105,6 +106,70 @@ static void FastRandom_1bit(benchmark::Bench& bench)\n     });\n }\n \n+static void MuHash(benchmark::Bench& bench)\n+{\n+    FastRandomContext rng(true);\n+    MuHash3072 acc;\n+    unsigned char key[32] = {0};\n+    int i = 0;\n+    bench.run([&] {\n+        key[0] = ++i;\n+        acc *= MuHash3072(key);\n+    });\n+}\n+\n+static void MuHashAdd(benchmark::Bench& bench)\n+{\n+    FastRandomContext rng(true);\n+    MuHash3072 acc;\n+    unsigned char key[32];\n+    std::vector<unsigned char> randkey = rng.randbytes(32);\n+    for (size_t i = 0; i < randkey.size(); ++i) {\n+        key[i] = randkey[i];\n+    }\n+\n+    MuHash3072 muhash = MuHash3072(key);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r509161865",
      "id" : 509161865,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTE2MTg2NQ==",
      "original_commit_id" : "96a8d80f7ba43fd608984543d6bc6905f696529f",
      "original_line" : 131,
      "original_position" : 34,
      "original_start_line" : 123,
      "path" : "src/bench/crypto_hash.cpp",
      "position" : null,
      "pull_request_review_id" : 513482761,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509161865",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r509163922"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509163922"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Again, this isn't actually overflowing the data type in MuHash. It's simply reducing a number greater than the group order into its least residue. Consider renaming this function/class.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-21T10:23:00Z",
      "diff_hunk" : "@@ -857,4 +859,88 @@ BOOST_AUTO_TEST_CASE(sha3_256_tests)\n     TestSHA3_256(\"72c57c359e10684d0517e46653a02d18d29eff803eb009e4d5eb9e95add9ad1a4ac1f38a70296f3a369a16985ca3c957de2084cdc9bdd8994eb59b8815e0debad4ec1f001feac089820db8becdaf896aaf95721e8674e5d476b43bd2b873a7d135cd685f545b438210f9319e4dcd55986c85303c1ddf18dc746fe63a409df0a998ed376eb683e16c09e6e9018504152b3e7628ef350659fb716e058a5263a18823d2f2f6ee6a8091945a48ae1c5cb1694cf2c1fe76ef9177953afe8899cfa2b7fe0603bfa3180937dadfb66fbbdd119bbf8063338aa4a699075a3bfdbae8db7e5211d0917e9665a702fc9b0a0a901d08bea97654162d82a9f05622b060b634244779c33427eb7a29353a5f48b07cbefa72f3622ac5900bef77b71d6b314296f304c8426f451f32049b1f6af156a9dab702e8907d3cd72bb2c50493f4d593e731b285b70c803b74825b3524cda3205a8897106615260ac93c01c5ec14f5b11127783989d1824527e99e04f6a340e827b559f24db9292fcdd354838f9339a5fa1d7f6b2087f04835828b13463dd40927866f16ae33ed501ec0e6c4e63948768c5aeea3e4f6754985954bea7d61088c44430204ef491b74a64bde1358cecb2cad28ee6a3de5b752ff6a051104d88478653339457ac45ba44cbb65f54d1969d047cda746931d5e6a8b48e211416aefd5729f3d60b56b54e7f85aa2f42de3cb69419240c24e67139a11790a709edef2ac52cf35dd0a08af45926ebe9761f498ff83bfe263d6897ee97943a4b982fe3404ef0b4a45e06113c60340e0664f14799bf59cb4b3934b465fabefd87155905ee5309ba41e9e402973311831ea600b16437f71df39ee77130490c4d0227e5d1757fdc66af3ae6b9953053ed9aafca0160209858a7d4dd38fe10e0cb153672d08633ed6c54977aa0a6e67f9ff2f8c9d22dd7b21de08192960fd0e0da68d77c8d810db11dcaa61c725cd4092cbff76c8e1debd8d0361bb3f2e607911d45716f53067bdc0d89dd4889177765166a424e9fc0cb711201099dda213355e6639ac7eb86eca2ae0ab38b7f674f37ef8a6fcca1a6f52f55d9e1dcd631d2c3c82bba129172feb991d5af51afecd9d61a88b6832e4107480e392aed61a8644f551665ebff6b20953b635737a4f895e429fddcfe801f606fbda74b3bf6f5767d0fac14907fcfd0aa1d4c11b9e91b01d68052399b51a29f1ae6acd965109977c14a555cbcbd21ad8cb9f8853506d4bc21c01e62d61d7b21be1b923be54914e6b0a7ca84dd11f1159193e1184568a6134a6bbadf5b4df986edcf2019390ae841cfaa44435e28ce877d3dae4177992fa5d4e5c005876dbe3d1e63bec7dcc0942762b48b1ecc6c1a918409a8a72812a1e245c0c67be6e729c2b49bc6ee4d24a8f63e78e75db45655c26a9a78aff36fcd67117f26b8f654dca664b9f0e30681874cb749e1a692720078856286c2560b0292cc837933423147569350955c9571bf8941ba128fd339cb4268f46b94bc6ee203eb7026813706ea51c4f24c91866fc23a724bf2501327e6ae89c29f8db315dc28d2c7c719514036367e018f4835f63fdecd71f9bdced7132b6c4f8b13c69a517026fcd3622d67cb632320d5e7308f78f4b7cea11f6291b137851dc6cd6366f2785c71c3f237f81a7658b2a8d512b61e0ad5a4710b7b124151689fcb2116063fbff7e9115fed7b93de834970b838e49f8f8ba5f1f874c354078b5810a55ae289a56da563f1da6cd80a3757d6073fa55e016e45ac6cec1f69d871c92fd0ae9670c74249045e6b464787f9504128736309fed205f8df4d90e332908581298d9c75a3fa36ab0c3c9272e62de53ab290c803d67b696fd615c260a47bffad16746f18ba1a10a061bacbea9369693b3c042eec36bed289d7d12e52bca8aa1c2dff88ca7816498d25626d0f1e106ebb0b4a12138e00f3df5b1c2f49d98b1756e69b641b7c6353d99dbff050f4d76842c6cf1c2a4b062fc8e6336fa689b7c9d5c6b4ab8c15a5c20e514ff070a602d85ae52fa7810c22f8eeffd34a095b93342144f7a98d024216b3d68ed7bea047517bfcd83ec83febd1ba0e5858e2bdc1d8b1f7b0f89e90ccc432a3f930cb8209462e64556c5054c56ca2a85f16b32eb83a10459d13516faa4d23302b7607b9bd38dab2239ac9e9440c314433fdfb3ceadab4b4f87415ed6f240e017221f3b5f7ac196cdf54957bec42fe6893994b46de3d27dc7fb58ca88feb5b9e79cf20053d12530ac524337b22a3629bea52f40b06d3e2128f32060f9105847daed81d35f20e2002817434659baff64494c5b5c7f9216bfda38412a0f70511159dc73bb6bae1f8eaa0ef08d99bcb31f94f6be12c29c83df45926430b366c99fca3270c15fc4056398fdf3135b7779e3066a006961d1ac0ad1c83179ce39e87a96b722ec23aabc065badf3e188347a360772ca6a447abac7e6a44f0d4632d52926332e44a0a86bff5ce699fd063bdda3ffd4c41b53ded49fecec67f40599b934e16e3fd1bc063ad7026f8d71bfd4cbaf56599586774723194b692036f1b6bb242e2ffb9c600b5215b412764599476ce475c9e5b396fbcebd6be323dcf4d0048077400aac7500db41dc95fc7f7edbe7c9c2ec5ea89943fe13b42217eef530bbd023671509e12dfce4e1c1c82955d965e6a68aa66f6967dba48feda572db1f099d9a6dc4bc8edade852b5e824a06890dc48a6a6510ecaf8cf7620d757290e3166d431abecc624fa9ac2234d2eb783308ead45544910c633a94964b2ef5fbc409cb8835ac4147d384e12e0a5e13951f7de0ee13eafcb0ca0c04946d7804040c0a3cd088352424b097adb7aad1ca4495952f3e6c0158c02d2bcec33bfda69301434a84d9027ce02c0b9725dad118\", \"d894b86261436362e64241e61f6b3e6589daf64dc641f60570c4c0bf3b1f2ca3\");\n }\n \n+static MuHash3072 FromInt(unsigned char i) {\n+    unsigned char tmp[32] = {i, 0};\n+    return MuHash3072(tmp);\n+}\n+\n+BOOST_AUTO_TEST_CASE(muhash_tests)\n+{\n+    unsigned char out[384];\n+\n+    for (int iter = 0; iter < 10; ++iter) {\n+        unsigned char res[384];\n+        int table[4];\n+        for (int i = 0; i < 4; ++i) {\n+            table[i] = g_insecure_rand_ctx.randbits(3);\n+        }\n+        for (int order = 0; order < 4; ++order) {\n+            MuHash3072 acc;\n+            for (int i = 0; i < 4; ++i) {\n+                int t = table[i ^ order];\n+                if (t & 4) {\n+                    acc /= FromInt(t & 3);\n+                } else {\n+                    acc *= FromInt(t & 3);\n+                }\n+            }\n+            acc.Finalize(out);\n+            if (order == 0) {\n+                memcpy(res, out, 384);\n+            } else {\n+                BOOST_CHECK(memcmp(res, out, 384) == 0);\n+            }\n+        }\n+\n+        MuHash3072 x = FromInt(g_insecure_rand_ctx.randbits(4)); // x=X\n+        MuHash3072 y = FromInt(g_insecure_rand_ctx.randbits(4)); // x=X, y=Y\n+        MuHash3072 z; // x=X, y=Y, z=1\n+        z *= x; // x=X, y=Y, z=X\n+        z *= y; // x=X, y=Y, z=X*Y\n+        y *= x; // x=X, y=Y*X, z=X*Y\n+        z /= y; // x=X, y=Y*X, z=1\n+        z.Finalize(out);\n+        for (int i = 0; i < 384; ++i) {\n+            BOOST_CHECK_EQUAL(out[i], i == 0);\n+        }\n+    }\n+\n+    MuHash3072 acc = FromInt(0);\n+    acc *= FromInt(1);\n+    acc /= FromInt(2);\n+    acc.Finalize(out);\n+    uint256 x = (CHashWriter(SER_DISK, 0) << out).GetSHA256();\n+    BOOST_CHECK(x == uint256S(\"a44e16d5e34d259b349af21c06e65d653915d2e208e4e03f389af750dc0bfdc3\"));\n+\n+    // Test MuHash3072 serialization\n+    MuHash3072 serchk = FromInt(1); serchk *= FromInt(2);\n+    std::string ser_exp = \"ad5d5a19c789b21f95f9c2a09f264f8aab4ef29ca30824f7330a8c3f4c61c25a6035bc27476ade3a38f2f2bc576bfbeabdf69641a91b99631ef904d37103eff744129842b1fd83158db6466ab4b752278f04add175a7a41ab8ea1305f66855068730dd3baf1ad29d6e13c7ba3350864a8f96e2e9e5c1ca65e11ab3e361184213a3fb395ac5c86efe3997c671cc5d46df3e1b2f00bf09120ae252a0e985b2452be64d5f626c0bc03747355d91ff2aa31ea4087797b91c80af5003d4b3a2ba5c34cd4a8785712897cd2331bac1b749e4fe9d17a5bb68395e2571d1759dceb5609dfae38ec6186e8c2eb22ffeb9bb8330083ee15d4b816e117e6bc1399c707b3e9d01ae74d2f589d6eb8e9e58c572088476e0444e3dbc05c95867acdb7c18be551e0eb2189d3c39dd86dbc844dc70ac33f9328be9e3b0d792bb359498f5fb385e2d8a8e3a5cde7e3e4e8ba123d3e1eda0b859d3a56e548dd6d23a03ce82e01493f96a67abd3109f9f4315c966f8cba311d71899c04a7fd9618ed028580ffcd21263\";\n+    CDataStream ss_chk(SER_DISK, PROTOCOL_VERSION);\n+    ss_chk << serchk;\n+    BOOST_CHECK_EQUAL(ser_exp, HexStr(ss_chk.str()));\n+\n+    // Test MuHash3072 deserialization\n+    MuHash3072 deserchk;\n+    ss_chk >> deserchk;\n+    unsigned char out2[384];\n+    serchk.Finalize(out);\n+    deserchk.Finalize(out2);\n+    BOOST_CHECK_EQUAL(HexStr(out), HexStr(out2));\n+\n+    // Test MuHash3072 overflow\n+    class MuHashOverflow : public MuHash3072 {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r509163922",
      "id" : 509163922,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTE2MzkyMg==",
      "original_commit_id" : "96a8d80f7ba43fd608984543d6bc6905f696529f",
      "original_line" : 933,
      "original_position" : 83,
      "original_start_line" : 930,
      "path" : "src/test/crypto_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 513482761,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509163922",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r509396869"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509396869"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Initally yes, should be done now.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-21T15:42:24Z",
      "diff_hunk" : "@@ -0,0 +1,310 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+static constexpr size_t INPUT_SIZE = 32;\n+static constexpr size_t OUTPUT_SIZE = 384;\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r509396869",
      "id" : 509396869,
      "in_reply_to_id" : 507593683,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM5Njg2OQ==",
      "original_commit_id" : "b03e923c534a954edfdd9ef4ec9a68e5dd08d827",
      "original_line" : 87,
      "original_position" : 87,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 513830820,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509396869",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Did a fair amount of testing and review of this on May 27 and plan to re-review after the 0.21 branch-off. ",
      "created_at" : "2020-10-21T16:01:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-713682094",
      "id" : 713682094,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxMzY4MjA5NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-21T16:01:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/713682094",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r509469267"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509469267"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hm, we use the same \"overflow\" terminology in secp256k1. The idea is that Num3072 represents a number in the range 0 to group order, so when it's larger it has overflown this range. (Idk, this may be a matter of taste...)\r\n\r\n\"IsReduceable()\" sounds also confusing to me. You can reduce a reduced number, it just won't change.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-21T17:21:47Z",
      "diff_hunk" : "@@ -0,0 +1,303 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <cassert>\n+#include <cstdio>\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+constexpr size_t INPUT_SIZE = 32;\n+constexpr size_t OUTPUT_SIZE = 384;\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    limb_t th = t >> LIMB_SIZE;\n+    limb_t tl = t;\n+\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    limb_t th = t >> LIMB_SIZE;\n+    limb_t tl = t;\n+\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, const limb_t& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072& d)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r509469267",
      "id" : 509469267,
      "in_reply_to_id" : 509130310,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTQ2OTI2Nw==",
      "original_commit_id" : "96a8d80f7ba43fd608984543d6bc6905f696529f",
      "original_line" : 119,
      "original_position" : 119,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 513994729,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509469267",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1071625?v=4",
         "events_url" : "https://api.github.com/users/real-or-random/events{/privacy}",
         "followers_url" : "https://api.github.com/users/real-or-random/followers",
         "following_url" : "https://api.github.com/users/real-or-random/following{/other_user}",
         "gists_url" : "https://api.github.com/users/real-or-random/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/real-or-random",
         "id" : 1071625,
         "login" : "real-or-random",
         "node_id" : "MDQ6VXNlcjEwNzE2MjU=",
         "organizations_url" : "https://api.github.com/users/real-or-random/orgs",
         "received_events_url" : "https://api.github.com/users/real-or-random/received_events",
         "repos_url" : "https://api.github.com/users/real-or-random/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/real-or-random/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/real-or-random/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/real-or-random"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r509602615"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509602615"
         }
      },
      "author_association" : "MEMBER",
      "body" : "s/order of the group/modulus/\r\n\r\n(the order of the group is 2^3072 - 1103717 - 1, since 0 isn't in the multiplicative group)",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-21T19:17:16Z",
      "diff_hunk" : "@@ -0,0 +1,303 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <cassert>\n+#include <cstdio>\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the largest 3072-bit safe prime number, is used as the order of the group. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r509602615",
      "id" : 509602615,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTYwMjYxNQ==",
      "original_commit_id" : "96a8d80f7ba43fd608984543d6bc6905f696529f",
      "original_line" : 16,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 514102355,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509602615",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r509942735"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509942735"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah, I didn't realise that 'overflow' was the terminology used for \"d is larger than the modulus\". I suppose `IsNotLeastResidue()` would be most accurate, but as long as the terminology overflow is used consistently, I think just a comment is enough here.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-22T07:37:01Z",
      "diff_hunk" : "@@ -0,0 +1,303 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <cassert>\n+#include <cstdio>\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+constexpr size_t INPUT_SIZE = 32;\n+constexpr size_t OUTPUT_SIZE = 384;\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    limb_t th = t >> LIMB_SIZE;\n+    limb_t tl = t;\n+\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    limb_t th = t >> LIMB_SIZE;\n+    limb_t tl = t;\n+\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, const limb_t& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072& d)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r509942735",
      "id" : 509942735,
      "in_reply_to_id" : 509130310,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk0MjczNQ==",
      "original_commit_id" : "96a8d80f7ba43fd608984543d6bc6905f696529f",
      "original_line" : 119,
      "original_position" : 119,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 514438343,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509942735",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r510232044"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510232044"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This does seem like a strange interface: both high-level (the user doesn't need to know/worry about the chacha20 operation) and low-level (the user needs to apply a truncated SHA-512 to all inputs, track numerator and denominator when doing a bulk update, and SHA256 the finalized 3072-bit output). I think it makes sense to refactor this so that there are two classes:\r\n\r\n- a Num3072 class that is simply a 3072 bit wide integer that supports setting and reading limbs and multiplication/division modulo p.\r\n- a MuHash3072 class that internally has a numerator and denominator, accepts arbitrary length inputs, supports set addition/subraction, and finalizes to a 256 bit digest.\r\n\r\nSee https://bitcoincore.reviews/19055-2#l-159.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-22T14:58:12Z",
      "diff_hunk" : "@@ -0,0 +1,91 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+\n+#include <stdint.h>\n+\n+struct Num3072 {\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_t;\n+    typedef uint64_t limb_t;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_t;\n+    typedef uint32_t limb_t;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_t limbs[LIMBS];\n+};\n+\n+/** A class representing MuHash sets\n+ *\n+ * MuHash is a hashing algorithm that supports adding set elements in any\n+ * order but also deleting in any order. As a result, it can maintain a\n+ * running sum for a set of data as a whole, and add/subtract when data\n+ * is added to or removed from it. A downside of MuHash is that computing\n+ * an inverse is relatively expensive. This can be solved by representing\n+ * the running value as a fraction, and multiplying added elements into\n+ * the numerator and removed elements into the denominator. Only when the\n+ * final hash is desired, a single modular inverse and multiplication is\n+ * needed to combine the two.\n+ *\n+ * TODO: Represent running value as a fraction to allow for more intuitive\n+ * use (see above).\n+ *\n+ * As the update operations are also associative, H(a)+H(b)+H(c)+H(d) can\n+ * in fact be computed as (H(a)+H(b)) + (H(c)+H(d)). This implies that\n+ * all of this is perfectly parallellizable: each thread can process an\n+ * arbitrary subset of the update operations, allowing them to be\n+ * efficiently combined later.\n+ *\n+ * Muhash does not support checking if an element is already part of the\n+ * set. That is why this class does not enforce the use of a set as the\n+ * data it represents because there is no efficient way to do so.\n+ * It is possible to add elements more than once and also to remove\n+ * elements that have not been added before. However, this implementation\n+ * is intended to represent a set of elements.\n+ *\n+ * See also https://cseweb.ucsd.edu/~mihir/papers/inchash.pdf and\n+ * https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014337.html.\n+ */\n+class MuHash3072",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r510232044",
      "id" : 510232044,
      "line" : 91,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIzMjA0NA==",
      "original_commit_id" : "96a8d80f7ba43fd608984543d6bc6905f696529f",
      "original_line" : 91,
      "original_position" : 62,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : 91,
      "pull_request_review_id" : 514823186,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510232044",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r510265495"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510265495"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "FWIW the \"real span\" can do `std::span<const uint8_t, 32>` to force the size possibly at compile time.\r\n(maybe we should look into extending our span impl to support that)",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-22T15:42:24Z",
      "diff_hunk" : "@@ -0,0 +1,91 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+\n+#include <stdint.h>\n+\n+struct Num3072 {\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_t;\n+    typedef uint64_t limb_t;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_t;\n+    typedef uint32_t limb_t;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_t limbs[LIMBS];\n+};\n+\n+/** A class representing MuHash sets\n+ *\n+ * MuHash is a hashing algorithm that supports adding set elements in any\n+ * order but also deleting in any order. As a result, it can maintain a\n+ * running sum for a set of data as a whole, and add/subtract when data\n+ * is added to or removed from it. A downside of MuHash is that computing\n+ * an inverse is relatively expensive. This can be solved by representing\n+ * the running value as a fraction, and multiplying added elements into\n+ * the numerator and removed elements into the denominator. Only when the\n+ * final hash is desired, a single modular inverse and multiplication is\n+ * needed to combine the two.\n+ *\n+ * TODO: Represent running value as a fraction to allow for more intuitive\n+ * use (see above).\n+ *\n+ * As the update operations are also associative, H(a)+H(b)+H(c)+H(d) can\n+ * in fact be computed as (H(a)+H(b)) + (H(c)+H(d)). This implies that\n+ * all of this is perfectly parallellizable: each thread can process an\n+ * arbitrary subset of the update operations, allowing them to be\n+ * efficiently combined later.\n+ *\n+ * Muhash does not support checking if an element is already part of the\n+ * set. That is why this class does not enforce the use of a set as the\n+ * data it represents because there is no efficient way to do so.\n+ * It is possible to add elements more than once and also to remove\n+ * elements that have not been added before. However, this implementation\n+ * is intended to represent a set of elements.\n+ *\n+ * See also https://cseweb.ucsd.edu/~mihir/papers/inchash.pdf and\n+ * https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014337.html.\n+ */\n+class MuHash3072\n+{\n+protected:\n+    Num3072 m_data;\n+\n+public:\n+    /* The empty set. */\n+    MuHash3072() noexcept;\n+\n+    /* A singleton with a single 32-byte key in it. */\n+    explicit MuHash3072(Span<const unsigned char> key32) noexcept;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r510265495",
      "id" : 510265495,
      "in_reply_to_id" : 507832149,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI2NTQ5NQ==",
      "original_commit_id" : "b03e923c534a954edfdd9ef4ec9a68e5dd08d827",
      "original_line" : 72,
      "original_position" : 72,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : null,
      "pull_request_review_id" : 514867918,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510265495",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2167860?v=4",
         "events_url" : "https://api.github.com/users/elichai/events{/privacy}",
         "followers_url" : "https://api.github.com/users/elichai/followers",
         "following_url" : "https://api.github.com/users/elichai/following{/other_user}",
         "gists_url" : "https://api.github.com/users/elichai/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/elichai",
         "id" : 2167860,
         "login" : "elichai",
         "node_id" : "MDQ6VXNlcjIxNjc4NjA=",
         "organizations_url" : "https://api.github.com/users/elichai/orgs",
         "received_events_url" : "https://api.github.com/users/elichai/received_events",
         "repos_url" : "https://api.github.com/users/elichai/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/elichai/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/elichai/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/elichai"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r510267390"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510267390"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "@sipa When safegcd? ;)",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-22T15:44:58Z",
      "diff_hunk" : "@@ -0,0 +1,304 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+    {\n+        double_limb_t t = (double_limb_t)a * b;\n+        th = t >> LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+    {\n+        double_limb_t t = (double_limb_t)a * b;\n+        th = t >> LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, limb_t& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072* d)\n+{\n+    if (d->limbs[0] <= std::numeric_limits<limb_t>::max() - MAX_PRIME_DIFF) return false;\n+    for (int i = 1; i < LIMBS; ++i) {\n+        if (d->limbs[i] != std::numeric_limits<limb_t>::max()) return false;\n+    }\n+    return true;\n+}\n+\n+void FullReduce(Num3072* d)\n+{\n+    limb_t c0 = MAX_PRIME_DIFF;\n+    for (int i = 0; i < LIMBS; ++i) {\n+        limb_t c1 = 0;\n+        add2(c0, c1, d->limbs[i]);\n+        extract2(c0, c1, d->limbs[i]);\n+    }\n+}\n+\n+void Multiply(Num3072* in_out, const Num3072* a)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*a into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        mul(d0, d1, in_out->limbs[1 + j], a->limbs[LIMBS + j - (1 + j)]);\n+        for (int i = 2 + j; i < LIMBS; ++i) muladd3(d0, d1, d2, in_out->limbs[i], a->limbs[LIMBS + j - i]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < j + 1; ++i) muladd3(c0, c1, c2, in_out->limbs[i], a->limbs[j - i]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    /* Compute limb N-1 of a*b into tmp. */\n+    {\n+        limb_t c2 = 0;\n+        for (int i = 0; i < LIMBS; ++i) muladd3(c0, c1, c2, in_out->limbs[i], a->limbs[LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out->limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Square(Num3072* in_out)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*in_out into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        for (int i = 0; i < (LIMBS - 1 - j) / 2; ++i) muldbladd3(d0, d1, d2, in_out->limbs[i + j + 1], in_out->limbs[LIMBS - 1 - i]);\n+        if ((j + 1) & 1) muladd3(d0, d1, d2, in_out->limbs[(LIMBS - 1 - j) / 2 + j + 1], in_out->limbs[LIMBS - 1 - (LIMBS - 1 - j) / 2]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < (j + 1) / 2; ++i) muldbladd3(c0, c1, c2, in_out->limbs[i], in_out->limbs[j - i]);\n+        if ((j + 1) & 1) muladd3(c0, c1, c2, in_out->limbs[(j + 1) / 2], in_out->limbs[j - (j + 1) / 2]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    {\n+        limb_t c2 = 0;\n+        for (int i = 0; i < LIMBS / 2; ++i) muldbladd3(c0, c1, c2, in_out->limbs[i], in_out->limbs[LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out->limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Inverse(Num3072* out, const Num3072* a)\n+{\n+    // For fast exponentiation a sliding window exponentiation with repunit\n+    // precomputation is utilized. See \"Fast Point Decompression for Standard\n+    // Elliptic Curves\" (Brumley, JÃ¤rvinen, 2008).",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r510267390",
      "id" : 510267390,
      "in_reply_to_id" : 492832419,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI2NzM5MA==",
      "original_commit_id" : "ef53ca76cc616cd359969533a75c3dab388ec38d",
      "original_line" : 210,
      "original_position" : 210,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 514870425,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510267390",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2167860?v=4",
         "events_url" : "https://api.github.com/users/elichai/events{/privacy}",
         "followers_url" : "https://api.github.com/users/elichai/followers",
         "following_url" : "https://api.github.com/users/elichai/following{/other_user}",
         "gists_url" : "https://api.github.com/users/elichai/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/elichai",
         "id" : 2167860,
         "login" : "elichai",
         "node_id" : "MDQ6VXNlcjIxNjc4NjA=",
         "organizations_url" : "https://api.github.com/users/elichai/orgs",
         "received_events_url" : "https://api.github.com/users/elichai/received_events",
         "repos_url" : "https://api.github.com/users/elichai/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/elichai/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/elichai/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/elichai"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r510278063"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510278063"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The paper if anyone wants: https://sci-hub.do/10.1007/978-3-540-69485-4_10\r\nas for the technique AFAIU(didn't review the actual code here) it's simply fermat little theorem (a^p-2=1/a) together with a simple square-and-multiply algorithm (in elliptic curves it's called double-and-add) \r\nGood references:\r\nhttps://en.wikipedia.org/wiki/Exponentiation_by_squaring\r\nhttps://briansmith.org/ecc-inversion-addition-chains-01",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-22T15:59:12Z",
      "diff_hunk" : "@@ -0,0 +1,304 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+    {\n+        double_limb_t t = (double_limb_t)a * b;\n+        th = t >> LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+    {\n+        double_limb_t t = (double_limb_t)a * b;\n+        th = t >> LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, limb_t& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072* d)\n+{\n+    if (d->limbs[0] <= std::numeric_limits<limb_t>::max() - MAX_PRIME_DIFF) return false;\n+    for (int i = 1; i < LIMBS; ++i) {\n+        if (d->limbs[i] != std::numeric_limits<limb_t>::max()) return false;\n+    }\n+    return true;\n+}\n+\n+void FullReduce(Num3072* d)\n+{\n+    limb_t c0 = MAX_PRIME_DIFF;\n+    for (int i = 0; i < LIMBS; ++i) {\n+        limb_t c1 = 0;\n+        add2(c0, c1, d->limbs[i]);\n+        extract2(c0, c1, d->limbs[i]);\n+    }\n+}\n+\n+void Multiply(Num3072* in_out, const Num3072* a)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*a into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        mul(d0, d1, in_out->limbs[1 + j], a->limbs[LIMBS + j - (1 + j)]);\n+        for (int i = 2 + j; i < LIMBS; ++i) muladd3(d0, d1, d2, in_out->limbs[i], a->limbs[LIMBS + j - i]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < j + 1; ++i) muladd3(c0, c1, c2, in_out->limbs[i], a->limbs[j - i]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    /* Compute limb N-1 of a*b into tmp. */\n+    {\n+        limb_t c2 = 0;\n+        for (int i = 0; i < LIMBS; ++i) muladd3(c0, c1, c2, in_out->limbs[i], a->limbs[LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out->limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Square(Num3072* in_out)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*in_out into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        for (int i = 0; i < (LIMBS - 1 - j) / 2; ++i) muldbladd3(d0, d1, d2, in_out->limbs[i + j + 1], in_out->limbs[LIMBS - 1 - i]);\n+        if ((j + 1) & 1) muladd3(d0, d1, d2, in_out->limbs[(LIMBS - 1 - j) / 2 + j + 1], in_out->limbs[LIMBS - 1 - (LIMBS - 1 - j) / 2]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < (j + 1) / 2; ++i) muldbladd3(c0, c1, c2, in_out->limbs[i], in_out->limbs[j - i]);\n+        if ((j + 1) & 1) muladd3(c0, c1, c2, in_out->limbs[(j + 1) / 2], in_out->limbs[j - (j + 1) / 2]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    {\n+        limb_t c2 = 0;\n+        for (int i = 0; i < LIMBS / 2; ++i) muldbladd3(c0, c1, c2, in_out->limbs[i], in_out->limbs[LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out->limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Inverse(Num3072* out, const Num3072* a)\n+{\n+    // For fast exponentiation a sliding window exponentiation with repunit\n+    // precomputation is utilized. See \"Fast Point Decompression for Standard\n+    // Elliptic Curves\" (Brumley, JÃ¤rvinen, 2008).",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r510278063",
      "id" : 510278063,
      "in_reply_to_id" : 507186374,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI3ODA2Mw==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 210,
      "original_position" : 210,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 514885241,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510278063",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2167860?v=4",
         "events_url" : "https://api.github.com/users/elichai/events{/privacy}",
         "followers_url" : "https://api.github.com/users/elichai/followers",
         "following_url" : "https://api.github.com/users/elichai/following{/other_user}",
         "gists_url" : "https://api.github.com/users/elichai/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/elichai",
         "id" : 2167860,
         "login" : "elichai",
         "node_id" : "MDQ6VXNlcjIxNjc4NjA=",
         "organizations_url" : "https://api.github.com/users/elichai/orgs",
         "received_events_url" : "https://api.github.com/users/elichai/received_events",
         "repos_url" : "https://api.github.com/users/elichai/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/elichai/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/elichai/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/elichai"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r510282032"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510282032"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@elichai That's the easy part. It's specifically using a technique here to construct an efficient exponentiation ladder for an exponent with many consecutive 1s.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-22T16:04:38Z",
      "diff_hunk" : "@@ -0,0 +1,304 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+    {\n+        double_limb_t t = (double_limb_t)a * b;\n+        th = t >> LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+    {\n+        double_limb_t t = (double_limb_t)a * b;\n+        th = t >> LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, limb_t& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072* d)\n+{\n+    if (d->limbs[0] <= std::numeric_limits<limb_t>::max() - MAX_PRIME_DIFF) return false;\n+    for (int i = 1; i < LIMBS; ++i) {\n+        if (d->limbs[i] != std::numeric_limits<limb_t>::max()) return false;\n+    }\n+    return true;\n+}\n+\n+void FullReduce(Num3072* d)\n+{\n+    limb_t c0 = MAX_PRIME_DIFF;\n+    for (int i = 0; i < LIMBS; ++i) {\n+        limb_t c1 = 0;\n+        add2(c0, c1, d->limbs[i]);\n+        extract2(c0, c1, d->limbs[i]);\n+    }\n+}\n+\n+void Multiply(Num3072* in_out, const Num3072* a)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*a into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        mul(d0, d1, in_out->limbs[1 + j], a->limbs[LIMBS + j - (1 + j)]);\n+        for (int i = 2 + j; i < LIMBS; ++i) muladd3(d0, d1, d2, in_out->limbs[i], a->limbs[LIMBS + j - i]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < j + 1; ++i) muladd3(c0, c1, c2, in_out->limbs[i], a->limbs[j - i]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    /* Compute limb N-1 of a*b into tmp. */\n+    {\n+        limb_t c2 = 0;\n+        for (int i = 0; i < LIMBS; ++i) muladd3(c0, c1, c2, in_out->limbs[i], a->limbs[LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out->limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Square(Num3072* in_out)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*in_out into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        for (int i = 0; i < (LIMBS - 1 - j) / 2; ++i) muldbladd3(d0, d1, d2, in_out->limbs[i + j + 1], in_out->limbs[LIMBS - 1 - i]);\n+        if ((j + 1) & 1) muladd3(d0, d1, d2, in_out->limbs[(LIMBS - 1 - j) / 2 + j + 1], in_out->limbs[LIMBS - 1 - (LIMBS - 1 - j) / 2]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < (j + 1) / 2; ++i) muldbladd3(c0, c1, c2, in_out->limbs[i], in_out->limbs[j - i]);\n+        if ((j + 1) & 1) muladd3(c0, c1, c2, in_out->limbs[(j + 1) / 2], in_out->limbs[j - (j + 1) / 2]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    {\n+        limb_t c2 = 0;\n+        for (int i = 0; i < LIMBS / 2; ++i) muldbladd3(c0, c1, c2, in_out->limbs[i], in_out->limbs[LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out->limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Inverse(Num3072* out, const Num3072* a)\n+{\n+    // For fast exponentiation a sliding window exponentiation with repunit\n+    // precomputation is utilized. See \"Fast Point Decompression for Standard\n+    // Elliptic Curves\" (Brumley, JÃ¤rvinen, 2008).",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r510282032",
      "id" : 510282032,
      "in_reply_to_id" : 507186374,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI4MjAzMg==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 210,
      "original_position" : 210,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 514890405,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510282032",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r510283904"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510283904"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "@sipa you're right. I ignored how you came up with that specific ladder because I didn't actually review the ladder itself (ops)",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-22T16:07:23Z",
      "diff_hunk" : "@@ -0,0 +1,304 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+    {\n+        double_limb_t t = (double_limb_t)a * b;\n+        th = t >> LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+    {\n+        double_limb_t t = (double_limb_t)a * b;\n+        th = t >> LIMB_SIZE;\n+        tl = t;\n+    }\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, limb_t& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072* d)\n+{\n+    if (d->limbs[0] <= std::numeric_limits<limb_t>::max() - MAX_PRIME_DIFF) return false;\n+    for (int i = 1; i < LIMBS; ++i) {\n+        if (d->limbs[i] != std::numeric_limits<limb_t>::max()) return false;\n+    }\n+    return true;\n+}\n+\n+void FullReduce(Num3072* d)\n+{\n+    limb_t c0 = MAX_PRIME_DIFF;\n+    for (int i = 0; i < LIMBS; ++i) {\n+        limb_t c1 = 0;\n+        add2(c0, c1, d->limbs[i]);\n+        extract2(c0, c1, d->limbs[i]);\n+    }\n+}\n+\n+void Multiply(Num3072* in_out, const Num3072* a)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*a into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        mul(d0, d1, in_out->limbs[1 + j], a->limbs[LIMBS + j - (1 + j)]);\n+        for (int i = 2 + j; i < LIMBS; ++i) muladd3(d0, d1, d2, in_out->limbs[i], a->limbs[LIMBS + j - i]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < j + 1; ++i) muladd3(c0, c1, c2, in_out->limbs[i], a->limbs[j - i]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    /* Compute limb N-1 of a*b into tmp. */\n+    {\n+        limb_t c2 = 0;\n+        for (int i = 0; i < LIMBS; ++i) muladd3(c0, c1, c2, in_out->limbs[i], a->limbs[LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out->limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Square(Num3072* in_out)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*in_out into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        for (int i = 0; i < (LIMBS - 1 - j) / 2; ++i) muldbladd3(d0, d1, d2, in_out->limbs[i + j + 1], in_out->limbs[LIMBS - 1 - i]);\n+        if ((j + 1) & 1) muladd3(d0, d1, d2, in_out->limbs[(LIMBS - 1 - j) / 2 + j + 1], in_out->limbs[LIMBS - 1 - (LIMBS - 1 - j) / 2]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < (j + 1) / 2; ++i) muldbladd3(c0, c1, c2, in_out->limbs[i], in_out->limbs[j - i]);\n+        if ((j + 1) & 1) muladd3(c0, c1, c2, in_out->limbs[(j + 1) / 2], in_out->limbs[j - (j + 1) / 2]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+    {\n+        limb_t c2 = 0;\n+        for (int i = 0; i < LIMBS / 2; ++i) muldbladd3(c0, c1, c2, in_out->limbs[i], in_out->limbs[LIMBS - 1 - i]);\n+        extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+    }\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out->limbs[j]);\n+    }\n+#ifdef DEBUG\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+#endif\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Inverse(Num3072* out, const Num3072* a)\n+{\n+    // For fast exponentiation a sliding window exponentiation with repunit\n+    // precomputation is utilized. See \"Fast Point Decompression for Standard\n+    // Elliptic Curves\" (Brumley, JÃ¤rvinen, 2008).",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r510283904",
      "id" : 510283904,
      "in_reply_to_id" : 507186374,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI4MzkwNA==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 210,
      "original_position" : 210,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 514892914,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510283904",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2167860?v=4",
         "events_url" : "https://api.github.com/users/elichai/events{/privacy}",
         "followers_url" : "https://api.github.com/users/elichai/followers",
         "following_url" : "https://api.github.com/users/elichai/following{/other_user}",
         "gists_url" : "https://api.github.com/users/elichai/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/elichai",
         "id" : 2167860,
         "login" : "elichai",
         "node_id" : "MDQ6VXNlcjIxNjc4NjA=",
         "organizations_url" : "https://api.github.com/users/elichai/orgs",
         "received_events_url" : "https://api.github.com/users/elichai/received_events",
         "repos_url" : "https://api.github.com/users/elichai/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/elichai/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/elichai/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/elichai"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r510348467"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510348467"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Interesting. I wasn't aware of that. Does that mean it can't be initialized with a vector (since it's not possible to know the size at compile time)?",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-22T17:49:04Z",
      "diff_hunk" : "@@ -0,0 +1,91 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+\n+#include <stdint.h>\n+\n+struct Num3072 {\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_t;\n+    typedef uint64_t limb_t;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_t;\n+    typedef uint32_t limb_t;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_t limbs[LIMBS];\n+};\n+\n+/** A class representing MuHash sets\n+ *\n+ * MuHash is a hashing algorithm that supports adding set elements in any\n+ * order but also deleting in any order. As a result, it can maintain a\n+ * running sum for a set of data as a whole, and add/subtract when data\n+ * is added to or removed from it. A downside of MuHash is that computing\n+ * an inverse is relatively expensive. This can be solved by representing\n+ * the running value as a fraction, and multiplying added elements into\n+ * the numerator and removed elements into the denominator. Only when the\n+ * final hash is desired, a single modular inverse and multiplication is\n+ * needed to combine the two.\n+ *\n+ * TODO: Represent running value as a fraction to allow for more intuitive\n+ * use (see above).\n+ *\n+ * As the update operations are also associative, H(a)+H(b)+H(c)+H(d) can\n+ * in fact be computed as (H(a)+H(b)) + (H(c)+H(d)). This implies that\n+ * all of this is perfectly parallellizable: each thread can process an\n+ * arbitrary subset of the update operations, allowing them to be\n+ * efficiently combined later.\n+ *\n+ * Muhash does not support checking if an element is already part of the\n+ * set. That is why this class does not enforce the use of a set as the\n+ * data it represents because there is no efficient way to do so.\n+ * It is possible to add elements more than once and also to remove\n+ * elements that have not been added before. However, this implementation\n+ * is intended to represent a set of elements.\n+ *\n+ * See also https://cseweb.ucsd.edu/~mihir/papers/inchash.pdf and\n+ * https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014337.html.\n+ */\n+class MuHash3072\n+{\n+protected:\n+    Num3072 m_data;\n+\n+public:\n+    /* The empty set. */\n+    MuHash3072() noexcept;\n+\n+    /* A singleton with a single 32-byte key in it. */\n+    explicit MuHash3072(Span<const unsigned char> key32) noexcept;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r510348467",
      "id" : 510348467,
      "in_reply_to_id" : 507832149,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDM0ODQ2Nw==",
      "original_commit_id" : "b03e923c534a954edfdd9ef4ec9a68e5dd08d827",
      "original_line" : 72,
      "original_position" : 72,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : null,
      "pull_request_review_id" : 514977105,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510348467",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r510506704"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510506704"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It can, but only explicitly. So you'd be able to write `MuHash3072(std::span<const unsigned char, 32>(vec))` but not `MuHash3072(vec)`.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-22T23:07:53Z",
      "diff_hunk" : "@@ -0,0 +1,91 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+\n+#include <stdint.h>\n+\n+struct Num3072 {\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_t;\n+    typedef uint64_t limb_t;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_t;\n+    typedef uint32_t limb_t;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_t limbs[LIMBS];\n+};\n+\n+/** A class representing MuHash sets\n+ *\n+ * MuHash is a hashing algorithm that supports adding set elements in any\n+ * order but also deleting in any order. As a result, it can maintain a\n+ * running sum for a set of data as a whole, and add/subtract when data\n+ * is added to or removed from it. A downside of MuHash is that computing\n+ * an inverse is relatively expensive. This can be solved by representing\n+ * the running value as a fraction, and multiplying added elements into\n+ * the numerator and removed elements into the denominator. Only when the\n+ * final hash is desired, a single modular inverse and multiplication is\n+ * needed to combine the two.\n+ *\n+ * TODO: Represent running value as a fraction to allow for more intuitive\n+ * use (see above).\n+ *\n+ * As the update operations are also associative, H(a)+H(b)+H(c)+H(d) can\n+ * in fact be computed as (H(a)+H(b)) + (H(c)+H(d)). This implies that\n+ * all of this is perfectly parallellizable: each thread can process an\n+ * arbitrary subset of the update operations, allowing them to be\n+ * efficiently combined later.\n+ *\n+ * Muhash does not support checking if an element is already part of the\n+ * set. That is why this class does not enforce the use of a set as the\n+ * data it represents because there is no efficient way to do so.\n+ * It is possible to add elements more than once and also to remove\n+ * elements that have not been added before. However, this implementation\n+ * is intended to represent a set of elements.\n+ *\n+ * See also https://cseweb.ucsd.edu/~mihir/papers/inchash.pdf and\n+ * https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014337.html.\n+ */\n+class MuHash3072\n+{\n+protected:\n+    Num3072 m_data;\n+\n+public:\n+    /* The empty set. */\n+    MuHash3072() noexcept;\n+\n+    /* A singleton with a single 32-byte key in it. */\n+    explicit MuHash3072(Span<const unsigned char> key32) noexcept;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r510506704",
      "id" : 510506704,
      "in_reply_to_id" : 507832149,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDUwNjcwNA==",
      "original_commit_id" : "b03e923c534a954edfdd9ef4ec9a68e5dd08d827",
      "original_line" : 72,
      "original_position" : 72,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : null,
      "pull_request_review_id" : 515178981,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510506704",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r510692813"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510692813"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think I prefer that interface. It forces the client code to explicitly set the span size. Of course they can still create a span from a too-small vector, but that's a client bug rather than an unexpected assert in the library.\r\n\r\nIn any case, my recommendation would be to make the MuHash class take any stream input and do the truncated SHA512 inside the class (https://github.com/bitcoin/bitcoin/pull/19055#discussion_r510232044) which would remove the assertion on input length.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-23T07:38:19Z",
      "diff_hunk" : "@@ -0,0 +1,91 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+\n+#include <stdint.h>\n+\n+struct Num3072 {\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_t;\n+    typedef uint64_t limb_t;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_t;\n+    typedef uint32_t limb_t;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_t limbs[LIMBS];\n+};\n+\n+/** A class representing MuHash sets\n+ *\n+ * MuHash is a hashing algorithm that supports adding set elements in any\n+ * order but also deleting in any order. As a result, it can maintain a\n+ * running sum for a set of data as a whole, and add/subtract when data\n+ * is added to or removed from it. A downside of MuHash is that computing\n+ * an inverse is relatively expensive. This can be solved by representing\n+ * the running value as a fraction, and multiplying added elements into\n+ * the numerator and removed elements into the denominator. Only when the\n+ * final hash is desired, a single modular inverse and multiplication is\n+ * needed to combine the two.\n+ *\n+ * TODO: Represent running value as a fraction to allow for more intuitive\n+ * use (see above).\n+ *\n+ * As the update operations are also associative, H(a)+H(b)+H(c)+H(d) can\n+ * in fact be computed as (H(a)+H(b)) + (H(c)+H(d)). This implies that\n+ * all of this is perfectly parallellizable: each thread can process an\n+ * arbitrary subset of the update operations, allowing them to be\n+ * efficiently combined later.\n+ *\n+ * Muhash does not support checking if an element is already part of the\n+ * set. That is why this class does not enforce the use of a set as the\n+ * data it represents because there is no efficient way to do so.\n+ * It is possible to add elements more than once and also to remove\n+ * elements that have not been added before. However, this implementation\n+ * is intended to represent a set of elements.\n+ *\n+ * See also https://cseweb.ucsd.edu/~mihir/papers/inchash.pdf and\n+ * https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014337.html.\n+ */\n+class MuHash3072\n+{\n+protected:\n+    Num3072 m_data;\n+\n+public:\n+    /* The empty set. */\n+    MuHash3072() noexcept;\n+\n+    /* A singleton with a single 32-byte key in it. */\n+    explicit MuHash3072(Span<const unsigned char> key32) noexcept;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r510692813",
      "id" : 510692813,
      "in_reply_to_id" : 507832149,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY5MjgxMw==",
      "original_commit_id" : "b03e923c534a954edfdd9ef4ec9a68e5dd08d827",
      "original_line" : 72,
      "original_position" : 72,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : null,
      "pull_request_review_id" : 515415562,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510692813",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r513237387"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/513237387"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "\"multiply\" and \"divide\" (or mul/div) for the maths, and \"insert\" and \"remove\" for higher level (multi)set-like operations might make sense. \"Add\" definitely seems confusing.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-28T07:49:32Z",
      "diff_hunk" : "@@ -105,6 +106,70 @@ static void FastRandom_1bit(benchmark::Bench& bench)\n     });\n }\n \n+static void MuHash(benchmark::Bench& bench)\n+{\n+    FastRandomContext rng(true);\n+    MuHash3072 acc;\n+    unsigned char key[32] = {0};\n+    int i = 0;\n+    bench.run([&] {\n+        key[0] = ++i;\n+        acc *= MuHash3072(key);\n+    });\n+}\n+\n+static void MuHashAdd(benchmark::Bench& bench)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r513237387",
      "id" : 513237387,
      "in_reply_to_id" : 509153295,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzIzNzM4Nw==",
      "original_commit_id" : "96a8d80f7ba43fd608984543d6bc6905f696529f",
      "original_line" : 121,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/bench/crypto_hash.cpp",
      "position" : null,
      "pull_request_review_id" : 518393531,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/513237387",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r513266246"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/513266246"
         }
      },
      "author_association" : "MEMBER",
      "body" : "My preferred naming for the operations is here: https://github.com/bitcoin/bitcoin/pull/19055#discussion_r510232044 (mul/div for Num3072, add/sub for MuHash), but I mostly just want it to be consistent.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-10-28T08:42:51Z",
      "diff_hunk" : "@@ -105,6 +106,70 @@ static void FastRandom_1bit(benchmark::Bench& bench)\n     });\n }\n \n+static void MuHash(benchmark::Bench& bench)\n+{\n+    FastRandomContext rng(true);\n+    MuHash3072 acc;\n+    unsigned char key[32] = {0};\n+    int i = 0;\n+    bench.run([&] {\n+        key[0] = ++i;\n+        acc *= MuHash3072(key);\n+    });\n+}\n+\n+static void MuHashAdd(benchmark::Bench& bench)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r513266246",
      "id" : 513266246,
      "in_reply_to_id" : 509153295,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI2NjI0Ng==",
      "original_commit_id" : "96a8d80f7ba43fd608984543d6bc6905f696529f",
      "original_line" : 121,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/bench/crypto_hash.cpp",
      "position" : null,
      "pull_request_review_id" : 518430286,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/513266246",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r519485719"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519485719"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-11-08T22:25:02Z",
      "diff_hunk" : "@@ -0,0 +1,303 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <cassert>\n+#include <cstdio>\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the largest 3072-bit safe prime number, is used as the order of the group. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r519485719",
      "id" : 519485719,
      "in_reply_to_id" : 509602615,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ4NTcxOQ==",
      "original_commit_id" : "96a8d80f7ba43fd608984543d6bc6905f696529f",
      "original_line" : 16,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 525851501,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519485719",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r519485947"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519485947"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Since the overflow naming is consistent with secp256k1 I kept it but extended the comment for clarification.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-11-08T22:27:06Z",
      "diff_hunk" : "@@ -857,4 +859,88 @@ BOOST_AUTO_TEST_CASE(sha3_256_tests)\n     TestSHA3_256(\"72c57c359e10684d0517e46653a02d18d29eff803eb009e4d5eb9e95add9ad1a4ac1f38a70296f3a369a16985ca3c957de2084cdc9bdd8994eb59b8815e0debad4ec1f001feac089820db8becdaf896aaf95721e8674e5d476b43bd2b873a7d135cd685f545b438210f9319e4dcd55986c85303c1ddf18dc746fe63a409df0a998ed376eb683e16c09e6e9018504152b3e7628ef350659fb716e058a5263a18823d2f2f6ee6a8091945a48ae1c5cb1694cf2c1fe76ef9177953afe8899cfa2b7fe0603bfa3180937dadfb66fbbdd119bbf8063338aa4a699075a3bfdbae8db7e5211d0917e9665a702fc9b0a0a901d08bea97654162d82a9f05622b060b634244779c33427eb7a29353a5f48b07cbefa72f3622ac5900bef77b71d6b314296f304c8426f451f32049b1f6af156a9dab702e8907d3cd72bb2c50493f4d593e731b285b70c803b74825b3524cda3205a8897106615260ac93c01c5ec14f5b11127783989d1824527e99e04f6a340e827b559f24db9292fcdd354838f9339a5fa1d7f6b2087f04835828b13463dd40927866f16ae33ed501ec0e6c4e63948768c5aeea3e4f6754985954bea7d61088c44430204ef491b74a64bde1358cecb2cad28ee6a3de5b752ff6a051104d88478653339457ac45ba44cbb65f54d1969d047cda746931d5e6a8b48e211416aefd5729f3d60b56b54e7f85aa2f42de3cb69419240c24e67139a11790a709edef2ac52cf35dd0a08af45926ebe9761f498ff83bfe263d6897ee97943a4b982fe3404ef0b4a45e06113c60340e0664f14799bf59cb4b3934b465fabefd87155905ee5309ba41e9e402973311831ea600b16437f71df39ee77130490c4d0227e5d1757fdc66af3ae6b9953053ed9aafca0160209858a7d4dd38fe10e0cb153672d08633ed6c54977aa0a6e67f9ff2f8c9d22dd7b21de08192960fd0e0da68d77c8d810db11dcaa61c725cd4092cbff76c8e1debd8d0361bb3f2e607911d45716f53067bdc0d89dd4889177765166a424e9fc0cb711201099dda213355e6639ac7eb86eca2ae0ab38b7f674f37ef8a6fcca1a6f52f55d9e1dcd631d2c3c82bba129172feb991d5af51afecd9d61a88b6832e4107480e392aed61a8644f551665ebff6b20953b635737a4f895e429fddcfe801f606fbda74b3bf6f5767d0fac14907fcfd0aa1d4c11b9e91b01d68052399b51a29f1ae6acd965109977c14a555cbcbd21ad8cb9f8853506d4bc21c01e62d61d7b21be1b923be54914e6b0a7ca84dd11f1159193e1184568a6134a6bbadf5b4df986edcf2019390ae841cfaa44435e28ce877d3dae4177992fa5d4e5c005876dbe3d1e63bec7dcc0942762b48b1ecc6c1a918409a8a72812a1e245c0c67be6e729c2b49bc6ee4d24a8f63e78e75db45655c26a9a78aff36fcd67117f26b8f654dca664b9f0e30681874cb749e1a692720078856286c2560b0292cc837933423147569350955c9571bf8941ba128fd339cb4268f46b94bc6ee203eb7026813706ea51c4f24c91866fc23a724bf2501327e6ae89c29f8db315dc28d2c7c719514036367e018f4835f63fdecd71f9bdced7132b6c4f8b13c69a517026fcd3622d67cb632320d5e7308f78f4b7cea11f6291b137851dc6cd6366f2785c71c3f237f81a7658b2a8d512b61e0ad5a4710b7b124151689fcb2116063fbff7e9115fed7b93de834970b838e49f8f8ba5f1f874c354078b5810a55ae289a56da563f1da6cd80a3757d6073fa55e016e45ac6cec1f69d871c92fd0ae9670c74249045e6b464787f9504128736309fed205f8df4d90e332908581298d9c75a3fa36ab0c3c9272e62de53ab290c803d67b696fd615c260a47bffad16746f18ba1a10a061bacbea9369693b3c042eec36bed289d7d12e52bca8aa1c2dff88ca7816498d25626d0f1e106ebb0b4a12138e00f3df5b1c2f49d98b1756e69b641b7c6353d99dbff050f4d76842c6cf1c2a4b062fc8e6336fa689b7c9d5c6b4ab8c15a5c20e514ff070a602d85ae52fa7810c22f8eeffd34a095b93342144f7a98d024216b3d68ed7bea047517bfcd83ec83febd1ba0e5858e2bdc1d8b1f7b0f89e90ccc432a3f930cb8209462e64556c5054c56ca2a85f16b32eb83a10459d13516faa4d23302b7607b9bd38dab2239ac9e9440c314433fdfb3ceadab4b4f87415ed6f240e017221f3b5f7ac196cdf54957bec42fe6893994b46de3d27dc7fb58ca88feb5b9e79cf20053d12530ac524337b22a3629bea52f40b06d3e2128f32060f9105847daed81d35f20e2002817434659baff64494c5b5c7f9216bfda38412a0f70511159dc73bb6bae1f8eaa0ef08d99bcb31f94f6be12c29c83df45926430b366c99fca3270c15fc4056398fdf3135b7779e3066a006961d1ac0ad1c83179ce39e87a96b722ec23aabc065badf3e188347a360772ca6a447abac7e6a44f0d4632d52926332e44a0a86bff5ce699fd063bdda3ffd4c41b53ded49fecec67f40599b934e16e3fd1bc063ad7026f8d71bfd4cbaf56599586774723194b692036f1b6bb242e2ffb9c600b5215b412764599476ce475c9e5b396fbcebd6be323dcf4d0048077400aac7500db41dc95fc7f7edbe7c9c2ec5ea89943fe13b42217eef530bbd023671509e12dfce4e1c1c82955d965e6a68aa66f6967dba48feda572db1f099d9a6dc4bc8edade852b5e824a06890dc48a6a6510ecaf8cf7620d757290e3166d431abecc624fa9ac2234d2eb783308ead45544910c633a94964b2ef5fbc409cb8835ac4147d384e12e0a5e13951f7de0ee13eafcb0ca0c04946d7804040c0a3cd088352424b097adb7aad1ca4495952f3e6c0158c02d2bcec33bfda69301434a84d9027ce02c0b9725dad118\", \"d894b86261436362e64241e61f6b3e6589daf64dc641f60570c4c0bf3b1f2ca3\");\n }\n \n+static MuHash3072 FromInt(unsigned char i) {\n+    unsigned char tmp[32] = {i, 0};\n+    return MuHash3072(tmp);\n+}\n+\n+BOOST_AUTO_TEST_CASE(muhash_tests)\n+{\n+    unsigned char out[384];\n+\n+    for (int iter = 0; iter < 10; ++iter) {\n+        unsigned char res[384];\n+        int table[4];\n+        for (int i = 0; i < 4; ++i) {\n+            table[i] = g_insecure_rand_ctx.randbits(3);\n+        }\n+        for (int order = 0; order < 4; ++order) {\n+            MuHash3072 acc;\n+            for (int i = 0; i < 4; ++i) {\n+                int t = table[i ^ order];\n+                if (t & 4) {\n+                    acc /= FromInt(t & 3);\n+                } else {\n+                    acc *= FromInt(t & 3);\n+                }\n+            }\n+            acc.Finalize(out);\n+            if (order == 0) {\n+                memcpy(res, out, 384);\n+            } else {\n+                BOOST_CHECK(memcmp(res, out, 384) == 0);\n+            }\n+        }\n+\n+        MuHash3072 x = FromInt(g_insecure_rand_ctx.randbits(4)); // x=X\n+        MuHash3072 y = FromInt(g_insecure_rand_ctx.randbits(4)); // x=X, y=Y\n+        MuHash3072 z; // x=X, y=Y, z=1\n+        z *= x; // x=X, y=Y, z=X\n+        z *= y; // x=X, y=Y, z=X*Y\n+        y *= x; // x=X, y=Y*X, z=X*Y\n+        z /= y; // x=X, y=Y*X, z=1\n+        z.Finalize(out);\n+        for (int i = 0; i < 384; ++i) {\n+            BOOST_CHECK_EQUAL(out[i], i == 0);\n+        }\n+    }\n+\n+    MuHash3072 acc = FromInt(0);\n+    acc *= FromInt(1);\n+    acc /= FromInt(2);\n+    acc.Finalize(out);\n+    uint256 x = (CHashWriter(SER_DISK, 0) << out).GetSHA256();\n+    BOOST_CHECK(x == uint256S(\"a44e16d5e34d259b349af21c06e65d653915d2e208e4e03f389af750dc0bfdc3\"));\n+\n+    // Test MuHash3072 serialization\n+    MuHash3072 serchk = FromInt(1); serchk *= FromInt(2);\n+    std::string ser_exp = \"ad5d5a19c789b21f95f9c2a09f264f8aab4ef29ca30824f7330a8c3f4c61c25a6035bc27476ade3a38f2f2bc576bfbeabdf69641a91b99631ef904d37103eff744129842b1fd83158db6466ab4b752278f04add175a7a41ab8ea1305f66855068730dd3baf1ad29d6e13c7ba3350864a8f96e2e9e5c1ca65e11ab3e361184213a3fb395ac5c86efe3997c671cc5d46df3e1b2f00bf09120ae252a0e985b2452be64d5f626c0bc03747355d91ff2aa31ea4087797b91c80af5003d4b3a2ba5c34cd4a8785712897cd2331bac1b749e4fe9d17a5bb68395e2571d1759dceb5609dfae38ec6186e8c2eb22ffeb9bb8330083ee15d4b816e117e6bc1399c707b3e9d01ae74d2f589d6eb8e9e58c572088476e0444e3dbc05c95867acdb7c18be551e0eb2189d3c39dd86dbc844dc70ac33f9328be9e3b0d792bb359498f5fb385e2d8a8e3a5cde7e3e4e8ba123d3e1eda0b859d3a56e548dd6d23a03ce82e01493f96a67abd3109f9f4315c966f8cba311d71899c04a7fd9618ed028580ffcd21263\";\n+    CDataStream ss_chk(SER_DISK, PROTOCOL_VERSION);\n+    ss_chk << serchk;\n+    BOOST_CHECK_EQUAL(ser_exp, HexStr(ss_chk.str()));\n+\n+    // Test MuHash3072 deserialization\n+    MuHash3072 deserchk;\n+    ss_chk >> deserchk;\n+    unsigned char out2[384];\n+    serchk.Finalize(out);\n+    deserchk.Finalize(out2);\n+    BOOST_CHECK_EQUAL(HexStr(out), HexStr(out2));\n+\n+    // Test MuHash3072 overflow\n+    class MuHashOverflow : public MuHash3072 {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r519485947",
      "id" : 519485947,
      "in_reply_to_id" : 509163922,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ4NTk0Nw==",
      "original_commit_id" : "96a8d80f7ba43fd608984543d6bc6905f696529f",
      "original_line" : 933,
      "original_position" : 83,
      "original_start_line" : 930,
      "path" : "src/test/crypto_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 525851707,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519485947",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r519486012"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519486012"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-11-08T22:27:41Z",
      "diff_hunk" : "@@ -105,6 +106,70 @@ static void FastRandom_1bit(benchmark::Bench& bench)\n     });\n }\n \n+static void MuHash(benchmark::Bench& bench)\n+{\n+    FastRandomContext rng(true);\n+    MuHash3072 acc;\n+    unsigned char key[32] = {0};\n+    int i = 0;\n+    bench.run([&] {\n+        key[0] = ++i;\n+        acc *= MuHash3072(key);\n+    });\n+}\n+\n+static void MuHashAdd(benchmark::Bench& bench)\n+{\n+    FastRandomContext rng(true);\n+    MuHash3072 acc;\n+    unsigned char key[32];\n+    std::vector<unsigned char> randkey = rng.randbytes(32);\n+    for (size_t i = 0; i < randkey.size(); ++i) {\n+        key[i] = randkey[i];\n+    }\n+\n+    MuHash3072 muhash = MuHash3072(key);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r519486012",
      "id" : 519486012,
      "in_reply_to_id" : 509161865,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ4NjAxMg==",
      "original_commit_id" : "96a8d80f7ba43fd608984543d6bc6905f696529f",
      "original_line" : 131,
      "original_position" : 34,
      "original_start_line" : 123,
      "path" : "src/bench/crypto_hash.cpp",
      "position" : null,
      "pull_request_review_id" : 525851766,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519486012",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r519486351"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519486351"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This is true but it's not how we intend to use it. I have left this as is. Otherwise, it might be inconsistent with the docs and might give the wrong impression on the usage. ",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-11-08T22:30:49Z",
      "diff_hunk" : "@@ -105,6 +106,70 @@ static void FastRandom_1bit(benchmark::Bench& bench)\n     });\n }\n \n+static void MuHash(benchmark::Bench& bench)\n+{\n+    FastRandomContext rng(true);\n+    MuHash3072 acc;\n+    unsigned char key[32] = {0};\n+    int i = 0;\n+    bench.run([&] {\n+        key[0] = ++i;\n+        acc *= MuHash3072(key);\n+    });\n+}\n+\n+static void MuHashAdd(benchmark::Bench& bench)\n+{\n+    FastRandomContext rng(true);\n+    MuHash3072 acc;\n+    unsigned char key[32];\n+    std::vector<unsigned char> randkey = rng.randbytes(32);\n+    for (size_t i = 0; i < randkey.size(); ++i) {\n+        key[i] = randkey[i];\n+    }\n+\n+    MuHash3072 muhash = MuHash3072(key);\n+    bench.run([&] {\n+        acc *= muhash;\n+    });\n+}\n+\n+static void MuHashDiv(benchmark::Bench& bench)\n+{\n+    FastRandomContext rng(true);\n+    MuHash3072 acc;\n+    unsigned char key[32];\n+    std::vector<unsigned char> randkey = rng.randbytes(32);\n+    for (size_t i = 0; i < randkey.size(); ++i) {\n+        key[i] = randkey[i];\n+    }\n+\n+    MuHash3072 muhash = MuHash3072(key);\n+\n+    for (size_t i = 0; i < bench.epochIterations(); ++i) {\n+        acc *= muhash;\n+    }\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r519486351",
      "id" : 519486351,
      "in_reply_to_id" : 509155449,
      "line" : 140,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ4NjM1MQ==",
      "original_commit_id" : "96a8d80f7ba43fd608984543d6bc6905f696529f",
      "original_line" : 140,
      "original_position" : 55,
      "original_start_line" : 149,
      "path" : "src/bench/crypto_hash.cpp",
      "position" : 43,
      "pull_request_review_id" : 525852047,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : 137,
      "start_side" : "RIGHT",
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519486351",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r519486360"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519486360"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-11-08T22:30:53Z",
      "diff_hunk" : "@@ -105,6 +106,70 @@ static void FastRandom_1bit(benchmark::Bench& bench)\n     });\n }\n \n+static void MuHash(benchmark::Bench& bench)\n+{\n+    FastRandomContext rng(true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r519486360",
      "id" : 519486360,
      "in_reply_to_id" : 509153543,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ4NjM2MA==",
      "original_commit_id" : "96a8d80f7ba43fd608984543d6bc6905f696529f",
      "original_line" : 111,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/bench/crypto_hash.cpp",
      "position" : null,
      "pull_request_review_id" : 525852054,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519486360",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r519486413"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519486413"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-11-08T22:31:20Z",
      "diff_hunk" : "@@ -105,6 +106,70 @@ static void FastRandom_1bit(benchmark::Bench& bench)\n     });\n }\n \n+static void MuHash(benchmark::Bench& bench)\n+{\n+    FastRandomContext rng(true);\n+    MuHash3072 acc;\n+    unsigned char key[32] = {0};\n+    int i = 0;\n+    bench.run([&] {\n+        key[0] = ++i;\n+        acc *= MuHash3072(key);\n+    });\n+}\n+\n+static void MuHashAdd(benchmark::Bench& bench)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r519486413",
      "id" : 519486413,
      "in_reply_to_id" : 509153295,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ4NjQxMw==",
      "original_commit_id" : "96a8d80f7ba43fd608984543d6bc6905f696529f",
      "original_line" : 121,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/bench/crypto_hash.cpp",
      "position" : null,
      "pull_request_review_id" : 525852105,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519486413",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r519486432"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519486432"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-11-08T22:31:32Z",
      "diff_hunk" : "@@ -0,0 +1,303 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <cassert>\n+#include <cstdio>\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+constexpr size_t INPUT_SIZE = 32;\n+constexpr size_t OUTPUT_SIZE = 384;\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    limb_t th = t >> LIMB_SIZE;\n+    limb_t tl = t;\n+\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    limb_t th = t >> LIMB_SIZE;\n+    limb_t tl = t;\n+\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, const limb_t& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072& d)\n+{\n+    if (d.limbs[0] <= std::numeric_limits<limb_t>::max() - MAX_PRIME_DIFF) return false;\n+    for (int i = 1; i < LIMBS; ++i) {\n+        if (d.limbs[i] != std::numeric_limits<limb_t>::max()) return false;\n+    }\n+    return true;\n+}\n+\n+void FullReduce(Num3072& d)\n+{\n+    limb_t c0 = MAX_PRIME_DIFF;\n+    for (int i = 0; i < LIMBS; ++i) {\n+        limb_t c1 = 0;\n+        add2(c0, c1, d.limbs[i]);\n+        extract2(c0, c1, d.limbs[i]);\n+    }\n+}\n+\n+void Multiply(Num3072& in_out, const Num3072& a)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*a into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        mul(d0, d1, in_out.limbs[1 + j], a.limbs[LIMBS + j - (1 + j)]);\n+        for (int i = 2 + j; i < LIMBS; ++i) muladd3(d0, d1, d2, in_out.limbs[i], a.limbs[LIMBS + j - i]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < j + 1; ++i) muladd3(c0, c1, c2, in_out.limbs[i], a.limbs[j - i]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+\n+    /* Compute limb N-1 of a*b into tmp. */\n+    limb_t c2 = 0;\n+    for (int i = 0; i < LIMBS; ++i) muladd3(c0, c1, c2, in_out.limbs[i], a.limbs[LIMBS - 1 - i]);\n+    extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        add2(c0, c1, tmp.limbs[j]);\n+        extract2(c0, c1, in_out.limbs[j]);\n+    }\n+\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+\n+    /* Perform a potential third reduction. */\n+    if (c0) FullReduce(in_out);\n+}\n+\n+void Square(Num3072& in_out)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*in_out into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        for (int i = 0; i < (LIMBS - 1 - j) / 2; ++i) muldbladd3(d0, d1, d2, in_out.limbs[i + j + 1], in_out.limbs[LIMBS - 1 - i]);\n+        if ((j + 1) & 1) muladd3(d0, d1, d2, in_out.limbs[(LIMBS - 1 - j) / 2 + j + 1], in_out.limbs[LIMBS - 1 - (LIMBS - 1 - j) / 2]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < (j + 1) / 2; ++i) muldbladd3(c0, c1, c2, in_out.limbs[i], in_out.limbs[j - i]);\n+        if ((j + 1) & 1) muladd3(c0, c1, c2, in_out.limbs[(j + 1) / 2], in_out.limbs[j - (j + 1) / 2]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+\n+    limb_t c2 = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r519486432",
      "id" : 519486432,
      "in_reply_to_id" : 509145379,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ4NjQzMg==",
      "original_commit_id" : "96a8d80f7ba43fd608984543d6bc6905f696529f",
      "original_line" : 188,
      "original_position" : 188,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 525852121,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519486432",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r519486465"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519486465"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-11-08T22:31:39Z",
      "diff_hunk" : "@@ -0,0 +1,303 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <cassert>\n+#include <cstdio>\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+constexpr size_t INPUT_SIZE = 32;\n+constexpr size_t OUTPUT_SIZE = 384;\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    limb_t th = t >> LIMB_SIZE;\n+    limb_t tl = t;\n+\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    limb_t th = t >> LIMB_SIZE;\n+    limb_t tl = t;\n+\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, const limb_t& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072& d)\n+{\n+    if (d.limbs[0] <= std::numeric_limits<limb_t>::max() - MAX_PRIME_DIFF) return false;\n+    for (int i = 1; i < LIMBS; ++i) {\n+        if (d.limbs[i] != std::numeric_limits<limb_t>::max()) return false;\n+    }\n+    return true;\n+}\n+\n+void FullReduce(Num3072& d)\n+{\n+    limb_t c0 = MAX_PRIME_DIFF;\n+    for (int i = 0; i < LIMBS; ++i) {\n+        limb_t c1 = 0;\n+        add2(c0, c1, d.limbs[i]);\n+        extract2(c0, c1, d.limbs[i]);\n+    }\n+}\n+\n+void Multiply(Num3072& in_out, const Num3072& a)\n+{\n+    limb_t c0 = 0, c1 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of in_out*a into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0, c2 = 0;\n+        mul(d0, d1, in_out.limbs[1 + j], a.limbs[LIMBS + j - (1 + j)]);\n+        for (int i = 2 + j; i < LIMBS; ++i) muladd3(d0, d1, d2, in_out.limbs[i], a.limbs[LIMBS + j - i]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < j + 1; ++i) muladd3(c0, c1, c2, in_out.limbs[i], a.limbs[j - i]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+\n+    /* Compute limb N-1 of a*b into tmp. */\n+    limb_t c2 = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r519486465",
      "id" : 519486465,
      "in_reply_to_id" : 509144274,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ4NjQ2NQ==",
      "original_commit_id" : "96a8d80f7ba43fd608984543d6bc6905f696529f",
      "original_line" : 154,
      "original_position" : 154,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 525852138,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519486465",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r519486529"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519486529"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Added a comment for clarification.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-11-08T22:32:12Z",
      "diff_hunk" : "@@ -0,0 +1,303 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <cassert>\n+#include <cstdio>\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+constexpr size_t INPUT_SIZE = 32;\n+constexpr size_t OUTPUT_SIZE = 384;\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    limb_t th = t >> LIMB_SIZE;\n+    limb_t tl = t;\n+\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    limb_t th = t >> LIMB_SIZE;\n+    limb_t tl = t;\n+\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, const limb_t& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072& d)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r519486529",
      "id" : 519486529,
      "in_reply_to_id" : 509130310,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ4NjUyOQ==",
      "original_commit_id" : "96a8d80f7ba43fd608984543d6bc6905f696529f",
      "original_line" : 119,
      "original_position" : 119,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 525852189,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519486529",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r519486578"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519486578"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-11-08T22:32:54Z",
      "diff_hunk" : "@@ -0,0 +1,310 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+static constexpr size_t INPUT_SIZE = 32;\n+static constexpr size_t OUTPUT_SIZE = 384;\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+\n+    double_limb_t t = (double_limb_t)a * b;\n+    th = t >> LIMB_SIZE;\n+    tl = t;\n+\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+\n+    double_limb_t t = (double_limb_t)a * b;\n+    th = t >> LIMB_SIZE;\n+    tl = t;\n+\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, limb_t& a)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r519486578",
      "id" : 519486578,
      "in_reply_to_id" : 507610270,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ4NjU3OA==",
      "original_commit_id" : "b03e923c534a954edfdd9ef4ec9a68e5dd08d827",
      "original_line" : 117,
      "original_position" : 119,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 525852237,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519486578",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r519487839"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519487839"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I have refactored the code to have clearer boundaries between the two classes. Let me know if this matches your expectation.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-11-08T22:43:41Z",
      "diff_hunk" : "@@ -0,0 +1,91 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+\n+#include <stdint.h>\n+\n+struct Num3072 {\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_t;\n+    typedef uint64_t limb_t;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_t;\n+    typedef uint32_t limb_t;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_t limbs[LIMBS];\n+};\n+\n+/** A class representing MuHash sets\n+ *\n+ * MuHash is a hashing algorithm that supports adding set elements in any\n+ * order but also deleting in any order. As a result, it can maintain a\n+ * running sum for a set of data as a whole, and add/subtract when data\n+ * is added to or removed from it. A downside of MuHash is that computing\n+ * an inverse is relatively expensive. This can be solved by representing\n+ * the running value as a fraction, and multiplying added elements into\n+ * the numerator and removed elements into the denominator. Only when the\n+ * final hash is desired, a single modular inverse and multiplication is\n+ * needed to combine the two.\n+ *\n+ * TODO: Represent running value as a fraction to allow for more intuitive\n+ * use (see above).\n+ *\n+ * As the update operations are also associative, H(a)+H(b)+H(c)+H(d) can\n+ * in fact be computed as (H(a)+H(b)) + (H(c)+H(d)). This implies that\n+ * all of this is perfectly parallellizable: each thread can process an\n+ * arbitrary subset of the update operations, allowing them to be\n+ * efficiently combined later.\n+ *\n+ * Muhash does not support checking if an element is already part of the\n+ * set. That is why this class does not enforce the use of a set as the\n+ * data it represents because there is no efficient way to do so.\n+ * It is possible to add elements more than once and also to remove\n+ * elements that have not been added before. However, this implementation\n+ * is intended to represent a set of elements.\n+ *\n+ * See also https://cseweb.ucsd.edu/~mihir/papers/inchash.pdf and\n+ * https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014337.html.\n+ */\n+class MuHash3072",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r519487839",
      "id" : 519487839,
      "in_reply_to_id" : 510232044,
      "line" : 91,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ4NzgzOQ==",
      "original_commit_id" : "96a8d80f7ba43fd608984543d6bc6905f696529f",
      "original_line" : 91,
      "original_position" : 62,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : 91,
      "pull_request_review_id" : 525853285,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519487839",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Pushed a fair amount of fixes and refactoring but still working on some of the overflow questions and another fuzz test.",
      "created_at" : "2020-11-08T22:44:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-723677038",
      "id" : 723677038,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyMzY3NzAzOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-08T22:44:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/723677038",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I'm going to move this out of high priority while you're working on the branch. It can go back in once it's ready for review again.",
      "created_at" : "2020-11-19T10:41:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-730286098",
      "id" : 730286098,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDczMDI4NjA5OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-19T10:41:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/730286098",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r530660278"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/530660278"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "If I got this right, 2. basically means we can have `if (c0)` or `if (IsOverflow())` or both, and in the case of both there is a problem. If I understood that correctly I have addressed this in `Square()` and `Multiply()` with an additional comment.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-11-25T21:52:10Z",
      "diff_hunk" : "@@ -0,0 +1,303 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <cassert>\n+#include <cstdio>\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+constexpr size_t INPUT_SIZE = 32;\n+constexpr size_t OUTPUT_SIZE = 384;\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    limb_t th = t >> LIMB_SIZE;\n+    limb_t tl = t;\n+\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    limb_t th = t >> LIMB_SIZE;\n+    limb_t tl = t;\n+\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, const limb_t& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;\n+}\n+\n+bool IsOverflow(const Num3072& d)\n+{\n+    if (d.limbs[0] <= std::numeric_limits<limb_t>::max() - MAX_PRIME_DIFF) return false;\n+    for (int i = 1; i < LIMBS; ++i) {\n+        if (d.limbs[i] != std::numeric_limits<limb_t>::max()) return false;\n+    }\n+    return true;\n+}\n+\n+void FullReduce(Num3072& d)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r530660278",
      "id" : 530660278,
      "in_reply_to_id" : 509142040,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDY2MDI3OA==",
      "original_commit_id" : "96a8d80f7ba43fd608984543d6bc6905f696529f",
      "original_line" : 128,
      "original_position" : 128,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 538866956,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/530660278",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r530660331"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/530660331"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think that is correct. At least I could not find evidence for the opposite. The way it is used it can only happen in `Multiply()` and `Square()` and only on the first limb. I think I have fixed this with a temporary internal c2 variable that catches this overflow if it happens.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-11-25T21:52:18Z",
      "diff_hunk" : "@@ -0,0 +1,307 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+\n+#include <assert.h>\n+#include <stdio.h>\n+\n+#include <limits>\n+\n+namespace {\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+constexpr size_t INPUT_SIZE = 32;\n+constexpr size_t OUTPUT_SIZE = 384;\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+\n+// Sanity check for Num3072 constants\n+static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+// Hard coded values in MuHash3072 constructor and Finalize\n+static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** Extract the lowest limb of [c0,c1] into n, and left shift the number by 1 limb. */\n+inline void extract2(limb_t& c0, limb_t& c1, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    limb_t th = t >> LIMB_SIZE;\n+    limb_t tl = t;\n+\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    limb_t tl, th;\n+\n+    double_limb_t t = (double_limb_t)a * b;\n+    th = t >> LIMB_SIZE;\n+    tl = t;\n+\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1] += a */\n+inline void add2(limb_t& c0, limb_t& c1, limb_t& a)\n+{\n+    c0 += a;\n+    c1 += (c0 < a) ? 1 : 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r530660331",
      "id" : 530660331,
      "in_reply_to_id" : 508277075,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDY2MDMzMQ==",
      "original_commit_id" : "b29a0fde8784b7574a987dfb037a988b442bf92b",
      "original_line" : 101,
      "original_position" : 120,
      "original_start_line" : 119,
      "path" : "src/crypto/muhash.cpp",
      "position" : null,
      "pull_request_review_id" : 538867016,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-12-22T00:53:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/530660331",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r530660479"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/530660479"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Finally had the (seemingly obvious) idea to solve this with a serialized MuHash3072 object.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-11-25T21:52:44Z",
      "diff_hunk" : "@@ -0,0 +1,97 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+\n+#include <stdint.h>\n+\n+struct Num3072 {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r530660479",
      "id" : 530660479,
      "in_reply_to_id" : 507170069,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDY2MDQ3OQ==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 16,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : null,
      "pull_request_review_id" : 538867188,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/530660479",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This is finally ready for review again. I have added a fuzz test for consistency testing which I am running currently.",
      "created_at" : "2020-11-25T21:53:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-733962568",
      "id" : 733962568,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDczMzk2MjU2OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-25T21:54:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/733962568",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-12-15T18:41:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-745486404",
      "id" : 745486404,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0NTQ4NjQwNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-15T18:41:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/745486404",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased and pushed some new comment I seem to have forgotten last time. ",
      "created_at" : "2020-12-16T23:20:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-747099674",
      "id" : 747099674,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0NzA5OTY3NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-16T23:20:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/747099674",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r545088857"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/545088857"
         }
      },
      "author_association" : "MEMBER",
      "body" : "515ee0d0ca91bfdf6a9cd844824e747291efabe9: build system stuff could warrant a separate commit. It gets picked up on my macOS machine, so that's good.\r\n\r\nI you end up splitting the commit, you might as well also introduce `MuHash3072` in its own commit.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-12-17T13:27:43Z",
      "diff_hunk" : "@@ -753,6 +753,9 @@ if test x$use_lcov_branch != xno; then\n   AC_SUBST(LCOV_OPTS, \"$LCOV_OPTS --rc lcov_branch_coverage=1\")\n fi\n \n+dnl Check for __int128\n+AC_CHECK_TYPES([__int128])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r545088857",
      "id" : 545088857,
      "line" : 757,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTA4ODg1Nw==",
      "original_commit_id" : "515ee0d0ca91bfdf6a9cd844824e747291efabe9",
      "original_line" : 757,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "configure.ac",
      "position" : 5,
      "pull_request_review_id" : 554601511,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/545088857",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r545126648"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/545126648"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I suggest either making `a` `const` (like `Multiply`) or, if it hurts performance, `Divide` private with `MuHash3072` as its friend.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-12-17T14:21:51Z",
      "diff_hunk" : "@@ -0,0 +1,119 @@\n+// Copyright (c) 2017-2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+#include <uint256.h>\n+\n+#include <stdint.h>\n+\n+class Num3072\n+{\n+private:\n+    void FullReduce();\n+    bool IsOverflow() const;\n+    Num3072 GetInverse() const;\n+\n+public:\n+\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_t;\n+    typedef uint64_t limb_t;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_t;\n+    typedef uint32_t limb_t;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_t limbs[LIMBS];\n+\n+    // Sanity check for Num3072 constants\n+    static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+    static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+    static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+    // Hard coded values in MuHash3072 constructor and Finalize\n+    static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+    void Multiply(const Num3072& a);\n+    void Divide(Num3072& a);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r545126648",
      "id" : 545126648,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTEyNjY0OA==",
      "original_commit_id" : "515ee0d0ca91bfdf6a9cd844824e747291efabe9",
      "original_line" : 48,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : null,
      "pull_request_review_id" : 554601511,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/545126648",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r545144564"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/545144564"
         }
      },
      "author_association" : "MEMBER",
      "body" : "#20315 dropped our big endian Travis instance, but that shouldn't be a problem. Took me a while to wrap my head around... Each limb is serialised as little endian, because `serialize.h` converts `uint32_t` and `uint64_t` to little endian, using  `htole32` / `htole64`. We also treat the collection of limbs as little endian, with the first limb having the least significant digit. This means we can serialise 32 bit limbs on one machine and deserialise the result as 64 bit limbs on another machine.\r\n\r\n(in reply to https://github.com/bitcoin/bitcoin/pull/19055#discussion_r507173075)",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-12-17T14:45:51Z",
      "diff_hunk" : "@@ -0,0 +1,97 @@\n+// Copyright (c) 2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+\n+#include <stdint.h>\n+\n+struct Num3072 {\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_t;\n+    typedef uint64_t limb_t;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_t;\n+    typedef uint32_t limb_t;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_t limbs[LIMBS];\n+};\n+\n+/** 2^3072 - 1103717, the next largest 3072-bit safe prime number, is used as the order of the group. */\n+constexpr Num3072::limb_t MAX_PRIME_DIFF = 1103717;\n+\n+/** A class representing MuHash sets\n+ *\n+ * MuHash is a hashing algorithm that supports adding set elements in any\n+ * order but also deleting in any order. As a result, it can maintain a\n+ * running sum for a set of data as a whole, and add/subtract when data\n+ * is added to or removed from it. A downside of MuHash is that computing\n+ * an inverse is relatively expensive. This can be solved by representing\n+ * the running value as a fraction, and multiplying added elements into\n+ * the numerator and removed elements into the denominator. Only when the\n+ * final hash is desired, a single modular inverse and multiplication is\n+ * needed to combine the two.\n+ *\n+ * TODO: Represent running value as a fraction to allow for more intuitive\n+ * use (see above).\n+ *\n+ * As the update operations are also associative, H(a)+H(b)+H(c)+H(d) can\n+ * in fact be computed as (H(a)+H(b)) + (H(c)+H(d)). This implies that\n+ * all of this is perfectly parallellizable: each thread can process an\n+ * arbitrary subset of the update operations, allowing them to be\n+ * efficiently combined later.\n+ *\n+ * Muhash does not support checking if an element is already part of the\n+ * set. That is why this class does not enforce the use of a set as the\n+ * data it represents because there is no efficient way to do so..\n+ * It is possible to add elements more than once and also to remove\n+ * elements that have not been added before. However, this implementation\n+ * is intended to represent a set of elements.\n+ *\n+ * See also https://cseweb.ucsd.edu/~mihir/papers/inchash.pdf and\n+ * https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014337.html.\n+ */\n+class MuHash3072\n+{\n+protected:\n+    Num3072 data;\n+\n+    static constexpr size_t INPUT_SIZE = 32;\n+    static constexpr size_t OUTPUT_SIZE = 384;\n+\n+public:\n+    /* The empty set. */\n+    MuHash3072() noexcept;\n+\n+    /* A singleton with a single 32-byte key in it. */\n+    explicit MuHash3072(Span<const unsigned char> key32) noexcept;\n+\n+    /* Multiply (resulting in a hash for the union of the sets) */\n+    MuHash3072& operator*=(const MuHash3072& add) noexcept;\n+\n+    /* Divide (resulting in a hash for the difference of the sets) */\n+    MuHash3072& operator/=(const MuHash3072& sub) noexcept;\n+\n+    /* Finalize into a 384-byte hash. Does not change this object's value. */\n+    void Finalize(Span<unsigned char> hash384) noexcept;\n+\n+    SERIALIZE_METHODS(MuHash3072, obj)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r545144564",
      "id" : 545144564,
      "in_reply_to_id" : 507173075,
      "line" : 123,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTE0NDU2NA==",
      "original_commit_id" : "e19e50013478c6b7066aa2c9f7e0d0ee7219e837",
      "original_line" : 123,
      "original_position" : 89,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : 123,
      "pull_request_review_id" : 554601511,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/545144564",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@Sjors Thanks, I updated the Python test, will address your other comments soon. ",
      "created_at" : "2020-12-17T23:21:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-747766454",
      "id" : 747766454,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0Nzc2NjQ1NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-17T23:21:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/747766454",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r546107086"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546107086"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If the \"MuHash3072\" type is an encapsulation of a set-hash state, then perhaps it's better to give this name \"Add\" or \"Union\" (with a comment explaining the implications of it having multiset semantics)?\r\n\r\nAlso, using this with a pattern of \"accumulator *= MuHash3072{data}\" will involve two multiplications, but the one with the denominator is always 1. Perhaps it's better to have \"Insert\" and \"Remove\" functions (separate from Add/Union and Subtract) that take a Span of a single element to add/remove?",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-12-18T21:49:30Z",
      "diff_hunk" : "@@ -0,0 +1,315 @@\n+// Copyright (c) 2017-2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+#include <hash.h>\n+\n+#include <cassert>\n+#include <cstdio>\n+#include <limits>\n+\n+namespace {\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+/** 2^3072 - 1103717, the largest 3072-bit safe prime number, is used as the modulus. */\n+constexpr limb_t MAX_PRIME_DIFF = 1103717;\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    limb_t th = t >> LIMB_SIZE;\n+    limb_t tl = t;\n+\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    limb_t th = t >> LIMB_SIZE;\n+    limb_t tl = t;\n+\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/**\n+ * Add limb a to [c0,c1]: [c0,c1] += a. Then extract the lowest\n+ * limb of [c0,c1] into n, and left shift the number by 1 limb.\n+ * */\n+inline void addnextract2(limb_t& c0, limb_t& c1, const limb_t& a, limb_t& n)\n+{\n+    limb_t c2 = 0;\n+\n+    // add\n+    c0 += a;\n+    if (c0 < a) {\n+        c1 += 1;\n+\n+        // Handle case when c1 has overflown\n+        if (c1 == 0)\n+            c2 = 1;\n+    }\n+\n+    // extract\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+}\n+\n+/** in_out = in_out^(2^sq) * mul */\n+inline void square_n_mul(Num3072& in_out, const int sq, const Num3072& mul)\n+{\n+    for (int j = 0; j < sq; ++j) in_out.Square();\n+    in_out.Multiply(mul);\n+}\n+\n+} // namespace\n+\n+/** Indicates wether d is larger than the modulus. */\n+bool Num3072::IsOverflow() const\n+{\n+    if (this->limbs[0] <= std::numeric_limits<limb_t>::max() - MAX_PRIME_DIFF) return false;\n+    for (int i = 1; i < LIMBS; ++i) {\n+        if (this->limbs[i] != std::numeric_limits<limb_t>::max()) return false;\n+    }\n+    return true;\n+}\n+\n+void Num3072::FullReduce()\n+{\n+    limb_t c0 = MAX_PRIME_DIFF;\n+    limb_t c1 = 0;\n+    for (int i = 0; i < LIMBS; ++i) {\n+        addnextract2(c0, c1, this->limbs[i], this->limbs[i]);\n+    }\n+}\n+\n+Num3072 Num3072::GetInverse() const\n+{\n+    // For fast exponentiation a sliding window exponentiation with repunit\n+    // precomputation is utilized. See \"Fast Point Decompression for Standard\n+    // Elliptic Curves\" (Brumley, JÃ¤rvinen, 2008).\n+\n+    Num3072 p[12]; // p[i] = a^(2^(2^i)-1)\n+    Num3072 out;\n+\n+    p[0] = *this;\n+\n+    for (int i = 0; i < 11; ++i) {\n+        p[i + 1] = p[i];\n+        for (int j = 0; j < (1 << i); ++j) p[i + 1].Square();\n+        p[i + 1].Multiply(p[i]);\n+    }\n+\n+    out = p[11];\n+\n+    square_n_mul(out, 512, p[9]);\n+    square_n_mul(out, 256, p[8]);\n+    square_n_mul(out, 128, p[7]);\n+    square_n_mul(out, 64, p[6]);\n+    square_n_mul(out, 32, p[5]);\n+    square_n_mul(out, 8, p[3]);\n+    square_n_mul(out, 2, p[1]);\n+    square_n_mul(out, 1, p[0]);\n+    square_n_mul(out, 5, p[2]);\n+    square_n_mul(out, 3, p[0]);\n+    square_n_mul(out, 2, p[0]);\n+    square_n_mul(out, 4, p[0]);\n+    square_n_mul(out, 4, p[1]);\n+    square_n_mul(out, 3, p[0]);\n+\n+    return out;\n+}\n+\n+void Num3072::Multiply(const Num3072& a)\n+{\n+    limb_t c0 = 0, c1 = 0, c2 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of this*a into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0;\n+        mul(d0, d1, this->limbs[1 + j], a.limbs[LIMBS + j - (1 + j)]);\n+        for (int i = 2 + j; i < LIMBS; ++i) muladd3(d0, d1, d2, this->limbs[i], a.limbs[LIMBS + j - i]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < j + 1; ++i) muladd3(c0, c1, c2, this->limbs[i], a.limbs[j - i]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+\n+    /* Compute limb N-1 of a*b into tmp. */\n+    assert(c2 == 0);\n+    for (int i = 0; i < LIMBS; ++i) muladd3(c0, c1, c2, this->limbs[i], a.limbs[LIMBS - 1 - i]);\n+    extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        addnextract2(c0, c1, tmp.limbs[j], this->limbs[j]);\n+    }\n+\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+\n+    /* Perform up to two more reductions if the internal state has already\n+     * overflown the MAX of Num3072 or if it is larger than the modulus or\n+     * if both are the case.\n+     * */\n+    if (this->IsOverflow()) this->FullReduce();\n+    if (c0) this->FullReduce();\n+}\n+\n+void Num3072::Square()\n+{\n+    limb_t c0 = 0, c1 = 0, c2 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of this*this into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0;\n+        for (int i = 0; i < (LIMBS - 1 - j) / 2; ++i) muldbladd3(d0, d1, d2, this->limbs[i + j + 1], this->limbs[LIMBS - 1 - i]);\n+        if ((j + 1) & 1) muladd3(d0, d1, d2, this->limbs[(LIMBS - 1 - j) / 2 + j + 1], this->limbs[LIMBS - 1 - (LIMBS - 1 - j) / 2]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < (j + 1) / 2; ++i) muldbladd3(c0, c1, c2, this->limbs[i], this->limbs[j - i]);\n+        if ((j + 1) & 1) muladd3(c0, c1, c2, this->limbs[(j + 1) / 2], this->limbs[j - (j + 1) / 2]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+\n+    assert(c2 == 0);\n+    for (int i = 0; i < LIMBS / 2; ++i) muldbladd3(c0, c1, c2, this->limbs[i], this->limbs[LIMBS - 1 - i]);\n+    extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        addnextract2(c0, c1, tmp.limbs[j], this->limbs[j]);\n+    }\n+\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+\n+    /* Perform up to two more reductions if the internal state has already\n+     * overflown the MAX of Num3072 or if it is larger than the modulus or\n+     * if both are the case.\n+     * */\n+    if (this->IsOverflow()) this->FullReduce();\n+    if (c0) this->FullReduce();\n+}\n+\n+void Num3072::SetToOne()\n+{\n+    this->limbs[0] = 1;\n+    for (int i = 1; i < LIMBS; ++i) this->limbs[i] = 0;\n+}\n+\n+void Num3072::Divide(Num3072& a)\n+{\n+    if (this->IsOverflow()) this->FullReduce();\n+    if (a.IsOverflow()) a.FullReduce();\n+\n+    Num3072 inv = a.GetInverse();\n+    this->Multiply(inv);\n+    if (this->IsOverflow()) this->FullReduce();\n+}\n+\n+MuHash3072::MuHash3072(Span<const unsigned char> in) noexcept\n+{\n+    uint256 hashed_in = (CHashWriter(SER_DISK, 0) << in).GetSHA256();\n+    unsigned char tmp[BYTE_SIZE];\n+    ChaCha20(hashed_in.data(), hashed_in.size()).Keystream(tmp, BYTE_SIZE);\n+    for (int i = 0; i < LIMBS; ++i) {\n+        if (sizeof(limb_t) == 4) {\n+            m_numerator.limbs[i] = ReadLE32(tmp + 4 * i);\n+        } else if (sizeof(limb_t) == 8) {\n+            m_numerator.limbs[i] = ReadLE64(tmp + 8 * i);\n+        }\n+    }\n+}\n+\n+void MuHash3072::Finalize(uint256& out) noexcept\n+{\n+    m_numerator.Divide(m_denominator);\n+    m_denominator.SetToOne();  // Needed to keep the MuHash object valid\n+\n+    unsigned char data[384];\n+    for (int i = 0; i < LIMBS; ++i) {\n+        if (sizeof(limb_t) == 4) {\n+            WriteLE32(data + i * 4, m_numerator.limbs[i]);\n+        } else if (sizeof(limb_t) == 8) {\n+            WriteLE64(data + i * 8, m_numerator.limbs[i]);\n+        }\n+    }\n+\n+    out = (CHashWriter(SER_DISK, 0) << data).GetSHA256();\n+}\n+\n+MuHash3072& MuHash3072::operator*=(const MuHash3072& mul) noexcept",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r546107086",
      "id" : 546107086,
      "line" : 316,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjEwNzA4Ng==",
      "original_commit_id" : "515ee0d0ca91bfdf6a9cd844824e747291efabe9",
      "original_line" : 316,
      "original_position" : 303,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : 316,
      "pull_request_review_id" : 555834240,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546107086",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r546209372"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546209372"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yep, I'm actually implementing a similar accumulator in Go and I'm using Add/Remove that both do a single multiplication and Combine that combines 2 \"accumulators\" and does 2 multiplications.\r\nalso serializing/deserializing can be quite helpful (probably will work similar to finalize, by dividing, normalizing and outputting the numerator)\r\n\r\nFWIW I also tested replacing hash+Chacha20 with a XOF hash (blake2b) and it was slower so I'm sticking with hash+Chacha20",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-12-19T08:12:35Z",
      "diff_hunk" : "@@ -0,0 +1,315 @@\n+// Copyright (c) 2017-2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+#include <hash.h>\n+\n+#include <cassert>\n+#include <cstdio>\n+#include <limits>\n+\n+namespace {\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+/** 2^3072 - 1103717, the largest 3072-bit safe prime number, is used as the modulus. */\n+constexpr limb_t MAX_PRIME_DIFF = 1103717;\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    limb_t th = t >> LIMB_SIZE;\n+    limb_t tl = t;\n+\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    limb_t th = t >> LIMB_SIZE;\n+    limb_t tl = t;\n+\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/**\n+ * Add limb a to [c0,c1]: [c0,c1] += a. Then extract the lowest\n+ * limb of [c0,c1] into n, and left shift the number by 1 limb.\n+ * */\n+inline void addnextract2(limb_t& c0, limb_t& c1, const limb_t& a, limb_t& n)\n+{\n+    limb_t c2 = 0;\n+\n+    // add\n+    c0 += a;\n+    if (c0 < a) {\n+        c1 += 1;\n+\n+        // Handle case when c1 has overflown\n+        if (c1 == 0)\n+            c2 = 1;\n+    }\n+\n+    // extract\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+}\n+\n+/** in_out = in_out^(2^sq) * mul */\n+inline void square_n_mul(Num3072& in_out, const int sq, const Num3072& mul)\n+{\n+    for (int j = 0; j < sq; ++j) in_out.Square();\n+    in_out.Multiply(mul);\n+}\n+\n+} // namespace\n+\n+/** Indicates wether d is larger than the modulus. */\n+bool Num3072::IsOverflow() const\n+{\n+    if (this->limbs[0] <= std::numeric_limits<limb_t>::max() - MAX_PRIME_DIFF) return false;\n+    for (int i = 1; i < LIMBS; ++i) {\n+        if (this->limbs[i] != std::numeric_limits<limb_t>::max()) return false;\n+    }\n+    return true;\n+}\n+\n+void Num3072::FullReduce()\n+{\n+    limb_t c0 = MAX_PRIME_DIFF;\n+    limb_t c1 = 0;\n+    for (int i = 0; i < LIMBS; ++i) {\n+        addnextract2(c0, c1, this->limbs[i], this->limbs[i]);\n+    }\n+}\n+\n+Num3072 Num3072::GetInverse() const\n+{\n+    // For fast exponentiation a sliding window exponentiation with repunit\n+    // precomputation is utilized. See \"Fast Point Decompression for Standard\n+    // Elliptic Curves\" (Brumley, JÃ¤rvinen, 2008).\n+\n+    Num3072 p[12]; // p[i] = a^(2^(2^i)-1)\n+    Num3072 out;\n+\n+    p[0] = *this;\n+\n+    for (int i = 0; i < 11; ++i) {\n+        p[i + 1] = p[i];\n+        for (int j = 0; j < (1 << i); ++j) p[i + 1].Square();\n+        p[i + 1].Multiply(p[i]);\n+    }\n+\n+    out = p[11];\n+\n+    square_n_mul(out, 512, p[9]);\n+    square_n_mul(out, 256, p[8]);\n+    square_n_mul(out, 128, p[7]);\n+    square_n_mul(out, 64, p[6]);\n+    square_n_mul(out, 32, p[5]);\n+    square_n_mul(out, 8, p[3]);\n+    square_n_mul(out, 2, p[1]);\n+    square_n_mul(out, 1, p[0]);\n+    square_n_mul(out, 5, p[2]);\n+    square_n_mul(out, 3, p[0]);\n+    square_n_mul(out, 2, p[0]);\n+    square_n_mul(out, 4, p[0]);\n+    square_n_mul(out, 4, p[1]);\n+    square_n_mul(out, 3, p[0]);\n+\n+    return out;\n+}\n+\n+void Num3072::Multiply(const Num3072& a)\n+{\n+    limb_t c0 = 0, c1 = 0, c2 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of this*a into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0;\n+        mul(d0, d1, this->limbs[1 + j], a.limbs[LIMBS + j - (1 + j)]);\n+        for (int i = 2 + j; i < LIMBS; ++i) muladd3(d0, d1, d2, this->limbs[i], a.limbs[LIMBS + j - i]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < j + 1; ++i) muladd3(c0, c1, c2, this->limbs[i], a.limbs[j - i]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+\n+    /* Compute limb N-1 of a*b into tmp. */\n+    assert(c2 == 0);\n+    for (int i = 0; i < LIMBS; ++i) muladd3(c0, c1, c2, this->limbs[i], a.limbs[LIMBS - 1 - i]);\n+    extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        addnextract2(c0, c1, tmp.limbs[j], this->limbs[j]);\n+    }\n+\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+\n+    /* Perform up to two more reductions if the internal state has already\n+     * overflown the MAX of Num3072 or if it is larger than the modulus or\n+     * if both are the case.\n+     * */\n+    if (this->IsOverflow()) this->FullReduce();\n+    if (c0) this->FullReduce();\n+}\n+\n+void Num3072::Square()\n+{\n+    limb_t c0 = 0, c1 = 0, c2 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of this*this into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0;\n+        for (int i = 0; i < (LIMBS - 1 - j) / 2; ++i) muldbladd3(d0, d1, d2, this->limbs[i + j + 1], this->limbs[LIMBS - 1 - i]);\n+        if ((j + 1) & 1) muladd3(d0, d1, d2, this->limbs[(LIMBS - 1 - j) / 2 + j + 1], this->limbs[LIMBS - 1 - (LIMBS - 1 - j) / 2]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < (j + 1) / 2; ++i) muldbladd3(c0, c1, c2, this->limbs[i], this->limbs[j - i]);\n+        if ((j + 1) & 1) muladd3(c0, c1, c2, this->limbs[(j + 1) / 2], this->limbs[j - (j + 1) / 2]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+\n+    assert(c2 == 0);\n+    for (int i = 0; i < LIMBS / 2; ++i) muldbladd3(c0, c1, c2, this->limbs[i], this->limbs[LIMBS - 1 - i]);\n+    extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        addnextract2(c0, c1, tmp.limbs[j], this->limbs[j]);\n+    }\n+\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+\n+    /* Perform up to two more reductions if the internal state has already\n+     * overflown the MAX of Num3072 or if it is larger than the modulus or\n+     * if both are the case.\n+     * */\n+    if (this->IsOverflow()) this->FullReduce();\n+    if (c0) this->FullReduce();\n+}\n+\n+void Num3072::SetToOne()\n+{\n+    this->limbs[0] = 1;\n+    for (int i = 1; i < LIMBS; ++i) this->limbs[i] = 0;\n+}\n+\n+void Num3072::Divide(Num3072& a)\n+{\n+    if (this->IsOverflow()) this->FullReduce();\n+    if (a.IsOverflow()) a.FullReduce();\n+\n+    Num3072 inv = a.GetInverse();\n+    this->Multiply(inv);\n+    if (this->IsOverflow()) this->FullReduce();\n+}\n+\n+MuHash3072::MuHash3072(Span<const unsigned char> in) noexcept\n+{\n+    uint256 hashed_in = (CHashWriter(SER_DISK, 0) << in).GetSHA256();\n+    unsigned char tmp[BYTE_SIZE];\n+    ChaCha20(hashed_in.data(), hashed_in.size()).Keystream(tmp, BYTE_SIZE);\n+    for (int i = 0; i < LIMBS; ++i) {\n+        if (sizeof(limb_t) == 4) {\n+            m_numerator.limbs[i] = ReadLE32(tmp + 4 * i);\n+        } else if (sizeof(limb_t) == 8) {\n+            m_numerator.limbs[i] = ReadLE64(tmp + 8 * i);\n+        }\n+    }\n+}\n+\n+void MuHash3072::Finalize(uint256& out) noexcept\n+{\n+    m_numerator.Divide(m_denominator);\n+    m_denominator.SetToOne();  // Needed to keep the MuHash object valid\n+\n+    unsigned char data[384];\n+    for (int i = 0; i < LIMBS; ++i) {\n+        if (sizeof(limb_t) == 4) {\n+            WriteLE32(data + i * 4, m_numerator.limbs[i]);\n+        } else if (sizeof(limb_t) == 8) {\n+            WriteLE64(data + i * 8, m_numerator.limbs[i]);\n+        }\n+    }\n+\n+    out = (CHashWriter(SER_DISK, 0) << data).GetSHA256();\n+}\n+\n+MuHash3072& MuHash3072::operator*=(const MuHash3072& mul) noexcept",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r546209372",
      "id" : 546209372,
      "in_reply_to_id" : 546107086,
      "line" : 316,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIwOTM3Mg==",
      "original_commit_id" : "515ee0d0ca91bfdf6a9cd844824e747291efabe9",
      "original_line" : 316,
      "original_position" : 303,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : 316,
      "pull_request_review_id" : 555926095,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:53:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546209372",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2167860?v=4",
         "events_url" : "https://api.github.com/users/elichai/events{/privacy}",
         "followers_url" : "https://api.github.com/users/elichai/followers",
         "following_url" : "https://api.github.com/users/elichai/following{/other_user}",
         "gists_url" : "https://api.github.com/users/elichai/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/elichai",
         "id" : 2167860,
         "login" : "elichai",
         "node_id" : "MDQ6VXNlcjIxNjc4NjA=",
         "organizations_url" : "https://api.github.com/users/elichai/orgs",
         "received_events_url" : "https://api.github.com/users/elichai/received_events",
         "repos_url" : "https://api.github.com/users/elichai/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/elichai/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/elichai/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/elichai"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r547006838"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/547006838"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "@jnewbery and @ajtowns didn't like \"Add\" (https://github.com/bitcoin/bitcoin/pull/19055#discussion_r509153295) and personally I am not sure about \"Union\" yet so I have kept the namings of *= and /= for now but I have added `Insert` and `Remove` to insert and remove single elements with a single multiplication as suggested.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-12-22T00:55:04Z",
      "diff_hunk" : "@@ -0,0 +1,315 @@\n+// Copyright (c) 2017-2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+#include <hash.h>\n+\n+#include <cassert>\n+#include <cstdio>\n+#include <limits>\n+\n+namespace {\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+/** 2^3072 - 1103717, the largest 3072-bit safe prime number, is used as the modulus. */\n+constexpr limb_t MAX_PRIME_DIFF = 1103717;\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    limb_t th = t >> LIMB_SIZE;\n+    limb_t tl = t;\n+\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    limb_t th = t >> LIMB_SIZE;\n+    limb_t tl = t;\n+\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/**\n+ * Add limb a to [c0,c1]: [c0,c1] += a. Then extract the lowest\n+ * limb of [c0,c1] into n, and left shift the number by 1 limb.\n+ * */\n+inline void addnextract2(limb_t& c0, limb_t& c1, const limb_t& a, limb_t& n)\n+{\n+    limb_t c2 = 0;\n+\n+    // add\n+    c0 += a;\n+    if (c0 < a) {\n+        c1 += 1;\n+\n+        // Handle case when c1 has overflown\n+        if (c1 == 0)\n+            c2 = 1;\n+    }\n+\n+    // extract\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+}\n+\n+/** in_out = in_out^(2^sq) * mul */\n+inline void square_n_mul(Num3072& in_out, const int sq, const Num3072& mul)\n+{\n+    for (int j = 0; j < sq; ++j) in_out.Square();\n+    in_out.Multiply(mul);\n+}\n+\n+} // namespace\n+\n+/** Indicates wether d is larger than the modulus. */\n+bool Num3072::IsOverflow() const\n+{\n+    if (this->limbs[0] <= std::numeric_limits<limb_t>::max() - MAX_PRIME_DIFF) return false;\n+    for (int i = 1; i < LIMBS; ++i) {\n+        if (this->limbs[i] != std::numeric_limits<limb_t>::max()) return false;\n+    }\n+    return true;\n+}\n+\n+void Num3072::FullReduce()\n+{\n+    limb_t c0 = MAX_PRIME_DIFF;\n+    limb_t c1 = 0;\n+    for (int i = 0; i < LIMBS; ++i) {\n+        addnextract2(c0, c1, this->limbs[i], this->limbs[i]);\n+    }\n+}\n+\n+Num3072 Num3072::GetInverse() const\n+{\n+    // For fast exponentiation a sliding window exponentiation with repunit\n+    // precomputation is utilized. See \"Fast Point Decompression for Standard\n+    // Elliptic Curves\" (Brumley, JÃ¤rvinen, 2008).\n+\n+    Num3072 p[12]; // p[i] = a^(2^(2^i)-1)\n+    Num3072 out;\n+\n+    p[0] = *this;\n+\n+    for (int i = 0; i < 11; ++i) {\n+        p[i + 1] = p[i];\n+        for (int j = 0; j < (1 << i); ++j) p[i + 1].Square();\n+        p[i + 1].Multiply(p[i]);\n+    }\n+\n+    out = p[11];\n+\n+    square_n_mul(out, 512, p[9]);\n+    square_n_mul(out, 256, p[8]);\n+    square_n_mul(out, 128, p[7]);\n+    square_n_mul(out, 64, p[6]);\n+    square_n_mul(out, 32, p[5]);\n+    square_n_mul(out, 8, p[3]);\n+    square_n_mul(out, 2, p[1]);\n+    square_n_mul(out, 1, p[0]);\n+    square_n_mul(out, 5, p[2]);\n+    square_n_mul(out, 3, p[0]);\n+    square_n_mul(out, 2, p[0]);\n+    square_n_mul(out, 4, p[0]);\n+    square_n_mul(out, 4, p[1]);\n+    square_n_mul(out, 3, p[0]);\n+\n+    return out;\n+}\n+\n+void Num3072::Multiply(const Num3072& a)\n+{\n+    limb_t c0 = 0, c1 = 0, c2 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of this*a into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0;\n+        mul(d0, d1, this->limbs[1 + j], a.limbs[LIMBS + j - (1 + j)]);\n+        for (int i = 2 + j; i < LIMBS; ++i) muladd3(d0, d1, d2, this->limbs[i], a.limbs[LIMBS + j - i]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < j + 1; ++i) muladd3(c0, c1, c2, this->limbs[i], a.limbs[j - i]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+\n+    /* Compute limb N-1 of a*b into tmp. */\n+    assert(c2 == 0);\n+    for (int i = 0; i < LIMBS; ++i) muladd3(c0, c1, c2, this->limbs[i], a.limbs[LIMBS - 1 - i]);\n+    extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        addnextract2(c0, c1, tmp.limbs[j], this->limbs[j]);\n+    }\n+\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+\n+    /* Perform up to two more reductions if the internal state has already\n+     * overflown the MAX of Num3072 or if it is larger than the modulus or\n+     * if both are the case.\n+     * */\n+    if (this->IsOverflow()) this->FullReduce();\n+    if (c0) this->FullReduce();\n+}\n+\n+void Num3072::Square()\n+{\n+    limb_t c0 = 0, c1 = 0, c2 = 0;\n+    Num3072 tmp;\n+\n+    /* Compute limbs 0..N-2 of this*this into tmp, including one reduction. */\n+    for (int j = 0; j < LIMBS - 1; ++j) {\n+        limb_t d0 = 0, d1 = 0, d2 = 0;\n+        for (int i = 0; i < (LIMBS - 1 - j) / 2; ++i) muldbladd3(d0, d1, d2, this->limbs[i + j + 1], this->limbs[LIMBS - 1 - i]);\n+        if ((j + 1) & 1) muladd3(d0, d1, d2, this->limbs[(LIMBS - 1 - j) / 2 + j + 1], this->limbs[LIMBS - 1 - (LIMBS - 1 - j) / 2]);\n+        mulnadd3(c0, c1, c2, d0, d1, d2, MAX_PRIME_DIFF);\n+        for (int i = 0; i < (j + 1) / 2; ++i) muldbladd3(c0, c1, c2, this->limbs[i], this->limbs[j - i]);\n+        if ((j + 1) & 1) muladd3(c0, c1, c2, this->limbs[(j + 1) / 2], this->limbs[j - (j + 1) / 2]);\n+        extract3(c0, c1, c2, tmp.limbs[j]);\n+    }\n+\n+    assert(c2 == 0);\n+    for (int i = 0; i < LIMBS / 2; ++i) muldbladd3(c0, c1, c2, this->limbs[i], this->limbs[LIMBS - 1 - i]);\n+    extract3(c0, c1, c2, tmp.limbs[LIMBS - 1]);\n+\n+    /* Perform a second reduction. */\n+    muln2(c0, c1, MAX_PRIME_DIFF);\n+    for (int j = 0; j < LIMBS; ++j) {\n+        addnextract2(c0, c1, tmp.limbs[j], this->limbs[j]);\n+    }\n+\n+    assert(c1 == 0);\n+    assert(c0 == 0 || c0 == 1);\n+\n+    /* Perform up to two more reductions if the internal state has already\n+     * overflown the MAX of Num3072 or if it is larger than the modulus or\n+     * if both are the case.\n+     * */\n+    if (this->IsOverflow()) this->FullReduce();\n+    if (c0) this->FullReduce();\n+}\n+\n+void Num3072::SetToOne()\n+{\n+    this->limbs[0] = 1;\n+    for (int i = 1; i < LIMBS; ++i) this->limbs[i] = 0;\n+}\n+\n+void Num3072::Divide(Num3072& a)\n+{\n+    if (this->IsOverflow()) this->FullReduce();\n+    if (a.IsOverflow()) a.FullReduce();\n+\n+    Num3072 inv = a.GetInverse();\n+    this->Multiply(inv);\n+    if (this->IsOverflow()) this->FullReduce();\n+}\n+\n+MuHash3072::MuHash3072(Span<const unsigned char> in) noexcept\n+{\n+    uint256 hashed_in = (CHashWriter(SER_DISK, 0) << in).GetSHA256();\n+    unsigned char tmp[BYTE_SIZE];\n+    ChaCha20(hashed_in.data(), hashed_in.size()).Keystream(tmp, BYTE_SIZE);\n+    for (int i = 0; i < LIMBS; ++i) {\n+        if (sizeof(limb_t) == 4) {\n+            m_numerator.limbs[i] = ReadLE32(tmp + 4 * i);\n+        } else if (sizeof(limb_t) == 8) {\n+            m_numerator.limbs[i] = ReadLE64(tmp + 8 * i);\n+        }\n+    }\n+}\n+\n+void MuHash3072::Finalize(uint256& out) noexcept\n+{\n+    m_numerator.Divide(m_denominator);\n+    m_denominator.SetToOne();  // Needed to keep the MuHash object valid\n+\n+    unsigned char data[384];\n+    for (int i = 0; i < LIMBS; ++i) {\n+        if (sizeof(limb_t) == 4) {\n+            WriteLE32(data + i * 4, m_numerator.limbs[i]);\n+        } else if (sizeof(limb_t) == 8) {\n+            WriteLE64(data + i * 8, m_numerator.limbs[i]);\n+        }\n+    }\n+\n+    out = (CHashWriter(SER_DISK, 0) << data).GetSHA256();\n+}\n+\n+MuHash3072& MuHash3072::operator*=(const MuHash3072& mul) noexcept",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r547006838",
      "id" : 547006838,
      "in_reply_to_id" : 546107086,
      "line" : 316,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzAwNjgzOA==",
      "original_commit_id" : "515ee0d0ca91bfdf6a9cd844824e747291efabe9",
      "original_line" : 316,
      "original_position" : 303,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : 316,
      "pull_request_review_id" : 556752575,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:55:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/547006838",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r547007117"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/547007117"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I do a reduction on `a` if it's needed so when it's `const` I would need an intermediary variable. But at least this should not happen too often so I implemented this although it complicates the code a little bit so I am still undecided if it's an improvement.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-12-22T00:55:58Z",
      "diff_hunk" : "@@ -0,0 +1,119 @@\n+// Copyright (c) 2017-2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+#include <uint256.h>\n+\n+#include <stdint.h>\n+\n+class Num3072\n+{\n+private:\n+    void FullReduce();\n+    bool IsOverflow() const;\n+    Num3072 GetInverse() const;\n+\n+public:\n+\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_t;\n+    typedef uint64_t limb_t;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_t;\n+    typedef uint32_t limb_t;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_t limbs[LIMBS];\n+\n+    // Sanity check for Num3072 constants\n+    static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+    static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+    static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+    // Hard coded values in MuHash3072 constructor and Finalize\n+    static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+    void Multiply(const Num3072& a);\n+    void Divide(Num3072& a);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r547007117",
      "id" : 547007117,
      "in_reply_to_id" : 545126648,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzAwNzExNw==",
      "original_commit_id" : "515ee0d0ca91bfdf6a9cd844824e747291efabe9",
      "original_line" : 48,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : null,
      "pull_request_review_id" : 556752834,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:55:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/547007117",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r547007156"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/547007156"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks, I have split up the large commit into four separate ones and melted the other unit test commit with one of them. I think this will help with reviews.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-12-22T00:56:08Z",
      "diff_hunk" : "@@ -753,6 +753,9 @@ if test x$use_lcov_branch != xno; then\n   AC_SUBST(LCOV_OPTS, \"$LCOV_OPTS --rc lcov_branch_coverage=1\")\n fi\n \n+dnl Check for __int128\n+AC_CHECK_TYPES([__int128])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r547007156",
      "id" : 547007156,
      "in_reply_to_id" : 545088857,
      "line" : 757,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzAwNzE1Ng==",
      "original_commit_id" : "515ee0d0ca91bfdf6a9cd844824e747291efabe9",
      "original_line" : 757,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "configure.ac",
      "position" : 5,
      "pull_request_review_id" : 556752878,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T00:56:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/547007156",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Addressed the latest comments.\r\n\r\n> Perhaps `Num3072` can have `SERIALIZE_METHODS` (and a test), so that `MuHash3072` can serialise its numerator and denominator without poking into `Num3072` internals.\r\n\r\nDone\r\n",
      "created_at" : "2020-12-22T00:57:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-749278131",
      "id" : 749278131,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0OTI3ODEzMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-22T00:57:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/749278131",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "So good",
      "created_at" : "2020-12-22T10:57:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-749481884",
      "id" : 749481884,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0OTQ4MTg4NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-22T10:57:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/749481884",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/75303867?v=4",
         "events_url" : "https://api.github.com/users/Limpisey168/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Limpisey168/followers",
         "following_url" : "https://api.github.com/users/Limpisey168/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Limpisey168/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Limpisey168",
         "id" : 75303867,
         "login" : "Limpisey168",
         "node_id" : "MDQ6VXNlcjc1MzAzODY3",
         "organizations_url" : "https://api.github.com/users/Limpisey168/orgs",
         "received_events_url" : "https://api.github.com/users/Limpisey168/received_events",
         "repos_url" : "https://api.github.com/users/Limpisey168/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Limpisey168/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Limpisey168/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Limpisey168"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r547213514"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/547213514"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Is this really what we want?\r\nor do we want it to normalize it (like Finalize does) and then just serialize the numerator?",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-12-22T11:03:20Z",
      "diff_hunk" : "@@ -0,0 +1,130 @@\n+// Copyright (c) 2017-2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+#include <uint256.h>\n+\n+#include <stdint.h>\n+\n+class Num3072\n+{\n+private:\n+    void FullReduce();\n+    bool IsOverflow() const;\n+    Num3072 GetInverse() const;\n+\n+public:\n+\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_t;\n+    typedef uint64_t limb_t;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_t;\n+    typedef uint32_t limb_t;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_t limbs[LIMBS];\n+\n+    // Sanity check for Num3072 constants\n+    static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+    static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+    static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+    // Hard coded values in MuHash3072 constructor and Finalize\n+    static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+    void Multiply(const Num3072& a);\n+    void Divide(const Num3072& a);\n+    void SetToOne();\n+    void Square();\n+\n+    Num3072() { this->SetToOne(); };\n+\n+    SERIALIZE_METHODS(Num3072, obj)\n+    {\n+        for (auto& limb : obj.limbs) {\n+            READWRITE(limb);\n+        }\n+    }\n+};\n+\n+/** A class representing MuHash sets\n+ *\n+ * MuHash is a hashing algorithm that supports adding set elements in any\n+ * order but also deleting in any order. As a result, it can maintain a\n+ * running sum for a set of data as a whole, and add/remove when data\n+ * is added to or removed from it. A downside of MuHash is that computing\n+ * an inverse is relatively expensive. This is solved by representing\n+ * the running value as a fraction, and multiplying added elements into\n+ * the numerator and removed elements into the denominator. Only when the\n+ * final hash is desired, a single modular inverse and multiplication is\n+ * needed to combine the two. The combination is also run on serialization\n+ * to allow for space-efficient storage on disk.\n+ *\n+ * As the update operations are also associative, H(a)+H(b)+H(c)+H(d) can\n+ * in fact be computed as (H(a)+H(b)) + (H(c)+H(d)). This implies that\n+ * all of this is perfectly parallellizable: each thread can process an\n+ * arbitrary subset of the update operations, allowing them to be\n+ * efficiently combined later.\n+ *\n+ * Muhash does not support checking if an element is already part of the\n+ * set. That is why this class does not enforce the use of a set as the\n+ * data it represents because there is no efficient way to do so.\n+ * It is possible to add elements more than once and also to remove\n+ * elements that have not been added before. However, this implementation\n+ * is intended to represent a set of elements.\n+ *\n+ * See also https://cseweb.ucsd.edu/~mihir/papers/inchash.pdf and\n+ * https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014337.html.\n+ */\n+class MuHash3072\n+{\n+private:\n+    static constexpr size_t BYTE_SIZE = 384;\n+\n+    Num3072 m_numerator;\n+    Num3072 m_denominator;\n+\n+    Num3072 ToNum3072(Span<const unsigned char> in);\n+\n+public:\n+    /* The empty set. */\n+    MuHash3072() noexcept {};\n+\n+    /* A singleton with variable sized data in it. */\n+    explicit MuHash3072(Span<const unsigned char> in) noexcept;\n+\n+    /* Insert a single piece of data into the set. */\n+    MuHash3072& Insert(Span<const unsigned char> in) noexcept;\n+\n+    /* Remove a single piece of data from the set. */\n+    MuHash3072& Remove(Span<const unsigned char> in) noexcept;\n+\n+    /* Multiply (resulting in a hash for the union of the sets) */\n+    MuHash3072& operator*=(const MuHash3072& mul) noexcept;\n+\n+    /* Divide (resulting in a hash for the difference of the sets) */\n+    MuHash3072& operator/=(const MuHash3072& div) noexcept;\n+\n+    /* Finalize into a 32-byte hash. Does not change this object's value. */\n+    void Finalize(uint256& out) noexcept;\n+\n+    SERIALIZE_METHODS(MuHash3072, obj)\n+    {\n+        READWRITE(obj.m_numerator);\n+        READWRITE(obj.m_denominator);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r547213514",
      "id" : 547213514,
      "line" : 126,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzIxMzUxNA==",
      "original_commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "original_line" : 126,
      "original_position" : 126,
      "original_start_line" : 123,
      "path" : "src/crypto/muhash.h",
      "position" : 126,
      "pull_request_review_id" : 556997112,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : 123,
      "start_side" : "RIGHT",
      "updated_at" : "2020-12-22T11:03:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/547213514",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2167860?v=4",
         "events_url" : "https://api.github.com/users/elichai/events{/privacy}",
         "followers_url" : "https://api.github.com/users/elichai/followers",
         "following_url" : "https://api.github.com/users/elichai/following{/other_user}",
         "gists_url" : "https://api.github.com/users/elichai/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/elichai",
         "id" : 2167860,
         "login" : "elichai",
         "node_id" : "MDQ6VXNlcjIxNjc4NjA=",
         "organizations_url" : "https://api.github.com/users/elichai/orgs",
         "received_events_url" : "https://api.github.com/users/elichai/received_events",
         "repos_url" : "https://api.github.com/users/elichai/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/elichai/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/elichai/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/elichai"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r547223670"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/547223670"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That might be a good idea. If we want to use MuHash in combination with assumeutxo then the shorter the (marginally) better.",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-12-22T11:26:13Z",
      "diff_hunk" : "@@ -0,0 +1,130 @@\n+// Copyright (c) 2017-2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+#include <uint256.h>\n+\n+#include <stdint.h>\n+\n+class Num3072\n+{\n+private:\n+    void FullReduce();\n+    bool IsOverflow() const;\n+    Num3072 GetInverse() const;\n+\n+public:\n+\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_t;\n+    typedef uint64_t limb_t;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_t;\n+    typedef uint32_t limb_t;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_t limbs[LIMBS];\n+\n+    // Sanity check for Num3072 constants\n+    static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+    static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+    static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+    // Hard coded values in MuHash3072 constructor and Finalize\n+    static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+    void Multiply(const Num3072& a);\n+    void Divide(const Num3072& a);\n+    void SetToOne();\n+    void Square();\n+\n+    Num3072() { this->SetToOne(); };\n+\n+    SERIALIZE_METHODS(Num3072, obj)\n+    {\n+        for (auto& limb : obj.limbs) {\n+            READWRITE(limb);\n+        }\n+    }\n+};\n+\n+/** A class representing MuHash sets\n+ *\n+ * MuHash is a hashing algorithm that supports adding set elements in any\n+ * order but also deleting in any order. As a result, it can maintain a\n+ * running sum for a set of data as a whole, and add/remove when data\n+ * is added to or removed from it. A downside of MuHash is that computing\n+ * an inverse is relatively expensive. This is solved by representing\n+ * the running value as a fraction, and multiplying added elements into\n+ * the numerator and removed elements into the denominator. Only when the\n+ * final hash is desired, a single modular inverse and multiplication is\n+ * needed to combine the two. The combination is also run on serialization\n+ * to allow for space-efficient storage on disk.\n+ *\n+ * As the update operations are also associative, H(a)+H(b)+H(c)+H(d) can\n+ * in fact be computed as (H(a)+H(b)) + (H(c)+H(d)). This implies that\n+ * all of this is perfectly parallellizable: each thread can process an\n+ * arbitrary subset of the update operations, allowing them to be\n+ * efficiently combined later.\n+ *\n+ * Muhash does not support checking if an element is already part of the\n+ * set. That is why this class does not enforce the use of a set as the\n+ * data it represents because there is no efficient way to do so.\n+ * It is possible to add elements more than once and also to remove\n+ * elements that have not been added before. However, this implementation\n+ * is intended to represent a set of elements.\n+ *\n+ * See also https://cseweb.ucsd.edu/~mihir/papers/inchash.pdf and\n+ * https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014337.html.\n+ */\n+class MuHash3072\n+{\n+private:\n+    static constexpr size_t BYTE_SIZE = 384;\n+\n+    Num3072 m_numerator;\n+    Num3072 m_denominator;\n+\n+    Num3072 ToNum3072(Span<const unsigned char> in);\n+\n+public:\n+    /* The empty set. */\n+    MuHash3072() noexcept {};\n+\n+    /* A singleton with variable sized data in it. */\n+    explicit MuHash3072(Span<const unsigned char> in) noexcept;\n+\n+    /* Insert a single piece of data into the set. */\n+    MuHash3072& Insert(Span<const unsigned char> in) noexcept;\n+\n+    /* Remove a single piece of data from the set. */\n+    MuHash3072& Remove(Span<const unsigned char> in) noexcept;\n+\n+    /* Multiply (resulting in a hash for the union of the sets) */\n+    MuHash3072& operator*=(const MuHash3072& mul) noexcept;\n+\n+    /* Divide (resulting in a hash for the difference of the sets) */\n+    MuHash3072& operator/=(const MuHash3072& div) noexcept;\n+\n+    /* Finalize into a 32-byte hash. Does not change this object's value. */\n+    void Finalize(uint256& out) noexcept;\n+\n+    SERIALIZE_METHODS(MuHash3072, obj)\n+    {\n+        READWRITE(obj.m_numerator);\n+        READWRITE(obj.m_denominator);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r547223670",
      "id" : 547223670,
      "in_reply_to_id" : 547213514,
      "line" : 126,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzIyMzY3MA==",
      "original_commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "original_line" : 126,
      "original_position" : 126,
      "original_start_line" : 123,
      "path" : "src/crypto/muhash.h",
      "position" : 126,
      "pull_request_review_id" : 557010079,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : 123,
      "start_side" : "RIGHT",
      "updated_at" : "2020-12-22T11:26:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/547223670",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r547224730"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/547224730"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It should make it less likely for a future user of `Num3072` to shoot themselves in the foot, by calling `Divide(a)` and using `a` afterwards. ",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-12-22T11:28:27Z",
      "diff_hunk" : "@@ -0,0 +1,119 @@\n+// Copyright (c) 2017-2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+#include <uint256.h>\n+\n+#include <stdint.h>\n+\n+class Num3072\n+{\n+private:\n+    void FullReduce();\n+    bool IsOverflow() const;\n+    Num3072 GetInverse() const;\n+\n+public:\n+\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_t;\n+    typedef uint64_t limb_t;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_t;\n+    typedef uint32_t limb_t;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_t limbs[LIMBS];\n+\n+    // Sanity check for Num3072 constants\n+    static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+    static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+    static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+    // Hard coded values in MuHash3072 constructor and Finalize\n+    static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+    void Multiply(const Num3072& a);\n+    void Divide(Num3072& a);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r547224730",
      "id" : 547224730,
      "in_reply_to_id" : 545126648,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzIyNDczMA==",
      "original_commit_id" : "515ee0d0ca91bfdf6a9cd844824e747291efabe9",
      "original_line" : 48,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.h",
      "position" : null,
      "pull_request_review_id" : 557011454,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-22T11:29:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/547224730",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r547518507"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/547518507"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Right, that would be nicer and I had implemented it like that a few weeks ago but decided to kick it out again because code-wise it felt awkward to force normalization before every serialization. Maybe there is a better way to do it than what I tried code-wise. I don't think I found another example of where something comparable is done IIRC. Overall, normalizing is an expensive operation that would need to run quite for every serialization to result in a 50% space-saving on disk. However, for CoinstatsIndex I only save a single MuHash3072 to disk at any time, so at least for that, it would only save 384 bytes total. That's why I took the easy way and kept it as it is now.\r\n\r\nI can try to revive my old branch and push it for the sake of discussion. But I am not sure why it makes a difference for assumeutxo, wouldn't we use the finalized 32 byte hash for that as well?",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-12-22T21:36:34Z",
      "diff_hunk" : "@@ -0,0 +1,130 @@\n+// Copyright (c) 2017-2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+#include <uint256.h>\n+\n+#include <stdint.h>\n+\n+class Num3072\n+{\n+private:\n+    void FullReduce();\n+    bool IsOverflow() const;\n+    Num3072 GetInverse() const;\n+\n+public:\n+\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_t;\n+    typedef uint64_t limb_t;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_t;\n+    typedef uint32_t limb_t;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_t limbs[LIMBS];\n+\n+    // Sanity check for Num3072 constants\n+    static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+    static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+    static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+    // Hard coded values in MuHash3072 constructor and Finalize\n+    static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+    void Multiply(const Num3072& a);\n+    void Divide(const Num3072& a);\n+    void SetToOne();\n+    void Square();\n+\n+    Num3072() { this->SetToOne(); };\n+\n+    SERIALIZE_METHODS(Num3072, obj)\n+    {\n+        for (auto& limb : obj.limbs) {\n+            READWRITE(limb);\n+        }\n+    }\n+};\n+\n+/** A class representing MuHash sets\n+ *\n+ * MuHash is a hashing algorithm that supports adding set elements in any\n+ * order but also deleting in any order. As a result, it can maintain a\n+ * running sum for a set of data as a whole, and add/remove when data\n+ * is added to or removed from it. A downside of MuHash is that computing\n+ * an inverse is relatively expensive. This is solved by representing\n+ * the running value as a fraction, and multiplying added elements into\n+ * the numerator and removed elements into the denominator. Only when the\n+ * final hash is desired, a single modular inverse and multiplication is\n+ * needed to combine the two. The combination is also run on serialization\n+ * to allow for space-efficient storage on disk.\n+ *\n+ * As the update operations are also associative, H(a)+H(b)+H(c)+H(d) can\n+ * in fact be computed as (H(a)+H(b)) + (H(c)+H(d)). This implies that\n+ * all of this is perfectly parallellizable: each thread can process an\n+ * arbitrary subset of the update operations, allowing them to be\n+ * efficiently combined later.\n+ *\n+ * Muhash does not support checking if an element is already part of the\n+ * set. That is why this class does not enforce the use of a set as the\n+ * data it represents because there is no efficient way to do so.\n+ * It is possible to add elements more than once and also to remove\n+ * elements that have not been added before. However, this implementation\n+ * is intended to represent a set of elements.\n+ *\n+ * See also https://cseweb.ucsd.edu/~mihir/papers/inchash.pdf and\n+ * https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014337.html.\n+ */\n+class MuHash3072\n+{\n+private:\n+    static constexpr size_t BYTE_SIZE = 384;\n+\n+    Num3072 m_numerator;\n+    Num3072 m_denominator;\n+\n+    Num3072 ToNum3072(Span<const unsigned char> in);\n+\n+public:\n+    /* The empty set. */\n+    MuHash3072() noexcept {};\n+\n+    /* A singleton with variable sized data in it. */\n+    explicit MuHash3072(Span<const unsigned char> in) noexcept;\n+\n+    /* Insert a single piece of data into the set. */\n+    MuHash3072& Insert(Span<const unsigned char> in) noexcept;\n+\n+    /* Remove a single piece of data from the set. */\n+    MuHash3072& Remove(Span<const unsigned char> in) noexcept;\n+\n+    /* Multiply (resulting in a hash for the union of the sets) */\n+    MuHash3072& operator*=(const MuHash3072& mul) noexcept;\n+\n+    /* Divide (resulting in a hash for the difference of the sets) */\n+    MuHash3072& operator/=(const MuHash3072& div) noexcept;\n+\n+    /* Finalize into a 32-byte hash. Does not change this object's value. */\n+    void Finalize(uint256& out) noexcept;\n+\n+    SERIALIZE_METHODS(MuHash3072, obj)\n+    {\n+        READWRITE(obj.m_numerator);\n+        READWRITE(obj.m_denominator);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r547518507",
      "id" : 547518507,
      "in_reply_to_id" : 547213514,
      "line" : 126,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzUxODUwNw==",
      "original_commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "original_line" : 126,
      "original_position" : 126,
      "original_start_line" : 123,
      "path" : "src/crypto/muhash.h",
      "position" : 126,
      "pull_request_review_id" : 557380555,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : 123,
      "start_side" : "RIGHT",
      "updated_at" : "2020-12-22T21:36:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/547518507",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r547899299"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/547899299"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "it depends, if we ever add a commitment to this in the coinbase or something like that then we might want to also save the MuHash in the undoBlocks.\r\nBut I think there's no point in discussing this now, so IMO you can leave it as-is",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2020-12-23T10:55:07Z",
      "diff_hunk" : "@@ -0,0 +1,130 @@\n+// Copyright (c) 2017-2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CRYPTO_MUHASH_H\n+#define BITCOIN_CRYPTO_MUHASH_H\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <serialize.h>\n+#include <uint256.h>\n+\n+#include <stdint.h>\n+\n+class Num3072\n+{\n+private:\n+    void FullReduce();\n+    bool IsOverflow() const;\n+    Num3072 GetInverse() const;\n+\n+public:\n+\n+#ifdef HAVE___INT128\n+    typedef unsigned __int128 double_limb_t;\n+    typedef uint64_t limb_t;\n+    static constexpr int LIMBS = 48;\n+    static constexpr int LIMB_SIZE = 64;\n+#else\n+    typedef uint64_t double_limb_t;\n+    typedef uint32_t limb_t;\n+    static constexpr int LIMBS = 96;\n+    static constexpr int LIMB_SIZE = 32;\n+#endif\n+    limb_t limbs[LIMBS];\n+\n+    // Sanity check for Num3072 constants\n+    static_assert(LIMB_SIZE * LIMBS == 3072, \"Num3072 isn't 3072 bits\");\n+    static_assert(sizeof(double_limb_t) == sizeof(limb_t) * 2, \"bad size for double_limb_t\");\n+    static_assert(sizeof(limb_t) * 8 == LIMB_SIZE, \"LIMB_SIZE is incorrect\");\n+\n+    // Hard coded values in MuHash3072 constructor and Finalize\n+    static_assert(sizeof(limb_t) == 4 || sizeof(limb_t) == 8, \"bad size for limb_t\");\n+\n+    void Multiply(const Num3072& a);\n+    void Divide(const Num3072& a);\n+    void SetToOne();\n+    void Square();\n+\n+    Num3072() { this->SetToOne(); };\n+\n+    SERIALIZE_METHODS(Num3072, obj)\n+    {\n+        for (auto& limb : obj.limbs) {\n+            READWRITE(limb);\n+        }\n+    }\n+};\n+\n+/** A class representing MuHash sets\n+ *\n+ * MuHash is a hashing algorithm that supports adding set elements in any\n+ * order but also deleting in any order. As a result, it can maintain a\n+ * running sum for a set of data as a whole, and add/remove when data\n+ * is added to or removed from it. A downside of MuHash is that computing\n+ * an inverse is relatively expensive. This is solved by representing\n+ * the running value as a fraction, and multiplying added elements into\n+ * the numerator and removed elements into the denominator. Only when the\n+ * final hash is desired, a single modular inverse and multiplication is\n+ * needed to combine the two. The combination is also run on serialization\n+ * to allow for space-efficient storage on disk.\n+ *\n+ * As the update operations are also associative, H(a)+H(b)+H(c)+H(d) can\n+ * in fact be computed as (H(a)+H(b)) + (H(c)+H(d)). This implies that\n+ * all of this is perfectly parallellizable: each thread can process an\n+ * arbitrary subset of the update operations, allowing them to be\n+ * efficiently combined later.\n+ *\n+ * Muhash does not support checking if an element is already part of the\n+ * set. That is why this class does not enforce the use of a set as the\n+ * data it represents because there is no efficient way to do so.\n+ * It is possible to add elements more than once and also to remove\n+ * elements that have not been added before. However, this implementation\n+ * is intended to represent a set of elements.\n+ *\n+ * See also https://cseweb.ucsd.edu/~mihir/papers/inchash.pdf and\n+ * https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014337.html.\n+ */\n+class MuHash3072\n+{\n+private:\n+    static constexpr size_t BYTE_SIZE = 384;\n+\n+    Num3072 m_numerator;\n+    Num3072 m_denominator;\n+\n+    Num3072 ToNum3072(Span<const unsigned char> in);\n+\n+public:\n+    /* The empty set. */\n+    MuHash3072() noexcept {};\n+\n+    /* A singleton with variable sized data in it. */\n+    explicit MuHash3072(Span<const unsigned char> in) noexcept;\n+\n+    /* Insert a single piece of data into the set. */\n+    MuHash3072& Insert(Span<const unsigned char> in) noexcept;\n+\n+    /* Remove a single piece of data from the set. */\n+    MuHash3072& Remove(Span<const unsigned char> in) noexcept;\n+\n+    /* Multiply (resulting in a hash for the union of the sets) */\n+    MuHash3072& operator*=(const MuHash3072& mul) noexcept;\n+\n+    /* Divide (resulting in a hash for the difference of the sets) */\n+    MuHash3072& operator/=(const MuHash3072& div) noexcept;\n+\n+    /* Finalize into a 32-byte hash. Does not change this object's value. */\n+    void Finalize(uint256& out) noexcept;\n+\n+    SERIALIZE_METHODS(MuHash3072, obj)\n+    {\n+        READWRITE(obj.m_numerator);\n+        READWRITE(obj.m_denominator);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r547899299",
      "id" : 547899299,
      "in_reply_to_id" : 547213514,
      "line" : 126,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzg5OTI5OQ==",
      "original_commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "original_line" : 126,
      "original_position" : 126,
      "original_start_line" : 123,
      "path" : "src/crypto/muhash.h",
      "position" : 126,
      "pull_request_review_id" : 557794684,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : 123,
      "start_side" : "RIGHT",
      "updated_at" : "2020-12-23T10:55:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/547899299",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2167860?v=4",
         "events_url" : "https://api.github.com/users/elichai/events{/privacy}",
         "followers_url" : "https://api.github.com/users/elichai/followers",
         "following_url" : "https://api.github.com/users/elichai/following{/other_user}",
         "gists_url" : "https://api.github.com/users/elichai/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/elichai",
         "id" : 2167860,
         "login" : "elichai",
         "node_id" : "MDQ6VXNlcjIxNjc4NjA=",
         "organizations_url" : "https://api.github.com/users/elichai/orgs",
         "received_events_url" : "https://api.github.com/users/elichai/received_events",
         "repos_url" : "https://api.github.com/users/elichai/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/elichai/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/elichai/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/elichai"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Ok thanks you\n\nOn Wed, Dec 23, 2020, 5:55 PM Elichai Turkel <notifications@github.com>\nwrote:\n\n> *@elichai* commented on this pull request.\n> ------------------------------\n>\n> In src/crypto/muhash.h\n> <https://github.com/bitcoin/bitcoin/pull/19055#discussion_r547899299>:\n>\n> > +    SERIALIZE_METHODS(MuHash3072, obj)\n> +    {\n> +        READWRITE(obj.m_numerator);\n> +        READWRITE(obj.m_denominator);\n>\n> it depends, if we ever add a commitment to this in the coinbase or\n> something like that then we might want to also save the MuHash in the\n> undoBlocks.\n> But I think there's no point in discussing this now, so IMO you can leave\n> it as-is\n>\n> â\n> You are receiving this because you commented.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/bitcoin/bitcoin/pull/19055#discussion_r547899299>, or\n> unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/AR6QXO6CHJKCULJ5RKSAYT3SWHEBZANCNFSM4NICXN4Q>\n> .\n>\n",
      "created_at" : "2020-12-23T11:51:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#issuecomment-750210462",
      "id" : 750210462,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19055",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1MDIxMDQ2Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-23T11:51:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/750210462",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/75303867?v=4",
         "events_url" : "https://api.github.com/users/Limpisey168/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Limpisey168/followers",
         "following_url" : "https://api.github.com/users/Limpisey168/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Limpisey168/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Limpisey168",
         "id" : 75303867,
         "login" : "Limpisey168",
         "node_id" : "MDQ6VXNlcjc1MzAzODY3",
         "organizations_url" : "https://api.github.com/users/Limpisey168/orgs",
         "received_events_url" : "https://api.github.com/users/Limpisey168/received_events",
         "repos_url" : "https://api.github.com/users/Limpisey168/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Limpisey168/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Limpisey168/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Limpisey168"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r562098872"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562098872"
         }
      },
      "author_association" : "MEMBER",
      "body" : "typo: wether -> whether ",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2021-01-21T18:18:48Z",
      "diff_hunk" : "@@ -0,0 +1,338 @@\n+// Copyright (c) 2017-2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+#include <hash.h>\n+\n+#include <cassert>\n+#include <cstdio>\n+#include <limits>\n+\n+namespace {\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+/** 2^3072 - 1103717, the largest 3072-bit safe prime number, is used as the modulus. */\n+constexpr limb_t MAX_PRIME_DIFF = 1103717;\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    limb_t th = t >> LIMB_SIZE;\n+    limb_t tl = t;\n+\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    limb_t th = t >> LIMB_SIZE;\n+    limb_t tl = t;\n+\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/**\n+ * Add limb a to [c0,c1]: [c0,c1] += a. Then extract the lowest\n+ * limb of [c0,c1] into n, and left shift the number by 1 limb.\n+ * */\n+inline void addnextract2(limb_t& c0, limb_t& c1, const limb_t& a, limb_t& n)\n+{\n+    limb_t c2 = 0;\n+\n+    // add\n+    c0 += a;\n+    if (c0 < a) {\n+        c1 += 1;\n+\n+        // Handle case when c1 has overflown\n+        if (c1 == 0)\n+            c2 = 1;\n+    }\n+\n+    // extract\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+}\n+\n+/** in_out = in_out^(2^sq) * mul */\n+inline void square_n_mul(Num3072& in_out, const int sq, const Num3072& mul)\n+{\n+    for (int j = 0; j < sq; ++j) in_out.Square();\n+    in_out.Multiply(mul);\n+}\n+\n+} // namespace\n+\n+/** Indicates wether d is larger than the modulus. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r562098872",
      "id" : 562098872,
      "line" : 126,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjA5ODg3Mg==",
      "original_commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "original_line" : 126,
      "original_position" : 126,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : 126,
      "pull_request_review_id" : 573610664,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-21T18:18:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562098872",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r562216486"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562216486"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks! Included a fix in #19145 ",
      "commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "created_at" : "2021-01-21T21:43:23Z",
      "diff_hunk" : "@@ -0,0 +1,338 @@\n+// Copyright (c) 2017-2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <crypto/muhash.h>\n+\n+#include <crypto/chacha20.h>\n+#include <crypto/common.h>\n+#include <hash.h>\n+\n+#include <cassert>\n+#include <cstdio>\n+#include <limits>\n+\n+namespace {\n+\n+using limb_t = Num3072::limb_t;\n+using double_limb_t = Num3072::double_limb_t;\n+constexpr int LIMB_SIZE = Num3072::LIMB_SIZE;\n+constexpr int LIMBS = Num3072::LIMBS;\n+/** 2^3072 - 1103717, the largest 3072-bit safe prime number, is used as the modulus. */\n+constexpr limb_t MAX_PRIME_DIFF = 1103717;\n+\n+/** Extract the lowest limb of [c0,c1,c2] into n, and left shift the number by 1 limb. */\n+inline void extract3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& n)\n+{\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+    c2 = 0;\n+}\n+\n+/** [c0,c1] = a * b */\n+inline void mul(limb_t& c0, limb_t& c1, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    c1 = t >> LIMB_SIZE;\n+    c0 = t;\n+}\n+\n+/* [c0,c1,c2] += n * [d0,d1,d2]. c2 is 0 initially */\n+inline void mulnadd3(limb_t& c0, limb_t& c1, limb_t& c2, limb_t& d0, limb_t& d1, limb_t& d2, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)d0 * n + c0;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)d1 * n + c1;\n+    c1 = t;\n+    t >>= LIMB_SIZE;\n+    c2 = t + d2 * n;\n+}\n+\n+/* [c0,c1] *= n */\n+inline void muln2(limb_t& c0, limb_t& c1, const limb_t& n)\n+{\n+    double_limb_t t = (double_limb_t)c0 * n;\n+    c0 = t;\n+    t >>= LIMB_SIZE;\n+    t += (double_limb_t)c1 * n;\n+    c1 = t;\n+}\n+\n+/** [c0,c1,c2] += a * b */\n+inline void muladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    limb_t th = t >> LIMB_SIZE;\n+    limb_t tl = t;\n+\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/** [c0,c1,c2] += 2 * a * b */\n+inline void muldbladd3(limb_t& c0, limb_t& c1, limb_t& c2, const limb_t& a, const limb_t& b)\n+{\n+    double_limb_t t = (double_limb_t)a * b;\n+    limb_t th = t >> LIMB_SIZE;\n+    limb_t tl = t;\n+\n+    c0 += tl;\n+    limb_t tt = th + ((c0 < tl) ? 1 : 0);\n+    c1 += tt;\n+    c2 += (c1 < tt) ? 1 : 0;\n+    c0 += tl;\n+    th += (c0 < tl) ? 1 : 0;\n+    c1 += th;\n+    c2 += (c1 < th) ? 1 : 0;\n+}\n+\n+/**\n+ * Add limb a to [c0,c1]: [c0,c1] += a. Then extract the lowest\n+ * limb of [c0,c1] into n, and left shift the number by 1 limb.\n+ * */\n+inline void addnextract2(limb_t& c0, limb_t& c1, const limb_t& a, limb_t& n)\n+{\n+    limb_t c2 = 0;\n+\n+    // add\n+    c0 += a;\n+    if (c0 < a) {\n+        c1 += 1;\n+\n+        // Handle case when c1 has overflown\n+        if (c1 == 0)\n+            c2 = 1;\n+    }\n+\n+    // extract\n+    n = c0;\n+    c0 = c1;\n+    c1 = c2;\n+}\n+\n+/** in_out = in_out^(2^sq) * mul */\n+inline void square_n_mul(Num3072& in_out, const int sq, const Num3072& mul)\n+{\n+    for (int j = 0; j < sq; ++j) in_out.Square();\n+    in_out.Multiply(mul);\n+}\n+\n+} // namespace\n+\n+/** Indicates wether d is larger than the modulus. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19055#discussion_r562216486",
      "id" : 562216486,
      "in_reply_to_id" : 562098872,
      "line" : 126,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjIxNjQ4Ng==",
      "original_commit_id" : "9815332d5158d69a94abeaf465a2c07bd8e43359",
      "original_line" : 126,
      "original_position" : 126,
      "original_start_line" : null,
      "path" : "src/crypto/muhash.cpp",
      "position" : 126,
      "pull_request_review_id" : 573760504,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19055",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-21T21:43:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562216486",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   }
]
